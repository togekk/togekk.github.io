{"version":3,"sources":["node_modules/wasm-worker/lib/actions.js","node_modules/wasm-worker/lib/worker.js","node_modules/wasm-worker/lib/utils.js","node_modules/wasm-worker/lib/index.js","index.ts"],"names":[],"mappings":"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","file":"wasm-worker-test.65ddf0a7.map","sourceRoot":"..","sourcesContent":["\"use strict\";\n\nexports.__esModule = true;\nvar ACTIONS = {\n  COMPILE_MODULE: 0,\n  CALL_FUNCTION_EXPORT: 1,\n  RUN_FUNCTION: 2\n};\n\nexports[\"default\"] = ACTIONS;","'use strict';\n\nexports.__esModule = true;\nexports['default'] = worker;\nfunction worker(e) {\n  var _e$data = e.data,\n      id = _e$data.id,\n      action = _e$data.action,\n      payload = _e$data.payload;\n\n\n  var sendMessage = function sendMessage(result, data) {\n    self.postMessage({\n      id: id,\n      action: action,\n      result: result,\n      payload: data\n    });\n  };\n\n  var onError = function onError(ex) {\n    return sendMessage(1, '' + ex);\n  };\n  var onSuccess = sendMessage.bind(null, 0);\n\n  if (action === ACTIONS.COMPILE_MODULE) {\n    Promise.resolve().then(function () {\n      var res = void 0;\n      if (getImportObject !== undefined) {\n        importObject = getImportObject();\n      }\n\n      if (typeof payload === 'string') {\n        res = fetch(payload);\n        if (WebAssembly.instantiateStreaming !== undefined) {\n          return WebAssembly.instantiateStreaming(res, importObject);\n        }\n        res = res.then(function (response) {\n          return response.arrayBuffer();\n        });\n      } else {\n        res = Promise.resolve(payload);\n      }\n\n      return res.then(function (buff) {\n        return WebAssembly.compile(buff);\n      }).then(function (module) {\n        return WebAssembly.instantiate(module, importObject).then(function (instance) {\n          return { module: module, instance: instance };\n        });\n      });\n    }).then(function (_ref) {\n      var module = _ref.module,\n          instance = _ref.instance;\n\n      moduleInstance = instance;\n\n      wasmModule = module;\n      onSuccess({\n        exports: WebAssembly.Module.exports(module).filter(function (exp) {\n          return exp.kind === 'function';\n        }).map(function (exp) {\n          return exp.name;\n        })\n      });\n    })['catch'](onError);\n  } else if (action === ACTIONS.CALL_FUNCTION_EXPORT) {\n    var func = payload.func,\n        params = payload.params;\n\n\n    Promise.resolve().then(function () {\n      var ctx = moduleInstance.exports;\n\n      onSuccess(ctx[func].apply(ctx, params));\n    })['catch'](onError);\n  } else if (action === ACTIONS.RUN_FUNCTION) {\n    var _func = payload.func,\n        _params = payload.params;\n\n\n    Promise.resolve().then(function () {\n      var fun = new Function('return ' + _func)();\n      onSuccess(fun({\n        module: wasmModule,\n        instance: moduleInstance,\n        importObject: importObject,\n        params: _params\n      }));\n    })['catch'](onError);\n  }\n}","'use strict';\n\nexports.__esModule = true;\nvar getWasmSource = exports.getWasmSource = function getWasmSource(source) {\n  var result = source;\n\n  if (typeof result === 'string' && typeof location !== 'undefined') {\n    result = result.trim();\n    if (result.indexOf('/') === 0) {\n      result = location.origin + result;\n    } else if (result.indexOf('http') !== 0) {\n      result = location.href + (location.href[location.href.length - 1] === '/' ? '' : '/') + result;\n    }\n  }\n\n  return result;\n};","'use strict';\n\nexports.__esModule = true;\n\nvar _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };\n\nexports['default'] = wasmWorker;\n\nvar _actions = require('./actions');\n\nvar _actions2 = _interopRequireDefault(_actions);\n\nvar _worker = require('./worker');\n\nvar _worker2 = _interopRequireDefault(_worker);\n\nvar _utils = require('./utils');\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction _objectWithoutProperties(obj, keys) { var target = {}; for (var i in obj) { if (keys.indexOf(i) >= 0) continue; if (!Object.prototype.hasOwnProperty.call(obj, i)) continue; target[i] = obj[i]; } return target; }\n\nvar getTransferableParams = function getTransferableParams() {\n  var params = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n  return params.filter(function (x) {\n    return x instanceof ArrayBuffer || x instanceof MessagePort || x instanceof ImageBitmap;\n  });\n};\n\nfunction wasmWorker(source) {\n  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n  var currentId = 0;\n  var promises = {};\n\n  var getImportObject = options.getImportObject,\n      otherOptions = _objectWithoutProperties(options, ['getImportObject']);\n\n  var worker = new Worker('data:,ACTIONS=' + JSON.stringify(_actions2['default']) + ';getImportObject=' + getImportObject + ';' + ('importObject=undefined;wasmModule=null;moduleInstance=null;onmessage=' + _worker2['default']), otherOptions);\n\n  worker.onmessage = function (e) {\n    var _e$data = e.data,\n        id = _e$data.id,\n        result = _e$data.result,\n        action = _e$data.action,\n        payload = _e$data.payload;\n\n\n    if (action === _actions2['default'].COMPILE_MODULE) {\n      if (result === 0) {\n        var exports = payload.exports;\n\n\n        promises[id][0]({\n          exports: exports.reduce(function (acc, exp) {\n            return _extends({}, acc, _defineProperty({}, exp, function () {\n              for (var _len = arguments.length, params = Array(_len), _key = 0; _key < _len; _key++) {\n                params[_key] = arguments[_key];\n              }\n\n              return new Promise(function () {\n                for (var _len2 = arguments.length, rest = Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n                  rest[_key2] = arguments[_key2];\n                }\n\n                promises[++currentId] = rest;\n                worker.postMessage({\n                  id: currentId,\n                  action: _actions2['default'].CALL_FUNCTION_EXPORT,\n                  payload: {\n                    func: exp,\n                    params: params\n                  }\n                }, getTransferableParams(params));\n              });\n            }));\n          }, {}),\n          run: function run(func, params) {\n            return new Promise(function () {\n              for (var _len3 = arguments.length, rest = Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {\n                rest[_key3] = arguments[_key3];\n              }\n\n              promises[++currentId] = rest;\n              worker.postMessage({\n                id: currentId,\n                action: _actions2['default'].RUN_FUNCTION,\n                payload: {\n                  func: func.toString(),\n                  params: params\n                }\n              }, getTransferableParams(params));\n            });\n          }\n        });\n      } else if (result === 1) {\n        promises[id][1](payload);\n      }\n    } else if (action === _actions2['default'].CALL_FUNCTION_EXPORT || action === _actions2['default'].RUN_FUNCTION) {\n      promises[id][result](payload);\n    }\n\n    promises[id] = null;\n  };\n\n  return new Promise(function () {\n    for (var _len4 = arguments.length, params = Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {\n      params[_key4] = arguments[_key4];\n    }\n\n    promises[++currentId] = [].concat(params);\n\n    worker.postMessage({\n      id: currentId,\n      action: _actions2['default'].COMPILE_MODULE,\n      payload: (0, _utils.getWasmSource)(source)\n    });\n  });\n}","import wasmWorker from 'wasm-worker';\r\n\r\n\r\n(async () => {\r\n    const wasm = await wasmWorker('optimized.wasm');\r\n\r\n    const fib = (curr: number, next: number, n: number): number {\r\n        if (n == 0) {\r\n            return curr;\r\n        }\r\n        else {\r\n            return fib(next, curr + next, n - 1);\r\n        }\r\n    }\r\n\r\n    const container = document.body.appendChild(document.createElement('div'));\r\n    const show_log = text => container.appendChild(document.createElement('div')).appendChild(document.createTextNode(text));\r\n\r\n    show_log('Loop: 20000');\r\n\r\n    const arr = new Float64Array(5);\r\n    arr.fill(0);\r\n\r\n    const msg = ['js loop :', 'wasm with js loop :', 'wasm with wasm loop :', 'wasm with js loop and web worker :', 'wasm with wasm loop and web worker :'];\r\n\r\n    const benchmark = async count => {\r\n        show_log('Test ' + count);\r\n\r\n        const t0 = performance.now();\r\n        for (let i = 0; i < 20000; i++) fib(0, 1, i);\r\n        const t1 = performance.now();\r\n        show_log(msg[0] + (t1 - t0) + ' ms');\r\n        arr[0] += t1 - t0;\r\n\r\n        const t2 = performance.now();\r\n        const fib_promise = async n => await wasm.exports.fib_ext(0, 1, n);\r\n        const promises = [];\r\n        for (let i = 0; i < 20000; i++) promises.push(fib_promise(i));\r\n        await Promise.all(promises);\r\n        const t3 = performance.now();\r\n        show_log(msg[1] + (t3 - t2) + ' ms');\r\n        arr[1] += t3 - t2;\r\n\r\n        const t4 = performance.now();\r\n        await wasm.exports.fib_loop();\r\n        const t5 = performance.now();\r\n        show_log(msg[2] + (t5 - t4) + ' ms');\r\n        arr[2] += t5 - t4;\r\n\r\n        const t6 = performance.now();\r\n        await wasm.run(({ instance }) => {\r\n            for (let i = 0; i < 20000; i++) instance.exports.fib_ext(0, 1, i);\r\n        });\r\n        const t7 = performance.now();\r\n        show_log(msg[3] + (t7 - t6) + ' ms');\r\n        arr[3] += t7 - t6;\r\n\r\n        const t8 = performance.now();\r\n        await wasm.run(({ instance }) => {\r\n            instance.exports.fib_loop();\r\n        });\r\n        const t9 = performance.now();\r\n        show_log(msg[4] + (t9 - t8) + ' ms');\r\n        arr[4] += t9 - t8;\r\n    }\r\n\r\n    for (let i = 1; i < 11; i++) await benchmark(i);\r\n    show_log('Average');\r\n    for (let i = 0; i < 5; i++) show_log(msg[i] + (arr[i] / 10));\r\n})();\r\n"]}