webpackJsonp([1],{"+3/4":function(e,t,r){"use strict";r.d(t,"a",function(){return n});var _=r("TToO"),n=function(e){function t(t){e.call(this),this.scheduler=t}return Object(_.b)(t,e),t.create=function(e){return new t(e)},t.dispatch=function(e){e.subscriber.complete()},t.prototype._subscribe=function(e){var r=this.scheduler;if(r)return r.schedule(t.dispatch,0,{subscriber:e});e.complete()},t}(r("YaPU").a)},"+CnV":function(e,t,r){"use strict";r.d(t,"a",function(){return _});var _=function(e){var t,_=r("AMGY").a.Symbol;return"function"==typeof _?_.observable?t=_.observable:(t=_("observable"),_.observable=t):t="@@observable",t}()},"/iUD":function(e,t,r){"use strict";t.a=function(e){return"function"==typeof e}},"/nXB":function(e,t,r){"use strict";t.a=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];var r=Number.POSITIVE_INFINITY,i=null,s=e[e.length-1];return Object(a.a)(s)?(i=e.pop(),e.length>1&&"number"==typeof e[e.length-1]&&(r=e.pop())):"number"==typeof s&&(r=e.pop()),null===i&&1===e.length&&e[0]instanceof _.a?e[0]:Object(o.a)(r)(new n.a(e,i))};var _=r("YaPU"),n=r("Veqx"),a=r("1Q68"),o=r("8D5t")},0:function(e,t,r){e.exports=r("x35b")},"0P3J":function(e,t,r){"use strict";t.a=function(){return function(e){return e.lift(new a(e))}};var _=r("TToO"),n=r("OVmG"),a=function(){function e(e){this.connectable=e}return e.prototype.call=function(e,t){var r=this.connectable;r._refCount++;var _=new o(e,r),n=t.subscribe(_);return _.closed||(_.connection=r.connect()),n},e}(),o=function(e){function t(t,r){e.call(this,t),this.connectable=r}return Object(_.b)(t,e),t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var t=e._refCount;if(t<=0)this.connection=null;else if(e._refCount=t-1,t>1)this.connection=null;else{var r=this.connection,_=e._connection;this.connection=null,!_||r&&_!==r||_.unsubscribe()}}else this.connection=null},t}(n.a)},"1Q68":function(e,t,r){"use strict";t.a=function(e){return e&&"function"==typeof e.schedule}},"8D5t":function(e,t,r){"use strict";var _=r("TToO"),n=r("PIsA"),a=r("tZ2B"),o=function(){function e(e,t,r){void 0===r&&(r=Number.POSITIVE_INFINITY),this.project=e,this.resultSelector=t,this.concurrent=r}return e.prototype.call=function(e,t){return t.subscribe(new i(e,this.project,this.resultSelector,this.concurrent))},e}(),i=function(e){function t(t,r,_,n){void 0===n&&(n=Number.POSITIVE_INFINITY),e.call(this,t),this.project=r,this.resultSelector=_,this.concurrent=n,this.hasCompleted=!1,this.buffer=[],this.active=0,this.index=0}return Object(_.b)(t,e),t.prototype._next=function(e){this.active<this.concurrent?this._tryNext(e):this.buffer.push(e)},t.prototype._tryNext=function(e){var t,r=this.index++;try{t=this.project(e,r)}catch(e){return void this.destination.error(e)}this.active++,this._innerSub(t,e,r)},t.prototype._innerSub=function(e,t,r){this.add(Object(n.a)(this,e,t,r))},t.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete()},t.prototype.notifyNext=function(e,t,r,_,n){this.resultSelector?this._notifyResultSelector(e,t,r,_):this.destination.next(t)},t.prototype._notifyResultSelector=function(e,t,r,_){var n;try{n=this.resultSelector(e,t,r,_)}catch(e){return void this.destination.error(e)}this.destination.next(n)},t.prototype.notifyComplete=function(e){var t=this.buffer;this.remove(e),this.active--,t.length>0?this._next(t.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},t}(a.a);function s(e){return e}t.a=function(e){return void 0===e&&(e=Number.POSITIVE_INFINITY),function(e,t,r){return void 0===r&&(r=Number.POSITIVE_INFINITY),function(_){return"number"==typeof t&&(r=t,t=null),_.lift(new o(e,t,r))}}(s,null,e)}},AMGY:function(e,t,r){"use strict";(function(e){r.d(t,"a",function(){return a});var _="undefined"!=typeof window&&window,n="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,a=_||"undefined"!=typeof e&&e||n}).call(t,r("DuR2"))},BX3T:function(e,t,r){"use strict";r.d(t,"a",function(){return _});var _=Array.isArray||function(e){return e&&"number"==typeof e.length}},DuR2:function(e,t){var r;r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(r=window)}e.exports=r},GK6M:function(e,t,r){"use strict";t.a=function(e){return _=e,a};var _,n=r("fKB6");function a(){try{return _.apply(this,arguments)}catch(e){return n.a.e=e,n.a}}},Jnfr:function(e,t){function r(e){return Promise.resolve().then(function(){throw new Error("Cannot find module '"+e+"'.")})}r.keys=function(){return[]},r.resolve=r,e.exports=r,r.id="Jnfr"},Jwyl:function(e,t,r){"use strict";var _=r("TToO"),n=r("g5jc"),a=r("YaPU"),o=(r("OVmG"),r("VwZZ")),i=r("0P3J"),s=function(e){function t(t,r){e.call(this),this.source=t,this.subjectFactory=r,this._refCount=0,this._isComplete=!1}return Object(_.b)(t,e),t.prototype._subscribe=function(e){return this.getSubject().subscribe(e)},t.prototype.getSubject=function(){var e=this._subject;return e&&!e.isStopped||(this._subject=this.subjectFactory()),this._subject},t.prototype.connect=function(){var e=this._connection;return e||(this._isComplete=!1,(e=this._connection=new o.a).add(this.source.subscribe(new c(this.getSubject(),this))),e.closed?(this._connection=null,e=o.a.EMPTY):this._connection=e),e},t.prototype.refCount=function(){return Object(i.a)()(this)},t}(a.a).prototype,E={operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:s._subscribe},_isComplete:{value:s._isComplete,writable:!0},getSubject:{value:s.getSubject},connect:{value:s.connect},refCount:{value:s.refCount}},c=function(e){function t(t,r){e.call(this,t),this.connectable=r}return Object(_.b)(t,e),t.prototype._error=function(t){this._unsubscribe(),e.prototype._error.call(this,t)},t.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),e.prototype._complete.call(this)},t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var t=e._connection;e._refCount=0,e._subject=null,e._connection=null,t&&t.unsubscribe()}},t}(n.b);t.a=function(e,t){return function(r){var _;if(_="function"==typeof e?e:function(){return e},"function"==typeof t)return r.lift(new l(_,t));var n=Object.create(r,E);return n.source=r,n.subjectFactory=_,n}};var l=function(){function e(e,t){this.subjectFactory=e,this.selector=t}return e.prototype.call=function(e,t){var r=this.selector,_=this.subjectFactory(),n=r(_).subscribe(e);return n.add(t.subscribe(_)),n},e}()},N4j0:function(e,t,r){"use strict";r.d(t,"a",function(){return _});var _=function(e){return e&&"number"==typeof e.length}},OVmG:function(e,t,r){"use strict";r.d(t,"a",function(){return s});var _=r("TToO"),n=r("/iUD"),a=r("VwZZ"),o=r("t7NR"),i=r("tLDX"),s=function(e){function t(r,_,n){switch(e.call(this),this.syncErrorValue=null,this.syncErrorThrown=!1,this.syncErrorThrowable=!1,this.isStopped=!1,arguments.length){case 0:this.destination=o.a;break;case 1:if(!r){this.destination=o.a;break}if("object"==typeof r){r instanceof t?(this.syncErrorThrowable=r.syncErrorThrowable,this.destination=r,this.destination.add(this)):(this.syncErrorThrowable=!0,this.destination=new E(this,r));break}default:this.syncErrorThrowable=!0,this.destination=new E(this,r,_,n)}}return Object(_.b)(t,e),t.prototype[i.a]=function(){return this},t.create=function(e,r,_){var n=new t(e,r,_);return n.syncErrorThrowable=!1,n},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this))},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},t.prototype._unsubscribeAndRecycle=function(){var e=this._parent,t=this._parents;return this._parent=null,this._parents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parent=e,this._parents=t,this},t}(a.a),E=function(e){function t(t,r,_,a){var i;e.call(this),this._parentSubscriber=t;var s=this;Object(n.a)(r)?i=r:r&&(i=r.next,_=r.error,a=r.complete,r!==o.a&&(s=Object.create(r),Object(n.a)(s.unsubscribe)&&this.add(s.unsubscribe.bind(s)),s.unsubscribe=this.unsubscribe.bind(this))),this._context=s,this._next=i,this._error=_,this._complete=a}return Object(_.b)(t,e),t.prototype.next=function(e){if(!this.isStopped&&this._next){var t=this._parentSubscriber;t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}},t.prototype.error=function(e){if(!this.isStopped){var t=this._parentSubscriber;if(this._error)t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else{if(!t.syncErrorThrowable)throw this.unsubscribe(),e;t.syncErrorValue=e,t.syncErrorThrown=!0,this.unsubscribe()}}},t.prototype.complete=function(){var e=this;if(!this.isStopped){var t=this._parentSubscriber;if(this._complete){var r=function(){return e._complete.call(e._context)};t.syncErrorThrowable?(this.__tryOrSetError(t,r),this.unsubscribe()):(this.__tryOrUnsub(r),this.unsubscribe())}else this.unsubscribe()}},t.prototype.__tryOrUnsub=function(e,t){try{e.call(this._context,t)}catch(e){throw this.unsubscribe(),e}},t.prototype.__tryOrSetError=function(e,t,r){try{t.call(this._context,r)}catch(t){return e.syncErrorValue=t,e.syncErrorThrown=!0,!0}return!1},t.prototype._unsubscribe=function(){var e=this._parentSubscriber;this._context=null,this._parentSubscriber=null,e.unsubscribe()},t}(s)},PIsA:function(e,t,r){"use strict";var _=r("AMGY"),n=r("N4j0"),a=r("cQXm"),o=r("dgOU"),i=r("YaPU"),s=r("etqZ"),E=r("TToO"),c=function(e){function t(t,r,_){e.call(this),this.parent=t,this.outerValue=r,this.outerIndex=_,this.index=0}return Object(E.b)(t,e),t.prototype._next=function(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this.index++,this)},t.prototype._error=function(e){this.parent.notifyError(e,this),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},t}(r("OVmG").a),l=r("+CnV");t.a=function(e,t,r,E){var T=new c(e,r,E);if(T.closed)return null;if(t instanceof i.a)return t._isScalar?(T.next(t.value),T.complete(),null):(T.syncErrorThrowable=!0,t.subscribe(T));if(Object(n.a)(t)){for(var u=0,d=t.length;u<d&&!T.closed;u++)T.next(t[u]);T.closed||T.complete()}else{if(Object(a.a)(t))return t.then(function(e){T.closed||(T.next(e),T.complete())},function(e){return T.error(e)}).then(null,function(e){_.a.setTimeout(function(){throw e})}),T;if(t&&"function"==typeof t[s.a])for(var f=t[s.a]();;){var P=f.next();if(P.done){T.complete();break}if(T.next(P.value),T.closed)break}else if(t&&"function"==typeof t[l.a]){var A=t[l.a]();if("function"==typeof A.subscribe)return A.subscribe(new c(e,r,E));T.error(new TypeError("Provided object does not correctly implement Symbol.observable"))}else{var S=Object(o.a)(t)?"an invalid object":"'"+t+"'";T.error(new TypeError("You provided "+S+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable."))}}return null}},Rf9G:function(e,t,r){"use strict";var _=r("Jwyl"),n=r("0P3J"),a=r("g5jc");function o(){return new a.a}t.a=function(){return Object(n.a)()(Object(_.a)(o)(this))}},TILf:function(e,t,r){"use strict";r.d(t,"a",function(){return n});var _=r("TToO"),n=function(e){function t(t,r){e.call(this),this.value=t,this.scheduler=r,this._isScalar=!0,r&&(this._isScalar=!1)}return Object(_.b)(t,e),t.create=function(e,r){return new t(e,r)},t.dispatch=function(e){var t=e.value,r=e.subscriber;e.done?r.complete():(r.next(t),r.closed||(e.done=!0,this.schedule(e)))},t.prototype._subscribe=function(e){var r=this.value,_=this.scheduler;if(_)return _.schedule(t.dispatch,0,{done:!1,value:r,subscriber:e});e.next(r),e.closed||e.complete()},t}(r("YaPU").a)},TToO:function(e,t,r){"use strict";t.b=function(e,t){function r(){this.constructor=e}_(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},r.d(t,"a",function(){return n});var _=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},n=Object.assign||function(e){for(var t,r=1,_=arguments.length;r<_;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}},Veqx:function(e,t,r){"use strict";r.d(t,"a",function(){return s});var _=r("TToO"),n=r("YaPU"),a=r("TILf"),o=r("+3/4"),i=r("1Q68"),s=function(e){function t(t,r){e.call(this),this.array=t,this.scheduler=r,r||1!==t.length||(this._isScalar=!0,this.value=t[0])}return Object(_.b)(t,e),t.create=function(e,r){return new t(e,r)},t.of=function(){for(var e=[],r=0;r<arguments.length;r++)e[r-0]=arguments[r];var _=e[e.length-1];Object(i.a)(_)?e.pop():_=null;var n=e.length;return n>1?new t(e,_):1===n?new a.a(e[0],_):new o.a(_)},t.dispatch=function(e){var t=e.array,r=e.index,_=e.subscriber;r>=e.count?_.complete():(_.next(t[r]),_.closed||(e.index=r+1,this.schedule(e)))},t.prototype._subscribe=function(e){var r=this.array,_=r.length,n=this.scheduler;if(n)return n.schedule(t.dispatch,0,{array:r,index:0,count:_,subscriber:e});for(var a=0;a<_&&!e.closed;a++)e.next(r[a]);e.complete()},t}(n.a)},VwZZ:function(e,t,r){"use strict";var _=r("BX3T"),n=r("dgOU"),a=r("/iUD"),o=r("GK6M"),i=r("fKB6"),s=r("TToO"),E=function(e){function t(t){e.call(this),this.errors=t;var r=Error.call(this,t?t.length+" errors occurred during unsubscription:\n  "+t.map(function(e,t){return t+1+") "+e.toString()}).join("\n  "):"");this.name=r.name="UnsubscriptionError",this.stack=r.stack,this.message=r.message}return Object(s.b)(t,e),t}(Error);r.d(t,"a",function(){return c});var c=function(){function e(e){this.closed=!1,this._parent=null,this._parents=null,this._subscriptions=null,e&&(this._unsubscribe=e)}var t;return e.prototype.unsubscribe=function(){var e,t=!1;if(!this.closed){var r=this._parent,s=this._parents,c=this._unsubscribe,T=this._subscriptions;this.closed=!0,this._parent=null,this._parents=null,this._subscriptions=null;for(var u=-1,d=s?s.length:0;r;)r.remove(this),r=++u<d&&s[u]||null;if(Object(a.a)(c)&&Object(o.a)(c).call(this)===i.a&&(t=!0,e=e||(i.a.e instanceof E?l(i.a.e.errors):[i.a.e])),Object(_.a)(T))for(u=-1,d=T.length;++u<d;){var f=T[u];if(Object(n.a)(f)&&Object(o.a)(f.unsubscribe).call(f)===i.a){t=!0,e=e||[];var P=i.a.e;P instanceof E?e=e.concat(l(P.errors)):e.push(P)}}if(t)throw new E(e)}},e.prototype.add=function(t){if(!t||t===e.EMPTY)return e.EMPTY;if(t===this)return this;var r=t;switch(typeof t){case"function":r=new e(t);case"object":if(r.closed||"function"!=typeof r.unsubscribe)return r;if(this.closed)return r.unsubscribe(),r;if("function"!=typeof r._addParent){var _=r;(r=new e)._subscriptions=[_]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}return(this._subscriptions||(this._subscriptions=[])).push(r),r._addParent(this),r},e.prototype.remove=function(e){var t=this._subscriptions;if(t){var r=t.indexOf(e);-1!==r&&t.splice(r,1)}},e.prototype._addParent=function(e){var t=this._parent,r=this._parents;t&&t!==e?r?-1===r.indexOf(e)&&r.push(e):this._parents=[e]:this._parent=e},e.EMPTY=((t=new e).closed=!0,t),e}();function l(e){return e.reduce(function(e,t){return e.concat(t instanceof E?t.errors:t)},[])}},W2nU:function(e,t){var r,_,n=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function i(e){if(r===setTimeout)return setTimeout(e,0);if((r===a||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:a}catch(e){r=a}try{_="function"==typeof clearTimeout?clearTimeout:o}catch(e){_=o}}();var s,E=[],c=!1,l=-1;function T(){c&&s&&(c=!1,s.length?E=s.concat(E):l=-1,E.length&&u())}function u(){if(!c){var e=i(T);c=!0;for(var t=E.length;t;){for(s=E,E=[];++l<t;)s&&s[l].run();l=-1,t=E.length}s=null,c=!1,function(e){if(_===clearTimeout)return clearTimeout(e);if((_===o||!_)&&clearTimeout)return _=clearTimeout,clearTimeout(e);try{_(e)}catch(t){try{return _.call(null,e)}catch(t){return _.call(this,e)}}}(e)}}function d(e,t){this.fun=e,this.array=t}function f(){}n.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];E.push(new d(e,t)),1!==E.length||c||i(u)},d.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=f,n.addListener=f,n.once=f,n.off=f,n.removeListener=f,n.removeAllListeners=f,n.emit=f,n.prependListener=f,n.prependOnceListener=f,n.listeners=function(e){return[]},n.binding=function(e){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(e){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},WT6e:function(e,t,r){"use strict";(function(e){r.d(t,"e",function(){return Je}),r.d(t,"E",function(){return He}),r.d(t,"G",function(){return Qe}),r.d(t,"D",function(){return Ve}),r.d(t,"q",function(){return ze}),r.d(t,"a",function(){return ne}),r.d(t,"u",function(){return ie}),r.d(t,"t",function(){return se}),r.d(t,"b",function(){return re}),r.d(t,"c",function(){return _e}),r.d(t,"F",function(){return Et}),r.d(t,"z",function(){return Ce}),r.d(t,"I",function(){return Fe}),r.d(t,"o",function(){return xt}),r.d(t,"d",function(){return Ct}),r.d(t,"i",function(){return be}),r.d(t,"h",function(){return $}),r.d(t,"x",function(){return Ft}),r.d(t,"y",function(){return Dt}),r.d(t,"B",function(){return T}),r.d(t,"A",function(){return u}),r.d(t,"l",function(){return y}),r.d(t,"k",function(){return E}),r.d(t,"j",function(){return f}),r.d(t,"s",function(){return P}),r.d(t,"r",function(){return Ye}),r.d(t,"v",function(){return $e}),r.d(t,"w",function(){return et}),r.d(t,"f",function(){return Te}),r.d(t,"g",function(){return me}),r.d(t,"p",function(){return Ne}),r.d(t,"m",function(){return Rt}),r.d(t,"n",function(){return It}),r.d(t,"C",function(){return Tt}),r.d(t,"H",function(){return Mt}),r.d(t,"S",function(){return dt}),r.d(t,"K",function(){return ce}),r.d(t,"J",function(){return Oe}),r.d(t,"Q",function(){return O}),r.d(t,"_0",function(){return I}),r.d(t,"T",function(){return te}),r.d(t,"U",function(){return ee}),r.d(t,"L",function(){return Qr}),r.d(t,"M",function(){return Kn}),r.d(t,"N",function(){return tr}),r.d(t,"O",function(){return u_}),r.d(t,"P",function(){return Ir}),r.d(t,"V",function(){return Cr}),r.d(t,"W",function(){return Ur}),r.d(t,"_1",function(){return w_}),r.d(t,"X",function(){return yt}),r.d(t,"Y",function(){return wt}),r.d(t,"Z",function(){return Ut}),r.d(t,"R",function(){return ae});var _=r("TToO"),n=r("YaPU"),a=r("/nXB"),o=r("Rf9G"),i=r("g5jc"),s=r("VwZZ"),E=function(){function e(e){this._desc=e,this.ngMetadataName="InjectionToken"}return e.prototype.toString=function(){return"InjectionToken "+this._desc},e}(),c="__paramaters__";function l(e,t,r){var _=function(e){return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];if(e){var _=e.apply(void 0,t);for(var n in _)this[n]=_[n]}}}(t);function n(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(this instanceof n)return _.apply(this,e),this;var r,a=new((r=n).bind.apply(r,[void 0].concat(e)));return o.annotation=a,o;function o(e,t,r){for(var _=e.hasOwnProperty(c)?e[c]:Object.defineProperty(e,c,{value:[]})[c];_.length<=r;)_.push(null);return(_[r]=_[r]||[]).push(a),e}}return r&&(n.prototype=Object.create(r.prototype)),n.prototype.ngMetadataName=e,n.annotationCls=n,n}var T=function(){var e={Emulated:0,Native:1,None:2};return e[e.Emulated]="Emulated",e[e.Native]="Native",e[e.None]="None",e}(),u=function(e){this.full=e,this.major=e.split(".")[0],this.minor=e.split(".")[1],this.patch=e.split(".").slice(2).join(".")},d=new u("5.2.6"),f=l("Inject",function(e){return{token:e}}),P=l("Optional"),A=l("Self"),S=l("SkipSelf"),p="undefined"!=typeof window&&window,m="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,O=p||"undefined"!=typeof e&&e||m,v=Promise.resolve(0),N=null;function g(){if(!N){var e=O.Symbol;if(e&&e.iterator)N=e.iterator;else for(var t=Object.getOwnPropertyNames(Map.prototype),r=0;r<t.length;++r){var _=t[r];"entries"!==_&&"size"!==_&&Map.prototype[_]===Map.prototype.entries&&(N=_)}}return N}function h(e){"undefined"==typeof Zone?v.then(function(){e&&e.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",e)}function R(e,t){return e===t||"number"==typeof e&&"number"==typeof t&&isNaN(e)&&isNaN(t)}function I(e){if("string"==typeof e)return e;if(e instanceof Array)return"["+e.map(I).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return""+e.overriddenName;if(e.name)return""+e.name;var t=e.toString();if(null==t)return""+t;var r=t.indexOf("\n");return-1===r?t:t.substring(0,r)}function b(e){return e.__forward_ref__=b,e.toString=function(){return I(this())},e}function Y(e){return"function"==typeof e&&e.hasOwnProperty("__forward_ref__")&&e.__forward_ref__===b?e():e}var L="__source",M=new Object,x=function(){function e(){}return e.prototype.get=function(e,t){if(void 0===t&&(t=M),t===M)throw new Error("NullInjectorError: No provider for "+I(e)+"!");return t},e}(),y=function(){function e(){}return e.create=function(e,t){return Array.isArray(e)?new X(e,t):new X(e.providers,e.parent,e.name||null)},e.THROW_IF_NOT_FOUND=M,e.NULL=new x,e}(),w=function(e){return e},U=[],C=w,D=function(){return Array.prototype.slice.call(arguments)},F={},G=function(e){for(var t in e)if(e[t]===F)return t;throw Error("!prop")}({provide:String,useValue:F}),k=y.NULL,K=/\n/gm,B="\u0275",X=function(){function e(e,t,r){void 0===t&&(t=k),void 0===r&&(r=null),this.parent=t,this.source=r;var _=this._records=new Map;_.set(y,{token:y,fn:w,deps:U,value:this,useNew:!1}),function e(t,r){if(r)if((r=Y(r))instanceof Array)for(var _=0;_<r.length;_++)e(t,r[_]);else{if("function"==typeof r)throw z("Function/Class not supported",r);if(!r||"object"!=typeof r||!r.provide)throw z("Unexpected provider",r);var n=Y(r.provide),a=function(e){var t=function(e){var t=U,r=e.deps;if(r&&r.length){t=[];for(var _=0;_<r.length;_++){var n=6;if((s=Y(r[_]))instanceof Array)for(var a=0,o=s;a<o.length;a++){var i=o[a];i instanceof P||i==P?n|=1:i instanceof S||i==S?n&=-3:i instanceof A||i==A?n&=-5:s=i instanceof f?i.token:Y(i)}t.push({token:s,options:n})}}else if(e.useExisting){var s;t=[{token:s=Y(e.useExisting),options:6}]}else if(!(r||G in e))throw z("'deps' required",e);return t}(e),r=w,_=U,n=!1,a=Y(e.provide);if(G in e)_=e.useValue;else if(e.useFactory)r=e.useFactory;else if(e.useExisting);else if(e.useClass)n=!0,r=Y(e.useClass);else{if("function"!=typeof a)throw z("StaticProvider does not have [useValue|useFactory|useExisting|useClass] or [provide] is not newable",e);n=!0,r=a}return{deps:t,fn:r,useNew:n,value:_}}(r);if(!0===r.multi){var o=t.get(n);if(o){if(o.fn!==D)throw H(n)}else t.set(n,o={token:r.provide,deps:[],useNew:!1,fn:D,value:U});o.deps.push({token:n=r,options:6})}var i=t.get(n);if(i&&i.fn==D)throw H(n);t.set(n,a)}}(_,e)}return e.prototype.get=function(e,t){var r=this._records.get(e);try{return function e(t,r,_,n,a){try{return function(t,r,_,n,a){var o,i;if(r){if((o=r.value)==C)throw Error(B+"Circular dependency");if(o===U){r.value=C;var s=r.useNew,E=r.fn,c=r.deps,l=U;if(c.length){l=[];for(var T=0;T<c.length;T++){var u=c[T],d=u.options,f=2&d?_.get(u.token):void 0;l.push(e(u.token,f,_,f||4&d?n:k,1&d?null:y.THROW_IF_NOT_FOUND))}}r.value=o=s?new((i=E).bind.apply(i,[void 0].concat(l))):E.apply(void 0,l)}}else o=n.get(t,a);return o}(t,r,_,n,a)}catch(e){throw e instanceof Error||(e=new Error(e)),(e.ngTempTokenPath=e.ngTempTokenPath||[]).unshift(t),r&&r.value==C&&(r.value=U),e}}(e,r,this._records,this.parent,t)}catch(t){var _=t.ngTempTokenPath;throw e[L]&&_.unshift(e[L]),t.message=Q("\n"+t.message,_,this.source),t.ngTokenPath=_,t.ngTempTokenPath=null,t}},e.prototype.toString=function(){var e=[];return this._records.forEach(function(t,r){return e.push(I(r))}),"StaticInjector["+e.join(", ")+"]"},e}();function H(e){return z("Cannot mix multi providers and regular providers",e)}function Q(e,t,r){void 0===r&&(r=null),e=e&&"\n"===e.charAt(0)&&e.charAt(1)==B?e.substr(2):e;var _=I(t);if(t instanceof Array)_=t.map(I).join(" -> ");else if("object"==typeof t){var n=[];for(var a in t)if(t.hasOwnProperty(a)){var o=t[a];n.push(a+":"+("string"==typeof o?JSON.stringify(o):I(o)))}_="{"+n.join(", ")+"}"}return"StaticInjectorError"+(r?"("+r+")":"")+"["+_+"]: "+e.replace(K,"\n  ")}function z(e,t){return new Error(Q(e,t))}var V="ngDebugContext",j="ngOriginalError",q="ngErrorLogger";function W(e){return e[V]}function J(e){return e[j]}function Z(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];e.error.apply(e,t)}var $=function(){function e(){this._console=console}return e.prototype.handleError=function(e){var t=this._findOriginalError(e),r=this._findContext(e),_=function(e){return e[q]||Z}(e);_(this._console,"ERROR",e),t&&_(this._console,"ORIGINAL ERROR",t),r&&_(this._console,"ERROR CONTEXT",r)},e.prototype._findContext=function(e){return e?W(e)?W(e):this._findContext(J(e)):null},e.prototype._findOriginalError=function(e){for(var t=J(e);t&&J(t);)t=J(t);return t},e}();function ee(e){return!!e&&"function"==typeof e.then}function te(e){return!!e&&"function"==typeof e.subscribe}Function;var re=new E("Application Initializer"),_e=function(){function e(e){var t=this;this.appInits=e,this.initialized=!1,this.done=!1,this.donePromise=new Promise(function(e,r){t.resolve=e,t.reject=r})}return e.prototype.runInitializers=function(){var e=this;if(!this.initialized){var t=[],r=function(){e.done=!0,e.resolve()};if(this.appInits)for(var _=0;_<this.appInits.length;_++){var n=this.appInits[_]();ee(n)&&t.push(n)}Promise.all(t).then(function(){r()}).catch(function(t){e.reject(t)}),0===t.length&&r(),this.initialized=!0}},e}(),ne=new E("AppId");function ae(){return""+oe()+oe()+oe()}function oe(){return String.fromCharCode(97+Math.floor(25*Math.random()))}var ie=new E("Platform Initializer"),se=new E("Platform ID"),Ee=new E("appBootstrapListener"),ce=function(){function e(){}return e.prototype.log=function(e){console.log(e)},e.prototype.warn=function(e){console.warn(e)},e.ctorParameters=function(){return[]},e}();function le(){throw new Error("Runtime compiler is not loaded")}var Te=function(){function e(){}return e.prototype.compileModuleSync=function(e){throw le()},e.prototype.compileModuleAsync=function(e){throw le()},e.prototype.compileModuleAndAllComponentsSync=function(e){throw le()},e.prototype.compileModuleAndAllComponentsAsync=function(e){throw le()},e.prototype.clearCache=function(){},e.prototype.clearCacheFor=function(e){},e}(),ue=function(){},de=function(){};function fe(e){var t=Error("No component factory found for "+I(e)+". Did you add it to @NgModule.entryComponents?");return t[Se]=e,t}var Pe,Ae,Se="ngComponent",pe=function(){function e(){}return e.prototype.resolveComponentFactory=function(e){throw fe(e)},e}(),me=function(){function e(){}return e.NULL=new pe,e}(),Oe=function(){function e(e,t,r){this._parent=t,this._ngModule=r,this._factories=new Map;for(var _=0;_<e.length;_++){var n=e[_];this._factories.set(n.componentType,n)}}return e.prototype.resolveComponentFactory=function(e){var t=this._factories.get(e);if(!t&&this._parent&&(t=this._parent.resolveComponentFactory(e)),!t)throw fe(e);return new ve(t,this._ngModule)},e}(),ve=function(e){function t(t,r){var _=e.call(this)||this;return _.factory=t,_.ngModule=r,_.selector=t.selector,_.componentType=t.componentType,_.ngContentSelectors=t.ngContentSelectors,_.inputs=t.inputs,_.outputs=t.outputs,_}return Object(_.b)(t,e),t.prototype.create=function(e,t,r,_){return this.factory.create(e,t,r,_||this.ngModule)},t}(de),Ne=function(){},ge=function(){var e=O.wtf;return!(!e||!(Pe=e.trace)||(Ae=Pe.events,0))}();function he(e,t){return null}var Re=ge?function(e,t){return void 0===t&&(t=null),Ae.createScope(e,t)}:function(e,t){return he},Ie=ge?function(e,t){return Pe.leaveScope(e,t),t}:function(e,t){return t},be=function(e){function t(t){void 0===t&&(t=!1);var r=e.call(this)||this;return r.__isAsync=t,r}return Object(_.b)(t,e),t.prototype.emit=function(t){e.prototype.next.call(this,t)},t.prototype.subscribe=function(t,r,_){var n,a=function(e){return null},o=function(){return null};t&&"object"==typeof t?(n=this.__isAsync?function(e){setTimeout(function(){return t.next(e)})}:function(e){t.next(e)},t.error&&(a=this.__isAsync?function(e){setTimeout(function(){return t.error(e)})}:function(e){t.error(e)}),t.complete&&(o=this.__isAsync?function(){setTimeout(function(){return t.complete()})}:function(){t.complete()})):(n=this.__isAsync?function(e){setTimeout(function(){return t(e)})}:function(e){t(e)},r&&(a=this.__isAsync?function(e){setTimeout(function(){return r(e)})}:function(e){r(e)}),_&&(o=this.__isAsync?function(){setTimeout(function(){return _()})}:function(){_()}));var i=e.prototype.subscribe.call(this,n,a,o);return t instanceof s.a&&t.add(i),i},t}(i.a),Ye=function(){function e(e){var t,r=e.enableLongStackTrace,_=void 0!==r&&r;if(this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new be(!1),this.onMicrotaskEmpty=new be(!1),this.onStable=new be(!1),this.onError=new be(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched(),this._nesting=0,this._outer=this._inner=Zone.current,Zone.wtfZoneSpec&&(this._inner=this._inner.fork(Zone.wtfZoneSpec)),_&&Zone.longStackTraceZoneSpec&&(this._inner=this._inner.fork(Zone.longStackTraceZoneSpec)),(t=this)._inner=t._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:function(e,r,_,n,a,o){try{return ye(t),e.invokeTask(_,n,a,o)}finally{we(t)}},onInvoke:function(e,r,_,n,a,o,i){try{return ye(t),e.invoke(_,n,a,o,i)}finally{we(t)}},onHasTask:function(e,r,_,n){e.hasTask(_,n),r===_&&("microTask"==n.change?(t.hasPendingMicrotasks=n.microTask,xe(t)):"macroTask"==n.change&&(t.hasPendingMacrotasks=n.macroTask))},onHandleError:function(e,r,_,n){return e.handleError(_,n),t.runOutsideAngular(function(){return t.onError.emit(n)}),!1}})}return e.isInAngularZone=function(){return!0===Zone.current.get("isAngularZone")},e.assertInAngularZone=function(){if(!e.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")},e.assertNotInAngularZone=function(){if(e.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")},e.prototype.run=function(e,t,r){return this._inner.run(e,t,r)},e.prototype.runTask=function(e,t,r,_){var n=this._inner,a=n.scheduleEventTask("NgZoneEvent: "+_,e,Me,Le,Le);try{return n.runTask(a,t,r)}finally{n.cancelTask(a)}},e.prototype.runGuarded=function(e,t,r){return this._inner.runGuarded(e,t,r)},e.prototype.runOutsideAngular=function(e){return this._outer.run(e)},e}();function Le(){}var Me={};function xe(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(function(){return e.onStable.emit(null)})}finally{e.isStable=!0}}}function ye(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function we(e){e._nesting--,xe(e)}var Ue=function(){function e(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new be,this.onMicrotaskEmpty=new be,this.onStable=new be,this.onError=new be}return e.prototype.run=function(e){return e()},e.prototype.runGuarded=function(e){return e()},e.prototype.runOutsideAngular=function(e){return e()},e.prototype.runTask=function(e){return e()},e}(),Ce=function(){function e(e){this._ngZone=e,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this._watchAngularEvents()}return e.prototype._watchAngularEvents=function(){var e=this;this._ngZone.onUnstable.subscribe({next:function(){e._didWork=!0,e._isZoneStable=!1}}),this._ngZone.runOutsideAngular(function(){e._ngZone.onStable.subscribe({next:function(){Ye.assertNotInAngularZone(),h(function(){e._isZoneStable=!0,e._runCallbacksIfReady()})}})})},e.prototype.increasePendingRequestCount=function(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount},e.prototype.decreasePendingRequestCount=function(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount},e.prototype.isStable=function(){return this._isZoneStable&&0==this._pendingCount&&!this._ngZone.hasPendingMacrotasks},e.prototype._runCallbacksIfReady=function(){var e=this;this.isStable()?h(function(){for(;0!==e._callbacks.length;)e._callbacks.pop()(e._didWork);e._didWork=!1}):this._didWork=!0},e.prototype.whenStable=function(e){this._callbacks.push(e),this._runCallbacksIfReady()},e.prototype.getPendingRequestCount=function(){return this._pendingCount},e.prototype.findProviders=function(e,t,r){return[]},e}(),De=function(){function e(){this._applications=new Map,ke.addToWindow(this)}return e.prototype.registerApplication=function(e,t){this._applications.set(e,t)},e.prototype.unregisterApplication=function(e){this._applications.delete(e)},e.prototype.unregisterAllApplications=function(){this._applications.clear()},e.prototype.getTestability=function(e){return this._applications.get(e)||null},e.prototype.getAllTestabilities=function(){return Array.from(this._applications.values())},e.prototype.getAllRootElements=function(){return Array.from(this._applications.keys())},e.prototype.findTestabilityInTree=function(e,t){return void 0===t&&(t=!0),ke.findTestabilityInTree(this,e,t)},e.ctorParameters=function(){return[]},e}();function Fe(e){ke=e}var Ge,ke=new(function(){function e(){}return e.prototype.addToWindow=function(e){},e.prototype.findTestabilityInTree=function(e,t,r){return null},e}()),Ke=!0,Be=!1,Xe=new E("AllowMultipleToken");function He(){if(Be)throw new Error("Cannot enable prod mode after platform setup.");Ke=!1}function Qe(){return Be=!0,Ke}var ze=function(e,t){this.name=e,this.token=t};function Ve(e,t,r){void 0===r&&(r=[]);var _="Platform: "+t,n=new E(_);return function(t){void 0===t&&(t=[]);var a=je();if(!a||a.injector.get(Xe,!1))if(e)e(r.concat(t).concat({provide:n,useValue:!0}));else{var o=r.concat(t).concat({provide:n,useValue:!0});!function(e){if(Ge&&!Ge.destroyed&&!Ge.injector.get(Xe,!1))throw new Error("There can be only one platform. Destroy the previous one to create a new one.");Ge=e.get(qe);var t=e.get(ie,null);t&&t.forEach(function(e){return e()})}(y.create({providers:o,name:_}))}return function(e){var t=je();if(!t)throw new Error("No platform exists!");if(!t.injector.get(e,null))throw new Error("A platform with a different configuration has been created. Please destroy it first.");return t}(n)}}function je(){return Ge&&!Ge.destroyed?Ge:null}var qe=function(){function e(e){this._injector=e,this._modules=[],this._destroyListeners=[],this._destroyed=!1}return e.prototype.bootstrapModuleFactory=function(e,t){var r,_=this,n="noop"===(r=t?t.ngZone:void 0)?new Ue:("zone.js"===r?void 0:r)||new Ye({enableLongStackTrace:Qe()}),a=[{provide:Ye,useValue:n}];return n.run(function(){var t=y.create({providers:a,parent:_.injector,name:e.moduleType.name}),r=e.create(t),o=r.injector.get($,null);if(!o)throw new Error("No ErrorHandler. Is platform module (BrowserModule) included?");return r.onDestroy(function(){return Ze(_._modules,r)}),n.runOutsideAngular(function(){return n.onError.subscribe({next:function(e){o.handleError(e)}})}),function(e,t,n){try{var a=((o=r.injector.get(_e)).runInitializers(),o.donePromise.then(function(){return _._moduleDoBootstrap(r),r}));return ee(a)?a.catch(function(r){throw t.runOutsideAngular(function(){return e.handleError(r)}),r}):a}catch(r){throw t.runOutsideAngular(function(){return e.handleError(r)}),r}var o}(o,n)})},e.prototype.bootstrapModule=function(e,t){var r=this;void 0===t&&(t=[]);var _=this.injector.get(ue),n=We({},t);return _.createCompiler([n]).compileModuleAsync(e).then(function(e){return r.bootstrapModuleFactory(e,n)})},e.prototype._moduleDoBootstrap=function(e){var t=e.injector.get(Je);if(e._bootstrapComponents.length>0)e._bootstrapComponents.forEach(function(e){return t.bootstrap(e)});else{if(!e.instance.ngDoBootstrap)throw new Error("The module "+I(e.instance.constructor)+' was bootstrapped, but it does not declare "@NgModule.bootstrap" components nor a "ngDoBootstrap" method. Please define one of these.');e.instance.ngDoBootstrap(t)}this._modules.push(e)},e.prototype.onDestroy=function(e){this._destroyListeners.push(e)},Object.defineProperty(e.prototype,"injector",{get:function(){return this._injector},enumerable:!0,configurable:!0}),e.prototype.destroy=function(){if(this._destroyed)throw new Error("The platform has already been destroyed!");this._modules.slice().forEach(function(e){return e.destroy()}),this._destroyListeners.forEach(function(e){return e()}),this._destroyed=!0},Object.defineProperty(e.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!0,configurable:!0}),e}();function We(e,t){return Array.isArray(t)?t.reduce(We,e):Object(_.a)({},e,t)}var Je=function(){function e(e,t,r,_,i,s){var E=this;this._zone=e,this._console=t,this._injector=r,this._exceptionHandler=_,this._componentFactoryResolver=i,this._initStatus=s,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._enforceNoNewChanges=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._enforceNoNewChanges=Qe(),this._zone.onMicrotaskEmpty.subscribe({next:function(){E._zone.run(function(){E.tick()})}});var c=new n.a(function(e){E._stable=E._zone.isStable&&!E._zone.hasPendingMacrotasks&&!E._zone.hasPendingMicrotasks,E._zone.runOutsideAngular(function(){e.next(E._stable),e.complete()})}),l=new n.a(function(e){var t;E._zone.runOutsideAngular(function(){t=E._zone.onStable.subscribe(function(){Ye.assertNotInAngularZone(),h(function(){E._stable||E._zone.hasPendingMacrotasks||E._zone.hasPendingMicrotasks||(E._stable=!0,e.next(!0))})})});var r=E._zone.onUnstable.subscribe(function(){Ye.assertInAngularZone(),E._stable&&(E._stable=!1,E._zone.runOutsideAngular(function(){e.next(!1)}))});return function(){t.unsubscribe(),r.unsubscribe()}});this.isStable=Object(a.a)(c,o.a.call(l))}return e.prototype.bootstrap=function(e,t){var r,_=this;if(!this._initStatus.done)throw new Error("Cannot bootstrap as there are still asynchronous initializers running. Bootstrap components in the `ngDoBootstrap` method of the root module.");r=e instanceof de?e:this._componentFactoryResolver.resolveComponentFactory(e),this.componentTypes.push(r.componentType);var n=r instanceof ve?null:this._injector.get(Ne),a=r.create(y.NULL,[],t||r.selector,n);a.onDestroy(function(){_._unloadComponent(a)});var o=a.injector.get(Ce,null);return o&&a.injector.get(De).registerApplication(a.location.nativeElement,o),this._loadComponent(a),Qe()&&this._console.log("Angular is running in the development mode. Call enableProdMode() to enable the production mode."),a},e.prototype.tick=function(){var t=this;if(this._runningTick)throw new Error("ApplicationRef.tick is called recursively");var r=e._tickScope();try{this._runningTick=!0,this._views.forEach(function(e){return e.detectChanges()}),this._enforceNoNewChanges&&this._views.forEach(function(e){return e.checkNoChanges()})}catch(e){this._zone.runOutsideAngular(function(){return t._exceptionHandler.handleError(e)})}finally{this._runningTick=!1,Ie(r)}},e.prototype.attachView=function(e){var t=e;this._views.push(t),t.attachToAppRef(this)},e.prototype.detachView=function(e){var t=e;Ze(this._views,t),t.detachFromAppRef()},e.prototype._loadComponent=function(e){this.attachView(e.hostView),this.tick(),this.components.push(e),this._injector.get(Ee,[]).concat(this._bootstrapListeners).forEach(function(t){return t(e)})},e.prototype._unloadComponent=function(e){this.detachView(e.hostView),Ze(this.components,e)},e.prototype.ngOnDestroy=function(){this._views.slice().forEach(function(e){return e.destroy()})},Object.defineProperty(e.prototype,"viewCount",{get:function(){return this._views.length},enumerable:!0,configurable:!0}),e._tickScope=Re("ApplicationRef#tick()"),e}();function Ze(e,t){var r=e.indexOf(t);r>-1&&e.splice(r,1)}var $e=function(){},et=function(){var e={Important:1,DashCase:2};return e[e.Important]="Important",e[e.DashCase]="DashCase",e}(),tt=function(e){this.nativeElement=e},rt=function(){function e(){this.dirty=!0,this._results=[],this.changes=new be,this.length=0}return e.prototype.map=function(e){return this._results.map(e)},e.prototype.filter=function(e){return this._results.filter(e)},e.prototype.find=function(e){return this._results.find(e)},e.prototype.reduce=function(e,t){return this._results.reduce(e,t)},e.prototype.forEach=function(e){this._results.forEach(e)},e.prototype.some=function(e){return this._results.some(e)},e.prototype.toArray=function(){return this._results.slice()},e.prototype[g()]=function(){return this._results[g()]()},e.prototype.toString=function(){return this._results.toString()},e.prototype.reset=function(e){this._results=function e(t){return t.reduce(function(t,r){var _=Array.isArray(r)?e(r):r;return t.concat(_)},[])}(e),this.dirty=!1,this.length=this._results.length,this.last=this._results[this.length-1],this.first=this._results[0]},e.prototype.notifyOnChanges=function(){this.changes.emit(this)},e.prototype.setDirty=function(){this.dirty=!0},e.prototype.destroy=function(){this.changes.complete(),this.changes.unsubscribe()},e}(),_t=function(){},nt=function(){function e(e,t,r){this._debugContext=r,this.nativeNode=e,t&&t instanceof at?t.addChild(this):this.parent=null,this.listeners=[]}return Object.defineProperty(e.prototype,"injector",{get:function(){return this._debugContext.injector},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"componentInstance",{get:function(){return this._debugContext.component},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"context",{get:function(){return this._debugContext.context},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"references",{get:function(){return this._debugContext.references},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"providerTokens",{get:function(){return this._debugContext.providerTokens},enumerable:!0,configurable:!0}),e}(),at=function(e){function t(t,r,_){var n=e.call(this,t,r,_)||this;return n.properties={},n.attributes={},n.classes={},n.styles={},n.childNodes=[],n.nativeElement=t,n}return Object(_.b)(t,e),t.prototype.addChild=function(e){e&&(this.childNodes.push(e),e.parent=this)},t.prototype.removeChild=function(e){var t=this.childNodes.indexOf(e);-1!==t&&(e.parent=null,this.childNodes.splice(t,1))},t.prototype.insertChildrenAfter=function(e,t){var r,_=this,n=this.childNodes.indexOf(e);-1!==n&&((r=this.childNodes).splice.apply(r,[n+1,0].concat(t)),t.forEach(function(e){e.parent&&e.parent.removeChild(e),e.parent=_}))},t.prototype.insertBefore=function(e,t){var r=this.childNodes.indexOf(e);-1===r?this.addChild(t):(t.parent&&t.parent.removeChild(t),t.parent=this,this.childNodes.splice(r,0,t))},t.prototype.query=function(e){return this.queryAll(e)[0]||null},t.prototype.queryAll=function(e){var t=[];return ot(this,e,t),t},t.prototype.queryAllNodes=function(e){var t=[];return it(this,e,t),t},Object.defineProperty(t.prototype,"children",{get:function(){return this.childNodes.filter(function(e){return e instanceof t})},enumerable:!0,configurable:!0}),t.prototype.triggerEventHandler=function(e,t){this.listeners.forEach(function(r){r.name==e&&r.callback(t)})},t}(nt);function ot(e,t,r){e.childNodes.forEach(function(e){e instanceof at&&(t(e)&&r.push(e),ot(e,t,r))})}function it(e,t,r){e instanceof at&&e.childNodes.forEach(function(e){t(e)&&r.push(e),e instanceof at&&it(e,t,r)})}var st=new Map;function Et(e){return st.get(e)||null}function ct(e){st.set(e.nativeNode,e)}function lt(e,t){var r=dt(e),_=dt(t);return r&&_?function(e,t,r){for(var _=e[g()](),n=t[g()]();;){var a=_.next(),o=n.next();if(a.done&&o.done)return!0;if(a.done||o.done)return!1;if(!r(a.value,o.value))return!1}}(e,t,lt):!(r||!e||"object"!=typeof e&&"function"!=typeof e||_||!t||"object"!=typeof t&&"function"!=typeof t)||R(e,t)}var Tt=function(){function e(e){this.wrapped=e}return e.wrap=function(t){return new e(t)},e.unwrap=function(t){return e.isWrapped(t)?t.wrapped:t},e.isWrapped=function(t){return t instanceof e},e}(),ut=function(){function e(e,t,r){this.previousValue=e,this.currentValue=t,this.firstChange=r}return e.prototype.isFirstChange=function(){return this.firstChange},e}();function dt(e){return!!ft(e)&&(Array.isArray(e)||!(e instanceof Map)&&g()in e)}function ft(e){return null!==e&&("function"==typeof e||"object"==typeof e)}var Pt=function(){function e(){}return e.prototype.supports=function(e){return dt(e)},e.prototype.create=function(e){return new St(e)},e}(),At=function(e,t){return t},St=function(){function e(e){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=e||At}return e.prototype.forEachItem=function(e){var t;for(t=this._itHead;null!==t;t=t._next)e(t)},e.prototype.forEachOperation=function(e){for(var t=this._itHead,r=this._removalsHead,_=0,n=null;t||r;){var a=!r||t&&t.currentIndex<vt(r,_,n)?t:r,o=vt(a,_,n),i=a.currentIndex;if(a===r)_--,r=r._nextRemoved;else if(t=t._next,null==a.previousIndex)_++;else{n||(n=[]);var s=o-_,E=i-_;if(s!=E){for(var c=0;c<s;c++){var l=c<n.length?n[c]:n[c]=0,T=l+c;E<=T&&T<s&&(n[c]=l+1)}n[a.previousIndex]=E-s}}o!==i&&e(a,o,i)}},e.prototype.forEachPreviousItem=function(e){var t;for(t=this._previousItHead;null!==t;t=t._nextPrevious)e(t)},e.prototype.forEachAddedItem=function(e){var t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)},e.prototype.forEachMovedItem=function(e){var t;for(t=this._movesHead;null!==t;t=t._nextMoved)e(t)},e.prototype.forEachRemovedItem=function(e){var t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)},e.prototype.forEachIdentityChange=function(e){var t;for(t=this._identityChangesHead;null!==t;t=t._nextIdentityChange)e(t)},e.prototype.diff=function(e){if(null==e&&(e=[]),!dt(e))throw new Error("Error trying to diff '"+I(e)+"'. Only arrays and iterables are allowed");return this.check(e)?this:null},e.prototype.onDestroy=function(){},e.prototype.check=function(e){var t=this;this._reset();var r,_,n,a=this._itHead,o=!1;if(Array.isArray(e)){this.length=e.length;for(var i=0;i<this.length;i++)n=this._trackByFn(i,_=e[i]),null!==a&&R(a.trackById,n)?(o&&(a=this._verifyReinsertion(a,_,n,i)),R(a.item,_)||this._addIdentityChange(a,_)):(a=this._mismatch(a,_,n,i),o=!0),a=a._next}else r=0,function(e,t){if(Array.isArray(e))for(var r=0;r<e.length;r++)t(e[r]);else for(var _=e[g()](),n=void 0;!(n=_.next()).done;)t(n.value)}(e,function(e){n=t._trackByFn(r,e),null!==a&&R(a.trackById,n)?(o&&(a=t._verifyReinsertion(a,e,n,r)),R(a.item,e)||t._addIdentityChange(a,e)):(a=t._mismatch(a,e,n,r),o=!0),a=a._next,r++}),this.length=r;return this._truncate(a),this.collection=e,this.isDirty},Object.defineProperty(e.prototype,"isDirty",{get:function(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead},enumerable:!0,configurable:!0}),e.prototype._reset=function(){if(this.isDirty){var e=void 0,t=void 0;for(e=this._previousItHead=this._itHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._additionsHead;null!==e;e=e._nextAdded)e.previousIndex=e.currentIndex;for(this._additionsHead=this._additionsTail=null,e=this._movesHead;null!==e;e=t)e.previousIndex=e.currentIndex,t=e._nextMoved;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}},e.prototype._mismatch=function(e,t,r,_){var n;return null===e?n=this._itTail:(n=e._prev,this._remove(e)),null!==(e=null===this._linkedRecords?null:this._linkedRecords.get(r,_))?(R(e.item,t)||this._addIdentityChange(e,t),this._moveAfter(e,n,_)):null!==(e=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null))?(R(e.item,t)||this._addIdentityChange(e,t),this._reinsertAfter(e,n,_)):e=this._addAfter(new pt(t,r),n,_),e},e.prototype._verifyReinsertion=function(e,t,r,_){var n=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null);return null!==n?e=this._reinsertAfter(n,e._prev,_):e.currentIndex!=_&&(e.currentIndex=_,this._addToMoves(e,_)),e},e.prototype._truncate=function(e){for(;null!==e;){var t=e._next;this._addToRemovals(this._unlink(e)),e=t}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)},e.prototype._reinsertAfter=function(e,t,r){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(e);var _=e._prevRemoved,n=e._nextRemoved;return null===_?this._removalsHead=n:_._nextRemoved=n,null===n?this._removalsTail=_:n._prevRemoved=_,this._insertAfter(e,t,r),this._addToMoves(e,r),e},e.prototype._moveAfter=function(e,t,r){return this._unlink(e),this._insertAfter(e,t,r),this._addToMoves(e,r),e},e.prototype._addAfter=function(e,t,r){return this._insertAfter(e,t,r),this._additionsTail=null===this._additionsTail?this._additionsHead=e:this._additionsTail._nextAdded=e,e},e.prototype._insertAfter=function(e,t,r){var _=null===t?this._itHead:t._next;return e._next=_,e._prev=t,null===_?this._itTail=e:_._prev=e,null===t?this._itHead=e:t._next=e,null===this._linkedRecords&&(this._linkedRecords=new Ot),this._linkedRecords.put(e),e.currentIndex=r,e},e.prototype._remove=function(e){return this._addToRemovals(this._unlink(e))},e.prototype._unlink=function(e){null!==this._linkedRecords&&this._linkedRecords.remove(e);var t=e._prev,r=e._next;return null===t?this._itHead=r:t._next=r,null===r?this._itTail=t:r._prev=t,e},e.prototype._addToMoves=function(e,t){return e.previousIndex===t?e:(this._movesTail=null===this._movesTail?this._movesHead=e:this._movesTail._nextMoved=e,e)},e.prototype._addToRemovals=function(e){return null===this._unlinkedRecords&&(this._unlinkedRecords=new Ot),this._unlinkedRecords.put(e),e.currentIndex=null,e._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=e,e._prevRemoved=null):(e._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=e),e},e.prototype._addIdentityChange=function(e,t){return e.item=t,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=e:this._identityChangesTail._nextIdentityChange=e,e},e}(),pt=function(e,t){this.item=e,this.trackById=t,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null},mt=function(){function e(){this._head=null,this._tail=null}return e.prototype.add=function(e){null===this._head?(this._head=this._tail=e,e._nextDup=null,e._prevDup=null):(this._tail._nextDup=e,e._prevDup=this._tail,e._nextDup=null,this._tail=e)},e.prototype.get=function(e,t){var r;for(r=this._head;null!==r;r=r._nextDup)if((null===t||t<=r.currentIndex)&&R(r.trackById,e))return r;return null},e.prototype.remove=function(e){var t=e._prevDup,r=e._nextDup;return null===t?this._head=r:t._nextDup=r,null===r?this._tail=t:r._prevDup=t,null===this._head},e}(),Ot=function(){function e(){this.map=new Map}return e.prototype.put=function(e){var t=e.trackById,r=this.map.get(t);r||(r=new mt,this.map.set(t,r)),r.add(e)},e.prototype.get=function(e,t){var r=this.map.get(e);return r?r.get(e,t):null},e.prototype.remove=function(e){var t=e.trackById;return this.map.get(t).remove(e)&&this.map.delete(t),e},Object.defineProperty(e.prototype,"isEmpty",{get:function(){return 0===this.map.size},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this.map.clear()},e}();function vt(e,t,r){var _=e.previousIndex;if(null===_)return _;var n=0;return r&&_<r.length&&(n=r[_]),_+t+n}var Nt=function(){function e(){}return e.prototype.supports=function(e){return e instanceof Map||ft(e)},e.prototype.create=function(){return new gt},e}(),gt=function(){function e(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}return Object.defineProperty(e.prototype,"isDirty",{get:function(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead},enumerable:!0,configurable:!0}),e.prototype.forEachItem=function(e){var t;for(t=this._mapHead;null!==t;t=t._next)e(t)},e.prototype.forEachPreviousItem=function(e){var t;for(t=this._previousMapHead;null!==t;t=t._nextPrevious)e(t)},e.prototype.forEachChangedItem=function(e){var t;for(t=this._changesHead;null!==t;t=t._nextChanged)e(t)},e.prototype.forEachAddedItem=function(e){var t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)},e.prototype.forEachRemovedItem=function(e){var t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)},e.prototype.diff=function(e){if(e){if(!(e instanceof Map||ft(e)))throw new Error("Error trying to diff '"+I(e)+"'. Only maps and objects are allowed")}else e=new Map;return this.check(e)?this:null},e.prototype.onDestroy=function(){},e.prototype.check=function(e){var t=this;this._reset();var r=this._mapHead;if(this._appendAfter=null,this._forEach(e,function(e,_){if(r&&r.key===_)t._maybeAddToChanges(r,e),t._appendAfter=r,r=r._next;else{var n=t._getOrCreateRecordForKey(_,e);r=t._insertBeforeOrAppend(r,n)}}),r){r._prev&&(r._prev._next=null),this._removalsHead=r;for(var _=r;null!==_;_=_._nextRemoved)_===this._mapHead&&(this._mapHead=null),this._records.delete(_.key),_._nextRemoved=_._next,_.previousValue=_.currentValue,_.currentValue=null,_._prev=null,_._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty},e.prototype._insertBeforeOrAppend=function(e,t){if(e){var r=e._prev;return t._next=e,t._prev=r,e._prev=t,r&&(r._next=t),e===this._mapHead&&(this._mapHead=t),this._appendAfter=e,e}return this._appendAfter?(this._appendAfter._next=t,t._prev=this._appendAfter):this._mapHead=t,this._appendAfter=t,null},e.prototype._getOrCreateRecordForKey=function(e,t){if(this._records.has(e)){var r=this._records.get(e);this._maybeAddToChanges(r,t);var _=r._prev,n=r._next;return _&&(_._next=n),n&&(n._prev=_),r._next=null,r._prev=null,r}var a=new ht(e);return this._records.set(e,a),a.currentValue=t,this._addToAdditions(a),a},e.prototype._reset=function(){if(this.isDirty){var e=void 0;for(this._previousMapHead=this._mapHead,e=this._previousMapHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._changesHead;null!==e;e=e._nextChanged)e.previousValue=e.currentValue;for(e=this._additionsHead;null!=e;e=e._nextAdded)e.previousValue=e.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}},e.prototype._maybeAddToChanges=function(e,t){R(t,e.currentValue)||(e.previousValue=e.currentValue,e.currentValue=t,this._addToChanges(e))},e.prototype._addToAdditions=function(e){null===this._additionsHead?this._additionsHead=this._additionsTail=e:(this._additionsTail._nextAdded=e,this._additionsTail=e)},e.prototype._addToChanges=function(e){null===this._changesHead?this._changesHead=this._changesTail=e:(this._changesTail._nextChanged=e,this._changesTail=e)},e.prototype._forEach=function(e,t){e instanceof Map?e.forEach(t):Object.keys(e).forEach(function(r){return t(e[r],r)})},e}(),ht=function(e){this.key=e,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null},Rt=function(){function e(e){this.factories=e}return e.create=function(t,r){if(null!=r){var _=r.factories.slice();return new e(t=t.concat(_))}return new e(t)},e.extend=function(t){return{provide:e,useFactory:function(r){if(!r)throw new Error("Cannot extend IterableDiffers without a parent injector");return e.create(t,r)},deps:[[e,new S,new P]]}},e.prototype.find=function(e){var t,r=this.factories.find(function(t){return t.supports(e)});if(null!=r)return r;throw new Error("Cannot find a differ supporting object '"+e+"' of type '"+((t=e).name||typeof t)+"'")},e}(),It=function(){function e(e){this.factories=e}return e.create=function(t,r){if(r){var _=r.factories.slice();t=t.concat(_)}return new e(t)},e.extend=function(t){return{provide:e,useFactory:function(r){if(!r)throw new Error("Cannot extend KeyValueDiffers without a parent injector");return e.create(t,r)},deps:[[e,new S,new P]]}},e.prototype.find=function(e){var t=this.factories.find(function(t){return t.supports(e)});if(t)return t;throw new Error("Cannot find a differ supporting object '"+e+"'")},e}(),bt=[new Nt],Yt=new Rt([new Pt]),Lt=new It(bt),Mt=Ve(null,"core",[{provide:se,useValue:"unknown"},{provide:qe,deps:[y]},{provide:De,deps:[]},{provide:ce,deps:[]}]),xt=new E("LocaleId");function yt(){return Yt}function wt(){return Lt}function Ut(e){return e||"en-US"}var Ct=function(e){},Dt=function(){var e={NONE:0,HTML:1,STYLE:2,SCRIPT:3,URL:4,RESOURCE_URL:5};return e[e.NONE]="NONE",e[e.HTML]="HTML",e[e.STYLE]="STYLE",e[e.SCRIPT]="SCRIPT",e[e.URL]="URL",e[e.RESOURCE_URL]="RESOURCE_URL",e}(),Ft=function(){};function Gt(e,t,r){var _=e.state,n=1792&_;return n===t?(e.state=-1793&_|r,e.initIndex=-1,!0):n===r}function kt(e,t,r){return(1792&e.state)===t&&e.initIndex<=r&&(e.initIndex=r+1,!0)}function Kt(e,t){return e.nodes[t]}function Bt(e,t){return e.nodes[t]}function Xt(e,t){return e.nodes[t]}function Ht(e,t){return e.nodes[t]}function Qt(e,t){return e.nodes[t]}var zt={setCurrentNode:void 0,createRootView:void 0,createEmbeddedView:void 0,createComponentView:void 0,createNgModuleRef:void 0,overrideProvider:void 0,overrideComponentView:void 0,clearOverrides:void 0,checkAndUpdateView:void 0,checkNoChangesView:void 0,destroyView:void 0,resolveDep:void 0,createDebugContext:void 0,handleEvent:void 0,updateDirectives:void 0,updateRenderer:void 0,dirtyParentQueries:void 0};function Vt(e,t,r,_){var n="ExpressionChangedAfterItHasBeenCheckedError: Expression has changed after it was checked. Previous value: '"+t+"'. Current value: '"+r+"'.";return _&&(n+=" It seems like the view has been created after its parent and its children have been dirty checked. Has it been created in a change detection hook ?"),function(e,t){var r=new Error(e);return jt(r,t),r}(n,e)}function jt(e,t){e[V]=t,e[q]=t.logError.bind(t)}function qt(e){return new Error("ViewDestroyedError: Attempt to use a destroyed view: "+e)}var Wt=function(){},Jt=new Map;function Zt(e){var t=Jt.get(e);return t||(t=I(e)+"_"+Jt.size,Jt.set(e,t)),t}var $t="$$undefined",er="$$empty";function tr(e){return{id:$t,styles:e.styles,encapsulation:e.encapsulation,data:e.data}}var rr=0;function _r(e,t,r,_){return!(!(2&e.state)&&R(e.oldValues[t.bindingIndex+r],_))}function nr(e,t,r,_){return!!_r(e,t,r,_)&&(e.oldValues[t.bindingIndex+r]=_,!0)}function ar(e,t,r,_){var n=e.oldValues[t.bindingIndex+r];if(1&e.state||!lt(n,_)){var a=t.bindings[r].name;throw Vt(zt.createDebugContext(e,t.nodeIndex),a+": "+n,a+": "+_,0!=(1&e.state))}}function or(e){for(var t=e;t;)2&t.def.flags&&(t.state|=8),t=t.viewContainerParent||t.parent}function ir(e,t){for(var r=e;r&&r!==t;)r.state|=64,r=r.viewContainerParent||r.parent}function sr(e,t,r,_){try{return or(33554432&e.def.nodes[t].flags?Bt(e,t).componentView:e),zt.handleEvent(e,t,r,_)}catch(t){e.root.errorHandler.handleError(t)}}function Er(e){return e.parent?Bt(e.parent,e.parentNodeDef.nodeIndex):null}function cr(e){return e.parent?e.parentNodeDef.parent:null}function lr(e,t){switch(201347067&t.flags){case 1:return Bt(e,t.nodeIndex).renderElement;case 2:return Kt(e,t.nodeIndex).renderText}}function Tr(e){return!!e.parent&&!!(32768&e.parentNodeDef.flags)}function ur(e){return!(!e.parent||32768&e.parentNodeDef.flags)}function dr(e){var t={},r=0,_={};return e&&e.forEach(function(e){var n=e[0],a=e[1];"number"==typeof n?(t[n]=a,r|=function(e){return 1<<e%32}(n)):_[n]=a}),{matchedQueries:t,references:_,matchedQueryIds:r}}function fr(e,t){return e.map(function(e){var r,_;return Array.isArray(e)?(_=e[0],r=e[1]):(_=0,r=e),r&&("function"==typeof r||"object"==typeof r)&&t&&Object.defineProperty(r,L,{value:t,configurable:!0}),{flags:_,token:r,tokenKey:Zt(r)}})}function Pr(e,t,r){var _=r.renderParent;return _?0==(1&_.flags)||0==(33554432&_.flags)||_.element.componentRendererType&&_.element.componentRendererType.encapsulation===T.Native?Bt(e,r.renderParent.nodeIndex).renderElement:void 0:t}var Ar=new WeakMap;function Sr(e){var t=Ar.get(e);return t||((t=e(function(){return Wt})).factory=e,Ar.set(e,t)),t}function pr(e,t,r,_,n){3===t&&(r=e.renderer.parentNode(lr(e,e.def.lastRenderRootNode))),mr(e,t,0,e.def.nodes.length-1,r,_,n)}function mr(e,t,r,_,n,a,o){for(var i=r;i<=_;i++){var s=e.def.nodes[i];11&s.flags&&vr(e,s,t,n,a,o),i+=s.childCount}}function Or(e,t,r,_,n,a){for(var o=e;o&&!Tr(o);)o=o.parent;for(var i=o.parent,s=cr(o),E=s.nodeIndex+s.childCount,c=s.nodeIndex+1;c<=E;c++){var l=i.def.nodes[c];l.ngContentIndex===t&&vr(i,l,r,_,n,a),c+=l.childCount}if(!i.parent){var T=e.root.projectableNodes[t];if(T)for(c=0;c<T.length;c++)Nr(e,T[c],r,_,n,a)}}function vr(e,t,r,_,n,a){if(8&t.flags)Or(e,t.ngContent.index,r,_,n,a);else{var o=lr(e,t);if(3===r&&33554432&t.flags&&48&t.bindingFlags?(16&t.bindingFlags&&Nr(e,o,r,_,n,a),32&t.bindingFlags&&Nr(Bt(e,t.nodeIndex).componentView,o,r,_,n,a)):Nr(e,o,r,_,n,a),16777216&t.flags)for(var i=Bt(e,t.nodeIndex).viewContainer._embeddedViews,s=0;s<i.length;s++)pr(i[s],r,_,n,a);1&t.flags&&!t.element.name&&mr(e,r,t.nodeIndex+1,t.nodeIndex+t.childCount,_,n,a)}}function Nr(e,t,r,_,n,a){var o=e.renderer;switch(r){case 1:o.appendChild(_,t);break;case 2:o.insertBefore(_,t,n);break;case 3:o.removeChild(_,t);break;case 0:a.push(t)}}var gr=/^:([^:]+):(.+)$/;function hr(e){if(":"===e[0]){var t=e.match(gr);return[t[1],t[2]]}return["",e]}function Rr(e){for(var t=0,r=0;r<e.length;r++)t|=e[r].flags;return t}function Ir(e,t,r,_,n,a,o,i,s,E,c,l){void 0===o&&(o=[]),E||(E=Wt);var u=dr(r),d=u.matchedQueries,f=u.references,P=u.matchedQueryIds,A=null,S=null;a&&(A=(M=hr(a))[0],S=M[1]),i=i||[];for(var p=new Array(i.length),m=0;m<i.length;m++){var O=i[m],v=O[0],N=O[2],g=hr(O[1]),h=g[0],R=g[1],I=void 0,b=void 0;switch(15&v){case 4:b=N;break;case 1:case 8:I=N}p[m]={flags:v,ns:h,name:R,nonMinifiedName:R,securityContext:I,suffix:b}}s=s||[];var Y=new Array(s.length);for(m=0;m<s.length;m++){var L=s[m];Y[m]={type:0,target:L[0],eventName:L[1],propName:null}}var M,x=(o=o||[]).map(function(e){var t=e[1],r=hr(e[0]);return[r[0],r[1],t]});return l=function(e){if(e&&e.id===$t){var t=null!=e.encapsulation&&e.encapsulation!==T.None||e.styles.length||Object.keys(e.data).length;e.id=t?"c"+rr++:er}return e&&e.id===er&&(e=null),e||null}(l),c&&(t|=33554432),{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:e,flags:t|=1,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:d,matchedQueryIds:P,references:f,ngContentIndex:_,childCount:n,bindings:p,bindingFlags:Rr(p),outputs:Y,element:{ns:A,name:S,attrs:x,template:null,componentProvider:null,componentView:c||null,componentRendererType:l,publicProviders:null,allProviders:null,handleEvent:E||Wt},provider:null,text:null,query:null,ngContent:null}}function br(e,t,r){var _,n=r.element,a=e.root.selectorOrNode,o=e.renderer;if(e.parent||!a){_=n.name?o.createElement(n.name,n.ns):o.createComment("");var i=Pr(e,t,r);i&&o.appendChild(i,_)}else _=o.selectRootElement(a);if(n.attrs)for(var s=0;s<n.attrs.length;s++){var E=n.attrs[s];o.setAttribute(_,E[1],E[2],E[0])}return _}function Yr(e,t,r,_){for(var n=0;n<r.outputs.length;n++){var a=r.outputs[n],o=Lr(e,r.nodeIndex,(l=a.eventName,(c=a.target)?c+":"+l:l)),i=a.target,s=e;"component"===a.target&&(i=null,s=t);var E=s.renderer.listen(i||_,a.eventName,o);e.disposables[r.outputIndex+n]=E}var c,l}function Lr(e,t,r){return function(_){return sr(e,t,r,_)}}function Mr(e,t,r,_){if(!nr(e,t,r,_))return!1;var n=t.bindings[r],a=Bt(e,t.nodeIndex),o=a.renderElement,i=n.name;switch(15&n.flags){case 1:!function(e,t,r,_,n,a){var o=t.securityContext,i=o?e.root.sanitizer.sanitize(o,a):a;i=null!=i?i.toString():null;var s=e.renderer;null!=a?s.setAttribute(r,n,i,_):s.removeAttribute(r,n,_)}(e,n,o,n.ns,i,_);break;case 2:!function(e,t,r,_){var n=e.renderer;_?n.addClass(t,r):n.removeClass(t,r)}(e,o,i,_);break;case 4:!function(e,t,r,_,n){var a=e.root.sanitizer.sanitize(Dt.STYLE,n);if(null!=a){a=a.toString();var o=t.suffix;null!=o&&(a+=o)}else a=null;var i=e.renderer;null!=a?i.setStyle(r,_,a):i.removeStyle(r,_)}(e,n,o,i,_);break;case 8:!function(e,t,r,_,n){var a=t.securityContext,o=a?e.root.sanitizer.sanitize(a,n):n;e.renderer.setProperty(r,_,o)}(33554432&t.flags&&32&n.flags?a.componentView:e,n,o,i,_)}return!0}var xr=new Object,yr=Zt(y),wr=Zt(Ne);function Ur(e,t,r,_){return r=Y(r),{index:-1,deps:fr(_,I(t)),flags:e,token:t,value:r}}function Cr(e){for(var t={},r=0;r<e.length;r++){var _=e[r];_.index=r,t[Zt(_.token)]=_}return{factory:null,providersByKey:t,providers:e}}function Dr(e,t,r){if(void 0===r&&(r=y.THROW_IF_NOT_FOUND),8&t.flags)return t.token;if(2&t.flags&&(r=null),1&t.flags)return e._parent.get(t.token,r);var _=t.tokenKey;switch(_){case yr:case wr:return e}var n=e._def.providersByKey[_];if(n){var a=e._providers[n.index];return void 0===a&&(a=e._providers[n.index]=Fr(e,n)),a===xr?void 0:a}return e._parent.get(t.token,r)}function Fr(e,t){var r;switch(201347067&t.flags){case 512:r=function(e,t,r){var _=r.length;switch(_){case 0:return new t;case 1:return new t(Dr(e,r[0]));case 2:return new t(Dr(e,r[0]),Dr(e,r[1]));case 3:return new t(Dr(e,r[0]),Dr(e,r[1]),Dr(e,r[2]));default:for(var n=new Array(_),a=0;a<_;a++)n[a]=Dr(e,r[a]);return new(t.bind.apply(t,[void 0].concat(n)))}}(e,t.value,t.deps);break;case 1024:r=function(e,t,r){var _=r.length;switch(_){case 0:return t();case 1:return t(Dr(e,r[0]));case 2:return t(Dr(e,r[0]),Dr(e,r[1]));case 3:return t(Dr(e,r[0]),Dr(e,r[1]),Dr(e,r[2]));default:for(var n=Array(_),a=0;a<_;a++)n[a]=Dr(e,r[a]);return t.apply(void 0,n)}}(e,t.value,t.deps);break;case 2048:r=Dr(e,t.deps[0]);break;case 256:r=t.value}return void 0===r?xr:r}function Gr(e,t){var r=e.viewContainer._embeddedViews;if((null==t||t>=r.length)&&(t=r.length-1),t<0)return null;var _=r[t];return _.viewContainerParent=null,Xr(r,t),zt.dirtyParentQueries(_),Kr(_),_}function kr(e,t,r){var _=t?lr(t,t.def.lastRenderRootNode):e.renderElement;pr(r,2,r.renderer.parentNode(_),r.renderer.nextSibling(_),void 0)}function Kr(e){pr(e,3,null,null,void 0)}function Br(e,t,r){t>=e.length?e.push(r):e.splice(t,0,r)}function Xr(e,t){t>=e.length-1?e.pop():e.splice(t,1)}var Hr=new Object;function Qr(e,t,r,_,n,a){return new zr(e,t,r,_,n,a)}var zr=function(e){function t(t,r,_,n,a,o){var i=e.call(this)||this;return i.selector=t,i.componentType=r,i._inputs=n,i._outputs=a,i.ngContentSelectors=o,i.viewDefFactory=_,i}return Object(_.b)(t,e),Object.defineProperty(t.prototype,"inputs",{get:function(){var e=[],t=this._inputs;for(var r in t)e.push({propName:r,templateName:t[r]});return e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"outputs",{get:function(){var e=[];for(var t in this._outputs)e.push({propName:t,templateName:this._outputs[t]});return e},enumerable:!0,configurable:!0}),t.prototype.create=function(e,t,r,_){if(!_)throw new Error("ngModule should be provided");var n=Sr(this.viewDefFactory),a=n.nodes[0].element.componentProvider.nodeIndex,o=zt.createRootView(e,t||[],r,n,_,Hr),i=Xt(o,a).instance;return r&&o.renderer.setAttribute(Bt(o,0).renderElement,"ng-version",d.full),new Vr(o,new Jr(o),i)},t}(de),Vr=function(e){function t(t,r,_){var n=e.call(this)||this;return n._view=t,n._viewRef=r,n._component=_,n._elDef=n._view.def.nodes[0],n.hostView=r,n.changeDetectorRef=r,n.instance=_,n}return Object(_.b)(t,e),Object.defineProperty(t.prototype,"location",{get:function(){return new tt(Bt(this._view,this._elDef.nodeIndex).renderElement)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"injector",{get:function(){return new t_(this._view,this._elDef)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"componentType",{get:function(){return this._component.constructor},enumerable:!0,configurable:!0}),t.prototype.destroy=function(){this._viewRef.destroy()},t.prototype.onDestroy=function(e){this._viewRef.onDestroy(e)},t}(function(){});function jr(e,t,r){return new qr(e,t,r)}var qr=function(){function e(e,t,r){this._view=e,this._elDef=t,this._data=r,this._embeddedViews=[]}return Object.defineProperty(e.prototype,"element",{get:function(){return new tt(this._data.renderElement)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"injector",{get:function(){return new t_(this._view,this._elDef)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parentInjector",{get:function(){for(var e=this._view,t=this._elDef.parent;!t&&e;)t=cr(e),e=e.parent;return e?new t_(e,t):new t_(this._view,null)},enumerable:!0,configurable:!0}),e.prototype.clear=function(){for(var e=this._embeddedViews.length-1;e>=0;e--){var t=Gr(this._data,e);zt.destroyView(t)}},e.prototype.get=function(e){var t=this._embeddedViews[e];if(t){var r=new Jr(t);return r.attachToViewContainerRef(this),r}return null},Object.defineProperty(e.prototype,"length",{get:function(){return this._embeddedViews.length},enumerable:!0,configurable:!0}),e.prototype.createEmbeddedView=function(e,t,r){var _=e.createEmbeddedView(t||{});return this.insert(_,r),_},e.prototype.createComponent=function(e,t,r,_,n){var a=r||this.parentInjector;n||e instanceof ve||(n=a.get(Ne));var o=e.create(a,_,void 0,n);return this.insert(o.hostView,t),o},e.prototype.insert=function(e,t){if(e.destroyed)throw new Error("Cannot insert a destroyed View in a ViewContainer!");var r,_,n,a,o=e;return n=o._view,a=(r=this._data).viewContainer._embeddedViews,null!==(_=t)&&void 0!==_||(_=a.length),n.viewContainerParent=this._view,Br(a,_,n),function(e,t){var r=Er(t);if(r&&r!==e&&!(16&t.state)){t.state|=16;var _=r.template._projectedViews;_||(_=r.template._projectedViews=[]),_.push(t),function(e,r){if(!(4&r.flags)){t.parent.def.nodeFlags|=4,r.flags|=4;for(var _=r.parent;_;)_.childFlags|=4,_=_.parent}}(0,t.parentNodeDef)}}(r,n),zt.dirtyParentQueries(n),kr(r,_>0?a[_-1]:null,n),o.attachToViewContainerRef(this),e},e.prototype.move=function(e,t){if(e.destroyed)throw new Error("Cannot move a destroyed View in a ViewContainer!");var r,_,n,a,o,i=this._embeddedViews.indexOf(e._view);return n=t,o=(a=(r=this._data).viewContainer._embeddedViews)[_=i],Xr(a,_),null==n&&(n=a.length),Br(a,n,o),zt.dirtyParentQueries(o),Kr(o),kr(r,n>0?a[n-1]:null,o),e},e.prototype.indexOf=function(e){return this._embeddedViews.indexOf(e._view)},e.prototype.remove=function(e){var t=Gr(this._data,e);t&&zt.destroyView(t)},e.prototype.detach=function(e){var t=Gr(this._data,e);return t?new Jr(t):null},e}();function Wr(e){return new Jr(e)}var Jr=function(){function e(e){this._view=e,this._viewContainerRef=null,this._appRef=null}return Object.defineProperty(e.prototype,"rootNodes",{get:function(){return pr(this._view,0,void 0,void 0,e=[]),e;var e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"context",{get:function(){return this._view.context},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"destroyed",{get:function(){return 0!=(128&this._view.state)},enumerable:!0,configurable:!0}),e.prototype.markForCheck=function(){or(this._view)},e.prototype.detach=function(){this._view.state&=-5},e.prototype.detectChanges=function(){var e=this._view.root.rendererFactory;e.begin&&e.begin();try{zt.checkAndUpdateView(this._view)}finally{e.end&&e.end()}},e.prototype.checkNoChanges=function(){zt.checkNoChangesView(this._view)},e.prototype.reattach=function(){this._view.state|=4},e.prototype.onDestroy=function(e){this._view.disposables||(this._view.disposables=[]),this._view.disposables.push(e)},e.prototype.destroy=function(){this._appRef?this._appRef.detachView(this):this._viewContainerRef&&this._viewContainerRef.detach(this._viewContainerRef.indexOf(this)),zt.destroyView(this._view)},e.prototype.detachFromAppRef=function(){this._appRef=null,Kr(this._view),zt.dirtyParentQueries(this._view)},e.prototype.attachToAppRef=function(e){if(this._viewContainerRef)throw new Error("This view is already attached to a ViewContainer!");this._appRef=e},e.prototype.attachToViewContainerRef=function(e){if(this._appRef)throw new Error("This view is already attached directly to the ApplicationRef!");this._viewContainerRef=e},e}();function Zr(e,t){return new $r(e,t)}var $r=function(e){function t(t,r){var _=e.call(this)||this;return _._parentView=t,_._def=r,_}return Object(_.b)(t,e),t.prototype.createEmbeddedView=function(e){return new Jr(zt.createEmbeddedView(this._parentView,this._def,this._def.element.template,e))},Object.defineProperty(t.prototype,"elementRef",{get:function(){return new tt(Bt(this._parentView,this._def.nodeIndex).renderElement)},enumerable:!0,configurable:!0}),t}(_t);function e_(e,t){return new t_(e,t)}var t_=function(){function e(e,t){this.view=e,this.elDef=t}return e.prototype.get=function(e,t){return void 0===t&&(t=y.THROW_IF_NOT_FOUND),zt.resolveDep(this.view,this.elDef,!!this.elDef&&0!=(33554432&this.elDef.flags),{flags:0,token:e,tokenKey:Zt(e)},t)},e}();function r_(e){return new __(e.renderer)}var __=function(){function e(e){this.delegate=e}return e.prototype.selectRootElement=function(e){return this.delegate.selectRootElement(e)},e.prototype.createElement=function(e,t){var r=hr(t),_=this.delegate.createElement(r[1],r[0]);return e&&this.delegate.appendChild(e,_),_},e.prototype.createViewRoot=function(e){return e},e.prototype.createTemplateAnchor=function(e){var t=this.delegate.createComment("");return e&&this.delegate.appendChild(e,t),t},e.prototype.createText=function(e,t){var r=this.delegate.createText(t);return e&&this.delegate.appendChild(e,r),r},e.prototype.projectNodes=function(e,t){for(var r=0;r<t.length;r++)this.delegate.appendChild(e,t[r])},e.prototype.attachViewAfter=function(e,t){for(var r=this.delegate.parentNode(e),_=this.delegate.nextSibling(e),n=0;n<t.length;n++)this.delegate.insertBefore(r,t[n],_)},e.prototype.detachView=function(e){for(var t=0;t<e.length;t++){var r=e[t],_=this.delegate.parentNode(r);this.delegate.removeChild(_,r)}},e.prototype.destroyView=function(e,t){for(var r=0;r<t.length;r++)this.delegate.destroyNode(t[r])},e.prototype.listen=function(e,t,r){return this.delegate.listen(e,t,r)},e.prototype.listenGlobal=function(e,t,r){return this.delegate.listen(e,t,r)},e.prototype.setElementProperty=function(e,t,r){this.delegate.setProperty(e,t,r)},e.prototype.setElementAttribute=function(e,t,r){var _=hr(t),n=_[0],a=_[1];null!=r?this.delegate.setAttribute(e,a,r,n):this.delegate.removeAttribute(e,a,n)},e.prototype.setBindingDebugInfo=function(e,t,r){},e.prototype.setElementClass=function(e,t,r){r?this.delegate.addClass(e,t):this.delegate.removeClass(e,t)},e.prototype.setElementStyle=function(e,t,r){null!=r?this.delegate.setStyle(e,t,r):this.delegate.removeStyle(e,t)},e.prototype.invokeElementMethod=function(e,t,r){e[t].apply(e,r)},e.prototype.setText=function(e,t){this.delegate.setValue(e,t)},e.prototype.animate=function(){throw new Error("Renderer.animate is no longer supported!")},e}();function n_(e,t,r,_){return new a_(e,t,r,_)}var a_=function(){function e(e,t,r,_){this._moduleType=e,this._parent=t,this._bootstrapComponents=r,this._def=_,this._destroyListeners=[],this._destroyed=!1,this.injector=this,function(e){for(var t=e._def,r=e._providers=new Array(t.providers.length),_=0;_<t.providers.length;_++){var n=t.providers[_];4096&n.flags||(r[_]=Fr(e,n))}}(this)}return e.prototype.get=function(e,t){return void 0===t&&(t=y.THROW_IF_NOT_FOUND),Dr(this,{token:e,tokenKey:Zt(e),flags:0},t)},Object.defineProperty(e.prototype,"instance",{get:function(){return this.get(this._moduleType)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"componentFactoryResolver",{get:function(){return this.get(me)},enumerable:!0,configurable:!0}),e.prototype.destroy=function(){if(this._destroyed)throw new Error("The ng module "+I(this.instance.constructor)+" has already been destroyed.");this._destroyed=!0,function(e,t){for(var r=e._def,_=0;_<r.providers.length;_++)if(131072&r.providers[_].flags){var n=e._providers[_];n&&n!==xr&&n.ngOnDestroy()}}(this),this._destroyListeners.forEach(function(e){return e()})},e.prototype.onDestroy=function(e){this._destroyListeners.push(e)},e}(),o_=Zt(function(){}),i_=Zt(function(){}),s_=Zt(tt),E_=Zt(function(){}),c_=Zt(_t),l_=Zt(function(){}),T_=Zt(y);function u_(e,t,r,_,n,a,o,i){var s=[];if(o)for(var E in o){var c=o[E];s[c[0]]={flags:8,name:E,nonMinifiedName:c[1],ns:null,securityContext:null,suffix:null}}var l=[];if(i)for(var T in i)l.push({type:1,propName:T,target:null,eventName:i[T]});return function(e,t,r,_,n,a,o,i,s){var E=dr(r),c=E.matchedQueries,l=E.references,T=E.matchedQueryIds;s||(s=[]),i||(i=[]),a=Y(a);var u=fr(o,I(n));return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:e,flags:t,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:c,matchedQueryIds:T,references:l,ngContentIndex:-1,childCount:_,bindings:i,bindingFlags:Rr(i),outputs:s,element:null,provider:{token:n,value:a,deps:u},text:null,query:null,ngContent:null}}(e,t|=16384,r,_,n,n,a,s,l)}function d_(e,t){return S_(e,t)}function f_(e,t){for(var r=e;r.parent&&!Tr(r);)r=r.parent;return p_(r.parent,cr(r),!0,t.provider.value,t.provider.deps)}function P_(e,t){var r=p_(e,t.parent,(32768&t.flags)>0,t.provider.value,t.provider.deps);if(t.outputs.length)for(var _=0;_<t.outputs.length;_++){var n=t.outputs[_],a=r[n.propName].subscribe(A_(e,t.parent.nodeIndex,n.eventName));e.disposables[t.outputIndex+_]=a.unsubscribe.bind(a)}return r}function A_(e,t,r){return function(_){return sr(e,t,r,_)}}function S_(e,t){var r=(8192&t.flags)>0,_=t.provider;switch(201347067&t.flags){case 512:return p_(e,t.parent,r,_.value,_.deps);case 1024:return function(e,t,r,_,n){var a=n.length;switch(a){case 0:return _();case 1:return _(O_(e,t,r,n[0]));case 2:return _(O_(e,t,r,n[0]),O_(e,t,r,n[1]));case 3:return _(O_(e,t,r,n[0]),O_(e,t,r,n[1]),O_(e,t,r,n[2]));default:for(var o=Array(a),i=0;i<a;i++)o[i]=O_(e,t,r,n[i]);return _.apply(void 0,o)}}(e,t.parent,r,_.value,_.deps);case 2048:return O_(e,t.parent,r,_.deps[0]);case 256:return _.value}}function p_(e,t,r,_,n){var a=n.length;switch(a){case 0:return new _;case 1:return new _(O_(e,t,r,n[0]));case 2:return new _(O_(e,t,r,n[0]),O_(e,t,r,n[1]));case 3:return new _(O_(e,t,r,n[0]),O_(e,t,r,n[1]),O_(e,t,r,n[2]));default:for(var o=new Array(a),i=0;i<a;i++)o[i]=O_(e,t,r,n[i]);return new(_.bind.apply(_,[void 0].concat(o)))}}var m_={};function O_(e,t,r,_,n){if(void 0===n&&(n=y.THROW_IF_NOT_FOUND),8&_.flags)return _.token;var a=e;2&_.flags&&(n=null);var o=_.tokenKey;for(o===l_&&(r=!(!t||!t.element.componentView)),t&&1&_.flags&&(r=!1,t=t.parent);e;){if(t)switch(o){case o_:return r_(v_(e,t,r));case i_:return v_(e,t,r).renderer;case s_:return new tt(Bt(e,t.nodeIndex).renderElement);case E_:return Bt(e,t.nodeIndex).viewContainer;case c_:if(t.element.template)return Bt(e,t.nodeIndex).template;break;case l_:return Wr(v_(e,t,r));case T_:return e_(e,t);default:var i=(r?t.element.allProviders:t.element.publicProviders)[o];if(i){var s=Xt(e,i.nodeIndex);return s||(s={instance:S_(e,i)},e.nodes[i.nodeIndex]=s),s.instance}}r=Tr(e),t=cr(e),e=e.parent}var E=a.root.injector.get(_.token,m_);return E!==m_||n===m_?E:a.root.ngModule.injector.get(_.token,n)}function v_(e,t,r){var _;if(r)_=Bt(e,t.nodeIndex).componentView;else for(_=e;_.parent&&!Tr(_);)_=_.parent;return _}function N_(e,t,r,_,n,a){if(32768&r.flags){var o=Bt(e,r.parent.nodeIndex).componentView;2&o.def.flags&&(o.state|=8)}if(t.instance[r.bindings[_].name]=n,524288&r.flags){a=a||{};var i=Tt.unwrap(e.oldValues[r.bindingIndex+_]);a[r.bindings[_].nonMinifiedName]=new ut(i,n,0!=(2&e.state))}return e.oldValues[r.bindingIndex+_]=n,a}function g_(e,t){if(e.def.nodeFlags&t)for(var r=e.def.nodes,_=0,n=0;n<r.length;n++){var a=r[n],o=a.parent;for(!o&&a.flags&t&&R_(e,n,a.flags&t,_++),0==(a.childFlags&t)&&(n+=a.childCount);o&&1&o.flags&&n===o.nodeIndex+o.childCount;)o.directChildFlags&t&&(_=h_(e,o,t,_)),o=o.parent}}function h_(e,t,r,_){for(var n=t.nodeIndex+1;n<=t.nodeIndex+t.childCount;n++){var a=e.def.nodes[n];a.flags&r&&R_(e,n,a.flags&r,_++),n+=a.childCount}return _}function R_(e,t,r,_){var n=Xt(e,t);if(n){var a=n.instance;a&&(zt.setCurrentNode(e,t),1048576&r&&kt(e,512,_)&&a.ngAfterContentInit(),2097152&r&&a.ngAfterContentChecked(),4194304&r&&kt(e,768,_)&&a.ngAfterViewInit(),8388608&r&&a.ngAfterViewChecked(),131072&r&&a.ngOnDestroy())}}function I_(e){for(var t=e.def.nodeMatchedQueries;e.parent&&ur(e);){var r=e.parentNodeDef;e=e.parent;for(var _=r.nodeIndex+r.childCount,n=0;n<=_;n++)67108864&(a=e.def.nodes[n]).flags&&536870912&a.flags&&(a.query.filterId&t)===a.query.filterId&&Qt(e,n).setDirty(),!(1&a.flags&&n+a.childCount<r.nodeIndex)&&67108864&a.childFlags&&536870912&a.childFlags||(n+=a.childCount)}if(134217728&e.def.nodeFlags)for(n=0;n<e.def.nodes.length;n++){var a;134217728&(a=e.def.nodes[n]).flags&&536870912&a.flags&&Qt(e,n).setDirty(),n+=a.childCount}}function b_(e,t){var r=Qt(e,t.nodeIndex);if(r.dirty){var _,n=void 0;if(67108864&t.flags){var a=t.parent.parent;n=Y_(e,a.nodeIndex,a.nodeIndex+a.childCount,t.query,[]),_=Xt(e,t.parent.nodeIndex).instance}else 134217728&t.flags&&(n=Y_(e,0,e.def.nodes.length-1,t.query,[]),_=e.component);r.reset(n);for(var o=t.query.bindings,i=!1,s=0;s<o.length;s++){var E=o[s],c=void 0;switch(E.bindingType){case 0:c=r.first;break;case 1:c=r,i=!0}_[E.propName]=c}i&&r.notifyOnChanges()}}function Y_(e,t,r,_,n){for(var a=t;a<=r;a++){var o=e.def.nodes[a],i=o.matchedQueries[_.id];if(null!=i&&n.push(L_(e,o,i)),1&o.flags&&o.element.template&&(o.element.template.nodeMatchedQueries&_.filterId)===_.filterId){var s=Bt(e,a);if((o.childMatchedQueries&_.filterId)===_.filterId&&(Y_(e,a+1,a+o.childCount,_,n),a+=o.childCount),16777216&o.flags)for(var E=s.viewContainer._embeddedViews,c=0;c<E.length;c++){var l=E[c],T=Er(l);T&&T===s&&Y_(l,0,l.def.nodes.length-1,_,n)}var u=s.template._projectedViews;if(u)for(c=0;c<u.length;c++){var d=u[c];Y_(d,0,d.def.nodes.length-1,_,n)}}(o.childMatchedQueries&_.filterId)!==_.filterId&&(a+=o.childCount)}return n}function L_(e,t,r){if(null!=r)switch(r){case 1:return Bt(e,t.nodeIndex).renderElement;case 0:return new tt(Bt(e,t.nodeIndex).renderElement);case 2:return Bt(e,t.nodeIndex).template;case 3:return Bt(e,t.nodeIndex).viewContainer;case 4:return Xt(e,t.nodeIndex).instance}}function M_(e,t,r){var _=Pr(e,t,r);_&&Or(e,r.ngContent.index,1,_,null,void 0)}function x_(e,t,r){var _,n=e.renderer;_=n.createText(r.text.prefix);var a=Pr(e,t,r);return a&&n.appendChild(a,_),{renderText:_}}function y_(e,t){return(null!=e?e.toString():"")+t.suffix}function w_(e,t,r,_){for(var n=0,a=0,o=0,i=0,s=0,E=null,c=null,l=!1,T=!1,u=null,d=0;d<t.length;d++){var f=t[d];if(f.nodeIndex=d,f.parent=E,f.bindingIndex=n,f.outputIndex=a,f.renderParent=c,o|=f.flags,s|=f.matchedQueryIds,f.element){var P=f.element;P.publicProviders=E?E.element.publicProviders:Object.create(null),P.allProviders=P.publicProviders,l=!1,T=!1,f.element.template&&(s|=f.element.template.nodeMatchedQueries)}if(C_(E,f,t.length),n+=f.bindings.length,a+=f.outputs.length,!c&&3&f.flags&&(u=f),20224&f.flags){l||(l=!0,E.element.publicProviders=Object.create(E.element.publicProviders),E.element.allProviders=E.element.publicProviders);var A=0!=(32768&f.flags);0==(8192&f.flags)||A?E.element.publicProviders[Zt(f.provider.token)]=f:(T||(T=!0,E.element.allProviders=Object.create(E.element.publicProviders)),E.element.allProviders[Zt(f.provider.token)]=f),A&&(E.element.componentProvider=f)}if(E?(E.childFlags|=f.flags,E.directChildFlags|=f.flags,E.childMatchedQueries|=f.matchedQueryIds,f.element&&f.element.template&&(E.childMatchedQueries|=f.element.template.nodeMatchedQueries)):i|=f.flags,f.childCount>0)E=f,U_(f)||(c=f);else for(;E&&d===E.nodeIndex+E.childCount;){var S=E.parent;S&&(S.childFlags|=E.childFlags,S.childMatchedQueries|=E.childMatchedQueries),c=(E=S)&&U_(E)?E.renderParent:E}}return{factory:null,nodeFlags:o,rootNodeFlags:i,nodeMatchedQueries:s,flags:e,nodes:t,updateDirectives:r||Wt,updateRenderer:_||Wt,handleEvent:function(e,r,_,n){return t[r].element.handleEvent(e,_,n)},bindingCount:n,outputCount:a,lastRenderRootNode:u}}function U_(e){return 0!=(1&e.flags)&&null===e.element.name}function C_(e,t,r){var _=t.element&&t.element.template;if(_){if(!_.lastRenderRootNode)throw new Error("Illegal State: Embedded templates without nodes are not allowed!");if(_.lastRenderRootNode&&16777216&_.lastRenderRootNode.flags)throw new Error("Illegal State: Last root node of a template can't have embedded views, at index "+t.nodeIndex+"!")}if(20224&t.flags&&0==(1&(e?e.flags:0)))throw new Error("Illegal State: StaticProvider/Directive nodes need to be children of elements or anchors, at index "+t.nodeIndex+"!");if(t.query){if(67108864&t.flags&&(!e||0==(16384&e.flags)))throw new Error("Illegal State: Content Query nodes need to be children of directives, at index "+t.nodeIndex+"!");if(134217728&t.flags&&e)throw new Error("Illegal State: View Query nodes have to be top level nodes, at index "+t.nodeIndex+"!")}if(t.childCount){var n=e?e.nodeIndex+e.childCount:r-1;if(t.nodeIndex<=n&&t.nodeIndex+t.childCount>n)throw new Error("Illegal State: childCount of node leads outside of parent, at index "+t.nodeIndex+"!")}}function D_(e,t,r,_){var n=k_(e.root,e.renderer,e,t,r);return K_(n,e.component,_),B_(n),n}function F_(e,t,r){var _=k_(e,e.renderer,null,null,t);return K_(_,r,r),B_(_),_}function G_(e,t,r,_){var n,a=t.element.componentRendererType;return n=a?e.root.rendererFactory.createRenderer(_,a):e.root.renderer,k_(e.root,n,e,t.element.componentProvider,r)}function k_(e,t,r,_,n){var a=new Array(n.nodes.length),o=n.outputCount?new Array(n.outputCount):null;return{def:n,parent:r,viewContainerParent:null,parentNodeDef:_,context:null,component:null,nodes:a,state:13,root:e,renderer:t,oldValues:new Array(n.bindingCount),disposables:o,initIndex:-1}}function K_(e,t,r){e.component=t,e.context=r}function B_(e){var t;Tr(e)&&(t=Bt(e.parent,e.parentNodeDef.parent.nodeIndex).renderElement);for(var r=e.def,_=e.nodes,n=0;n<r.nodes.length;n++){var a=r.nodes[n];zt.setCurrentNode(e,n);var o=void 0;switch(201347067&a.flags){case 1:var i=br(e,t,a),s=void 0;if(33554432&a.flags){var E=Sr(a.element.componentView);s=zt.createComponentView(e,a,E,i)}Yr(e,s,a,i),o={renderElement:i,componentView:s,viewContainer:null,template:a.element.template?Zr(e,a):void 0},16777216&a.flags&&(o.viewContainer=jr(e,a,o));break;case 2:o=x_(e,t,a);break;case 512:case 1024:case 2048:case 256:(o=_[n])||4096&a.flags||(o={instance:d_(e,a)});break;case 16:o={instance:f_(e,a)};break;case 16384:(o=_[n])||(o={instance:P_(e,a)}),32768&a.flags&&K_(Bt(e,a.parent.nodeIndex).componentView,o.instance,o.instance);break;case 32:case 64:case 128:o={value:void 0};break;case 67108864:case 134217728:o=new rt;break;case 8:M_(e,t,a),o=void 0}_[n]=o}J_(e,W_.CreateViewNodes),tn(e,201326592,268435456,0)}function X_(e){z_(e),zt.updateDirectives(e,1),Z_(e,W_.CheckNoChanges),zt.updateRenderer(e,1),J_(e,W_.CheckNoChanges),e.state&=-97}function H_(e){1&e.state?(e.state&=-2,e.state|=2):e.state&=-3,Gt(e,0,256),z_(e),zt.updateDirectives(e,0),Z_(e,W_.CheckAndUpdate),tn(e,67108864,536870912,0);var t=Gt(e,256,512);g_(e,2097152|(t?1048576:0)),zt.updateRenderer(e,0),J_(e,W_.CheckAndUpdate),tn(e,134217728,536870912,0),g_(e,8388608|((t=Gt(e,512,768))?4194304:0)),2&e.def.flags&&(e.state&=-9),e.state&=-97,Gt(e,768,1024)}function Q_(e,t,r,_,n,a,o,i,s,E,c,l,T){return 0===r?function(e,t,r,_,n,a,o,i,s,E,c,l){switch(201347067&t.flags){case 1:return function(e,t,r,_,n,a,o,i,s,E,c,l){var T=t.bindings.length,u=!1;return T>0&&Mr(e,t,0,r)&&(u=!0),T>1&&Mr(e,t,1,_)&&(u=!0),T>2&&Mr(e,t,2,n)&&(u=!0),T>3&&Mr(e,t,3,a)&&(u=!0),T>4&&Mr(e,t,4,o)&&(u=!0),T>5&&Mr(e,t,5,i)&&(u=!0),T>6&&Mr(e,t,6,s)&&(u=!0),T>7&&Mr(e,t,7,E)&&(u=!0),T>8&&Mr(e,t,8,c)&&(u=!0),T>9&&Mr(e,t,9,l)&&(u=!0),u}(e,t,r,_,n,a,o,i,s,E,c,l);case 2:return function(e,t,r,_,n,a,o,i,s,E,c,l){var T=!1,u=t.bindings,d=u.length;if(d>0&&nr(e,t,0,r)&&(T=!0),d>1&&nr(e,t,1,_)&&(T=!0),d>2&&nr(e,t,2,n)&&(T=!0),d>3&&nr(e,t,3,a)&&(T=!0),d>4&&nr(e,t,4,o)&&(T=!0),d>5&&nr(e,t,5,i)&&(T=!0),d>6&&nr(e,t,6,s)&&(T=!0),d>7&&nr(e,t,7,E)&&(T=!0),d>8&&nr(e,t,8,c)&&(T=!0),d>9&&nr(e,t,9,l)&&(T=!0),T){var f=t.text.prefix;d>0&&(f+=y_(r,u[0])),d>1&&(f+=y_(_,u[1])),d>2&&(f+=y_(n,u[2])),d>3&&(f+=y_(a,u[3])),d>4&&(f+=y_(o,u[4])),d>5&&(f+=y_(i,u[5])),d>6&&(f+=y_(s,u[6])),d>7&&(f+=y_(E,u[7])),d>8&&(f+=y_(c,u[8])),d>9&&(f+=y_(l,u[9]));var P=Kt(e,t.nodeIndex).renderText;e.renderer.setValue(P,f)}return T}(e,t,r,_,n,a,o,i,s,E,c,l);case 16384:return function(e,t,r,_,n,a,o,i,s,E,c,l){var T=Xt(e,t.nodeIndex),u=T.instance,d=!1,f=void 0,P=t.bindings.length;return P>0&&_r(e,t,0,r)&&(d=!0,f=N_(e,T,t,0,r,f)),P>1&&_r(e,t,1,_)&&(d=!0,f=N_(e,T,t,1,_,f)),P>2&&_r(e,t,2,n)&&(d=!0,f=N_(e,T,t,2,n,f)),P>3&&_r(e,t,3,a)&&(d=!0,f=N_(e,T,t,3,a,f)),P>4&&_r(e,t,4,o)&&(d=!0,f=N_(e,T,t,4,o,f)),P>5&&_r(e,t,5,i)&&(d=!0,f=N_(e,T,t,5,i,f)),P>6&&_r(e,t,6,s)&&(d=!0,f=N_(e,T,t,6,s,f)),P>7&&_r(e,t,7,E)&&(d=!0,f=N_(e,T,t,7,E,f)),P>8&&_r(e,t,8,c)&&(d=!0,f=N_(e,T,t,8,c,f)),P>9&&_r(e,t,9,l)&&(d=!0,f=N_(e,T,t,9,l,f)),f&&u.ngOnChanges(f),65536&t.flags&&kt(e,256,t.nodeIndex)&&u.ngOnInit(),262144&t.flags&&u.ngDoCheck(),d}(e,t,r,_,n,a,o,i,s,E,c,l);case 32:case 64:case 128:return function(e,t,r,_,n,a,o,i,s,E,c,l){var T=t.bindings,u=!1,d=T.length;if(d>0&&nr(e,t,0,r)&&(u=!0),d>1&&nr(e,t,1,_)&&(u=!0),d>2&&nr(e,t,2,n)&&(u=!0),d>3&&nr(e,t,3,a)&&(u=!0),d>4&&nr(e,t,4,o)&&(u=!0),d>5&&nr(e,t,5,i)&&(u=!0),d>6&&nr(e,t,6,s)&&(u=!0),d>7&&nr(e,t,7,E)&&(u=!0),d>8&&nr(e,t,8,c)&&(u=!0),d>9&&nr(e,t,9,l)&&(u=!0),u){var f=Ht(e,t.nodeIndex),P=void 0;switch(201347067&t.flags){case 32:P=new Array(T.length),d>0&&(P[0]=r),d>1&&(P[1]=_),d>2&&(P[2]=n),d>3&&(P[3]=a),d>4&&(P[4]=o),d>5&&(P[5]=i),d>6&&(P[6]=s),d>7&&(P[7]=E),d>8&&(P[8]=c),d>9&&(P[9]=l);break;case 64:P={},d>0&&(P[T[0].name]=r),d>1&&(P[T[1].name]=_),d>2&&(P[T[2].name]=n),d>3&&(P[T[3].name]=a),d>4&&(P[T[4].name]=o),d>5&&(P[T[5].name]=i),d>6&&(P[T[6].name]=s),d>7&&(P[T[7].name]=E),d>8&&(P[T[8].name]=c),d>9&&(P[T[9].name]=l);break;case 128:var A=r;switch(d){case 1:P=A.transform(r);break;case 2:P=A.transform(_);break;case 3:P=A.transform(_,n);break;case 4:P=A.transform(_,n,a);break;case 5:P=A.transform(_,n,a,o);break;case 6:P=A.transform(_,n,a,o,i);break;case 7:P=A.transform(_,n,a,o,i,s);break;case 8:P=A.transform(_,n,a,o,i,s,E);break;case 9:P=A.transform(_,n,a,o,i,s,E,c);break;case 10:P=A.transform(_,n,a,o,i,s,E,c,l)}}f.value=P}return u}(e,t,r,_,n,a,o,i,s,E,c,l);default:throw"unreachable"}}(e,t,_,n,a,o,i,s,E,c,l,T):function(e,t,r){switch(201347067&t.flags){case 1:return function(e,t,r){for(var _=!1,n=0;n<r.length;n++)Mr(e,t,n,r[n])&&(_=!0);return _}(e,t,r);case 2:return function(e,t,r){for(var _=t.bindings,n=!1,a=0;a<r.length;a++)nr(e,t,a,r[a])&&(n=!0);if(n){var o="";for(a=0;a<r.length;a++)o+=y_(r[a],_[a]);o=t.text.prefix+o;var i=Kt(e,t.nodeIndex).renderText;e.renderer.setValue(i,o)}return n}(e,t,r);case 16384:return function(e,t,r){for(var _=Xt(e,t.nodeIndex),n=_.instance,a=!1,o=void 0,i=0;i<r.length;i++)_r(e,t,i,r[i])&&(a=!0,o=N_(e,_,t,i,r[i],o));return o&&n.ngOnChanges(o),65536&t.flags&&kt(e,256,t.nodeIndex)&&n.ngOnInit(),262144&t.flags&&n.ngDoCheck(),a}(e,t,r);case 32:case 64:case 128:return function(e,t,r){for(var _=t.bindings,n=!1,a=0;a<r.length;a++)nr(e,t,a,r[a])&&(n=!0);if(n){var o=Ht(e,t.nodeIndex),i=void 0;switch(201347067&t.flags){case 32:i=r;break;case 64:for(i={},a=0;a<r.length;a++)i[_[a].name]=r[a];break;case 128:var s=r[0],E=r.slice(1);i=s.transform.apply(s,E)}o.value=i}return n}(e,t,r);default:throw"unreachable"}}(e,t,_)}function z_(e){var t=e.def;if(4&t.nodeFlags)for(var r=0;r<t.nodes.length;r++){var _=t.nodes[r];if(4&_.flags){var n=Bt(e,r).template._projectedViews;if(n)for(var a=0;a<n.length;a++){var o=n[a];o.state|=32,ir(o,e)}}else 0==(4&_.childFlags)&&(r+=_.childCount)}}function V_(e,t,r,_,n,a,o,i,s,E,c,l,T){return 0===r?function(e,t,r,_,n,a,o,i,s,E,c,l){var T=t.bindings.length;T>0&&ar(e,t,0,r),T>1&&ar(e,t,1,_),T>2&&ar(e,t,2,n),T>3&&ar(e,t,3,a),T>4&&ar(e,t,4,o),T>5&&ar(e,t,5,i),T>6&&ar(e,t,6,s),T>7&&ar(e,t,7,E),T>8&&ar(e,t,8,c),T>9&&ar(e,t,9,l)}(e,t,_,n,a,o,i,s,E,c,l,T):function(e,t,r){for(var _=0;_<r.length;_++)ar(e,t,_,r[_])}(e,t,_),!1}function j_(e,t){if(Qt(e,t.nodeIndex).dirty)throw Vt(zt.createDebugContext(e,t.nodeIndex),"Query "+t.query.id+" not dirty","Query "+t.query.id+" dirty",0!=(1&e.state))}function q_(e){if(!(128&e.state)){if(Z_(e,W_.Destroy),J_(e,W_.Destroy),g_(e,131072),e.disposables)for(var t=0;t<e.disposables.length;t++)e.disposables[t]();!function(e){if(16&e.state){var t=Er(e);if(t){var r=t.template._projectedViews;r&&(Xr(r,r.indexOf(e)),zt.dirtyParentQueries(e))}}}(e),e.renderer.destroyNode&&function(e){for(var t=e.def.nodes.length,r=0;r<t;r++){var _=e.def.nodes[r];1&_.flags?e.renderer.destroyNode(Bt(e,r).renderElement):2&_.flags?e.renderer.destroyNode(Kt(e,r).renderText):(67108864&_.flags||134217728&_.flags)&&Qt(e,r).destroy()}}(e),Tr(e)&&e.renderer.destroy(),e.state|=128}}var W_=function(){var e={CreateViewNodes:0,CheckNoChanges:1,CheckNoChangesProjectedViews:2,CheckAndUpdate:3,CheckAndUpdateProjectedViews:4,Destroy:5};return e[e.CreateViewNodes]="CreateViewNodes",e[e.CheckNoChanges]="CheckNoChanges",e[e.CheckNoChangesProjectedViews]="CheckNoChangesProjectedViews",e[e.CheckAndUpdate]="CheckAndUpdate",e[e.CheckAndUpdateProjectedViews]="CheckAndUpdateProjectedViews",e[e.Destroy]="Destroy",e}();function J_(e,t){var r=e.def;if(33554432&r.nodeFlags)for(var _=0;_<r.nodes.length;_++){var n=r.nodes[_];33554432&n.flags?$_(Bt(e,_).componentView,t):0==(33554432&n.childFlags)&&(_+=n.childCount)}}function Z_(e,t){var r=e.def;if(16777216&r.nodeFlags)for(var _=0;_<r.nodes.length;_++){var n=r.nodes[_];if(16777216&n.flags)for(var a=Bt(e,_).viewContainer._embeddedViews,o=0;o<a.length;o++)$_(a[o],t);else 0==(16777216&n.childFlags)&&(_+=n.childCount)}}function $_(e,t){var r=e.state;switch(t){case W_.CheckNoChanges:0==(128&r)&&(12==(12&r)?X_(e):64&r&&en(e,W_.CheckNoChangesProjectedViews));break;case W_.CheckNoChangesProjectedViews:0==(128&r)&&(32&r?X_(e):64&r&&en(e,t));break;case W_.CheckAndUpdate:0==(128&r)&&(12==(12&r)?H_(e):64&r&&en(e,W_.CheckAndUpdateProjectedViews));break;case W_.CheckAndUpdateProjectedViews:0==(128&r)&&(32&r?H_(e):64&r&&en(e,t));break;case W_.Destroy:q_(e);break;case W_.CreateViewNodes:B_(e)}}function en(e,t){Z_(e,t),J_(e,t)}function tn(e,t,r,_){if(e.def.nodeFlags&t&&e.def.nodeFlags&r)for(var n=e.def.nodes.length,a=0;a<n;a++){var o=e.def.nodes[a];if(o.flags&t&&o.flags&r)switch(zt.setCurrentNode(e,o.nodeIndex),_){case 0:b_(e,o);break;case 1:j_(e,o)}o.childFlags&t&&o.childFlags&r||(a+=o.childCount)}}var rn=!1;function _n(e,t,r,_,n,a){return F_(an(e,n,n.injector.get($e),t,r),_,a)}function nn(e,t,r,_,n,a){var o=n.injector.get($e),i=an(e,n,new Gn(o),t,r),s=fn(_);return Dn(gn.create,F_,null,[i,s,a])}function an(e,t,r,_,n){var a=t.injector.get(Ft),o=t.injector.get($);return{ngModule:t,injector:e,projectableNodes:_,selectorOrNode:n,sanitizer:a,rendererFactory:r,renderer:r.createRenderer(null,null),errorHandler:o}}function on(e,t,r,_){var n=fn(r);return Dn(gn.create,D_,null,[e,t,n,_])}function sn(e,t,r,_){return r=ln.get(t.element.componentProvider.provider.token)||fn(r),Dn(gn.create,G_,null,[e,t,r,_])}function En(e,t,r,_){return n_(e,t,r,function(e){var t=function(e){var t=!1,r=!1;return 0===cn.size?{hasOverrides:t,hasDeprecatedOverrides:r}:(e.providers.forEach(function(e){var _=cn.get(e.token);3840&e.flags&&_&&(t=!0,r=r||_.deprecatedBehavior)}),{hasOverrides:t,hasDeprecatedOverrides:r})}(e),r=t.hasDeprecatedOverrides;return t.hasOverrides?(function(e){for(var t=0;t<e.providers.length;t++){var _=e.providers[t];r&&(_.flags|=4096);var n=cn.get(_.token);n&&(_.flags=-3841&_.flags|n.flags,_.deps=fr(n.deps),_.value=n.value)}}(e=e.factory(function(){return Wt})),e):e}(_))}var cn=new Map,ln=new Map;function Tn(e){cn.set(e.token,e)}function un(e,t){var r=Sr(Sr(t.viewDefFactory).nodes[0].element.componentView);ln.set(e,r)}function dn(){cn.clear(),ln.clear()}function fn(e){if(0===cn.size)return e;var t=function(e){for(var t=[],r=null,_=0;_<e.nodes.length;_++){var n=e.nodes[_];1&n.flags&&(r=n),r&&3840&n.flags&&cn.has(n.provider.token)&&(t.push(r.nodeIndex),r=null)}return t}(e);if(0===t.length)return e;e=e.factory(function(){return Wt});for(var r=0;r<t.length;r++)_(e,t[r]);return e;function _(e,t){for(var r=t+1;r<e.nodes.length;r++){var _=e.nodes[r];if(1&_.flags)return;if(3840&_.flags){var n=_.provider,a=cn.get(n.token);a&&(_.flags=-3841&_.flags|a.flags,n.deps=fr(a.deps),n.value=a.value)}}}}function Pn(e,t,r,_,n,a,o,i,s,E,c,l,T){var u=e.def.nodes[t];return Q_(e,u,r,_,n,a,o,i,s,E,c,l,T),224&u.flags?Ht(e,t).value:void 0}function An(e,t,r,_,n,a,o,i,s,E,c,l,T){var u=e.def.nodes[t];return V_(e,u,r,_,n,a,o,i,s,E,c,l,T),224&u.flags?Ht(e,t).value:void 0}function Sn(e){return Dn(gn.detectChanges,H_,null,[e])}function pn(e){return Dn(gn.checkNoChanges,X_,null,[e])}function mn(e){return Dn(gn.destroy,q_,null,[e])}var On,vn,Nn,gn=function(){var e={create:0,detectChanges:1,checkNoChanges:2,destroy:3,handleEvent:4};return e[e.create]="create",e[e.detectChanges]="detectChanges",e[e.checkNoChanges]="checkNoChanges",e[e.destroy]="destroy",e[e.handleEvent]="handleEvent",e}();function hn(e,t){vn=e,Nn=t}function Rn(e,t,r,_){return hn(e,t),Dn(gn.handleEvent,e.def.handleEvent,null,[e,t,r,_])}function In(e,t){if(128&e.state)throw qt(gn[On]);return hn(e,yn(e,0)),e.def.updateDirectives(function(e,r,_){for(var n=[],a=3;a<arguments.length;a++)n[a-3]=arguments[a];var o=e.def.nodes[r];return 0===t?Yn(e,o,_,n):Ln(e,o,_,n),16384&o.flags&&hn(e,yn(e,r)),224&o.flags?Ht(e,o.nodeIndex).value:void 0},e)}function bn(e,t){if(128&e.state)throw qt(gn[On]);return hn(e,wn(e,0)),e.def.updateRenderer(function(e,r,_){for(var n=[],a=3;a<arguments.length;a++)n[a-3]=arguments[a];var o=e.def.nodes[r];return 0===t?Yn(e,o,_,n):Ln(e,o,_,n),3&o.flags&&hn(e,wn(e,r)),224&o.flags?Ht(e,o.nodeIndex).value:void 0},e)}function Yn(e,t,r,_){if(Q_.apply(void 0,[e,t,r].concat(_))){var n=1===r?_[0]:_;if(16384&t.flags){for(var a={},o=0;o<t.bindings.length;o++){var i=t.bindings[o],s=n[o];8&i.flags&&(a[(T=i.nonMinifiedName,"ng-reflect-"+(T=T.replace(/[$@]/g,"_").replace(Mn,function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return"-"+e[1].toLowerCase()})))]=xn(s))}var E=t.parent,c=Bt(e,E.nodeIndex).renderElement;if(E.element.name)for(var l in a)null!=(s=a[l])?e.renderer.setAttribute(c,l,s):e.renderer.removeAttribute(c,l);else e.renderer.setValue(c,"bindings="+JSON.stringify(a,null,2))}}var T}function Ln(e,t,r,_){V_.apply(void 0,[e,t,r].concat(_))}var Mn=/([A-Z])/g;function xn(e){try{return null!=e?e.toString().slice(0,30):e}catch(e){return"[ERROR] Exception while trying to serialize the value"}}function yn(e,t){for(var r=t;r<e.def.nodes.length;r++){var _=e.def.nodes[r];if(16384&_.flags&&_.bindings&&_.bindings.length)return r}return null}function wn(e,t){for(var r=t;r<e.def.nodes.length;r++){var _=e.def.nodes[r];if(3&_.flags&&_.bindings&&_.bindings.length)return r}return null}var Un=function(){function e(e,t){this.view=e,this.nodeIndex=t,null==t&&(this.nodeIndex=t=0),this.nodeDef=e.def.nodes[t];for(var r=this.nodeDef,_=e;r&&0==(1&r.flags);)r=r.parent;if(!r)for(;!r&&_;)r=cr(_),_=_.parent;this.elDef=r,this.elView=_}return Object.defineProperty(e.prototype,"elOrCompView",{get:function(){return Bt(this.elView,this.elDef.nodeIndex).componentView||this.view},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"injector",{get:function(){return e_(this.elView,this.elDef)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"component",{get:function(){return this.elOrCompView.component},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"context",{get:function(){return this.elOrCompView.context},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"providerTokens",{get:function(){var e=[];if(this.elDef)for(var t=this.elDef.nodeIndex+1;t<=this.elDef.nodeIndex+this.elDef.childCount;t++){var r=this.elView.def.nodes[t];20224&r.flags&&e.push(r.provider.token),t+=r.childCount}return e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"references",{get:function(){var e={};if(this.elDef){Cn(this.elView,this.elDef,e);for(var t=this.elDef.nodeIndex+1;t<=this.elDef.nodeIndex+this.elDef.childCount;t++){var r=this.elView.def.nodes[t];20224&r.flags&&Cn(this.elView,r,e),t+=r.childCount}}return e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"componentRenderElement",{get:function(){var e=function(e){for(;e&&!Tr(e);)e=e.parent;return e.parent?Bt(e.parent,cr(e).nodeIndex):null}(this.elOrCompView);return e?e.renderElement:void 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderNode",{get:function(){return 2&this.nodeDef.flags?lr(this.view,this.nodeDef):lr(this.elView,this.elDef)},enumerable:!0,configurable:!0}),e.prototype.logError=function(e){for(var t,r,_=[],n=1;n<arguments.length;n++)_[n-1]=arguments[n];2&this.nodeDef.flags?(t=this.view.def,r=this.nodeDef.nodeIndex):(t=this.elView.def,r=this.elDef.nodeIndex);var a=function(e,t){for(var r=-1,_=0;_<=t;_++)3&e.nodes[_].flags&&r++;return r}(t,r),o=-1;t.factory(function(){return++o===a?(t=e.error).bind.apply(t,[e].concat(_)):Wt;var t}),o<a&&(e.error("Illegal state: the ViewDefinitionFactory did not call the logger!"),e.error.apply(e,_))},e}();function Cn(e,t,r){for(var _ in t.references)r[_]=L_(e,t,t.references[_])}function Dn(e,t,r,_){var n=On,a=vn,o=Nn;try{On=e;var i=t.apply(r,_);return vn=a,Nn=o,On=n,i}catch(e){if(W(e)||!vn)throw e;throw function(e,t){return e instanceof Error||(e=new Error(e.toString())),jt(e,t),e}(e,Fn())}}function Fn(){return vn?new Un(vn,Nn):null}var Gn=function(){function e(e){this.delegate=e}return e.prototype.createRenderer=function(e,t){return new kn(this.delegate.createRenderer(e,t))},e.prototype.begin=function(){this.delegate.begin&&this.delegate.begin()},e.prototype.end=function(){this.delegate.end&&this.delegate.end()},e.prototype.whenRenderingDone=function(){return this.delegate.whenRenderingDone?this.delegate.whenRenderingDone():Promise.resolve(null)},e}(),kn=function(){function e(e){this.delegate=e,this.data=this.delegate.data}return e.prototype.destroyNode=function(e){!function(e){st.delete(e.nativeNode)}(Et(e)),this.delegate.destroyNode&&this.delegate.destroyNode(e)},e.prototype.destroy=function(){this.delegate.destroy()},e.prototype.createElement=function(e,t){var r=this.delegate.createElement(e,t),_=Fn();if(_){var n=new at(r,null,_);n.name=e,ct(n)}return r},e.prototype.createComment=function(e){var t=this.delegate.createComment(e),r=Fn();return r&&ct(new nt(t,null,r)),t},e.prototype.createText=function(e){var t=this.delegate.createText(e),r=Fn();return r&&ct(new nt(t,null,r)),t},e.prototype.appendChild=function(e,t){var r=Et(e),_=Et(t);r&&_&&r instanceof at&&r.addChild(_),this.delegate.appendChild(e,t)},e.prototype.insertBefore=function(e,t,r){var _=Et(e),n=Et(t),a=Et(r);_&&n&&_ instanceof at&&_.insertBefore(a,n),this.delegate.insertBefore(e,t,r)},e.prototype.removeChild=function(e,t){var r=Et(e),_=Et(t);r&&_&&r instanceof at&&r.removeChild(_),this.delegate.removeChild(e,t)},e.prototype.selectRootElement=function(e){var t=this.delegate.selectRootElement(e),r=Fn();return r&&ct(new at(t,null,r)),t},e.prototype.setAttribute=function(e,t,r,_){var n=Et(e);n&&n instanceof at&&(n.attributes[_?_+":"+t:t]=r),this.delegate.setAttribute(e,t,r,_)},e.prototype.removeAttribute=function(e,t,r){var _=Et(e);_&&_ instanceof at&&(_.attributes[r?r+":"+t:t]=null),this.delegate.removeAttribute(e,t,r)},e.prototype.addClass=function(e,t){var r=Et(e);r&&r instanceof at&&(r.classes[t]=!0),this.delegate.addClass(e,t)},e.prototype.removeClass=function(e,t){var r=Et(e);r&&r instanceof at&&(r.classes[t]=!1),this.delegate.removeClass(e,t)},e.prototype.setStyle=function(e,t,r,_){var n=Et(e);n&&n instanceof at&&(n.styles[t]=r),this.delegate.setStyle(e,t,r,_)},e.prototype.removeStyle=function(e,t,r){var _=Et(e);_&&_ instanceof at&&(_.styles[t]=null),this.delegate.removeStyle(e,t,r)},e.prototype.setProperty=function(e,t,r){var _=Et(e);_&&_ instanceof at&&(_.properties[t]=r),this.delegate.setProperty(e,t,r)},e.prototype.listen=function(e,t,r){if("string"!=typeof e){var _=Et(e);_&&_.listeners.push(new function(e,t){this.name=e,this.callback=t}(t,r))}return this.delegate.listen(e,t,r)},e.prototype.parentNode=function(e){return this.delegate.parentNode(e)},e.prototype.nextSibling=function(e){return this.delegate.nextSibling(e)},e.prototype.setValue=function(e,t){return this.delegate.setValue(e,t)},e}();function Kn(e,t,r){return new Xn(e,t,r)}var Bn,Xn=function(e){function t(t,r,_){var n=e.call(this)||this;return n.moduleType=t,n._bootstrapComponents=r,n._ngModuleDefFactory=_,n}return Object(_.b)(t,e),t.prototype.create=function(e){!function(){if(!rn){rn=!0;var e=Qe()?{setCurrentNode:hn,createRootView:nn,createEmbeddedView:on,createComponentView:sn,createNgModuleRef:En,overrideProvider:Tn,overrideComponentView:un,clearOverrides:dn,checkAndUpdateView:Sn,checkNoChangesView:pn,destroyView:mn,createDebugContext:function(e,t){return new Un(e,t)},handleEvent:Rn,updateDirectives:In,updateRenderer:bn}:{setCurrentNode:function(){},createRootView:_n,createEmbeddedView:D_,createComponentView:G_,createNgModuleRef:n_,overrideProvider:Wt,overrideComponentView:Wt,clearOverrides:Wt,checkAndUpdateView:H_,checkNoChangesView:X_,destroyView:q_,createDebugContext:function(e,t){return new Un(e,t)},handleEvent:function(e,t,r,_){return e.def.handleEvent(e,t,r,_)},updateDirectives:function(e,t){return e.def.updateDirectives(0===t?Pn:An,e)},updateRenderer:function(e,t){return e.def.updateRenderer(0===t?Pn:An,e)}};zt.setCurrentNode=e.setCurrentNode,zt.createRootView=e.createRootView,zt.createEmbeddedView=e.createEmbeddedView,zt.createComponentView=e.createComponentView,zt.createNgModuleRef=e.createNgModuleRef,zt.overrideProvider=e.overrideProvider,zt.overrideComponentView=e.overrideComponentView,zt.clearOverrides=e.clearOverrides,zt.checkAndUpdateView=e.checkAndUpdateView,zt.checkNoChangesView=e.checkNoChangesView,zt.destroyView=e.destroyView,zt.resolveDep=O_,zt.createDebugContext=e.createDebugContext,zt.handleEvent=e.handleEvent,zt.updateDirectives=e.updateDirectives,zt.updateRenderer=e.updateRenderer,zt.dirtyParentQueries=I_}}();var t=Sr(this._ngModuleDefFactory);return zt.createNgModuleRef(this.moduleType,e||y.NULL,this._bootstrapComponents,t)},t}(function(){});"undefined"==typeof ngDevMode&&("undefined"!=typeof window&&(window.ngDevMode=!0),"undefined"!=typeof self&&(self.ngDevMode=!0),"undefined"!=typeof e&&(e.ngDevMode=!0)),Bn=function(e,t,r){return{parent:Bn,id:null,node:null,data:[],ngStaticData:[],cleanup:null,renderer:null,child:null,tail:null,next:null,bindingStartIndex:null,creationMode:!0,viewHookStartIndex:null}}()}).call(t,r("DuR2"))},Ya8g:function(e,t){},YaPU:function(e,t,r){"use strict";var _=r("AMGY"),n=r("OVmG"),a=r("tLDX"),o=r("t7NR"),i=r("+CnV"),s=r("gIN1");r.d(t,"a",function(){return E});var E=function(){function e(e){this._isScalar=!1,e&&(this._subscribe=e)}return e.prototype.lift=function(t){var r=new e;return r.source=this,r.operator=t,r},e.prototype.subscribe=function(e,t,r){var _=this.operator,i=function(e,t,r){if(e){if(e instanceof n.a)return e;if(e[a.a])return e[a.a]()}return e||t||r?new n.a(e,t,r):new n.a(o.a)}(e,t,r);if(_?_.call(i,this.source):i.add(this.source||!i.syncErrorThrowable?this._subscribe(i):this._trySubscribe(i)),i.syncErrorThrowable&&(i.syncErrorThrowable=!1,i.syncErrorThrown))throw i.syncErrorValue;return i},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.syncErrorThrown=!0,e.syncErrorValue=t,e.error(t)}},e.prototype.forEach=function(e,t){var r=this;if(t||(_.a.Rx&&_.a.Rx.config&&_.a.Rx.config.Promise?t=_.a.Rx.config.Promise:_.a.Promise&&(t=_.a.Promise)),!t)throw new Error("no Promise impl found");return new t(function(t,_){var n;n=r.subscribe(function(t){if(n)try{e(t)}catch(e){_(e),n.unsubscribe()}else e(t)},_,t)})},e.prototype._subscribe=function(e){return this.source.subscribe(e)},e.prototype[i.a]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];return 0===e.length?this:((r=e)?1===r.length?r[0]:function(e){return r.reduce(function(e,t){return t(e)},e)}:s.a)(this);var r},e.prototype.toPromise=function(e){var t=this;if(e||(_.a.Rx&&_.a.Rx.config&&_.a.Rx.config.Promise?e=_.a.Rx.config.Promise:_.a.Promise&&(e=_.a.Promise)),!e)throw new Error("no Promise impl found");return new e(function(e,r){var _;t.subscribe(function(e){return _=e},function(e){return r(e)},function(){return e(_)})})},e.create=function(t){return new e(t)},e}()},cQXm:function(e,t,r){"use strict";t.a=function(e){return e&&"function"!=typeof e.subscribe&&"function"==typeof e.then}},dgOU:function(e,t,r){"use strict";t.a=function(e){return null!=e&&"object"==typeof e}},etqZ:function(e,t,r){"use strict";r.d(t,"a",function(){return _});var _=function(e){var t=e.Symbol;if("function"==typeof t)return t.iterator||(t.iterator=t("iterator polyfill")),t.iterator;var r=e.Set;if(r&&"function"==typeof(new r)["@@iterator"])return"@@iterator";var _=e.Map;if(_)for(var n=Object.getOwnPropertyNames(_.prototype),a=0;a<n.length;++a){var o=n[a];if("entries"!==o&&"size"!==o&&_.prototype[o]===_.prototype.entries)return o}return"@@iterator"}(r("AMGY").a)},fKB6:function(e,t,r){"use strict";r.d(t,"a",function(){return _});var _={e:{}}},g5jc:function(e,t,r){"use strict";var _=r("TToO"),n=r("YaPU"),a=r("OVmG"),o=r("VwZZ"),i=function(e){function t(){var t=e.call(this,"object unsubscribed");this.name=t.name="ObjectUnsubscribedError",this.stack=t.stack,this.message=t.message}return Object(_.b)(t,e),t}(Error),s=function(e){function t(t,r){e.call(this),this.subject=t,this.subscriber=r,this.closed=!1}return Object(_.b)(t,e),t.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var e=this.subject,t=e.observers;if(this.subject=null,t&&0!==t.length&&!e.isStopped&&!e.closed){var r=t.indexOf(this.subscriber);-1!==r&&t.splice(r,1)}}},t}(o.a),E=r("tLDX");r.d(t,"b",function(){return c}),r.d(t,"a",function(){return l});var c=function(e){function t(t){e.call(this,t),this.destination=t}return Object(_.b)(t,e),t}(a.a),l=function(e){function t(){e.call(this),this.observers=[],this.closed=!1,this.isStopped=!1,this.hasError=!1,this.thrownError=null}return Object(_.b)(t,e),t.prototype[E.a]=function(){return new c(this)},t.prototype.lift=function(e){var t=new T(this,this);return t.operator=e,t},t.prototype.next=function(e){if(this.closed)throw new i;if(!this.isStopped)for(var t=this.observers,r=t.length,_=t.slice(),n=0;n<r;n++)_[n].next(e)},t.prototype.error=function(e){if(this.closed)throw new i;this.hasError=!0,this.thrownError=e,this.isStopped=!0;for(var t=this.observers,r=t.length,_=t.slice(),n=0;n<r;n++)_[n].error(e);this.observers.length=0},t.prototype.complete=function(){if(this.closed)throw new i;this.isStopped=!0;for(var e=this.observers,t=e.length,r=e.slice(),_=0;_<t;_++)r[_].complete();this.observers.length=0},t.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},t.prototype._trySubscribe=function(t){if(this.closed)throw new i;return e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){if(this.closed)throw new i;return this.hasError?(e.error(this.thrownError),o.a.EMPTY):this.isStopped?(e.complete(),o.a.EMPTY):(this.observers.push(e),new s(this,e))},t.prototype.asObservable=function(){var e=new n.a;return e.source=this,e},t.create=function(e,t){return new T(e,t)},t}(n.a),T=function(e){function t(t,r){e.call(this),this.destination=t,this.source=r}return Object(_.b)(t,e),t.prototype.next=function(e){var t=this.destination;t&&t.next&&t.next(e)},t.prototype.error=function(e){var t=this.destination;t&&t.error&&this.destination.error(e)},t.prototype.complete=function(){var e=this.destination;e&&e.complete&&this.destination.complete()},t.prototype._subscribe=function(e){return this.source?this.source.subscribe(e):o.a.EMPTY},t}(l)},gIN1:function(e,t,r){"use strict";t.a=function(){}},mP56:function(e,t,r){(function(t){e.exports=function(e){var _,n="undefined"!=typeof(e=e||{})?e:{},a={};for(_ in n)n.hasOwnProperty(_)&&(a[_]=n[_]);n.arguments=[],n.thisProgram="./this.program",n.quit=function(e,t){throw t},n.preRun=[],n.postRun=[];var o,i,s=!1,E=!1,c=!1,l=!1;if(n.ENVIRONMENT)if("WEB"===n.ENVIRONMENT)s=!0;else if("WORKER"===n.ENVIRONMENT)E=!0;else if("NODE"===n.ENVIRONMENT)c=!0;else{if("SHELL"!==n.ENVIRONMENT)throw new Error("Module['ENVIRONMENT'] value is not valid. must be one of: WEB|WORKER|NODE|SHELL.");l=!0}else s="object"==typeof window,E="function"==typeof importScripts,c="object"==typeof t&&!s&&!E,l=!s&&!c&&!E;for(_ in c?(n.read=function(e,t){var _;return o||(o=r("Ya8g")),i||(i=r("o/zv")),e=i.normalize(e),_=o.readFileSync(e),t?_:_.toString()},n.readBinary=function(e){var t=n.read(e,!0);return t.buffer||(t=new Uint8Array(t)),N(t.buffer),t},t.argv.length>1&&(n.thisProgram=t.argv[1].replace(/\\/g,"/")),n.arguments=t.argv.slice(2),t.on("uncaughtException",function(e){if(!(e instanceof k))throw e}),t.on("unhandledRejection",function(e,r){t.exit(1)}),n.inspect=function(){return"[Emscripten Module object]"}):l?("undefined"!=typeof read&&(n.read=function(e){return read(e)}),n.readBinary=function(e){var t;return"function"==typeof readbuffer?new Uint8Array(readbuffer(e)):(N("object"==typeof(t=read(e,"binary"))),t)},"undefined"!=typeof scriptArgs?n.arguments=scriptArgs:"undefined"!=typeof arguments&&(n.arguments=arguments),"function"==typeof quit&&(n.quit=function(e,t){quit(e)})):(s||E)&&(n.read=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},E&&(n.readBinary=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),n.readAsync=function(e,t,r){var _=new XMLHttpRequest;_.open("GET",e,!0),_.responseType="arraybuffer",_.onload=function(){200==_.status||0==_.status&&_.response?t(_.response):r()},_.onerror=r,_.send(null)},"undefined"!=typeof arguments&&(n.arguments=arguments),n.setWindowTitle=function(e){document.title=e}),n.print="undefined"!=typeof console?console.log:"undefined"!=typeof print?print:null,n.printErr="undefined"!=typeof printErr?printErr:"undefined"!=typeof console&&console.warn||n.print,n.print=n.print,n.printErr=n.printErr,a)a.hasOwnProperty(_)&&(n[_]=a[_]);a=void 0;var T=16;function u(e,t){return t||(t=T),Math.ceil(e/t)*t}new Array(0);var d,f,P,A,S,p,m,O,v=0;function N(e,t){e||B("Assertion failed: "+t)}function g(){n.HEAP8=new Int8Array(d),n.HEAP16=P=new Int16Array(d),n.HEAP32=A=new Int32Array(d),n.HEAPU8=f=new Uint8Array(d),n.HEAPU16=new Uint16Array(d),n.HEAPU32=new Uint32Array(d),n.HEAPF32=new Float32Array(d),n.HEAPF64=new Float64Array(d)}"undefined"!=typeof TextDecoder&&new TextDecoder("utf8"),"undefined"!=typeof TextDecoder&&new TextDecoder("utf-16le"),S=0,p=!1;var h=n.TOTAL_STACK||5242880,R=n.TOTAL_MEMORY||16777216;if(R<h&&n.printErr("TOTAL_MEMORY should be larger than TOTAL_STACK, was "+R+"! (TOTAL_STACK="+h+")"),n.buffer?d=n.buffer:("object"==typeof WebAssembly&&"function"==typeof WebAssembly.Memory?(n.wasmMemory=new WebAssembly.Memory({initial:R/65536,maximum:R/65536}),d=n.wasmMemory.buffer):d=new ArrayBuffer(R),n.buffer=d),g(),A[0]=1668509029,P[1]=25459,115!==f[2]||99!==f[3])throw"Runtime error: expected the system to be little-endian!";function I(e){for(;e.length>0;){var t=e.shift();if("function"!=typeof t){var r=t.func;"number"==typeof r?void 0===t.arg?n.dynCall_v(r):n.dynCall_vi(r,t.arg):r(void 0===t.arg?null:t.arg)}else t()}}var b=[],Y=[],L=[],M=[],x=[],y=!1;Math,Math,Math,Math,Math,Math,Math,Math,Math,Math,Math,Math,Math,Math,Math,Math,Math,Math,Math,Math,Math;var w=0,U=null,C=null;n.preloadedImages={},n.preloadedAudios={};var D="data:application/octet-stream;base64,";function F(e){return String.prototype.startsWith?e.startsWith(D):0===e.indexOf(D)}!function(){var e="mouse_event.wast",t="assets/mouse_event.wasm",r="mouse_event.temp.asm.js";"function"==typeof n.locateFile&&(F(e)||(e=n.locateFile(e)),F(t)||(t=n.locateFile(t)),F(r)||(r=n.locateFile(r)));var _={global:null,env:null,asm2wasm:{"f64-rem":function(e,t){return e%t},debugger:function(){}},parent:n},a=null;function o(){try{if(n.wasmBinary)return new Uint8Array(n.wasmBinary);if(n.readBinary)return n.readBinary(t);throw"on the web, we need the wasm binary to be preloaded and set on Module['wasmBinary']. emcc.py will do that for you when generating HTML (but not JS)"}catch(e){B(e)}}function i(e,r,i){if("object"!=typeof WebAssembly)return n.printErr("no native wasm support detected"),!1;if(!(n.wasmMemory instanceof WebAssembly.Memory))return n.printErr("no native wasm Memory in use"),!1;function c(e,t){(a=e.exports).memory&&function(e){var t=n.buffer;e.byteLength<t.byteLength&&n.printErr("the new buffer in mergeMemory is smaller than the previous one. in native wasm, we should grow memory here");var r=new Int8Array(t);new Int8Array(e).set(r),n.buffer=d=e,g()}(a.memory),n.asm=a,n.usingWasm=!0,function(e){if(w--,n.monitorRunDependencies&&n.monitorRunDependencies(w),0==w&&(null!==U&&(clearInterval(U),U=null),C)){var t=C;C=null,t()}}()}if(r.memory=n.wasmMemory,_.global={NaN:NaN,Infinity:1/0},_["global.Math"]=Math,_.env=r,w++,n.monitorRunDependencies&&n.monitorRunDependencies(w),n.instantiateWasm)try{return n.instantiateWasm(_,c)}catch(e){return n.printErr("Module.instantiateWasm callback failed with error: "+e),!1}function l(e){c(e.instance)}function T(e){(n.wasmBinary||!s&&!E||"function"!=typeof fetch?new Promise(function(e,t){e(o())}):fetch(t,{credentials:"same-origin"}).then(function(e){if(!e.ok)throw"failed to load wasm binary file at '"+t+"'";return e.arrayBuffer()}).catch(function(){return o()})).then(function(e){return WebAssembly.instantiate(e,_)}).then(e).catch(function(e){n.printErr("failed to asynchronously prepare wasm: "+e),B(e)})}return n.wasmBinary||"function"!=typeof WebAssembly.instantiateStreaming||F(t)||"function"!=typeof fetch?T(l):WebAssembly.instantiateStreaming(fetch(t,{credentials:"same-origin"}),_).then(l).catch(function(e){n.printErr("wasm streaming compile failed: "+e),n.printErr("falling back to ArrayBuffer instantiation"),T(l)}),{}}n.asmPreload=n.asm;var c=n.reallocBuffer;n.reallocBuffer=function(e){return"asmjs"===l?c(e):function(e){var t,r;(t=e)%(r=n.usingWasm?65536:16777216)>0&&(t+=r-t%r),e=t;var _=n.buffer.byteLength;if(n.usingWasm)try{return-1!==n.wasmMemory.grow((e-_)/65536)?n.buffer=n.wasmMemory.buffer:null}catch(e){return null}}(e)};var l="";n.asm=function(e,t,r){var _;if(!(t=t).table){var a=n.wasmTableSize;void 0===a&&(a=1024);var o=n.wasmMaxTableSize;t.table="object"==typeof WebAssembly&&"function"==typeof WebAssembly.Table?void 0!==o?new WebAssembly.Table({initial:a,maximum:o,element:"anyfunc"}):new WebAssembly.Table({initial:a,element:"anyfunc"}):new Array(a),n.wasmTable=t.table}return t.memoryBase||(t.memoryBase=n.STATIC_BASE),t.tableBase||(t.tableBase=0),(_=i(0,t))||B("no binaryen method succeeded. consider enabling more options, like interpreting, if you want that: https://github.com/kripken/emscripten/wiki/WebAssembly#binaryen-methods"),_}}(),S=2560,Y.push(),n.STATIC_BASE=1024,n.STATIC_BUMP=1536,S+=16,O=function(e){N(!p);var t=S;return S=S+4+15&-16,t}(),m=u(u(S)+h),A[O>>2]=m,p=!0,n.wasmTableSize=0,n.wasmMaxTableSize=0,n.asmGlobalArg={},n.asmLibraryArg={};var G=n.asm(n.asmGlobalArg,n.asmLibraryArg,d);function k(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function K(e){function t(){n.calledRun||(n.calledRun=!0,v||(y||(y=!0,I(Y)),I(L),n.onRuntimeInitialized&&n.onRuntimeInitialized(),function(){if(n.postRun)for("function"==typeof n.postRun&&(n.postRun=[n.postRun]);n.postRun.length;)e=n.postRun.shift(),x.unshift(e);var e;I(x)}()))}e=e||n.arguments,w>0||(function(){if(n.preRun)for("function"==typeof n.preRun&&(n.preRun=[n.preRun]);n.preRun.length;)e=n.preRun.shift(),b.unshift(e);var e;I(b)}(),w>0||n.calledRun||(n.setStatus?(n.setStatus("Running..."),setTimeout(function(){setTimeout(function(){n.setStatus("")},1),t()},1)):t()))}function B(e){throw n.onAbort&&n.onAbort(e),void 0!==e?(n.print(e),n.printErr(e),e=JSON.stringify(e)):e="",v=!0,"abort("+e+"). Build with -s ASSERTIONS=1 for more info."}if(n.asm=G,n._translate_x=function(){return n.asm._translate_x.apply(null,arguments)},n._translate_y=function(){return n.asm._translate_y.apply(null,arguments)},n.asm=G,n.then=function(e){if(n.calledRun)e(n);else{var t=n.onRuntimeInitialized;n.onRuntimeInitialized=function(){t&&t(),e(n)}}return n},(k.prototype=new Error).constructor=k,C=function e(){n.calledRun||K(),n.calledRun||(C=e)},n.run=K,n.exit=function(e,r){r&&n.noExitRuntime&&0===e||(n.noExitRuntime||(v=!0,I(M),n.onExit&&n.onExit(e)),c&&t.exit(e),n.quit(e,new k(e)))},n.abort=B,n.preInit)for("function"==typeof n.preInit&&(n.preInit=[n.preInit]);n.preInit.length>0;)n.preInit.pop()();return n.noExitRuntime=!0,K(),e}}).call(t,r("W2nU"))},"o/zv":function(e,t,r){(function(e){function r(e,t){for(var r=0,_=e.length-1;_>=0;_--){var n=e[_];"."===n?e.splice(_,1):".."===n?(e.splice(_,1),r++):r&&(e.splice(_,1),r--)}if(t)for(;r--;r)e.unshift("..");return e}var _=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,n=function(e){return _.exec(e).slice(1)};function a(e,t){if(e.filter)return e.filter(t);for(var r=[],_=0;_<e.length;_++)t(e[_],_,e)&&r.push(e[_]);return r}t.resolve=function(){for(var t="",_=!1,n=arguments.length-1;n>=-1&&!_;n--){var o=n>=0?arguments[n]:e.cwd();if("string"!=typeof o)throw new TypeError("Arguments to path.resolve must be strings");o&&(t=o+"/"+t,_="/"===o.charAt(0))}return t=r(a(t.split("/"),function(e){return!!e}),!_).join("/"),(_?"/":"")+t||"."},t.normalize=function(e){var _=t.isAbsolute(e),n="/"===o(e,-1);return(e=r(a(e.split("/"),function(e){return!!e}),!_).join("/"))||_||(e="."),e&&n&&(e+="/"),(_?"/":"")+e},t.isAbsolute=function(e){return"/"===e.charAt(0)},t.join=function(){var e=Array.prototype.slice.call(arguments,0);return t.normalize(a(e,function(e,t){if("string"!=typeof e)throw new TypeError("Arguments to path.join must be strings");return e}).join("/"))},t.relative=function(e,r){function _(e){for(var t=0;t<e.length&&""===e[t];t++);for(var r=e.length-1;r>=0&&""===e[r];r--);return t>r?[]:e.slice(t,r-t+1)}e=t.resolve(e).substr(1),r=t.resolve(r).substr(1);for(var n=_(e.split("/")),a=_(r.split("/")),o=Math.min(n.length,a.length),i=o,s=0;s<o;s++)if(n[s]!==a[s]){i=s;break}var E=[];for(s=i;s<n.length;s++)E.push("..");return(E=E.concat(a.slice(i))).join("/")},t.sep="/",t.delimiter=":",t.dirname=function(e){var t=n(e),r=t[0],_=t[1];return r||_?(_&&(_=_.substr(0,_.length-1)),r+_):"."},t.basename=function(e,t){var r=n(e)[2];return t&&r.substr(-1*t.length)===t&&(r=r.substr(0,r.length-t.length)),r},t.extname=function(e){return n(e)[3]};var o="b"==="ab".substr(-1)?function(e,t,r){return e.substr(t,r)}:function(e,t,r){return t<0&&(t=e.length+t),e.substr(t,r)}}).call(t,r("W2nU"))},t7NR:function(e,t,r){"use strict";r.d(t,"a",function(){return _});var _={closed:!0,next:function(e){},error:function(e){throw e},complete:function(){}}},tLDX:function(e,t,r){"use strict";r.d(t,"a",function(){return n});var _=r("AMGY").a.Symbol,n="function"==typeof _&&"function"==typeof _.for?_.for("rxSubscriber"):"@@rxSubscriber"},tZ2B:function(e,t,r){"use strict";r.d(t,"a",function(){return n});var _=r("TToO"),n=function(e){function t(){e.apply(this,arguments)}return Object(_.b)(t,e),t.prototype.notifyNext=function(e,t,r,_,n){this.destination.next(t)},t.prototype.notifyError=function(e,t){this.destination.error(e)},t.prototype.notifyComplete=function(e){this.destination.complete()},t}(r("OVmG").a)},x35b:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var _={};r.d(_,"create",function(){return p}),r.d(_,"fromMat4",function(){return m}),r.d(_,"clone",function(){return O}),r.d(_,"copy",function(){return v}),r.d(_,"identity",function(){return N}),r.d(_,"transpose",function(){return g}),r.d(_,"invert",function(){return h}),r.d(_,"adjoint",function(){return R}),r.d(_,"determinant",function(){return I}),r.d(_,"multiply",function(){return b}),r.d(_,"mul",function(){return b}),r.d(_,"translate",function(){return Y}),r.d(_,"rotate",function(){return L}),r.d(_,"scale",function(){return M}),r.d(_,"fromTranslation",function(){return x}),r.d(_,"fromRotation",function(){return y}),r.d(_,"fromScaling",function(){return w}),r.d(_,"fromMat2d",function(){return U}),r.d(_,"fromQuat",function(){return C}),r.d(_,"normalFromMat4",function(){return D}),r.d(_,"str",function(){return F}),r.d(_,"frob",function(){return G});var n={};r.d(n,"create",function(){return B}),r.d(n,"clone",function(){return X}),r.d(n,"copy",function(){return H}),r.d(n,"identity",function(){return Q}),r.d(n,"transpose",function(){return z}),r.d(n,"invert",function(){return V}),r.d(n,"adjoint",function(){return j}),r.d(n,"determinant",function(){return q}),r.d(n,"multiply",function(){return W}),r.d(n,"mul",function(){return W}),r.d(n,"translate",function(){return J}),r.d(n,"scale",function(){return Z}),r.d(n,"rotate",function(){return $}),r.d(n,"rotateX",function(){return ee}),r.d(n,"rotateY",function(){return te}),r.d(n,"rotateZ",function(){return re}),r.d(n,"fromTranslation",function(){return _e}),r.d(n,"fromScaling",function(){return ne}),r.d(n,"fromRotation",function(){return ae}),r.d(n,"fromXRotation",function(){return oe}),r.d(n,"fromYRotation",function(){return ie}),r.d(n,"fromZRotation",function(){return se}),r.d(n,"fromRotationTranslation",function(){return Ee}),r.d(n,"fromRotationTranslationScale",function(){return ce}),r.d(n,"fromRotationTranslationScaleOrigin",function(){return le}),r.d(n,"fromQuat",function(){return Te}),r.d(n,"frustum",function(){return ue}),r.d(n,"perspective",function(){return de}),r.d(n,"perspectiveFromFieldOfView",function(){return fe}),r.d(n,"ortho",function(){return Pe}),r.d(n,"lookAt",function(){return Ae}),r.d(n,"str",function(){return Se}),r.d(n,"frob",function(){return pe});var a={};r.d(a,"create",function(){return ve}),r.d(a,"clone",function(){return Ne}),r.d(a,"fromValues",function(){return ge}),r.d(a,"copy",function(){return he}),r.d(a,"set",function(){return Re}),r.d(a,"add",function(){return Ie}),r.d(a,"subtract",function(){return be}),r.d(a,"sub",function(){return be}),r.d(a,"multiply",function(){return Ye}),r.d(a,"mul",function(){return Ye}),r.d(a,"divide",function(){return Le}),r.d(a,"div",function(){return Le}),r.d(a,"min",function(){return Me}),r.d(a,"max",function(){return xe}),r.d(a,"scale",function(){return ye}),r.d(a,"scaleAndAdd",function(){return we}),r.d(a,"distance",function(){return Ue}),r.d(a,"dist",function(){return Ue}),r.d(a,"squaredDistance",function(){return Ce}),r.d(a,"sqrDist",function(){return Ce}),r.d(a,"length",function(){return De}),r.d(a,"len",function(){return De}),r.d(a,"squaredLength",function(){return Fe}),r.d(a,"sqrLen",function(){return Fe}),r.d(a,"negate",function(){return Ge}),r.d(a,"inverse",function(){return ke}),r.d(a,"normalize",function(){return Ke}),r.d(a,"dot",function(){return Be}),r.d(a,"cross",function(){return Xe}),r.d(a,"lerp",function(){return He}),r.d(a,"hermite",function(){return Qe}),r.d(a,"bezier",function(){return ze}),r.d(a,"random",function(){return Ve}),r.d(a,"transformMat4",function(){return je}),r.d(a,"transformMat3",function(){return qe}),r.d(a,"transformQuat",function(){return We}),r.d(a,"rotateX",function(){return Je}),r.d(a,"rotateY",function(){return Ze}),r.d(a,"rotateZ",function(){return $e}),r.d(a,"forEach",function(){return tt}),r.d(a,"angle",function(){return rt}),r.d(a,"str",function(){return _t});var o={};r.d(o,"create",function(){return tr}),r.d(o,"clone",function(){return rr}),r.d(o,"fromValues",function(){return _r}),r.d(o,"copy",function(){return nr}),r.d(o,"set",function(){return ar}),r.d(o,"add",function(){return or}),r.d(o,"subtract",function(){return ir}),r.d(o,"sub",function(){return ir}),r.d(o,"multiply",function(){return sr}),r.d(o,"mul",function(){return sr}),r.d(o,"divide",function(){return Er}),r.d(o,"div",function(){return Er}),r.d(o,"min",function(){return cr}),r.d(o,"max",function(){return lr}),r.d(o,"scale",function(){return Tr}),r.d(o,"scaleAndAdd",function(){return ur}),r.d(o,"distance",function(){return dr}),r.d(o,"dist",function(){return dr}),r.d(o,"squaredDistance",function(){return fr}),r.d(o,"sqrDist",function(){return fr}),r.d(o,"length",function(){return Pr}),r.d(o,"len",function(){return Pr}),r.d(o,"squaredLength",function(){return Ar}),r.d(o,"sqrLen",function(){return Ar}),r.d(o,"negate",function(){return Sr}),r.d(o,"inverse",function(){return pr}),r.d(o,"normalize",function(){return mr}),r.d(o,"dot",function(){return Or}),r.d(o,"lerp",function(){return vr}),r.d(o,"random",function(){return Nr}),r.d(o,"transformMat4",function(){return gr}),r.d(o,"transformQuat",function(){return hr}),r.d(o,"forEach",function(){return Rr}),r.d(o,"str",function(){return Ir});var i={};r.d(i,"create",function(){return Yr}),r.d(i,"rotationTo",function(){return wr}),r.d(i,"setAxes",function(){return Ur}),r.d(i,"clone",function(){return rr}),r.d(i,"fromValues",function(){return _r}),r.d(i,"copy",function(){return nr}),r.d(i,"set",function(){return ar}),r.d(i,"identity",function(){return Cr}),r.d(i,"setAxisAngle",function(){return Dr}),r.d(i,"add",function(){return or}),r.d(i,"multiply",function(){return Fr}),r.d(i,"mul",function(){return Fr}),r.d(i,"scale",function(){return Tr}),r.d(i,"rotateX",function(){return Gr}),r.d(i,"rotateY",function(){return kr}),r.d(i,"rotateZ",function(){return Kr}),r.d(i,"calculateW",function(){return Br}),r.d(i,"dot",function(){return Or}),r.d(i,"lerp",function(){return vr}),r.d(i,"slerp",function(){return Xr}),r.d(i,"sqlerp",function(){return zr}),r.d(i,"invert",function(){return Vr}),r.d(i,"conjugate",function(){return jr}),r.d(i,"length",function(){return Pr}),r.d(i,"len",function(){return Pr}),r.d(i,"squaredLength",function(){return Ar}),r.d(i,"sqrLen",function(){return Ar}),r.d(i,"normalize",function(){return mr}),r.d(i,"fromMat3",function(){return qr}),r.d(i,"str",function(){return Wr});var s=r("WT6e"),E=function(){},c=!1;try{l=window.b4w}catch(e){l=self.b4w,c=!0}if(!l){var l={};c?self.b4w=l:window.b4w=l;var T={},u={};l.module=T,l._n_module=u;var d={};l.cleanup=function(e,t){t=t||"__b4w_default";var r=T[e];r&&(r._compiled=null),d[t]=null},l.register=function(e,t){T[e]||(T[e]=t)},l.require=function(e,t){if(!T[e]&&!u[e])throw new Error('Module "'+e+'" not found');return t=t||"__b4w_default",void 0!==u[e]?u[e](t):(d[t]||(d[t]=function(e){return function(t){if(!T[t]&&!u[t])throw new Error('Module "'+t+'" not found');if(void 0!==u[t])return u[t](e);var r=T[t];return r._compiled||(r._compiled={}),r._compiled[e]||(r._compiled[e]={},r(r._compiled[e],d[e])),r._compiled[e]}}(t)),d[t](e))},l.module_check=function(e){return void 0!==T[e]||void 0!==u[e]},l.get_namespace=function(e){for(var t in d)if(d[t]==e)return t;return""},l.worker_listeners=[],l.worker_namespaces=[]}var f=l,P={},A=function(e,t,r){var _={},n="__"==e.split("").slice(0,2).join("");function a(){return function(e){return void 0!==_[e=e||"__b4w_default"]?_[e]:(_[e]=n?{}:a(),t(e,_[e]),_[e])}}if(void 0!==P[e])return P[e];var o=n?a():a()();return f._n_module[e]=P[e]=o,o},S="undefined"!=typeof Float32Array?Float32Array:Array;function p(){var e=new S(9);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function m(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function O(e){var t=new S(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function v(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function N(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function g(e,t){if(t===e){var r=e[1],_=e[2],n=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=_,t[7]=n}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function h(e,t){var r=e[0],_=e[1],n=e[2],a=e[3],o=e[4],i=e[5],s=e[6],E=e[7],c=e[8],l=c*o-i*E,T=-c*a+i*s,u=E*a-o*s,d=r*l+_*T+n*u;return d?(t[0]=l*(d=1/d),t[1]=(-c*_+n*E)*d,t[2]=(i*_-n*o)*d,t[3]=T*d,t[4]=(c*r-n*s)*d,t[5]=(-i*r+n*a)*d,t[6]=u*d,t[7]=(-E*r+_*s)*d,t[8]=(o*r-_*a)*d,t):null}function R(e,t){var r=e[0],_=e[1],n=e[2],a=e[3],o=e[4],i=e[5],s=e[6],E=e[7],c=e[8];return t[0]=o*c-i*E,t[1]=n*E-_*c,t[2]=_*i-n*o,t[3]=i*s-a*c,t[4]=r*c-n*s,t[5]=n*a-r*i,t[6]=a*E-o*s,t[7]=_*s-r*E,t[8]=r*o-_*a,t}function I(e){var t=e[3],r=e[4],_=e[5],n=e[6],a=e[7],o=e[8];return e[0]*(o*r-_*a)+e[1]*(-o*t+_*n)+e[2]*(a*t-r*n)}function b(e,t,r){var _=e[0],n=e[1],a=e[2],o=e[3],i=e[4],s=e[5],E=e[6],c=e[7],l=e[8],T=t[0],u=t[1],d=t[2],f=t[3],P=t[4],A=t[5],S=t[6],p=t[7],m=t[8];return r[0]=T*_+u*o+d*E,r[1]=T*n+u*i+d*c,r[2]=T*a+u*s+d*l,r[3]=f*_+P*o+A*E,r[4]=f*n+P*i+A*c,r[5]=f*a+P*s+A*l,r[6]=S*_+p*o+m*E,r[7]=S*n+p*i+m*c,r[8]=S*a+p*s+m*l,r}function Y(e,t,r){var _=e[0],n=e[1],a=e[2],o=e[3],i=e[4],s=e[5],E=e[6],c=e[7],l=e[8],T=t[0],u=t[1];return r[0]=_,r[1]=n,r[2]=a,r[3]=o,r[4]=i,r[5]=s,r[6]=T*_+u*o+E,r[7]=T*n+u*i+c,r[8]=T*a+u*s+l,r}function L(e,t,r){var _=e[0],n=e[1],a=e[2],o=e[3],i=e[4],s=e[5],E=e[6],c=e[7],l=e[8],T=Math.sin(t),u=Math.cos(t);return r[0]=u*_+T*o,r[1]=u*n+T*i,r[2]=u*a+T*s,r[3]=u*o-T*_,r[4]=u*i-T*n,r[5]=u*s-T*a,r[6]=E,r[7]=c,r[8]=l,r}function M(e,t,r){var _=t[0],n=t[1];return r[0]=_*e[0],r[1]=_*e[1],r[2]=_*e[2],r[3]=n*e[3],r[4]=n*e[4],r[5]=n*e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r}function x(e,t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function y(e,t){var r=Math.sin(e),_=Math.cos(e);return t[0]=_,t[1]=r,t[2]=0,t[3]=-r,t[4]=_,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function w(e,t){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function U(e,t){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function C(e,t){var r=e[0],_=e[1],n=e[2],a=e[3],o=r+r,i=_+_,s=n+n,E=r*o,c=_*o,l=_*i,T=n*o,u=n*i,d=n*s,f=a*o,P=a*i,A=a*s;return t[0]=1-l-d,t[3]=c-A,t[6]=T+P,t[1]=c+A,t[4]=1-E-d,t[7]=u-f,t[2]=T-P,t[5]=u+f,t[8]=1-E-l,t}function D(e,t){var r=e[0],_=e[1],n=e[2],a=e[3],o=e[4],i=e[5],s=e[6],E=e[7],c=e[8],l=e[9],T=e[10],u=e[11],d=e[12],f=e[13],P=e[14],A=e[15],S=r*i-_*o,p=r*s-n*o,m=r*E-a*o,O=_*s-n*i,v=_*E-a*i,N=n*E-a*s,g=c*f-l*d,h=c*P-T*d,R=c*A-u*d,I=l*P-T*f,b=l*A-u*f,Y=T*A-u*P,L=S*Y-p*b+m*I+O*R-v*h+N*g;return L?(t[0]=(i*Y-s*b+E*I)*(L=1/L),t[1]=(s*R-o*Y-E*h)*L,t[2]=(o*b-i*R+E*g)*L,t[3]=(n*b-_*Y-a*I)*L,t[4]=(r*Y-n*R+a*h)*L,t[5]=(_*R-r*b-a*g)*L,t[6]=(f*N-P*v+A*O)*L,t[7]=(P*m-d*N-A*p)*L,t[8]=(d*v-f*m+A*S)*L,t):null}function F(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"}function G(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2))}Math;var k=1e-7,K="undefined"!=typeof Float32Array?Float32Array:Array;function B(){var e=new K(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function X(e){var t=new K(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function H(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Q(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function z(e,t){if(t===e){var r=e[1],_=e[2],n=e[3],a=e[6],o=e[7],i=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=_,t[9]=a,t[11]=e[14],t[12]=n,t[13]=o,t[14]=i}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function V(e,t){var r=e[0],_=e[1],n=e[2],a=e[3],o=e[4],i=e[5],s=e[6],E=e[7],c=e[8],l=e[9],T=e[10],u=e[11],d=e[12],f=e[13],P=e[14],A=e[15],S=r*i-_*o,p=r*s-n*o,m=r*E-a*o,O=_*s-n*i,v=_*E-a*i,N=n*E-a*s,g=c*f-l*d,h=c*P-T*d,R=c*A-u*d,I=l*P-T*f,b=l*A-u*f,Y=T*A-u*P,L=S*Y-p*b+m*I+O*R-v*h+N*g;return L?(t[0]=(i*Y-s*b+E*I)*(L=1/L),t[1]=(n*b-_*Y-a*I)*L,t[2]=(f*N-P*v+A*O)*L,t[3]=(T*v-l*N-u*O)*L,t[4]=(s*R-o*Y-E*h)*L,t[5]=(r*Y-n*R+a*h)*L,t[6]=(P*m-d*N-A*p)*L,t[7]=(c*N-T*m+u*p)*L,t[8]=(o*b-i*R+E*g)*L,t[9]=(_*R-r*b-a*g)*L,t[10]=(d*v-f*m+A*S)*L,t[11]=(l*m-c*v-u*S)*L,t[12]=(i*h-o*I-s*g)*L,t[13]=(r*I-_*h+n*g)*L,t[14]=(f*p-d*O-P*S)*L,t[15]=(c*O-l*p+T*S)*L,t):null}function j(e,t){var r=e[0],_=e[1],n=e[2],a=e[3],o=e[4],i=e[5],s=e[6],E=e[7],c=e[8],l=e[9],T=e[10],u=e[11],d=e[12],f=e[13],P=e[14],A=e[15];return t[0]=i*(T*A-u*P)-l*(s*A-E*P)+f*(s*u-E*T),t[1]=-(_*(T*A-u*P)-l*(n*A-a*P)+f*(n*u-a*T)),t[2]=_*(s*A-E*P)-i*(n*A-a*P)+f*(n*E-a*s),t[3]=-(_*(s*u-E*T)-i*(n*u-a*T)+l*(n*E-a*s)),t[4]=-(o*(T*A-u*P)-c*(s*A-E*P)+d*(s*u-E*T)),t[5]=r*(T*A-u*P)-c*(n*A-a*P)+d*(n*u-a*T),t[6]=-(r*(s*A-E*P)-o*(n*A-a*P)+d*(n*E-a*s)),t[7]=r*(s*u-E*T)-o*(n*u-a*T)+c*(n*E-a*s),t[8]=o*(l*A-u*f)-c*(i*A-E*f)+d*(i*u-E*l),t[9]=-(r*(l*A-u*f)-c*(_*A-a*f)+d*(_*u-a*l)),t[10]=r*(i*A-E*f)-o*(_*A-a*f)+d*(_*E-a*i),t[11]=-(r*(i*u-E*l)-o*(_*u-a*l)+c*(_*E-a*i)),t[12]=-(o*(l*P-T*f)-c*(i*P-s*f)+d*(i*T-s*l)),t[13]=r*(l*P-T*f)-c*(_*P-n*f)+d*(_*T-n*l),t[14]=-(r*(i*P-s*f)-o*(_*P-n*f)+d*(_*s-n*i)),t[15]=r*(i*T-s*l)-o*(_*T-n*l)+c*(_*s-n*i),t}function q(e){var t=e[0],r=e[1],_=e[2],n=e[3],a=e[4],o=e[5],i=e[6],s=e[7],E=e[8],c=e[9],l=e[10],T=e[11],u=e[12],d=e[13],f=e[14],P=e[15];return(t*o-r*a)*(l*P-T*f)-(t*i-_*a)*(c*P-T*d)+(t*s-n*a)*(c*f-l*d)+(r*i-_*o)*(E*P-T*u)-(r*s-n*o)*(E*f-l*u)+(_*s-n*i)*(E*d-c*u)}function W(e,t,r){var _=e[0],n=e[1],a=e[2],o=e[3],i=e[4],s=e[5],E=e[6],c=e[7],l=e[8],T=e[9],u=e[10],d=e[11],f=e[12],P=e[13],A=e[14],S=e[15],p=t[0],m=t[1],O=t[2],v=t[3];return r[0]=p*_+m*i+O*l+v*f,r[1]=p*n+m*s+O*T+v*P,r[2]=p*a+m*E+O*u+v*A,r[3]=p*o+m*c+O*d+v*S,r[4]=(p=t[4])*_+(m=t[5])*i+(O=t[6])*l+(v=t[7])*f,r[5]=p*n+m*s+O*T+v*P,r[6]=p*a+m*E+O*u+v*A,r[7]=p*o+m*c+O*d+v*S,r[8]=(p=t[8])*_+(m=t[9])*i+(O=t[10])*l+(v=t[11])*f,r[9]=p*n+m*s+O*T+v*P,r[10]=p*a+m*E+O*u+v*A,r[11]=p*o+m*c+O*d+v*S,r[12]=(p=t[12])*_+(m=t[13])*i+(O=t[14])*l+(v=t[15])*f,r[13]=p*n+m*s+O*T+v*P,r[14]=p*a+m*E+O*u+v*A,r[15]=p*o+m*c+O*d+v*S,r}function J(e,t,r){var _,n,a,o,i,s,E,c,l,T,u,d,f=t[0],P=t[1],A=t[2];return e===r?(r[12]=e[0]*f+e[4]*P+e[8]*A+e[12],r[13]=e[1]*f+e[5]*P+e[9]*A+e[13],r[14]=e[2]*f+e[6]*P+e[10]*A+e[14],r[15]=e[3]*f+e[7]*P+e[11]*A+e[15]):(n=e[1],a=e[2],o=e[3],i=e[4],s=e[5],E=e[6],c=e[7],l=e[8],T=e[9],u=e[10],d=e[11],r[0]=_=e[0],r[1]=n,r[2]=a,r[3]=o,r[4]=i,r[5]=s,r[6]=E,r[7]=c,r[8]=l,r[9]=T,r[10]=u,r[11]=d,r[12]=_*f+i*P+l*A+e[12],r[13]=n*f+s*P+T*A+e[13],r[14]=a*f+E*P+u*A+e[14],r[15]=o*f+c*P+d*A+e[15]),r}function Z(e,t,r){var _=t[0],n=t[1],a=t[2];return r[0]=e[0]*_,r[1]=e[1]*_,r[2]=e[2]*_,r[3]=e[3]*_,r[4]=e[4]*n,r[5]=e[5]*n,r[6]=e[6]*n,r[7]=e[7]*n,r[8]=e[8]*a,r[9]=e[9]*a,r[10]=e[10]*a,r[11]=e[11]*a,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function $(e,t,r,_){var n,a,o,i,s,E,c,l,T,u,d,f,P,A,S,p,m,O,v,N,g,h,R,I,b=r[0],Y=r[1],L=r[2],M=Math.sqrt(b*b+Y*Y+L*L);return Math.abs(M)<k?null:(b*=M=1/M,Y*=M,L*=M,n=Math.sin(t),a=Math.cos(t),s=e[1],E=e[2],c=e[3],T=e[5],u=e[6],d=e[7],P=e[9],A=e[10],S=e[11],v=b*Y*(o=1-a)-L*n,N=Y*Y*o+a,g=L*Y*o+b*n,h=b*L*o+Y*n,R=Y*L*o-b*n,I=L*L*o+a,_[0]=(i=e[0])*(p=b*b*o+a)+(l=e[4])*(m=Y*b*o+L*n)+(f=e[8])*(O=L*b*o-Y*n),_[1]=s*p+T*m+P*O,_[2]=E*p+u*m+A*O,_[3]=c*p+d*m+S*O,_[4]=i*v+l*N+f*g,_[5]=s*v+T*N+P*g,_[6]=E*v+u*N+A*g,_[7]=c*v+d*N+S*g,_[8]=i*h+l*R+f*I,_[9]=s*h+T*R+P*I,_[10]=E*h+u*R+A*I,_[11]=c*h+d*R+S*I,e!==_&&(_[12]=e[12],_[13]=e[13],_[14]=e[14],_[15]=e[15]),_)}function ee(e,t,r){var _=Math.sin(t),n=Math.cos(t),a=e[4],o=e[5],i=e[6],s=e[7],E=e[8],c=e[9],l=e[10],T=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=a*n+E*_,r[5]=o*n+c*_,r[6]=i*n+l*_,r[7]=s*n+T*_,r[8]=E*n-a*_,r[9]=c*n-o*_,r[10]=l*n-i*_,r[11]=T*n-s*_,r}function te(e,t,r){var _=Math.sin(t),n=Math.cos(t),a=e[0],o=e[1],i=e[2],s=e[3],E=e[8],c=e[9],l=e[10],T=e[11];return e!==r&&(r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=a*n-E*_,r[1]=o*n-c*_,r[2]=i*n-l*_,r[3]=s*n-T*_,r[8]=a*_+E*n,r[9]=o*_+c*n,r[10]=i*_+l*n,r[11]=s*_+T*n,r}function re(e,t,r){var _=Math.sin(t),n=Math.cos(t),a=e[0],o=e[1],i=e[2],s=e[3],E=e[4],c=e[5],l=e[6],T=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=a*n+E*_,r[1]=o*n+c*_,r[2]=i*n+l*_,r[3]=s*n+T*_,r[4]=E*n-a*_,r[5]=c*n-o*_,r[6]=l*n-i*_,r[7]=T*n-s*_,r}function _e(e,t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function ne(e,t){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ae(e,t,r){var _,n,a,o=t[0],i=t[1],s=t[2],E=Math.sqrt(o*o+i*i+s*s);return Math.abs(E)<k?null:(o*=E=1/E,i*=E,s*=E,_=Math.sin(e),n=Math.cos(e),r[0]=o*o*(a=1-n)+n,r[1]=i*o*a+s*_,r[2]=s*o*a-i*_,r[3]=0,r[4]=o*i*a-s*_,r[5]=i*i*a+n,r[6]=s*i*a+o*_,r[7]=0,r[8]=o*s*a+i*_,r[9]=i*s*a-o*_,r[10]=s*s*a+n,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r)}function oe(e,t){var r=Math.sin(e),_=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=_,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=_,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ie(e,t){var r=Math.sin(e),_=Math.cos(e);return t[0]=_,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=_,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function se(e,t){var r=Math.sin(e),_=Math.cos(e);return t[0]=_,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=_,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Ee(e,t,r){var _=e[0],n=e[1],a=e[2],o=e[3],i=_+_,s=n+n,E=a+a,c=_*i,l=_*s,T=_*E,u=n*s,d=n*E,f=a*E,P=o*i,A=o*s,S=o*E;return r[0]=1-(u+f),r[1]=l+S,r[2]=T-A,r[3]=0,r[4]=l-S,r[5]=1-(c+f),r[6]=d+P,r[7]=0,r[8]=T+A,r[9]=d-P,r[10]=1-(c+u),r[11]=0,r[12]=t[0],r[13]=t[1],r[14]=t[2],r[15]=1,r}function ce(e,t,r,_){var n=e[0],a=e[1],o=e[2],i=e[3],s=n+n,E=a+a,c=o+o,l=n*s,T=n*E,u=n*c,d=a*E,f=a*c,P=o*c,A=i*s,S=i*E,p=i*c,m=r[0],O=r[1],v=r[2];return _[0]=(1-(d+P))*m,_[1]=(T+p)*m,_[2]=(u-S)*m,_[3]=0,_[4]=(T-p)*O,_[5]=(1-(l+P))*O,_[6]=(f+A)*O,_[7]=0,_[8]=(u+S)*v,_[9]=(f-A)*v,_[10]=(1-(l+d))*v,_[11]=0,_[12]=t[0],_[13]=t[1],_[14]=t[2],_[15]=1,_}function le(e,t,r,_,n){var a=e[0],o=e[1],i=e[2],s=e[3],E=a+a,c=o+o,l=i+i,T=a*E,u=a*c,d=a*l,f=o*c,P=o*l,A=i*l,S=s*E,p=s*c,m=s*l,O=r[0],v=r[1],N=r[2],g=_[0],h=_[1],R=_[2];return n[0]=(1-(f+A))*O,n[1]=(u+m)*O,n[2]=(d-p)*O,n[3]=0,n[4]=(u-m)*v,n[5]=(1-(T+A))*v,n[6]=(P+S)*v,n[7]=0,n[8]=(d+p)*N,n[9]=(P-S)*N,n[10]=(1-(T+f))*N,n[11]=0,n[12]=t[0]+g-(n[0]*g+n[4]*h+n[8]*R),n[13]=t[1]+h-(n[1]*g+n[5]*h+n[9]*R),n[14]=t[2]+R-(n[2]*g+n[6]*h+n[10]*R),n[15]=1,n}function Te(e,t){var r=e[0],_=e[1],n=e[2],a=e[3],o=r+r,i=_+_,s=n+n,E=r*o,c=_*o,l=_*i,T=n*o,u=n*i,d=n*s,f=a*o,P=a*i,A=a*s;return t[0]=1-l-d,t[1]=c+A,t[2]=T-P,t[3]=0,t[4]=c-A,t[5]=1-E-d,t[6]=u+f,t[7]=0,t[8]=T+P,t[9]=u-f,t[10]=1-E-l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ue(e,t,r,_,n,a,o){var i=1/(t-e),s=1/(_-r),E=1/(n-a);return o[0]=2*n*i,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=2*n*s,o[6]=0,o[7]=0,o[8]=(t+e)*i,o[9]=(_+r)*s,o[10]=(a+n)*E,o[11]=-1,o[12]=0,o[13]=0,o[14]=a*n*2*E,o[15]=0,o}function de(e,t,r,_,n){var a=1/Math.tan(e/2),o=1/(r-_);return n[0]=a/t,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=a,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=(_+r)*o,n[11]=-1,n[12]=0,n[13]=0,n[14]=2*_*r*o,n[15]=0,n}function fe(e,t,r,_){var n=Math.tan(e.upDegrees*Math.PI/180),a=Math.tan(e.downDegrees*Math.PI/180),o=Math.tan(e.leftDegrees*Math.PI/180),i=Math.tan(e.rightDegrees*Math.PI/180),s=2/(o+i),E=2/(n+a);return _[0]=s,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=E,_[6]=0,_[7]=0,_[8]=-(o-i)*s*.5,_[9]=(n-a)*E*.5,_[10]=r/(t-r),_[11]=-1,_[12]=0,_[13]=0,_[14]=r*t/(t-r),_[15]=0,_}function Pe(e,t,r,_,n,a,o){var i=1/(e-t),s=1/(r-_),E=1/(n-a);return o[0]=-2*i,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*s,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*E,o[11]=0,o[12]=(e+t)*i,o[13]=(_+r)*s,o[14]=(a+n)*E,o[15]=1,o}function Ae(e,t,r,_){var n,a,o,i,s,E,c,l,T,u,d=e[0],f=e[1],P=e[2],A=r[0],S=r[1],p=r[2],m=t[0],O=t[1],v=t[2];return Math.abs(d-m)<k&&Math.abs(f-O)<k&&Math.abs(P-v)<k?Q(_):(c=d-m,l=f-O,T=P-v,n=S*(T*=u=1/Math.sqrt(c*c+l*l+T*T))-p*(l*=u),a=p*(c*=u)-A*T,o=A*l-S*c,(u=Math.sqrt(n*n+a*a+o*o))?(n*=u=1/u,a*=u,o*=u):(n=0,a=0,o=0),i=l*o-T*a,s=T*n-c*o,E=c*a-l*n,(u=Math.sqrt(i*i+s*s+E*E))?(i*=u=1/u,s*=u,E*=u):(i=0,s=0,E=0),_[0]=n,_[1]=i,_[2]=c,_[3]=0,_[4]=a,_[5]=s,_[6]=l,_[7]=0,_[8]=o,_[9]=E,_[10]=T,_[11]=0,_[12]=-(n*d+a*f+o*P),_[13]=-(i*d+s*f+E*P),_[14]=-(c*d+l*f+T*P),_[15]=1,_)}function Se(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function pe(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2)+Math.pow(e[9],2)+Math.pow(e[10],2)+Math.pow(e[11],2)+Math.pow(e[12],2)+Math.pow(e[13],2)+Math.pow(e[14],2)+Math.pow(e[15],2))}Math;var me="undefined"!=typeof Float32Array?Float32Array:Array,Oe=Math.random;function ve(){var e=new me(3);return e[0]=0,e[1]=0,e[2]=0,e}function Ne(e){var t=new me(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function ge(e,t,r){var _=new me(3);return _[0]=e,_[1]=t,_[2]=r,_}function he(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Re(e,t,r,_){return _[0]=e,_[1]=t,_[2]=r,_}function Ie(e,t,r){return r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r}function be(e,t,r){return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],r}function Ye(e,t,r){return r[0]=e[0]*t[0],r[1]=e[1]*t[1],r[2]=e[2]*t[2],r}function Le(e,t,r){return r[0]=e[0]/t[0],r[1]=e[1]/t[1],r[2]=e[2]/t[2],r}function Me(e,t,r){return r[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r[2]=Math.min(e[2],t[2]),r}function xe(e,t,r){return r[0]=Math.max(e[0],t[0]),r[1]=Math.max(e[1],t[1]),r[2]=Math.max(e[2],t[2]),r}function ye(e,t,r){return r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r}function we(e,t,r,_){return _[0]=e[0]+t[0]*r,_[1]=e[1]+t[1]*r,_[2]=e[2]+t[2]*r,_}function Ue(e,t){var r=t[0]-e[0],_=t[1]-e[1],n=t[2]-e[2];return Math.sqrt(r*r+_*_+n*n)}function Ce(e,t){var r=t[0]-e[0],_=t[1]-e[1],n=t[2]-e[2];return r*r+_*_+n*n}function De(e){var t=e[0],r=e[1],_=e[2];return Math.sqrt(t*t+r*r+_*_)}function Fe(e){var t=e[0],r=e[1],_=e[2];return t*t+r*r+_*_}function Ge(e,t){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function ke(e,t){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function Ke(e,t){var r=e[0],_=e[1],n=e[2],a=r*r+_*_+n*n;return a>0&&(a=1/Math.sqrt(a),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a),t}function Be(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Xe(e,t,r){var _=e[0],n=e[1],a=e[2],o=t[0],i=t[1],s=t[2];return r[0]=n*s-a*i,r[1]=a*o-_*s,r[2]=_*i-n*o,r}function He(e,t,r,_){var n=e[0],a=e[1],o=e[2];return _[0]=n+r*(t[0]-n),_[1]=a+r*(t[1]-a),_[2]=o+r*(t[2]-o),_}function Qe(e,t,r,_,n,a){var o=n*n,i=o*(2*n-3)+1,s=o*(n-2)+n,E=o*(n-1),c=o*(3-2*n);return a[0]=e[0]*i+t[0]*s+r[0]*E+_[0]*c,a[1]=e[1]*i+t[1]*s+r[1]*E+_[1]*c,a[2]=e[2]*i+t[2]*s+r[2]*E+_[2]*c,a}function ze(e,t,r,_,n,a){var o=1-n,i=o*o,s=n*n,E=i*o,c=3*n*i,l=3*s*o,T=s*n;return a[0]=e[0]*E+t[0]*c+r[0]*l+_[0]*T,a[1]=e[1]*E+t[1]*c+r[1]*l+_[1]*T,a[2]=e[2]*E+t[2]*c+r[2]*l+_[2]*T,a}function Ve(e,t){var r=2*Oe()*Math.PI,_=2*Oe()-1,n=Math.sqrt(1-_*_)*e;return t[0]=Math.cos(r)*n,t[1]=Math.sin(r)*n,t[2]=_*e,t}function je(e,t,r){var _=e[0],n=e[1],a=e[2],o=t[3]*_+t[7]*n+t[11]*a+t[15];return r[0]=(t[0]*_+t[4]*n+t[8]*a+t[12])/(o=o||1),r[1]=(t[1]*_+t[5]*n+t[9]*a+t[13])/o,r[2]=(t[2]*_+t[6]*n+t[10]*a+t[14])/o,r}function qe(e,t,r){var _=e[0],n=e[1],a=e[2];return r[0]=_*t[0]+n*t[3]+a*t[6],r[1]=_*t[1]+n*t[4]+a*t[7],r[2]=_*t[2]+n*t[5]+a*t[8],r}function We(e,t,r){var _=e[0],n=e[1],a=e[2],o=t[0],i=t[1],s=t[2],E=t[3],c=E*_+i*a-s*n,l=E*n+s*_-o*a,T=E*a+o*n-i*_,u=-o*_-i*n-s*a;return r[0]=c*E+u*-o+l*-s-T*-i,r[1]=l*E+u*-i+T*-o-c*-s,r[2]=T*E+u*-s+c*-i-l*-o,r}function Je(e,t,r,_){var n=[],a=[];return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],a[0]=n[0],a[1]=n[1]*Math.cos(r)-n[2]*Math.sin(r),a[2]=n[1]*Math.sin(r)+n[2]*Math.cos(r),_[0]=a[0]+t[0],_[1]=a[1]+t[1],_[2]=a[2]+t[2],_}function Ze(e,t,r,_){var n=[],a=[];return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],a[0]=n[2]*Math.sin(r)+n[0]*Math.cos(r),a[1]=n[1],a[2]=n[2]*Math.cos(r)-n[0]*Math.sin(r),_[0]=a[0]+t[0],_[1]=a[1]+t[1],_[2]=a[2]+t[2],_}function $e(e,t,r,_){var n=[],a=[];return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],a[0]=n[0]*Math.cos(r)-n[1]*Math.sin(r),a[1]=n[0]*Math.sin(r)+n[1]*Math.cos(r),a[2]=n[2],_[0]=a[0]+t[0],_[1]=a[1]+t[1],_[2]=a[2]+t[2],_}var et,tt=(et=ve(),function(e,t,r,_,n,a){var o,i;for(t||(t=3),r||(r=0),i=_?Math.min(_*t+r,e.length):e.length,o=r;o<i;o+=t)et[0]=e[o],et[1]=e[o+1],et[2]=e[o+2],n(et,a,et),e[o]=et[0],e[o+1]=et[1],e[o+2]=et[2];return e});function rt(e,t){var r=ge(e[0],e[1],e[2]),_=ge(t[0],t[1],t[2]);Ke(r,r),Ke(_,_);var n=Be(r,_);return n>1?0:Math.acos(n)}function _t(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}var nt=new Float32Array(3),at=new Float32Array(9),ot=new Float32Array(9),it=new Float32Array(9),st=new Float32Array(9),Et=100;function ct(e,t){return(t=t||new Float32Array(3))[0]=e[3],t[1]=e[4],t[2]=e[5],t}function lt(e,t){return he(e,t=t||new Float32Array(3))}function Tt(e,t){he(t,e)}function ut(e,t){Ke(t,nt),e[3]=nt[0],e[4]=nt[1],e[5]=nt[2]}function dt(e,t,r){return(r=r||new Float32Array(3))[0]=e[0]+e[3]*t,r[1]=e[1]+e[4]*t,r[2]=e[2]+e[5]*t,r}function ft(e,t){for(var r=e[1],_=1,n=2;n<e.length;n++)4!=n&&8!=n&&Math.abs(e[n])>Math.abs(r)&&(r=e[n],_=n);var a=Math.floor(_/3),o=_%3,i=.5*Math.atan(2*r/(e[3*a+a]-e[3*o+o]));for(n=0;n<t.length;n++)t[n]=0==n||4==n||8==n?1:0;return t[o+3*a]=-Math.sin(i),t[a+3*o]=Math.sin(i),t[a+3*a]=Math.cos(i),t[o+3*o]=Math.cos(i),t}function Pt(e){return Math.sqrt(e[1]*e[1]+e[2]*e[2]+e[5]*e[5])}function At(e,t){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]}function St(e,t){e.content.push(t),pt(e,e.content.length-1)}function pt(e,t){for(var r=e.content[t];t>0;){var _=(t+1>>1)-1,n=e.content[_];if(!(e.score_function(r)<e.score_function(n)))break;e.content[_]=r,e.content[t]=n,t=_}}function mt(e,t){pt(e,e.content.indexOf(t))}function Ot(e,t){for(var r=e.content.length,_=e.content[t],n=e.score_function(_);;){var a=t+1<<1,o=a-1,i=null;if(o<r){var s=e.score_function(e.content[o]);s<n&&(i=o)}if(a<r&&e.score_function(e.content[a])<(null===i?n:s)&&(i=a),null===i)break;e.content[t]=e.content[i],e.content[i]=_,t=i}}function vt(e,t,r,_){return r*e/_+t}function Nt(e,t,r,_){return r*(e/=_)*e+t}function gt(e,t,r,_){return-r*(e/=_)*(e-2)+t}function ht(e,t,r,_){return(e/=_/2)<1?r/2*e*e+t:-r/2*(--e*(e-2)-1)+t}function Rt(e,t,r,_){return r*(e/=_)*e*e+t}function It(e,t,r,_){return r*((e=e/_-1)*e*e+1)+t}function bt(e,t,r,_){return(e/=_/2)<1?r/2*e*e*e+t:r/2*((e-=2)*e*e+2)+t}function Yt(e,t,r,_){return r*(e/=_)*e*e*e+t}function Lt(e,t,r,_){return-r*((e=e/_-1)*e*e*e-1)+t}function Mt(e,t,r,_){return(e/=_/2)<1?r/2*e*e*e*e+t:-r/2*((e-=2)*e*e*e-2)+t}function xt(e,t,r,_){return r*(e/=_)*e*e*e*e+t}function yt(e,t,r,_){return r*((e=e/_-1)*e*e*e*e+1)+t}function wt(e,t,r,_){return(e/=_/2)<1?r/2*e*e*e*e*e+t:r/2*((e-=2)*e*e*e*e+2)+t}function Ut(e,t,r,_){return-r*Math.cos(e/_*(Math.PI/2))+r+t}function Ct(e,t,r,_){return r*Math.sin(e/_*(Math.PI/2))+t}function Dt(e,t,r,_){return-r/2*(Math.cos(Math.PI*e/_)-1)+t}function Ft(e,t,r,_){return 0==e?t:r*Math.pow(2,10*(e/_-1))+t}function Gt(e,t,r,_){return e==_?t+r:r*(1-Math.pow(2,-10*e/_))+t}function kt(e,t,r,_){return 0==e?t:e==_?t+r:(e/=_/2)<1?r/2*Math.pow(2,10*(e-1))+t:r/2*(2-Math.pow(2,-10*--e))+t}function Kt(e,t,r,_){return-r*(Math.sqrt(1-(e/=_)*e)-1)+t}function Bt(e,t,r,_){return r*Math.sqrt(1-(e=e/_-1)*e)+t}function Xt(e,t,r,_){return(e/=_/2)<1?-r/2*(Math.sqrt(1-e*e)-1)+t:r/2*(Math.sqrt(1-(e-=2)*e)+1)+t}function Ht(e,t,r,_){var n=1.70158,a=0,o=r;return 0==e?t:1==(e/=_)?t+r:(a||(a=.3*_),o<Math.abs(r)?(o=r,n=a/4):n=a/(2*Math.PI)*Math.asin(r/o),-o*Math.pow(2,10*(e-=1))*Math.sin((e*_-n)*(2*Math.PI)/a)+t)}function Qt(e,t,r,_){var n=1.70158,a=0,o=r;return 0==e?t:1==(e/=_)?t+r:(a||(a=.3*_),o<Math.abs(r)?(o=r,n=a/4):n=a/(2*Math.PI)*Math.asin(r/o),o*Math.pow(2,-10*e)*Math.sin((e*_-n)*(2*Math.PI)/a)+r+t)}function zt(e,t,r,_){var n=1.70158,a=0,o=r;return 0==e?t:2==(e/=_/2)?t+r:(a||(a=_*(.3*1.5)),o<Math.abs(r)?(o=r,n=a/4):n=a/(2*Math.PI)*Math.asin(r/o),e<1?o*Math.pow(2,10*(e-=1))*Math.sin((e*_-n)*(2*Math.PI)/a)*-.5+t:o*Math.pow(2,-10*(e-=1))*Math.sin((e*_-n)*(2*Math.PI)/a)*.5+r+t)}function Vt(e,t,r,_,n){return void 0==n&&(n=1.70158),r*(e/=_)*e*((n+1)*e-n)+t}function jt(e,t,r,_,n){return void 0==n&&(n=1.70158),r*((e=e/_-1)*e*((n+1)*e+n)+1)+t}function qt(e,t,r,_,n){return void 0==n&&(n=1.70158),(e/=_/2)<1?r/2*(e*e*((1+(n*=1.525))*e-n))+t:r/2*((e-=2)*e*((1+(n*=1.525))*e+n)+2)+t}function Wt(e,t,r,_){return r-Jt(_-e,0,r,_)+t}function Jt(e,t,r,_){return(e/=_)<1/2.75?r*(7.5625*e*e)+t:e<2/2.75?r*(7.5625*(e-=1.5/2.75)*e+.75)+t:e<2.5/2.75?r*(7.5625*(e-=2.25/2.75)*e+.9375)+t:r*(7.5625*(e-=2.625/2.75)*e+.984375)+t}function Zt(e,t,r,_){return e<_/2?.5*Wt(2*e,0,r,_)+t:.5*Jt(2*e-_,0,r,_)+.5*r+t}var $t="undefined"!=typeof Float32Array?Float32Array:Array,er=Math.random;function tr(){var e=new $t(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function rr(e){var t=new $t(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function _r(e,t,r,_){var n=new $t(4);return n[0]=e,n[1]=t,n[2]=r,n[3]=_,n}function nr(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function ar(e,t,r,_,n){return n[0]=e,n[1]=t,n[2]=r,n[3]=_,n}function or(e,t,r){return r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r[3]=e[3]+t[3],r}function ir(e,t,r){return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],r[3]=e[3]-t[3],r}function sr(e,t,r){return r[0]=e[0]*t[0],r[1]=e[1]*t[1],r[2]=e[2]*t[2],r[3]=e[3]*t[3],r}function Er(e,t,r){return r[0]=e[0]/t[0],r[1]=e[1]/t[1],r[2]=e[2]/t[2],r[3]=e[3]/t[3],r}function cr(e,t,r){return r[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r[2]=Math.min(e[2],t[2]),r[3]=Math.min(e[3],t[3]),r}function lr(e,t,r){return r[0]=Math.max(e[0],t[0]),r[1]=Math.max(e[1],t[1]),r[2]=Math.max(e[2],t[2]),r[3]=Math.max(e[3],t[3]),r}function Tr(e,t,r){return r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r[3]=e[3]*t,r}function ur(e,t,r,_){return _[0]=e[0]+t[0]*r,_[1]=e[1]+t[1]*r,_[2]=e[2]+t[2]*r,_[3]=e[3]+t[3]*r,_}function dr(e,t){var r=t[0]-e[0],_=t[1]-e[1],n=t[2]-e[2],a=t[3]-e[3];return Math.sqrt(r*r+_*_+n*n+a*a)}function fr(e,t){var r=t[0]-e[0],_=t[1]-e[1],n=t[2]-e[2],a=t[3]-e[3];return r*r+_*_+n*n+a*a}function Pr(e){var t=e[0],r=e[1],_=e[2],n=e[3];return Math.sqrt(t*t+r*r+_*_+n*n)}function Ar(e){var t=e[0],r=e[1],_=e[2],n=e[3];return t*t+r*r+_*_+n*n}function Sr(e,t){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function pr(e,t){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function mr(e,t){var r=e[0],_=e[1],n=e[2],a=e[3],o=r*r+_*_+n*n+a*a;return o>0&&(o=1/Math.sqrt(o),t[0]=r*o,t[1]=_*o,t[2]=n*o,t[3]=a*o),t}function Or(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function vr(e,t,r,_){var n=e[0],a=e[1],o=e[2],i=e[3];return _[0]=n+r*(t[0]-n),_[1]=a+r*(t[1]-a),_[2]=o+r*(t[2]-o),_[3]=i+r*(t[3]-i),_}function Nr(e,t){return t[0]=er(),t[1]=er(),t[2]=er(),t[3]=er(),mr(t,t),e(t,e,t),t}function gr(e,t,r){var _=e[0],n=e[1],a=e[2],o=e[3];return r[0]=t[0]*_+t[4]*n+t[8]*a+t[12]*o,r[1]=t[1]*_+t[5]*n+t[9]*a+t[13]*o,r[2]=t[2]*_+t[6]*n+t[10]*a+t[14]*o,r[3]=t[3]*_+t[7]*n+t[11]*a+t[15]*o,r}function hr(e,t,r){var _=e[0],n=e[1],a=e[2],o=t[0],i=t[1],s=t[2],E=t[3],c=E*_+i*a-s*n,l=E*n+s*_-o*a,T=E*a+o*n-i*_,u=-o*_-i*n-s*a;return r[0]=c*E+u*-o+l*-s-T*-i,r[1]=l*E+u*-i+T*-o-c*-s,r[2]=T*E+u*-s+c*-i-l*-o,r[3]=e[3],r}var Rr=function(){var e=tr();return function(t,r,_,n,a,o){var i,s;for(r||(r=4),_||(_=0),s=n?Math.min(n*r+_,t.length):t.length,i=_;i<s;i+=r)e[0]=t[i],e[1]=t[i+1],e[2]=t[i+2],e[3]=t[i+3],a(e,o,e),t[i]=e[0],t[i+1]=e[1],t[i+2]=e[2],t[i+3]=e[3];return t}}();function Ir(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}var br="undefined"!=typeof Float32Array?Float32Array:Array;function Yr(){var e=new br(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}Math;var Lr,Mr,xr,yr,wr=(Lr=ve(),Mr=ge(1,0,0),xr=ge(0,1,0),function(e,t,r){var _=Be(e,t);return _<-.9999999?(Xe(Mr,e,Lr),De(Lr)<1e-6&&Xe(xr,e,Lr),Ke(Lr,Lr),Dr(Lr,Math.PI,r),r):_>.9999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(Xe(e,t,Lr),r[0]=Lr[0],r[1]=Lr[1],r[2]=Lr[2],r[3]=1+_,mr(r,r))}),Ur=(yr=p(),function(e,t,r,_){return yr[0]=t[0],yr[3]=t[1],yr[6]=t[2],yr[1]=r[0],yr[4]=r[1],yr[7]=r[2],yr[2]=-e[0],yr[5]=-e[1],yr[8]=-e[2],mr(qr(yr,_),_)});function Cr(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function Dr(e,t,r){t*=.5;var _=Math.sin(t);return r[0]=_*e[0],r[1]=_*e[1],r[2]=_*e[2],r[3]=Math.cos(t),r}function Fr(e,t,r){var _=e[0],n=e[1],a=e[2],o=e[3],i=t[0],s=t[1],E=t[2],c=t[3];return r[0]=_*c+o*i+n*E-a*s,r[1]=n*c+o*s+a*i-_*E,r[2]=a*c+o*E+_*s-n*i,r[3]=o*c-_*i-n*s-a*E,r}function Gr(e,t,r){t*=.5;var _=e[0],n=e[1],a=e[2],o=e[3],i=Math.sin(t),s=Math.cos(t);return r[0]=_*s+o*i,r[1]=n*s+a*i,r[2]=a*s-n*i,r[3]=o*s-_*i,r}function kr(e,t,r){t*=.5;var _=e[0],n=e[1],a=e[2],o=e[3],i=Math.sin(t),s=Math.cos(t);return r[0]=_*s-a*i,r[1]=n*s+o*i,r[2]=a*s+_*i,r[3]=o*s-n*i,r}function Kr(e,t,r){t*=.5;var _=e[0],n=e[1],a=e[2],o=e[3],i=Math.sin(t),s=Math.cos(t);return r[0]=_*s+n*i,r[1]=n*s-_*i,r[2]=a*s+o*i,r[3]=o*s-a*i,r}function Br(e,t){var r=e[0],_=e[1],n=e[2];return t[0]=r,t[1]=_,t[2]=n,t[3]=Math.sqrt(Math.abs(1-r*r-_*_-n*n)),t}function Xr(e,t,r,_){var n,a,o,i,s,E=e[0],c=e[1],l=e[2],T=e[3],u=t[0],d=t[1],f=t[2],P=t[3];return(a=E*u+c*d+l*f+T*P)<0&&(a=-a,u=-u,d=-d,f=-f,P=-P),1-a>1e-6?(n=Math.acos(a),o=Math.sin(n),i=Math.sin((1-r)*n)/o,s=Math.sin(r*n)/o):(i=1-r,s=r),_[0]=i*E+s*u,_[1]=i*c+s*d,_[2]=i*l+s*f,_[3]=i*T+s*P,_}var Hr,Qr,zr=(Hr=Yr(),Qr=Yr(),function(e,t,r,_,n,a){return Xr(e,_,n,Hr),Xr(t,r,n,Qr),Xr(Hr,Qr,2*n*(1-n),a),a});function Vr(e,t){var r=e[0],_=e[1],n=e[2],a=e[3],o=r*r+_*_+n*n+a*a,i=o?1/o:0;return t[0]=-r*i,t[1]=-_*i,t[2]=-n*i,t[3]=a*i,t}function jr(e,t){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function qr(e,t){var r,_=e[0]+e[4]+e[8];if(_>0)r=Math.sqrt(_+1),t[3]=.5*r,t[0]=(e[5]-e[7])*(r=.5/r),t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{var n=0;e[4]>e[0]&&(n=1),e[8]>e[3*n+n]&&(n=2);var a=(n+1)%3,o=(n+2)%3;r=Math.sqrt(e[3*n+n]-e[3*a+a]-e[3*o+o]+1),t[n]=.5*r,t[3]=(e[3*a+o]-e[3*o+a])*(r=.5/r),t[a]=(e[3*a+n]+e[3*n+a])*r,t[o]=(e[3*o+n]+e[3*n+o])*r}return t}function Wr(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}var Jr=new Float32Array(3),Zr=new Float32Array(3),$r=new Float32Array(3),e_=new Float32Array(3),t_=new Float32Array(3),r_=new Float32Array(3),__=new Float32Array(3),n_=new Float32Array(3),a_=new Float32Array(4),o_=new Float32Array(4),i_=new Float32Array(9),s_=new Float32Array(9),E_=new Float32Array(9),c_=new Float32Array(16),l_=(new Float32Array(16),Yr()),T_=Yr(),u_=new Float32Array([0,0,0]),d_=new Float32Array([0,0,0,1]),f_=(new Float32Array([0,0,0,1,0,0,0,1]),new Float32Array([1,1,1])),P_=new Float32Array([1,0,0]),A_=new Float32Array([0,1,0]),S_=new Float32Array([0,0,1]),p_=new Float32Array([-1,0,0]),m_=new Float32Array([0,-1,0]),O_=new Float32Array([0,0,-1]),v_=0,N_=1,g_=2,h_=3,R_=4,I_=5,b_=6,Y_=7,L_=8,M_=9,x_=10,y_=11,w_=[v_,N_,g_,R_,I_],U_=5e4,C_=48271,D_=2147483647,F_=D_%C_,G_=Math.floor(D_/C_),k_=[new Float32Array([0,0,-1,0,0,-1,0,0,-1,0,0,0,0,0,0,1]),new Float32Array([0,0,1,0,0,-1,0,0,1,0,0,0,0,0,0,1]),new Float32Array([1,0,0,0,0,0,-1,0,0,1,0,0,0,0,0,1]),new Float32Array([1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1]),new Float32Array([1,0,0,0,0,-1,0,0,0,0,-1,0,0,0,0,1]),new Float32Array([-1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1])],K_=2.2,B_=1,X_=2,H_=4,Q_=4;function z_(e){return"undefined"!=typeof e}function V_(e,t,r){for(var _=[],n=r.length,a=0;a<n;a++){var o=r[a];o[e]==t&&_.push(o)}return _}function j_(e){return new Float32Array(e)}function q_(e,t){var r=e.length,_=new Float32Array(r+t.length);return _.set(e),_.set(t,r),_}function W_(e){return e>0?1:e<0?-1:0}function J_(e,t,r){for(var _=0;_<r.length;_++){var n=r[_];if(n[e]===t)return n}return null}function Z_(e,t,r){for(var _=0;_<e.length;_++)if(e[_][t]==r)return _;return-1}function $_(e,t){for(var r=0;r<e.length;r++)if(e[r]==t)return;e.push(t)}function en(e){var t=Math.floor(e[0]/G_),r=C_*(e[0]%G_)-F_*t;return e[0]=r>0?r:r+D_,(e[0]-1)/(D_-1)}function tn(e,t){return t||(t=[]),t[0]=U_+Math.floor(e),t}function rn(e,t){var r=Jr;return r[0]=e[2],r[1]=e[1],r[2]=e[0],_n(r,y_,t),t}function _n(e,t,r){var _=e[0],n=e[1],a=e[2],o=Math.cos(_/2),i=Math.cos(n/2),s=Math.cos(a/2),E=Math.sin(_/2),c=Math.sin(n/2),l=Math.sin(a/2);if(w_.indexOf(t)>-1)var T=Math.cos((_+a)/2),u=Math.sin((_+a)/2),d=Math.cos((_-a)/2),f=Math.sin((_-a)/2),P=Math.cos((a-_)/2),A=Math.sin((a-_)/2);switch(t){case v_:r[0]=i*u,r[1]=c*d,r[2]=c*f,r[3]=i*T;break;case N_:r[0]=c*f,r[1]=i*u,r[2]=c*d,r[3]=i*T;break;case g_:r[0]=c*d,r[1]=c*f,r[2]=i*u,r[3]=i*T;break;case h_:r[0]=i*u,r[1]=c*A,r[2]=c*P,r[3]=i*T;break;case R_:r[0]=c*P,r[1]=i*u,r[2]=c*A,r[3]=i*T;break;case I_:r[0]=c*A,r[1]=c*P,r[2]=i*u,r[3]=i*T;break;case b_:r[0]=E*i*s+o*c*l,r[1]=o*c*s-E*i*l,r[2]=o*i*l+E*c*s,r[3]=o*i*s-E*c*l;break;case Y_:r[0]=o*i*l+E*c*s,r[1]=E*i*s+o*c*l,r[2]=o*c*s-E*i*l,r[3]=o*i*s-E*c*l;break;case L_:r[0]=o*c*s-E*i*l,r[1]=o*i*l+E*c*s,r[2]=E*i*s+o*c*l,r[3]=o*i*s-E*c*l;break;case M_:r[0]=E*i*s-o*c*l,r[1]=o*i*l-E*c*s,r[2]=o*c*s+E*i*l,r[3]=o*i*s+E*c*l;break;case x_:r[0]=o*c*s+E*i*l,r[1]=E*i*s-o*c*l,r[2]=o*i*l-E*c*s,r[3]=o*i*s+E*c*l;break;case y_:r[0]=o*i*l-E*c*s,r[1]=o*c*s+E*i*l,r[2]=E*i*s-o*c*l,r[3]=o*i*s+E*c*l}return r}function nn(e,t,r){var _=e[0],n=e[1],a=e[2],o=e[3];switch(t){case v_:r[0]=Math.atan2(_*n+a*o,n*o-_*a),r[1]=Math.acos(1-2*(n*n+a*a)),r[2]=Math.atan2(_*n-a*o,_*a+n*o);break;case N_:r[0]=Math.atan2(_*o+n*a,a*o-_*n),r[1]=Math.acos(1-2*(_*_+a*a)),r[2]=Math.atan2(n*a-_*o,_*n+a*o);break;case g_:r[0]=Math.atan2(_*a+n*o,_*o-n*a),r[1]=Math.acos(1-2*(_*_+n*n)),r[2]=Math.atan2(_*a-n*o,_*o+n*a);break;case h_:r[0]=Math.atan2(_*a-n*o,_*n+a*o),r[1]=Math.acos(1-2*(n*n+a*a)),r[2]=Math.atan2(_*a+n*o,a*o-_*n);break;case R_:r[0]=Math.atan2(_*n-a*o,_*o+n*a),r[1]=Math.acos(1-2*(_*_+a*a)),r[2]=Math.atan2(_*n+a*o,_*o-n*a);break;case I_:r[0]=Math.atan2(n*a-_*o,_*a+n*o),r[1]=Math.acos(1-2*(_*_+n*n)),r[2]=Math.atan2(_*o+n*a,n*o-_*a);break;case b_:r[0]=Math.atan2(2*(_*o-n*a),1-2*(_*_+n*n)),r[1]=Math.asin(2*(_*a+n*o)),r[2]=Math.atan2(2*(a*o-_*n),1-2*(n*n+a*a));break;case Y_:(i=_*n+a*o)>.499999?(r[0]=0,r[1]=Math.PI/2,r[2]=2*Math.atan2(_,o)):i<-.499999?(r[0]=0,r[1]=-Math.PI/2,r[2]=-2*Math.atan2(_,o)):(r[0]=Math.atan2(2*(n*o-_*a),1-2*(n*n+a*a)),r[1]=Math.asin(2*(_*n+a*o)),r[2]=Math.atan2(2*(_*o-n*a),1-2*(_*_+a*a)));break;case L_:r[0]=Math.atan2(2*(a*o-_*n),1-2*(_*_+a*a)),r[1]=Math.asin(2*(_*o+n*a)),r[2]=Math.atan2(2*(n*o-_*a),1-2*(_*_+n*n));break;case M_:r[0]=Math.atan2(2*(_*o+n*a),1-2*(_*_+a*a)),r[1]=Math.asin(2*(a*o-_*n)),r[2]=Math.atan2(2*(_*a+n*o),1-2*(n*n+a*a));break;case x_:r[0]=Math.atan2(2*(_*a+n*o),1-2*(_*_+n*n)),r[1]=Math.asin(2*(_*o-n*a)),r[2]=Math.atan2(2*(_*n+a*o),1-2*(_*_+a*a));break;case y_:var i;(i=n*o-_*a)>.499999?(r[0]=0,r[1]=Math.PI/2,r[2]=-2*Math.atan2(a,o)):i<-.499999?(r[0]=0,r[1]=-Math.PI/2,r[2]=2*Math.atan2(a,o)):(r[0]=Math.atan2(2*(_*n+a*o),1-2*(n*n+a*a)),r[1]=Math.asin(2*(n*o-_*a)),r[2]=Math.atan2(2*(_*o+n*a),1-2*(_*_+n*n)))}return r}function an(e,t){var r=Math.cos(e[0]),_=Math.cos(e[1]),n=Math.cos(e[2]),a=Math.sin(e[0]),o=Math.sin(e[1]),i=Math.sin(e[2]),s=r*n,E=r*i,c=a*n,l=a*i;return t[0]=_*n,t[1]=_*i,t[2]=-o,t[3]=o*c-E,t[4]=o*l+s,t[5]=_*a,t[6]=o*s+l,t[7]=o*E-c,t[8]=_*r,t}function on(e,t){var r=nn(e,y_,Jr);return t[0]=r[2],t[1]=r[1],t[2]=r[0],t}function sn(e,t,r){return r||(r=new Float32Array(3)),We(t,e,r),r}function En(e,t,r){r||(r=new Float32Array(4));var _=Be(t,e=Ke(e,Jr)),n=Xe(t,e,Zr),a=Math.acos(_);return r[0]=n[0]*Math.sin(a/2),r[1]=n[1]*Math.sin(a/2),r[2]=n[2]*Math.sin(a/2),r[3]=Math.cos(a/2),r}function cn(e,t,r,_){if(0==r)return e;_=_||[];for(var n=0;n<e.length;n++)_[n]=(1-r)*e[n]+r*t[n];return _}function ln(e){if(!(e instanceof Object))return e;var t,r=e.constructor;switch(r){case Int8Array:case Uint8Array:case Uint8ClampedArray:case Int16Array:case Uint16Array:case Int32Array:case Uint32Array:case Float32Array:case Float64Array:t=new r(e);break;case Array:t=new r(e.length);for(var _=0;_<e.length;_++)t[_]=ln(e[_]);break;default:for(var n in t=new r,e)e.hasOwnProperty(n)&&(t[n]=ln(e[n]))}return t}function Tn(e){var t=e instanceof Array?[]:{};for(var r in e)if(e.hasOwnProperty(r))if(e[r]instanceof Object){var _=e[r].constructor;switch(_){case Int8Array:case Uint8Array:case Uint8ClampedArray:case Int16Array:case Uint16Array:case Int32Array:case Uint32Array:case Float32Array:case Float64Array:t[r]=new _(e[r]);break;case Array:t[r]=e[r].slice(0);break;default:t[r]=e[r]}}else t[r]=e[r];return t}function un(e,t){t||(t=new Float32Array(4)),m(e,i_);var r=i_[0],_=i_[3],n=i_[6],a=i_[1],o=i_[4],i=i_[7],s=i_[2],E=i_[5],c=i_[8],l=Math.sqrt(r*r+_*_+n*n)||1,T=Math.sqrt(a*a+o*o+i*i)||1,u=Math.sqrt(s*s+E*E+c*c)||1;return i_[0]/=l,i_[3]/=l,i_[6]/=l,i_[1]/=T,i_[4]/=T,i_[7]/=T,i_[2]/=u,i_[5]/=u,i_[8]/=u,qr(i_,t),mr(t,t),t}function dn(e,t){return t||(t=new Float32Array(3)),t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function fn(e,t){var r=t.left,_=t.right,n=t.top,a=t.bottom,o=t.near,i=t.far;return r[0]=e[3]+e[0],r[1]=e[7]+e[4],r[2]=e[11]+e[8],r[3]=e[15]+e[12],_[0]=e[3]-e[0],_[1]=e[7]-e[4],_[2]=e[11]-e[8],_[3]=e[15]-e[12],n[0]=e[3]-e[1],n[1]=e[7]-e[5],n[2]=e[11]-e[9],n[3]=e[15]-e[13],a[0]=e[3]+e[1],a[1]=e[7]+e[5],a[2]=e[11]+e[9],a[3]=e[15]+e[13],o[0]=e[3]+e[2],o[1]=e[7]+e[6],o[2]=e[11]+e[10],o[3]=e[15]+e[14],i[0]=e[3]-e[2],i[1]=e[7]-e[6],i[2]=e[11]-e[10],i[3]=e[15]-e[14],Pn(r),Pn(_),Pn(n),Pn(a),Pn(o),Pn(i),t}function Pn(e){var t=e[0],r=e[1],_=e[2],n=e[3],a=Math.sqrt(t*t+r*r+_*_);e[0]=t*(a=1/a),e[1]=r*a,e[2]=_*a,e[3]=n*a}function An(e,t,r,_){_||(_=0);for(var n=e.length,a=0;a<n;a+=3){var o=e[a],i=e[a+1],s=e[a+2];r[_+a]=t[0]*o+t[4]*i+t[8]*s+t[12],r[_+a+1]=t[1]*o+t[5]*i+t[9]*s+t[13],r[_+a+2]=t[2]*o+t[6]*i+t[10]*s+t[14]}return r}function Sn(e,t,r){r||(r=new Float32Array(3));var _=a_;_[0]=e[0],_[1]=e[1],_[2]=e[2],_[3]=0,gr(_,t,_),r[0]=_[0],r[1]=_[1],r[2]=_[2]}function pn(e,t,r,_){if(_<r)return r;var n=r+Math.floor((_-r)/2);return e[n]>t?pn(e,t,r,n-1):e[n]<t?pn(e,t,n+1,_):n}function mn(e,t){for(var r=0;r<e.length;r++)if(e[r]!=t[r])return!1;return!0}function On(){var e=Jr;e[0]=0,e[1]=0,e[2]=0;var t=new Float32Array(16),r=new Float32Array(16),_=new Float32Array(16),n=new Float32Array(16),a=new Float32Array(16),o=new Float32Array(16);return Ae(e,[-1,0,0],[0,-1,0],t),Z(t,[-1,1,1],t),Z(t,[-1,1,-1],r),Ae(e,[0,-1,0],[0,0,-1],_),Z(_,[1,1,-1],_),Z(_,[1,-1,-1],n),Ae(e,[0,0,-1],[0,-1,0],a),Z(a,[-1,1,1],a),Z(a,[-1,1,-1],o),[t,r,_,n,a,o]}function vn(){var e=Jr;e[0]=0,e[1]=0,e[2]=0;var t=new Float32Array(16),r=new Float32Array(16),_=new Float32Array(16),n=new Float32Array(16),a=new Float32Array(16),o=new Float32Array(16);return Ae(e,[1,0,0],[0,-1,0],t),Z(t,[-1,1,-1],r),Ae(e,[0,1,0],[0,0,1],_),Z(_,[1,-1,-1],n),Ae(e,[0,0,1],[0,-1,0],a),Z(a,[-1,1,-1],o),[t,r,_,n,a,o]}function Nn(e,t){t||(t=e);var r=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];if(r>0){t[3]=2*Math.acos(e[3]);var _=1/Math.sqrt(r);t[0]=e[0]*_,t[1]=e[1]*_,t[2]=e[2]*_}else t[3]=0,t[0]=1,t[1]=0,t[2]=0;return t}function gn(e){return(e*=34*e+1)%289}function hn(e){return e-Math.floor(e)}function Rn(e){return isNaN(e)||"undefined"==typeof e?NaN:0|e}function In(e){return e*Math.PI/180}function bn(e){return 180*e/Math.PI}function Yn(e){var t=.211324865405187,r=.366025403784439,_=-.577350269189626,n=.024390243902439,a=e[0]*r+e[1]*r,o=Math.floor(e[0]+a),i=Math.floor(e[1]+a),s=o*t+i*t,E=e[0]-o+s,c=e[1]-i+s,l=E>c?1:0,T=1-l,u=E+t-l,d=c+t-T,f=E+_,P=c+_;o%=289;var A=gn(gn(i%=289)+o),S=gn(gn(i+T)+o+l),p=gn(gn(i+1)+o+1),m=Math.max(.5-(E*E+c*c),0),O=Math.max(.5-(u*u+d*d),0),v=Math.max(.5-(f*f+P*P),0);m*=m*m*m,O*=O*O*O,v*=v*v*v;var N=2*hn(A*n)-1,g=2*hn(S*n)-1,h=2*hn(p*n)-1,R=Math.abs(N)-.5,I=Math.abs(g)-.5,b=Math.abs(h)-.5,Y=N-Math.floor(N+.5),L=g-Math.floor(g+.5),M=h-Math.floor(h+.5);return 130*((m*=1.79284291400159-.85373472095314*(Y*Y+R*R))*(Y*E+R*c)+(O*=1.79284291400159-.85373472095314*(L*L+I*I))*(L*u+I*d)+(v*=1.79284291400159-.85373472095314*(M*M+b*b))*(M*f+b*P))}function Ln(e){return Mn((34*e+5)*e)}function Mn(e){return e-289*Math.floor(e/289)}function xn(e){return e-7*Math.floor(e/7)}function yn(e){var t=1/7,r=t/2,_=Mn(Math.floor(e[0])),n=Mn(Math.floor(e[1])),a=hn(e[0]),o=hn(e[1]),i=a-.5,s=a-1.5,E=i,c=s,l=o-.5,T=l,u=o-1.5,d=u,f=Ln(_),P=Ln(_+1),A=f,S=P;f=Ln(f+n),P=Ln(P+n),A=Ln(A+n+1),S=Ln(S+n+1);var p=i+.7*(xn(f)*t+r),m=s+.7*(xn(P)*t+r),O=E+.7*(xn(A)*t+r),v=c+.7*(xn(S)*t+r),N=l+.7*(xn(Math.floor(f*t))*t+r),g=T+.7*(xn(Math.floor(P*t))*t+r),h=u+.7*(xn(Math.floor(A*t))*t+r),R=d+.7*(xn(Math.floor(S*t))*t+r);return Math.min(p*p+N*N,m*m+g*g,O*O+h*h,v*v+R*R)}function wn(e,t,r,_,n){n||(n=new Float32Array(4));var a=We(t,e,Jr),o=r[0],i=r[1],s=r[2],E=i_;return E[0]=i*i+s*s,E[1]=-i*o,E[2]=-s*o,E[3]=-o*i,E[4]=o*o+s*s,E[5]=-s*i,E[6]=-o*s,E[7]=-i*s,E[8]=o*o+i*i,qe(a,E,a),Ke(a,a),wr(_,a,n),n}function Un(e,t,r){return e<t&&(e=t),e>r&&(e=r),e}function Cn(e,t,r,_){if(_){var n=Math.exp(-r/_);return(1-n)*e+n*t}return e}function Dn(e,t,r,_,n){if(n||(n=new Float32Array(e.length)),_)for(var a=Math.exp(-r/_),o=0;o<n.length;o++)n[o]=(1-a)*e[o]+a*t[o];else he(e,n);return n}function Fn(e,t,r,_,n){return n||(n=new Float32Array(e.length)),_?Xr(e,t,Math.exp(-r/_),n):nr(e,n),n}function Gn(e){return!!("object"==typeof e&&e.buffer&&e.buffer instanceof ArrayBuffer)}function kn(e,t){return!(!(e instanceof Array||e.buffer&&e.buffer instanceof ArrayBuffer)||(!t||t!=e.length)&&t)}function Kn(e,t){var r=C(e,i_),_=Jr;_[0]=r[6],_[1]=r[7],_[2]=r[8];var n=Xe(S_,_,_);Ke(n,n),!t&&r[4]>0&&(n[0]*=-1,n[1]*=-1,n[2]*=-1);var a=Zr;a[0]=r[0],a[1]=r[1],a[2]=r[2],Ke(a,a);var o=o_;wr(a,n,o),Fr(o,e,e)}function Bn(e,t,r,_){var n=r*t-.5,a=_*t-.5,o=n-Math.floor(n),i=a-Math.floor(a);n=Math.floor(n);var s=t-1;return(e[(a=Math.floor(a))*t+n]*(1-o)+e[a*t+Math.min(n+1,s)]*o)*(1-i)+(e[Math.min(a+1,s)*t+n]*(1-o)+e[Math.min(a+1,s)*t+Math.min(n+1,s)]*o)*i}function Xn(e){for(var t=0,r=0;r<3;r++)(e&1<<r)>0&&t++;return t}function Hn(e){for(var t=[0,0,0],r=0;r<3;r++)(e&1<<r)>0&&(t[2-r]=1);return t}function Qn(e,t){var r=0;return 1!=t&&2!=t||(4&e)>0&&r++,2==t&&(2&e)>0&&r++,r}function zn(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})}function Vn(e){var t=0;for(var r in e)e.hasOwnProperty(r)&&t++;return t}function jn(e){return e.length?e[Math.floor(Math.random()*e.length)]:null}function qn(e,t,r){r||(r=new Float32Array(3)),r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=0,Ke(r,r)}function Wn(e,t,r){var _=e-t,n=r-t;return t+(_-Math.floor(_/n)*n)}function Jn(e){return Wn(e,0,2*Math.PI)}function Zn(e,t){for(var r in e){var _=!0,n=e[r],a=t[r];switch(typeof n){case"number":case"string":case"boolean":_=n==a;break;case"object":_=$n(n,a)}if(!_)return!1}return!0}function $n(e,t){if(e&&t){var r=e instanceof Array;if(r!=t instanceof Array)return!1;var _=e.buffer instanceof ArrayBuffer&&"undefined"!==e.byteLength;if(_!=(t.buffer instanceof ArrayBuffer&&"undefined"!==t.byteLength))return!1;if(r){if(e.length!=t.length)return!1;for(var n=0;n<e.length;n++)if(!ea(e[n],t[n]))return!1}else if(_){if(e.length!=t.length)return!1;for(n=0;n<e.length;n++)if(e[n]!=t[n])return!1}else{switch(e.constructor){case WebGLUniformLocation:case WebGLProgram:case WebGLShader:case WebGLFramebuffer:case WebGLRenderbuffer:case WebGLTexture:case WebGLBuffer:return e==t}for(var a in e)if(!ea(e[a],t[a]))return!1;for(var a in t)if(!(a in e))return!1}return!0}return!(e||t)}function ea(e,t){if(typeof e!=typeof t)return!1;switch(typeof e){case"number":case"string":case"boolean":return e==t;case"object":return $n(e,t);default:return!0}}function ta(e,t){var r=e[0],_=e[2],n=e[3];return t[0]=e[1],t[1]=_,t[2]=n,t[3]=r,t}function ra(e,t,r,_){var n=a_;n.set(e),n[3]=t;var a=o_;Jr[0]=r[3],Jr[1]=r[4],Jr[2]=r[5],a.set(Jr),a[3]=0;var o=Or(n,a);if(0==o)return null;var i=o_;he(r,Jr),i.set(Jr),i[3]=1;var s=-Or(n,i)/o;return _[0]=r[0]+s*r[3],_[1]=r[1]+s*r[4],_[2]=r[2]+s*r[5],_}function _a(e,t,r){var _=Jr,n=Be(e,t);return n<-.9999999?(Xe(P_,e,_),De(_)<1e-6&&Xe(A_,e,_),Ke(_,_),Dr(_,Math.PI,r)):(Xe(e,t,_),r.set(_),r[3]=1+n,mr(r,r)),r}function na(e,t,r){if(t==r)return r-e;e=Jn(e),t=Jn(t),r=Jn(r);var _=2*Math.PI-t;if(t=0,r=Jn(r+=_),(e=Jn(e+=_))>r){var n=r-e,a=2*Math.PI-e;return-n>a?a:n}return 0}function aa(e,t,r){return isFinite(t)&&isFinite(r)&&(e=Un(e,t,r)),e*e*(3-2*e)}function oa(e,t,r){return t+e*(r-t)}function ia(e,t){for(var r=0;r<e.length;r++)for(var _=0;_<t.length;_++)if(t[_]==e[r])return!0;return!1}function sa(e,t){for(var r=Math.max(e.length,t.length),_=0;_<r;_++){var n=W_((_>=e.length?0:e[_])-(_>=t.length?0:t[_]));if(n)return n}return 0}function Ea(e){return e.join(".")}function ca(e){return e.split(".").map(function(e){return 0|e})}function la(e,t){return t[0]=Math.pow(e[0],1/K_),t[1]=Math.pow(e[1],1/K_),t[2]=Math.pow(e[2],1/K_),t}function Ta(e){return 0!=parseInt(e.toString(2).substr(1),2)}function ua(){var e=[{}];return e.length=0,e}function da(e){return Un(Math.round(32767.5*(e+1)-32768)||0,-32768,32767)}function fa(e){return Un((e+32768)/32767.5-1,-1,1)}function Pa(e){return Un(Math.round(255*e),0,255)}function Aa(e){return Un(e/255,0,1)}function Sa(e,t,r,_){var n=Zr;sn(t,_,n),Ke(n,n);var a=$r;be(r,e,a),Ke(a,a),Fr(_a(n,a,a_),t,t),mr(t,t)}function pa(e,t){for(var r=2*Math.PI,_=[],n=0;n<3;n++)_[n]=e[n]-t[n],_[n]>5.1?(e[n]-=_[n]/r*r,_[n]=e[n]-t[n]):_[n]<-5.1&&(e[n]+=-_[n]/r*r,_[n]=e[n]-t[n]);Math.abs(_[0])>3.2&&Math.abs(_[1])<1.6&&Math.abs(_[2])<1.6&&(_[0]>0?e[0]-=r:e[0]+=r),Math.abs(_[1])>3.2&&Math.abs(_[2])<1.6&&Math.abs(_[0])<1.6&&(_[1]>0?e[1]-=r:e[1]+=r),Math.abs(_[2])>3.2&&Math.abs(_[0])<1.6&&Math.abs(_[1])<1.6&&(_[2]>0?e[2]-=r:e[2]+=r)}function ma(e,t,r){var _=an(t,i_);return function(e,t){var r=Jr,_=Zr;return Oa(e,r,_),he(Math.abs(r[0])+Math.abs(r[1])+Math.abs(r[2])>Math.abs(_[0])+Math.abs(_[1])+Math.abs(_[2])?_:r,t),t}(b(an(e,s_),_,E_),r)}function Oa(e,t,r){var _=Math.sqrt(e[0]*e[0]+e[1]*e[1]);_>1e-6?(t[0]=Math.atan2(e[5],e[8]),t[1]=Math.atan2(-e[2],_),t[2]=Math.atan2(e[1],e[0]),r[0]=Math.atan2(-e[5],-e[8]),r[1]=Math.atan2(-e[2],-_),r[2]=Math.atan2(-e[1],-e[0])):(t[0]=Math.atan2(-e[7],e[4]),t[1]=Math.atan2(-e[2],_),t[2]=0,he(t,r))}function va(e,t){var r=!1,_=0,n=0,a={};function o(e,t){var r=[];e[0].indexOf("%c")>-1?r.push(e[0].replace("%c","%c"+t+": ")):r.push(t+": "+e[0]);for(var _=1;_<e.length;_++)r.push(e[_]);return r}function i(){_++;var e=o(arguments,"B4W ERROR");console.error.apply(console,e)}function s(e){e in a||(a[e]=e,i([e]))}function E(e,t){s(e+"() is deprecated, use "+t+"() instead.")}t.set_verbose=function(e){r=e},t.log_raw=function(){console.log.apply(console,arguments)},t.log=function(){if(r){var e=o(arguments,"B4W LOG");console.log.apply(console,e)}},t.compose_args_prefix=o,t.error=i,t.error_once=s,t.error_deprecated=E,t.error_deprecated_arr=function(e,t){switch(t.length>1){case!0:s(e+"() is deprecated, use "+t.slice(0,-1).join("(), ")+"() or "+t[t.length-1]+"() instead.");break;case!1:E(e,t[0])}},t.error_deprecated_cfg=function(e,t){s(void 0===t?'Config option "'+e+'" is deprecated.':'Config option "'+e+'" is deprecated, use "'+t+'" instead.')},t.warn=function(){n++;var e=o(arguments,"B4W WARN");console.warn.apply(console,e)},t.info=function(){var e=o(arguments,"B4W INFO");console.info.apply(console,e)},t.export_error=function(){_++;var e=o(arguments,"B4W EXPORT ERROR");console.error.apply(console,e)},t.export_warn=function(){n++;var e=o(arguments,"B4W EXPORT WARNING");console.warn.apply(console,e)},t.time=function(){r&&console.time.apply(console,arguments)},t.timeEnd=function(){r&&console.timeEnd.apply(console,arguments)},t.group=function(){console.group.apply(console,arguments)},t.groupCollapsed=function(){console.groupCollapsed.apply(console,arguments)},t.groupEnd=function(){console.groupEnd.apply(console,arguments)},t.clear=function(){"function"==typeof console.clear&&console.clear.apply(console,arguments)},t.get_warning_count=function(){return n},t.get_error_count=function(){return _},t.clear_errors_warnings=function(){n=0,_=0}}var Na=A("print",va);A("__print",va);var ga=Na,ha=A("assert",function(e,t){var r=ga(e),_=null,n=!1;function a(e){throw e&&r.error.apply(r,arguments),"engine panic:\nThe engine tried to perform an invalid operation and halted.\nPlease copy the console contents above and submit it to the Blend4Web forum at\nhttps://www.blend4web.com/en/forums/forum/17/"}function o(e,t){if(i(e)||a("Structure assertion failed: invalid first object value"),i(t)||a("Structure assertion failed: invalid second object value"),s(e,t)||a("Structure assertion failed: incompatible types"),!(null==e||null==t||"object"!=typeof e||Gn(e)||e instanceof Array)){for(var r in e)i(e[r])||a("Structure assertion failed: invalid value for key in the first object: "+r),r in t||a("Structure assertion failed: missing key in the first object: "+r);for(var r in t)i(t[r])||a("Structure assertion failed: invalid value for key in the second object: "+r),r in e||a("Structure assertion failed: missing key in the second object: "+r),s(e[r],t[r])||a("Structure assertion failed: incompatible types for key "+r)}}function i(e){return"undefined"!=typeof e&&("number"!=typeof e||!isNaN(e))}function s(e,t){if(typeof e!=typeof t)return!1;if(null!=e&&null!=t&&"object"==typeof e){var r=e instanceof Array,_=t instanceof Array;if(r&&!_||!r&&_)return!1;var n=Gn(e),a=Gn(t);if(n&&!a||!n&&a)return!1}return!0}t.panic=a,t.assert=function(e){e||a("Assertion failed")},t.is_constructor=function(e,t){e.constructor!=t&&a("Type assertion failed: value <"+e+"> has type <"+e.constructor+">, required <"+t+">")},t.equal=o,t.equal_seq=function(e){n?o(e,_):n=!0,_=null!=e&&"object"==typeof e?Tn(e):e}}),Ra=(Math.sin(-Math.PI/4),new Float32Array(3)),Ia=new Float32Array(4);function ba(){var e=new Float32Array(8);return e[3]=1,e[7]=1,e}function Ya(e,t,r,_,n,a,o,i){var s=ba();return s[0]=e,s[1]=t,s[2]=r,s[3]=_,s[4]=n,s[5]=a,s[6]=o,s[7]=i,s}function La(){var e=new Float32Array(9);return e[3]=1,e[7]=1,e}function Ma(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function xa(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e[6]=0,e[7]=1,e}function ya(e,t,r,_){return _[0]=e[0],_[1]=e[1],_[2]=e[2],_[3]=t,_[4]=r[0],_[5]=r[1],_[6]=r[2],_[7]=r[3],_}function wa(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Ua(e,t){return t[3]=e,t}function Ca(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Da(e,t){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t}function Fa(e){return e.subarray(0,3)}function Ga(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function ka(e){return e[3]}function Ka(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Ba(e){return e.subarray(4,8)}function Xa(e,t){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t}function Ha(e,t){var r=1/e[3];if(!r)return null;var _=e[0],n=e[1],a=e[2];Ia[0]=e[4],Ia[1]=e[5],Ia[2]=e[6],Ia[3]=e[7],Vr(Ia,Ia);var o=Ia[0],i=Ia[1],s=Ia[2],E=Ia[3],c=_*r,l=n*r,T=a*r,u=E*c+i*T-s*l,d=E*l+s*c-o*T,f=E*T+o*l-i*c,P=-o*c-i*l-s*T;return t[0]=-(u*E+P*-o+d*-s-f*-i),t[1]=-(d*E+P*-i+f*-o-u*-s),t[2]=-(f*E+P*-s+u*-i-d*-o),t[3]=r,t[4]=o,t[5]=i,t[6]=s,t[7]=E,t}function Qa(e,t){var r=e.subarray(0,3),_=e[3];Ee(e.subarray(4,8),r,t);for(var n=0;n<12;n++)t[n]*=_;return t}function za(e,t){return ya(dn(e,Ra),(r=e,a_[0]=.577350269189626,a_[1]=.577350269189626,a_[2]=.577350269189626,a_[3]=0,gr(a_,r,a_),Pr(a_)),un(e,Ia),t),t;var r}function Va(e,t,r){ja(t,e,r),r[3]=e[3]*t[3];var _=e[4],n=e[5],a=e[6],o=e[7],i=t[4],s=t[5],E=t[6],c=t[7];return r[4]=_*c+o*i+n*E-a*s,r[5]=n*c+o*s+a*i-_*E,r[6]=a*c+o*E+_*s-n*i,r[7]=o*c-_*i-n*s-a*E,r}function ja(e,t,r){var _=t[0],n=t[1],a=t[2],o=t[3],i=t[4],s=t[5],E=t[6],c=t[7],l=e[0]*o,T=e[1]*o,u=e[2]*o,d=c*l+s*u-E*T,f=c*T+E*l-i*u,P=c*u+i*T-s*l,A=-i*l-s*T-E*u;return r[0]=d*c+A*-i+f*-E-P*-s,r[1]=f*c+A*-s+P*-i-d*-E,r[2]=P*c+A*-E+d*-s-f*-i,r[0]+=_,r[1]+=n,r[2]+=a,r}function qa(e,t,r){var _=t[3],n=e[0]-t[0],a=e[1]-t[1],o=e[2]-t[2],i=t[4],s=t[5],E=t[6],c=t[7],l=i*i+s*s+E*E+c*c,T=l?1/l:0,u=(c*=T)*n+(s=-s*T)*o-(E=-E*T)*a,d=c*a+E*n-(i=-i*T)*o,f=c*o+i*a-s*n,P=-i*n-s*a-E*o;return r[0]=u*c+P*-i+d*-E-f*-s,r[1]=d*c+P*-s+f*-i-u*-E,r[2]=f*c+P*-E+u*-s-d*-i,r[0]/=_,r[1]/=_,r[2]/=_,r}function Wa(e,t,r,_){_||(_=0);for(var n=e.length,a=t[0],o=t[1],i=t[2],s=t[3],E=t[4],c=t[5],l=t[6],T=t[7],u=0;u<n;u+=3){var d=e[u]*s,f=e[u+1]*s,P=e[u+2]*s,A=T*d+c*P-l*f,S=T*f+l*d-E*P,p=T*P+E*f-c*d,m=-E*d-c*f-l*P;r[_+u]=A*T+m*-E+S*-l-p*-c,r[_+u+1]=S*T+m*-c+p*-E-A*-l,r[_+u+2]=p*T+m*-l+A*-c-S*-E,r[_+u]+=a,r[_+u+1]+=o,r[_+u+2]+=i}return r}function Ja(e,t,r,_){_||(_=0);for(var n=e.length,a=t[3],o=t[4],i=t[5],s=t[6],E=t[7],c=0;c<n;c+=3){var l=e[c]*a,T=e[c+1]*a,u=e[c+2]*a,d=E*l+i*u-s*T,f=E*T+s*l-o*u,P=E*u+o*T-i*l,A=-o*l-i*T-s*u;r[_+c]=d*E+A*-o+f*-s-P*-i,r[_+c+1]=f*E+A*-i+P*-o-d*-s,r[_+c+2]=P*E+A*-s+d*-i-f*-o}return r}function Za(e,t,r){var _=t[3],n=t[4],a=t[5],o=t[6],i=t[7],s=e[0]*_,E=e[1]*_,c=e[2]*_,l=i*s+a*c-o*E,T=i*E+o*s-n*c,u=i*c+n*E-a*s,d=-n*s-a*E-o*c;return r[0]=l*i+d*-n+T*-o-u*-a,r[1]=T*i+d*-a+u*-n-l*-o,r[2]=u*i+d*-o+l*-a-T*-n,r}function $a(e,t,r,_){_||(_=0);for(var n=e.length,a=t[3],o=t[4],i=t[5],s=t[6],E=t[7],c=0;c<n;c+=4){var l=e[c]*a,T=e[c+1]*a,u=e[c+2]*a,d=E*l+i*u-s*T,f=E*T+s*l-o*u,P=E*u+o*T-i*l,A=-o*l-i*T-s*u;r[_+c]=d*E+A*-o+f*-s-P*-i,r[_+c+1]=f*E+A*-i+P*-o-d*-s,r[_+c+2]=P*E+A*-s+d*-i-f*-o,r[_+c+3]=e[c+3]}return r}function eo(e,t,r){return Fr(Xa(t,Ia),e,r),r}function to(e,t,r){var _=e[3],n=e[4],a=e[5],o=e[6],i=e[7],s=t[0]*_,E=t[1]*_,c=t[2]*_,l=i*s+a*c-o*E,T=i*E+o*s-n*c,u=i*c+n*E-a*s,d=-n*s-a*E-o*c;return r[0]=e[0]+l*i+d*-n+T*-o-u*-a,r[1]=e[1]+T*i+d*-a+u*-n-l*-o,r[2]=e[2]+u*i+d*-o+l*-a-T*-n,r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r}function ro(e,t,r,_){He(e.subarray(0,3),t.subarray(0,3),r,_.subarray(0,3));var n=e[3];return _[3]=n+r*(t[3]-n),Xr(e.subarray(4,8),t.subarray(4,8),r,_.subarray(4,8)),_}function _o(e,t,r,_,n){n[0]=e[0]+t*r[0],n[1]=e[1]+t*r[1],n[2]=e[2]+t*r[2],n[3]=e[3],function(e,t,r){var _=t[0],n=t[1],a=t[2],o=e[4],i=e[5],s=e[6],E=e[7];r[4]=.5*(_*E+n*s-a*i),r[5]=.5*(n*E+a*o-_*s),r[6]=.5*(a*E+_*i-n*o),r[7]=.5*(-_*o-n*i-a*s)}(e,_,n),n[4]=e[4]+n[4]*t,n[5]=e[5]+n[5]*t,n[6]=e[6]+n[6]*t,n[7]=e[7]+n[7]*t,function(e,t){var r=e[4],_=e[5],n=e[6],a=e[7],o=r*r+_*_+n*n+a*a;o>0&&(o=1/Math.sqrt(o),t[4]=e[4]*o,t[5]=e[5]*o,t[6]=e[6]*o,t[7]=e[7]*o)}(n,n)}new Float32Array(16);var no=new Float32Array(24),ao=new Float32Array(3),oo=new Float32Array(3),io=new Float32Array(3),so=new Float32Array(3),Eo=new Float32Array(9),co=new Float32Array(9),lo=new Float32Array(9),To=.001,uo=5e-4,fo=To/2;function Po(){return{bb:{max_x:0,min_x:0,max_y:0,min_y:0,max_z:0,min_z:0},be:Mo(),bs:Yo()}}function Ao(e,t){return So(e.bb,t.bb),xo(e.be,t.be),Lo(e.bs,t.bs),t}function So(e,t){return t.min_x=e.min_x,t.max_x=e.max_x,t.min_y=e.min_y,t.max_y=e.max_y,t.min_z=e.min_z,t.max_z=e.max_z,t}function po(){return{center:new Float32Array(3),axis_x:new Float32Array(3),axis_y:new Float32Array(3),axis_z:new Float32Array(3)}}function mo(e){var t={max_x:0,min_x:0,max_y:0,min_y:0,max_z:0,min_z:0};return So(e,t),t}function Oo(e,t){var r=e.max_y,_=e.max_z,n=e.min_x,a=e.min_y,o=e.min_z;return e.max_x=Math.max(t.max_x,e.max_x),e.max_y=Math.max(t.max_y,r),e.max_z=Math.max(t.max_z,_),e.min_x=Math.min(t.min_x,n),e.min_y=Math.min(t.min_y,a),e.min_z=Math.min(t.min_z,o),e}function vo(e,t,r,_){for(var n=e[t],a=e[t+1],o=e[t+2],i=e[t],s=e[t+1],E=e[t+2],c=t+3;c<r;c+=3){var l=e[c],T=e[c+1],u=e[c+2];n=Math.max(n,l),a=Math.max(a,T),o=Math.max(o,u),i=Math.min(i,l),s=Math.min(s,T),E=Math.min(E,u)}return _.max_x=n,_.max_y=a,_.max_z=o,_.min_x=i,_.min_y=s,_.min_z=E,_}function No(e,t,r){r||(r={max_x:0,min_x:0,max_y:0,min_y:0,max_z:0,min_z:0});var _=go(e,no);return Wa(_,t,_),vo(_,0,_.length,r)}function go(e,t){t||(t=new Float32Array(24));var r=e.max_x,_=e.max_y,n=e.max_z,a=e.min_x,o=e.min_y,i=e.min_z;return t[0]=a,t[1]=o,t[2]=i,t[3]=r,t[4]=o,t[5]=i,t[6]=r,t[7]=_,t[8]=i,t[9]=a,t[10]=_,t[11]=i,t[12]=a,t[13]=o,t[14]=n,t[15]=r,t[16]=o,t[17]=n,t[18]=r,t[19]=_,t[20]=n,t[21]=a,t[22]=_,t[23]=n,t}function ho(e,t,r){r||(r=Yo()),ja(e.center,t,r.center);var _=ka(t);return r.radius=e.radius*(_<0?-_:_),r}function Ro(e,t,r){return r||(r=Mo()),ja(e.center,t,r.center),he(e.axis_x,r.axis_x),he(e.axis_y,r.axis_y),he(e.axis_z,r.axis_z),Za(r.axis_x,t,r.axis_x),Za(r.axis_y,t,r.axis_y),Za(r.axis_z,t,r.axis_z),r}function Io(e,t,r){return r||(r=po()),ja(e.center,t,r.center),he(e.axis_x,r.axis_x),he(e.axis_y,r.axis_y),he(e.axis_z,r.axis_z),Za(r.axis_x,t,r.axis_x),Za(r.axis_y,t,r.axis_y),Za(r.axis_z,t,r.axis_z),r}function bo(e,t){var r=Yo();return he(t,r.center),r.radius=e,r}function Yo(){return{center:new Float32Array(3),radius:0}}function Lo(e,t){return t.center[0]=e.center[0],t.center[1]=e.center[1],t.center[2]=e.center[2],t.radius=e.radius,t}function Mo(){return{axis_x:new Float32Array(3),axis_y:new Float32Array(3),axis_z:new Float32Array(3),center:new Float32Array(3)}}function xo(e,t){return he(e.axis_x,t.axis_x),he(e.axis_y,t.axis_y),he(e.axis_z,t.axis_z),he(e.center,t.center),t}function yo(e,t,r,_){return{axis_x:new Float32Array(e),axis_y:new Float32Array(t),axis_z:new Float32Array(r),center:new Float32Array([_[0],_[1],_[2]])}}function wo(e,t){var r=be(t.center,e.center,ve());0==De(r)&&Re(1,0,0,r);var _=Ke(r,ve()),n=ye(_,e.radius,ve());Ie(n,e.center,n);var a=ye(_,-e.radius,ve());Ie(a,e.center,a);var o=ye(_,t.radius,ve());Ie(o,t.center,o);var i=ye(_,-t.radius,ve());Ie(i,t.center,i);var s=function(e,t){for(var r=Ke(_,ve()),n=e[0],a=e[0],o=1;o<e.length;o++){var i=Be(e[o],r);i<Be(n,r)&&(n=e[o]),i>Be(a,r)&&(a=e[o])}return[n,a]}([n,a,o,i]),E=s[0],c=s[1];e.center=ye(Ie(E,c,ve()),.5,ve()),e.radius=De(be(c,E,ve()))/2}function Uo(e,t){Ie(e.center,e.axis_y,ao),Ie(ao,e.axis_x,ao),Ie(ao,e.axis_z,ao),t.push(ao[0],ao[1],ao[2]),Ie(e.center,e.axis_y,ao),Ie(ao,e.axis_x,ao),be(ao,e.axis_z,ao),t.push(ao[0],ao[1],ao[2]),Ie(e.center,e.axis_y,ao),be(ao,e.axis_x,ao),Ie(ao,e.axis_z,ao),t.push(ao[0],ao[1],ao[2]),Ie(e.center,e.axis_y,ao),be(ao,e.axis_x,ao),be(ao,e.axis_z,ao),t.push(ao[0],ao[1],ao[2]),be(e.center,e.axis_y,ao),Ie(ao,e.axis_x,ao),Ie(ao,e.axis_z,ao),t.push(ao[0],ao[1],ao[2]),be(e.center,e.axis_y,ao),Ie(ao,e.axis_x,ao),be(ao,e.axis_z,ao),t.push(ao[0],ao[1],ao[2]),be(e.center,e.axis_y,ao),be(ao,e.axis_x,ao),Ie(ao,e.axis_z,ao),t.push(ao[0],ao[1],ao[2]),be(e.center,e.axis_y,ao),be(ao,e.axis_x,ao),be(ao,e.axis_z,ao),t.push(ao[0],ao[1],ao[2])}function Co(e,t){var r=function(e,t){t[0]=0,t[1]=0,t[2]=0;for(var r=0;r<e.length;r+=3)t[0]+=e[r],t[1]+=e[r+1],t[2]+=e[r+2];return ye(t,3/e.length,t)}(e,so);if(t)var _=function(e,t,r){for(var _=0;_<r.length;_++)r[_]=0;for(_=0;_<e.length;_+=3){var n=e[_]-t[0],a=e[_+1]-t[1],o=e[_+2]-t[2];r[0]+=n*n,r[1]+=n*a,r[2]+=n*o,r[4]+=a*a,r[5]+=a*o,r[8]+=o*o}for(r[3]=r[1],r[6]=r[2],r[7]=r[5],_=0;_<r.length;_++)r[_]*=3/e.length;return r}(e,r,co);else _=N(co);var n=function(e,t,r){var n=v(_,at);if(Pt(n)<t)return N(r);var a=ft(n,ot),o=g(a,it);b(n,o,st),b(a,st,n);for(var i=v(a,r),s=1;t<=Pt(n)&&s<Et;)b(n,o=g(a=ft(n,ot),it),st),b(a,st,n),b(a,i,i),s++;return i}(0,uo,Eo);he(e,ao),qe(ao,n,ao);for(var a=ao[0],o=a,i=ao[1],s=i,E=ao[2],c=E,l=0,T=0,u=0,d=0,f=0,P=0,A=3;A<e.length;A+=3){ao[0]=e[A],ao[1]=e[A+1],ao[2]=e[A+2],qe(ao,n,ao);var S=ao[0],p=ao[1],m=ao[2];S>a&&(a=S),S<o&&(o=S),p>i&&(i=p),p<s&&(s=p),m>E&&(E=m),m<c&&(c=m)}var O=a-o,h=i-s,R=E-c;O=Math.max(O,To),h=Math.max(h,To),R=Math.max(R,To);var I=N(co);for(I[0]=0!=O?1/O:1/fo,I[4]=0!=h?1/h:1/fo,I[8]=0!=R?1/R:1/fo,g(n,lo),ao[0]=e[0],ao[1]=e[1],ao[2]=e[2],qe(ao,n,ao),qe(ao,I,ao),qe(ao,lo,ao),l=ao[0],T=ao[0],u=ao[1],d=ao[1],f=ao[2],P=ao[2],A=3;A<e.length;A+=3)ao[0]=e[A],ao[1]=e[A+1],ao[2]=e[A+2],qe(ao,n,ao),qe(ao,I,ao),qe(ao,lo,ao),l=Math.max(l,ao[0]),T=Math.min(T,ao[0]),u=Math.max(u,ao[1]),d=Math.min(d,ao[1]),f=Math.max(f,ao[2]),P=Math.min(P,ao[2]);var Y=Math.sqrt((l-T)*(l-T)+(u-d)*(u-d)+(f-P)*(f-P))/2;Y=Math.min(Y,1),io[0]=(l+T)/2,io[1]=(u+d)/2,io[2]=(f+P)/2;var L=io;(I=N(co))[0]=O,I[4]=h,I[8]=R,qe(L,n,L),qe(L,I,L),qe(L,lo,L);var M=[n[0],n[3],n[6]],x=[n[1],n[4],n[7]],y=[n[2],n[5],n[8]];return ye(M,O*Y,M),ye(x,h*Y,x),ye(y,R*Y,y),yo(M,x,y,L)}function Do(e){var t=Yo(),r=0,_=De(e.axis_x),n=De(e.axis_y),a=De(e.axis_z);return r=a>(r=_>n?_:n)?a:r,t.center=e.center,t.radius=r,t}function Fo(e,t){var r=De(e.axis_x),_=De(e.axis_y),n=De(e.axis_z);return t.radius*t.radius*t.radius*.75>r*_*n}function Go(){return{radius:0,height:0,center:new Float32Array(3)}}function ko(e,t){var r=t.max_z,_=t.min_z,n=Math.max(0,r-_-2*e),a=Go();return a.radius=e,a.height=n,a.center[0]=0,a.center[1]=0,a.center[2]=(r+_)/2,a}function Ko(e,t){var r=t.max_z,_=t.min_z,n=Math.max(0,r-_),a=Go();return a.radius=e,a.height=n,a.center[0]=0,a.center[1]=0,a.center[2]=(r+_)/2,a}function Bo(e,t){var r=t.max_z,_=t.min_z,n=Math.max(0,r-_),a=Go();return a.radius=e,a.height=n,a.center[0]=0,a.center[1]=0,a.center[2]=(r+_)/2,a}function Xo(e,t){return t.radius=e.radius,t.height=e.height,t.center.set(e.center),t}function Ho(e){for(var t=0,r=0,_={max_x:0,min_x:0,max_y:0,min_y:0,max_z:0,min_z:0},n=0;n<e.submeshes.length;n++){for(var a=e.submeshes[n],o=a.position,i=0;i<o.length/3;i++){var s=o[3*i],E=o[3*i+1],c=o[3*i+2];t=Math.max(Math.sqrt(s*s+E*E+c*c),t),r=Math.max(Math.sqrt(s*s+E*E),r)}var l=a.boundings.bb,T=vo(o,0,o.length,{max_x:0,min_x:0,max_y:0,min_y:0,max_z:0,min_z:0});l.max_x=T.max_x,l.min_x=T.min_x,l.max_y=T.max_y,l.min_y=T.min_y,l.max_z=T.max_z,l.min_z=T.min_z;var u=Co(go(T,no),!1);a.boundings.be_cen=u.center,a.boundings.be_ax=[u.axis_x[0],u.axis_y[1],u.axis_z[2]],0==n?So(T,_):Oo(_,T)}var d=e.b4w_boundings.bb;d.max_x=_.max_x,d.min_x=_.min_x,d.max_y=_.max_y,d.min_y=_.min_y,d.max_z=_.max_z,d.min_z=_.min_z;var f=e.b4w_boundings.bb_src;f.max_x=_.max_x,f.min_x=_.min_x,f.max_y=_.max_y,f.min_y=_.min_y,f.max_z=_.max_z,f.min_z=_.min_z,e.b4w_boundings.bs_rad=t,e.b4w_boundings.bc_rad=r,u=Co(go(_,no),!1),e.b4w_boundings.be_cen=u.center,e.b4w_boundings.be_ax=[u.axis_x[0],u.axis_y[1],u.axis_z[2]]}function Qo(e){var t=e.subarray(0,3),r=e.subarray(6,9),_=e.subarray(12,15),n=e.subarray(18,21),a=be(r,t,ao);Ke(a,a);var o,i,s,E,c,l,T,u,d,f,P=(c=(i=r)[0]-(o=t)[0],l=(s=_)[0]-o[0],(E=oo)[0]=(T=i[1]-o[1])*(f=s[2]-o[2])-(d=i[2]-o[2])*(u=s[1]-o[1]),E[1]=l*d-c*f,E[2]=c*u-T*l,E),A=Xe(P,a,P);Ke(A,A);var S=ve(),p=ve();be(r,t,io),p[0]=Be(io,a),p[1]=Be(io,A);var m=ve();be(_,t,io),m[0]=Be(io,a),m[1]=Be(io,A);var O=ve();be(n,t,io),O[0]=Be(io,a),O[1]=Be(io,A);var v=Yo(),N=ye(a,(v=function(e,t){t=jo(t,e[0],e[1]);for(var r=2;r<e.length;r++)Ue(t.center,e[r])>t.radius&&(t=zo(t,e,e[r],r-1));return t}([S,p,m,O],v)).center[0],io);return we(N,A,v.center[1],N),Ie(N,t,v.center),v}function zo(e,t,r,_){e=jo(e,r,t[0]);for(var n=1;n<=_;n++)Ue(e.center,t[n])>e.radius&&(e=Vo(e,t,r,t[n],n-1));return e}function Vo(e,t,r,_,n){e=jo(e,r,_);for(var a=0;a<=n;a++)Ue(e.center,t[a])>e.radius&&(e=qo(e,r,_,t[a]));return e}function jo(e,t,r){return Ie(t,r,e.center),ye(e.center,.5,e.center),e.radius=Ue(e.center,t),e}function qo(e,t,r,_){var n=Fe(be(r,_,io)),a=Fe(be(t,_,io)),o=Fe(be(t,r,io)),i=n*(a+o-n),s=a*(o+n-a),E=o*(n+a-o),c=i+s+E;return he(t,e.center),ye(e.center,i/c,e.center),we(e.center,r,s/c,e.center),we(e.center,_,E/c,e.center),e.radius=Ue(e.center,t),e}var Wo=A("__config",function(e,t){var r=ha(e),_=ga(e);function n(){return f.module_check(t.paths.built_in_data_module)}function a(){return t.physics.use_wasm&&window.WebAssembly}function o(){for(var e=t.paths,r=null,n=!1,a=document.getElementsByTagName("script"),o=0;o<a.length;o++){for(var i=a[o].src,s=0;s<e.js_src_search_paths.length;s++)if(i.indexOf(e.js_src_search_paths[s])>=0&&(r=i,a[o].attributes["b4w-offset"])){r=r.substring(0,r.lastIndexOf("/"))+"/"+a[o].attributes["b4w-offset"].value,n=!0;break}if(n)break}r||(_.warn("Couldn't determine path to ancillary resources, fallback to the current page directory"),r=document.location.href);var E=r.indexOf("?");return E>=0&&(r=r.substring(0,E)),r.substring(0,r.lastIndexOf("/"))}t.P_LOW=1,t.P_HIGH=2,t.P_ULTRA=3,t.P_CUSTOM=4,t.P_AUTO=5,t.context={alpha:!0,antialias:!1,premultipliedAlpha:!0},t.context_save=ln(t.context),t.defaults={alpha_sort:!0,alpha_sort_threshold:.1,min_format_version:[6,3],max_fps:1e4,console_verbose:!1,do_not_load_resources:!1,use_min50:!1,enable_texture_cache:!0,fps_measurement_interval:1,fps_callback_interval:5,background_color:[0,0,0,0],canvas_resolution_factor:1,texture_min_filter:3,allow_cors:!1,force_low_quality_nodes:!1,anisotropic_available:!0,anisotropic_filtering:!0,texture_lod_available:!1,tex_float_available:!1,tex_hfloat_available:!1,tex_float_lin_available:!1,tex_hfloat_lin_available:!1,cbuffer_float_available:!1,cbuffer_hfloat_available:!1,show_hud_debug_info:!1,depth_tex_available:!0,shadows:!0,stereo:"NONE",reflections:!0,refractions:!0,ssao:!0,dof:!0,god_rays:!0,bloom:!0,motion_blur:!0,compositing:!0,antialiasing:!0,smaa:!1,debug_view:!1,water_wireframe_debug:!1,foam:!0,parallax:!0,dynamic_grass:!0,water_dynamic:!0,shore_smoothing:!0,shore_distance:!0,use_compression:!0,precision:"highp",quality:t.P_HIGH,allow_vertex_textures:!0,lod_leap_smooth_threshold:3,assets_gzip_available:!1,no_phy_interp_hack:!1,shader_constants_hack:!1,disable_blend_shadows_hack:!1,vert_anim_mix_normals_hack:!1,is_mobile_device:!1,init_wa_context_hack:!1,clear_procedural_sky_hack:!1,sky_update_hack:!1,seq_video_fallback:!1,allow_hidpi:!1,shadows_color_slink_hack:!1,mobile_firefox_media_hack:!1,ipad_video_hack:!1,enable_selectable:!0,enable_outlining:!0,lod_smooth_transitions:!0,glow_materials:!0,ie11_edge_touchscreen_hack:!1,firefox_tex_reuse_hack:!1,loaded_data_version:[0,0],quality_aa_method:!0,skinning_hack:!1,url_params:null,webgl2:!0,msaa_samples:4,compared_mode_depth:!1,safari_canvas_alpha_hack:!1,safari_glow_hack:!1,resize_cubemap_canvas_hack:!1,resize_texture_canvas_hack:!1,chrome_html_bkg_music_hack:!1,ie_edge_anchors_floor_hack:!1,ie11_edge_mouseoffset_hack:!1,media_auto_activation:!0,max_cast_lamps:4,mac_os_shadow_hack:!1,gl_debug:!1,check_framebuffer_hack:!1,allow_instanced_arrays_ext:!1,allow_vao_ext:!1,compress_format:"dds",shadow_blur_samples:"",reflection_quality:"",srgb_type:"SRGB_SIMPLE",ios_copy_tex_hack:!1,rgba_fallback_shadows:!1,debug_loading:!1,mali_alpha_antialias_hack:!1,mali4_lamps_hack:!1,chrome_csm_blend_hack:!1,reuse_depth_optimization:!0},t.defaults_save=ln(t.defaults),t.animation={framerate:-1,frames_blending_hack:!1,frame_steps:1},t.controls={mouse_wheel_notch_multiplier:1/120},t.assets={path:"",path_default:"B4W_ASSETS_PATH=__JS__/assets/",proj_path_default:"B4W_PROJ_ASSETS_PATH=__JS__/../projects/__NAME__/assets/",max_requests:15,prevent_caching:!0,min50_available:!1,dds_available:!1,pvr_available:!1},t.assets_save=ln(t.assets),t.paths={shaders_path:"",shaders_path_default:"../shaders/",shaders_include_dir:"include/",shaders_postp_dir:"postprocessing/",built_in_data_module:"built_in_data",js_src_search_paths:["b4w.js","b4w.min.js","b4w.simple.min.js","b4w.whitespace.min.js","b4w_app_bundle.js","B4W_MAIN_MODULE"],smaa_search_texture_path:"smaa_search_texture.png",smaa_area_texture_path:"smaa_area_texture.png"},t.hmd_params={webvr:{distortion_coefs:[.22,.28],chromatic_aberration_coefs:[-.015,.02,.025,.02]},nonwebvr:{distor_scale:.8,inter_lens_dist:.064,base_line_dist:.035,screen_to_lens_dist:.039,distortion_coefs:[.34,.55],chromatic_aberration_coefs:[0,0,0,0],width_dist:.11,height_dist:.062,bevel_size:.004}},t.physics={enabled:!0,max_fps:60,uranium_path:"",uranium_bin:"",uranium_path_default:"B4W_URANIUM_PATH=/dist/uranium/",asmjs_file:"uranium.js",wasmjs_file:"uranium_wasm.js",mem_file:"uranium.js.mem",wasm_file:"uranium_wasm.wasm",uranium_dir:"/dist/uranium",calc_fps:!1,ping:!1,use_workers:!0,use_wasm:!0},t.physics_save=ln(t.physics),t.scenes={grass_tex_size:1024,cubemap_tex_size:256,cube_reflect_low:32,cube_reflect_medium:128,cube_reflect_high:256,plane_reflect_low:.25,plane_reflect_medium:.5,plane_reflect_high:1},t.scenes_save=ln(t.scenes),t.sfx={webaudio:!0,mix_mode:!1,audio_loading_hack:!1,clamp_playback_rate_hack:!1,disable_playback_rate_hack:!1},t.sfx_save=ln(t.sfx),t.outlining={outlining_overview_mode:!1,outline_color:[1,.4,.05],outline_duration:.2,outline_period:3.8,outline_relapses:1},t.debug_subs={enabled:!1,subs_type:39,subs_number:0,slink_type:"COLOR"},t.debug_subs_save=ln(t.debug_subs),t.context_limits={max_combined_texture_image_units:8,max_fragment_uniform_vectors:64,max_texture_image_units:8,max_varying_vectors:8,max_vertex_attribs:15,max_vertex_texture_image_units:0,max_vertex_uniform_vectors:128,max_cube_map_texture_size:1024,max_renderbuffer_size:4096,max_texture_size:4096,max_viewport_dims:[4096,4096],depth_bits:24},t.context_limits_save=ln(t.context_limits),t.apply_quality=function(){var e=t.defaults,_=t.physics,n=t.scenes;switch(e.quality){case t.P_ULTRA:e.shadows=!0,e.shore_smoothing=!0,e.ssao=!0,e.dof=!0,e.god_rays=!0,e.bloom=!0,e.reflections=!0,e.refractions=!0,e.foam=!0,e.parallax=!0,e.dynamic_grass=!0,n.grass_tex_size=2048,n.cubemap_tex_size=512,e.texture_min_filter=3,e.anisotropic_filtering=!0,e.use_min50=!1,e.water_dynamic=!0,e.shore_distance=!0,e.antialiasing=!0,e.smaa=!1,e.compositing=!0,e.motion_blur=!0,e.allow_hidpi=!0,e.enable_outlining=!0,e.glow_materials=!0,e.msaa_samples=16,e.srgb_type="SRGB_PROPER",_.max_fps=120,e.lod_smooth_transitions=!0;break;case t.P_HIGH:e.shadows=!0,e.shore_smoothing=!0,e.ssao=!0,e.dof=!0,e.god_rays=!0,e.bloom=!0,e.reflections=!0,e.refractions=!0,e.foam=!0,e.parallax=!0,e.dynamic_grass=!0,n.grass_tex_size=1024,n.cubemap_tex_size=256,e.texture_min_filter=3,e.anisotropic_filtering=!0,e.use_min50=!1,e.water_dynamic=!0,e.shore_distance=!0,e.antialiasing=!0,e.smaa=!1,e.compositing=!0,e.motion_blur=!0,e.allow_hidpi=!1,e.enable_outlining=!0,e.glow_materials=!0,e.srgb_type="SRGB_SIMPLE",e.msaa_samples=4,_.max_fps=60,e.lod_smooth_transitions=!0;break;case t.P_LOW:e.shadows=!1,e.shore_smoothing=!1,e.ssao=!1,e.dof=!1,e.god_rays=!1,e.bloom=!1,e.reflections=!1,e.refractions=!1,e.foam=!1,e.parallax=!1,e.dynamic_grass=!1,n.grass_tex_size=512,n.cubemap_tex_size=256,e.texture_min_filter=2,e.anisotropic_filtering=!1,e.use_min50=!0,e.water_dynamic=!1,e.shore_distance=!1,e.antialiasing=!1,e.smaa=!1,e.compositing=!1,e.motion_blur=!1,e.allow_hidpi=!1,e.enable_outlining=!1,e.glow_materials=!1,e.srgb_type="SRGB_SIMPLE",e.msaa_samples=1,_.max_fps=60,e.lod_smooth_transitions=!1;break;case t.P_CUSTOM:break;case t.P_AUTO:r.panic("Direct AUTO quality profile setting is forbidden")}},t.set=function(e,r){switch(e){case"allow_cors":t.defaults.allow_cors=r;break;case"allow_hidpi":t.defaults.allow_hidpi=r;break;case"alpha":t.context.alpha=r;break;case"alpha_sort":t.defaults.alpha_sort=r;break;case"alpha_sort_threshold":t.defaults.alpha_sort_threshold=r;break;case"anaglyph_use":_.error_deprecated_cfg("anaglyph_use","stereo"),t.defaults.stereo=r?"ANAGLYPH":t.defaults.stereo;break;case"animation_framerate":t.animation.framerate=r;break;case"anisotropic_filtering":t.defaults.anisotropic_filtering=r;break;case"antialiasing":t.defaults.antialiasing=r;break;case"assets_dir":case"assets_path":t.assets.path=r;break;case"assets_dds_available":t.assets.dds_available=r;break;case"assets_pvr_available":t.assets.pvr_available=r;break;case"assets_min50_available":t.assets.min50_available=r;break;case"audio":t.sfx.webaudio=r;break;case"background_color":t.defaults.background_color=r;break;case"bloom":t.defaults.bloom=r;break;case"built_in_module_name":t.paths.built_in_data_module=r;break;case"canvas_resolution_factor":t.defaults.canvas_resolution_factor=r;break;case"console_verbose":t.defaults.console_verbose=r;break;case"compositing":t.defaults.compositing=r;break;case"dof":t.defaults.dof=r;break;case"do_not_load_resources":t.defaults.do_not_load_resources=r;break;case"god_rays":t.defaults.god_rays=r;break;case"stereo":t.defaults.stereo=r;break;case"lod_leap_smooth_threshold":t.defaults.lod_leap_smooth_threshold=r;break;case"lod_smooth_transitions":t.defaults.lod_smooth_transitions=r;break;case"max_fps":t.defaults.max_fps=r;break;case"max_fps_physics":t.physics.max_fps=r;break;case"media_auto_activation":t.defaults.media_auto_activation=r;break;case"motion_blur":t.defaults.motion_blur=r;break;case"physics_enabled":t.physics.enabled=r;break;case"physics_uranium_path":a()?(t.physics.uranium_path=r+t.physics.wasmjs_file,t.physics.uranium_bin=r+t.physics.wasm_file):(t.physics.uranium_path=r+t.physics.asmjs_file,t.physics.uranium_bin=r+t.physics.mem_file),t.physics.uranium_dir=r;break;case"physics_use_wasm":t.physics.use_wasm=r;break;case"physics_calc_fps":t.physics.calc_fps=r;break;case"physics_use_workers":t.physics.use_workers=r;break;case"precision":t.defaults.precision=r;break;case"prevent_caching":t.assets.prevent_caching=r;break;case"quality":t.defaults.quality=r;break;case"reflections":t.defaults.reflections=r;break;case"refractions":t.defaults.refractions=r;break;case"sfx_mix_mode":t.sfx.mix_mode=r;break;case"shaders_dir":case"shaders_path":t.paths.shaders_path=r;break;case"shadows":t.defaults.shadows=r;break;case"show_hud_debug_info":t.defaults.show_hud_debug_info=r;break;case"smaa":_.error_deprecated_cfg("smaa"),t.defaults.smaa=r;break;case"smaa_search_texture_path":_.error_deprecated_cfg("smaa_search_texture_path"),t.paths.smaa_search_texture_path=r;break;case"smaa_area_texture_path":_.error_deprecated_cfg("smaa_area_texture_path"),t.paths.smaa_area_texture_path=r;break;case"ssao":t.defaults.ssao=r;break;case"debug_view":t.defaults.debug_view=r;break;case"enable_selectable":t.defaults.enable_selectable=r;break;case"enable_outlining":t.defaults.enable_outlining=r;break;case"outlining_overview_mode":t.outlining.outlining_overview_mode=r;break;case"glow_materials":t.defaults.glow_materials=r;break;case"url_params":t.defaults.url_params=r;break;case"use_min50":t.defaults.use_min50=r;break;case"enable_texture_cache":t.defaults.enable_texture_cache=r;break;case"gl_debug":t.defaults.gl_debug=r;break;case"srgb_type":t.defaults.srgb_type=r;break;case"shadow_blur_samples":t.defaults.shadow_blur_samples=r;break;case"reflection_quality":t.defaults.reflection_quality=r;break;case"assets_gzip_available":t.defaults.assets_gzip_available=r;break;case"debug_loading":t.defaults.debug_loading=r;break;case"msaa_samples":t.defaults.msaa_samples=r;break;default:_.error("Unknown config property: "+e)}},t.get=function(e){switch(e){case"allow_cors":return t.defaults.allow_cors;case"allow_hidpi":return t.defaults.allow_hidpi;case"alpha":return t.context.alpha;case"alpha_sort":return t.defaults.alpha_sort;case"alpha_sort_threshold":return t.defaults.alpha_sort_threshold;case"anaglyph_use":return"ANAGLYPH"==t.defaults.stereo;case"animation_framerate":return t.animation.framerate;case"anisotropic_filtering":return t.defaults.anisotropic_filtering;case"antialiasing":return t.defaults.antialiasing;case"assets_dir":case"assets_path":return t.assets.path;case"assets_dds_available":return t.assets.dds_available;case"assets_pvr_available":return t.assets.pvr_available;case"assets_min50_available":return t.assets.min50_available;case"audio":return t.sfx.webaudio;case"background_color":return t.defaults.background_color;case"bloom":return t.defaults.bloom;case"built_in_module_name":return t.paths.built_in_data_module;case"canvas_resolution_factor":return t.defaults.canvas_resolution_factor;case"console_verbose":return t.defaults.console_verbose;case"compositing":return t.defaults.compositing;case"dof":return t.defaults.dof;case"do_not_load_resources":return t.defaults.do_not_load_resources;case"is_mobile_device":return t.defaults.is_mobile_device;case"god_rays":return t.defaults.god_rays;case"stereo":return t.defaults.stereo;case"lod_leap_smooth_threshold":return t.defaults.lod_leap_smooth_threshold;case"lod_smooth_transitions":return t.defaults.lod_smooth_transitions;case"max_fps":return t.defaults.max_fps;case"max_fps_physics":return t.physics.max_fps;case"media_auto_activation":return t.defaults.media_auto_activation;case"motion_blur":return t.defaults.motion_blur;case"physics_enabled":return t.physics.enabled;case"physics_uranium_path":return t.physics.uranium_dir;case"physics_uranium_bin":return t.physics.uranium_bin;case"physics_use_wasm":return t.physics.use_wasm;case"physics_calc_fps":return t.physics.calc_fps;case"physics_use_workers":return t.physics.use_workers;case"precision":return t.defaults.precision;case"prevent_caching":return t.assets.prevent_caching;case"quality":return t.defaults.quality;case"reflections":return t.defaults.reflections;case"refractions":return t.defaults.refractions;case"sfx_mix_mode":return t.sfx.mix_mode;case"shaders_dir":case"shaders_path":return t.paths.shaders_path;case"shadows":return t.defaults.shadows;case"show_hud_debug_info":return t.defaults.show_hud_debug_info;case"smaa":return t.defaults.smaa;case"smaa_search_texture_path":return t.paths.smaa_search_texture_path;case"smaa_area_texture_path":return t.paths.smaa_area_texture_path;case"ssao":return t.defaults.ssao;case"debug_view":return t.defaults.debug_view;case"enable_selectable":return t.defaults.enable_selectable;case"enable_outlining":return t.defaults.enable_outlining;case"outlining_overview_mode":return t.outlining.outlining_overview_mode;case"glow_materials":return t.defaults.glow_materials;case"url_params":return t.defaults.url_params;case"use_min50":return t.defaults.use_min50;case"enable_texture_cache":return t.defaults.enable_texture_cache;case"gl_debug":return t.defaults.gl_debug;case"srgb_type":return t.defaults.srgb_type;case"shadow_blur_samples":return t.defaults.shadow_blur_samples;case"reflection_quality":return t.defaults.reflection_quality;case"assets_gzip_available":return t.defaults.assets_gzip_available;case"debug_loading":return t.defaults.debug_loading;case"msaa_samples":return t.defaults.msaa_samples;default:_.error("Unknown config property: "+e)}},t.reset=function(){for(var e in t.context_save)t.context[e]=t.context_save[e];for(var e in t.defaults_save)t.defaults[e]=t.defaults_save[e];for(var e in t.assets_save)t.assets[e]=t.assets_save[e];for(var e in t.physics_save)t.physics[e]=t.physics_save[e];for(var e in t.scenes_save)t.scenes[e]=t.scenes_save[e];for(var e in t.sfx_save)t.sfx[e]=t.sfx_save[e];for(var e in t.debug_subs_save)t.debug_subs[e]=t.debug_subs_save[e]},t.reset_limits=function(){var e=t.context_limits.depth_bits;for(var r in t.context_limits_save)t.context_limits[r]=t.context_limits_save[r];t.context_limits.depth_bits=e},t.is_built_in_data=n,t.set_paths=function(){var e=t.paths,r=t.physics;if(n()||""!=e.shaders_path||(e.shaders_path=o()+"/"+e.shaders_path_default),a())var _=r.uranium_path_default+r.wasmjs_file,i=r.uranium_path_default+r.wasm_file;else _=r.uranium_path_default+r.asmjs_file,i=r.uranium_path_default+r.mem_file;r.enabled&&""==r.uranium_path&&(r.uranium_path=_.replace("B4W_URANIUM_PATH=",""),r.uranium_bin=i.replace("B4W_URANIUM_PATH=",""))},t.get_assets_path=function(e){var r=t.assets;if(r.path)return r.path;var _=r.path_default,n="B4W_ASSETS_PATH=";return e&&(n="B4W_PROJ_ASSETS_PATH=",_=(_=r.proj_path_default).replace("__NAME__",e)),(_=_.replace(n,"")).replace("__JS__",o())}}),Jo=A("generator",function(e,t){var r=ha(e),_=ga(e),n=1,a=0,o={},i=new Float64Array(1),s=new Uint32Array(i.buffer);function E(e,t){var _=t;switch(typeof e){case"object":if(e)switch(e.constructor){case Object:for(var n in e)_=E(e[n],_);break;case Int8Array:case Uint8Array:case Uint8ClampedArray:case Int16Array:case Uint16Array:case Int32Array:case Uint32Array:case Float32Array:case Float64Array:for(var a=0;a<e.length;a++)_=c(e[a],_);break;case Array:for(a=0;a<e.length;a++)_=E(e[a],_);break;case WebGLUniformLocation:case WebGLProgram:case WebGLShader:case WebGLFramebuffer:case WebGLRenderbuffer:case WebGLTexture:case WebGLBuffer:_=c(0,_);break;default:r.panic("Wrong object constructor:",e.constructor)}else _=c(0,_);return _;case"number":return c(e,_);case"boolean":return c(0|e,_);case"string":return function(e,t){for(var r=t,_=0;_<e.length;_++)r=(r<<5)-r+e.charCodeAt(_),r&=r;return r}(e,_);case"function":case"undefined":return c(0,_)}}function c(e,t){var r=t;return i[0]=e,r=(r<<5)-r+s[0],(r=((r&=r)<<5)-r+s[1])&r}t.unique_name=function(e){o[e]||(o[e]=0);var t=e+o[e];return o[e]++,t},t.cleanup=function(){a=0,o={}},t.unique_id=function(){return(++a).toString(10)},t.gen_color_id=function(e){++e>132651&&_.error("Color ID pool depleted");var t=Math.floor(e/2601);e%=2601;var r=Math.floor(e/51);return e%=51,new Float32Array([t/51,r/51,e/51])},t.rand=function(){return n=(69069*n+5)%Math.pow(2,32),Math.round(n/65536)%32768/32767},t.srand=function(e){n=e},t.calc_variable_id=function(e,t){return E(e,t)},t.hash_code=E}),Zo=A("__extensions",function(e,t){var r=Wo(e),_=ga(e),n=r.defaults,a=null,o={};function i(){return n.webgl2?c("OES_texture_float_linear"):E("OES_texture_float_linear")}function s(){return n.webgl2?c("EXT_color_buffer_float"):E("WEBGL_color_buffer_float")}function E(e){if(e in o)return o[e];var t=a.getExtension(e)||null;if(o[e]=t,t)var r="0a0";else r="a00";return _.log("%cGET EXTENSION","color: #"+r,e),t}function c(e){if(e in o)return o[e];switch(e){case"WEBGL_depth_texture":case"OES_element_index_uint":case"OES_standard_derivatives":case"EXT_shader_texture_lod":case"OES_texture_float":case"OES_texture_half_float":var t={};break;case"ANGLE_instanced_arrays":case"OES_vertex_array_object":t=a;break;default:t=a.getExtension(e)||null}if(o[e]=t,t)var r="0a0";else r="a00";return _.log("%cGET EXTENSION (WebGL 2)","color: #"+r,e),t}t.setup_context=function(e){a=e},t.get_s3tc=function(){return E("WEBGL_compressed_texture_s3tc")||E("WEBKIT_WEBGL_compressed_texture_s3tc")},t.get_pvr=function(){return E("WEBKIT_WEBGL_compressed_texture_pvrtc")||E("WEBGL_compressed_texture_pvrtc")},t.get_depth_texture=function(){return n.webgl2?c("WEBGL_depth_texture"):E("WEBGL_depth_texture")||E("WEBKIT_WEBGL_depth_texture")},t.get_texture_float=function(){return n.webgl2?c("OES_texture_float"):E("OES_texture_float")},t.get_texture_half_float=function(){return n.webgl2?c("OES_texture_half_float"):E("OES_texture_half_float")},t.get_texture_float_linear=i,t.get_texture_half_float_linear=function(){return n.webgl2?i():E("OES_texture_half_float_linear")},t.get_color_buffer_float=s,t.get_color_buffer_half_float=function(){return n.webgl2?s():E("EXT_color_buffer_half_float")},t.get_aniso=function(){return E("EXT_texture_filter_anisotropic")||E("WEBKIT_EXT_texture_filter_anisotropic")},t.get_texture_lod=function(){return n.webgl2?c("EXT_shader_texture_lod"):E("EXT_shader_texture_lod")},t.get_debug_shaders=function(){return E("WEBGL_debug_shaders")},t.get_renderer_info=function(){return E("WEBGL_debug_renderer_info")},t.get_elem_index_uint=function(){return n.webgl2?c("OES_element_index_uint"):E("OES_element_index_uint")},t.get_standard_derivatives=function(){return n.webgl2?c("OES_standard_derivatives"):E("OES_standard_derivatives")},t.get_disjoint_timer_query=function(){if(n.webgl2)var e=c("EXT_disjoint_timer_query_webgl2");else e=E("EXT_disjoint_timer_query");if(null==e)return e;if(e.createQueryEXT)var t={createQuery:function(){return e.createQueryEXT()},beginQuery:function(t){e.beginQueryEXT(e.TIME_ELAPSED_EXT,t)},endQuery:function(){e.endQueryEXT(e.TIME_ELAPSED_EXT)},getQueryAvailable:function(t){return e.getQueryObjectEXT(t,e.QUERY_RESULT_AVAILABLE_EXT)},getQueryObject:function(t){return e.getQueryObjectEXT(t,e.QUERY_RESULT_EXT)},getDisjoint:function(){return a.getParameter(e.GPU_DISJOINT_EXT)}};else t={createQuery:function(){return a.createQuery()},beginQuery:function(t){a.beginQuery(e.TIME_ELAPSED_EXT,t)},endQuery:function(){a.endQuery(e.TIME_ELAPSED_EXT)},getQueryAvailable:function(e){return a.getQueryParameter(e,a.QUERY_RESULT_AVAILABLE)},getQueryObject:function(e){return a.getQueryParameter(e,a.QUERY_RESULT)},getDisjoint:function(){return a.getParameter(e.GPU_DISJOINT_EXT)}};return t},t.get_instanced_arrays=function(){if(n.webgl2)return c("ANGLE_instanced_arrays");var e=E("ANGLE_instanced_arrays");return null==e?e:{drawElementsInstanced:function(t,r,_,n,a){e.drawElementsInstancedANGLE(t,r,_,n,a)},vertexAttribDivisor:function(t,r){e.vertexAttribDivisorANGLE(t,r)},drawArraysInstanced:function(t,r,_,n){e.drawArraysInstancedANGLE(t,r,_,n)}}},t.get_vertex_array_object=function(){if(n.webgl2)return c("OES_vertex_array_object");var e=E("OES_vertex_array_object");return null==e?e:{bindVertexArray:function(t){e.bindVertexArrayOES(t)},createVertexArray:function(){return e.createVertexArrayOES()},deleteVertexArray:function(t){e.deleteVertexArrayOES(t)},isVertexArray:function(t){return e.isVertexArrayOES(t)}}},t.cleanup=function(){o={}},t.reset=function(){a=null}}),$o=A("__graph",function(e,t){var r=ha(e),_=-1,n=0,a=[_,_];function o(e,t,_){_||(_=null),i(e,t)?r.panic("Graph already has node with given ID"):e.nodes.push(t,_)}function i(e,t){for(var r=e.nodes,_=0;_<r.length;_+=2)if(r[_]==t)return!0;return!1}function s(e,t,_,n){n||(n=null),i(e,t)&&i(e,_)?e.edges.push(t,_,n):r.panic("Wrong node IDs")}function E(e,t){i(e,t)||r.panic("Node not found");for(var _=e.nodes,n=0;n<_.length;n+=2)_[n]==t&&(_.splice(n,2),n-=2)}function c(e,t,_,n){b(e,t,_)||r.panic("Edge not found");for(var a=e.edges,o=0,i=0;i<a.length;i+=3)if(a[i]==t&&a[i+1]==_){if(-1==n)a.splice(i,3);else{if(n==o){a.splice(i,3);break}o++}i-=3}}function l(e){for(var t=e.nodes,r=-1,_=0;_<t.length;_+=2)r=Math.max(r,t[_]);return++r}function T(e,t){for(var r=e.nodes,n=0;n<r.length;n+=2)if(r[n+1]==t)return r[n];return _}function u(e){var t=[],r={};d(e,r);for(var _=e.nodes,n=0;n<_.length;n+=2)0==h(e,_[n])&&f(e,_[n],r,t);return{nodes:t,edges:e.edges.slice(0)}}function d(e,t){for(var r=e.nodes,_=0;_<r.length;_+=2)t[r[_]]=!1}function f(e,t,r,_){if(!r[t]){r[t]=!0;for(var n=0;n<g(e,t);n++)f(e,R(e,t,n),r,_);_.unshift(t,N(e,t))}}function P(e){for(var t=e.edges,r=0;r<t.length;r+=3){var _=t[r+1];i(e,t[r])&&i(e,_)||(t.splice(r,3),r-=3)}}function A(e){for(var t=[],r=e.nodes,_=0;_<r.length;_+=2){var n=r[_];g(e,n)||t.push(n)}return t}function S(e){return e.nodes.length/2}function p(e){for(var t=e.nodes,r=e.edges,_=[],n=[],a=[],o=0;o<t.length;o++)a[t[2*o]]=o,_.push(o,t[2*o+1]);for(o=0;o<r.length;o+=3)n.push(a[r[o]],a[r[o+1]],r[o+2]);return{nodes:_,edges:n}}function m(e,t,r,a){r==_&&(r=0),a==_?a=0:a++;var o=e.t1both_len,i=e.t2both_len,s=e.t1out_len,E=e.t2out_len,c=e.t1in_len,l=e.t2in_len,T=e.core_len,u=e.n1,d=e.n2,f=e.core_1,P=e.core_2,A=e.in_1,S=e.in_2,p=e.out_1,m=e.out_2;if(o>T&&i>T)for(;r<u&&(f[r]!=_||0==p[r]||0==A[r]);)r++,a=0;else if(s>T&&E>T)for(;r<u&&(f[r]!=_||0==p[r]);)r++,a=0;else if(c>T&&l>T)for(;r<u&&(f[r]!=_||0==A[r]);)r++,a=0;else if(0==r&&e.order!=n){for(var O=0;O<u&&f[r=e.order[O]]!=_;)O++;O==u&&(r=u)}else for(;r<u&&f[r]!=_;)r++,a=0;if(o>T&&i>T)for(;a<d&&(P[a]!=_||0==m[a]||0==S[a]);)a++;else if(s>T&&E>T)for(;a<d&&(P[a]!=_||0==m[a]);)a++;else if(c>T&&l>T)for(;a<d&&(P[a]!=_||0==S[a]);)a++;else for(;a<d&&P[a]!=_;)a++;return r<u&&a<d&&(t[0]=r,t[1]=a,!0)}function O(e,t,r){var n=e.g1,a=e.g2,o=e.n2,i=e.core_1,s=e.core_2,E=e.in_1,c=e.in_2,l=e.out_1,T=e.out_2;if(v(t<e.n1),v(r<o),v(i[t]==_),v(s[r]==_),!function(t,r,_,a,o){return!!(0,e.node_comp)(N(n,_),N(a,o))}(0,0,t,a,r))return!1;for(var u=0,d=0,f=0,P=0,A=0,S=0,p=0;p<g(n,t);p++)if(i[O=R(n,t,p)]!=_){if(!b(a,r,m=i[O])||!Y(e.edge_comp,n,t,O,a,r,m))return!1}else E[O]&&f++,l[O]&&u++,E[O]||l[O]||A++;for(p=0;p<h(n,t);p++)if(i[O=I(n,t,p)]!=_){if(!b(a,m=i[O],r)||!Y(e.edge_comp,n,O,t,a,m,r))return!1}else E[O]&&f++,l[O]&&u++,E[O]||l[O]||A++;for(p=0;p<g(a,r);p++)if(s[m=R(a,r,p)]!=_){if(!b(n,t,O=s[m]))return!1}else c[m]&&P++,T[m]&&d++,c[m]||T[m]||S++;for(p=0;p<h(a,r);p++){var m,O;if(s[m=I(a,r,p)]!=_){if(!b(n,O=s[m],t))return!1}else c[m]&&P++,T[m]&&d++,c[m]||T[m]||S++}return f<=P&&u<=d&&A<=S}function v(e){e||r.panic("Assertion failed")}function N(e,t){for(var r=e.nodes,_=0;_<r.length;_+=2)if(r[_]==t)return r[_+1];return null}function g(e,t){for(var r=e.edges,_=0,n=0;n<r.length;n+=3)r[n]==t&&_++;return _}function h(e,t){for(var r=e.edges,_=0,n=0;n<r.length;n+=3)r[n+1]==t&&_++;return _}function R(e,t,r){for(var n=e.edges,a=0,o=0;o<n.length;o+=3)if(n[o]==t){if(a==r)return n[o+1];a++}return _}function I(e,t,r){for(var n=e.edges,a=0,o=0;o<n.length;o+=3)if(n[o+1]==t){if(a==r)return n[o];a++}return _}function b(e,t,r){for(var _=e.edges,n=0;n<_.length;n+=3)if(_[n]==t&&_[n+1]==r)return!0;return!1}function Y(e,t,r,_,n,a,o){for(var i=L(t,r,_),s=L(n,a,o),E=0;E<i;E++){for(var c=!1,l=0;l<s;l++)if(e(M(t,r,_,E),M(n,a,o,l))){c=!0;break}if(!c)return!1}return!0}function L(e,t,r){for(var _=0,n=e.edges,a=0;a<n.length;a+=3)n[a]==t&&n[a+1]==r&&_++;return _}function M(e,t,r,_){for(var n=e.edges,a=0,o=0;o<n.length;o+=3)if(n[o]==t&&n[o+1]==r){if(a==_)return n[o+2];a++}return null}function x(e,t,r){var _=e.g1,n=e.g2,a=e.n1,o=e.n2,i=e.core_1,s=e.core_2,E=e.in_1,c=e.in_2,l=e.out_1,T=e.out_2;v(t<a),v(r<o),v(e.core_len<a),v(e.core_len<o);var u=++e.core_len;e.added_node1=t,E[t]||(E[t]=u,e.t1in_len++,l[t]&&e.t1both_len++),l[t]||(l[t]=u,e.t1out_len++,E[t]&&e.t1both_len++),c[r]||(c[r]=u,e.t2in_len++,T[r]&&e.t2both_len++),T[r]||(T[r]=u,e.t2out_len++,c[r]&&e.t2both_len++),i[t]=r,s[r]=t;for(var d=0;d<h(_,t);d++)E[f=I(_,t,d)]||(E[f]=u,e.t1in_len++,l[f]&&e.t1both_len++);for(d=0;d<g(_,t);d++)l[f=R(_,t,d)]||(l[f]=u,e.t1out_len++,E[f]&&e.t1both_len++);for(d=0;d<h(n,r);d++)c[f=I(n,r,d)]||(c[f]=u,e.t2in_len++,T[f]&&e.t2both_len++);for(d=0;d<g(n,r);d++){var f;T[f=R(n,r,d)]||(T[f]=u,e.t2out_len++,c[f]&&e.t2both_len++)}}function y(e){v(e.core_len-e.orig_core_len<=1),v(e.added_node1!=_);var t=e.g1,r=e.g2,n=e.core_len,a=e.added_node1,o=e.core_1,i=e.core_2,s=e.in_1,E=e.in_2,c=e.out_1,l=e.out_2;if(e.orig_core_len<n){s[a]==n&&(s[a]=0);for(var T=0;T<h(t,a);T++)s[d=I(t,a,T)]==n&&(s[d]=0);for(c[a]==n&&(c[a]=0),T=0;T<g(t,a);T++)c[d=R(t,a,T)]==n&&(c[d]=0);var u=o[a];for(E[u]==n&&(E[u]=0),T=0;T<h(r,u);T++)E[d=I(r,u,T)]==n&&(E[d]=0);for(l[u]==n&&(l[u]=0),T=0;T<g(r,u);T++){var d;l[d=R(r,u,T)]==n&&(l[d]=0)}o[a]=_,i[u]=_,e.core_len=e.orig_core_len,e.added_node1=_}}function w(e){var t={};return t.g1=e.g1,t.g2=e.g2,t.node_comp=e.node_comp,t.edge_comp=e.edge_comp,t.n1=e.n1,t.n2=e.n2,t.order=e.order,t.core_len=t.orig_core_len=e.core_len,t.t1in_len=e.t1in_len,t.t1out_len=e.t1out_len,t.t1both_len=e.t1both_len,t.t2in_len=e.t2in_len,t.t2out_len=e.t2out_len,t.t2both_len=e.t2both_len,t.added_node1=_,t.core_1=e.core_1,t.core_2=e.core_2,t.in_1=e.in_1,t.in_2=e.in_2,t.out_1=e.out_1,t.out_2=e.out_2,t.share_count=e.share_count,e.share_count[0]+=1,t}t.NULL_NODE=_,t.FORWARD_DIR=10,t.BACKWARD_DIR=20,t.TWO_WAY=30,t.create=function(){for(var e=arguments,t=[],_=[],n=0;n<e.length;n++){var a=e[n];switch(a.length){case 2:t.push(a[0],a[1]);break;case 3:_.push(a[0],a[1],a[2]);break;default:r.panic("Wrong graph constructor params")}}return{nodes:t,edges:_}},t.clone=function(e,t,r){if(t)for(var _=new Array(e.nodes.length),n=0;n<e.nodes.length;n+=2)_[n]=e.nodes[n],_[n+1]=t(e.nodes[n+1]);else _=ln(e.nodes);if(r){var a=new Array(e.edges.length);for(n=0;n<e.edges.length;n+=3)a[n]=e.edges[n],a[n+1]=e.edges[n+1],a[n+2]=r(e.edges[n+2])}else a=ln(e.edges);return{nodes:_,edges:a}},t.create_node_edge_arr=function(e,t){for(var r=[],_=[],n=0;n<e.length;n++)r.push(e[n][0],e[n][1]);for(n=0;n<t.length;n++)_.push(t[n][0],t[n][1],t[n][2]);return{nodes:r,edges:_}},t.append_node=o,t.has_node=i,t.append_edge=s,t.remove_node=E,t.remove_edge=c,t.remove_edge_by_attr=function(e,t,_,n){b(e,t,_)||r.panic("Edge not found");for(var a=e.edges,o=0;o<a.length;o+=3)if(a[o]==t&&a[o+1]==_&&a[o+2][0]==n[0]&&a[o+2][1]==n[1]){a.splice(o,3);break}},t.append_node_attr=function(e,t){if(T(e,t)==_){var n=l(e);return o(e,n,t),n}r.panic("Non-unique attribute")},t.replace_edge_attr=function(e,t,r,_,n){for(var a=e.edges,o=0;o<a.length;o+=3)a[o]==t&&a[o+1]==r&&a[o+2]==_&&(a[o+2]=n)},t.append_subgraph=function(e,t,r,_){r=r||[],_=_||[];for(var n={},a=0;a<e.nodes.length;a+=2){var i=e.nodes[a],E=e.nodes[a+1],c=l(t);o(t,c,E),n[i]=c}for(a=0;a<e.edges.length;a+=3)s(t,n[e.edges[a]],n[e.edges[a+1]],e.edges[a+2]);for(a=0;a<r.length;a+=3)s(t,n[r[a]],r[a+1],r[a+2]);for(a=0;a<_.length;a+=3)s(t,_[a],n[_[a+1]],_[a+2])},t.gen_node_id=l,t.node_by_attr=T,t.append_edge_attr=function(e,t,n,a){var o=T(e,t),i=T(e,n);o!=_&&i!=_?s(e,o,i,a):r.panic("Attributes not found")},t.traverse=function(e,t){for(var r=e.nodes,_=0;_<r.length&&!t(r[_],r[_+1]);_+=2);},t.traverse_edges=function(e,t){for(var r=e.edges,_=0;_<r.length&&!t(r[_],r[_+1],r[_+2]);_+=3);},t.traverse_inputs=function(e,t,r){for(var _=e.edges,n=0;n<_.length;n+=3)if(_[n+1]==t){var a=_[n];if(r(a,N(e,a),_[n+2]))return}},t.traverse_outputs=function(e,t,r){for(var _=e.edges,n=0;n<_.length;n+=3)if(_[n]==t){var a=_[n+1];if(r(a,N(e,a),_[n+2]))return}},t.topsort=u,t.topsort_attr=function(e){for(var t=u(e).nodes,r=[],_=0;_<t.length;_+=2)r.push(t[_+1]);return r},t.is_connected=function(e){},t.subgraph_node_conn=function(e,t,_){i(e,t)||r.panic("No such node");var n={};d(e,n),function e(t,r,_,n){if(!_[r]){if(_[r]=!0,10==n||30==n)for(var a=0;a<g(t,r);a++)e(t,R(t,r,a),_,n);if(20==n||30==n)for(a=0;a<h(t,r);a++)e(t,I(t,r,a),_,n)}}(e,t,n,_);var a=[];for(var o in n)n[o]&&(o=Number(o),a.push(o,N(e,o)));var s={nodes:a,edges:e.edges.slice(0)};return P(s),s},t.cleanup_loose_edges=P,t.get_source_nodes=function(e){for(var t=[],r=e.nodes,_=0;_<r.length;_+=2){var n=r[_];h(e,n)||t.push(n)}return t},t.get_sink_nodes=A,t.match=function(e,t,r,o){var i={};i.g1=p(e),i.g2=p(t),i.node_comp=r||function(e,t){return e==t},i.edge_comp=o||function(e,t){return e==t};var s=S(e),E=S(t);i.n1=s,i.n2=E,i.order=n,i.core_len=i.orig_core_len=0,i.t1both_len=i.t1in_len=i.t1out_len=0,i.t2both_len=i.t2in_len=i.t2out_len=0,i.added_node1=_,i.core_1=Array(s),i.core_2=Array(E),i.in_1=new Array(s),i.in_2=new Array(E),i.out_1=new Array(s),i.out_2=new Array(E),i.share_count=[1];for(var c=0;c<s;c++)i.core_1[c]=_,i.in_1[c]=0,i.out_1[c]=0;for(c=0;c<E;c++)i.core_2[c]=_,i.in_2[c]=0,i.out_2[c]=0;var l=new Array(s),T=new Array(s);if(function e(t,r,n){if(function(e){return e.core_len==e.n1}(n))return function(e,t,r){for(var n=0,a=0;n<e.n1;n++)e.core_1[n]!=_&&(t[a]=n,r[a]=e.core_1[n],a++)}(n,t,r),!0;if(function(e){return e.n1>e.n2||e.t1both_len>e.t2both_len||e.t1out_len>e.t2out_len||e.t1in_len>e.t2in_len}(n))return!1;for(var o=_,i=_,s=!1;!s&&m(n,a,o,i);)if(O(n,o=a[0],i=a[1])){var E=w(n);x(E,o,i),s=e(t,r,E),y(E)}return s}(l,T,i)){for(c=0;c<l.length;c++)l[c]=e.nodes[2*l[c]],T[c]=t.nodes[2*T[c]];return[l,T]}return null},t.get_node_id=function(e,t){for(var r=e.nodes,_=1;_<r.length;_+=2)if(r[_]==t)return r[_-1];return null},t.get_node_attr=N,t.out_edge_count=g,t.in_edge_count=h,t.get_out_edge=R,t.get_in_edge=I,t.get_edge_count=L,t.get_edge_attr=M,t.replace=function(e,t,r){for(var _=e.edges,n=l(e),a=0;a<t.length;a++){var i=t[a];E(e,i);for(var s=0;s<_.length;s+=3)_[s]==i&&(_[s]=n),_[s+1]==i&&(_[s+1]=n),_[s]==_[s+1]&&(_.splice(s,3),s-=3)}o(e,n,r)},t.reconnect_edges=function(e,t,_,n,a){b(e,t,_)||r.panic("Edge not found");for(var o=e.edges,i=0;i<o.length;i+=3)o[i]==t&&o[i+1]==_&&(o[i]=n,o[i+1]=a)},t.enforce_acyclic=function(e,t){t||(t=A(e)[0]);var r=e.edges;if(!r.length||-1==r.indexOf(t))return e;for(var _={},n=0,a=0;a<r.length;a+=3)r[a+1]in _?_[r[a+1]].push(r[a]):_[r[a+1]]=[r[a]],n++;var o=[],i=[];for(function e(t,r){if(-1!=o.indexOf(t)){var n=o.slice(o.indexOf(t));if(-1!=_[n[n.length-1]].indexOf(n[0]))return void i.push([t,n[n.length-1]])}o.push(t);for(var a=0;a<r.length;a++)r[a]in _&&e(r[a],_[r[a]])}(t,_[t]),a=0;a<i.length;a++){n=0;for(var s=0;s<r.length;s+=3)i[a][1]==r[s+1]&&i[a][0]==r[s]&&c(e,r[s],r[s+1],n),n++}return e},t.debug_dot=function(e,t,r){var _=e.nodes,n=e.edges,a="digraph debug {\n";a+="    ",a+="node [shape=box];\n";for(var o=0;o<_.length;o+=2){var i=_[o],s=_[o+1],E=t?t(i,s):String(i);a+="    ",a+=String(i)+' [label="'+E.replace(/\"/g,'\\"')+'"];\n'}for(o=0;o<n.length;o+=3){var c=n[o],l=n[o+1];s=n[o+2],a+="    ",a+=String(c)+" -> "+String(l),r&&(a+=' [label="'+r(c,l,s)+'"]'),a+=";\n"}return a+"}"}}),ei=A("__debug_nodegraph",function(e,t){var r=$o(e);t.nodegraph_to_dot=function(e,t){if(t)var _=function(e,t){var r=t.type+"("+t.name+")",_=t.inputs;if(r+="\n\nINPUTS:",_.length)for(var n=0;n<_.length;n++)r+="\n"+_[n].identifier+": ",r+=_[n].is_linked?"linked":_[n].default_value;else r+="\n---";var a=t.outputs;if(r+="\n\nOUTPUTS:",a.length)for(n=0;n<a.length;n++)r+="\n"+a[n].identifier+": ",r+=a[n].is_linked?"linked(default "+a[n].default_value+")":"not used";else r+="\n---";return(r+="\n\nDATA:")+function(e){var t="";switch(e.type){case"GEOMETRY_UV":t="\nuv_layer: "+e.data.value;break;case"TEXTURE_COLOR":case"TEXTURE_NORMAL":t="\ntexture: "+e.data.value.name+"\n("+e.data.value.img_filepath+")"}return""==t&&(t="\n---"),t}(t)},n=function(t,_,n){var a=r.get_node_attr(e,t),o=r.get_node_attr(e,_);return a.outputs[n[0]].identifier+"\n==>\n"+o.inputs[n[1]].identifier};else _=function(e,t){return t.type},n=function(t,_,n){var a=r.get_node_attr(e,t),o=r.get_node_attr(e,_);return a.outputs[n[0]].identifier+"\n==>\n"+o.inputs[n[1]].identifier};return r.debug_dot(e,_,n)}}),ti=A("__texcomp",function(e,t){var r=ha(e),_=ga(e),n=542327876,a=131072,o=4,i=m("DXT1"),s=m("DXT3"),E=m("DXT5"),c=31,l=0,T=1,u=2,d=3,f=4,P=7,A=20,S=21;function p(e,t,r,p){var m,v,N,g,h,R,I,b,Y,L,M,x=new Int32Array(r,0,c);if(x[l]!=n)return _.error("Invalid magic number in DDS header"),0;if(!x[A]&o)return _.error("Unsupported format, must contain a FourCC code"),0;switch(m=x[S]){case i:v=8,N=t?t.COMPRESSED_RGB_S3TC_DXT1_EXT:null;break;case s:v=16,N=t?t.COMPRESSED_RGBA_S3TC_DXT3_EXT:null;break;case E:v=16,N=t?t.COMPRESSED_RGBA_S3TC_DXT5_EXT:null;break;default:return _.error("Unsupported FourCC code:",O(m)),null}if(L=1,x[u]&a&&!1!==p&&(L=Math.max(1,x[P])),g=x[f],h=x[d],I=x[T]+4,t)for(M=0;M<L;++M)R=Math.max(4,g)/4*Math.max(4,h)/4*v,Y=new Uint8Array(r,I,R),e.compressedTexImage2D(e.TEXTURE_2D,M,N,g,h,0,Y),I+=R,g=Math.max(.5*g,1),h=Math.max(.5*h,1);else{if(m!=i)return _.error("No manual decoder for",O(m),"and no native support"),0;R=Math.max(4,g)/4*Math.max(4,h)/4*v,b=function(e,t,r,_){for(var n=new Uint16Array(4),a=new Uint16Array(r*_),o=0,i=0,s=0,E=0,c=0,l=0,T=0,u=0,d=0,f=r/4,P=_/4,A=0;A<P;A++)for(var S=0;S<f;S++)n[0]=e[s=t+4*(A*f+S)],n[1]=e[s+1],n[2]=5*(E=31&n[0])+3*(T=31&n[1])>>3|5*(c=2016&n[0])+3*(u=2016&n[1])>>3&2016|5*(l=63488&n[0])+3*(d=63488&n[1])>>3&63488,n[3]=5*T+3*E>>3|5*u+3*c>>3&2016|5*d+3*l>>3&63488,a[i=4*A*r+4*S]=n[3&(o=e[s+2])],a[i+1]=n[o>>2&3],a[i+2]=n[o>>4&3],a[i+3]=n[o>>6&3],a[i+=r]=n[o>>8&3],a[i+1]=n[o>>10&3],a[i+2]=n[o>>12&3],a[i+3]=n[o>>14],a[i+=r]=n[3&(o=e[s+3])],a[i+1]=n[o>>2&3],a[i+2]=n[o>>4&3],a[i+3]=n[o>>6&3],a[i+=r]=n[o>>8&3],a[i+1]=n[o>>10&3],a[i+2]=n[o>>12&3],a[i+3]=n[o>>14];return a}(Y=new Uint16Array(r),I/2,g,h),e.texImage2D(e.TEXTURE_2D,0,e.RGB,g,h,0,e.RGB,e.UNSIGNED_SHORT_5_6_5,b),p&&e.generateMipmap(e.TEXTURE_2D)}return L}function m(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function O(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}t.upload_dds_levels=p,t.upload_pvr_levels=function(e,t,_){var n=new Uint32Array(_,0,13);if(55727696==n[0]){var a=n[7],o=n[6],i=n[11],s=52+n[12];switch(n[2]){case 0:var E=2,c=1;break;case 1:E=2,c=3;break;case 2:E=4,c=0;break;case 3:E=4,c=2;break;default:r.panic("Unsupported PVR V3 format.")}}else if(559044176==n[11]){a=n[2],o=n[1],i=n[3],s=n[0],i++;var l=255&n[4],T=n[10]>0;25==l?(E=4,c=T?2:0):24==l?(E=2,c=T?3:1):r.panic("Unsupported PVR V2 format.")}else r.panic("Unsupported PVR version.");if(2==E)var u=8,d=4;else u=4,d=4;switch(c){case 0:var f=t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;break;case 1:f=t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;break;case 2:f=t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;break;case 3:f=t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}for(var P=u*d*E/8,A=0;A<i;A++){var S=Math.max(a>>A,1),p=Math.max(o>>A,1),m=S/u,O=p/d;m<2&&(m=2),O<2&&(O=2);var v=m*O*P,N=new Uint8Array(_,s,v);e.compressedTexImage2D(e.TEXTURE_2D,A,f,S,p,0,N),s+=v}},t.get_width_height=function(e,t){switch(t){case"dds":return{width:(r=new Int32Array(e,0,c))[f],height:r[d]};case"pvr":var r;if(55727696==(r=new Uint32Array(e,0,13))[0])var _=r[7],n=r[6];else _=r[2],n=r[1];return{width:_,height:n}}},t.get_compress_ratio=function(e,t){var r=1;if("dds"==t){var n=(a=new Int32Array(e,0,c))[S];switch(n){case i:r=6;break;case s:case E:r=4;break;default:_.error("Unsupported FourCC code:",O(n))}}else if("pvr"==t){var a;if(55727696==(a=new Uint32Array(e,0,13))[0])switch(a[2]){case 0:r=12;break;case 1:r=16;break;case 2:r=6;break;case 3:r=8}else{var o=255&a[4],l=a[10]>0;25==o?r=l?8:6:24==o&&(r=l?16:12)}}return r},t.load_dds_texture=function(e,t,r,_){var n=e.createTexture();return function(e,t,r,_,n,a){var o=new XMLHttpRequest;o.open("GET",r,!0),o.responseType="arraybuffer",o.onload=function(){if(200==o.status){e.bindTexture(e.TEXTURE_2D,_);var r=p(e,t,o.response,!0);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,r>1?e.LINEAR_MIPMAP_LINEAR:e.LINEAR)}a&&a(_)},o.send(null)}(e,t,r,n,0,_),n}}),ri=A("__time",function(e,t){var r=Wo(e),_=0,n=0,a=[],o=0,i=0,s=[],E=-1,c=0;function l(){return-1!==r.animation.framerate?r.animation.framerate:E}t.set_timeline=function(e){_=e,n=performance.now();for(var t=0;t<a.length;t++){var r=a[t];_>r.expire_time&&(a.splice(t,1),t--,r.callback())}for(t=0;t<s.length;t++){var o=s[t],i=1-(o.expire_time-_)/o.duration;i=Math.min(i,1),o.callback(o.from+i*(o.to-o.from)),1==i&&(s.splice(t,1),t--)}},t.get_timeline=function(){return _},t.set_delta=function(e){c=e},t.get_delta=function(){return c},t.set_timeout=function(e,t){var r=++o,i={id:r,callback:e,expire_time:_+(performance.now()-n+t)/1e3};return a.push(i),r},t.clear_timeout=function(e){for(var t=0;t<a.length;t++)if(a[t].id==e){a.splice(t,1);break}},t.clear_animation=function(e){for(var t=s.length;t--;)if(s[t].id==e){s.splice(t,1);break}},t.animate=function(e,t,r,n){var a=r/1e3,o=++i;return s.push({id:o,callback:n,from:e,to:t,expire_time:_+a,duration:a}),n(e),o},t.reset=function(e){_=0,n=0,a.length=0,s.length=0,o=0,i=0},t.get_framerate=l,t.set_framerate=function(e){E=e},t.get_frame=function(e){return e*l()}}),_i=A("__debug",function(e,t){var r=ga(e),_={};t.fill_vbo_garbage_info=function(e,t,r,n,a){_[e]||(_[e]={shaders:t,attrs:{}}),r in _[e].attrs||(_[e].attrs[r]=n),a&&(_[e].attrs[r]=0)},t.calc_vbo_garbage_byte_size=function(){var e=0;for(var t in _)for(var r in _[t].attrs)e+=_[t].attrs[r];return e},t.show_vbo_garbage_info=function(){var e={};for(var t in _)for(var n in _[t].attrs){var a=_[t].attrs[n];a&&((o=_[t].shaders)in e||(e[o]={total_size:0,attrs:{}}),n in e[o].attrs||(e[o].attrs[n]=0),e[o].attrs[n]+=a,e[o].total_size+=a)}for(var o in e){for(var n in r.groupCollapsed(o,e[o].total_size),e[o].attrs)r.log_raw(n,e[o].attrs[n]);r.groupEnd()}},t.cleanup=function(){_={}}}),ni=A("__debug_subscene",function(e,t){t.DV_NONE=0,t.DV_OPAQUE_WIREFRAME=1,t.DV_TRANSPARENT_WIREFRAME=2,t.DV_FRONT_BACK_VIEW=3,t.DV_BOUNDINGS=4,t.DV_CLUSTERS_VIEW=5,t.DV_BATCHES_VIEW=6,t.DV_RENDER_TIME=7;var r=null;t.set_debug_view_subs=function(e){r=e},t.get_debug_view_subs=function(){return r},t.cleanup=function(){r=null}}),ai=A("__subscene",function(e,t){var r=ha(e),_=oE(e),n=Wo(e).outlining;function a(e,t){e.num_lights=t,e.light_directions=new Float32Array(3*t),e.light_positions=new Float32Array(4*t),e.light_color_intensities=new Float32Array(4*t)}function o(e){var t={type:e,subtype:"",force_do_not_render:!1,do_render:!1,enqueue:!1,clear_color:!1,clear_depth:!1,depth_test:!1,blend:!1,pack:!1,assign_texture:!1,need_fog_update:!1,need_perm_uniforms_update:!1,debug_render_calls:0,debug_render_time:0,debug_render_time_queries:[],debug_view_mode:0,debug_colors_seed:0,debug_render_time_threshold:1,do_not_debug:!1,time:0,camera:null,cube_view_matrices:null,cube_cam_frustums:[],draw_data:[],slinks_internal:[],textures_internal:[],wind:new Float32Array(3),grass_map_dim:new Float32Array(3),fog_color_density:new Float32Array(4),fog_params:new Float32Array(4),cube_fog:new Float32Array(16),sky_tex_default_value:0,environment_energy:0,num_lights:0,light_directions:null,light_positions:null,light_color_intensities:null,light_factors:null,horizon_color:new Float32Array(3),zenith_color:new Float32Array(3),sky_tex_fac:new Float32Array(4),sun_intensity:new Float32Array(3),sun_direction:new Float32Array([0,0,1]),sun_quaternion:new Float32Array(4),sky_tex_color:new Float32Array(3),sky_ngraph_proxy_id:"",bsdf_cube_sky_dim:0,outline_factor:0,draw_outline_flag:0,is_for_outline:!1,outline_color:new Float32Array(3),water:!1,cam_water_depth:0,water_fog_color_density:new Float32Array(4),water_level:0,caustics:!1,caust_scale:0,caust_speed:new Float32Array(2),caust_brightness:0,procedural_skydome:!1,use_as_environment_lighting:!1,mie_brightness:0,rayleigh_brightness:0,spot_brightness:0,mie_strength:0,rayleigh_strength:0,scatter_strength:0,mie_collection_power:0,rayleigh_collection_power:0,mie_distribution:0,sky_color:new Float32Array(3),ssao_hemisphere:!1,ssao_blur_depth:!1,ssao_blur_discard_value:0,ssao_radius_increase:0,ssao_influence:0,ssao_dist_factor:0,ssao_samples:0,ssao_only:!1,ssao_white:!1,brightness:0,contrast:0,exposure:0,saturation:0,god_rays_intensity:0,max_ray_length:0,radial_blur_step:0,steps_per_pass:0,csm_index:0,self_shadow_polygon_offset:0,self_shadow_normal_offset:0,v_light_ts:null,v_light_r:null,v_light_tsr:null,p_light_matrix:null,is_pp:!1,fxaa_quality:"",bloom_key:0,bloom_blur:0,bloom_edge_lum:0,adaptive_bloom:!0,average_luminance:0,blur_texel_size_mult:0,ext_texel_size_mult:0,mb_decay_threshold:0,mb_factor:0,motion_blur_exp:0,pp_effect:"",dof_bokeh:!1,coc_type:"",jitter_projection_space:new Float32Array(2),last_mip_map_ind:0,bloom_blur_num:2,bloom_blur_scale:.5,small_glow_mask_width:0,large_glow_mask_width:0,small_glow_mask_coeff:0,large_glow_mask_coeff:0,texel_size_multiplier:0,texel_size:new Float32Array(2),texel_mask:new Float32Array(2),distortion_params:new Float32Array(4),chromatic_aberration_coefs:new Float32Array(4),enable_hmd_stereo:!1,shadow_lamp_index:0,need_draw_data_sort:!0,sky_invert:!1,sky_use_rgb_to_intensity:!1,sky_use_map_blend:!1,sky_use_map_horizon:!1,sky_use_map_zenith_up:!1,sky_use_map_zenith_down:!1,sky_blend_type:"",use_sky_blend:!1,use_sky_paper:!1,use_sky_real:!1};return t.do_render=!0,t.enqueue=!0,t.clear_color=!0,t.clear_depth=!0,t.depth_test=!0,t.need_perm_uniforms_update=!0,t.texel_size_multiplier=1,t.texel_mask[0]=1,t.texel_mask[1]=1,t.distortion_params[2]=.5,t.distortion_params[3]=.5,t.ssao_samples=8,t}function i(e,t){return e==t?0:e>t?1:-1}function s(e,t){return i(e.alpha_antialiasing,t.alpha_antialiasing)||i(e.is_sky,t.is_sky)||i(e.offset_z,t.offset_z)||i(e.shader.has_discard,t.shader.has_discard)||i(e.z_index,t.z_index)}t.MAIN_OPAQUE=0,t.MAIN_BLEND=1,t.MAIN_XRAY=2,t.MAIN_PLANE_REFLECT=3,t.MAIN_CUBE_REFLECT=4,t.MAIN_PLANE_REFLECT_BLEND=5,t.MAIN_CUBE_REFLECT_BLEND=6,t.MAIN_GLOW=7,t.SHADOW_CAST=8,t.SHADOW_RECEIVE=9,t.GRASS_MAP=10,t.POSTPROCESSING=11,t.GLOW_COMBINE=13,t.RESOLVE=14,t.COLOR_PICKING=15,t.COLOR_PICKING_XRAY=16,t.DEBUG_VIEW=17,t.ANCHOR_VISIBILITY=18,t.DEPTH_PACK=19,t.SSAO=20,t.SSAO_BLUR=21,t.ANTIALIASING=22,t.SMAA_BLENDING_WEIGHT_CALCULATION=23,t.SMAA_EDGE_DETECTION=24,t.SMAA_RESOLVE=25,t.SMAA_NEIGHBORHOOD_BLENDING=26,t.COMPOSITING=27,t.MOTION_BLUR=28,t.COC=29,t.DOF=30,t.OUTLINE_MASK=31,t.OUTLINE=32,t.GOD_RAYS=33,t.GOD_RAYS_COMBINE=34,t.SKY=35,t.COPY=36,t.STEREO=37,t.LUMINANCE=38,t.AVERAGE_LUMINANCE=39,t.LUMINANCE_TRUNCED=40,t.BLOOM=41,t.VELOCITY=42,t.SINK=43,t.PERFORMANCE=44,t.RESIZE=45,t.IRRADIANCE=46,t.ROUGHNESS_CONVOLUTION=47,t.BRDF=48,t.create_subs_shadow_cast=function(e,t,r,n){var i=o(8);switch(i.csm_index=e,i.self_shadow_polygon_offset=r.self_shadow_polygon_offset,i.shadow_lamp_index=t,r.lamp_types[t]){case"SPOT":case"POINT":i.camera=_.create_camera(_.TYPE_PERSP),_.set_frustum(i.camera,r.spot_sizes[t],r.clip_start[t],r.clip_end[t]);break;default:i.camera=_.create_camera(_.TYPE_ORTHO_ASYMMETRIC)}return a(i,n),i},t.clone_subs=function(e){var t=o(e.type);return t.subtype=e.subtype,t.force_do_not_render=e.force_do_not_render,t.do_render=e.do_render,t.enqueue=e.enqueue,t.clear_color=e.clear_color,t.clear_depth=e.clear_depth,t.depth_test=e.depth_test,t.blend=e.blend,t.pack=e.pack,t.assign_texture=e.assign_texture,t.need_fog_update=e.need_fog_update,t.need_perm_uniforms_update=e.need_perm_uniforms_update,t.debug_render_calls=0,t.debug_render_time=0,t.debug_render_time_queries=[],t.debug_view_mode=e.debug_view_mode,t.debug_colors_seed=e.debug_colors_seed,t.debug_render_time_threshold=e.debug_render_time_threshold,t.do_not_debug=e.do_not_debug,t.time=e.time,t.camera=_.clone_camera(e.camera,!0),t.cube_view_matrices=ln(e.cube_view_matrices),t.cube_cam_frustums=ln(e.cube_cam_frustums),t.draw_data=ln(e.draw_data),t.slinks_internal=ln(e.slinks_internal),t.textures_internal=ln(e.textures_internal),t.wind.set(e.wind),t.grass_map_dim.set(e.grass_map_dim),t.fog_color_density.set(e.fog_color_density),t.fog_params.set(e.fog_params),t.cube_fog.set(e.cube_fog),t.sky_tex_default_value=e.sky_tex_default_value,t.environment_energy=e.environment_energy,t.num_lights=e.num_lights,t.light_directions=ln(e.light_directions),t.light_positions=ln(e.light_positions),t.light_color_intensities=ln(e.light_color_intensities),t.light_factors=ln(e.light_factors),t.horizon_color.set(e.horizon_color),t.zenith_color.set(e.zenith_color),t.sky_tex_fac.set(e.sky_tex_fac),t.sun_intensity.set(e.sun_intensity),t.sun_direction.set(e.sun_direction),t.sun_quaternion.set(e.sun_quaternion),t.sky_tex_color.set(e.sky_tex_color),t.sky_ngraph_proxy_id=e.sky_ngraph_proxy_id,t.bsdf_cube_sky_dim=e.bsdf_cube_sky_dim,t.outline_factor=e.outline_factor,t.draw_outline_flag=e.draw_outline_flag,t.is_for_outline=e.is_for_outline,t.outline_color.set(e.outline_color),t.water=e.water,t.cam_water_depth=e.cam_water_depth,t.water_fog_color_density.set(e.water_fog_color_density),t.water_level=e.water_level,t.caustics=e.caustics,t.caust_scale=e.caust_scale,t.caust_speed.set(e.caust_speed),t.caust_brightness=e.caust_brightness,t.procedural_skydome=e.procedural_skydome,t.use_as_environment_lighting=e.use_as_environment_lighting,t.mie_brightness=e.mie_brightness,t.rayleigh_brightness=e.rayleigh_brightness,t.spot_brightness=e.spot_brightness,t.mie_strength=e.mie_strength,t.rayleigh_strength=e.rayleigh_strength,t.scatter_strength=e.scatter_strength,t.mie_collection_power=e.mie_collection_power,t.rayleigh_collection_power=e.rayleigh_collection_power,t.mie_distribution=e.mie_distribution,t.sky_color.set(e.sky_color),t.ssao_hemisphere=e.ssao_hemisphere,t.ssao_blur_depth=e.ssao_blur_depth,t.ssao_blur_discard_value=e.ssao_blur_discard_value,t.ssao_radius_increase=e.ssao_radius_increase,t.ssao_influence=e.ssao_influence,t.ssao_dist_factor=e.ssao_dist_factor,t.ssao_samples=e.ssao_samples,t.ssao_only=e.ssao_only,t.ssao_white=e.ssao_white,t.brightness=e.brightness,t.contrast=e.contrast,t.exposure=e.exposure,t.saturation=e.saturation,t.god_rays_intensity=e.god_rays_intensity,t.max_ray_length=e.max_ray_length,t.radial_blur_step=e.radial_blur_step,t.steps_per_pass=e.steps_per_pass,t.csm_index=e.csm_index,t.self_shadow_polygon_offset=e.self_shadow_polygon_offset,t.self_shadow_normal_offset=e.self_shadow_normal_offset,t.v_light_ts=ln(e.v_light_ts),t.v_light_r=ln(e.v_light_r),t.v_light_tsr=ln(e.v_light_tsr),t.p_light_matrix=ln(e.p_light_matrix),t.is_pp=e.is_pp,t.fxaa_quality=e.fxaa_quality,t.bloom_key=e.bloom_key,t.bloom_blur=e.bloom_blur,t.bloom_edge_lum=e.bloom_edge_lum,t.adaptive_bloom=e.adaptive_bloom,t.average_luminance=e.average_luminance,t.blur_texel_size_mult=e.blur_texel_size_mult,t.ext_texel_size_mult=e.ext_texel_size_mult,t.mb_decay_threshold=e.mb_decay_threshold,t.mb_factor=e.mb_factor,t.motion_blur_exp=e.motion_blur_exp,t.pp_effect=e.pp_effect,t.coc_type=e.coc_type,t.dof_bokeh=e.dof_bokeh,t.jitter_projection_space.set(e.jitter_projection_space),t.last_mip_map_ind=e.last_mip_map_ind,t.bloom_blur_num=e.bloom_blur_num,t.bloom_blur_scale=e.bloom_blur_scale,t.small_glow_mask_width=e.small_glow_mask_width,t.large_glow_mask_width=e.large_glow_mask_width,t.small_glow_mask_coeff=e.small_glow_mask_coeff,t.large_glow_mask_coeff=e.large_glow_mask_coeff,t.texel_size_multiplier=e.texel_size_multiplier,t.texel_size.set(e.texel_size),t.texel_mask.set(e.texel_mask),t.distortion_params.set(e.distortion_params),t.chromatic_aberration_coefs.set(e.chromatic_aberration_coefs),t.enable_hmd_stereo=e.enable_hmd_stereo,t.shadow_lamp_index=e.shadow_lamp_index,t.need_draw_data_sort=e.need_draw_data_sort,t.sky_invert=e.sky_invert,t.sky_use_rgb_to_intensity=e.sky_use_rgb_to_intensity,t.sky_use_map_blend=e.sky_use_map_blend,t.sky_use_map_horizon=e.sky_use_map_horizon,t.sky_use_map_zenith_up=e.sky_use_map_zenith_up,t.sky_use_map_zenith_down=e.sky_use_map_zenith_down,t.sky_blend_type=e.sky_blend_type,t.use_sky_blend=e.use_sky_blend,t.use_sky_paper=e.use_sky_paper,t.use_sky_real=e.use_sky_real,t},t.create_subs_grass_map=function(){var e=o(10);return e.camera=_.create_camera(_.TYPE_ORTHO_ASPECT),e},t.create_subs_postprocessing=function(e){var t=o(11);switch(t.clear_color=!1,t.clear_depth=!1,t.depth_test=!1,t.is_pp=!0,t.camera=_.create_camera(_.TYPE_NONE),t.pp_effect=e,e){case"NONE":case"GRAYSCALE":t.texel_mask[0]=1,t.texel_mask[1]=1;break;case"X_BLUR":t.texel_mask[0]=1,t.texel_mask[1]=0;break;case"Y_BLUR":t.texel_mask[0]=0,t.texel_mask[1]=1;break;case"X_GLOW_BLUR":t.texel_mask[0]=1,t.texel_mask[1]=0;break;case"Y_GLOW_BLUR":t.texel_mask[0]=0,t.texel_mask[1]=1;break;case"X_BLOOM_BLUR":t.texel_mask[0]=1,t.texel_mask[1]=0;break;case"Y_BLOOM_BLUR":t.texel_mask[0]=0,t.texel_mask[1]=1;break;case"X_DOF_BLUR":case"Y_DOF_BLUR":t.texel_mask[0]=1,t.texel_mask[1]=1;break;case"X_ALPHA_BLUR":t.texel_mask[0]=1,t.texel_mask[1]=0,t.texel_size_multiplier=3;break;case"Y_ALPHA_BLUR":t.texel_mask[0]=0,t.texel_mask[1]=1,t.texel_size_multiplier=3;break;case"X_EXTEND":t.texel_mask[0]=1,t.texel_mask[1]=0;break;case"Y_EXTEND":t.texel_mask[0]=0,t.texel_mask[1]=1;break;default:r.panic("Wrong postprocessing effect: "+e)}return t},t.create_subs_glow_combine=function(e,t){var r=o(13);return r.clear_color=!1,r.clear_depth=!1,r.depth_test=!1,r.small_glow_mask_coeff=t.glow_params.small_glow_mask_coeff,r.large_glow_mask_coeff=t.glow_params.large_glow_mask_coeff,r.small_glow_mask_width=t.glow_params.small_glow_mask_width,r.large_glow_mask_width=t.glow_params.large_glow_mask_width,r.camera=e,r.is_pp=!0,r},t.create_subs_main=function(e,t,_,n,i,s,E,c,l){var T=o(e);0==e?(T.clear_color=!0,T.clear_depth=_,T.blend=!1):1==e?(T.clear_color=!1,T.clear_depth=!1,T.blend=!0):2==e?(T.clear_color=!1,T.clear_depth=!0,T.blend=!0):3==e||4==e?(T.clear_color=!0,T.clear_depth=!0,T.blend=!1):5==e||6==e?(T.clear_color=!1,T.clear_depth=!1,T.blend=!0):7==e?(T.clear_color=!0,T.clear_depth=!1,T.blend=!0):r.panic("wrong main subscene type"),T.blend&&c&&(T.self_shadow_normal_offset=c.self_shadow_normal_offset),T.camera=t;var u=E.sky_texture_param;return u&&(T.sky_tex_fac.set([u.blend_factor,u.horizon_factor,u.zenith_up_factor,u.zenith_down_factor]),T.sky_tex_color.set(u.color),T.sky_tex_default_value=u.default_value),T.horizon_color.set(E.horizon_color),T.zenith_color.set(E.zenith_color),T.environment_energy=E.environment_energy,T.fog_color_density=s.fog_color_density,T.fog_params=s.fog_params,n&&function(e,t,r){var _=t;_.fog_color_density&&e.water_fog_color_density.set(_.fog_color_density),e.water_level=_.water_level,_.caustics&&r&&(e.caustics=!0,e.caust_scale=_.caustic_scale,e.caust_brightness=_.caustic_brightness,e.caust_speed.set(_.caustic_speed))}(T,n,l),a(T,i),T},t.create_subs_resolve=function(){var e=o(14);return e.is_pp=!0,e.camera=_.create_camera(_.TYPE_NONE),e},t.create_subs_color_picking=function(e,t,r){var _=o(15);return t&&(_.type=16,_.clear_color=!1,_.clear_depth=!0),_.enqueue=!1,_.camera=e,a(_,r),_},t.create_subs_debug_view=function(e){var t=o(17);return t.do_render=!1,t.clear_color=!1,t.clear_depth=!1,t.camera=e,t},t.create_subs_anchor_visibility=function(e){var t=o(18);return t.clear_color=!0,t.clear_depth=!1,t.camera=e,t},t.create_subs_shadow_receive=function(e,t,r){var _=o(9);return _.camera=t,a(_,r),_},t.create_subs_depth_pack=function(e){var t=o(19);return t.clear_color=!1,t.clear_depth=!1,t.camera=e,t.is_pp=!0,t},t.create_subs_ssao=function(e,t,r){var _=o(20);return _.clear_color=!1,_.clear_depth=!1,_.depth_test=!1,_.camera=e,_.fog_color_density=t.fog_color_density,_.water_fog_color_density.set(t.fog_color_density),_.ssao_radius_increase=r.radius_increase,_.ssao_hemisphere=r.hemisphere,_.ssao_influence=r.influence,_.ssao_dist_factor=r.dist_factor,_.ssao_samples=r.samples,_.is_pp=!0,_},t.create_subs_ssao_blur=function(e,t){var r=o(21);return r.clear_color=!1,r.clear_depth=!1,r.depth_test=!1,r.camera=e,r.ssao_blur_depth=t.blur_depth,r.ssao_blur_discard_value=t.blur_discard_value,r.is_pp=!0,r},t.create_subs_aa=function(e){var t=o(22);return t.clear_color=!1,t.clear_depth=!1,t.depth_test=!1,t.texel_size_multiplier=1/e.resolution_factor,t.fxaa_quality=e.aa_quality,t.camera=_.create_camera(_.TYPE_NONE),t.is_pp=!0,t},t.create_subs_smaa=function(e,t){var r=o(e);return r.clear_color=23==e||24==e,r.clear_depth=!1,r.depth_test=!1,r.texel_size_multiplier=1/t.resolution_factor,r.camera=_.create_camera(_.TYPE_NONE),23==e&&(r.jitter_subsample_ind=new Float32Array(4)),r.is_pp=!0,r},t.create_subs_compositing=function(e,t,r,n){var a=o(27);return a.clear_color=!1,a.clear_depth=!1,a.depth_test=!1,a.camera=_.create_camera(_.TYPE_NONE),a.brightness=e,a.contrast=t,a.exposure=r,a.saturation=n,a.is_pp=!0,a},t.create_subs_motion_blur=function(e,t){var r=o(28);return r.clear_color=!1,r.clear_depth=!1,r.depth_test=!1,r.camera=_.create_camera(_.TYPE_NONE),r.assign_texture=!0,r.mb_decay_threshold=e,r.mb_factor=t,r.is_pp=!0,r},t.create_subs_coc=function(e,t){var r=o(29);return r.clear_color=!1,r.clear_depth=!1,r.depth_test=!1,r.camera=e,r.texel_size_multiplier=r.camera.dof_power,r.coc_type=t,r.is_pp=!0,r},t.create_subs_dof=function(e,t){var r=o(30);return r.clear_color=!1,r.clear_depth=!1,r.depth_test=!1,r.camera=e,r.texel_size_multiplier=e.dof_power,r.dof_bokeh=t,r.is_pp=!0,r},t.create_subs_outline_mask=function(e,t){var r=o(31);return r.depth_test=!1,r.camera=e,a(r,t),r},t.create_subs_outline=function(e){var t=o(32);return t.outline_color.set(n.outlining_overview_mode?n.outline_color:e.outline_color),t.outline_factor=e.outline_factor,t.ext_texel_size_mult=5,t.blur_texel_size_mult=3,t.depth_test=!1,t.camera=_.create_camera(_.TYPE_NONE),t.is_pp=!0,t},t.create_subs_god_rays=function(e,t,r,_,n,i,s){var E=o(33);return E.clear_color=!1,E.clear_depth=!1,E.depth_test=!1,E.horizon_color=new Float32Array([1,1,1]),E.zenith_color=new Float32Array([1,1,1]),E.environment_energy=1,E.pack=_,E.water=t,E.radial_blur_step=n,E.max_ray_length=r,E.steps_per_pass=s,E.camera=e,a(E,i),E},t.create_subs_god_rays_comb=function(e,t){var r=o(34);return r.clear_color=!1,r.clear_depth=!1,r.depth_test=!1,r.camera=_.create_camera(_.TYPE_NONE),r.god_rays_intensity=e,a(r,t),r.is_pp=!0,r},t.create_subs_sky=function(e,t,r,n){var i=o(35);i.enqueue=!1,i.clear_color=!1,i.clear_depth=!1,i.depth_test=!1;var s=_.create_camera(_.TYPE_NONE);if(s.width=n,s.height=n,i.camera=s,i.cube_view_matrices=On(),a(i,t),i.horizon_color=new Float32Array([1,1,1]),i.zenith_color=new Float32Array([1,1,1]),i.environment_energy=1,i.sky_color.set(r.sky_color),i.procedural_skydome=r.procedural_skydome,i.use_as_environment_lighting=r.use_as_environment_lighting,i.rayleigh_brightness=r.rayleigh_brightness,i.mie_brightness=r.mie_brightness,i.spot_brightness=r.spot_brightness,i.scatter_strength=r.scatter_strength,i.rayleigh_strength=r.rayleigh_strength,i.mie_strength=r.mie_strength,i.rayleigh_collection_power=r.rayleigh_collection_power,i.mie_collection_power=r.mie_collection_power,i.mie_distribution=r.mie_distribution,e){i.horizon_color.set(e.horizon_color),i.zenith_color.set(e.zenith_color),i.environment_energy=e.environment_energy;var E=e.sky_texture_param;E&&(i.sky_tex_fac.set([E.blend_factor,E.horizon_factor,E.zenith_up_factor,E.zenith_down_factor]),i.sky_tex_color.set(E.color),i.sky_tex_default_value=E.default_value,i.sky_invert=E.invert,i.sky_use_rgb_to_intensity=E.use_rgb_to_intensity,i.sky_use_map_blend=E.use_map_blend,i.sky_use_map_horizon=E.use_map_horizon,i.sky_use_map_zenith_up=E.use_map_zenith_up,i.sky_use_map_zenith_down=E.use_map_zenith_down,i.sky_blend_type=E.blend_type),i.use_sky_blend=e.use_sky_blend,i.use_sky_paper=e.use_sky_paper,i.use_sky_real=e.use_sky_real,i.sky_ngraph_proxy_id=e.ngraph_proxy_id}return i},t.create_subs_irradiance=function(e,t){var r=o(46);r.enqueue=!1,r.clear_color=!1,r.clear_depth=!1,r.depth_test=!1;var n=_.create_camera(_.TYPE_NONE);return n.width=t,n.height=t,r.camera=n,r.cube_view_matrices=On(),a(r,e),r},t.create_subs_rougness_convolution=function(e){var t=o(47);t.enqueue=!1,t.clear_color=!1,t.clear_depth=!1,t.depth_test=!1;var r=_.create_camera(_.TYPE_NONE);return r.width=128,r.height=128,t.camera=r,t.cube_view_matrices=On(),a(t,e),t},t.create_subs_brdf=function(){var e=o(48);e.enqueue=!1,e.clear_color=!1,e.clear_depth=!1,e.depth_test=!1;var t=_.create_camera(_.TYPE_NONE);return t.width=512,t.height=512,e.camera=t,e},t.create_subs_copy=function(){var e=o(36);return e.clear_color=!1,e.clear_depth=!1,e.camera=_.create_camera(_.TYPE_NONE),e.is_pp=!0,e},t.create_subs_stereo=function(e,t){var r=o(37);return r.clear_color=!1,r.clear_depth=!1,r.subtype=e?"HMD":t?"ANAGLYPH":"SIDEBYSIDE",r.camera=_.create_camera(_.TYPE_NONE),r.is_pp=!0,r},t.create_subs_luminance=function(){var e=o(38);return e.clear_color=!1,e.clear_depth=!1,e.camera=_.create_camera(_.TYPE_NONE),e.is_pp=!0,e},t.create_subs_av_luminance=function(){var e=o(39);return e.clear_color=!1,e.clear_depth=!1,e.camera=_.create_camera(_.TYPE_NONE),e.is_pp=!0,e},t.create_resize_subs=function(){var e=o(45);return e.clear_color=!1,e.clear_depth=!1,e.camera=_.create_camera(_.TYPE_NONE),e.is_pp=!0,e},t.create_subs_luminance_truncated=function(e,t,r,_){var n=o(40);return n.clear_color=!1,n.clear_depth=!1,n.bloom_key=e,n.bloom_edge_lum=t,n.camera=_,a(n,r),n.is_pp=!0,n},t.create_subs_bloom_combine=function(e,t){var r=o(41);return r.clear_color=!1,r.clear_depth=!1,r.camera=_.create_camera(_.TYPE_NONE),r.bloom_blur=e,r.bloom_blur_num=t,r.is_pp=!0,r},t.create_subs_veloctity=function(e){var t=o(42);return t.clear_color=!1,t.clear_depth=!1,t.camera=e,t.is_pp=!0,t},t.create_subs_sink=function(){var e=o(43);return e.enqueue=!1,e},t.create_subs_perf=function(){var e=o(44);return e.is_pp=!0,e},t.subs_label=function(e){switch(e.type){case 0:return"MAIN OPAQUE";case 1:return"MAIN BLEND";case 2:return"MAIN XRAY";case 3:return"MAIN PLANE REFLECT";case 4:return"MAIN CUBE REFLECT";case 5:return"MAIN PLANE REFLECT BLEND";case 6:return"MAIN CUBE REFLECT BLEND";case 7:return"MAIN GLOW";case 8:return"SHADOW CAST";case 9:return"SHADOW RECEIVE";case 10:return"GRASS MAP";case 11:return"POSTPROCESSING ("+e.pp_effect.replace(/_/g," ")+")";case 13:return"GLOW COMBINE";case 14:return"RESOLVE";case 15:return"COLOR PICKING";case 16:return"COLOR PICKING XRAY";case 17:return"DEBUG VIEW";case 18:return"ANCHOR VISIBILITY";case 19:return"DEPTH PACK";case 20:return"SSAO";case 21:return"SSAO BLUR";case 22:return"ANTIALIASING";case 23:return"SMAA BLENDING WEIGHT CALCULATION";case 24:return"SMAA EDGE DETECTION";case 25:return"SMAA RESOLVE";case 26:return"SMAA NEIGHBORHOOD BLENDING";case 27:return"COMPOSITING";case 28:return"MOTION BLUR";case 29:return"COC";case 30:return"DOF";case 31:return"OUTLINE MASK";case 32:return"OUTLINE";case 33:return"GOD RAYS";case 34:return"GOD RAYS COMBINE";case 35:return"SKY";case 46:return"IRRADIANCE";case 47:return"ROUGHNESS_CONVOLUTION";case 48:return"PRE-COMPUTE_BRDF";case 36:return"COPY";case 37:return"STEREO";case 38:return"LUMINANCE";case 39:return"AVERAGE LUMINANCE";case 40:return"LUMINANCE TRUNCED";case 41:return"BLOOM";case 42:return"VELOCITY";case 44:return"PERFORMANCE";case 43:return"SINK";case 45:return"RESIZE";default:return"UNKNOWN"}},t.append_draw_data=function(e,t){for(var r=t.batch,_=r.shader,n=r.alpha_antialiasing,a=0;a<e.draw_data.length;a++){var o=e.draw_data[a].bundles,i=o.indexOf(t);if(-1!=i&&(o.splice(i,1),!o.length)){e.draw_data.splice(a,1);break}}if(e.blend)var s=r.offset_z;else s=0;var E=function(e,t,r,_,n){for(var a=0;a<e.length;a++){var o=e[a];if(o.shader==t&&o.alpha_antialiasing==r&&o.offset_z==_&&o.is_sky==n)return o}return null}(e.draw_data,_,n,s,r.is_sky);if(E)E.bundles.push(t);else{var c=function(e,t,_,a,o){return{shader:e,bundles:[t],alpha_antialiasing:n,offset_z:a,is_sky:r.is_sky,do_render:!0,z_index:1/0}}(_,t,0,s);e.draw_data.push(c),e.need_draw_data_sort=!0}},t.init_bundle=function(e,t,r){var _={do_render:!0,do_render_cube:[!0,!0,!0,!0,!0,!0],obj_render:t,batch:e,world_bounds:r||null,info_for_z_sort_updates:null,z_index:1/0};if(e.z_sort&&e.bufs_data.ibo_array){var n=e.bufs_data.ibo_array;_.info_for_z_sort_updates={median_cache:new Float32Array(n.length),median_world_cache:new Float32Array(n.length),dist_cache:new Float32Array(n.length/3),zsort_eye_last:new Float32Array(3),bb_min_side:function(e){var t=e.max_x-e.min_x,r=e.max_y-e.min_y;r<t&&(t=r);var _=e.max_z-e.min_z;return _<t&&(t=_),t}(e.bounds_local.bb)}}return _},t.sort_draw_data=function(e){e.draw_data.sort(s),e.need_draw_data_sort=!1}}),oi=A("__debug_rendertime",function(e,t){var r=Wo(e),_=ni(e),n=Zo(e),a=ai(e),o=r.defaults,i=10;function s(){var e=n.get_disjoint_timer_query();if(e){var t=e.createQuery();e.beginQuery(t)}else t=performance.now();return t}function E(){var e=_.get_debug_view_subs();return e&&e.debug_view_mode==_.DV_RENDER_TIME}function c(e,t,r){var _=n.get_disjoint_timer_query(),a=0;if(_){r&&_.endQuery();for(var o=0;o<e.length;o++){var s=e[o],E=_.getQueryAvailable(s),c=_.getDisjoint();E&&!c&&(a=_.getQueryObject(s)/1e6,t&&(a=Cn(a,t,1,i)),e.splice(o,1),o--)}}else a=performance.now()-e.pop(),t&&(a=Cn(a,t,1,i));return a}t.start_subs=function(e){(o.show_hud_debug_info||e.type==a.PERFORMANCE)&&(e.do_not_debug||e.debug_render_time_queries.push(s()))},t.start_batch=function(e){"MAIN"==e.type&&E()&&e.debug_render_time_queries.push(s())},t.stop_subs=function(e){if((o.show_hud_debug_info||e.type==a.PERFORMANCE)&&!e.do_not_debug){var t=c(e.debug_render_time_queries,e.debug_render_time,!0);t&&(e.debug_render_time=t)}},t.stop_batch=function(e){if("MAIN"==e.type&&E()){var t=c(e.debug_render_time_queries,e.debug_render_time,!0);t&&(e.debug_render_time=t)}},t.is_debug_view_render_time_mode=E,t.process_timer_queries=function(e){var t=c(e.debug_render_time_queries,e.debug_render_time,!1);t&&(e.debug_render_time=t)}}),ii=31e-6,si=4,Ei=.5,ci=Yr(),li=Yr(),Ti=ve(),ui=ve(),di=ve(),fi=tr(),Pi=tr();function Ai(e,t,r){var _=!(!t||!t.length),n=e.length/3;r=r||gi(n);for(var a=0;a<n;++a){var o=Ti;if(o[0]=e[3*a],o[1]=e[3*a+1],o[2]=e[3*a+2],Ke(o,o),_){var i=Pi;i[0]=t[si*a],i[1]=t[si*a+1],i[2]=t[si*a+2],i[3]=t[si*a+3],Ke(i,i);var s=Xe(i,o,ui);Ke(s,s);var E=wr(S_,s,ci),c=We(A_,E,di);mr(u=Fr(wr(c,o,li),E,ci),u);var l=Ei,T=Xe(o,s,di);(Math.abs(T[0]-i[0])>ii||Math.abs(T[1]-i[1])>ii||Math.abs(T[2]-i[2])>ii)&&(l=Math.acos(Be(o,i))/Math.PI),pi(r,u,a),Oi(r,W_(i[3]),a),vi(r,l,a)}else{var u;pi(r,u=wr(A_,o,ci),a)}}return r}function Si(e,t,r){return mr(Ri(e,t=t||0,r),r),r}function pi(e,t,r){var _=Ri(e,r=r||0,fi),n=Pr(_);return Tr(t,(W_(_[3])*W_(t[3])||1)*n,_),Math.abs(_[3])<ii&&(_[3]=_[3]>0?ii:-ii),Ii(e,_,r),e}function mi(e,t){return W_(e[4*(t=t||0)+3])}function Oi(e,t,r){var _=Ri(e,r=r||0,fi);return W_(_[3])*t<0&&Tr(_,-1,_),Ii(e,_,r),e}function vi(e,t,r){var _=Ri(e,r=r||0,fi);return mr(_,_),Tr(_,t,_),Math.abs(_[3])<ii&&(_[3]>0?_[3]+=ii:_[3]-=ii),Ii(e,_,r),e}function Ni(e,t){return Pr(Ri(e,t=t||0,fi))}function gi(e){e=0!==e?e||1:0;for(var t=new Float32Array(4*e),r=0;r<e;r++)t[4*r+3]=Ei;return t}function hi(e){for(var t=0;t<e.length;t+=4)e[t]=0,e[t+1]=0,e[t+2]=0,e[t+3]=Ei;return e}function Ri(e,t,r){return r[0]=e[4*t],r[1]=e[4*t+1],r[2]=e[4*t+2],r[3]=e[4*t+3],r}function Ii(e,t,r){return e[4*r]=t[0],e[4*r+1]=t[1],e[4*r+2]=t[2],e[4*r+3]=t[3],e}function bi(e){return e.length/4}function Yi(e,t,r){for(var _=bi(e),n=0;n<_;n++){var a=mi(e,n),o=Ni(e,n);pi(r,Fr(t,Si(e,n,li),li),n),vi(r,o,n),Oi(r,a,n)}}function Li(e,t,r){return Yi(e,Xa(t,ci),r)}function Mi(e,t,r,_){var n=mi(t,0),a=Si(e,0,ci),o=Si(t,0,li),i=Ni(e),s=Ni(t),E=Xr(a,o,r,li);return mr(E,E),pi(_,E,0),vi(_,r*(i-s)+s),Oi(_,n,0),_}function xi(e,t,r){var _=mi(t,0),n=Si(e,0,ci),a=Si(t,0,li),o=Ni(e,0),i=Ni(t,0);return pi(r,Fr(n,a,ci),0),vi(r,o+i-Ei),Oi(r,_,0),r}function yi(e,t,r){var _=mi(t,0),n=Si(e,0,ci),a=Si(t,0,li),o=Ni(e),i=Ni(t);return pi(r,Fr(n,Vr(a,li),ci),0),vi(r,o-i+Ei),Oi(r,_,0),r}var wi=A("__geometry",function(e,t){var r=ha(e),_=Zo(e),n=Jo(e),a=ga(e),o=gi(),i=gi(),s=gi(),E=new Float32Array(3),c=new Float32Array(3),l=new Float32Array(3),T=Yr(),u=new Float32Array(8),d=65536,f=1.247330950103979,P=3,A=3,S=3,p=2,m=3,O=4;t.DM_TRIANGLES=10,t.DM_DYNAMIC_TRIANGLES=20,t.SORT_NUMERIC=0,t.SORT_STRING=1,t.DM_DEFAULT=t.DM_TRIANGLES;var v=null,N="float",g="short",h="unsigned_byte";function R(e,t,r){var _=t.a_tbn,n=t.a_position,a=n.length,E=e.shape_keys.length;if(r)for(var c=e.shape_keys[0].geometry.a_position,l=0;l<a;l++)n[l]=c[l];for(var T=1;T<E;T++){var u=r?r[T].value:e.shape_keys[T].init_value;for(c=e.shape_keys[T].geometry.a_position,l=0;l<a;l++)n[l]+=u*c[l]}if(E=bi(_),r){var d=e.shape_keys[0].geometry.a_tbn;for(T=0;T<E;T++)Ii(_,d,T)}for(T=0;T<E;T++){var f=hi(o);for(l=1;l<e.shape_keys.length;l++)if(d=e.shape_keys[l].geometry.a_tbn,u=r?r[l].value:e.shape_keys[l].init_value){var P=Ri(d,T,i);xi(Mi(hi(s),P,u,i),f,f)}Ii(_,xi(f,Ri(_,T,i),i),T)}}function I(e){return e.base_length>d&&!_.get_elem_index_uint()}function b(e){return e.indices.length>0}function Y(e,t,r){if(!b(e))return e;t=t||1,r||a.log('%cDEBUG max vertices exceeded for indexed submesh "'+e.name+'": '+e.base_length*t+", will use drawArrays","color: #aa0");var _=e.indices,n=e.base_length,o=e.va_common,i=e.va_frames;for(var s in o){var E=H(d=o[s],n);o[s]=L(_,d,E)}for(var c=0;c<i.length;c++){var l=i[c];for(var s in l)E=H(d=l[s],n),l[s]=L(_,d,E)}for(c=0;c<e.shape_keys.length;c++){var T=e.shape_keys[c].geometry;for(var u in T){var d;E=H(d=T[u],n),T[u]=L(_,d,E)}}return e.base_length=_.length,e.indices=new Uint16Array(0),e}function L(e,t,r){if(0==t.length)return new Float32Array(0);for(var _=new Float32Array(e.length*r),n=0;n<e.length;n++)for(var a=e[n],o=0;o<r;o++)_[r*n+o]=t[r*a+o];return _}function M(){return{ibo_array:null,vbo_source_data:ae(),ibo_type:0,count:0,pointers:{},usage:0,debug_ibo_bytes:0,debug_vbo_bytes:0,vbo_data:[],ibo:null,shape_keys:null,instance_count:1,cleanup_gl_data_on_unload:!0}}function x(e,t){if("a_normal"==t){for(var _=x(e,"a_tbn"),n=bi(_),a=new Float32Array(3*n),o=0;o<n;o++){var i=(s=E,c=Si(_,o,ci),We(A_,c,s));a.set(i,3*o)}return a}var s,c,l=e.pointers[t];if(l){var T=le(t);return ue(t,Ee(e.vbo_source_data,T).subarray(l.offset,l.offset+l.length),new Float32Array(l.length))}r.panic("extract_array_float() failed; invalid name: "+t)}function y(e,_){var n;switch(_){case t.DM_DEFAULT:case t.DM_TRIANGLES:n=v.STATIC_DRAW;break;case t.DM_DYNAMIC_TRIANGLES:n=v.DYNAMIC_DRAW;break;default:r.panic("Wrong draw_mode")}e.usage=n}function w(e){e.ibo_array?(e.ibo||(e.ibo=v.createBuffer()),v.bindBuffer(v.ELEMENT_ARRAY_BUFFER,e.ibo),v.bufferData(v.ELEMENT_ARRAY_BUFFER,e.ibo_array,e.usage),e.debug_ibo_bytes=e.ibo_array.byteLength):e.debug_ibo_bytes=0,e.debug_vbo_bytes=0;for(var t=0;t<e.vbo_source_data.length;t++){var r=e.vbo_source_data[t].type,_=ie(e.vbo_data,r);-1==_&&(e.vbo_data.push({vbo:null,type:r,debug_id:n.unique_id()}),_=e.vbo_data.length-1);var a=e.vbo_data[_];a.vbo||(a.vbo=v.createBuffer()),v.bindBuffer(v.ARRAY_BUFFER,a.vbo),v.bufferData(v.ARRAY_BUFFER,e.vbo_source_data[t].vbo_source,e.usage),e.debug_vbo_bytes+=e.vbo_source_data[t].vbo_source.byteLength}}function U(e,t){e.bb_local=No(e.bb_local,t),e.be_local=Ro(e.be_local,t),e.bs_local=ho(e.bs_local,t),e.bbr_local=Io(e.bbr_local,t)}function C(e){var t=e[0],r=function(e){for(var t=e[0],r=ne("JOIN_"+e.length+"_SUBMESHES"),_=0,n=0;n<e.length;n++)_+=e[n].indices.length;r.indices=new Uint32Array(_);var a=0,o=0;if(e[0].shape_keys.length>0)for(var i=0;i<e[0].shape_keys.length;i++){for(n=0;n<e.length;n++)a+=e[n].shape_keys[i].geometry.a_position.length,o+=bi(e[n].shape_keys[i].geometry.a_tbn);var s={a_position:new Float32Array(a),a_tbn:gi(o)};r.shape_keys.push({init_value:e[0].shape_keys[i].init_value,geometry:s})}for(_=0,n=0;n<e.length;n++)_+=e[n].base_length;for(var E in r.base_length=_,t.va_common){for(_=0,n=0;n<e.length;n++)_+=e[n].va_common[E].length;r.va_common[E]=new Float32Array(_)}for(var E in t.va_frames[0]){for(_=0,n=0;n<e.length;n++)_+=e[n].va_frames[0][E].length;for(n=0;n<t.va_frames.length;n++)r.va_frames[n]=r.va_frames[n]||{},r.va_frames[n][E]=new Float32Array(_)}return r}(e),_=r.submesh_bd;_.bb_local=mo(t.submesh_bd.bb_local);for(var n=0,a=0,o=[],i=0;i<e.length;i++){var s=e[i],E=s.indices,c=s.base_length,l=s.va_common,T=s.submesh_bd.bs_local;Oo(_.bb_local,s.submesh_bd.bb_local),wo(_.bs_local,T),Uo(s.submesh_bd.bbr_local,o);for(var u=0;u<E.length;u++)r.indices[n+u]=E[u]+a;for(var d in n+=E.length,l){var f=a*H(S=l[d],c);r.va_common[d].set(S,f)}for(u=0;u<s.va_frames.length;u++){var P=s.va_frames[u],A=r.va_frames[u];for(var d in P){var S;f=a*H(S=P[d],c),A[d].set(S,f)}}a+=c}if(_.be_local=Co(j_(o),!0),r.shape_keys.length>0)for(i=0;i<r.shape_keys.length;i++){var p=r.shape_keys[i].geometry,m=0,O=0;for(u=0;u<e.length;u++){var v=e[u].shape_keys[i].geometry;p.a_position.set(v.a_position,m),p.a_tbn.set(v.a_tbn,O),m+=v.a_position.length,O+=v.a_tbn.length}}return e[0].instanced_array_data&&(r.instanced_array_data={tsr_array:t.instanced_array_data.tsr_array,stat_part_em_tsr:t.instanced_array_data.stat_part_em_tsr,static_hair:!0,submesh_params:t.instanced_array_data.submesh_params,part_inh_attrs:t.instanced_array_data.part_inh_attrs,dyn_grass:t.instanced_array_data.dyn_grass}),r}function D(e,t,r){for(var _,n,a=t.submesh_bd,o={max_x:0,min_x:0,max_y:0,min_y:0,max_z:0,min_z:0},i=po(),s=[],E=0;E<r.length;E++)No(e.submesh_bd.bb_local,r[E],o),Oo(a.bb_local,o),Io(e.submesh_bd.bbr_local,r[E],i),Uo(i,s);a.be_local=Co(j_(s),!0),a.bbr_local=(_=a.be_local,n=po(),he(_.axis_x,n.axis_x),he(_.axis_y,n.axis_y),he(_.axis_z,n.axis_z),he(_.center,n.center),n),a.bs_local=Do(a.be_local)}function F(e,t,r,_,n,o){var i=e.submeshes[t],s=i.base_length,E=ne("SUBMESH_"+e.name+"_"+e.materials[t].name);E.base_length=s;var c=!1;if(B(r,"a_texcoord"))var l=function(e,t){var r=null,_=e.materials[t],n=e.submeshes[t];if(_.texture_slots.length){var a=_.texture_slots[0];switch(a.texture_coords){case"UV":r=k(n,a.uv_layer||e.active_uv_name,e.name);break;case"ORCO":r=function(e,t){for(var r=new Float32Array(t.base_length*p),_=(e.max_x+e.min_x)/2,n=(e.max_y+e.min_y)/2,a=e.max_x-e.min_x,o=e.max_y-e.min_y,i=0,s=0;s<t.position.length;s+=3)r[i++]=(t.position[s]-_)/a+.5,r[i++]=(t.position[s+1]-n)/o+.5;return r}(e.b4w_boundings.bb_src,n)}}return null===r&&(r=new Float32Array(n.base_length*p)),r}(e,t);else l=new Float32Array(0);if(B(r,"a_orco_tex_coord"))var T=function(e,t){for(var r=e.b4w_boundings.bb_src,_=new Float32Array(3*t.base_length),n=t.position,a=r.max_x-r.min_x,o=r.max_y-r.min_y,i=r.max_z-r.min_z,s=0,E=0;E<n.length;E+=3)_[s++]=0==a?.5:Un(parseFloat(((n[E]-r.min_x)/a).toFixed(5)),0,1),_[s++]=0==o?.5:Un(parseFloat(((n[E+1]-r.min_y)/o).toFixed(5)),0,1),_[s++]=0==i?.5:Un(parseFloat(((n[E+2]-r.min_z)/i).toFixed(5)),0,1);return _}(e,i);else T=new Float32Array(0);var u=function(e,t,r,_){if(B(e,"a_influence")&&r)for(var n=new Float32Array(t*O),a=_.length/t,o=function(e,t){for(var r=new Float32Array(t),_=0;_<t;_++)for(var n in r[_]=-1,e){var a=e[n];if(a.vgroup_index===_){r[_]=a.deform_bone_index;break}}return r}(r,a),i=a>3?a:4,s=new Float32Array(i),E=new Uint32Array(i),c=new Float32Array(O),l=new Float32Array(i),T=new Uint32Array(i),u=new Float32Array(O),d=0;d<t;d++)s.set(l),E.set(T),c.set(u),n.set(X(_,a,d,t,o,s,E,c),d*O);else n=new Float32Array(0);return n}(r,s,_,i.group);if(n)var d=ln(n);else d={};d.a_color={generate_buffer:!0},d.a_color.src=B(r,"a_color")&&e.active_vcol_name?[{name:e.active_vcol_name,mask:7}]:[],E.va_common.a_texcoord=l,E.va_common.a_influence=u,E.va_common.a_orco_tex_coord=T,function(e,t,r,_,n,o){var i=function(e){for(var t=[],r=0;r<e.length;r++)t.push(e[r].name);return t}(r);for(var s in t){var E=t[s].src;if(E.length){for(var c=0,l=0;l<E.length;l++)c+=Xn(E[l].mask);e[s]=new Float32Array(c*n);var T=0;for(l=0;l<E.length;l++){var u=E[l].name,d=E[l].mask,f=Hn(d),P=i.indexOf(u);if(-1==P){a.warn('vertex color "'+u+'" for mesh "'+o+'" not found');var A=7}else{A=r[P].mask;var p=K(r,P,n)}var m=Xn(A);(d&A)!==d&&a.error("Wrong color extraction from "+u+" to "+s+' for the mesh "'+o+'".');for(var O=0;O<n;O++)for(var v=0;v<S;v++)if(f[v]){var N=T+Qn(d,v),g=Qn(A,v);e[s][O*c+N]=-1==P?0:_[p+O*m+g]}T+=m}}else e[s]=new Float32Array(0)}}(E.va_common,d,i.vertex_colors,i.color,s,e.name),function(e,t,r,_){if(r)for(var n in r)_[r[n]]=k(e,n,t)}(i,e.name,o,E.va_common),E.indices=new Uint32Array(i.indices);var f=i.position.length/s/P;if(B(r,"a_tbn")&&i.tbn.length)var A=!0;else A=!1;if(B(r,"a_shade_tangs")&&i.shade_tangs.length)var m=!0;else m=!1;e.b4w_shape_keys.length>0&&(c=!0);for(var v=0;v<f;v++){var N=G(i,s,A,m,v);if(c){var g={};if(g.name=e.b4w_shape_keys[v].name,E.shape_keys.push(g),0!=v){g.geometry=N,g.init_value=e.b4w_shape_keys[v].value;continue}g.geometry=G(i,s,A,m,v),g.init_value=1}E.va_frames.push(N)}if(f>1&&!c){var h=E.va_frames[0];for(var R in N={},h)N[R]=new Float32Array(h[R]);E.va_frames.push(N)}return B(r,"a_polyindex")&&(Y(E,1,!0),E.va_common.a_polyindex=J(E)),function(e,t){t.bb_local={max_x:0,min_x:0,max_y:0,min_y:0,max_z:0,min_z:0},t.bb_local.max_x=e.bb.max_x,t.bb_local.max_y=e.bb.max_y,t.bb_local.max_z=e.bb.max_z,t.bb_local.min_x=e.bb.min_x,t.bb_local.min_y=e.bb.min_y,t.bb_local.min_z=e.bb.min_z;var r=e.rbb,_=e.caxis_x,n=e.caxis_y,a=e.caxis_z,o=e.be_ax;t.be_local=yo(_,n,a,e.be_cen),ye(t.be_local.axis_x,o[0],t.be_local.axis_x),ye(t.be_local.axis_y,o[1],t.be_local.axis_y),ye(t.be_local.axis_z,o[2],t.be_local.axis_z),t.bs_local=Do(t.be_local),he(r.rbb_c,t.bbr_local.center),he(_,t.bbr_local.axis_x),he(n,t.bbr_local.axis_y),he(a,t.bbr_local.axis_z);var i=r.rbb_s;ye(t.bbr_local.axis_x,i[0],t.bbr_local.axis_x),ye(t.bbr_local.axis_y,i[1],t.bbr_local.axis_y),ye(t.bbr_local.axis_z,i[2],t.bbr_local.axis_z)}(i.boundings,E.submesh_bd),E}function G(e,t,r,_,n){var a={},o=new Float32Array(t*P),i=gi(r?t:0),s=n*t*P,E=s+t*P;if(o.set(e.position.subarray(s,E),0),r&&function(e,t,r,_){if(0!==r){t=4*t||0,r=r||e.length;for(var n=0,a=0;n<4*r;n+=4,a+=4)_[a]=e[t+n],_[a+1]=e[t+n+1],_[a+2]=e[t+n+2],_[a+3]=e[t+n+3]}}(e.tbn,s=n*t,t,i),_){var c=new Float32Array(t*m);c.set(e.shade_tangs.subarray(0,E=t*m),0),a.a_shade_tangs=c}return a.a_position=o,a.a_tbn=i,a}function k(e,t,r){var _=e.base_length*p,n=e.uv_layers.indexOf(t);if(-1==n)return a.warn('uv layer "'+t+'" for mesh "'+r+'" not found'),new Float32Array(_);var o=n*_;return e.texcoord.subarray(o,o+_)}function K(e,t,r){for(var _=0,n=0;n<t;n++)_+=Xn(e[n].mask);return _*r}function B(e,t){return e.indexOf(t)>-1}function X(e,r,_,n,a,o,i,s){for(var E=!0,c=0;c<r;c++){var l=e[c*n+_];if(-1!==l){var T=a[c];-1!==T&&(o[c]=l,i[c]=T,E=!1)}}if(E)return s;Q(o,i,t.SORT_NUMERIC,!1);var u=0;for(c=0;c<O;c++)u+=o[c];if(u<.01)return s;for(c=0;c<O;c++)o[c]/=u;if(Math.abs(o[0]-1)<.01)s[0]=i[0]+1;else for(c=0;c<O;c++)s[c]=i[c]+o[c];return s}function H(e,t){if(0==t)return 0;var _=e.length,n=_/t;return n!=Math.floor(n)&&r.panic("Array size mismatch during geometry calculation: array length="+_+", base length="+t),n}function Q(e,r,_,n){for(var a,o=e.length,i=o,s=!1,E=n?-1:1;i>1||s;){i>1&&(i=Math.floor(i/f)),s=!1;for(var c=0;i+c<o;c++){if(_==t.SORT_NUMERIC)var l=E*(e[c]-e[c+i])<0;else l=e[c]<e[c+i]&&n;l&&(a=e[c],e[c]=e[c+i],e[c+i]=a,a=r[c],r[c]=r[c+i],r[c+i]=a,s=!0)}}}function z(e,t,r){var _=e[3*t],n=e[3*t+1],a=e[3*t+2];e[3*t]=e[3*r],e[3*t+1]=e[3*r+1],e[3*t+2]=e[3*r+2],e[3*r]=_,e[3*r+1]=n,e[3*r+2]=a}function V(e,t,r){var _=[],n=[];be(t,e,_),be(r,e,n),Ke(_,_),Ke(n,n);var a=Un(Be(_,n),-1,1);return Math.acos(a)}function j(e,t,r,_,n,a,o,i,s,E){for(var c=function(e,t,r){var _=[],n=[],a=[];return be(t,e,_),be(r,e,n),Xe(_,n,a),Ke(a,a),a}(_,n,a),l=0;l<A;l++){var T=A*t+l,u=A*r+l;E[A*e+l]=o*c[l],E[T]=i*c[l],E[u]=s*c[l]}}function q(e,t){for(var r=new Float32Array(A),_=0;_<A;_++)r[_]=t[A*e+_];for(Ke(r,r),_=0;_<A;_++)t[A*e+_]=r[_]}function W(e,t,r){if(b(t))for(var _=t.indices,n=_.length/3,a=0;a<n;a++){var o=new Float32Array(9),i=_[3*a];o[0]=e[3*i],o[1]=e[3*i+1],o[2]=e[3*i+2];var s=_[3*a+1];o[3]=e[3*s],o[4]=e[3*s+1],o[5]=e[3*s+2];var E=_[3*a+2];o[6]=e[3*E],o[7]=e[3*E+1],o[8]=e[3*E+2],r[a]=o}else for(n=e.length/9,a=0;a<e.length;a++)(o=new Float32Array(9))[0]=e[9*a],o[1]=e[9*a+1],o[2]=e[9*a+2],o[3]=e[9*a+3],o[4]=e[9*a+4],o[5]=e[9*a+5],o[6]=e[9*a+6],o[7]=e[9*a+7],o[8]=e[9*a+8],r[a]=o;return r}function J(e){for(var t=new Float32Array(e.base_length),r=0;r<e.base_length;r++)t[r]=r%3/2;return t}function Z(e,t,r){return Math.sqrt($(e,t,r))}function $(e,t,r){var _=Ue(e,t),n=Ue(e,r),a=Ue(t,r),o=(_+n+a)/2;return o*(o-_)*(o-n)*(o-a)}function ee(e,t,r){r||(r=new Float32Array(3));var _=e[0],n=e[1],a=e[2],o=e[3],i=e[4],s=e[5],E=e[6],c=e[7],l=e[8],T=en(t),u=en(t);T+u>1&&(T=1-T,u=1-u);var d=1-T-u,f=d*n+T*i+u*c,P=d*a+T*s+u*l;return r[0]=d*_+T*o+u*E,r[1]=f,r[2]=P,r}function te(e){for(var t=new Float32Array([0,0,0,1,1,1,1,0]),r=new Float32Array(8*e),_=0;_<e;_++)r.set(t,8*_);return r}function re(e,t,r,_){if(e){for(var n=e.offset,a=e.length+n,o=t.bufs_data.shape_keys[0].geometry.a_position,i=n;i<a;i++)r[i]=o[i-n];for(i=1;i<t.bufs_data.shape_keys.length;i++){var s=t.bufs_data.shape_keys[i].geometry.a_position,E=_[i].value;if(E)for(var c=n;c<a;c++)r[c]+=E*s[c-n]}v.bufferSubData(v.ARRAY_BUFFER,H_*n,r.subarray(n))}}function _e(e,t,r,_){if(e){for(var n=e.offset,a=e.length+n,E=t.bufs_data.shape_keys,c=E[0].geometry.a_tbn,l=hi(o),T=n;T<a;T+=si){for(var u=hi(s),d=(T-n)/si,f=1;f<E.length;f++){var P=_[f].value;P&&xi(Mi(l,Ri(E[f].geometry.a_tbn,d,i),P,i),l,u)}var A=xi(u,Ri(c,d,i),i);r[T]=da(A[0]),r[T+1]=da(A[1]),r[T+2]=da(A[2]),r[T+3]=da(A[3])}v.bufferSubData(v.ARRAY_BUFFER,H_*n,r.subarray(n))}}function ne(e){return{name:e,base_length:0,indices:null,va_frames:[],va_common:{a_influence:new Float32Array(0),a_color:new Float32Array(0),a_texcoord:new Float32Array(0)},shape_keys:[],submesh_bd:{bb_local:{max_x:0,min_x:0,max_y:0,min_y:0,max_z:0,min_z:0},be_local:Mo(),bs_local:Yo(),bbr_local:po()},instanced_array_data:null}}function ae(e){var t=[];for(var r in e)t.push(oe(r,e[r]));return t}function oe(e,t){return{vbo_source:new(ce(e))(t),type:e}}function ie(e,t){for(var r=0;r<e.length;r++)if(e[r].type==t)return r;return-1}function se(e,t){var r=ie(e,t);return-1==r?null:e[r].vbo}function Ee(e,t){var r=ie(e,t);return-1==r?null:e[r].vbo_source}function ce(e){switch(e){case N:return Float32Array;case g:return Int16Array;case h:return Uint8Array;default:return Float32Array}}function le(e){switch(e=(e=e.replace(/_next$/,"")).replace(/param_GEOMETRY_VC_a_\w+/,"param_GEOMETRY_VC_a")){case"a_tbn":case"a_shade_tangs":return g;case"a_color":case"a_bending_col_main":case"a_bending_col_detail":case"a_grass_size":case"a_grass_color":case"param_GEOMETRY_VC_a":case"a_polyindex":case"a_p_bb_vertex":case"a_halo_bb_vertex":case"a_bb_vertex":return h;default:return N}}function Te(e,t,r,_){de(t,r,e[ie(e,le(t))].vbo_source.subarray(_))}function ue(e,t,r){switch(le(e)){case N:r.set(t);break;case g:for(var _=0;_<t.length;_++)r[_]=fa(t[_]);break;case h:for(_=0;_<t.length;_++)r[_]=Aa(t[_])}return r}function de(e,t,r){switch(le(e)){case N:r.set(t);break;case g:for(var _=0;_<t.length;_++)r[_]=da(t[_]);break;case h:for(_=0;_<t.length;_++)r[_]=Pa(t[_])}return r}t.VBO_FLOAT=N,t.VBO_SHORT=g,t.VBO_UBYTE=h,t.setup_context=function(e){v=e},t.submesh_to_bufs_data=function(e,t,r){I(e)&&Y(e);var _=e.indices,n=e.base_length,a=e.va_frames,o={};for(var i in e.va_common)i in r&&!r[i].generate_buffer||(o[i]=e.va_common[i]);var s=M();return e.shape_keys.length>0&&R(e,a[0]),function(e,t,r,_,n,a){if(t.length){var o=t.length;if(n<=d)var i=new Uint16Array(t),s=v.UNSIGNED_SHORT;else i=new Uint32Array(t),s=v.UNSIGNED_INT}else o=n,i=null;for(var E=ae(function(e,t,r){var _={},n=function(e,t){_[e]||(_[e]=0),_[e]+=t};for(var a in e[0]){var o=e[0][a];n(le(a),o.length*e.length)}for(var a in t)o=t[a],n(le(a),o.length);if(r){var i=r.tsr_array.length;n(le("a_part_ts"),4*i),n(le("a_part_r"),4*i);var s=r.part_inh_attrs;for(var a in s)n(le(a),s[a].num_comp*i);var E=r.submesh_params;for(var a in E)n(le(a),i)}return _}(r,_,a)),c={},l=0;l<E.length;l++)c[E[l].type]=0;var T={};for(var f in _)if(m=(N=_[f]).length){var P=le(f);(S=T[f]={length:0,frames:1,num_comp:0,offset:0,divisor:0}).length=m,S.num_comp=H(N,n),S.offset=c[P],Te(E,f,N,c[P]),c[P]+=m}var A=r.length;for(var f in r[0]){var S,p=r[0][f],m=(P=le(f),p.length),O=H(p,n);if(m)for((S=T[f]={length:0,frames:1,num_comp:0,offset:0,divisor:0}).length=m,S.frames=A,S.num_comp=O,S.offset=c[P],A>1&&((S=T[f+"_next"]={length:0,frames:1,num_comp:0,offset:0,divisor:0}).length=m,S.frames=A,S.num_comp=O,S.offset=c[P]+m),l=0;l<A;l++){var N;Te(E,f,N=r[l][f],c[P=le(f)]),c[P]+=m}}a&&(function(e,t,r,_){var n=e.tsr_array,a=e.stat_part_em_tsr,o=e.part_inh_attrs,i=e.submesh_params,s=e.static_hair,E={a_part_ts:{data:[],num_comp:4},a_part_r:{data:[],num_comp:4}};for(var c in o)E[c]={data:[],num_comp:o[c].num_comp};for(var c in i)E[c]={data:[],num_comp:1};for(var l=0;l<n.length;l++){var T=n[l];for(var c in s&&a&&!e.dyn_grass&&(T=Va(a,n[l],u)),!s&&e.dyn_grass&&be(n[l],a,n[l]),E.a_part_ts.data.push(T[0],T[1],T[2],T[3]),E.a_part_r.data.push(T[4],T[5],T[6],T[7]),o)for(var d=o[c].num_comp,f=0;f<d;f++)E[c].data.push(o[c].data[l*d+f]);for(var c in i)E[c].data.push(i[c][0])}for(var c in E){var P=le(c);Te(r,c,E[c].data,_[P]);var A={length:0,frames:1,num_comp:0,offset:0,divisor:0};A.num_comp=E[c].num_comp,A.offset=_[P],A.divisor=1,A.length=E[c].data.length,t[c]=A,_[P]+=A.length}}(a,T,E,c),e.instance_count=a.tsr_array.length),e.count=o,e.ibo_array=i,e.vbo_source_data=E,e.ibo_type=s,e.pointers=T}(s,_,a,o,n,e.instanced_array_data),y(s,t),w(s),s.shape_keys=e.shape_keys,s},t.submesh_init_shape_keys=R,t.is_long_submesh=I,t.is_indexed=b,t.submesh_drop_indices=Y,t.update_bufs_data_index_array=function(e,t,r){return y(e,t),e.count=r.length,e.ibo_array=r,e.ibo_type=r instanceof Uint16Array?v.UNSIGNED_SHORT:v.UNSIGNED_INT,e},t.update_bufs_data_array=function e(t,_,n,a){if("a_normal"==_)return e(t,"a_tbn",n,Ai(a));var o=t.pointers,i=o[_],s=le(_);if(i)n&&i.num_comp!=n&&r.panic('invalid num_comp for "'+_+'"'),Te(t.vbo_source_data,_,a,i.offset);else{var E=ie(t.vbo_source_data,s);-1==E&&(t.vbo_source_data.push(oe(s,0)),E=t.vbo_source_data.length-1);var c=t.vbo_source_data[E].vbo_source,l=new c.constructor(c.length+a.length);l.set(c),t.vbo_source_data[E].vbo_source=l,Te(t.vbo_source_data,_,a,c.length);var T=o[_]={length:0,frames:1,num_comp:0,offset:0,divisor:0};T.num_comp=n,T.offset=c.length,T.length=a.length}return w(t),t},t.extract_array_float=x,t.make_static=function(e){e.usage=v.STATIC_DRAW},t.make_dynamic=function(e){e.usage=v.DYNAMIC_DRAW},t.update_gl_buffers=w,t.update_gl_buffer_sub_data=function(e,t,r,_){var n=ie(e.vbo_data,t);v.bindBuffer(v.ARRAY_BUFFER,e.vbo_data[n].vbo),v.bufferSubData(v.ARRAY_BUFFER,H_*_,r)},t.cleanup_bufs_data=function(e){e.ibo&&v.deleteBuffer(e.ibo);for(var t=0;t<e.vbo_data.length;t++)e.vbo_data[t].vbo&&v.deleteBuffer(e.vbo_data[t].vbo);e.vbo_data.length=0},t.has_empty_submesh=function(e,t){return!e.submeshes[t].base_length},t.submesh_apply_transform=function(e,t){for(var r=0;r<e.va_frames.length;r++){var _=e.va_frames[r].a_position;Wa(_,t,_,0);var n=e.va_frames[r].a_tbn;Li(n,t,n);var a=e.va_frames[r].a_shade_tangs;a&&a.length>0&&Ja(a,t,a,0)}var o=e.va_common.au_center_pos;return o&&o.length&&Wa(o,t,o,0),U(e.submesh_bd,t),e},t.submesh_apply_particle_transform=function(e,t){var _=e.va_common.au_center_pos;if(_&&_.length){var n=new Float32Array(_);Wa(n,t,n,0);for(var a=0;a<e.va_frames.length;a++)for(var o=0;o<n.length;o++)e.va_frames[a].a_position[o]+=n[o]-_[o];_.set(n)}else r.panic('Attribute "au_center_pos" is missing in particle submesh');return U(e.submesh_bd,t),e},t.bounding_data_apply_transform=U,t.submesh_apply_params=function(e,t){var r=e.base_length;for(var _ in t){var n=t[_].length;e.va_common[_]=new Float32Array(n*r);for(var a=0;a<r;a++)for(var o=0;o<n;o++)e.va_common[_][a*n+o]=t[_][o]}return e},t.submesh_list_join=C,t.make_propagated_submesh=function(e,t,n){if(!e.base_length)return ne("EMPTY");var a=n.length;e.base_length*a>d&&!_.get_elem_index_uint()&&Y(e,a);var o=e.indices,i=e.base_length,s=e.va_common,E=e.va_frames;for(var c in t){var l=t[c].length,T=l*i;s[c]=new Float32Array(T);for(var u=0;u<i;u++)for(var f=0;f<l;f++)s[c][u*l+f]=t[c][f]}var P,A,S=ne("CLONE_"+a+"_SUBMESHES");for(S.base_length=i*a,S.indices=new Uint32Array(o.length*a),u=0;u<a;u++){var p=o.length*u,m=i*u;for(f=0;f<o.length;f++)S.indices[p+f]=o[f]+m}for(var O in s){T=(N=s[O]).length*a;var v=H(N,i);for(S.va_common[O]=new Float32Array(T),u=0;u<a;u++)S.va_common[O].set(N,m=i*v*u)}for(var O in E[0])for(u=0;u<E.length;u++){var N;for(T=(N=E[u][O]).length*a,v=H(N,i),S.va_frames[u]=S.va_frames[u]||{},S.va_frames[u][O]=new Float32Array(T),f=0;f<a;f++){var g=n[f];switch(m=i*v*f,O){case"a_position":Wa(N,g,S.va_frames[u][O],m);break;case"a_tbn":P=S.va_frames[u][O],A=(A=m)||0,function(e,t,r,_){_=_||0;for(var n=e.length,a=l_,o=0;o<n;o+=4){a[0]=e[o],a[1]=e[o+1],a[2]=e[o+2],a[3]=e[o+3];var i=a[3]>0;Fr(t,a,a),(i&&a[3]<0||!i&&a[3]>0)&&Tr(a,-1,a),r[_+o]=a[0],r[_+o+1]=a[1],r[_+o+2]=a[2],r[_+o+3]=a[3]}}(N,Xa(g,Ia),P,A);break;case"a_shade_tangs":$a(N,g,S.va_frames[u][O],m);break;default:r.panic("Wrong attribute name: "+O)}}}return D(e,S,n),S},t.calc_unit_boundings=D,t.extract_submesh=F,t.extract_halo_submesh=function(e){for(var t=e.base_length,r=e.va_frames[0].a_position,_=new Float32Array(12*t),n=new Uint32Array(4*e.indices.length),a=new Float32Array(4*t),o=0;o<t;o++){_[12*o]=r[3*o],_[12*o+1]=r[3*o+1],_[12*o+2]=r[3*o+2],_[12*o+3]=r[3*o],_[12*o+4]=r[3*o+1],_[12*o+5]=r[3*o+2],_[12*o+6]=r[3*o],_[12*o+7]=r[3*o+1],_[12*o+8]=r[3*o+2],_[12*o+9]=r[3*o],_[12*o+10]=r[3*o+1],_[12*o+11]=r[3*o+2],n[6*o]=4*o+2,n[6*o+1]=4*o+1,n[6*o+2]=4*o,n[6*o+3]=4*o+2,n[6*o+4]=4*o,n[6*o+5]=4*o+3;var i=Math.random();a[4*o]=i,a[4*o+1]=i,a[4*o+2]=i,a[4*o+3]=i}var s=ne("HALO");return s.va_frames[0]={},s.base_length=4*t,s.va_frames[0].a_position=_,s.va_common.a_halo_bb_vertex=te(t),s.va_common.a_random_vals=a,s.indices=n,s},t.has_attr=B,t.extract_submesh_all_mats=function(e,t,r){for(var _=[],n=0;n<e.submeshes.length;n++){var a=F(e,n,t,null,r,null);a.base_length&&_.push(a)}if(0==_.length)var o=ne("EMPTY");else o=1==_.length?_[0]:C(_);return o},t.update_buffers_movable=function(e,t,r,_){var n=e.ibo_array,a=x(e,"a_position"),o=t.median_cache,i=t.median_world_cache,s=t.dist_cache;!function(e,t,r){for(var _=e.length/3,n=0;n<_;n++){var a=e[3*n],o=e[3*n+1],i=e[3*n+2],s=t[3*a+1],E=t[3*a+2],c=t[3*o+1],l=t[3*o+2],T=t[3*i+1],u=t[3*i+2];r[3*n]=(t[3*a]+t[3*o]+t[3*i])/3,r[3*n+1]=(s+c+T)/3,r[3*n+2]=(E+l+u)/3}}(n,a,o),Wa(o,r,i),function(e,t,r){for(var _=e.length/3,n=0;n<_;n++){var a=e[3*n]-t[0],o=e[3*n+1]-t[1],i=e[3*n+2]-t[2];r[n]=a*a+o*o+i*i}}(i,_,s),n=function(e,t){var r=e.length;if(r<2)return t;for(var _,n=r,a=!1;n>1||a;){n>1&&(n=Math.floor(n/f)),a=!1;for(var o=0;n+o<r;o++)e[o]-e[o+n]<0&&(_=e[o],e[o]=e[o+n],e[o+n]=_,z(t,o,o+n),a=!0)}return t}(s,n),v.bindBuffer(v.ELEMENT_ARRAY_BUFFER,e.ibo),v.bufferData(v.ELEMENT_ARRAY_BUFFER,n,v.DYNAMIC_DRAW)},t.sort_two_arrays=Q,t.calc_normals=function(e,t,r){for(var _=t.length/P,n=e.length/3,a=[],o=new Array(3),i=new Array(3),s=new Array(3),E=0;E<n;E++){for(var c=e[3*E],l=e[3*E+1],T=e[3*E+2],u=0;u<P;u++)o[u]=t[P*c+u],i[u]=t[P*l+u],s[u]=t[P*T+u];if(r)var d=V(o,i,s),f=V(i,s,o),S=Math.PI-d-f;else d=1,f=1,S=1;j(c,l,T,o,i,s,d,f,S,a)}for(r&&function(e,t){for(var r in e)for(var _=e[r],n=0;n<A;n++){for(var a=A*_[0]+n,o=1;o<_.length;o++)t[a]+=t[A*_[o]+n];for(o=1;o<_.length;o++)t[A*_[o]+n]=t[a]}}(r,a),E=0;E<_;E++)q(E,a);return a},t.calc_shared_indices=function(e,t,r){for(var _={},n=t.length/3,a=0;a<n;a++)_[i=String(t[3*a])+String(t[3*a+1])+String(t[3*a+2])]=[];var o=e.length;for(a=0;a<o;a++){var i,s=e[a];(i=String(r[3*s])+String(r[3*s+1])+String(r[3*s+2]))in _&&_[i].push(s)}return _},t.geometry_random_points=function(e,t,r,_){var n=function(e,t){return t||(t=[]),W(e.va_frames[0].a_position,e,t)}(e,null);if(r)var a=function(e,t){t||(t=[]);for(var r=e.va_frames[0].a_tbn,_=bi(r),n=new Float32Array(3*_),a=0;a<_;a++){var o=Si(r,a,T),i=We(A_,o,E);n[3*a]=i[0],n[3*a+1]=i[1],n[3*a+2]=i[2]}return W(n,e,t)}(e,null);for(var o=n.length,i=new Float32Array(o),s=E,u=c,d=l,f=0;f<o;f++)s.set((m=n[f]).subarray(0,3)),u.set(m.subarray(3,6)),d.set(m.subarray(6)),i[f]=Z(s,u,d);var P=new Float32Array(o);for(P[0]=i[0],f=1;f<o;f++)P[f]=P[f-1]+i[f];var A=P[i.length-1],S=[];for(f=0;f<t;f++){var p=pn(P,A*en(_),0,P.length-1);if(r)var m=a[p];else m=n[p];var O=ee(m,_,E);if(r){S[f]=new Float32Array(4),Ke(O,O);var v=wr(A_,O,T);S[f][0]=v[0],S[f][1]=v[1],S[f][2]=v[2],S[f][3]=v[3]}else S[f]=new Float32Array(3),S[f][0]=O[0],S[f][1]=O[1],S[f][2]=O[2]}return S},t.extract_polyindices=J,t.triangle_area_squared=$,t.gen_bb_vertices=te,t.scale_submesh_xyz=function(e,t,r){for(var _=e.va_frames[0].a_position,n=0;n<_.length;n+=3)_[n]=(_[n]-r[0])*t[0]+r[0],_[n+1]=(_[n+1]-r[1])*t[1]+r[1],_[n+2]=(_[n+2]-r[2])*t[2]+r[2]},t.apply_shape_key=function(e,t,r){for(var _=e.scenes_data[0].batches,n=e.render.shape_keys_values,a=1;a<n.length;a++)n[a].name==t&&(n[a].value=r);for(a=0;a<_.length;a++)if(!_[a].forked_batch&&_[a].use_shape_keys&&!_[a].debug_sphere){var o=_[a].bufs_data,i=le("a_position"),s=se(o.vbo_data,i),E=Ee(o.vbo_source_data,i);v.bindBuffer(v.ARRAY_BUFFER,s),re(o.pointers.a_position,_[a],E,n);var c=le("a_tbn"),l=se(o.vbo_data,c),T=Ee(o.vbo_source_data,c);v.bindBuffer(v.ARRAY_BUFFER,l),_e(o.pointers.a_tbn,_[a],T,n)}},t.check_shape_keys=function(e){return e.render.use_shape_keys},t.get_shape_keys_names=function(e){var t=[];if(e.render)for(var r=1;r<e.render.shape_keys_values.length;r++)t.push(e.render.shape_keys_values[r].name);return t},t.get_shape_key_value=function(e,t){if(e.render)for(var r=1;r<e.render.shape_keys_values.length;r++)if(t==e.render.shape_keys_values[r].name)return e.render.shape_keys_values[r].value;return 0},t.has_shape_key=function(e,t){var r=e.render.shape_keys_values;if(r)for(var _=1;_<r.length;_++)if(r[_].name==t)return!0;return!1},t.has_dyn_geom=function(e){return!!(e&&e.render&&e.render.dynamic_geometry)},t.draw_line=function(e,r,_){var n=e.bufs_data;if(n){if(_)var a=r.length/3/2;else a=r.length/3-1;for(var o=new Float32Array(4*a*3),i=new Float32Array(4*a*3),s=new Uint16Array(6*a),E=0;E<a;E++){if(_)var c=6*E,l=6*E+3;else c=3*E,l=3*(E+1);var T=r[c],u=r[c+1],d=r[c+2],f=r[l],P=r[l+1],A=r[l+2],S=f-T,p=P-u,m=A-d;o[4*E*3]=T,o[4*E*3+1]=u,o[4*E*3+2]=d,i[4*E*3]=S,i[4*E*3+1]=p,i[4*E*3+2]=m,o[4*E*3+3]=f,o[4*E*3+4]=P,o[4*E*3+5]=A,i[4*E*3+3]=-S,i[4*E*3+4]=-p,i[4*E*3+5]=-m,o[4*E*3+6]=T,o[4*E*3+7]=u,o[4*E*3+8]=d,i[4*E*3+6]=-S,i[4*E*3+7]=-p,i[4*E*3+8]=-m,o[4*E*3+9]=f,o[4*E*3+10]=P,o[4*E*3+11]=A,i[4*E*3+9]=S,i[4*E*3+10]=p,i[4*E*3+11]=m,s[6*E]=4*E,s[6*E+1]=4*E+1,s[6*E+2]=4*E+2,s[6*E+3]=4*E,s[6*E+4]=4*E+3,s[6*E+5]=4*E+1}var O=0;for(var v in n.pointers)O+=o.length/3*(I=n.pointers[v]).num_comp;var g={};g[N]=O;var h=n.vbo_source_data=ae(g);t.update_bufs_data_index_array(n,e.draw_mode,s);var R=0;for(var v in n.pointers){var I=n.pointers[v];switch(v){case"a_position":Te(h,v,o,R),I.offset=R,I.length=o.length,R+=I.length;break;case"a_direction":Te(h,v,i,R),I.offset=R,I.length=i.length,R+=I.length;break;default:I.offset=R,I.length=o.length/3*I.num_comp,Te(h,v,new Float32Array(I.length),R),R+=I.length}}w(n)}},t.clone_bufs_data=function(e){if(e){var t=M();if(e.ibo_array)switch(e.ibo_type){case v.UNSIGNED_SHORT:t.ibo_array=new Uint16Array(e.ibo_array);break;case v.UNSIGNED_INT:t.ibo_array=new Uint32Array(e.ibo_array)}else t.ibo_array=null;t.vbo_source_data=function(e){for(var t=[],r=0;r<e.length;r++){var _=e[r].vbo_source,n=e[r].type;t.push({vbo_source:new _.constructor(_),type:n})}return t}(e.vbo_source_data),t.ibo_type=e.ibo_type,t.count=e.count,t.pointers=ln(e.pointers),t.usage=e.usage,t.debug_ibo_bytes=e.debug_ibo_bytes,t.debug_vbo_bytes=e.debug_vbo_bytes,t.ibo=null,t.info_for_z_sort_updates=ln(e.info_for_z_sort_updates),t.shape_keys=ln(e.shape_keys),t.instance_count=e.instance_count,t.cleanup_gl_data_on_unload=e.cleanup_gl_data_on_unload}else t=null;return t},t.init_submesh=ne,t.clone_submesh=function(e){var t,r,_=ne(e.name);return _.base_length=e.base_length,_.indices=ln(e.indices),_.va_frames=ln(e.va_frames),_.va_common=ln(e.va_common),_.shape_keys=ln(e.shape_keys),So(e.submesh_bd.bb_local,_.submesh_bd.bb_local),xo(e.submesh_bd.be_local,_.submesh_bd.be_local),Lo(e.submesh_bd.bs_local,_.submesh_bd.bs_local),he((t=e.submesh_bd.bbr_local).center,(r=_.submesh_bd.bbr_local).center),he(t.axis_x,r.axis_x),he(t.axis_y,r.axis_y),he(t.axis_z,r.axis_z),_.instanced_array_data=ln(e.instanced_array_data),_},t.reset=function(){v=null},t.init_vbo_source_data=ae,t.search_vbo_index_by_type=ie,t.get_vbo_by_type=se,t.get_vbo_source_by_type=Ee,t.get_constructor_by_type=ce,t.get_vbo_type_by_attr_name=le,t.get_type_size_by_attr_name=function(e){switch(le(e)){case N:return H_;case g:return X_;case h:return B_;default:return H_}},t.get_gl_type_by_attr_name=function(e){switch(le(e)){case N:return v.FLOAT;case g:return v.SHORT;case h:return v.UNSIGNED_BYTE;default:return v.FLOAT}},t.vbo_source_data_set_attr=Te,t.value_vbo_to_float=function(e,t){switch(le(e)){case N:return t;case g:return fa(t);case h:return Aa(t)}return t},t.value_float_to_vbo=function(e,t){switch(le(e)){case N:return t;case g:return da(t);case h:return Pa(t)}return t},t.array_vbo_to_float=ue,t.array_float_to_vbo=de,t.create_empty_va_frame=function(){return{a_position:new Float32Array(0),a_tbn:gi(0)}}}),Ui="DEBUG",Ci=null,Di=null,Fi="_b4w_ver_";function Gi(){if("DEBUG"==Ui){var e=Bi();return[parseInt(String(e.getFullYear()).slice(-2),10),e.getMonth()+1]}return Di}function ki(){for(var e="",t=Gi(),r=0;r<t.length;r++)e+=1==r&&t[r]<10?"0"+t[r]:t[r],r!=t.length-1&&(e+=".");return e}function Ki(){return Ui}function Bi(){return"DEBUG"==Ui?new Date:Ci}function Xi(){var e=Bi(),t=e.getDate();t=t<10?"0"+String(t):String(t);var r=e.getMonth()+1;r=r<10?"0"+String(r):String(r);var _=String(e.getFullYear()),n=e.getHours();n=n<10?"0"+String(n):String(n);var a=e.getMinutes();a=a<10?"0"+String(a):String(a);var o=e.getSeconds();return t+"."+r+"."+_+" "+n+":"+a+":"+(o<10?"0"+String(o):String(o))}function Hi(){return"DEBUG"!=Ui?Fi:Xi().split(" ").join("").split(":").join("").split(".").join("")}var Qi=A("__renderer",function(e,t){var r=Ks(e),_=oE(e),n=Wo(e),a=_i(e),o=ws(e),i=oi(e),s=Zo(e),E=wi(e),c=ai(e),l=ys(e),T=!0,u=[1,0,0,1],d=[1,1,1,1],f=[0,0,0,1],P=[0,0,0,0],A=new Uint8Array([91.8,142.8,.96*255,255]),S=4,p=5,m=(new Float32Array([.25,-.25]),new Float32Array([-.25,.25]),new Float32Array([1,1,1,0]),new Float32Array([2,2,2,0]),15),O=null,v=0,N=null,g=null,h=null,R=null,I=null,b=new Float32Array(3),Y=Yr(),L=new Uint8Array(4),M=n.defaults;function x(e){for(var t=e.camera,_=e.draw_data,n=null,a=Ga(t.world_tsr,b),o=0;o<_.length;o++){var s=_[o];if(s.do_render){var E=s.shader,c=s.bundles;E.program!=n&&(O.useProgram(E.program),y(e,t,E),n=E.program),s.alpha_antialiasing?(O.enable(O.SAMPLE_ALPHA_TO_COVERAGE),e.blend||O.enable(O.BLEND)):(O.disable(O.SAMPLE_ALPHA_TO_COVERAGE),e.blend||O.disable(O.BLEND));for(var l=0;l<c.length;l++){var T=c[l];if(T.do_render){var u=T.obj_render,d=T.batch;i.start_batch(d),i.is_debug_view_render_time_mode()&&"DEBUG_VIEW"==d.type&&(d.debug_main_batch_render_time=Cn(r.batch_get_debug_storage(d.debug_main_batch_id),d.debug_main_batch_render_time,1,m)),M.alpha_sort&&d.z_sort&&C(d,u,T.info_for_z_sort_updates,a),U(e,u,d,E),i.stop_batch(d),i.is_debug_view_render_time_mode()&&"MAIN"==d.type&&r.batch_set_debug_storage(d.id,d.debug_render_time)}}}}}function y(e,t,r){for(var _=r.transient_sc_uniform_setters,n=_.length;n--;)(i=_[n]).fun(O,i.loc,e,t);if(r.need_uniforms_update&&!r.no_permanent_uniforms){r.permanent_sc_uniform_setters.length||k(r);for(var a=r.permanent_sc_uniform_setters,o=a.length;o--;){var i;(i=a[o]).fun(O,i.loc,e,t)}}}function w(e){if(e){if(!(r=(e.clear_color?O.COLOR_BUFFER_BIT:0)|(e.clear_depth?O.DEPTH_BUFFER_BIT:0)))return;switch(e.type){case c.MAIN_GLOW:var t=P;break;case c.SHADOW_CAST:t=u;break;case c.SHADOW_RECEIVE:t=d;break;case c.COLOR_PICKING:case c.COLOR_PICKING_XRAY:case c.ANCHOR_VISIBILITY:t=f;break;case c.MAIN_OPAQUE:case c.OUTLINE_MASK:case c.SMAA_BLENDING_WEIGHT_CALCULATION:case c.SMAA_EDGE_DETECTION:t=P;break;default:t=M.background_color}}else{var r=O.COLOR_BUFFER_BIT|O.DEPTH_BUFFER_BIT;t=M.background_color}O.colorMask(!0,!0,!0,!0),O.depthMask(!0),O.clearColor(t[0],t[1],t[2],t[3]),O.clear(r)}function U(e,t,r,_){for(var n=_.transient_uniform_setters,a=n.length;a--;)(s=n[a]).fun(O,s.loc,t,r);if(_.need_uniforms_update&&!_.no_permanent_uniforms){_.permanent_uniform_setters.length||k(_);for(var o=_.permanent_uniform_setters,i=o.length;i--;){var s;(s=o[i]).fun(O,s.loc,t,r)}_.need_uniforms_update=!1}O.depthMask(r.depth_mask),T&&(r.use_backface_culling?O.enable(O.CULL_FACE):O.disable(O.CULL_FACE)),function(e){for(var t=O,r=0;r<e.length;r++){var _=e[r];t.activeTexture(t.TEXTURE0+r),t.bindTexture(_.w_target,_.w_texture),_.use_mipmap&&t.generateMipmap(_.w_target)}}(r.textures),e.type==c.SKY||e.type==c.IRRADIANCE?(function(e,t,r){for(var _=r.uniforms,n=e.camera.color_attachment,a=n.w_texture,o=n.w_target,i=e.cube_view_matrices,s=0;s<6;s++){var E=F(s);M.clear_procedural_sky_hack?(O.bindTexture(O.TEXTURE_CUBE_MAP,a),O.texImage2D(E,0,O.RGBA,1,1,0,O.RGBA,O.UNSIGNED_BYTE,A)):(O.uniformMatrix4fv(_.u_cube_view_matrix,!1,i[s]),O.uniform4fv(_.u_sky_tex_fac,e.sky_tex_fac),O.uniform3fv(_.u_sky_tex_color,e.sky_tex_color),O.uniform1f(_.u_sky_tex_dvar,e.sky_tex_default_value),O.uniform3fv(_.u_horizon_color,e.horizon_color),O.uniform3fv(_.u_zenith_color,e.zenith_color),O.framebufferTexture2D(O.FRAMEBUFFER,O.COLOR_ATTACHMENT0,E,a,0),I(t,0)),e.need_fog_update&&s!=p&&D(e,s)}M.texture_lod_available&&(O.bindTexture(o,a),O.generateMipmap(o),O.texParameteri(o,O.TEXTURE_MIN_FILTER,l.TF_LINEAR_MIPMAP_LINEAR)),O.bindFramebuffer(O.FRAMEBUFFER,null)}(e,r,_),e.debug_render_calls+=6):e.type==c.ROUGHNESS_CONVOLUTION?(function(e,t,r){var _=r.uniforms,n=e.camera.color_attachment,a=n.w_texture,o=n.w_target,i=e.cube_view_matrices;M.texture_lod_available&&(O.activeTexture(O.TEXTURE7),O.bindTexture(o,a),O.generateMipmap(o),O.texParameteri(o,O.TEXTURE_MIN_FILTER,l.TF_LINEAR_MIPMAP_LINEAR));for(var s=0;s<5;++s){var E=128*Math.pow(.5,s),c=128*Math.pow(.5,s);O.viewport(0,0,E,c);for(var T=s/4,u=0;u<6;u++){var d=F(u);O.uniformMatrix4fv(_.u_cube_view_matrix,!1,i[u]),O.uniform1f(_.u_roughness,T),O.framebufferTexture2D(O.FRAMEBUFFER,O.COLOR_ATTACHMENT0,d,a,s),I(t,0)}}}(e,r,_),e.debug_render_calls+=30):(I(r,t.va_frame),e.debug_render_calls++)}function C(e,t,r,_){var n=e.bufs_data;(Ue(_,r.zsort_eye_last)>M.alpha_sort_threshold*Math.min(r.bb_min_side,1)||t.force_zsort)&&(E.update_buffers_movable(n,r,t.world_tsr,_),he(_,r.zsort_eye_last),t.force_zsort=!1)}function D(e,t){var r=L;M.clear_procedural_sky_hack?r.set(A):(O.readPixels(191,191,1,1,O.RGBA,O.UNSIGNED_BYTE,r),255!=r[0]&&255!=r[1]&&255!=r[2]||O.readPixels(191,220,1,1,O.RGBA,O.UNSIGNED_BYTE,r));var _=r[0],n=r[1],a=r[2];_/=255,n/=255,a/=255,t===S?(e.cube_fog[3]=_,e.cube_fog[7]=n,e.cube_fog[11]=a):(e.cube_fog[4*t]=_,e.cube_fog[4*t+1]=n,e.cube_fog[4*t+2]=a)}function F(e){switch(e){case 0:return O.TEXTURE_CUBE_MAP_POSITIVE_X;case 1:return O.TEXTURE_CUBE_MAP_NEGATIVE_X;case 2:return O.TEXTURE_CUBE_MAP_POSITIVE_Y;case 3:return O.TEXTURE_CUBE_MAP_NEGATIVE_Y;case 4:return O.TEXTURE_CUBE_MAP_POSITIVE_Z;case 5:return O.TEXTURE_CUBE_MAP_NEGATIVE_Z}}function G(e){var t=s.get_vertex_array_object(),r=e.attribute_setters,_=e.bufs_data,n=_.pointers;e.vaos.length=0;var a=1;for(var o in n)a=Math.max(a,n[o].frames);for(var i=0;i<a;i++){var E=t.createVertexArray();R(E),_.ibo&&O.bindBuffer(O.ELEMENT_ARRAY_BUFFER,_.ibo);for(var c=0;c<_.vbo_data.length;c++){O.bindBuffer(O.ARRAY_BUFFER,_.vbo_data[c].vbo);for(var l=0;l<r.length;l++){var T=r[l];T.vbo_type==_.vbo_data[c].type&&(O.enableVertexAttribArray(T.loc),O.vertexAttribPointer(T.loc,T.num_comp,T.gl_type,T.gl_type!=O.FLOAT,0,T.base_offset+T.frame_length*i),g(T.loc,T.divisor))}}R(null),e.vaos.push(E)}}function k(e){var t=e.uniforms,r=e.transient_uniform_setters,_=e.permanent_uniform_setters,n=e.transient_sc_uniform_setters,a=e.permanent_sc_uniform_setters;for(var o in r.length=0,_.length=0,n.length=0,a.length=0,t){var i=!1,s=null,E=null;switch(o){case"u_proj_matrix":s=function(e,t,r,_){e.uniformMatrix4fv(t,!1,_.proj_matrix)},i=!0;break;case"u_view_refl_matrix":s=function(e,t,r,_){e.uniformMatrix4fv(t,!1,_.view_refl_matrix)},i=!0;break;case"u_view_tsr":case"u_view_tsr_frag":s=function(e,t,r,_){e.uniformMatrix3fv(t,!1,_.reflection_plane?_.real_view_tsr:_.view_tsr)},i=!0;break;case"u_view_tsr_inverse":s=function(e,t,r,_){e.uniformMatrix3fv(t,!1,_.reflection_plane?_.real_view_tsr_inv:_.view_tsr_inv)},i=!0;break;case"u_shadow_cast_billboard_view_tsr":s=function(e,t,r,_){e.uniformMatrix3fv(t,!1,_.shadow_cast_billboard_view_tsr)},i=!0;break;case"u_view_proj_prev":s=function(e,t,r,_){e.uniformMatrix4fv(t,!1,_.prev_view_proj_matrix)},i=!0;break;case"u_view_proj_matrix":s=function(e,t,r,_){e.uniformMatrix4fv(t,!1,_.view_proj_matrix)},i=!0;break;case"u_view_proj_inverse":s=function(e,t,r,_){e.uniformMatrix4fv(t,!1,_.view_proj_inv_matrix)},i=!0;break;case"u_sky_vp_inverse":s=function(e,t,r,_){e.uniformMatrix4fv(t,!1,_.sky_vp_inv_matrix)},i=!0;break;case"u_camera_eye":case"u_camera_eye_frag":s=function(e,t,r,_){e.uniform3fv(t,Ga(_.world_tsr,b))},i=!0;break;case"u_camera_quat":s=function(e,t,r,_){e.uniform4fv(t,Xa(_.world_tsr,Y))},i=!0;break;case"u_view_max_depth":s=function(e,t,r,_){e.uniform1f(t,_.far)},i=!0;break;case"u_camera_range":s=function(e,t,r,_){e.uniform2f(t,_.near,_.far)},i=!0;break;case"u_csm_center_dists":s=function(e,t,r,_){e.uniform4fv(t,_.csm_center_dists)};break;case"u_height":s=function(e,t,r,_){e.uniform1f(t,_.height)},i=!0;break;case"u_pcf_blur_radii":s=function(e,t,r,_){e.uniform4fv(t,_.pcf_blur_radii)};break;case"u_dof_dist":s=function(e,t,r,_){e.uniform1f(t,_.dof_on?_.dof_distance:0)},i=!0;break;case"u_dof_front_start":s=function(e,t,r,_){e.uniform1f(t,_.dof_front_start)},i=!0;break;case"u_dof_front_end":s=function(e,t,r,_){e.uniform1f(t,_.dof_front_end)},i=!0;break;case"u_dof_rear_start":s=function(e,t,r,_){e.uniform1f(t,_.dof_rear_start)},i=!0;break;case"u_dof_rear_end":s=function(e,t,r,_){e.uniform1f(t,_.dof_rear_end)},i=!0;break;case"u_dof_bokeh_intensity":s=function(e,t,r,_){e.uniform1f(t,_.dof_bokeh_intensity)},i=!0;break;case"u_camera_direction":s=function(e,t,r,_){e.uniform3fv(t,_.direction)},i=!0;break;case"u_cam_water_depth":s=function(e,t,r,_){e.uniform1f(t,r.cam_water_depth)},i=!0;break;case"u_fog_color_density":s=function(e,t,r,_){e.uniform4fv(t,r.fog_color_density)};break;case"u_fog_params":s=function(e,t,r,_){e.uniform4fv(t,r.fog_params)};break;case"u_underwater_fog_color_density":s=function(e,t,r,_){e.uniform4fv(t,r.water_fog_color_density)};break;case"u_bloom_key":s=function(e,t,r,_){e.uniform1f(t,r.bloom_key)};break;case"u_average_lum_val":s=function(e,t,r,_){e.uniform1f(t,r.average_luminance)};break;case"u_mipmap_1x1":s=function(e,t,r,_){e.uniform1f(t,r.last_mip_map_ind)};break;case"u_bloom_edge_lum":s=function(e,t,r,_){e.uniform1f(t,r.bloom_edge_lum)};break;case"u_time":s=function(e,t,r,_){e.uniform1f(t,r.time)},i=!0;break;case"u_wind":s=function(e,t,r,_){e.uniform3fv(t,r.wind)},i=!0;break;case"u_sky_tex_dvar":s=function(e,t,r,_){e.uniform1f(t,r.sky_tex_default_value)};break;case"u_sky_tex_fac":s=function(e,t,r,_){e.uniform4fv(t,r.sky_tex_fac)};break;case"u_sky_tex_color":s=function(e,t,r,_){e.uniform3fv(t,r.sky_tex_color)};break;case"u_horizon_color":s=function(e,t,r,_){e.uniform3fv(t,r.horizon_color)};break;case"u_zenith_color":s=function(e,t,r,_){e.uniform3fv(t,r.zenith_color)};break;case"u_environment_energy":s=function(e,t,r,_){e.uniform1f(t,r.environment_energy)};break;case"u_bsdf_cube_sky_dim":s=function(e,t,r,_){e.uniform1f(t,r.bsdf_cube_sky_dim)},i=!0;break;case"u_sky_color":s=function(e,t,r,_){e.uniform3fv(t,r.sky_color)};break;case"u_rayleigh_brightness":s=function(e,t,r,_){e.uniform1f(t,r.rayleigh_brightness)};break;case"u_mie_brightness":s=function(e,t,r,_){e.uniform1f(t,r.mie_brightness)};break;case"u_spot_brightness":s=function(e,t,r,_){e.uniform1f(t,r.spot_brightness)};break;case"u_scatter_strength":s=function(e,t,r,_){e.uniform1f(t,r.scatter_strength)};break;case"u_rayleigh_strength":s=function(e,t,r,_){e.uniform1f(t,r.rayleigh_strength)};break;case"u_mie_strength":s=function(e,t,r,_){e.uniform1f(t,r.mie_strength)};break;case"u_rayleigh_collection_power":s=function(e,t,r,_){e.uniform1f(t,r.rayleigh_collection_power)};break;case"u_mie_collection_power":s=function(e,t,r,_){e.uniform1f(t,r.mie_collection_power)};break;case"u_mie_distribution":s=function(e,t,r,_){e.uniform1f(t,r.mie_distribution)};break;case"u_light_positions":s=function(e,t,r,_){e.uniform4fv(t,r.light_positions)};break;case"u_light_directions":s=function(e,t,r,_){e.uniform3fv(t,r.light_directions)};break;case"u_light_color_intensities":s=function(e,t,r,_){e.uniform4fv(t,r.light_color_intensities)};break;case"u_sun_quaternion":s=function(e,t,r,_){e.uniform4fv(t,r.sun_quaternion)};break;case"u_sun_intensity":s=function(e,t,r,_){e.uniform3fv(t,r.sun_intensity)};break;case"u_sun_direction":s=function(e,t,r,_){e.uniform3fv(t,r.sun_direction)};break;case"u_debug_view_mode":s=function(e,t,r,_){e.uniform1i(t,r.debug_view_mode)};break;case"u_debug_colors_seed":s=function(e,t,r,_){e.uniform1f(t,r.debug_colors_seed)};break;case"u_debug_render_time_threshold":s=function(e,t,r,_){e.uniform1f(t,r.debug_render_time_threshold)};break;case"u_subpixel_jitter":s=function(e,t,r,_){e.uniform2fv(t,r.jitter_projection_space)},i=!0;break;case"u_subsample_indices":s=function(e,t,r,_){e.uniform4fv(t,r.jitter_subsample_ind)},i=!0;break;case"u_radial_blur_step":s=function(e,t,r,_){e.uniform1f(t,r.radial_blur_step)};break;case"u_god_rays_intensity":s=function(e,t,r,_){e.uniform1f(t,r.god_rays_intensity)};break;case"u_ssao_radius_increase":s=function(e,t,r,_){e.uniform1f(t,r.ssao_radius_increase)};break;case"u_ssao_blur_discard_value":s=function(e,t,r,_){e.uniform1f(t,r.ssao_blur_discard_value)},i=!0;break;case"u_ssao_influence":s=function(e,t,r,_){e.uniform1f(t,r.ssao_influence)};break;case"u_ssao_dist_factor":s=function(e,t,r,_){e.uniform1f(t,r.ssao_dist_factor)};break;case"u_texel_size":s=function(e,t,r,_){e.uniform2fv(t,r.texel_size)},i=!0;break;case"u_normal_offset":s=function(e,t,r,_){e.uniform1f(t,r.self_shadow_normal_offset)};break;case"u_v_light_ts":s=function(e,t,r,_){e.uniform4fv(t,r.v_light_ts)},i=!0;break;case"u_v_light_r":s=function(e,t,r,_){e.uniform4fv(t,r.v_light_r)},i=!0;break;case"u_v_light_tsr":s=function(e,t,r,_){e.uniformMatrix3fv(t,!1,r.v_light_tsr)},i=!0;break;case"u_p_light_matrix0":s=function(e,t,r,_){e.uniformMatrix4fv(t,!1,r.p_light_matrix[0])},i=!0;break;case"u_p_light_matrix1":s=function(e,t,r,_){e.uniformMatrix4fv(t,!1,r.p_light_matrix[1])},i=!0;break;case"u_p_light_matrix2":s=function(e,t,r,_){e.uniformMatrix4fv(t,!1,r.p_light_matrix[2])},i=!0;break;case"u_p_light_matrix3":s=function(e,t,r,_){e.uniformMatrix4fv(t,!1,r.p_light_matrix[3])},i=!0;break;case"u_outline_color":s=function(e,t,r,_){e.uniform3fv(t,r.outline_color)};break;case"u_draw_outline":s=function(e,t,r,_){e.uniform1f(t,r.draw_outline_flag)},i=!0;break;case"u_glow_mask_small_coeff":s=function(e,t,r,_){e.uniform1f(t,r.small_glow_mask_coeff)},i=!0;break;case"u_glow_mask_large_coeff":s=function(e,t,r,_){e.uniform1f(t,r.large_glow_mask_coeff)},i=!0;break;case"u_brightness":s=function(e,t,r,_){e.uniform1f(t,r.brightness)};break;case"u_contrast":s=function(e,t,r,_){e.uniform1f(t,r.contrast)};break;case"u_exposure":s=function(e,t,r,_){e.uniform1f(t,r.exposure)};break;case"u_saturation":s=function(e,t,r,_){e.uniform1f(t,r.saturation)};break;case"u_enable_hmd_stereo":s=function(e,t,r,_){e.uniform1i(t,r.enable_hmd_stereo)};break;case"u_distortion_params":s=function(e,t,r,_){e.uniform4fv(t,r.distortion_params)};break;case"u_chromatic_aberration_coefs":s=function(e,t,r,_){e.uniform4fv(t,r.chromatic_aberration_coefs)};break;case"u_motion_blur_exp":s=function(e,t,r,_){e.uniform1f(t,r.motion_blur_exp)},i=!0;break;case"u_motion_blur_decay_threshold":s=function(e,t,r,_){e.uniform1f(t,r.mb_decay_threshold)},i=!0;break;case"u_model_tsr":E=function(e,t,r,_){e.uniformMatrix3fv(t,!1,r.world_tsr)},i=!0;break;case"u_model_tsr_inverse":E=function(e,t,r,_){e.uniformMatrix3fv(t,!1,r.world_tsr_inv)},i=!0;break;case"u_transb":E=function(e,t,r,_){e.uniform4fv(t,r.trans_before)},i=!0;break;case"u_transa":E=function(e,t,r,_){e.uniform4fv(t,r.trans_after)},i=!0;break;case"u_arm_rel_trans":E=function(e,t,r,_){e.uniform4fv(t,r.arm_rel_trans)},i=!0;break;case"u_arm_rel_quat":E=function(e,t,r,_){e.uniform4fv(t,r.arm_rel_quat)},i=!0;break;case"u_quat":E=function(e,t,r,_){e.uniform4fv(t,Xa(r.world_tsr,Y))},i=!0;break;case"u_quatsb":E=function(e,t,r,_){e.uniform4fv(t,r.quats_before)},i=!0;break;case"u_quatsa":E=function(e,t,r,_){e.uniform4fv(t,r.quats_after)},i=!0;break;case"u_frame_factor":E=function(e,t,r,_){e.uniform1f(t,r.frame_factor)},i=!0;break;case"au_center_pos":E=function(e,t,r,_){e.uniform3fv(t,r.center_pos)},i=!0;break;case"au_wind_bending_amp":E=function(e,t,r,_){e.uniform1f(t,r.wind_bending_amp)},i=!0;break;case"au_wind_bending_freq":E=function(e,t,r,_){e.uniform1f(t,r.wind_bending_freq)},i=!0;break;case"au_detail_bending_freq":E=function(e,t,r,_){e.uniform1f(t,r.detail_bending_freq)},i=!0;break;case"au_detail_bending_amp":E=function(e,t,r,_){e.uniform1f(t,r.detail_bending_amp)},i=!0;break;case"au_branch_bending_amp":E=function(e,t,r,_){e.uniform1f(t,r.branch_bending_amp)},i=!0;break;case"u_node_values":E=function(e,t,r,_){e.uniform4fv(t,_.node_values)},i=!0;break;case"u_node_rgbs":E=function(e,t,r,_){e.uniform3fv(t,_.node_rgbs)},i=!0;break;case"u_lod_coverage":E=function(e,t,r,_){e.uniform1f(t,_.lod_settings.coverage)},i=!0;break;case"u_lod_cmp_logic":E=function(e,t,r,_){e.uniform1f(t,_.lod_settings.cmp_logic)},i=!0;break;case"u_diffuse_color":E=function(e,t,r,_){e.uniform4fv(t,_.diffuse_color)},i=!0;break;case"u_diffuse_intensity":E=function(e,t,r,_){e.uniform1f(t,_.diffuse_intensity)},i=!0;break;case"u_diffuse_params":E=function(e,t,r,_){e.uniform2fv(t,_.diffuse_params)},i=!0;break;case"u_emit":E=function(e,t,r,_){e.uniform1f(t,_.emit)},i=!0;break;case"u_ambient":E=function(e,t,r,_){e.uniform1f(t,_.ambient)},i=!0;break;case"u_specular_color":E=function(e,t,r,_){e.uniform3fv(t,_.specular_color)},i=!0;break;case"u_specular_alpha":E=function(e,t,r,_){e.uniform1f(t,_.specular_alpha)},i=!0;break;case"u_specular_params":E=function(e,t,r,_){e.uniform3fv(t,_.specular_params)},i=!0;break;case"u_reflect_factor":E=function(e,t,r,_){e.uniform1f(t,_.reflect_factor)},i=!0;break;case"u_mirror_factor":E=function(e,t,r,_){e.uniform1f(t,_.mirror_factor)},i=!0;break;case"u_grass_map_dim":E=function(e,t,r,_){e.uniform3fv(t,_.grass_map_dim)},i=!0;break;case"u_grass_size":E=function(e,t,r,_){e.uniform1f(t,_.grass_size)},i=!0;break;case"u_scale_threshold":E=function(e,t,r,_){e.uniform1f(t,_.grass_scale_threshold)},i=!0;break;case"u_cube_fog":E=function(e,t,r,_){e.uniformMatrix4fv(t,!1,_.cube_fog)};break;case"u_jitter_amp":E=function(e,t,r,_){e.uniform1f(t,_.jitter_amp)},i=!0;break;case"u_jitter_freq":E=function(e,t,r,_){e.uniform1f(t,_.jitter_freq)},i=!0;break;case"u_wireframe_edge_color":E=function(e,t,r,_){e.uniform3fv(t,_.wireframe_edge_color)};break;case"u_cluster_id":E=function(e,t,r,_){e.uniform1f(t,_.cluster_id)},i=!0;break;case"u_batch_debug_id_color":E=function(e,t,r,_){e.uniform1f(t,_.debug_id_color)},i=!0;break;case"u_batch_debug_main_render_time":E=function(e,t,r,_){e.uniform1f(t,_.debug_main_batch_render_time)},i=!0;break;case"u_refr_bump":E=function(e,t,r,_){e.uniform1f(t,_.refr_bump)},i=!0;break;case"u_line_width":E=function(e,t,r,_){e.uniform1f(t,_.line_width)},i=!0;break;case"u_lamp_light_positions":E=function(e,t,r,_){e.uniform3fv(t,_.lamp_light_positions)};break;case"u_lamp_light_directions":E=function(e,t,r,_){e.uniform3fv(t,_.lamp_light_directions)};break;case"u_lamp_light_color_intensities":E=function(e,t,r,_){e.uniform3fv(t,_.lamp_light_color_intensities)};break;case"u_halo_size":E=function(e,t,r,_){e.uniform1f(t,_.halo_size)},i=!0;break;case"u_halo_hardness":E=function(e,t,r,_){e.uniform1f(t,_.halo_hardness)},i=!0;break;case"u_halo_rings_color":E=function(e,t,r,_){e.uniform3fv(t,_.halo_rings_color)},i=!0;break;case"u_halo_lines_color":E=function(e,t,r,_){e.uniform3fv(t,_.halo_lines_color)},i=!0;break;case"u_halo_stars_blend":E=function(e,t,r,_){e.uniform1f(t,_.halo_stars_blend)},i=!0;break;case"u_halo_stars_height":E=function(e,t,r,_){e.uniform1f(t,_.halo_stars_height)},i=!0;break;case"u_fresnel_params":E=function(e,t,r,_){e.uniform2fv(t,_.fresnel_params)},i=!0;break;case"u_texture_scale":E=function(e,t,r,_){e.uniform3fv(t,_.texture_scale)},i=!0;break;case"u_parallax_scale":E=function(e,t,r,_){e.uniform1f(t,_.parallax_scale)},i=!0;break;case"u_color_id":E=function(e,t,r,_){e.uniform3fv(t,r.color_id)},i=!0;break;case"u_diffuse_color_factor":E=function(e,t,r,_){e.uniform1f(t,_.diffuse_color_factor)},i=!0;break;case"u_alpha_factor":E=function(e,t,r,_){e.uniform1f(t,_.alpha_factor)},i=!0;break;case"u_specular_color_factor":E=function(e,t,r,_){e.uniform1f(t,_.specular_color_factor)},i=!0;break;case"u_normal_factor":E=function(e,t,r,_){e.uniform1f(t,_.normal_factor)},i=!0;break;case"u_normalmap0_scale":E=function(e,t,r,_){e.uniform2fv(t,_.normalmap_scales[0])},i=!0;break;case"u_normalmap1_scale":E=function(e,t,r,_){e.uniform2fv(t,_.normalmap_scales[1])},i=!0;break;case"u_normalmap2_scale":E=function(e,t,r,_){e.uniform2fv(t,_.normalmap_scales[2])},i=!0;break;case"u_normalmap3_scale":E=function(e,t,r,_){e.uniform2fv(t,_.normalmap_scales[3])},i=!0;break;case"u_foam_factor":E=function(e,t,r,_){e.uniform1f(t,_.foam_factor)},i=!0;break;case"u_foam_uv_freq":E=function(e,t,r,_){e.uniform2fv(t,_.foam_uv_freq)},i=!0;break;case"u_foam_mag":E=function(e,t,r,_){e.uniform2fv(t,_.foam_mag)},i=!0;break;case"u_foam_scale":E=function(e,t,r,_){e.uniform2fv(t,_.foam_scale)},i=!0;break;case"u_water_norm_uv_velocity":E=function(e,t,r,_){e.uniform1f(t,_.water_norm_uv_velocity)},i=!0;break;case"u_shallow_water_col":E=function(e,t,r,_){e.uniform3fv(t,_.shallow_water_col)},i=!0;break;case"u_shore_water_col":E=function(e,t,r,_){e.uniform3fv(t,_.shore_water_col)},i=!0;break;case"u_water_shallow_col_fac":E=function(e,t,r,_){e.uniform1f(t,_.shallow_water_col_fac)},i=!0;break;case"u_water_shore_col_fac":E=function(e,t,r,_){e.uniform1f(t,_.shore_water_col_fac)},i=!0;break;case"u_p_length":E=function(e,t,r,_){e.uniform1f(t,_.particles_data.time_length)},i=!0;break;case"u_p_cyclic":E=function(e,t,r,_){e.uniform1i(t,_.particles_data.cyclic)},i=!0;break;case"u_p_max_lifetime":E=function(e,t,r,_){e.uniform1f(t,_.particles_data.lifetime)},i=!0;break;case"u_p_fade_in":E=function(e,t,r,_){e.uniform1f(t,_.particles_data.fade_in)},i=!0;break;case"u_p_fade_out":E=function(e,t,r,_){e.uniform1f(t,_.particles_data.fade_out)},i=!0;break;case"u_p_size":E=function(e,t,r,_){e.uniform1f(t,_.particles_data.size)},i=!0;break;case"u_p_alpha_start":E=function(e,t,r,_){e.uniform1f(t,_.particles_data.alpha_start)},i=!0;break;case"u_p_alpha_end":E=function(e,t,r,_){e.uniform1f(t,_.particles_data.alpha_end)},i=!0;break;case"u_p_nfactor":E=function(e,t,r,_){e.uniform1f(t,_.particles_data.nfactor)},i=!0;break;case"u_p_gravity":E=function(e,t,r,_){e.uniform1f(t,_.particles_data.gravity)},i=!0;break;case"u_p_mass":E=function(e,t,r,_){e.uniform1f(t,_.particles_data.mass)},i=!0;break;case"u_p_color_ramp":E=function(e,t,r,_){e.uniform4fv(t,_.particles_data.color_ramp)},i=!0;break;case"u_p_wind_fac":E=function(e,t,r,_){e.uniform1f(t,_.particles_data.wind_factor)},i=!0;break;case"u_p_time":E=function(e,t,r,_){e.uniform1f(t,_.particles_data.time)},i=!0;break;case"u_p_tilt":E=function(e,t,r,_){e.uniform1f(t,_.particles_data.tilt)},i=!0;break;case"u_p_tilt_rand":E=function(e,t,r,_){e.uniform1f(t,_.particles_data.tilt_rand)},i=!0;break;case"u_position":E=function(e,t,r,_){e.uniform3fv(t,_.anchor_positions)},i=!0;break;case"u_va_frame_factor":E=function(e,t,r,_){e.uniform1f(t,r.va_frame_factor)},i=!0;break;case"u_refl_plane":E=function(e,t,r,_){e.uniform4fv(t,r.reflection_plane)},i=!0;break;case"u_outline_intensity":E=function(e,t,r,_){e.uniform1f(t,r.outline_intensity)},i=!0;break;case"u_obj_info":E=function(e,t,r,_){e.uniform3fv(t,_.obj_info_params)},i=!0}if(E){var c={name:o,fun:E,loc:t[o]};i?r.push(c):_.push(c)}s&&(c={name:o,fun:s,loc:t[o]},i?n.push(c):a.push(c))}if(_.length||a.length){var l=e.permanent_uniform_setters_table;for(var T in l)delete l[T];for(T=0;T<_.length;T++)l[(c=_[T]).name]=c;for(T=0;T<a.length;T++)l[(c=a[T]).name]=c}else e.no_permanent_uniforms=!0}t.setup_context=function(e){var t=M.background_color;e.clearColor(t[0],t[1],t[2],t[3]),e.clearDepth(1),e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),T?(e.enable(e.CULL_FACE),e.frontFace(e.CCW),e.cullFace(e.BACK)):e.disable(e.CULL_FACE),e.enable(e.BLEND),e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA),O=e},t.draw=function(e){e.do_render&&!e.force_do_not_render&&(e.type==c.RESOLVE?(i.start_subs(e),function(e){var t=e.camera;O.bindFramebuffer(O.READ_FRAMEBUFFER,t.framebuffer_prev),O.bindFramebuffer(O.DRAW_FRAMEBUFFER,t.framebuffer);var r=0;t.color_attachment&&(r|=O.COLOR_BUFFER_BIT),t.depth_attachment&&(r|=O.DEPTH_BUFFER_BIT),O.blitFramebuffer(0,0,t.width,t.height,0,0,t.width,t.height,r,O.NEAREST)}(e),i.stop_subs(e),o.gl("draw resolve")):e.type==c.COPY?(i.start_subs(e),function(e){var t=e.camera;O.bindFramebuffer(O.FRAMEBUFFER,t.framebuffer_prev),O.bindTexture(O.TEXTURE_2D,t.color_attachment.w_texture),O.copyTexSubImage2D(O.TEXTURE_2D,0,0,0,0,0,t.width,t.height,0)}(e),i.stop_subs(e),o.gl("draw copy")):(i.start_subs(e),function(e){var t=e.camera;if(O.bindFramebuffer(O.FRAMEBUFFER,t.framebuffer),e.assign_texture){var r=t.color_attachment;O.framebufferTexture2D(O.FRAMEBUFFER,O.COLOR_ATTACHMENT0,r.w_target,r.w_texture,0)}switch(O.viewport(0,0,t.width,t.height),e.type!=c.MAIN_CUBE_REFLECT&&e.type!=c.MAIN_CUBE_REFLECT_BLEND&&w(e),e.blend?O.enable(O.BLEND):O.disable(O.BLEND),e.depth_test?O.enable(O.DEPTH_TEST):O.disable(O.DEPTH_TEST),e.type){case c.SHADOW_CAST:O.enable(O.POLYGON_OFFSET_FILL),O.polygonOffset(e.self_shadow_polygon_offset,e.self_shadow_polygon_offset),O.cullFace(O.BACK);break;case c.MAIN_PLANE_REFLECT:case c.MAIN_PLANE_REFLECT_BLEND:O.disable(O.POLYGON_OFFSET_FILL),O.cullFace(O.FRONT);break;case c.DEBUG_VIEW:O.enable(O.POLYGON_OFFSET_FILL),O.polygonOffset(-4,-4),O.cullFace(O.BACK);break;case c.MAIN_GLOW:if(M.msaa_samples>1||M.safari_glow_hack){O.enable(O.POLYGON_OFFSET_FILL),O.polygonOffset(-2,-2);break}default:O.disable(O.POLYGON_OFFSET_FILL),O.cullFace(O.BACK)}}(e),e.type==c.MAIN_CUBE_REFLECT||e.type==c.MAIN_CUBE_REFLECT_BLEND?function(e){for(var t=e.camera,r=t.color_attachment.w_texture,n=0;n<6;n++){var a=F(n);t.view_matrix=e.cube_view_matrices[n],za(t.view_matrix,t.view_tsr),_.calc_sky_vp_inverse(t),O.framebufferTexture2D(O.FRAMEBUFFER,O.COLOR_ATTACHMENT0,a,r,0),w(e);for(var o=e.draw_data,i=0;i<o.length;i++)for(var s=0;s<o[i].bundles.length;s++){var E=o[i].bundles[s];E.do_render=E.do_render_cube[n]}x(e)}}(e):x(e),i.stop_subs(e),o.gl("draw subscene: "+c.subs_label(e)),e.type==c.BRDF&&O.bindFramebuffer(O.FRAMEBUFFER,null)))},t.clear=function(e){if(e)O.bindFramebuffer(O.FRAMEBUFFER,e.camera.framebuffer);else{var t=M.background_color;if(t[0]===P[0]&&t[1]===P[1]&&t[2]===P[2]&&t[3]===P[3])return}w(e)},t.assign_attribute_setters=function(e){var t=e.attribute_setters;t.length=0;var r=e.bufs_data,_=r.pointers,n=e.shader.attributes;for(var o in n){var i=_[o],s=E.get_vbo_type_by_attr_name(o),c=E.get_gl_type_by_attr_name(o),l=E.get_type_size_by_attr_name(o);t.push({vbo_type:s,gl_type:c,loc:n[o],base_offset:i.offset*l,frame_length:i.frames>1?i.length*l:0,num_comp:i.num_comp,divisor:i.divisor})}if("DEBUG"==Ki())for(var o in _){s=E.get_vbo_type_by_attr_name(o);var T=E.search_vbo_index_by_type(r.vbo_data,s),u=r.vbo_data[T],d=e.shaders_info.vert+" | "+e.shaders_info.frag,f=_[o].length*_[o].frames*E.get_type_size_by_attr_name(o);a.fill_vbo_garbage_info(u.debug_id,d,o,f,o in n)}M.allow_vao_ext&&G(e)},t.assign_vao=G,t.cleanup_vao=function(e){for(var t=s.get_vertex_array_object(),r=0;r<e.vaos.length;r++)t.deleteVertexArray(e.vaos[r]);e.vaos.length=0},t.clone_attribute_setters=function(e){for(var t=[],r=0;r<e.length;r++){var _=e[r];t.push({vbo_type:_.vbo_type,gl_type:_.gl_type,loc:_.loc,base_offset:_.base_offset,frame_length:_.frame_length,num_comp:_.num_comp,divisor:_.divisor})}return t},t.assign_uniform_setters=k,t.assign_texture_uniforms=function(e){var t=e.shader,r=e.textures,_=e.texture_names;O.useProgram(t.program);for(var n=0;n<r.length;n++)O.uniform1i(t.uniforms[_[n]],n)},t.read_pixels=function(e,t,r,_,n,a){return O.bindFramebuffer(O.FRAMEBUFFER,e),O.readPixels(t,r,_,n,O.RGBA,O.UNSIGNED_BYTE,a),O.bindFramebuffer(O.FRAMEBUFFER,null),a},t.update_batch_permanent_uniform=function(e,t){var r=e.shader;if(!r.no_permanent_uniforms){O.useProgram(r.program),r.permanent_uniform_setters.length||k(r);var _=r.permanent_uniform_setters_table[t];_.fun(O,_.loc,null,e)}},t.render_target_create=function(e,t){var r=O.createFramebuffer();if(O.bindFramebuffer(O.FRAMEBUFFER,r),l.is_renderbuffer(e))O.framebufferRenderbuffer(O.FRAMEBUFFER,O.COLOR_ATTACHMENT0,O.RENDERBUFFER,e.w_renderbuffer);else if(l.is_texture(e)){var _=(n=e).w_texture;O.framebufferTexture2D(O.FRAMEBUFFER,O.COLOR_ATTACHMENT0,n.w_target==O.TEXTURE_CUBE_MAP?O.TEXTURE_CUBE_MAP_NEGATIVE_Z:n.w_target,_,0)}if(l.is_renderbuffer(t))O.framebufferRenderbuffer(O.FRAMEBUFFER,O.DEPTH_ATTACHMENT,O.RENDERBUFFER,t.w_renderbuffer);else if(l.is_texture(t)){var n;O.framebufferTexture2D(O.FRAMEBUFFER,O.DEPTH_ATTACHMENT,(n=t).w_target,_=n.w_texture,0)}return o.bound_fb(),O.bindFramebuffer(O.FRAMEBUFFER,null),r},t.render_target_cleanup=function(e,t,r,_,n){if(null==e)return O.bindFramebuffer(O.FRAMEBUFFER,e),O.viewport(0,0,_,n),void O.clear(O.COLOR_BUFFER_BIT|O.DEPTH_BUFFER_BIT);l.is_renderbuffer(t)?O.deleteRenderbuffer(t.w_renderbuffer):l.is_texture(t)&&O.deleteTexture(t.w_texture),l.is_renderbuffer(r)?O.deleteRenderbuffer(r.w_renderbuffer):l.is_texture(r)&&O.deleteTexture(r.w_texture),O.deleteFramebuffer(e)},t.increment_subpixel_index=function(){v=(v+1)%2},t.draw_resized_cubemap_texture=function(e,t,_,n,a,o){var i=e.w_texture;O.viewport(0,0,_,_),O.framebufferTexture2D(O.FRAMEBUFFER,O.COLOR_ATTACHMENT0,t,i,0);var s=r.create_postprocessing_batch("FLIP_CUBEMAP_COORDS"),E=s.shader;O.activeTexture(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,a);var c=0,l=0;_!=n&&(c=1/(6*n),l=1/(4*n)),O.uniform1i(E.uniforms.u_tex_number,o),O.uniform2fv(E.uniforms.u_delta,[c,l]),O.useProgram(E.program),I(s,0),O.bindTexture(O.TEXTURE_2D,null)},t.draw_resized_texture=function(e,t,_,n,a,o){O.bindFramebuffer(O.FRAMEBUFFER,n);var i=e.w_texture,s=e.w_target;O.bindTexture(s,i),O.viewport(0,0,t,_),O.texImage2D(s,0,O.RGBA,t,_,0,O.RGBA,O.UNSIGNED_BYTE,null),O.framebufferTexture2D(O.FRAMEBUFFER,O.COLOR_ATTACHMENT0,s,i,0);var E=r.create_postprocessing_batch(o),c=E.shader;O.activeTexture(O.TEXTURE0),O.bindTexture(s,a),O.useProgram(c.program),I(E,0),O.bindFramebuffer(O.FRAMEBUFFER,null),O.bindTexture(s,null)},t.cleanup=function(){v=0},t.set_draw_methods=function(){var e=s.get_instanced_arrays(),t=s.get_vertex_array_object();M.allow_instanced_arrays_ext=!!e,M.allow_vao_ext=!!t,e?(N=function(t,r,_,n){e.drawElementsInstanced(O.TRIANGLES,t,r,_,n)},g=function(t,r){e.vertexAttribDivisor(t,r)},h=function(t,r,_){e.drawArraysInstanced(O.TRIANGLES,t,r,_)}):(N=function(e,t,r){O.drawElements(O.TRIANGLES,e,t,r)},g=function(e,t){},h=function(e,t,r){O.drawArrays(O.TRIANGLES,e,t)}),t?(R=function(e){t.bindVertexArray(e)},I=function(e,t){var r=e.bufs_data;R(e.vaos[t]),r.ibo?N(r.count,r.ibo_type,0,r.instance_count):h(0,r.count,r.instance_count),R(null)}):I=function(e,t){for(var r=e.bufs_data,_=e.attribute_setters,n=0;n<r.vbo_data.length;n++){O.bindBuffer(O.ARRAY_BUFFER,r.vbo_data[n].vbo);for(var a=0;a<_.length;a++)(o=_[a]).vbo_type==r.vbo_data[n].type&&(O.enableVertexAttribArray(o.loc),O.vertexAttribPointer(o.loc,o.num_comp,o.gl_type,o.gl_type!=O.FLOAT,0,o.base_offset+o.frame_length*t),g(o.loc,o.divisor))}for(r.ibo?(O.bindBuffer(O.ELEMENT_ARRAY_BUFFER,r.ibo),N(r.count,r.ibo_type,0,r.instance_count)):h(0,r.count,r.instance_count),n=0;n<_.length;n++){var o;O.disableVertexAttribArray((o=_[n]).loc)}}},t.reset=function(){O=null,N=null,g=null,h=null,R=null}}),zi=ba(),Vi=ba(),ji=new Float32Array(4),qi=new Float32Array(4),Wi=new Float32Array(4);function Ji(e,t,r,_,n){var a=e.render,o=a.frame_factor,i=a.bone_pointers[t],s=i.bone_index,E=i.tsr_local_rest,c=ji,l=a.trans_before,T=a.trans_after,u=a.quats_before,d=a.quats_after,f=l[4*s+1],P=l[4*s+2],A=l[4*s+3],S=T[4*s+1],p=T[4*s+2],m=T[4*s+3];c[0]=(1-o)*l[4*s]+o*T[4*s],c[1]=(1-o)*f+o*S,c[2]=(1-o)*P+o*p,c[3]=(1-o)*A+o*m;var O=qi,v=Wi;O[0]=u[4*s],O[1]=u[4*s+1],O[2]=u[4*s+2],O[3]=u[4*s+3],v[0]=d[4*s],v[1]=d[4*s+1],v[2]=d[4*s+2],v[3]=d[4*s+3],Xr(O,v,o,O);var N=zi;if(Ca(c,N),Da(O,N),r){var g=Vi;to(E,i.tail,g),Va(N,g,N)}else Va(N,E,N);if(_){var h=i.parent_bone_ptr;if(h){var R=Vi;Ha(h.tsr_local_pose,R),Va(R,N,N)}var I=Vi;Ha(i.tsr_bone_rest,I),Va(I,N,N)}Ma(N,n)}function Zi(e,t,r,_){var n=e.render,a=n.bone_pointers[t],o=n.trans_before,i=n.quats_before;_?Va(a.tsr_bone_rest,r,a.tsr_bone_pose):Ma(r,a.tsr_local_pose),es(a,_,o,i),n.frame_factor=0,$i(e)}function $i(e){for(var t=e.render,r=t.skinned_renders,_=t.mesh_to_arm_bone_maps,n=0;n<r.length;n++){for(var a=r[n],o=_[n],i=0;i<o.length;i+=2)for(var s=o[i],E=o[i+1],c=0;c<4;c++)a.quats_before[s+c]=t.quats_before[E+c],a.quats_after[s+c]=t.quats_after[E+c],a.trans_before[s+c]=t.trans_before[E+c],a.trans_after[s+c]=t.trans_after[E+c];a.frame_factor=t.frame_factor}}function es(e,t,r,_){var n=e.tsr_bone_pose,a=e.tsr_local_rest,o=e.tsr_local_pose,i=e.parent_bone_ptr;if(i){var s=i.tsr_local_pose;if(t)Va(s,n,o);else{var E=Vi;Ha(s,E),Va(E,o,n)}}else t?Ma(n,o):Ma(o,n);var c=zi;Ha(a,c),Va(o,c,c);var l=e.bone_index;r[4*l]=c[0],r[4*l+1]=c[1],r[4*l+2]=c[2],r[4*l+3]=c[3],_[4*l]=c[4],_[4*l+1]=c[5],_[4*l+2]=c[6],_[4*l+3]=c[7];for(var T=e.descend_bones_ptrs,u=0;u<T.length;u++){var d=T[u];d.constraint||es(d,!0,r,_)}}function ts(e,t){return t in e.render.bone_pointers}var rs=new Float32Array(3);function _s(e,t){e.color[0]=t[0],e.color[1]=t[1],e.color[2]=t[2],as(e)}function ns(e,t){e.energy=t,as(e)}function as(e){ye(e.color,e.energy,e.color_intensity)}var os=A("__obj_util",function(e,t){var r=Wo(e).defaults,_=1/0;function n(e){var t={type:e,data_id:0,world_tsr:La(),world_tsr_inv:La(),pivot:new Float32Array(3),hover_pivot:new Float32Array(3),init_dist:0,init_fov:0,is_copied:!1,is_copied_deep:!1,color_id:null,outline_intensity:0,target_cam_upside_down:!1,vertical_axis:ve(),use_panning:!1,move_style:0,velocity_trans:1,velocity_rot:1,velocity_zoom:1,dof_distance:0,dof_front_start:0,dof_front_end:0,dof_rear_start:0,dof_rear_end:0,dof_power:0,dof_bokeh_intensity:0,dof_bokeh:!1,dof_foreground_blur:!1,dof_object:null,horizontal_limits:null,vertical_limits:null,distance_limits:null,hover_vert_trans_limits:null,hover_horiz_trans_limits:null,pivot_limits:null,enable_hover_hor_rotation:!0,outline_anim_settings_default:{outline_duration:1,outline_period:1,outline_relapses:0},cube_reflection_id:-1,plane_reflection_id:-1,reflection_plane:new Float32Array(4),friction:0,elasticity:0,is_lod:!1,lod_center:new Float32Array(3),main_lod_offset:new Float32Array(3),lod_dist_min:0,lod_dist_max:_,lod_lower_border_range:0,lod_upper_border_range:0,do_not_render:!1,shadow_cast:!1,shadow_receive:!1,shadow_cast_only:!1,reflexible:!1,reflexible_only:!1,reflective:!1,reflection_type:"",wind_bending:!1,dynamic_geometry:!1,dynamic_grass:!1,hide:!1,hide_children:!1,selectable:!1,origin_selectable:!1,outlining:!1,origin_outlining:!1,outline_on_select:!1,is_hair_particles:!1,is_visible:!1,force_zsort:!1,wind_bending_angle:0,wind_bending_amp:0,wind_bending_freq:0,detail_bending_freq:0,detail_bending_amp:0,branch_bending_amp:0,main_bend_col:"",detail_bend_col:{leaves_stiffness:"",leaves_phase:"",overall_stiffness:""},bend_center_only:!1,center_pos:new Float32Array(3),billboard:!1,billboard_pres_glob_orientation:!1,billboard_type:"",billboard_spherical:!1,frame_factor:0,va_frame:0,va_frame_factor:0,max_bones:0,frames_blending:!1,vertex_anim:!1,use_shape_keys:!1,shape_keys_values:[],is_skinning:!1,anim_mixing:!1,anim_mix_factor:1,anim_mix_factor_change_speed:0,anim_destination_mix_factor:1,anim_mix_cb:null,mix_with_current:!1,blend_skel_slots:new Int8Array([-1,-1]),skinned_renders:[],mesh_to_arm_bone_maps:[],skinning_data_cache:[],quats_before:null,quats_after:null,trans_before:null,trans_after:null,trans_curr:null,quats_curr:null,bone_pointers:null,bone_skinning_info:null,pose_data:null,arm_rel_trans:null,arm_rel_quat:null,bb_original:{max_x:0,min_x:0,max_y:0,min_y:0,max_z:0,min_z:0},bb_local:{max_x:0,min_x:0,max_y:0,min_y:0,max_z:0,min_z:0},bb_world:{max_x:0,min_x:0,max_y:0,min_y:0,max_z:0,min_z:0},bs_local:Yo(),bs_world:Yo(),be_local:Mo(),be_world:Mo(),bbr_local:po(),bbr_world:po(),bcyl_local:Go(),bcap_local:Go(),bcon_local:Go(),pass_index:0};return he(S_,t.vertical_axis),t}function a(e){return{scene:e,is_active:!1,batches:[],batch_world_bounds:[],plane_refl_subs:[],cube_refl_subs:null,shadow_subscenes:[],light_index:0,obj_has_nla_on_scene:!1,cameras:[],shadow_cameras:[]}}function o(e){return e.is_dynamic}function i(e,t){So(t,e.bb_local),No(e.bb_local,e.world_tsr,e.bb_world)}function s(e,t,r){e.bs_local=bo(t,r),ho(e.bs_local,e.world_tsr,e.bs_world)}function E(e,t,r,_,n,a){e.be_local=yo(t,r,_,a),ye(e.be_local.axis_x,n[0],e.be_local.axis_x),ye(e.be_local.axis_y,n[1],e.be_local.axis_y),ye(e.be_local.axis_z,n[2],e.be_local.axis_z),Ro(e.be_local,e.world_tsr,e.be_world)}function c(e,t,r,_){e.bcyl_local=Ko(t,_),e.bcap_local=ko(r,_),e.bcon_local=Bo(t,_)}function l(e,t,r,_,n,a){var o,i,s,E,c;e.bbr_local=(o=t,i=r,s=_,E=n,he(a,(c=po()).center),he(o,c.axis_x),he(i,c.axis_y),he(s,c.axis_z),ye(c.axis_x,E[0],c.axis_x),ye(c.axis_y,E[1],c.axis_y),ye(c.axis_z,E[2],c.axis_z),c),Io(e.bbr_local,e.world_tsr,e.bbr_world)}function T(e,t,r){No(e.bounds_local.bb,t,r.bb),e.use_be&&Ro(e.bounds_local.be,t,r.be),ho(e.bounds_local.bs,t,r.bs)}function u(e,t){for(var r=e.scenes_data,_=0;_<r.length;_++){var n=r[_];if(n.scene==t)return n}return null}function d(e){return e.parent_is_dupli?e.parent:e.parent?d(e.parent):null}t.LOD_DIST_MAX_INFINITY=_,t.create_render=n,t.clone_render=function(e){var t=n(e.type);return t.data_id=e.data_id,Ma(e.world_tsr,t.world_tsr),Ma(e.world_tsr_inv,t.world_tsr_inv),he(e.pivot,t.pivot),he(e.hover_pivot,t.hover_pivot),t.init_dist=e.init_dist,t.init_fov=e.init_fov,t.is_copied=e.is_copied,t.is_copied_deep=e.is_copied_deep,e.color_id&&(t.color_id=Ne(e.color_id)),t.outline_intensity=e.outline_intensity,t.target_cam_upside_down=e.target_cam_upside_down,he(e.vertical_axis,t.vertical_axis),t.use_panning=e.use_panning,t.move_style=e.move_style,t.velocity_trans=e.velocity_trans,t.velocity_rot=e.velocity_rot,t.velocity_zoom=e.velocity_zoom,t.dof_distance=e.dof_distance,t.dof_front_start=e.dof_front_start,t.dof_front_end=e.dof_front_end,t.dof_rear_start=e.dof_rear_start,t.dof_rear_end=e.dof_rear_end,t.dof_power=e.dof_power,t.dof_bokeh_intensity=e.dof_bokeh_intensity,t.dof_bokeh=e.dof_bokeh,t.dof_foreground_blur=e.dof_foreground_blur,t.dof_object=e.dof_object,t.horizontal_limits=ln(e.horizontal_limits),t.vertical_limits=ln(e.vertical_limits),t.distance_limits=ln(e.distance_limits),t.hover_vert_trans_limits=ln(e.hover_vert_trans_limits),t.hover_horiz_trans_limits=ln(e.hover_horiz_trans_limits),t.pivot_limits=e.pivot_limits,t.enable_hover_hor_rotation=e.enable_hover_hor_rotation,t.outline_anim_settings_default.outline_duration=e.outline_anim_settings_default.outline_duration,t.outline_anim_settings_default.outline_period=e.outline_anim_settings_default.outline_period,t.outline_anim_settings_default.outline_relapses=e.outline_anim_settings_default.outline_relapses,t.cube_reflection_id=e.cube_reflection_id,t.plane_reflection_id=e.plane_reflection_id,t.reflection_plane=e.reflection_plane,t.friction=e.friction,t.elasticity=e.elasticity,t.is_lod=e.is_lod,he(e.lod_center,t.lod_center),he(e.main_lod_offset,t.main_lod_offset),t.lod_dist_min=e.lod_dist_min,t.lod_dist_max=e.lod_dist_max,t.lod_lower_border_range=e.lod_lower_border_range,t.lod_upper_border_range=e.lod_upper_border_range,t.do_not_render=e.do_not_render,t.shadow_cast=e.shadow_cast,t.shadow_receive=e.shadow_receive,t.shadow_cast_only=e.shadow_cast_only,t.reflexible=e.reflexible,t.reflexible_only=e.reflexible_only,t.reflective=e.reflective,t.reflection_type=e.reflection_type,t.wind_bending=e.wind_bending,t.dynamic_geometry=e.dynamic_geometry,t.dynamic_grass=e.dynamic_grass,t.hide=e.hide,t.selectable=e.selectable,t.origin_selectable=e.origin_selectable,t.outlining=e.outlining,t.origin_outlining=e.origin_outlining,t.outline_on_select=e.outline_on_select,t.is_hair_particles=e.is_hair_particles,t.is_visible=e.is_visible,t.force_zsort=e.force_zsort,t.wind_bending_angle=e.wind_bending_angle,t.wind_bending_amp=e.wind_bending_amp,t.wind_bending_freq=e.wind_bending_freq,t.detail_bending_freq=e.detail_bending_freq,t.detail_bending_amp=e.detail_bending_amp,t.branch_bending_amp=e.branch_bending_amp,t.main_bend_col=e.main_bend_col,t.detail_bend_col=e.detail_bend_col,t.bend_center_only=e.bend_center_only,he(e.center_pos,t.center_pos),t.billboard=e.billboard,t.billboard_pres_glob_orientation=e.billboard_pres_glob_orientation,t.billboard_type=e.billboard_type,t.billboard_spherical=e.billboard_spherical,t.frame_factor=e.frame_factor,t.va_frame=e.va_frame,t.va_frame_factor=e.va_frame_factor,t.max_bones=e.max_bones,t.frames_blending=e.frames_blending,t.vertex_anim=e.vertex_anim,t.use_shape_keys=e.use_shape_keys,t.shape_keys_values=ln(e.shape_keys_values),t.is_skinning=e.is_skinning,t.anim_mixing=e.anim_mixing,t.anim_mix_factor=e.anim_mix_factor,t.anim_mix_factor_change_speed=e.anim_mix_factor_change_speed,t.anim_destination_mix_factor=e.anim_destination_mix_factor,t.blend_skel_slots.set(e.blend_skel_slots),t.skinned_renders=ln(e.skinned_renders),t.mesh_to_arm_bone_maps=ln(e.mesh_to_arm_bone_maps),t.skinning_data_cache=ln(e.skinning_data_cache),t.quats_before=ln(e.quats_before),t.quats_after=ln(e.quats_after),t.trans_before=ln(e.trans_before),t.trans_after=ln(e.trans_after),t.bone_pointers=ln(e.bone_pointers),t.bone_skinning_info=ln(e.bone_skinning_info),t.pose_data=ln(e.pose_data),t.arm_rel_trans=ln(e.arm_rel_trans),t.arm_rel_quat=ln(e.arm_rel_quat),So(e.bb_original,t.bb_original),So(e.bb_local,t.bb_local),So(e.bb_world,t.bb_world),Lo(e.bs_local,t.bs_local),Lo(e.bs_world,t.bs_world),xo(e.be_local,t.be_local),xo(e.be_world,t.be_world),Xo(e.bcap_local,t.bcap_local),Xo(e.bcyl_local,t.bcyl_local),Xo(e.bcon_local,t.bcon_local),t.pass_index=e.pass_index,t},t.create_object=function(e,t,r){return r||(r=e),{name:e,uuid:zn(),origin_name:r,type:t,materials:[],is_meta:!0,_bpy_obj:null,mat_inheritance_data:{original_mat_names:[],is_disabled:[]},is_dynamic:!1,is_hair_dupli:!1,use_default_animation:!1,is_boundings_overridden:!1,render:null,constraint:null,sfx:null,light:null,armobj:null,anchor:null,field:null,metatags:null,custom_prop:null,scenes_data:[],vertex_anim:[],cons_descends:ua(),cons_armat_bone_descends:ua(),anim_slots:[],reflective_objs:[],nla_events:[],action_anim_cache:[],sensor_manifolds:null,sensor_manifolds_arr:[],parent:null,parent_is_dupli:!1,parent_bone:"",viewport_alignment:null,pinverse_tsr:null,use_obj_physics:!1,collision_id:"",correct_bounding_offset:"AUTO",is_vehicle:!1,is_character:!1,is_floating:!1,bob_synchronize_pos:!1,physics:null,vehicle:null,floater:null,vehicle_settings:null,floating_settings:null,character_settings:null,physics_constraints:[],physics_settings:{physics_type:"NO_COLLISION",use_ghost:!1,use_sleep:!1,mass:0,velocity_min:0,velocity_max:0,damping:0,rotation_damping:0,lock_location_x:!1,lock_location_y:!1,lock_location_z:!1,lock_rotation_x:!1,lock_rotation_y:!1,lock_rotation_z:!1,collision_margin:0,collision_group:0,collision_mask:0,use_collision_bounds:!1,collision_bounds_type:"BOX",use_collision_compound:!1},outline_animation:{time_start:0,outline_time:0,period:0,relapses:0},anim_behavior_def:0,def_action_slots:[],need_update_transform:!1,need_inv_zup_tsr:!1,meta_objects:[]}},t.init_scene_data=a,t.copy_bpy_object_props_by_link=function(e){return e instanceof Array?e.slice():e},t.copy_object_props_by_value=function e(t){if(!(t instanceof Object))return t;var r,_=null,n=null,a=null,o=null,i=null,s=null;t.textures&&(_=t.textures,t.textures=null),t.texture_names&&(n=t.texture_names,t.texture_names=null),t.bpy_tex_names&&(a=t.bpy_tex_names,t.bpy_tex_names=null),t.shape_keys&&(o=t.shape_keys,t.shape_keys=null),t.shader&&(i=t.shader,t.shader=null),t.vaos&&(s=t.vaos,t.vaos=null);var E=t.constructor;switch(E){case Int8Array:case Uint8Array:case Uint8ClampedArray:case Int16Array:case Uint16Array:case Int32Array:case Uint32Array:case Float32Array:case Float64Array:r=new E(t);break;case Array:r=new E(t.length);for(var c=0;c<t.length;c++)r[c]=e(t[c]);break;case WebGLUniformLocation:case WebGLProgram:case WebGLShader:r=t;break;case WebGLFramebuffer:case WebGLRenderbuffer:case WebGLTexture:case WebGLBuffer:r=null;break;case Function:r=t;break;default:for(var l in r=new E,t)r[l]=e(t[l])}return _&&(r.textures=_,t.textures=_),n&&(r.texture_names=n,t.texture_names=n),a&&(r.bpy_tex_names=a,t.bpy_tex_names=a),o&&(r.shape_keys=o,t.shape_keys=o),i&&(r.shader=i,t.shader=i),s&&(r.vaos=ua(),t.vaos=s),r},t.is_dynamic=o,t.is_dynamic_mesh=function(e){return"MESH"==e.type&&e.is_dynamic},t.append_scene_data=function(e,t){var r=a(t);e.scenes_data.push(r)},t.append_batch=function(e,t,r){var _=e.render,n=u(e,t);n.batches.push(r);var a=Po();T(r,_.world_tsr,a),n.batch_world_bounds.push(a)},t.update_render_bounds_billboard=function(e,t){var r=e.render,_=Math.max(Math.abs(t.max_x),Math.abs(t.min_x)),n=Math.max(Math.abs(t.max_y),Math.abs(t.min_y)),a=Math.max(Math.abs(t.max_z),Math.abs(t.min_z)),T=Math.sqrt(_*_+n*n+a*a),u=Math.sqrt(_*_+n*n),d={max_x:0,min_x:0,max_y:0,min_y:0,max_z:0,min_z:0};d.max_x=d.max_y=d.max_z=T,d.min_x=d.min_y=d.min_z=-T,i(r,d),s(r,T,[0,0,0]),E(r,[1,0,0],[0,1,0],[0,0,1],[T,T,T],[0,0,0]),o(e)?c(r,u,u,d):l(r,[1,0,0],[0,1,0],[0,0,1],[T,T,T],[0,0,0])},t.update_render_bounds_from_bpy=function(e,t,r){var _=e.render,n=r.bs_rad,a=r.bc_rad,T=r.bs_cen,u=r.be_cen,d=r.caxis_x,f=r.caxis_y,P=r.caxis_z,A=r.be_ax,S=r.rbb.rbb_c,p=r.rbb.rbb_s;i(_,t),s(_,n,T);var m=o(e);E(_,m?d:[1,0,0],m?f:[0,1,0],m?P:[0,0,1],A,u),o(e)?c(_,a,a,_.bb_local):l(_,d,f,P,p,S)},t.update_render_bounds_from_pos_arrays=function(e,t,r){for(var _=e.render,n=t.max_x-t.min_x,a=t.max_y-t.min_y,T=t.max_z-t.min_z,u=(t.max_x+t.min_x)/2,d=(t.max_y+t.min_y)/2,f=(t.max_z+t.min_z)/2,P=u,A=d,S=Math.max(n,Math.max(a,T))/2,p=Math.max(n,a)/2,m=[u/(n||1),d/(a||1),f/(T||1)],O=.5,v=0;v<r.length;v++)for(var N=r[v],g=0;g<N.length;g+=3){var h=N[g],R=N[g+1],I=N[g+2],b=Math.sqrt((u-h)*(u-h)+(d-R)*(d-R)+(f-I)*(f-I));b>S&&(u=(u-S*(h-u)/b+h)/2,d=((M=d-S*(R-d)/b)+R)/2,f=((x=f-S*(I-f)/b)+I)/2,S=Math.sqrt((u-h)*(u-h)+(d-R)*(d-R)+(f-I)*(f-I)));var Y=Math.sqrt((P-h)*(P-h)+(A-R)*(A-R));Y>p&&(P=(P-p*(h-P)/Y+h)/2,A=((M=A-p*(R-A)/Y)+R)/2,p=Math.sqrt((P-h)*(P-h)+(A-R)*(A-R))),h/=n||1,R/=a||1,I/=T||1;var L=Math.sqrt((m[0]-h)*(m[0]-h)+(m[1]-R)*(m[1]-R)+(m[2]-I)*(m[2]-I));if(L>O){var M=m[1]-O*(R-m[1])/L,x=m[2]-O*(I-m[2])/L;m[0]=(m[0]-O*(h-m[0])/L+h)/2,m[1]=(M+R)/2,m[2]=(x+I)/2,O=Math.sqrt((m[0]-h)*(m[0]-h)+(m[1]-R)*(m[1]-R)+(m[2]-I)*(m[2]-I))}}var y=n?n*m[0]:t.max_x,w=a?a*m[1]:t.max_y,U=T?T*m[2]:t.max_z,C=O*n,D=O*a,F=O*T;i(_,t),s(_,S,[u,d,f]),E(_,[1,0,0],[0,1,0],[0,0,1],[C,D,F],[y,w,U]),o(e)?c(_,p,p,_.bb_local):l(_,[(_.bb_local.max_x-_.bb_local.min_x)/2,0,0],[0,(_.bb_local.max_y-_.bb_local.min_y)/2,0],[0,0,(_.bb_local.max_z-_.bb_local.min_z)/2],[1,1,1],[(_.bb_local.max_x+_.bb_local.min_x)/2,(_.bb_local.max_y+_.bb_local.min_y)/2,(_.bb_local.max_z+_.bb_local.min_z)/2])},t.update_world_bounds_from_batch_tsr=T,t.remove_scene_data=function(e,t){for(var r=e.scenes_data,_=0;_<r.length;_++)if(r[_].scene==t){r.splice(_,1);break}},t.get_scene_data=u,t.update_refl_objects=function(e,t){for(var r=0;r<e.length;r++)nr(t,e[r].render.reflection_plane)},t.scene_data_set_active=function(e,t,r){for(var _=0;_<e.scenes_data.length;_++){var n=e.scenes_data[_];r&&n.scene!=r||(n.is_active=t)}},t.scene_data_remove_batch=function(e,t){e.batches.splice(t,1),e.batch_world_bounds.splice(t,1)},t.get_shadow_lamps=function(e,t){for(var _=[],n=t?r.max_cast_lamps-1:r.max_cast_lamps,a=0;a<e.length;a++){var o=e[a];o.light.generate_shadows&&_.length<n&&_.push(o)}return _.length?_:e[0]?[e[0]]:[]},t.meta_obj_append_render=function(e,t){xa(t.world_tsr),t.color_id=null,e.render=t},t.check_obj_soft_particles_accessibility=function(e,t){if(t.b4w_enable_soft_particles&&t.b4w_particles_softness>0){var r=t.material-1,_=e.materials;if(r>=0&&r<_.length&&("ADD"==_[r].blend_mode||"ALPHA"==_[r].blend_mode||"ALPHA_SORT"==_[r].blend_mode))return!0}return!1},t.check_inv_zup_tsr_is_needed=function(e){for(var t=e.scenes_data,r=0;r<t.length;r++)for(var _=t[r].batches,n=0;n<_.length;n++)for(var a=_[n].shaders_info.directives,o=0;o<a.length;o++){var i=a[o];if("USE_MODEL_TSR_INVERSE"==i[0]&&"1"==i[1])return!0}return!1},t.gen_dupli_name=function(e,t){return e+"*"+t},t.get_parent=function(e){return e.parent_is_dupli?null:e.parent},t.get_dg_parent=d,t.get_dg_objects=function(e,t){for(var r=[],_=0;_<t.length;_++){var n=t[_];d(n)==e&&r.push(n)}return r},t.get_object_data_id=function(e){return e.render.data_id},t.is_mesh=function(e){return"MESH"===e.type},t.is_armature=function(e){return"ARMATURE"===e.type},t.is_speaker=function(e){return"SPEAKER"===e.type},t.is_camera=function(e){return"CAMERA"===e.type},t.is_lamp=function(e){return"LAMP"===e.type},t.is_empty=function(e){return"EMPTY"===e.type},t.is_line=function(e){return"LINE"===e.type},t.is_world=function(e){return"WORLD"===e.type}}),is=A("__particles",function(e,t){var r=ha(e),_=Wo(e),n=Ks(e),a=Jo(e),o=wi(e),i=ys(e),s=ri(e),E=_.defaults,c=gi(),l=new Float32Array(8),T=new Float32Array(3),u=[];function d(e,t){return{name:e,p_type:t,time:0,prev_time:-1,use_world_space:!1,count_factor:1,frame_start:0,frame_end:0,time_length:0,lifetime_frames:0,lifetime:0,cyclic:0,mass:0,nfactor:0,gravity:0,fade_in:0,fade_out:0,wind_factor:0,size:0,alpha_start:0,alpha_end:0,color_ramp_length:0,color_ramp:new Float32Array(16),need_buffers_update:!1,positions:null,positions_cache:null,tbn:null,tbn_cache:null,delay_attrs:null,delay_attrs_masked:null,emitter_tsr_snapshots:null,p_data:null,tilt:0,tilt_rand:0}}t.clone_particles_data=function(e){var t=d(e.name,e.type);return t.time=e.time,t.prev_time=e.prev_time,t.use_world_space=e.use_world_space,t.count_factor=e.count_factor,t.frame_start=e.frame_start,t.frame_end=e.frame_end,t.time_length=e.time_length,t.lifetime_frames=e.lifetime_frames,t.lifetime=e.lifetime,t.cyclic=e.cyclic,t.mass=e.mass,t.nfactor=e.nfactor,t.gravity=e.gravity,t.fade_in=e.fade_in,t.fade_out=e.fade_out,t.wind_factor=e.wind_factor,t.size=e.size,t.alpha_start=e.alpha_start,t.alpha_end=e.alpha_end,t.color_ramp_length=e.color_ramp_length,t.color_ramp.set(e.color_ramp),t.need_buffers_update=e.need_buffers_update,t.positions=ln(e.positions),t.positions_cache=ln(e.positions_cache),t.tbn=ln(e.tbn),t.tbn_cache=ln(e.tbn_cache),t.delay_attrs=ln(e.delay_attrs),t.delay_attrs_masked=ln(e.delay_attrs_masked),t.emitter_tsr_snapshots=ln(e.emitter_tsr_snapshots),t.p_data=ln(e.p_data),t.tilt=e.tilt,t.tilt_rand=e.tilt_rand,t};var f=function(){r.panic("_rand() undefined")};function P(e,t,r,_,n,a){for(var o=e.delay_attrs,i=e.emitter_tsr_snapshots,s=e.time,E=e.prev_time,u=0;u<o.length;u+=4){var d=o[u];if(s>E&&s>=d&&d>E||s<E&&(d>E||s>=d))for(var f=0;f<8;f++)i[8*u+f]=_[f],l[f]=_[f];else for(f=0;f<8;f++)l[f]=i[8*u+f];var P=T;P[0]=t[3*u],P[1]=t[3*u+1],P[2]=t[3*u+2],ja(P,l,P),n[3*u]=P[0],n[3*u+1]=P[1],n[3*u+2]=P[2];var A=Ri(r,u,c);for(Li(A,l,A),Ii(a,A,u),f=1;f<4;f++)n[3*(u+f)]=n[3*u],n[3*(u+f)+1]=n[3*u+1],n[3*(u+f)+2]=n[3*u+2],Ii(a,A,u+f)}}function A(e,t){for(var r=0;r<t.length;r++){var _=t[r],n=_.particles_data;n&&n.use_world_space&&!_.forked_batch&&(P(n,n.positions,n.tbn,e.render.world_tsr,n.positions_cache,n.tbn_cache),n.need_buffers_update=!0)}}t.update=function(){for(var e=0;e<u.length;e++)for(var t=u[e],r=t.scenes_data,_=0;_<r.length;_++)A(t,r[_].batches)},t.obj_has_particles=function(e){for(var t=e.scenes_data,r=0;r<t.length;r++)for(var _=t[r].batches,n=0;n<_.length;n++)if(_[n].particles_data)return!0;return!1},t.obj_has_psys=function(e,t){for(var r=e.scenes_data,_=0;_<r.length;_++)for(var n=r[_].batches,a=0;a<n.length;a++){var o=n[a].particles_data;if(o&&o.name==t)return!0}return!1},t.obj_has_anim_particles=function(e){for(var t=e.scenes_data,r=0;r<t.length;r++)for(var _=t[r].batches,n=0;n<_.length;n++){var a=_[n].particles_data;if(a&&"EMITTER"==a.p_type)return!0}return!1},t.bpy_obj_has_particles=function(e){return e.particle_systems.length>0},t.bpy_obj_has_anim_particles=function(e){for(var t=0;t<e.particle_systems.length;t++)if("EMITTER"==e.particle_systems[t].settings.type)return!0;return!1},t.has_dynamic_grass_particles=function(e){for(var t=0;t<e.particle_systems.length;t++){var r=e.particle_systems[t].settings;if("HAIR"==r.type&&r.b4w_dynamic_grass)return!0}return!1},t.create_particles_data=function(e,t,r){var _,a,o,c=e.particles_data=d(t.name,t.settings.type);if(c.frame_start=t.settings.frame_start,c.frame_end=t.settings.frame_end,c.time_length=(c.frame_end-c.frame_start)/s.get_framerate(),c.lifetime_frames=t.settings.lifetime,c.lifetime=c.lifetime_frames/s.get_framerate(),c.cyclic=t.settings.b4w_cyclic?1:0,c.mass=t.settings.mass,c.nfactor=t.settings.normal_factor,c.gravity=9.81*t.settings.effector_weights.gravity,c.fade_in=t.settings.b4w_fade_in/s.get_framerate(),c.fade_out=t.settings.b4w_fade_out/s.get_framerate(),c.wind_factor=t.settings.effector_weights.wind,c.use_world_space="WORLD"==t.settings.b4w_coordinate_system,e.halo_particles){_=r.halo_settings.size;var l=r.halo_settings.hardness;l<30?(a=.5,o=.9):l<40?(a=.1,o=1):l<50?(a=0,o=.8):(a=0,o=.5)}else _=t.settings.particle_size,a=1,o=1;c.size=_,c.alpha_start=a,c.alpha_end=o,r.use_nodes&&"BILLBOARD"==t.settings.render_type&&(n.set_batch_directive(e,"NODES",1),n.set_batch_directive(e,"PARTICLE_BATCH",1),e.has_nodes=!0);var T=t.settings.texture_slots;if(T[0]&&T[0].use_map_size&&T[0].texture&&"BLEND"==T[0].texture.type&&T[0].texture.use_color_ramp&&E.allow_vertex_textures){var u=T[0].texture,f=[];i.calc_color_ramp_data(u.color_ramp,i.PART_COLORRAMP_TEXT_SIZE,f),f=new Uint8Array(f.map(function(e){return Un(255*e,0,255)}));var P=i.create_color_ramp_texture(f,i.PART_COLORRAMP_TEXT_SIZE);n.append_texture(e,P,"u_color_ramp_tex",u.name),n.set_batch_directive(e,"USE_COLOR_RAMP",1)}var A=r.texture_slots,S=[-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0];if(A[0]&&"STRAND"==A[0].texture_coords&&A[0].texture&&"BLEND"==A[0].texture.type&&A[0].texture.use_color_ramp){for(var p=A[0].texture.color_ramp.elements,m=Math.min(4*p.length,S.length),O=0;O<m;O+=4){var v=p[O/4];S[O]=v.position,S[O+1]=v.color[0],S[O+2]=v.color[1],S[O+3]=v.color[2]}c.color_ramp_length=p.length}c.color_ramp.set(S)},t.generate_emitter_particles_submesh=function(e,t,_,n){var i=e.particles_data,E=n.world_tsr,l=_.settings.count,T=_.settings.frame_start/s.get_framerate(),u=_.settings.frame_end/s.get_framerate(),d=_.settings.lifetime/s.get_framerate(),A=_.settings.lifetime_random,S=_.settings.emit_from,p=_.settings.factor_random;if(_.settings.use_rotations)var m=_.settings.angular_velocity_mode,O=_.settings.angular_velocity_factor;else m="NONE",O=0;var v,N=_.settings.b4w_randomize_emission,g=_.settings.b4w_cyclic;i.tilt=_.settings.billboard_tilt,i.tilt_rand=_.settings.billboard_tilt_random,(v=_.seed)?(a.srand(v),f=function(){return a.rand()}):f=function(){return Math.random()};var h=function(e,t,_){switch(t){case"VERT":var n=_.va_frames[0].a_position,a=_.va_frames[0].a_tbn,i=function(e,t){for(var r=t.length/3,_=[],n=0;n<e;n++){var a=Math.round((r-1)*f());_.push(a),_.push(a),_.push(a),_.push(a)}return _}(e,n),s=function(e,t){for(var r=[],_=0;_<e.length;_++)r.push(t[3*e[_]]),r.push(t[3*e[_]+1]),r.push(t[3*e[_]+2]);return new Float32Array(r)}(i,n),E=function(e,t){for(var r=gi(e.length),_=0;_<e.length;_++)Ii(r,Ri(t,e[_],c),_);return r}(i,a);break;case"FACE":s=[],E=[];var l=[];tn(0,l);var T=o.geometry_random_points(_,e,!1,l);tn(0,l);var u=o.geometry_random_points(_,e,!0,l);E=gi(4*T.length);for(var d=0;d<T.length;d++)s.push(T[d][0],T[d][1],T[d][2]),s.push(T[d][0],T[d][1],T[d][2]),s.push(T[d][0],T[d][1],T[d][2]),s.push(T[d][0],T[d][1],T[d][2]),Ii(E,u[d],4*d),Ii(E,u[d],4*d+1),Ii(E,u[d],4*d+2),Ii(E,u[d],4*d+3);s=new Float32Array(s);break;case"VOLUME":r.panic("Particle emission from volume is not supported");break;default:r.panic("Wrong emit from option")}return[s,E]}(l,S,o.extract_submesh_all_mats(t,["a_position","a_tbn"],null,n)),R=h[0],I=h[1];i.positions=new Float32Array(R),i.tbn=new Float32Array(I),i.positions_cache=new Float32Array(R.length),i.tbn_cache=new Float32Array(I.length);var b=function(e,t,r,_,n){for(var a=[],o=(u-t)/e,i=0;i<e;i++){var s;s=_?o*i+10*o*(.5-f()):o*i,n||(s+=t),a.push(s),a.push(s),a.push(s),a.push(s)}return new Float32Array(a)}(l,T,0,N,g);if(i.delay_attrs=new Float32Array(b),i.delay_attrs_masked=new Float32Array(b),i.use_world_space){i.emitter_tsr_snapshots=new Float32Array(8*b.length);for(var Y=0;Y<8*b.length;Y++)for(var L=0;L<8;L++)i.emitter_tsr_snapshots[8*Y+L]=E[L];P(i,R,I,E,R,I)}var M=o.init_submesh("EMITTER_PARTICLES"),x=o.create_empty_va_frame();x.a_position=R,x.a_tbn=I,M.va_frames[0]=x,e.draw_mode=o.DM_DYNAMIC_TRIANGLES,M.indices=function(e){for(var t=[],r=0;r<e;r++)t.push(4*r,4*r+2,4*r+1,4*r,4*r+3,4*r+2);return new Uint16Array(t)}(l),M.va_common.a_p_bb_vertex=o.gen_bb_vertices(l),M.base_length=R.length/3;var y=function(e,t,r){for(var _=[],n=t*r,a=0;a<e;a++){var o=n*f();_.push(t-o),_.push(t-o),_.push(t-o),_.push(t-o)}return _}(l,d,A);return M.va_common.a_p_data=function(e,t,r){for(var _=[],n=0;n<e;n++){var a=Math.random();_.push(t[4*n],r[4*n],a),_.push(t[4*n+1],r[4*n+1],a),_.push(t[4*n+2],r[4*n+2],a),_.push(t[4*n+3],r[4*n+3],a)}return new Float32Array(_)}(l,y,b),M.va_common.a_p_vels=function(e,t,_,n){for(var a=[],o=0;o<e;o++){var i=[f()-.5,f()-.5,f()-.5];switch(Ke(i,i),a.push(t*i[0]),a.push(t*i[1]),a.push(t*i[2]),_){case"NONE":a.push(0);break;case"SPIN":case"VELOCITY":a.push(n);break;case"RAND":a.push(2*n*(f()-.5));break;default:r.panic("Undefined velocity factor")}for(var s=a.slice(-4),E=0;E<12;E++)a.push(s[E%4])}return new Float32Array(a)}(l,p,m,O),i.p_data=new Float32Array(M.va_common.a_p_data),M},t.set_time=function(e,t,r){for(var _=e.scenes_data,n=0;n<_.length;n++)for(var a=_[n].batches,o=0;o<a.length;o++){var i=a[o].particles_data;i&&i.name==t&&!a[o].forked_batch&&(i.prev_time=i.time,i.time=r)}},t.set_size=function(e,t,r){for(var _=e.scenes_data,n=0;n<_.length;n++)for(var a=_[n].batches,o=0;o<a.length;o++){var i=a[o].particles_data;i&&i.name==t&&(i.size=r)}},t.set_normal_factor=function(e,t,r){for(var _=e.scenes_data,n=0;n<_.length;n++)for(var a=_[n].batches,o=0;o<a.length;o++){var i=a[o].particles_data;i&&i.name==t&&(i.nfactor=r)}},t.get_normal_factor=function(e,t){for(var r=e.scenes_data,_=0;_<r.length;_++)for(var n=r[_].batches,a=0;a<n.length;a++){var o=n[a].particles_data;if(o&&o.name==t)return o.nfactor}return 0},t.set_factor=function(e,t,r){for(var _=e.scenes_data,n=0;n<_.length;n++)for(var a=_[n].batches,i=0;i<a.length;i++){var s=a[i],E=s.particles_data;if(E&&E.name==t){E.count_factor=r;var c=E.delay_attrs;if(1==r)var l=c;else if(0==r){l=E.delay_attrs_masked;for(var T=0;T<l.length;T+=4)l[T]=1e4,l[T+1]=l[T],l[T+2]=l[T],l[T+3]=l[T]}else{var u=4/r,d=(l=E.delay_attrs_masked,0);for(T=0;T<l.length;T+=4)T>=d?(l[T]=c[T],d+=u):l[T]=1e4,l[T+1]=l[T],l[T+2]=l[T],l[T+3]=l[T]}var f=s.bufs_data;if(f.pointers.a_p_data){var P=E.p_data;for(T=0;T<P.length;T+=3)P[T+1]=l[Math.round(T/3)];o.update_bufs_data_array(f,"a_p_data",3,P)}}}},t.update_start_pos=function(e,t,r){for(var _=e.scenes_data,n=0;n<_.length;n++)for(var a=_[n].batches,o=0;o<a.length;o++){var i=a[o].particles_data;if(i&&i.use_world_space)for(var s=0;s<8*i.delay_attrs.length;s++)i.emitter_tsr_snapshots[8*s]=t[0],i.emitter_tsr_snapshots[8*s+1]=t[1],i.emitter_tsr_snapshots[8*s+2]=t[2],i.emitter_tsr_snapshots[8*s+3]=t[3],i.emitter_tsr_snapshots[8*s+4]=r[0],i.emitter_tsr_snapshots[8*s+5]=r[1],i.emitter_tsr_snapshots[8*s+6]=r[2],i.emitter_tsr_snapshots[8*s+7]=r[3]}},t.update_particles_submesh=function(e,t,r){if(e.va_common.a_tbn=gi(4*r),hi(e.va_common.a_tbn),t.part_node_data){for(var _=[],n=0;n<r;n++)_.push(n,n,n,n);e.va_common[t.part_node_data.name]=new Float32Array(_)}},t.update_particles_objs_cache=function(e){-1==u.indexOf(e)&&u.push(e)},t.remove_obj_from_cache=function(e){var t=u.indexOf(e);-1!=t&&u.splice(t,1)},t.cleanup=function(){u.length=0}}),ss=A("__debug_telemetry",function(e,t){var r=ga(e),_=[],n={},a=["color: #3366FF","color: #CC33FF","color: #FF3366","color: #33FF66","color: #FFCC33"];t.fbmsg=function(){for(var e=[performance.now()],t=0;t<arguments.length;t++){var r=arguments[t];if(kn(r))for(var n=0;n<r.length;n++)e.push(r[n]);else e.push(arguments[t])}_.push(e)},t.msg=function(){for(var e=1,t=0;t<_.length;t++)(r=_[t])[1]==arguments[0]&&e++;var r=[e];for(t=0;t<arguments.length;t++){var n=arguments[t];if(kn(n))for(var a=0;a<n.length;a++)r.push(n[a]);else r.push(arguments[t])}_.push(r)},t.print_telemetry=function(e){e||(e=1);for(var t=0,n={},o=Math.max(0,performance.now()-1e3*e),i=0;i<_.length;i++){var s=_[i];if(!((e=s[0])<o)){var E=String(s[1]);n[E]||(n[E]=a[t++%a.length]);for(var c=n[E],l=["%c"+(e/1e3).toFixed(6),c,E],T=2;T<s.length;T++)l.push(s[T]);r.log.apply(this,l)}}_.splice(0)},t.plot_telemetry=function(e){e||(e=1);for(var t={},n=Math.max(0,performance.now()-1e3*e),a=0;a<_.length;a++){var o=_[a];if(!((e=o[0])<n))for(var i=2;i<o.length;i++){var s=String(o[1]);o.length>3&&(s+="_"+String(i-2)),t[s]||(t[s]=s+"\n"),t[s]+=String(e)+" "+o[i]+"\n"}}var E="";for(var s in t)E+=t[s]+"\n\n";r.log(E),_.splice(0)},t.exec_count=function(e){e in n?n[e]+=1:n[e]=1},t.update=function(){for(var e in n)r.log(e,n[e]),n[e]=0}});function Es(e){if(""==e)return".";var t=0==e.indexOf("/")|0;t&&0==e.indexOf("//")&&0!=e.indexOf("///")&&(t=2);for(var r=e.split("/"),_=[],n=0;n<r.length;n++){var a=r[n];""!=a&&"."!=a&&(".."!=a||!t&&!_.length||_.length&&".."==_[_.length-1]?_.push(a):_.length&&_.pop())}for(e=(r=_).join("/"),n=0;n<t;n++)e="/"+e;return e||"."}function cs(e){var t=e.split("://",2);return t.length>1?(t[1]=Es(t[1]),t.join("://")):Es(e)}function ls(e){return/(?:\.([^.]+))?$/.exec(e)[1]}var Ts=A("__ipc",function(e,t){var r=ha(e),_=Jo(e),n=!0;t.IN_LOADED=0,t.IN_COLLISION=1,t.IN_COLLISION_POS_NORM=2,t.IN_COLLISION_IMPULSE=3,t.IN_ERROR=4,t.IN_FBMSG=5,t.IN_FLOATER_BOB_TRANSFORM=6,t.IN_LOG=7,t.IN_PROP_OFFSET=8,t.IN_RAY_HIT=9,t.IN_RAY_HIT_POS_NORM=10,t.IN_REMOVE_RAY_TEST=11,t.IN_TRANSFORM=12,t.IN_VEHICLE_SPEED=13,t.IN_PING=14,t.IN_FPS=15,t.IN_DEBUG_STATS=16;var a=t.IN_COLLISION,o=t.IN_COLLISION_POS_NORM,i=t.IN_PROP_OFFSET,s=t.IN_RAY_HIT,E=t.IN_RAY_HIT_POS_NORM,c=t.IN_TRANSFORM;t.OUT_INIT=100,t.OUT_ACTIVATE=101,t.OUT_ADD_BOAT_BOB=102,t.OUT_ADD_CAR_WHEEL=103,t.OUT_ADD_FLOATER_BOB=104,t.OUT_APPEND_BOUNDING_BODY=105,t.OUT_APPEND_BOAT=106,t.OUT_APPEND_CAR=107,t.OUT_APPEND_CHARACTER=108,t.OUT_APPEND_COLLISION_TEST=109,t.OUT_APPEND_CONSTRAINT=110,t.OUT_APPEND_FLOATER=111,t.OUT_APPEND_GHOST_MESH_BODY=112,t.OUT_APPEND_STATIC_MESH_BODY=113,t.OUT_APPEND_WATER=114,t.OUT_REMOVE_BODY=115,t.OUT_APPLY_CENTRAL_FORCE=116,t.OUT_APPLY_COLLISION_IMPULSE_TEST=117,t.OUT_APPLY_TORQUE=118,t.OUT_CHARACTER_JUMP=119,t.OUT_CHARACTER_ROTATION_INCREMENT=120,t.OUT_CLEAR_COLLISION_IMPULSE_TEST=121,t.OUT_DISABLE_SIMULATION=122,t.OUT_ENABLE_SIMULATION=123,t.OUT_PAUSE=124,t.OUT_APPEND_RAY_TEST=125,t.OUT_REMOVE_RAY_TEST=126,t.OUT_CHANGE_RAY_TEST_FROM_TO=127,t.OUT_REMOVE_COLLISION_TEST=128,t.OUT_REMOVE_CONSTRAINT=129,t.OUT_RESUME=130,t.OUT_SET_CHARACTER_FLY_VELOCITY=131,t.OUT_SET_CHARACTER_HOR_ROTATION=132,t.OUT_SET_CHARACTER_MOVE_DIR=133,t.OUT_SET_CHARACTER_MOVE_TYPE=134,t.OUT_SET_CHARACTER_ROTATION=135,t.OUT_SET_CHARACTER_RUN_VELOCITY=136,t.OUT_SET_CHARACTER_VERT_ROTATION=137,t.OUT_SET_CHARACTER_WALK_VELOCITY=138,t.OUT_SET_GRAVITY=139,t.OUT_SET_LINEAR_VELOCITY=140,t.OUT_SET_TRANSFORM=141,t.OUT_SET_WATER_TIME=142,t.OUT_ADD_WATER_WRAPPER=143,t.OUT_UPDATE_BOAT_CONTROLS=144,t.OUT_UPDATE_CAR_CONTROLS=145,t.OUT_PING=146,t.OUT_DEBUG=147,t.OUT_UPDATE_WORLD=148,t.OUT_SET_ANGULAR_VELOCITY=149,t.OUT_SET_CHARACTER_VERT_MOVE_DIR_ANGLE=150,t.OUT_UPDATE_BOUNDING_BODY=151,t.OUT_UPDATE_STATIC_MESH_BODY=152;var l=t.OUT_SET_TRANSFORM,T=f.worker_listeners,u=f.worker_namespaces,d={msg_id:c,body_id:0,time:0,trans:new Float32Array(3),quat:new Float32Array(4),linvel:new Float32Array(3),angvel:new Float32Array(3),len:0},P={msg_id:i,chassis_hull_body_id:0,prop_ind:0,trans:new Float32Array(3),quat:new Float32Array(4),len:0},A={msg_id:s,id:0,body_id_hit:0,hit_fract:0,hit_time:0,len:0},S={msg_id:E,id:0,body_id_hit:0,hit_fract:0,hit_time:0,hit_pos:new Float32Array(3),hit_norm:new Float32Array(3),len:0},p={msg_id:a,body_id_a:0,body_id_b:0,result:0,len:0},m={msg_id:o,body_id_a:0,body_id_b:0,result:0,coll_point:new Float32Array(3),coll_norm:new Float32Array(3),coll_dist:0,len:0},O={msg_id:l,body_id:0,trans:new Float32Array(3),quat:new Float32Array(4),len:0},v=[d,P,A,S,p,m,O];function N(e,t,r){for(var _=0;_<u.length;_+=2)u[_+1]==e&&(T[_+Number(!t)]=r)}t.create_worker=function(t,a){var o={is_main:!!t,web_worker:null,buf_arr:[],fb_worker_ns:""};if(a)if(o.web_worker={addEventListener:function(e,t,_){"message"!=e&&r.panic("Wrong web worker event"),N(o.fb_worker_ns,o.is_main,t)},removeEventListener:function(e,t,_){"message"!=e&&r.panic("Wrong web worker event"),N(o.fb_worker_ns,o.is_main,null)},postMessage:function(e,t){!function(e,t){for(var r=0;r<u.length;r+=2)if(u[r+1]==e)return T[r+Number(!t)];return null}(o.fb_worker_ns,!o.is_main)({data:e})},terminate:function(){for(var e=0;e<u.length;e+=2)if(u[e+1]==o.fb_worker_ns)return T.splice(e,2),void u.splice(e,2)}},o.is_main){var i=e,s=_.unique_name(i+"_worker");u.push(i),u.push(s),T.push(null),T.push(null),o.fb_worker_ns=s;var E=function(e){for(var t=document.getElementsByTagName("script"),r=cs(e),_=0;_<t.length;_++)if(t[_].src==r)return t[_];return null}(t);E?n?E.addEventListener("load",function(){f.require("__bindings",o.fb_worker_ns)},!1):(f.cleanup("__bindings",o.fb_worker_ns),f.cleanup("__ipc",o.fb_worker_ns),f.require("__bindings",o.fb_worker_ns)):((E=document.createElement("script")).src=t,E.defer="defer",E.async="async",E.addEventListener("load",function(){n=!1,f.require("__bindings",o.fb_worker_ns)},!1),document.head.appendChild(E))}else o.fb_worker_ns=e;else o.web_worker=t?new Worker(t):self;return o},t.attach_handler=function(e,t){!function(e){for(var t=0;t<e.length;t++){var r=e[t],_=0;for(var n in r){var a=r[n];switch(a.constructor){case Float32Array:_+=a.length;break;case Number:_+=1}}r.len=_-=1}}(v);var r=function(_){if(_.constructor==ArrayBuffer)_=new Float32Array(_);else if(_[0].constructor==ArrayBuffer){for(var n=0;n<_.length;n++)r(_[n]);return}var T=0|_[0];switch(T){case c:(u=d).body_id=0|_[1],u.time=_[2],u.trans[0]=_[3],u.trans[1]=_[4],u.trans[2]=_[5],u.quat[0]=_[6],u.quat[1]=_[7],u.quat[2]=_[8],u.quat[3]=_[9],u.linvel[0]=_[10],u.linvel[1]=_[11],u.linvel[2]=_[12],u.angvel[0]=_[13],u.angvel[1]=_[14],u.angvel[2]=_[15];break;case i:(u=P).chassis_hull_body_id=0|_[1],u.prop_ind=0|_[2],u.trans[0]=_[3],u.trans[1]=_[4],u.trans[2]=_[5],u.quat[0]=_[6],u.quat[1]=_[7],u.quat[2]=_[8],u.quat[3]=_[9];break;case s:(u=A).id=0|_[1],u.body_id_hit=0|_[2],u.hit_fract=_[3],u.hit_time=_[4];break;case E:(u=S).id=0|_[1],u.body_id_hit=0|_[2],u.hit_fract=_[3],u.hit_time=_[4],u.hit_pos[0]=_[5],u.hit_pos[1]=_[6],u.hit_pos[2]=_[7],u.hit_norm[0]=_[8],u.hit_norm[1]=_[9],u.hit_norm[2]=_[10];break;case a:(u=p).body_id_a=0|_[1],u.body_id_b=0|_[2],u.result=!!_[3];break;case o:(u=m).body_id_a=0|_[1],u.body_id_b=0|_[2],u.result=!!_[3],u.coll_point[0]=_[4],u.coll_point[1]=_[5],u.coll_point[2]=_[6],u.coll_norm[0]=_[7],u.coll_norm[1]=_[8],u.coll_norm[2]=_[9],u.coll_dist=_[10];break;case l:(u=O).body_id=0|_[1],u.trans[0]=_[2],u.trans[1]=_[3],u.trans[2]=_[4],u.quat[0]=_[5],u.quat[1]=_[6],u.quat[2]=_[7],u.quat[3]=_[8];break;default:var u=_}t(e,T,u)};e.web_worker.addEventListener("message",function(e){r(e.data)},!1)},t.cleanup=function(){},t.post_msg=function(e,t){if(e)switch(t){case c:var r=d;(_=new Float32Array(r.len))[0]=r.msg_id,_[1]=r.body_id,_[2]=r.time,_[3]=r.trans[0],_[4]=r.trans[1],_[5]=r.trans[2],_[6]=r.quat[0],_[7]=r.quat[1],_[8]=r.quat[2],_[9]=r.quat[3],_[10]=r.linvel[0],_[11]=r.linvel[1],_[12]=r.linvel[2],_[13]=r.angvel[0],_[14]=r.angvel[1],_[15]=r.angvel[2],e.buf_arr.push(_.buffer);break;case i:r=P,(_=new Float32Array(r.len))[0]=r.msg_id,_[1]=r.chassis_hull_body_id,_[2]=r.prop_ind,_[3]=r.trans[0],_[4]=r.trans[1],_[5]=r.trans[2],_[6]=r.quat[0],_[7]=r.quat[1],_[8]=r.quat[2],_[9]=r.quat[3],e.buf_arr.push(_.buffer);break;case s:r=A,(_=new Float32Array(r.len))[0]=r.msg_id,_[1]=r.id,_[2]=r.body_id_hit,_[3]=r.hit_fract,_[4]=r.hit_time,e.buf_arr.push(_.buffer);break;case E:r=S,(_=new Float32Array(r.len))[0]=r.msg_id,_[1]=r.id,_[2]=r.body_id_hit,_[3]=r.hit_fract,_[4]=r.hit_time,_[5]=r.hit_pos[0],_[6]=r.hit_pos[1],_[7]=r.hit_pos[2],_[8]=r.hit_norm[0],_[9]=r.hit_norm[1],_[10]=r.hit_norm[2],e.buf_arr.push(_.buffer);break;case a:r=p,(_=new Float32Array(r.len))[0]=r.msg_id,_[1]=r.body_id_a,_[2]=r.body_id_b,_[3]=r.result,e.buf_arr.push(_.buffer);break;case o:r=m,(_=new Float32Array(r.len))[0]=r.msg_id,_[1]=r.body_id_a,_[2]=r.body_id_b,_[3]=r.result,_[4]=r.coll_point[0],_[5]=r.coll_point[1],_[6]=r.coll_point[2],_[7]=r.coll_norm[0],_[8]=r.coll_norm[1],_[9]=r.coll_norm[2],_[10]=r.coll_dist,e.buf_arr.push(_.buffer);break;case l:r=O,(_=new Float32Array(r.len))[0]=r.msg_id,_[1]=r.body_id,_[2]=r.trans[0],_[3]=r.trans[1],_[4]=r.trans[2],_[5]=r.quat[0],_[6]=r.quat[1],_[7]=r.quat[2],_[8]=r.quat[3],e.buf_arr.push(_.buffer);break;default:for(var _=[],n=1;n<arguments.length;n++)_.push(arguments[n]);e.web_worker.postMessage(_)}},t.post_msg_arr=function(e){e&&e.buf_arr.length&&(e.web_worker.postMessage(e.buf_arr),e.buf_arr.length=0)},t.get_msg_cache=function(e){switch(e){case c:return d;case i:return P;case s:return A;case E:return S;case a:return p;case o:return m;case l:return O;default:return null}},t.terminate=function(e){e.web_worker.terminate(),e.web_worker=null},t.is_active=function(e){return!!e.web_worker},t.is_fallback=function(e){return!!e.fb_worker_ns}}),us=A("__hud",function(e,t){var r=$o(e),_=ai(e),n=30,a=80,o=20,i=[5,30,4,10,5,3,5],s=null,E=[0,0];function c(e){e.font="bold 15px Courier New",e.textBaseline="middle",e.shadowBlur=0,e.shadowColor=null}function l(e){if(u(' SCENE "'+e.name+'"'),u(" Active                 Subscene   Lamps   Size   RenderCalls   Time"),e._render){var t=0,n=0,a=0;return r.traverse(e._render.graph,function(e,r){var o=r;if(o.type!=_.SINK){for(var i=Math.round(o.camera.width)+"x"+Math.round(o.camera.height),s=0,E=0;E<o.draw_data.length;E++)s+=o.draw_data[E].bundles.length;var c=o.debug_render_calls;o.type!=_.MAIN_CUBE_REFLECT&&o.type!=_.MAIN_CUBE_REFLECT_BLEND||(s*=6);var l=o.do_render&&!o.force_do_not_render,T=l?o.debug_render_time:0;o.enqueue||(o.debug_render_time=0),u(l?" (\u2713)":" (\u2715)",_.subs_label(o),o.num_lights,i,c,"of",s,"  ",T.toFixed(3)),o.debug_render_calls=0,t+=s,l&&(n+=c,a+=T)}}),[t,n,a]}u("No INFO")}function T(){E[0]++}function u(){for(var e=n,t=a+E[0]*o,r=arguments[0],_=1;_<arguments.length;_++)r+=d(i[_]-String(arguments[_]).length)+arguments[_];T(),s.fillText(r,e,t)}function d(e){for(var t="",r=0;r<e;r++)t+=" ";return t}function f(e,t,r,_,n){return n.x=e,n.y=t,n.w=r,n.h=_,n}function P(e,t,r){var _=e.w*t;return r.x=e.x+_,r.y=e.y,r.w=e.w-2*_,r.h=e.h,r}function A(e){return e.x+e.w/2}function S(e){var t={x:0,y:0,w:0,h:0};return f(0,0,s.canvas.width,s.canvas.height,t),P(t,.01,t),function(e,t,r){var _=.02*e.h;r.x=e.x,r.y=e.y+_,r.w=e.w,r.h=e.h-2*_}(t,0,t),function(t,r,_,n){var a=t.w/8;n.x=t.x+a*e,n.y=t.y,n.w=a,n.h=t.h}(t,0,0,t),P(t,.02,t),t}function p(e,t,r,_,n){var a=_[0],o=_[1],i=_[2],s=_[3],E=_[5],c=(s-i)/_[4];if(c<1)var l=Math.floor(1/c-1e-5).toFixed(0).length;else l=0;if(E)var T=Math.log(o/i)/Math.log(s/i);else T=(o-i)/(s-i);if(e.textAlign="center",e.fillText(n?"["+a+"]":a,A(r),r.y),e.strokeStyle="#00FF00",e.lineWidth=t?3:1,t?(e.textAlign="right",e.fillText(s.toFixed(l),A(r)-10,r.y+15),e.textAlign="right",e.fillText(i.toFixed(l),A(r)-10,r.y+r.h-15)):(e.textAlign="right",e.fillText(i.toFixed(l),r.x+28,r.y+15),e.textAlign="left",e.fillText(s.toFixed(l),r.x+r.w-28,r.y+15)),e.beginPath(),t){var u=r.y+15+(r.h-30)*(1-T);e.moveTo(A(r),r.y+15),e.lineTo(A(r),r.y+r.h-15),e.moveTo(A(r)-5,r.y+15),e.lineTo(A(r)+5,r.y+15),e.moveTo(A(r)-5,r.y+r.h-15),e.lineTo(A(r)+5,r.y+r.h-15),e.moveTo(A(r)-5,u),e.lineTo(A(r)+5,u)}else{var d=r.x+30+(r.w-60)*T;e.moveTo(r.x+30,r.y+15),e.lineTo(r.x+r.w-30,r.y+15),e.moveTo(r.x+30,r.y+15-5),e.lineTo(r.x+30,r.y+15+5),e.moveTo(r.x+r.w-30,r.y+15-5),e.lineTo(r.x+r.w-30,r.y+15+5),e.moveTo(d,r.y+15-5),e.lineTo(d,r.y+15+5)}if(e.stroke(),"EQ_Q"==a){var f=1+1/(2*o*o)+Math.sqrt((2+1/(o*o))*(2+1/(o*o))/4-1),P=Math.log(f)/Math.log(2);t?(e.textAlign="left",e.fillText(o.toFixed(l),A(r)+10,u),e.textAlign="left",e.fillText("("+P.toFixed(l+1)+")",A(r)+10,u+10)):(e.textAlign="right",e.fillText(o.toFixed(l),d,r.y+30),e.textAlign="left",e.fillText("("+P.toFixed(l+1)+")",d,r.y+30))}else t?(e.textAlign="left",e.fillText(o.toFixed(l),A(r)+10,u)):(e.textAlign="center",e.fillText(o.toFixed(l),d,r.y+30))}t.init=function(e){var t=e.getContext("2d");return c(t),s=t,t},t.update_dim=function(){s&&c(s)},t.reset=function(){var e=s;e&&(e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillStyle="rgba(0,0,0,0.5)",e.fillRect(0,0,e.canvas.width,e.canvas.height),E[0]=0,E[1]=0)},t.show_debug_info=function(e,t){var r=s;if(r){r.textAlign="left",r.fillStyle="rgba(0,255,0,255)",u(" FPS",(1/t).toFixed(2)),T();for(var _=0,n=0,a=0,o=0;o<e.length;o++){var i=l(e[o]);_+=i[0],n+=i[1],a+=i[2],T()}u(" ----------------------------------------------------------------"),u("    ","TOTAL ACTIVE","","",n,"of",_,"  ",a.toFixed(3))}},t.print=function(){var e=s;e&&(e.textAlign="left",e.fillStyle="rgba(0,255,0,255)",u.apply(Math,arguments))},t.plot_array=function(e,t,r,_,n,a,o){var i=s;if(i){var E=S(t);if(function(e,t,r,_){var n=e.h/5;_.x=e.x,_.y=e.y+4*n,_.w=e.w,_.h=n}(E,0,0,E),i.textAlign="center",i.fillStyle="#00FF00",s.fillText(e,A(E),E.y-10),i.strokeStyle="#00FF00",i.lineWidth=.5,i.beginPath(),i.moveTo(E.x,E.y),i.lineTo(E.x+E.w,E.y),i.lineTo(E.x+E.w,E.y+E.h),i.lineTo(E.x,E.y+E.h),i.closePath(),i.stroke(),!a&&!o){a=1e6,o=-1e6;for(var c=0;c<r.length;c++)a=Math.min(a,r[c]),o=Math.max(o,r[c])}i.textAlign="right",s.fillText(String(a),E.x-10,E.y+E.h),s.fillText(String(o),E.x-10,E.y),i.textAlign="center",s.fillText(String(_),E.x,E.y+E.h+15),s.fillText(String(n),E.x+E.w,E.y+E.h+15),i.strokeStyle="#FF0000",i.lineWidth=1.5,i.beginPath();var l=E.w/(r.length-1),T=E.h/(o-a);for(c=0;c<r.length;c++){var u=E.x+l*c,d=E.y+E.h-(r[c]-a)*T;0==c?i.moveTo(u,d):i.lineTo(u,d)}i.stroke()}},t.draw_mixer_strip=function(e,t,r,_,n,a,o){var i=s;if(i){i.textAlign="center",i.fillStyle="#00FF00",i.font="bold 12px Courier";var E=S(r);s.fillText(t?"["+e+"]":e,A(E),E.y),a>=0&&s.fillText(a?"[M]":"[ ]",A(E)-15,E.y+30),o>=0&&s.fillText(o?"[S]":"[ ]",A(E)+15,E.y+30);for(var c={x:0,y:0,w:0,h:0},l=0;l<_.length;l++){var T=_[l],u="VOLUME"==T[0];u?f(E.x,E.y+350,E.w,250,c):f(E.x,E.y+50+50*l,E.w,E.h,c),p(i,u,c,T,l==n)}}}}),ds=A("__input",function(e,t){var r=Us(e),_=aE(e),n=Wo(e),a=ga(e),o=n.defaults,i=n.hmd_params,s=ba(),E=ba(),c=B(),l=10,T=20,u=30,d=40,f=50,P=60,A=70,S=80,p=90;t.DEVICE_GYRO=l,t.DEVICE_HMD=T,t.DEVICE_MOUSE=u,t.DEVICE_KEYBOARD=d,t.DEVICE_TOUCH=f,t.DEVICE_GAMEPAD0=P,t.DEVICE_GAMEPAD1=A,t.DEVICE_GAMEPAD2=S,t.DEVICE_GAMEPAD3=p;var m=1,O=2,v=4,N=8,g=16;t.HMD_WEBVR_DESKTOP=O,t.HMD_WEBVR_MOBILE=v,t.HMD_NON_WEBVR=m,t.HMD_WEBVR1=N,t.HMD_WEBVR1_1=g;var h=0,R=23,I=40,b=41,Y=50,L=60,M=70,x=80,y=90,w=100,U=110,C=120,D=130,F=140,G=141;t.HMD_WEBVR_TYPE=h,t.HMD_ORIENTATION_QUAT=10,t.HMD_POSITION=20,t.HMD_FOV_LEFT=21,t.HMD_FOV_RIGHT=22,t.HMD_EYE_DISTANCE=R,t.HMD_DISTORTION=24,t.HMD_BASELINE_DIST=25,t.HMD_SCREEN_LENS_DIST=26,t.HMD_SCREEN_WIDTH=27,t.HMD_SCREEN_HEIGHT=28,t.HMD_BEVEL_SIZE=29,t.HMD_PROJ_LEFT=30,t.HMD_PROJ_RIGHT=31,t.MOUSE_LOCATION=I,t.MOUSE_LOCATION_PL=b,t.MOUSE_DOWN_WHICH=Y,t.MOUSE_UP_WHICH=L,t.MOUSE_WHEEL=M,t.KEYBOARD_UP=x,t.KEYBOARD_DOWN=y,t.KEYBOARD_DOWN_MODIFIED=91,t.TOUCH_START=w,t.TOUCH_MOVE=U,t.TOUCH_END=C,t.GYRO_ORIENTATION_QUAT=D,t.GYRO_ORIENTATION_ANGLES=F,t.GMPD_BUTTON_0=300,t.GMPD_BUTTON_1=301,t.GMPD_BUTTON_2=302,t.GMPD_BUTTON_3=303,t.GMPD_BUTTON_4=304,t.GMPD_BUTTON_5=305,t.GMPD_BUTTON_6=306,t.GMPD_BUTTON_7=307,t.GMPD_BUTTON_8=308,t.GMPD_BUTTON_9=309,t.GMPD_BUTTON_10=310,t.GMPD_BUTTON_11=311,t.GMPD_BUTTON_12=312,t.GMPD_BUTTON_13=313,t.GMPD_BUTTON_14=314,t.GMPD_BUTTON_15=315,t.GMPD_BUTTON_16=316,t.GMPD_BUTTON_17=317,t.GMPD_BUTTON_18=318,t.GMPD_BUTTON_19=319,t.GMPD_BUTTON_20=320,t.GMPD_BUTTON_21=321,t.GMPD_BUTTON_22=322,t.GMPD_BUTTON_23=323,t.GMPD_BUTTON_24=324,t.GMPD_BUTTON_25=325,t.GMPD_TRACKPAD_BUTTON=300,t.GMPD_TRIGGER_BUTTON=301,t.GMPD_GRIPS_BUTTON=302,t.GMPD_MENU_BUTTON=303,t.GMPD_AXIS_0=326,t.GMPD_AXIS_1=327,t.GMPD_AXIS_2=328,t.GMPD_AXIS_3=329,t.GMPD_AXIS_4=330,t.GMPD_AXIS_5=331,t.GMPD_AXIS_6=332,t.GMPD_AXIS_7=333,t.GMPD_AXIS_8=334,t.GMPD_AXIS_9=335,t.GMPD_AXIS_10=336,t.GMPD_AXIS_11=337;var k=Yr(),K=Yr(),X=ve(),Q=new Float32Array(2),z=ve(),V=Yr(),j="ontouchstart"in document.documentElement,q=[],W=100,J=2e3;function Z(e){var t=r.detect_mobile();return!(!(e!=T||navigator.getVRDevices||navigator.getVRDisplays||t&&xe())||!(e!=l||t&&window.DeviceOrientationEvent))}function $(e,r){e==l||e==T?r=window:r||(r=e==d?document:_.get_container());for(var n=0;n<q.length;n++)if(q[n].type==e&&q[n].element==r)return q[n];var a=function(e,t){if(!Z(e))return null;var r={type:e,registered:!1,orientation_quat_cb_list:[],orientation_angles_cb_list:[],mouse_down_which_cb_list:[],mouse_location_cb_list:[],mouse_up_which_cb_list:[],mouse_wheel_cb_list:[],keyboard_down_cb_list:[],keyboard_down_mod_cb_list:[],keyboard_up_cb_list:[],touch_start_cb_list:[],touch_move_cb_list:[],touch_end_cb_list:[],element:t,prevent_default:!0,registered_event_listeners:[],mouse_location:new Float32Array(2),mouse_which:0,distortion_coefs:new Float32Array(2),chromatic_aberration_coefs:new Float32Array(4),registered_cb:null,webvr_hmd_device:null,webvr_sensor_devices:null,webvr_display:null,orientation:Yr(),position:ve(),frame_data:window.VRFrameData?new VRFrameData:null,standing_tsr:ba(),fov_left:new Float32Array(4),fov_right:new Float32Array(4),inter_lens_dist:0,base_line_dist:0,screen_to_lens_dist:0,width_dist:0,height_dist:0,bevel_size:0,gamepad_btns:[],gamepad_axes:[0,0,0,0,0,0,0,0,0,0,0,0],gamepad_prev_axes:[0,0,0,0,0,0,0,0,0,0,0,0],gamepad_mapping:[]};return r.fov_left[0]=r.fov_left[1]=r.fov_left[2]=r.fov_left[3]=Math.PI/4,r.fov_right[0]=r.fov_right[1]=r.fov_right[2]=r.fov_right[3]=Math.PI/4,e==u||e==d||e==f?(r.registered=Boolean(t),e==f?document.addEventListener("touchstart",function(){}):e==d&&(r.prevent_default=!1)):e==l?r.registered=!0:e==T&&ee(r),r}(e,r);return e!=P&&e!=A&&e!=S&&e!=p||function(e){e.gamepad_mapping.push(t.GMPD_BUTTON_0,t.GMPD_BUTTON_1,t.GMPD_BUTTON_2,t.GMPD_BUTTON_3,t.GMPD_BUTTON_4,t.GMPD_BUTTON_5,t.GMPD_BUTTON_6,t.GMPD_BUTTON_7,t.GMPD_BUTTON_8,t.GMPD_BUTTON_9,t.GMPD_BUTTON_10,t.GMPD_BUTTON_11,t.GMPD_BUTTON_12,t.GMPD_BUTTON_13,t.GMPD_BUTTON_14,t.GMPD_BUTTON_15,t.GMPD_BUTTON_16,t.GMPD_BUTTON_17,t.GMPD_BUTTON_18,t.GMPD_BUTTON_19,t.GMPD_BUTTON_20,t.GMPD_BUTTON_21,t.GMPD_BUTTON_22,t.GMPD_BUTTON_23,t.GMPD_BUTTON_24,t.GMPD_BUTTON_25,t.GMPD_AXIS_0,t.GMPD_AXIS_1,t.GMPD_AXIS_2,t.GMPD_AXIS_3,t.GMPD_AXIS_4,t.GMPD_AXIS_5,t.GMPD_AXIS_6,t.GMPD_AXIS_7,t.GMPD_AXIS_8,t.GMPD_AXIS_9,t.GMPD_AXIS_10,t.GMPD_AXIS_11)}(a),a&&q.push(a),a}function ee(e){e.type==T&&(navigator.getVRDisplays?navigator.getVRDisplays().then(function(t){t.length>0&&(e.webvr_display=t[0],e.registered=!0,e.webvr_display.getFrameData(e.frame_data),e.registered_cb&&e.registered_cb())},function(t){a.error_once("WebVR displays are not found."),e.registered=!1}):navigator.getVRDevices?(navigator.getVRDevices().then(function(t){!function(e,t){var r=t.filter(function(e){return e instanceof HMDVRDevice}),_=null;r.length&&(_=r[0]);var n=null;_&&(n=t.filter(function(e){return-1!==e.deviceName.toLowerCase().indexOf("oculus")&&e.hardwareUnitId==_.hardwareUnitId&&e instanceof PositionSensorVRDevice})),e.webvr_hmd_device=_,e.webvr_sensor_devices=n}(e,t),t.length&&(e.registered=!0),e.registered_cb&&e.registered_cb()},function(t){a.error_once("WebVR devices are not found."),e.registered=!1}),te(e,i.webvr)):(function(e){var t=i.nonwebvr;e.width_dist=t.width_dist,e.height_dist=t.height_dist,e.bevel_size=t.bevel_size,te(e,t),e.inter_lens_dist=t.inter_lens_dist,e.base_line_dist=t.base_line_dist,e.screen_to_lens_dist=t.screen_to_lens_dist,re(e)}(e),e.registered=!0))}function te(e,t){e.distortion_coefs[0]=t.distortion_coefs[0],e.distortion_coefs[1]=t.distortion_coefs[1],e.chromatic_aberration_coefs[0]=t.chromatic_aberration_coefs[0],e.chromatic_aberration_coefs[1]=t.chromatic_aberration_coefs[1],e.chromatic_aberration_coefs[2]=t.chromatic_aberration_coefs[2],e.chromatic_aberration_coefs[3]=t.chromatic_aberration_coefs[3]}function re(e){var t=Math.atan(e.inter_lens_dist/2/e.screen_to_lens_dist*i.nonwebvr.distor_scale),r=t,_=t;t&&(e.fov_left[0]=e.fov_right[0]=Math.min(t,Math.PI/3)),t&&(e.fov_left[1]=e.fov_right[3]=Math.min(t,Math.PI/3)),_&&(e.fov_left[2]=e.fov_right[2]=Math.min(_,Math.PI/3)),r&&(e.fov_left[3]=e.fov_right[1]=Math.min(r,Math.PI/3))}function _e(e,t,r){switch(e.type){case T:var _=ae(e,h);if(_&m){if("left"==t)var n=e.fov_left;else n=e.fov_right;nr(n,r)}else{var o=e.webvr_display||e.webvr_hmd_device;if(o){var i=o.getEyeParameters(t);(n=i.fieldOfView||i.currentFieldOfView)?(r[0]=In(n.upDegrees),r[1]=In(n.rightDegrees),r[2]=In(n.downDegrees),r[3]=In(n.leftDegrees)):_&g&&(H("left"==t?e.frame_data.leftProjectionMatrix:e.frame_data.rightProjectionMatrix,c),r[0]=Math.atan(-X[1]/X[2]),r[1]=Math.atan(-X[0]/X[2]),r[2]=Math.atan(X[1]/X[2]),r[3]=Math.atan(X[0]/X[2]))}}break;default:a.error("fov is undefined for device: ",e.type)}return r}function ne(e,t,r){switch(e.type){case T:e.webvr_display&&("left"==t?H(e.frame_data.leftProjectionMatrix,r):"right"==t?H(e.frame_data.rightProjectionMatrix,r):a.error("Unknown type of eye: ",t));break;default:a.error("Projection matrix is undefined for device: ",e.type)}return r}function ae(e,t){switch(t){case h:var r=0;return navigator.getVRDisplays&&(r|=N,e.frame_data&&(r|=g)),navigator.getVRDevices&&(r|=o.is_mobile_device?v:O),r||m;case R:var _=e.webvr_display||e.webvr_hmd_device;if(_){var n=_.getEyeParameters("left"),a=_.getEyeParameters("right");return e.webvr_display?a.offset[0]-n.offset[0]:a.eyeTranslation.x-n.eyeTranslation.x}return e.inter_lens_dist}}function oe(e,t){if(e.webvr_display){var r=e.webvr_display;if(e.frame_data&&r.getFrameData(e.frame_data)){var _=e.frame_data.pose,n=dn(e.frame_data.leftViewMatrix,X);e.inter_lens_dist=2*De(n)}else _=r.getPose();if(_){var a=Dr(P_,Math.PI/2,k);if(r.stageParameters&&r.stageParameters.sittingToStandingTransform){var o=za(r.stageParameters.sittingToStandingTransform,s);xa(E),o=Va(Da(a,E),o,e.standing_tsr)}else xa(s),o=Da(a,e.standing_tsr);_.orientation&&eo(_.orientation,o,e.orientation),_.position&&ja(_.position,o,e.position)}}}function ie(e,t){if(e){for(var r=0;r<e.buttons.length;r++)t.gamepad_btns[r]=e.buttons[r].value||+e.buttons[r].pressed;if(e.axes)for(r=0;r<e.axes.length;r++)t.gamepad_axes[r]=e.axes[r];var _=e.pose;if(_){var n=$(T).standing_tsr;_.position&&ja(_.position,n,t.position),_.orientation&&eo(_.orientation,n,t.orientation)}}}function se(e){for(var t=0;t<e.gamepad_btns;t++)e.gamepad_btns[t]=0;for(t=0;t<e.gamepad_axes.length;t++)e.gamepad_prev_axes[t]=e.gamepad_axes[t],e.gamepad_axes[t]=0;e.position.set(u_),e.orientation.set(d_)}function Ee(e,t){var r=e.indexOf(t);r>=0&&(e[r]=null)}function ce(e){return null===e}function le(e,t,r,_){switch(t){case D:r&&Ee(e.orientation_quat_cb_list,r),(_||e.orientation_angles_cb_list.every(ce)&&e.orientation_quat_cb_list.every(ce))&&(e.orientation_quat_cb_list.length=0,e.orientation_angles_cb_list.length=0,(n=e.registered_event_listeners.indexOf(t=G))>=0&&(e.registered_event_listeners.splice(n,1),e.element.removeEventListener("deviceorientation",de,!1)));break;case F:r&&Ee(e.orientation_angles_cb_list,r),(_||e.orientation_angles_cb_list.every(ce)&&e.orientation_quat_cb_list.every(ce))&&(e.orientation_quat_cb_list.length=0,e.orientation_angles_cb_list.length=0,(n=e.registered_event_listeners.indexOf(t=G))>=0&&(e.registered_event_listeners.splice(n,1),e.element.removeEventListener("deviceorientation",de,!1)));break;case Y:r&&Ee(e.mouse_down_which_cb_list,r),(_||e.mouse_down_which_cb_list.every(ce))&&(e.mouse_down_which_cb_list.length=0,(n=e.registered_event_listeners.indexOf(t))>=0&&(e.registered_event_listeners.splice(n,1),e.element.removeEventListener("mousedown",Se,!1)));break;case I:r&&Ee(e.mouse_location_cb_list,r),(_||e.mouse_location_cb_list.every(ce))&&(e.mouse_location_cb_list.length=0,(n=e.registered_event_listeners.indexOf(t))>=0&&(e.registered_event_listeners.splice(n,1),e.element.removeEventListener("mousemove",Pe,!1)));break;case b:r&&Ee(e.mouse_location_cb_list,r),(_||e.mouse_location_cb_list.every(ce))&&(e.mouse_location_cb_list.length=0,(n=e.registered_event_listeners.indexOf(t))>=0&&(e.registered_event_listeners.splice(n,1),e.element.removeEventListener("mousemove",Ae,!1)));break;case L:if(r&&Ee(e.mouse_up_which_cb_list,r),_||e.mouse_up_which_cb_list.every(ce)){e.mouse_up_which_cb_list.length=0,(n=e.registered_event_listeners.indexOf(t))>=0&&(e.registered_event_listeners.splice(n,1),e.element.removeEventListener("mouseout",pe,!1),e.element.removeEventListener("mouseup",me,!1));break}break;case M:r&&Ee(e.mouse_wheel_cb_list,r),(_||e.mouse_wheel_cb_list.every(ce))&&(e.mouse_wheel_cb_list.length=0,(n=e.registered_event_listeners.indexOf(t))>=0&&(e.registered_event_listeners.splice(n,1),e.element.removeEventListener("wheel",Ne,!1)));break;case y:r&&Ee(e.keyboard_down_cb_list,r),(_||e.keyboard_down_cb_list.every(ce))&&(e.keyboard_down_cb_list.length=0,(n=e.registered_event_listeners.indexOf(t))>=0&&(e.registered_event_listeners.splice(n,1),e.element.removeEventListener("keydown",ge,!1)));break;case x:r&&Ee(e.keyboard_up_cb_list,r),(_||e.keyboard_up_cb_list.every(ce))&&(e.keyboard_up_cb_list.length=0,(n=e.registered_event_listeners.indexOf(t))>=0&&(e.registered_event_listeners.splice(n,1),e.element.removeEventListener("keyup",Re,!1)));break;case w:r&&Ee(e.touch_start_cb_list,r),(_||e.touch_start_cb_list.every(ce))&&(e.touch_start_cb_list.length=0,(n=e.registered_event_listeners.indexOf(t))>=0&&(e.registered_event_listeners.splice(n,1),e.element.removeEventListener("touchstart",Ie,!1)));break;case U:r&&Ee(e.touch_move_cb_list,r),(_||e.touch_move_cb_list.every(ce))&&(e.touch_move_cb_list.length=0,(n=e.registered_event_listeners.indexOf(t))>=0&&(e.registered_event_listeners.splice(n,1),e.element.removeEventListener("touchmove",be,!1)));break;case C:var n;r&&Ee(e.touch_end_cb_list,r),(_||e.touch_end_cb_list.every(ce))&&(e.touch_end_cb_list.length=0,(n=e.registered_event_listeners.indexOf(t))>=0&&(e.registered_event_listeners.splice(n,1),e.element.removeEventListener("touchend",Ye,!1)))}}function Te(){return/iPad|iPhone|iPod/.test(navigator.platform)}function ue(e,t){if(_n(e,L_,t),"orientation"in window)var r=In(window.orientation);else r="orientation"in window.screen?In(window.screen.orientation.angle):0;return Fr(t,Dr(O_,r,K),t),t}function de(e){var t=X;null===e.alpha||null===e.beta||null===e.gamma?t[0]=t[1]=t[2]=0:(t[0]=In(e.alpha),t[1]=In(e.beta),t[2]=In(e.gamma));for(var r=$(l,e.currentTarget),_=0;_<r.orientation_angles_cb_list.length;_++)(a=r.orientation_angles_cb_list[_])&&(he(t,z),a(z));if(r.orientation_quat_cb_list.length){var n=ue(t,k);for(_=0;_<r.orientation_quat_cb_list.length;_++){var a;(a=r.orientation_quat_cb_list[_])&&(nr(n,V),a(V))}}for(_=0;_<r.orientation_quat_cb_list.length;_++)r.orientation_quat_cb_list[_]||r.orientation_quat_cb_list.splice(_,1);for(_=0;_<r.orientation_angles_cb_list.length;_++)r.orientation_angles_cb_list[_]||r.orientation_angles_cb_list.splice(_,1)}function fe(e,t){switch(e.type){case u:e.mouse_location[0]=t.clientX,e.mouse_location[1]=t.clientY,e.mouse_which=t.which}}function Pe(e){if(j){if(e.sourceCapabilities&&e.sourceCapabilities.firesTouchEvents)return;if(5==e.mozInputSource)return}var t=$(u,e.currentTarget);fe(t,e);for(var r=0;r<t.mouse_location_cb_list.length;r++){var _=t.mouse_location_cb_list[r];_&&(Q[0]=e.clientX,Q[1]=e.clientY,_(Q))}for(t.prevent_default&&e.preventDefault(),r=0;r<t.mouse_location_cb_list.length;r++)t.mouse_location_cb_list[r]||t.mouse_location_cb_list.splice(r,1)}function Ae(e){if(j){if(e.sourceCapabilities&&e.sourceCapabilities.firesTouchEvents)return;if(5==e.mozInputSource)return}var t=$(u,e.currentTarget);fe(t,e);for(var r=0;r<t.mouse_location_cb_list.length;r++){var _=t.mouse_location_cb_list[r];if(_){if("number"==typeof e.movementX)var n=e.movementX,a=e.movementY;else"number"==typeof e.webkitMovementX?(n=e.webkitMovementX,a=e.webkitMovementY):"number"==typeof e.mozMovementX?(n=e.mozMovementX,a=e.mozMovementY):(n=0,a=0);Q[0]=n,Q[1]=a,_(Q)}}for(t.prevent_default&&e.preventDefault(),r=0;r<t.mouse_location_cb_list.length;r++)t.mouse_location_cb_list[r]||t.mouse_location_cb_list.splice(r,1)}function Se(e){if(j){if(e.sourceCapabilities&&e.sourceCapabilities.firesTouchEvents)return;if(5==e.mozInputSource)return}var t=$(u,e.currentTarget);fe(t,e);for(var r=0;r<t.mouse_down_which_cb_list.length;r++){var _=t.mouse_down_which_cb_list[r];_&&_(e.which)}for(t.prevent_default&&(window.frameElement&&window.frameElement.focus(),e.preventDefault()),r=0;r<t.mouse_down_which_cb_list.length;r++)t.mouse_down_which_cb_list[r]||t.mouse_down_which_cb_list.splice(r,1)}function pe(e){!_.is_child(e.relatedTarget)&&e.which&&me(e)}function me(e){if(j){if(e.sourceCapabilities&&e.sourceCapabilities.firesTouchEvents)return;if(5==e.mozInputSource)return}var t=$(u,e.currentTarget);fe(t,e);for(var r=0;r<t.mouse_up_which_cb_list.length;r++){var _=t.mouse_up_which_cb_list[r];_&&_(e.which)}for(t.prevent_default&&e.preventDefault(),r=0;r<t.mouse_up_which_cb_list.length;r++)t.mouse_up_which_cb_list[r]||t.mouse_up_which_cb_list.splice(r,1)}function Oe(e){var t=0;return e.wheelDelta?t=e.wheelDelta%120==0?e.wheelDelta/120:W_(e.wheelDelta):e.deltaY&&(t=e.deltaY%3==0?-e.deltaY/3:-W_(e.deltaY)),Un(W*t,-J,J)}function Ne(e){for(var t=$(u,e.currentTarget),r=0;r<t.mouse_wheel_cb_list.length;r++){var _=t.mouse_wheel_cb_list[r];_&&_(Oe(e))}for(t.prevent_default&&e.preventDefault(),r=0;r<t.mouse_wheel_cb_list.length;r++)t.mouse_wheel_cb_list[r]||t.mouse_wheel_cb_list.splice(r,1)}function ge(e){for(var t=$(d,e.currentTarget),r=e.ctrlKey||e.altKey||e.metaKey?t.keyboard_down_mod_cb_list:t.keyboard_down_cb_list,_=0;_<r.length;_++){var n=r[_];n?n(e.keyCode):r.splice(_--,1)}t.prevent_default&&e.preventDefault()}function Re(e){for(var t=$(d,e.currentTarget),r=0;r<t.keyboard_up_cb_list.length;r++){var _=t.keyboard_up_cb_list[r];_&&_(e.keyCode)}for(t.prevent_default&&e.preventDefault(),r=0;r<t.keyboard_up_cb_list.length;r++)t.keyboard_up_cb_list[r]||t.keyboard_up_cb_list.splice(r,1)}function Ie(e){for(var t=$(f,e.currentTarget),r=0;r<t.touch_start_cb_list.length;r++){var _=t.touch_start_cb_list[r];_&&_(e.targetTouches)}for(r=0;r<t.touch_start_cb_list.length;r++)t.touch_start_cb_list[r]||t.touch_start_cb_list.splice(r,1)}function be(e){for(var t=$(f,e.currentTarget),r=0;r<t.touch_move_cb_list.length;r++){var _=t.touch_move_cb_list[r];_&&_(e.targetTouches)}for(t.prevent_default&&e.preventDefault(),r=0;r<t.touch_move_cb_list.length;r++)t.touch_move_cb_list[r]||t.touch_move_cb_list.splice(r,1)}function Ye(e){for(var t=$(f,e.currentTarget),r=0;r<t.touch_end_cb_list.length;r++){var _=t.touch_end_cb_list[r];_&&_(e.targetTouches)}for(r=0;r<t.touch_end_cb_list.length;r++)t.touch_end_cb_list[r]||t.touch_end_cb_list.splice(r,1)}function Le(e){switch(e){case 0:var t=P;break;case 1:t=A;break;case 2:t=S;break;case 3:t=p;break;default:t=P}return t}function Me(e,t){return e.gamepad_mapping[t]}function xe(){return!!(window.document.fullscreenEnabled||window.document.mozFullScreenEnabled||window.document.msFullscreenEnabled||window.document.webkitFullscreenEnabled)}t.can_use_device=Z,t.init=function(){if("HMD"==o.stereo||"NONE"==o.stereo&&o.is_mobile_device){var e=$(T);e&&document.addEventListener("onvrdisplayconnect",function(t){e.webvr_display=t.display,e.registered=!0,e.webvr_display.getFrameData(e.frame_data)})}},t.get_device_by_type_element=$,t.request_register_device=ee,t.switch_prevent_default=function(e,t){e.prevent_default=t},t.reset_device=function(e){switch(e.type){case T:if(e.registered)if(e.webvr_display)e.webvr_display.resetPose();else if(e.webvr_sensor_devices)for(var t=0;t<e.webvr_sensor_devices.length;t++)e.webvr_sensor_devices[t].resetSensor();break;default:return void a.error("reset_device() is undefined for device: ",e.type)}},t.get_vector_param=function(e,t,r){switch(t){case 10:return function(e,t){switch(e.type){case T:if(he(d_,t),e.webvr_display)t[0]=e.orientation[0],t[1]=e.orientation[1],t[2]=e.orientation[2],t[3]=e.orientation[3];else if(e.webvr_sensor_devices)for(var r=0;r<e.webvr_sensor_devices.length;r++){var _=e.webvr_sensor_devices[r],n=_.getState&&_.getState()||_.getImmediateState&&_.getImmediateState();n.orientation&&(t[0]=n.orientation.x,t[1]=n.orientation.y,t[2]=n.orientation.z,t[3]=n.orientation.w)}return t;default:return a.error("orientation_quat is undefined for device: ",e.type),t}}(e,r);case 20:return function(e,t){switch(e.type){case T:if(he(f_,t),e.webvr_display)t[0]=e.position[0],t[1]=e.position[1],t[2]=e.position[2];else if(e.webvr_sensor_devices)for(var r=0;r<e.webvr_sensor_devices.length;r++){var _=e.webvr_sensor_devices[r],n=_.getState&&_.getState()||_.getImmediateState&&_.getImmediateState();n.position&&(t[0]=n.position.x,t[1]=-n.position.z,t[2]=n.position.y)}return t;default:return a.error("position is undefined for device: ",e.type),t}}(e,r);case 21:return _e(e,"left",r);case 22:return _e(e,"right",r);case 30:return ne(e,"left",r);case 31:return ne(e,"right",r);case I:case b:return r[0]=e.mouse_location[0],r[1]=e.mouse_location[1],r}},t.get_value_param=ae,t.set_config=function(e,t,r){switch(e.type){case T:if(ae(e,h)&N)break;switch(t){case 24:e.distortion_coefs[0]=r[0],e.distortion_coefs[1]=r[1];break;case R:e.inter_lens_dist=r,re(e);break;case 25:e.base_line_dist=r,re(e);break;case 26:e.screen_to_lens_dist=r,re(e);break;case 27:e.width_dist=r,re(e);break;case 28:e.height_dist=r,re(e);break;case 29:e.bevel_size=r,re(e)}break;case P:case A:case S:case p:e.gamepad_mapping[t]=r}},t.get_gamepad_btn_value=function(e,t){var r=t-300;return r<e.gamepad_btns.length&&e.gamepad_btns[Me(e,r)-300]},t.get_gamepad_axis_value=function(e,t){return t-326<e.gamepad_axes.length?e.gamepad_axes[Me(e,t-300)-326]:0},t.get_gamepad_position=function(e,t){return t.set(e.position),t},t.get_gamepad_orientation=function(e,t){return t.set(e.orientation),t},t.update=function(e){for(var t=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads:[],r=0;r<q.length;r++){var _=q[r];switch(_.type){case P:se(_),ie(t[0],_);break;case A:se(_),ie(t[1],_);break;case S:se(_),ie(t[2],_);break;case p:se(_),ie(t[3],_);break;case T:oe(_)}}},t.attach_param_cb=function(e,t,r){switch(t){case D:e.orientation_quat_cb_list.push(r),t=G;break;case F:e.orientation_angles_cb_list.push(r),t=G;break;case Y:e.mouse_down_which_cb_list.push(r);break;case I:case b:e.mouse_location_cb_list.push(r);break;case L:e.mouse_up_which_cb_list.push(r);break;case M:e.mouse_wheel_cb_list.push(r);break;case y:e.keyboard_down_cb_list.push(r);break;case 91:e.keyboard_down_mod_cb_list.push(r),t=y;break;case x:e.keyboard_up_cb_list.push(r);break;case w:e.touch_start_cb_list.push(r);break;case U:e.touch_move_cb_list.push(r);break;case C:e.touch_end_cb_list.push(r)}-1==e.registered_event_listeners.indexOf(t)&&(e.registered_event_listeners.push(t),e.registered&&function(e,r){switch(t){case Y:Te()||e.element.addEventListener("mousedown",Se,!1);break;case I:e.element.addEventListener("mousemove",Pe,!1);break;case b:e.element.addEventListener("mousemove",Ae,!1);break;case L:Te()||(e.element!=window&&e.element.addEventListener("mouseout",pe,!1),e.element.addEventListener("mouseup",me,!1));break;case M:e.element.addEventListener("wheel",Ne,!1);break;case y:e.element.addEventListener("keydown",ge,!1);break;case x:e.element.addEventListener("keyup",Re,!1);break;case w:e.element.addEventListener("touchstart",Ie,!1);break;case U:e.element.addEventListener("touchmove",be,!1);break;case C:e.element.addEventListener("touchend",Ye,!1);break;case G:e.element.addEventListener("deviceorientation",de,!1)}}(e))},t.detach_param_cb=function(e,t,r){le(e,t,r,!1)},t.gyro_angles_to_quat=ue,t.cleanup=function(){for(var e=0;e<q.length;e++)for(var t=q[e],r=0;r<t.registered_event_listeners.length;r++)le(t,t.registered_event_listeners[r],null,!0);q.length=0},t.get_pressed_gmpd_btn=function(e){for(var t=$(Le(e)),r=0;r<t.gamepad_btns.length;r++)if(t.gamepad_btns[r])return r+300;return-1},t.get_moved_gmpd_axis=function(e){for(var t=$(Le(e)),r=0;r<t.gamepad_axes.length;r++)if(t.gamepad_prev_axes[r]-t.gamepad_axes[r])return r+326;return-1},t.get_first_gmpd_id=function(){for(var e=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads:[],t=0;t<e.length;t++)if(e[t])return t;return 0},t.get_webvr_display=function(){var e=$(T);return e&&e.webvr_display},t.activate_pointerlock=function(e){e.element.addEventListener("mousedown",function(t){e.value||function(e){var t=e.element,r=function(){document.pointerLockElement===t||document.webkitPointerLockElement===t||document.mozPointerLockElement===t?e.value=1:(e.value=0,document.removeEventListener("pointerlockchange",r,!1),document.removeEventListener("webkitpointerlockchange",r,!1),document.removeEventListener("mozpointerlockchange",r,!1))};document.addEventListener("pointerlockchange",r,!1),document.addEventListener("webkitpointerlockchange",r,!1),document.addEventListener("mozpointerlockchange",r,!1);var _=t.requestPointerLock||t.webkitRequestPointerLock||t.mozRequestPointerLock;"function"==typeof _&&_.apply(t)}(e)},!1)},t.add_click_listener=function(e,t){e.addEventListener(o.is_mobile_device?"touchend":"mouseup",t)},t.remove_click_listener=function(e,t){e.removeEventListener(o.is_mobile_device?"touchend":"mouseup",t)},t.check_fullscreen=xe}),fs=A("__prerender",function(e,t){var r=ni(e),_=wi(e),n=Ms(e),a=Qi(e),o=ai(e),i=!0,s=[o.MAIN_OPAQUE,o.MAIN_BLEND,o.MAIN_PLANE_REFLECT,o.MAIN_CUBE_REFLECT,o.MAIN_PLANE_REFLECT_BLEND,o.MAIN_CUBE_REFLECT_BLEND,o.MAIN_GLOW,o.MAIN_XRAY,o.SHADOW_CAST,o.SHADOW_RECEIVE,o.OUTLINE_MASK,o.DEBUG_VIEW,o.COLOR_PICKING,o.COLOR_PICKING_XRAY],E=new Float32Array(3);function c(e){e.sort(l)}function l(e,t){return e.z_index-t.z_index}function T(e,t){if(e.world_bounds){var r=e.world_bounds.bs;return Ce(r.center,t)+r.radius*r.radius}return 1/0}function u(e,t){var _=e.obj_render;if(_.is_visible=!1,_.hide)return!1;var a=t.camera;if(t.type==o.SHADOW_CAST)var s=a.lod_eye;else s=Ga(a.world_tsr,E);var c,l,T,u,d,f=e.batch;return!!n.update_lod_visibility(f,_,s)&&(_.is_visible=!0,t.type==o.DEBUG_VIEW?t.debug_view_mode==r.DV_BOUNDINGS?f.debug_sphere:!f.debug_sphere:!(t.type==o.OUTLINE_MASK&&0==_.outline_intensity||!f.do_not_cull&&e.world_bounds&&i&&(c=a.frustum_planes,l=e.world_bounds.bs,T=e.world_bounds.be,u=f.use_be,d=l.center,function(e,t,r){return r<-At(e,t.near)||r<-At(e,t.left)||r<-At(e,t.right)||r<-At(e,t.top)||r<-At(e,t.bottom)||r<-At(e,t.far)}(d,c,l.radius)||u&&function(e,t,r,_,n){var a=Be(r,t.far),o=Be(_,t.far),i=Be(n,t.far),s=Math.sqrt(a*a+o*o+i*i);return s<-At(e,t.near)||s<-At(e,t.far)||(a=Be(r,t.left),o=Be(_,t.left),i=Be(n,t.left),Math.sqrt(a*a+o*o+i*i)<-At(e,t.left)||(a=Be(r,t.right),o=Be(_,t.right),i=Be(n,t.right),Math.sqrt(a*a+o*o+i*i)<-At(e,t.right)||(a=Be(r,t.top),o=Be(_,t.top),i=Be(n,t.top),Math.sqrt(a*a+o*o+i*i)<-At(e,t.top)||(a=Be(r,t.bottom),o=Be(_,t.bottom),i=Be(n,t.bottom),Math.sqrt(a*a+o*o+i*i)<-At(e,t.bottom)))))}(d=T.center,c,T.axis_x,T.axis_y,T.axis_z))))}function d(e){var t=e.particles_data;if(t&&t.need_buffers_update){var r=e.bufs_data;_.make_dynamic(r);var n=r.pointers;_.vbo_source_data_set_attr(r.vbo_source_data,"a_position",t.positions_cache,n.a_position.offset),_.vbo_source_data_set_attr(r.vbo_source_data,"a_tbn",t.tbn_cache,n.a_tbn.offset),_.update_gl_buffers(r)}}t.prerender_subs=function(e){if(s.indexOf(e.type)>-1){for(var t=!1,r=e.type==o.MAIN_CUBE_REFLECT||e.type==o.MAIN_CUBE_REFLECT_BLEND,_=e.draw_data,n=0;n<_.length;n++){for(var i=_[n],l=i.bundles,f=!1,P=0;P<l.length;P++){var A=(m=l[P]).batch;if(r)for(var S=0;S<6;S++)e.camera.frustum_planes=e.cube_cam_frustums[S],m.do_render_cube[S]=u(m,e),m.do_render_cube[S]&&(t=!0,f=!0,d(A));else m.do_render=u(m,e),m.do_render&&(t=!0,f=!0,d(A));if(e.need_perm_uniforms_update&&(A.shader.need_uniforms_update=!0),m.do_render){var p=T(m,Ga(e.camera.world_tsr,E));m.z_index=p}else m.z_index=1/0}l.length>0&&!l[0].batch.blend&&(c(l),_.z_index=l[0].z_index),i.do_render=f}switch(e.need_perm_uniforms_update=!1,e.type){case o.DEBUG_VIEW:break;default:e.type==o.MAIN_OPAQUE||e.type==o.SHADOW_RECEIVE||e.type==o.MAIN_GLOW||e.type==o.MAIN_PLANE_REFLECT||e.type==o.MAIN_CUBE_REFLECT||t?e.do_render=!0:(e.do_render&&a.clear(e),e.do_render=!1)}}else if(e.need_perm_uniforms_update){for(_=e.draw_data,n=0;n<_.length;n++)for(l=_[n].bundles,P=0;P<l.length;P++){var m;(A=(m=l[P]).batch).shader.need_uniforms_update=!0}e.need_perm_uniforms_update=!1}e.need_draw_data_sort&&o.sort_draw_data(e)}}),Ps=A("__primitives",function(e,t){var r=ha(e),_=Wo(e),n=wi(e),a=_.defaults;function o(e,t,r,_){for(var a=[],o=[],i=[],s=e*t,E=2*r/(e-1),c=2*_/(t-1),l=0;l<e;l++)for(var T=l*E-r,u=0;u<t;u++)if(o.push(T,u*c-_,0),i.push(l/(e-1),u/(t-1)),l&&u){var d=l*t+u,f=d-1,P=(l-1)*t+u,A=P-1;a.push(d,f,P),a.push(f,A,P)}var S=n.create_empty_va_frame();S.a_position=new Float32Array(o),S.a_tbn=gi(s);var p=n.init_submesh("GRID_PLANE");return p.va_frames[0]=S,p.va_common.a_texcoord=new Float32Array(i),p.indices=new Uint32Array(a),p.base_length=o.length/3,p}function i(e){var t=e.length;t%4&&r.panic("Wrong array");for(var _=[],a=[],o=0;o<t;o+=4){var i=e[o+1],s=e[o+2],c=e[o+3];E(e[o],a),E(i,a),E(s,a),E(c,a),_.push(o,o+1,o+2),_.push(o,o+2,o+3)}var l=n.create_empty_va_frame();l.a_position=new Float32Array(a),l.a_tbn=gi(t/4);var T=n.init_submesh("FROM_QUADS");return T.va_frames[0]=l,T.indices=new Uint32Array(_),T.base_length=a.length/3,T}function s(e,t){var r=3*t;return[e[r],e[r+1],e[r+2]]}function E(e,t){t.push(e[0],e[1],e[2])}t.generate_line=function(){var e=n.init_submesh("LINE"),t=n.create_empty_va_frame();return t.a_position=new Float32Array(3),t.a_direction=new Float32Array(3),e.va_frames[0]=t,e.indices=new Uint32Array(1),e.base_length=1,e},t.generate_plane=function(e,t){var r=o(2,2,e,t);return r.name="PLANE",r},t.generate_grid=o,t.generate_cascaded_grid=function(e,t,r){var _=r/Math.pow(2,e-1),o=_,i=_,s=t+1,E=t+1,c=[],l=[],T=0,u=0,d=0,f=-1;function P(e,t){return e%2==1&&(0==t||t==E-1)||t%2==1&&(0==e||e==s-1)}for(var A=[],S=0;S<e;S++){for(var p=2*o/(s-1),m=2*i/(E-1),O=[],v=[],N=0;N<s;N++){for(var g=N*p-o,h=[],R=0;R<E;R++){var I=R*m-i;if(g>-u&&g<u&&I>-d&&I<d)h.push(-1);else{for(var b=null,Y=0;Y<A.length;Y+=3)if(g==A[Y]&&I==A[Y+1]){b=A[Y+2];break}if(null!==b)var L=b;else L=f+1;if(P(N,R))h.push(-2);else{if(null==b){if(0==R||R==E-1||0==N||N==s-1){if(S==e-1)var M=p;else M=2*p;O.push(g,I,L)}else M=p;l.push(g,I,M),T++,f++}h.push(L)}if(N&&R)if(1==N)P(N-1,R)?R>1?(c.push(x=(U=v[N-1][R+1])-1,w=L-1,L),c.push(U,x,L)):c.push(U=v[N-1][R+1],x=U-1,L):P(N,R)||c.push(U=v[N-1][R],w=L-1,L);else if(N==s-1){if(!P(N,R))if(R==E-1){var x=v[N-2][R];c.push(U=v[N-1][R-1],w=L-1,L),c.push(x,U,L)}else{var y=(U=v[N-1][R])+1;c.push(x=U-1,w=L-1,L),c.push(U,x,L),c.push(y,U,L),2==R&&c.push(x,y=v[N-2][R-2],w)}}else if(1==R)P(N,R-1)?c.push(w=v[N-1][R],U=v[N-1][R-1],L):(x=v[N-2][R-1],c.push(U=v[N-1][R],w=h[R-1],L),c.push(U,x,w));else if(R==E-1)P(N,R)||(x=v[N-2][R],c.push(U=v[N-1][R-1],w=h[R-1],L),c.push(x,U,L));else if(-1!=v[N-1][R]&&-1!=v[N-1][R-1]&&-1!=h[R-1]){var w;x=v[N-1][R-1],c.push(U=v[N-1][R],w=h[R-1],L),c.push(U,x,w),R==E-2&&P(N,R+1)&&c.push(y=v[N-1][R+1],U,L)}else if(R==E-2&&P(N,R+1)){var U;c.push(y=v[N-1][R+1],U=v[N-1][R],L)}}}v.push(h)}A=O,u=o,d=i,o*=2,i*=2}if(u<2e4){var C=-2*u/(s-1);l.push(-2e4,-2e4,C),l.push(-2e4,2e4,C),l.push(-u,-d,C),l.push(-u,d,C),l.push(2e4,-2e4,C),l.push(2e4,2e4,C),l.push(u,-d,C),l.push(u,d,C),c.push((L=f+1)+1,L+2,L+3,L+1,L+0,L+2,L+2,L+4,L+6,L+2,L+0,L+4,L+1,L+7,L+5,L+1,L+3,L+7,L+7,L+4,L+5,L+6,L+4,L+7),T+=8}var D=n.create_empty_va_frame();D.a_position=new Float32Array(l),D.a_tbn=gi(T),Yi(D.a_tbn,[.707,0,0,.707],D.a_tbn);var F=n.init_submesh("MULTIGRID_PLANE");return F.va_frames[0]=D,F.indices=new Uint32Array(c),F.base_length=l.length/3,a.water_wireframe_debug&&(n.submesh_drop_indices(F,1,!0),D.a_polyindex=n.extract_polyindices(F)),F},t.generate_from_triangles=function(e){var t=e.length;t%3&&r.panic("Wrong array");for(var _=[],a=[],o=0;o<t;o+=3){var i=e[o+1],s=e[o+2];E(e[o],a),E(i,a),E(s,a),_.push(o,o+1,o+2)}var c=n.create_empty_va_frame();c.a_position=new Float32Array(a);var l=n.init_submesh("FROM_TRIANGLES");return l.va_frames[0]=c,l.indices=new Uint32Array(_),l.base_length=a.length/3,l},t.generate_from_quads=i,t.generate_frustum=function(e){e=function(e,t){t||(t=[]);for(var r=0;r<e.length;r+=3){var _=new Float32Array([e[r],e[r+1],e[r+2]]);t[r/3]=_}return t}(e,[]);var t=[];t.push(e[0],e[1],e[2],e[3]),t.push(e[0],e[3],e[5],e[4]),t.push(e[3],e[2],e[6],e[5]),t.push(e[1],e[7],e[6],e[2]),t.push(e[0],e[4],e[7],e[1]),t.push(e[4],e[5],e[6],e[7]);var r=i(t);return r.name="FRUSTUM",r},t.generate_fullscreen_tri=function(){var e=n.init_submesh("FULLSCREEN_TRI"),t=n.create_empty_va_frame();return t.a_position=new Float32Array([0,0,1,0,0,1]),e.va_frames[0]=t,e.indices=new Uint32Array([0,1,2]),e.base_length=3,e},t.generate_fullscreen_quad=function(){var e=n.init_submesh("FULLSCREEN_QUAD"),t=n.create_empty_va_frame();return t.a_position=new Float32Array([-1,1,1,1,-1,-1,1,-1]),e.va_frames[0]=t,e.indices=new Uint32Array([0,2,1,1,2,3]),e.base_length=4,e},t.generate_billboard=function(){var e=n.init_submesh("BILLBOARD"),t=n.create_empty_va_frame();return t.a_bb_vertex=n.gen_bb_vertices(1),e.va_frames[0]=t,e.indices=new Uint32Array([0,2,1,0,3,2]),e.base_length=4,e},t.generate_uv_sphere=function(e,t,r,_,a,o){var i,c,l=n.init_submesh("UV_SPHERE"),T=[],u=[],d=[];for(c=0;c<=t;c++)for(i=0;i<=e;i++){var f=i/e,P=c/t,A=-r*Math.cos(2*f*Math.PI)*Math.sin(P*Math.PI),S=r*Math.cos(P*Math.PI),p=r*Math.sin(2*f*Math.PI)*Math.sin(P*Math.PI);a&&(A=Math.abs(A)<1e-5?0:A,S=Math.abs(S)<1e-5?0:S,p=Math.abs(p)<1e-5?0:p),u.push(A+_[0],S+_[1],p+_[2])}var m=0;for(c=0;c<t;c++)for(i=0;i<e;i++){var O=s(u,(e+1)*c+i+1),v=s(u,(e+1)*c+i),N=s(u,(e+1)*(c+1)+i),g=s(u,(e+1)*(c+1)+i+1);Math.abs(O[1])==r+_[1]?(E(O,T),E(N,T),E(g,T),o?d.push(m,m+1,m+1,m+2,m+2,m):d.push(m,m+1,m+2),m+=3):Math.abs(N[1])==r+_[1]?(E(O,T),E(v,T),E(N,T),o?d.push(m,m+1,m+1,m+2,m+2,m):d.push(m,m+1,m+2),m+=3):(E(O,T),E(v,T),E(N,T),E(g,T),o?(d.push(m,m+1),d.push(m+1,m+2),d.push(m+2,m+3),d.push(m+3,m)):(d.push(m,m+1,m+2),d.push(m,m+2,m+3)),m+=4)}var h={};if(h.a_position=T,o)h.a_tbn=gi();else{var R=n.calc_shared_indices(d,u,T),I=n.calc_normals(d,T,R);h.a_tbn=Ai(I)}return l.va_frames[0]=h,l.indices=d,l.base_length=T.length/3,l},t.generate_index=function(e){var t=n.init_submesh("INDEX"),r=n.create_empty_va_frame();r.a_index=new Float32Array(3*e);for(var _=new Uint16Array(3*e),a=0;a<3*e;a++)r.a_index[a]=a,_[a]=a;return t.va_frames[0]=r,t.indices=_,t.base_length=3*e,t}}),As=A("__scenegraph",function(e,t){var r=ha(e),_=oE(e),n=Wo(e),a=ws(e),o=ni(e),i=Jo(e),s=$o(e),E=Qi(e),c=ai(e),l=ys(e),T=n.debug_subs,u=n.defaults,d=n.scenes,f=!1,P=[c.GRASS_MAP,c.SHADOW_CAST,c.MAIN_CUBE_REFLECT,c.MAIN_CUBE_REFLECT_BLEND];function A(e,t){var r=[];s.traverse_edges(e,function(t,_,n){var a=n;r.indexOf(a)>-1?s.replace_edge_attr(e,t,_,a,b(a)):r.push(a)}),s.traverse(e,function(e,_){for(var n=_,a=0;a<n.slinks_internal.length;a++){var o=n.slinks_internal[a];t||n.type!=c.MAIN_PLANE_REFLECT&&n.type!=c.MAIN_CUBE_REFLECT&&n.type!=c.MAIN_XRAY||(o.use_renderbuffer=!0),r.indexOf(o)>-1?n.slinks_internal[a]=b(o):r.push(o)}})}function S(e){var t=[c.MOTION_BLUR,c.SMAA_RESOLVE,c.SMAA_NEIGHBORHOOD_BLENDING,c.MAIN_PLANE_REFLECT,c.MAIN_CUBE_REFLECT,c.PERFORMANCE];u.webgl2||t.push(c.AVERAGE_LUMINANCE);var r=s.topsort(e),_=[];s.traverse(r,function(e,n){for(var a=n,o=0;o<a.slinks_internal.length;o++){var i=a.slinks_internal[o];t.indexOf(a.type)>-1&&(i.unique_texture=!0);var E=v(_,i,p(i));i.texture=E,a.textures_internal[o]=E}for(o=0;o<a.textures_internal.length;o++)O(_,E=a.textures_internal[o]);s.traverse_outputs(r,e,function(n,o,i){var E=i;if(!E.texture){if(t.indexOf(a.type)>-1)E.unique_texture=!0;else{var c=function(e,t,r){var _=null;return s.traverse_inputs(e,t,function(e,t,n){if(n.active&&n.from==n.to&&n.from==r&&n.texture)return _=n.texture,!0}),s.traverse_outputs(e,t,function(e,t,n){if(n.active&&n.from==r&&n.texture)return _=n.texture,!0}),_}(r,e,E.from);if(c&&E.active&&!E.texture)return m(_,c),void(E.texture=c)}c=v(_,E,p(E)),E.texture=c}}),s.traverse_inputs(r,e,function(e,t,r){O(_,r.texture)}),s.traverse_outputs(r,e,function(e,t,r){r.texture&&"NONE"==r.to&&O(_,r.texture)})})}function p(e){var t=e.to,r=e.active,_=e.texture;e.to="",e.active=!1,e.texture=null;var n=i.calc_variable_id(e,0);return e.to=t,e.active=r,e.texture=_,n}function m(e,t){for(var r=0;r<e.length;r++){var _=e[r];_.tex===t&&_.ref++}}function O(e,t){for(var r=0;r<e.length;r++){var _=e[r];_.tex===t&&_.ref&&_.ref--}}function v(e,t,r){if(t.parent_slink)return m(e,t.parent_slink.texture),t.parent_slink.texture;if(t.unique_texture)return N(t);for(var _=null,n=0;n<e.length;n++){var a=e[n];if(a.id==r&&0===a.ref){_=a;break}}if(!_||f||u.firefox_tex_reuse_hack){var o=N(t);return e.push({id:r,ref:1,tex:o}),o}return _.ref++,_.tex}function N(e){var t=e.size_mult_x*e.size,_=e.size_mult_y*e.size,n=e.use_comparison,a=e.use_mipmap;switch(e.from){case"COLOR":if(e.use_renderbuffer){var o=l.create_texture(e.multisample?l.TT_RB_RGBA_MS:l.TT_RB_RGBA,n,a);l.resize(o,t,_)}else o=l.create_texture(e.floating_point?l.TT_RGBA_FLOAT:l.TT_RGBA_INT,n,a),l.resize(o,t,_),l.set_filters(o,e.min_filter,e.mag_filter);return o;case"DEPTH":return e.use_renderbuffer?(o=l.create_texture(e.multisample?l.TT_RB_DEPTH_MS:l.TT_RB_DEPTH,n,a),l.resize(o,t,_)):(o=l.create_texture(l.TT_DEPTH,n,a),l.resize(o,t,_),l.set_filters(o,e.min_filter,e.mag_filter)),o;case"CUBEMAP":return l.create_cubemap_texture(t,a);case"SCREEN":case"NONE":return null;default:r.panic("Wrong slink param: "+e.from)}}function g(e,t){var r=!1;s.traverse_edges(e,function(_,n,a){var o=a;if(o){var i=s.get_node_attr(e,_),E=s.get_node_attr(e,n);return t(o,!1,i,E)?(r=!0,!0):void 0}}),r||s.traverse(e,function(e,r){for(var _=r,n=0;n<_.slinks_internal.length;n++)if(t(_.slinks_internal[n],!0,_,null))return!0})}function h(e){s.traverse(e,function(t,r){if(r.type!=c.SINK){var n=r.camera;s.traverse_outputs(e,t,function(e,t,r){r.texture&&r.active&&r.texture&&(_.set_attachment(n,r.from,r.texture),r.from==r.to&&t.camera&&_.set_attachment(t.camera,r.from,r.texture))});for(var a=0;a<r.slinks_internal.length;a++){var o=r.slinks_internal[a];o.active&&o.from==o.to&&_.set_attachment(n,o.from,r.textures_internal[a])}!n.color_attachment&&!n.depth_attachment||n.framebuffer||(n.framebuffer=E.render_target_create(n.color_attachment,n.depth_attachment))}}),s.traverse(e,function(t,r){if(r.type==c.RESOLVE||r.type==c.COPY){var _=L(e,r);r.camera.framebuffer_prev=_[0].camera.framebuffer}})}function R(e,t){e.texel_size_multiplier=t}function I(e,t,r,_,n,a,o){return{from:e,to:t,size:r,size_mult_x:_,size_mult_y:n,update_dim:a,apply_resolution_factors:o,active:!0,texture:null,multisample:!1,floating_point:!1,use_renderbuffer:!1,min_filter:l.TF_NEAREST,mag_filter:l.TF_NEAREST,unique_texture:!1,use_comparison:!1,use_mipmap:!1}}function b(e,t){var _=I(e.from,e.to,e.size,e.size_mult_x,e.size_mult_y,e.update_dim,e.apply_resolution_factors);return _.active=e.active,!t&&e.texture&&r.panic("Failed to clone slink with attached texture"),_.texture=e.texture,_.multisample=e.multisample,_.use_renderbuffer=e.use_renderbuffer,_.min_filter=e.min_filter,_.mag_filter=e.mag_filter,_.unique_texture=e.unique_texture,_.use_comparison=e.use_comparison,_.use_mipmap=e.use_mipmap,_}function Y(e,t,r){if(t.type==r)return!0;for(var _=M(e,t),n=0;n<_.length;n++)if(Y(e,_[n],r))return!0;return!1}function L(e,t){var _=s.node_by_attr(e,t);_==s.NULL_NODE&&r.panic("Subscene not in graph");for(var n=[],a=s.in_edge_count(e,_),o=0;o<a;o++){var i=s.get_in_edge(e,_,o);i!=_&&n.push(s.get_node_attr(e,i))}return n}function M(e,t){var _=s.node_by_attr(e,t);_==s.NULL_NODE&&r.panic("Subscene not in graph");for(var n=[],a=s.out_edge_count(e,_),o=0;o<a;o++){var i=s.get_out_edge(e,_,o);i!=_&&n.push(s.get_node_attr(e,i))}return n}function x(e,t,r,_){var n,a,o="";if(o+=e.from+"\\n",o+="NONE"!=e.to?e.to+"\\n":"",o+="(",e.update_dim){var i=e.size_mult_x,s=e.size_mult_y;Math.round(i)!=i&&(i=i.toFixed(2)),Math.round(s)!=s&&(s=s.toFixed(2)),o+=(1==i?"":i)+"Sx"+(1==s?"":s)+"S",o+=e.apply_resolution_factors?" FACT":" VIEW"}else o+=e.size*(i=e.size_mult_x)+"x"+e.size*(s=e.size_mult_y);if("SCREEN"!=e.from){o+=" ",o+=e.use_renderbuffer?"RR":(a="",(n={min:e.min_filter,mag:e.mag_filter}).min==l.TF_LINEAR?a+="L":n.min==l.TF_NEAREST&&(a+="N"),n.mag==l.TF_LINEAR?a+="L":n.mag==l.TF_NEAREST&&(a+="N"),a);for(var E=0;E<_.length;E+=2)_[E]==e.texture&&(o+=" "+_[E+1])}return o+")\\n"}t.check_slink_tex_conn=function(e){switch(e.to){case"COLOR":case"CUBEMAP":case"DEPTH":case"SCREEN":case"OFFSCREEN":case"RESOLVE":case"COPY":case"NONE":return!1;default:return!0}},t.traverse_slinks=g,t.create_rendering_graph=function(e,t,r,n){var i=s.create(),E=[],f=[],p=[],m=[],O=[],v=[],N=[],g=[],Y=[],x=e.lamps_number,y=e.water_params,w=e.shore_smoothing,U=e.soft_particles,C=e.ssao,D=e.god_rays,F=e.reflection_params,G=e.materials_params,k=e.bloom_params,K=e.motion_blur,B=e.compositing,X=e.antialiasing,H=e.world_light_set,Q=e.world_fog_set,z=e.shadow_params,V=e.mb_params,j=e.cc_params,q=e.god_rays_params,W=e.outline_params,J=e.dof,Z=e.depth_tex,$=e.refractions,ee=Boolean(n.length),te=u.msaa_samples>1;u.reuse_depth_optimization=u.reuse_depth_optimization&&Boolean(z)&&!(te&&C);var re=u.reuse_depth_optimization,_e=I("COLOR","COLOR",1,1,1,!0,!0),ne=I("DEPTH","DEPTH",1,1,1,!0,!0);if(te){var ae=b(ne);_e.multisample=!0,_e.use_renderbuffer=!0,ne.multisample=!0,ne.use_renderbuffer=!0}var oe=t.cameras[0];if(e.dynamic_grass){var ie=c.create_subs_grass_map();s.append_node_attr(i,ie),ie.camera.width=de=d.grass_tex_size,ie.camera.height=de;var se=I("DEPTH","u_grass_map_depth",de,1,1,!1,!1);u.webgl2||(se.min_filter=l.TF_LINEAR,se.mag_filter=l.TF_LINEAR),(Ee=I("COLOR","u_grass_map_color",de,1,1,!1,!1)).min_filter=l.TF_LINEAR,Ee.mag_filter=l.TF_LINEAR}else{ie=null,se=null;var Ee=null}if(z){_.update_camera_shadows(oe,z);for(var ce=0;ce<z.lamp_types.length;ce++)for(var le=z.csm_num,Te=0;Te<le;Te++){var ue=c.create_subs_shadow_cast(Te,ce,z,x);s.append_node_attr(i,ue),p.push(ue);var de=z.csm_resolution;t.shadow_cameras.push(Ve=ue.camera),Ve.width=de,Ve.height=de,ue.clear_color=!0;var fe=ce>0?ce:Te;if(u.rgba_fallback_shadows){var Pe=I("COLOR","u_shadow_map"+fe,de,1,1,!1,!1);m.push(Pe);var Ae=I("DEPTH","DEPTH",de,1,1,!1,!1);Ae.use_renderbuffer=!0,ue.slinks_internal.push(Ae)}else{var Se=I("DEPTH","u_shadow_map"+fe,de,1,1,!1,!1);u.compared_mode_depth&&(Se.min_filter=l.TF_LINEAR,Se.mag_filter=l.TF_LINEAR,Se.use_comparison=!0),m.push(Se),(a.depth_only_issue()||u.shadows_color_slink_hack)&&ue.slinks_internal.push(I("COLOR","COLOR",de,1,1,!1,!1))}ie&&(s.append_edge_attr(i,ie,ue,se),s.append_edge_attr(i,ie,ue,Ee))}}if(F&&F.num_cube_refl&&!ee)for(Te=0;Te<F.num_cube_refl;Te++){for((Ve=_.create_camera(_.TYPE_PERSP)).width=e.cubemap_refl_size,Ve.height=e.cubemap_refl_size,_.set_frustum(Ve,Math.PI/2,.1,100),_.set_projection(Ve,!1),(ge=c.create_subs_main(c.MAIN_CUBE_REFLECT,Ve,!1,y,x,Q,H,null,e.sun_exist)).cube_view_matrices=vn(),ce=0;ce<6;ce++)ge.cube_cam_frustums.push(_.create_frustum_planes());if(s.append_node_attr(i,ge),(Ne=I("CUBEMAP","u_cube_reflection",e.cubemap_refl_size,1,1,!1,!1)).min_filter=l.TF_LINEAR,Ne.mag_filter=l.TF_LINEAR,g.push(Ne),!F.has_reflexible){var pe=I("CUBEMAP","u_sky_reflection",1,1,1,!1);pe.use_mipmap=!0,pe.min_filter=l.TF_LINEAR_MIPMAP_LINEAR,pe.mag_filter=l.TF_LINEAR,Y.push(pe)}if(ie&&(s.append_edge_attr(i,ie,ge,se),s.append_edge_attr(i,ie,ge,Ee)),F.has_blend_reflexible){(he=c.create_subs_main(c.MAIN_CUBE_REFLECT_BLEND,Ve,!1,y,x,Q,H,null,e.sun_exist)).cube_view_matrices=ge.cube_view_matrices,he.cube_cam_frustums=ge.cube_cam_frustums,s.append_node_attr(i,he);var me=I("DEPTH","DEPTH",e.cubemap_refl_size,1,1,!1,!1),Oe=I("COLOR","COLOR",e.cubemap_refl_size,1,1,!1,!1);s.append_edge_attr(i,ge,he,me),s.append_edge_attr(i,ge,he,Oe),N.push(he),F.cube_refl_subs_blend.push(he),ie&&(s.append_edge_attr(i,ie,he,se),s.append_edge_attr(i,ie,he,Ee))}else{var ve=I("DEPTH","DEPTH",e.cubemap_refl_size,1,1,!1,!1);ge.slinks_internal.push(ve),N.push(ge)}F.cube_refl_subs.push(ge)}if(F&&F.refl_plane_objs.length>0&&!ee)for(ce=0;ce<F.refl_plane_objs.length;ce++){(Ve=_.clone_camera(oe,!0)).reflection_plane=new Float32Array(4),t.cameras.push(Ve);var Ne,ge=c.create_subs_main(c.MAIN_PLANE_REFLECT,Ve,!1,y,x,Q,H,null,e.sun_exist);if(s.append_node_attr(i,ge),(Ne=I("COLOR","u_plane_reflection",1,e.plane_refl_size,e.plane_refl_size,!0,!0)).min_filter=l.TF_LINEAR,Ne.mag_filter=l.TF_LINEAR,v.push(Ne),ie&&(s.append_edge_attr(i,ie,ge,se),s.append_edge_attr(i,ie,ge,Ee)),F.has_blend_reflexible){var he=c.create_subs_main(c.MAIN_PLANE_REFLECT_BLEND,Ve,!1,y,x,Q,H,null,e.sun_exist);s.append_node_attr(i,he),me=I("DEPTH","DEPTH",1,e.plane_refl_size,e.plane_refl_size,!0,!0),(Oe=I("COLOR","COLOR",1,e.plane_refl_size,e.plane_refl_size,!0,!0)).min_filter=l.TF_NEAREST,Oe.mag_filter=l.TF_NEAREST,s.append_edge_attr(i,ge,he,me),s.append_edge_attr(i,ge,he,Oe),F.plane_refl_subs_blend.push([he]),O.push(he),ie&&(s.append_edge_attr(i,ie,he,se),s.append_edge_attr(i,ie,he,Ee))}else ve=I("DEPTH","DEPTH",1,e.plane_refl_size,e.plane_refl_size,!0,!0),ge.slinks_internal.push(ve),O.push(ge);F.plane_refl_subs.push([ge])}if(z){var Re=_.clone_camera(oe,!0);t.cameras.push(Re);var Ie=c.create_subs_shadow_receive(i,Re,x);for(s.append_node_attr(i,Ie),Ie.self_shadow_normal_offset=z.self_shadow_normal_offset,Te=0;Te<p.length;Te++)s.append_edge_attr(i,ue=p[Te],Ie,m[Te]);if(re){if(Se=I("DEPTH","DEPTH",1,1,1,!0,!0),te){Se.multisample=!0,Se.use_renderbuffer=!0;var be=c.create_subs_resolve();s.append_node_attr(i,be);var Ye=I("COLOR","RESOLVE",1,1,1,!0,!0);Ye.multisample=!0,Ye.use_renderbuffer=!0;var Le=I("DEPTH","RESOLVE",1,1,1,!0,!0);Le.multisample=!0,Le.use_renderbuffer=!0,s.append_edge_attr(i,Ie,be,Ye),s.append_edge_attr(i,Ie,be,Le)}}else te?Se=I("DEPTH","DEPTH",1,1,1,!0,!0):u.rgba_fallback_shadows?(Se=I("DEPTH","DEPTH",1,1,1,!0,!0)).use_renderbuffer=!0:Se=ne;if(C){var Me=I("COLOR","u_color",1,1,1,!0,!0),xe=I("DEPTH","u_depth",1,1,1,!0,!0),ye=_.clone_camera(oe,!0);t.cameras.push(ye);var we=e.ssao_params,Ue=c.create_subs_ssao(ye,Q,we);s.append_node_attr(i,Ue);var Ce=I("COLOR","u_ssao_mask",1,1,1,!0,!0);s.append_edge_attr(i,Ie,Ue,Me),s.append_edge_attr(i,Ie,Ue,xe);var De=_.clone_camera(oe,!0);t.cameras.push(De);var Fe=c.create_subs_ssao_blur(De,we);s.append_node_attr(i,Fe);var Ge=I("COLOR","u_shadow_mask",1,1,1,!0,!0);s.append_edge_attr(i,Ue,Fe,Ce),s.append_edge_attr(i,Ie,Fe,xe)}ie&&(s.append_edge_attr(i,ie,Ie,se),s.append_edge_attr(i,ie,Ie,Ee))}else Ie=null;var ke=c.create_subs_main(c.MAIN_OPAQUE,oe,!re,y,x,Q,H,null,e.sun_exist);if(s.append_node_attr(i,ke),z&&(re?s.append_edge_attr(i,Ie,ke,Se):Ie.slinks_internal.push(Se)),te){var Ke=c.create_subs_resolve();s.append_node_attr(i,Ke),f.push(Ke);var Be=I("COLOR","RESOLVE",1,1,1,!0,!0);Be.multisample=!0,Be.use_renderbuffer=!0;var Xe=I("DEPTH","RESOLVE",1,1,1,!0,!0);Xe.multisample=!0,Xe.use_renderbuffer=!0,s.append_edge_attr(i,ke,Ke,Be),s.append_edge_attr(i,ke,Ke,Xe)}else f.push(ke);if(Ie)if(Ce)s.append_edge_attr(i,Fe,ke,Ge);else{var He=I("COLOR","u_shadow_mask",1,1,1,!0,!0);s.append_edge_attr(i,re&&te?be:Ie,ke,He)}if(ie&&(s.append_edge_attr(i,ie,ke,se),s.append_edge_attr(i,ie,ke,Ee)),O.length){var Qe=O.length;for(ce=0;ce<Qe;ce++)s.append_edge_attr(i,O[ce],ke,v[ce])}if(N.length)for(ce=0;ce<N.length;ce++)s.append_edge_attr(i,N[ce],ke,g[ce]);if(E=f,f=[],!ee&&e.color_picking){var ze=T.enabled&&(T.subs_type===c.COLOR_PICKING||T.subs_type===c.COLOR_PICKING_XRAY),Ve=_.clone_camera(oe,!0);ze||(Ve.width=Ve.height=1),t.cameras.push(Ve);var je=c.create_subs_color_picking(Ve,!1,x);if(s.append_node_attr(i,je),e.xray){Ve=_.clone_camera(oe,!0),ze||(Ve.width=Ve.height=1),t.cameras.push(Ve);var qe=c.create_subs_color_picking(Ve,!0,x);s.append_node_attr(i,qe);var We=I("COLOR","COLOR",1,1,1,ze,!0);s.append_edge_attr(i,je,qe,We);var Je=I("DEPTH","DEPTH",1,1,1,ze,!0);s.append_edge_attr(i,je,qe,Je)}}else je=null;if(!G.refractions&&!$||ee)Ze=null;else{if(te)Ze=Ke;else{if(u.ios_copy_tex_hack)var Ze=c.create_subs_postprocessing("NONE"),$e=I("COLOR","u_color",1,1,1,!0,!0);else Ze=c.create_subs_copy(),$e=I("COLOR","COPY",1,1,1,!0,!0);s.append_node_attr(i,Ze),s.append_edge_attr(i,E[0],Ze,$e)}var et=I("COLOR","u_refractmap",1,1,1,!0,!0)}if(Z&&($||w||U)){var tt=_.clone_camera(oe,!0);t.cameras.push(tt);var rt=c.create_subs_depth_pack(tt);s.append_node_attr(i,rt);var _t=I("DEPTH","u_depth",1,1,1,!0,!0);s.append_edge_attr(i,te?Ke:ke,rt,_t);var nt=I("COLOR","u_scene_depth",1,1,1,!0,!0);nt.min_filter=l.TF_NEAREST,nt.mag_filter=l.TF_NEAREST}else rt=null;var at=function(r){var n=_.clone_camera(oe,!0);t.cameras.push(n);var a=c.create_subs_main(r,n,!1,y,x,Q,H,z,e.sun_exist);if(s.append_node_attr(i,a),r==c.MAIN_XRAY){var o=I("COLOR","COLOR",1,1,1,!0,!0);s.append_edge_attr(i,E[0],a,o);var l=I("DEPTH","DEPTH",1,1,1,!0,!0);a.slinks_internal.push(l)}else{if(te&&E[0].type==c.RESOLVE)var T=ke;else T=E[0];s.append_edge_attr(i,ke,a,ne),s.append_edge_attr(i,T,a,_e)}ie&&(s.append_edge_attr(i,ie,a,se),s.append_edge_attr(i,ie,a,Ee));for(var u=0;u<p.length;u++)s.append_edge_attr(i,p[u],a,m[u]);if(rt&&s.append_edge_attr(i,rt,a,nt),O.length){var d=O.length;for(u=0;u<d;u++)s.append_edge_attr(i,O[u],a,v[u])}if(N.length)for(u=0;u<N.length;u++)s.append_edge_attr(i,N[u],a,g[u]);return Ze&&s.append_edge_attr(i,Ze,a,et),a};if(e.glow_over_blend){var ot=at(c.MAIN_BLEND);f.push(ot),E=f,f=[]}if(e.glow_materials){var it=_.clone_camera(oe,!0);t.cameras.push(it);var st=c.create_subs_main(c.MAIN_GLOW,it,!1,y,x,Q,H);if(s.append_node_attr(i,st),rt&&s.append_edge_attr(i,rt,st,nt),Ze&&s.append_edge_attr(i,Ze,st,et),ie&&(s.append_edge_attr(i,ie,st,se),s.append_edge_attr(i,ie,st,Ee)),O.length)for(Qe=O.length,ce=0;ce<Qe;ce++)s.append_edge_attr(i,O[ce],st,v[ce]);if(N.length)for(ce=0;ce<N.length;ce++)s.append_edge_attr(i,N[ce],st,g[ce]);e.glow_over_blend&&s.append_edge_attr(i,st,ot,I("SCREEN","NONE",0,0,0,!1,!1)),s.append_edge_attr(i,te?Ke:ke,st,te?ae:ne),(Zt=c.create_subs_postprocessing("X_GLOW_BLUR")).subtype="GLOW_MASK_SMALL",R(Zt,e.glow_params.small_glow_mask_width),($t=I("COLOR","u_color",1,1,1,!0,!0)).min_filter=l.TF_LINEAR,$t.mag_filter=l.TF_LINEAR,s.append_node_attr(i,Zt),s.append_edge_attr(i,st,Zt,$t),(_r=c.create_subs_postprocessing("Y_GLOW_BLUR")).subtype="GLOW_MASK_SMALL",R(_r,e.glow_params.small_glow_mask_width),(er=I("COLOR","u_color",1,.5,.5,!0,!0)).min_filter=l.TF_LINEAR,er.mag_filter=l.TF_LINEAR,s.append_node_attr(i,_r),s.append_edge_attr(i,Zt,_r,er);var Et=c.create_subs_postprocessing("X_GLOW_BLUR");Et.subtype="GLOW_MASK_LARGE",R(Et,e.glow_params.large_glow_mask_width);var ct=I("COLOR","u_color",1,.5,.5,!0,!0);ct.min_filter=l.TF_LINEAR,ct.mag_filter=l.TF_LINEAR,s.append_node_attr(i,Et),s.append_edge_attr(i,_r,Et,ct);var lt=c.create_subs_postprocessing("Y_GLOW_BLUR");lt.subtype="GLOW_MASK_LARGE",R(lt,e.glow_params.large_glow_mask_width);var Tt=I("COLOR","u_color",1,.25,.25,!0,!0);Tt.min_filter=l.TF_LINEAR,Tt.mag_filter=l.TF_LINEAR,s.append_node_attr(i,lt),s.append_edge_attr(i,Et,lt,Tt);var ut=_.clone_camera(oe,!0);t.cameras.push(ut);var dt=c.create_subs_glow_combine(ut,e);s.append_node_attr(i,dt);var ft=I("COLOR","u_src_color",1,1,1,!0,!0);if(ft.min_filter=l.TF_LINEAR,ft.mag_filter=l.TF_LINEAR,e.glow_over_blend)if(te){var Pt=c.create_subs_resolve();s.append_node_attr(i,Pt),s.append_edge_attr(i,ot,Pt,Be),s.append_edge_attr(i,ot,Pt,Xe),s.append_edge_attr(i,Pt,dt,ft)}else s.append_edge_attr(i,ot,dt,ft);else s.append_edge_attr(i,te?Ke:ke,dt,ft);(rr=I("COLOR","u_glow_mask_small",1,.5,.5,!0,!0)).min_filter=l.TF_LINEAR,rr.mag_filter=l.TF_LINEAR,s.append_edge_attr(i,_r,dt,rr);var At=I("COLOR","u_glow_mask_large",1,.25,.25,!0,!0);At.min_filter=l.TF_LINEAR,At.mag_filter=l.TF_LINEAR,s.append_edge_attr(i,lt,dt,At),E=[dt],f=[]}if(e.glow_over_blend||(ot=at(c.MAIN_BLEND),f.push(ot),E=f,f=[]),u.debug_view){Ve=_.clone_camera(oe,!0),t.cameras.push(Ve);var St=c.create_subs_debug_view(Ve);f.push(St),s.append_node_attr(i,St),s.append_edge_attr(i,E[0],St,_e),s.append_edge_attr(i,E[0],St,ne),ie&&(s.append_edge_attr(i,ie,St,se),s.append_edge_attr(i,ie,St,Ee)),o.set_debug_view_subs(St),E=f,f=[]}if(te){var pt=c.create_subs_resolve();s.append_node_attr(i,pt),f.push(pt),s.append_edge_attr(i,E[0],pt,Be),s.append_edge_attr(i,E[0],pt,Xe),E=f,f=[]}var mt=E.slice(0);if(!ee&&e.anchor_visibility){Ve=_.clone_camera(oe,!0),t.cameras.push(Ve);var Ot=c.create_subs_anchor_visibility(Ve);s.append_node_attr(i,Ot),s.append_edge_attr(i,E[0],Ot,te?ae:ne)}if(D&&Z&&!ee){var vt=q.max_ray_length,Nt=q.intensity,gt=q.steps_per_pass,ht=E[0],Rt=!!y,It=I("DEPTH","u_input",1,1,1,!0,!0),bt=I("COLOR","u_input",1,.25,.25,!0,!0);bt.min_filter=l.TF_LINEAR,bt.mag_filter=l.TF_LINEAR;var Yt=vt/gt,Lt=_.clone_camera(oe,!0);t.cameras.push(Lt);var Mt=c.create_subs_god_rays(Lt,Rt,vt,!0,Yt,x,gt);s.append_node_attr(i,Mt),s.append_edge_attr(i,ht,Mt,It),Yt=vt/gt*.5;var xt=_.clone_camera(oe,!0);t.cameras.push(xt);var yt=c.create_subs_god_rays(xt,Rt,vt,!1,Yt,x,gt);s.append_node_attr(i,yt),s.append_edge_attr(i,Mt,yt,bt),Yt=vt/gt*.25;var wt=_.clone_camera(oe,!0);t.cameras.push(wt);var Ut=c.create_subs_god_rays(wt,Rt,vt,!1,Yt,x,gt);s.append_node_attr(i,Ut),s.append_edge_attr(i,yt,Ut,bt);var Ct=c.create_subs_god_rays_comb(Nt,x);f.push(Ct),s.append_node_attr(i,Ct),(Ft=I("COLOR","u_main",1,1,1,!0,!0)).min_filter=l.TF_LINEAR,Ft.mag_filter=l.TF_LINEAR,s.append_edge_attr(i,ht,Ct,Ft);var Dt=I("COLOR","u_god_rays",1,1,1,!0,!0);Dt.min_filter=l.TF_LINEAR,Dt.mag_filter=l.TF_LINEAR,s.append_edge_attr(i,Ut,Ct,Dt),E=f,f=[]}if(k&&!ee){ht=E[0];var Ft,Gt=c.create_subs_luminance();s.append_node_attr(i,Gt),(Ft=I("COLOR","u_input",1,1,1,!0,!0)).min_filter=l.TF_LINEAR,Ft.mag_filter=l.TF_LINEAR,s.append_edge_attr(i,ht,Gt,Ft);var kt=k.key,Kt=k.edge_lum,Bt=_.clone_camera(oe,!0);t.cameras.push(Bt);var Xt=c.create_subs_luminance_truncated(kt,Kt,x,Bt);s.append_node_attr(i,Xt);var Ht=I("COLOR","u_luminance",1,.25,.25,!0,!0);if(Ht.min_filter=l.TF_LINEAR,Ht.mag_filter=l.TF_LINEAR,k.adaptive){var Qt=c.create_subs_av_luminance();s.append_node_attr(i,Qt),Qt.camera.width=1,Qt.camera.height=1;var zt=I("COLOR","u_input",1,.25,.25,!0,!0);if(zt.use_mipmap=!0,zt.min_filter=l.TF_LINEAR_MIPMAP_LINEAR,zt.mag_filter=l.TF_LINEAR,u.webgl2)Ht.use_mipmap=!0,Ht.min_filter=l.TF_LINEAR_MIPMAP_LINEAR,s.append_edge_attr(i,Gt,Qt,zt);else{var Vt=c.create_resize_subs(),jt=I("COLOR","u_color",1,.25,.25,!0,!0);s.append_node_attr(i,Vt),s.append_edge_attr(i,Gt,Vt,jt),s.append_edge_attr(i,Vt,Qt,zt)}s.append_edge_attr(i,Qt,Xt,I("COLOR","u_average_lum",1,1,1,!1,!1)),Xt.adaptive_bloom=!0}else Xt.adaptive_bloom=!1,Xt.average_luminance=k.average_luminance;s.append_edge_attr(i,ht,Xt,I("COLOR","u_main",1,1,1,!0,!0)),s.append_edge_attr(i,Gt,Xt,Ht);var qt=Xt,Wt=1,Jt=[];for(Te=0;Te<5;Te++){var Zt,$t,er;R(Zt=c.create_subs_postprocessing("X_BLOOM_BLUR"),e.glow_params.small_glow_mask_width),($t=I("COLOR","u_color",1,Wt,Wt,!0,!0)).min_filter=l.TF_LINEAR,$t.mag_filter=l.TF_LINEAR,s.append_node_attr(i,Zt),s.append_edge_attr(i,qt,Zt,$t),Wt/=2,R(_r=c.create_subs_postprocessing("Y_BLOOM_BLUR"),e.glow_params.small_glow_mask_width),(er=I("COLOR","u_color",1,Wt,Wt,!0,!0)).min_filter=l.TF_LINEAR,er.mag_filter=l.TF_LINEAR,s.append_node_attr(i,_r),s.append_edge_attr(i,Zt,_r,er),qt=_r,_r.bloom_blur_scale=Wt,Zt.bloom_blur_scale=Wt,Jt.push(_r,Wt)}var tr=c.create_subs_bloom_combine(k.blur,5);for(s.append_node_attr(i,tr),Te=0;Te<Jt.length;Te+=2){var rr,_r=Jt[Te],nr=Jt[Te+1];(rr=I("COLOR","u_bloom_level_"+(Te/2).toString(),1,nr,nr,!0,!0)).min_filter=l.TF_LINEAR,rr.mag_filter=l.TF_LINEAR,s.append_edge_attr(i,_r,tr,rr)}s.append_edge_attr(i,ht,tr,I("COLOR","u_main",1,1,1,!0,!0)),f.push(tr),E=f,f=[]}if(J&&Z&&!ee){ht=E[0];var ar=_.clone_camera(oe,!0);t.cameras.push(ar);var or=r.dof_bokeh&&u.tex_float_available&&u.cbuffer_float_available;if(or){var ir=l.TF_NEAREST,sr=I("COLOR","u_color",1,1,1,!0,!0);sr.min_filter=ir,sr.mag_filter=ir;var Er=I("DEPTH","u_depth",1,1,1,!0,!0),cr=I("COLOR","u_color",1,.5,.5,!0,!0);cr.floating_point=!0,cr.min_filter=l.TF_NEAREST,cr.mag_filter=l.TF_NEAREST;var lr=I("COLOR","u_color",1,.5,.5,!0,!0);lr.floating_point=!0,lr.min_filter=l.TF_NEAREST,lr.mag_filter=l.TF_NEAREST;var Tr=I("COLOR","u_blurred1",1,.5,.5,!0,!0);Tr.floating_point=!0,Tr.min_filter=ir,Tr.mag_filter=ir;var ur=I("COLOR","u_blurred2",1,.5,.5,!0,!0);ur.floating_point=!0,ur.min_filter=ir,ur.mag_filter=ir;var dr=mt[0];if(r.dof_foreground_blur){var fr=_.clone_camera(oe,!0);t.cameras.push(fr);var Pr=c.create_subs_coc(fr,"COC_FOREGROUND");fr.dof_distance=r.dof_distance,fr.dof_object=r.dof_object,fr.dof_front_start=r.dof_front_start,fr.dof_front_end=r.dof_front_end,fr.dof_rear_start=r.dof_rear_start,fr.dof_rear_end=r.dof_rear_end,fr.dof_power=r.dof_power,fr.dof_bokeh=r.dof_bokeh,fr.dof_bokeh_intensity=r.dof_bokeh_intensity,fr.dof_foreground_blur=r.dof_foreground_blur,fr.dof_on=!0,s.append_node_attr(i,Pr),s.append_edge_attr(i,ht,Pr,sr),s.append_edge_attr(i,dr,Pr,Er);var Ar=c.create_subs_postprocessing("X_ALPHA_BLUR");s.append_node_attr(i,Ar),s.append_edge_attr(i,Pr,Ar,cr);var Sr=c.create_subs_postprocessing("Y_ALPHA_BLUR");s.append_node_attr(i,Sr),s.append_edge_attr(i,Ar,Sr,lr);var pr=_.clone_camera(oe,!0),mr=c.create_subs_coc(pr,"COC_COMBINE");t.cameras.push(pr),pr.dof_distance=r.dof_distance,pr.dof_object=r.dof_object,pr.dof_front_start=r.dof_front_start,pr.dof_front_end=r.dof_front_end,pr.dof_rear_start=r.dof_rear_start,pr.dof_rear_end=r.dof_rear_end,pr.dof_power=r.dof_power,pr.dof_bokeh=r.dof_bokeh,pr.dof_bokeh_intensity=r.dof_bokeh_intensity,pr.dof_foreground_blur=r.dof_foreground_blur,pr.dof_on=!0,s.append_node_attr(i,mr),s.append_edge_attr(i,ht,mr,sr),s.append_edge_attr(i,dr,mr,Er),s.append_edge_attr(i,Sr,mr,I("COLOR","u_coc_fg",1,.5,.5,!0,!0))}else pr=_.clone_camera(oe,!0),t.cameras.push(pr),mr=c.create_subs_coc(pr,"COC_ALL"),pr.dof_distance=r.dof_distance,pr.dof_object=r.dof_object,pr.dof_front_start=r.dof_front_start,pr.dof_front_end=r.dof_front_end,pr.dof_rear_start=r.dof_rear_start,pr.dof_rear_end=r.dof_rear_end,pr.dof_power=r.dof_power,pr.dof_bokeh=r.dof_bokeh,pr.dof_bokeh_intensity=r.dof_bokeh_intensity,pr.dof_foreground_blur=r.dof_foreground_blur,pr.dof_on=!0,s.append_node_attr(i,mr),s.append_edge_attr(i,ht,mr,sr),s.append_edge_attr(i,dr,mr,Er);(Rr=c.create_subs_postprocessing("X_DOF_BLUR")).camera.dof_bokeh_intensity=r.dof_bokeh_intensity,s.append_node_attr(i,Rr),s.append_edge_attr(i,mr,Rr,cr);var Or=c.create_subs_postprocessing("Y_DOF_BLUR");Or.camera.dof_bokeh_intensity=r.dof_bokeh_intensity,s.append_node_attr(i,Or),s.append_edge_attr(i,Rr,Or,lr);var vr=c.create_subs_postprocessing("Y_DOF_BLUR");vr.camera.dof_bokeh_intensity=r.dof_bokeh_intensity,s.append_node_attr(i,vr),s.append_edge_attr(i,Rr,vr,lr);var Nr=c.create_subs_dof(ar,or);ar.dof_distance=r.dof_distance,ar.dof_object=r.dof_object,ar.dof_front_start=r.dof_front_start,ar.dof_front_end=r.dof_front_end,ar.dof_rear_start=r.dof_rear_start,ar.dof_rear_end=r.dof_rear_end,ar.dof_power=r.dof_power,ar.dof_bokeh=r.dof_bokeh,ar.dof_bokeh_intensity=r.dof_bokeh_intensity,ar.dof_foreground_blur=r.dof_foreground_blur,ar.dof_on=!0,f.push(Nr),s.append_node_attr(i,Nr),s.append_edge_attr(i,ht,Nr,I("COLOR","u_sharp",1,1,1,!0,!0)),s.append_edge_attr(i,Or,Nr,Tr),s.append_edge_attr(i,vr,Nr,ur)}else{var gr=I("COLOR","u_color",1,1,1,!0,!0);gr.min_filter=l.TF_LINEAR,gr.mag_filter=l.TF_LINEAR;var hr=I("COLOR","u_color",1,1,1,!0,!0);hr.min_filter=l.TF_LINEAR,hr.mag_filter=l.TF_LINEAR;var Rr=c.create_subs_postprocessing("X_BLUR");s.append_node_attr(i,Rr),s.append_edge_attr(i,ht,Rr,gr);var Ir=c.create_subs_postprocessing("Y_BLUR");s.append_node_attr(i,Ir),s.append_edge_attr(i,Rr,Ir,hr);var br=mt[0];Nr=c.create_subs_dof(ar,or),ar.dof_distance=r.dof_distance,ar.dof_object=r.dof_object,ar.dof_front_start=r.dof_front_start,ar.dof_front_end=r.dof_front_end,ar.dof_rear_start=r.dof_rear_start,ar.dof_rear_end=r.dof_rear_end,ar.dof_power=r.dof_power,ar.dof_bokeh=r.dof_bokeh,ar.dof_bokeh_intensity=r.dof_bokeh_intensity,ar.dof_foreground_blur=r.dof_foreground_blur,ar.dof_on=!0,f.push(Nr),s.append_node_attr(i,Nr),s.append_edge_attr(i,ht,Nr,I("COLOR","u_sharp",1,1,1,!0,!0)),s.append_edge_attr(i,Ir,Nr,I("COLOR","u_blurred",1,1,1,!0,!0)),s.append_edge_attr(i,br,Nr,I("DEPTH","u_depth",1,1,1,!0,!0))}E=f,f=[]}if(e.xray){var Yr=at(c.MAIN_XRAY);f.push(Yr),E=f,f=[]}if(K&&!ee){var Lr=E[0],Mr=c.create_subs_motion_blur(V.mb_decay_threshold,V.mb_factor);f.push(Mr),s.append_node_attr(i,Mr);var xr=I("COLOR","u_mb_tex_curr",1,1,1,!0,!0);s.append_edge_attr(i,Lr,Mr,xr);var yr=I("COLOR","u_mb_tex_accum",1,1,1,!0,!0);Mr.slinks_internal.push(yr),E=f,f=[]}if(!ee&&e.outline){ht=E[0];var wr=_.clone_camera(oe,!0);t.cameras.push(wr);var Ur=c.create_subs_outline_mask(wr,x);s.append_node_attr(i,Ur);var Cr=c.create_subs_postprocessing("X_EXTEND"),Dr=I("COLOR","u_color",1,1,1,!0,!0),Fr=I("COLOR","u_outline_mask",1,1,1,!0,!0);Fr.min_filter=l.TF_LINEAR,Fr.mag_filter=l.TF_LINEAR,Cr.is_for_outline=!0,s.append_node_attr(i,Cr),s.append_edge_attr(i,Ur,Cr,Dr);var Gr=I("COLOR","u_color",1,.5,.5,!0,!0);Gr.min_filter=l.TF_LINEAR,Gr.mag_filter=l.TF_LINEAR;var kr=c.create_subs_postprocessing("Y_EXTEND");kr.is_for_outline=!0,s.append_node_attr(i,kr),s.append_edge_attr(i,Cr,kr,Gr),(Rr=c.create_subs_postprocessing("X_BLUR")).is_for_outline=!0,s.append_node_attr(i,Rr),s.append_edge_attr(i,kr,Rr,Gr);var Kr=I("COLOR","u_color",1,.25,.25,!0,!0);Kr.min_filter=l.TF_LINEAR,Kr.mag_filter=l.TF_LINEAR;var Br=I("COLOR","u_outline_mask_blurred",1,.25,.25,!0,!0);Br.min_filter=l.TF_LINEAR,Br.mag_filter=l.TF_LINEAR,(Ir=c.create_subs_postprocessing("Y_BLUR")).is_for_outline=!0,s.append_node_attr(i,Ir),s.append_edge_attr(i,Rr,Ir,Kr);var Xr=c.create_subs_outline(W);s.append_node_attr(i,Xr);var Hr=I("COLOR","u_outline_src",1,1,1,!0,!0);Hr.min_filter=l.TF_LINEAR,Hr.mag_filter=l.TF_LINEAR,s.append_edge_attr(i,ht,Xr,Hr),s.append_edge_attr(i,Ur,Xr,Fr),s.append_edge_attr(i,Ir,Xr,Br),f.push(Xr),E=f,f=[]}if(A(i,Z),(e.anaglyph_use||e.hmd_stereo_use||e.sidebyside_use)&&!ee){var Qr=function(e,t,r,n){var a=r.cameras,o=t.hmd_stereo_use,i=t.anaglyph_use,E=t.reflection_params.plane_refl_subs,T=t.reflection_params.plane_refl_subs_blend,d=s.get_node_id(e,n),f=n,A=s.subgraph_node_conn(e,d,s.BACKWARD_DIR),S=[],p=[],m=[];A=s.clone(A,function(t){var n;if(P.indexOf(t.type)>-1)p.push(t),n=t;else{if((n=c.clone_subs(t)).type==c.MAIN_PLANE_REFLECT)for(var i=0;i<E.length;i++)if(E[i][0]==t){E[i]=[t,n],n.camera.reflection_plane=t.camera.reflection_plane,r.cameras.push(n.camera);break}if(t.type==c.MAIN_PLANE_REFLECT_BLEND){for(i=0;i<E.length;i++)if(T[i][0]==t){T[i]=[t,n],n.camera=E[i][1].camera;break}}else a.indexOf(t.camera)>-1&&(o?(_.make_stereo(t.camera,_.TYPE_HMD_LEFT),_.make_stereo(n.camera,_.TYPE_HMD_RIGHT),n.force_do_not_render=!0):(_.make_stereo(t.camera,_.TYPE_STEREO_LEFT),_.make_stereo(n.camera,_.TYPE_STEREO_RIGHT)),a.push(n.camera));var l=s.node_by_attr(e,t);if(s.traverse_inputs(e,l,function(e,t,r){P.indexOf(t.type)>-1&&S.push([t,n,r])}),t.type!==c.MOTION_BLUR)for(i=0;i<t.slinks_internal.length;i++)n.slinks_internal[i].parent_slink=t.slinks_internal[i];var u=!0;for(i=0;i<s.in_edge_count(e,l);i++){var d=s.get_in_edge(e,l,i),f=s.get_node_attr(e,d);-1==P.indexOf(f.type)&&(u=!1)}u&&m.push(n)}return n},function(e){var t=b(e,!0);return t.parent_slink=e,t});for(var O=0;O<p.length;O++)s.remove_node(A,s.node_by_attr(A,p[O]));s.cleanup_loose_edges(A);var v=c.create_subs_stereo(o,i),N=s.append_node_attr(e,v);if(u.ios_copy_tex_hack)var g=c.create_subs_postprocessing("NONE"),h=I("COLOR","u_color",1,1,1,!0,!0);else g=c.create_subs_copy(),h=I("COLOR","COPY",1,1,1,!0,!0);h.min_filter=l.TF_LINEAR,h.mag_filter=l.TF_LINEAR,s.append_node_attr(e,g),s.append_edge_attr(e,f,g,h);var R=I("COLOR","u_sampler_left",1,1,1,!0,!0);if(R.unique_texture=!0,R.min_filter=l.TF_LINEAR,R.mag_filter=l.TF_LINEAR,s.append_edge_attr(e,g,v,R),!f.is_pp){if(u.ios_copy_tex_hack)var Y=c.create_subs_postprocessing("NONE"),L=I("COLOR","u_color",1,1,1,!0,!0);else Y=c.create_subs_copy(),L=I("COLOR","COPY",1,1,1,!0,!0);s.append_node_attr(A,Y),L.parent_slink=h;var M=s.get_sink_nodes(A)[0],x=s.get_node_attr(A,M);s.append_edge_attr(A,x,Y,L)}var y=I("COLOR","u_sampler_right",1,1,1,!0,!0);for(f.is_pp&&(y.parent_slink=h),y.min_filter=l.TF_LINEAR,y.mag_filter=l.TF_LINEAR,s.append_subgraph(A,e,[s.get_sink_nodes(A)[0],N,y]),O=0;O<S.length;O++)s.append_edge_attr(e,S[O][0],S[O][1],S[O][2]);var w=I("SCREEN","NONE",0,0,0,!1,!1);for(O=0;O<m.length;O++)s.append_edge_attr(e,g,m[O],w);return s.traverse_edges(e,function(t,r,_){s.get_node_attr(e,t).type===c.MOTION_BLUR&&(_.parent_slink=null)}),v}(i,e,t,E[0]);f.push(Qr),E=f,f=[]}if(B&&!ee){ht=E[0];var zr=c.create_subs_compositing(j.brightness,j.contrast,j.exposure,j.saturation),Vr=I("COLOR","u_color",1,1,1,!0,!0);Vr.min_filter=l.TF_LINEAR,Vr.mag_filter=l.TF_LINEAR,(e.anaglyph_use||e.hmd_stereo_use||e.sidebyside_use)&&!ee&&(Vr.unique_texture=!0),s.append_node_attr(i,zr),s.append_edge_attr(i,ht,zr,Vr),f.push(zr),E=f,f=[]}if(!E[0].is_pp||E[0].type==c.MOTION_BLUR||E[0].type==c.RESOLVE){var jr=c.create_subs_postprocessing("NONE");s.append_node_attr(i,jr);var qr=I("COLOR","u_color",1,1,1,!0,!0);qr.min_filter=l.TF_LINEAR,qr.mag_filter=l.TF_LINEAR,s.append_edge_attr(i,E[0],jr,qr),f.push(jr),E=f,f=[]}if(X){if(ht=E[0],u.smaa){var Wr=I("COLOR","u_color",1,1,1,!0,!1);Wr.min_filter=l.TF_LINEAR,Wr.mag_filter=l.TF_LINEAR;var Jr=c.create_subs_smaa(c.SMAA_EDGE_DETECTION,e);s.append_node_attr(i,Jr),s.append_edge_attr(i,ht,Jr,Wr);var Zr=c.create_subs_smaa(c.SMAA_BLENDING_WEIGHT_CALCULATION,e);s.append_node_attr(i,Zr),s.append_edge_attr(i,Jr,Zr,Wr);var $r=I("COLOR","u_search_tex",1,1,1,!1,!1),e_=I("COLOR","u_area_tex",1,1,1,!1,!1);$r.min_filter=l.TF_LINEAR,$r.mag_filter=l.TF_LINEAR,e_.min_filter=l.TF_LINEAR,e_.mag_filter=l.TF_LINEAR,Zr.slinks_internal.push($r),Zr.slinks_internal.push(e_);var t_=c.create_subs_smaa(c.SMAA_NEIGHBORHOOD_BLENDING,e);s.append_node_attr(i,t_),s.append_edge_attr(i,ht,t_,Wr);var r_=I("COLOR","u_blend",1,1,1,!0,!1);r_.min_filter=l.TF_LINEAR,r_.mag_filter=l.TF_LINEAR,s.append_edge_attr(i,Zr,t_,r_),f.push(t_)}else{var __=c.create_subs_aa(e);s.append_node_attr(i,__);var n_=I("COLOR","u_color",1,1,1,!0,!1);n_.min_filter=l.TF_LINEAR,n_.mag_filter=l.TF_LINEAR,(e.anaglyph_use||e.hmd_stereo_use||e.sidebyside_use)&&!ee&&(n_.unique_texture=!0),s.append_edge_attr(i,ht,__,n_),f.push(__)}E=f,f=[]}if(f.push(E[0]),je&&f.push(qe||je),Ot&&f.push(Ot),de=1,e.sky_params.render_sky){var a_=e.world_light_set,o_=a_.sky_texture_param,i_=c.create_subs_sky(a_,x,e.sky_params,de=o_?o_.tex_size:de);if(s.append_node_attr(i,i_),f.push(i_),Y.length&&(s.append_edge_attr(i,i_,ke,Y[0]),ot&&s.append_edge_attr(i,i_,ot,Y[0]),st&&s.append_edge_attr(i,i_,st,Y[0]),Yr&&s.append_edge_attr(i,i_,Yr,Y[0])),F.has_pbr_reflexible)if(u.webgl2&&!u.is_mobile_device){var s_=c.create_subs_irradiance(x,de);s.append_node_attr(i,s_),(d_=I("CUBEMAP","u_sky_reflection",de,1,1,!1)).use_mipmap=!0,d_.min_filter=l.TF_LINEAR_MIPMAP_LINEAR,d_.mag_filter=l.TF_LINEAR,s.append_edge_attr(i,i_,s_,d_);var E_=I("CUBEMAP","u_irradiance",32,1,1,!1);E_.use_mipmap=!1,E_.min_filter=l.TF_LINEAR,E_.mag_filter=l.TF_LINEAR,s.append_edge_attr(i,s_,ke,E_),ot&&s.append_edge_attr(i,s_,ot,E_),st&&s.append_edge_attr(i,s_,st,E_),Yr&&s.append_edge_attr(i,s_,Yr,E_),f.push(s_);var c_=c.create_subs_rougness_convolution(x);s.append_node_attr(i,c_),s.append_edge_attr(i,i_,c_,d_);var l_=I("CUBEMAP","u_cube_r_convolution",128,1,1,!1);l_.use_mipmap=!1,l_.min_filter=l.TF_LINEAR_MIPMAP_LINEAR,l_.mag_filter=l.TF_LINEAR,s.append_edge_attr(i,c_,ke,l_),ot&&s.append_edge_attr(i,c_,ot,l_),st&&s.append_edge_attr(i,c_,st,l_),Yr&&s.append_edge_attr(i,c_,Yr,l_);var T_=c.create_subs_brdf();s.append_node_attr(i,T_);var u_=I("COLOR","u_brdf",512,1,1,!1);u_.min_filter=l.TF_LINEAR,u_.mag_filter=l.TF_LINEAR,s.append_edge_attr(i,T_,ke,u_),ot&&s.append_edge_attr(i,T_,ot,u_),st&&s.append_edge_attr(i,T_,st,u_),Yr&&s.append_edge_attr(i,T_,Yr,u_)}else{var d_;(d_=I("CUBEMAP","u_sky_reflection",de,1,1,!1)).use_mipmap=!0,d_.min_filter=l.TF_LINEAR_MIPMAP_LINEAR,d_.mag_filter=l.TF_LINEAR,s.append_edge_attr(i,i_,ke,d_),ot&&s.append_edge_attr(i,i_,ot,d_),st&&s.append_edge_attr(i,i_,st,d_),Yr&&s.append_edge_attr(i,i_,Yr,d_)}}var f_=c.create_subs_sink();for(s.append_node_attr(i,f_),Te=0;Te<f.length;Te++){var P_=f[Te];switch(P_.blend=!0,P_.type){case c.COLOR_PICKING:case c.COLOR_PICKING_XRAY:s.append_edge_attr(i,P_,f_,I("COLOR","NONE",1,1,1,ze,!1)),s.append_edge_attr(i,P_,f_,I("DEPTH","NONE",1,1,1,ze,!1));break;case c.SKY:var A_=I("CUBEMAP","u_sky",de,1,1,!1);s.append_edge_attr(i,P_,f_,A_);break;case c.IRRADIANCE:var S_=I("CUBEMAP","u_irradiance",de,1,1,!1);S_.use_mipmap=!0,S_.min_filter=l.TF_NEAREST,S_.mag_filter=l.TF_NEAREST,s.append_edge_attr(i,s_,f_,S_);break;case c.ANCHOR_VISIBILITY:var p_=I("COLOR","NONE",1,1,1,!0,!1);s.append_edge_attr(i,P_,f_,p_);break;default:if(ee){var m_=n[0],O_=I("COLOR","OFFSCREEN",1,1,1,!0,!0);for(O_.texture=m_,s.append_edge_attr(i,f[Te],f_,O_),ce=1;ce<n.length;ce++){var v_=n[ce],N_=c.create_subs_postprocessing("NONE");s.append_node_attr(i,N_);var g_=I("COLOR","SCALE",1,1,1,!0,!0);s.append_edge_attr(i,f[Te],N_,g_);var h_=v_.source_size/m_.source_size;(O_=I("COLOR","OFFSCREEN",1,h_,h_,!0,!0)).texture=v_,s.append_edge_attr(i,N_,f_,O_)}}else s.append_edge_attr(i,f[Te],f_,I("SCREEN","NONE",1,1,1,!0,!1))}}if(Ke&&!M(i,Ke).length&&(s.remove_node(i,s.node_by_attr(i,Ke)),s.cleanup_loose_edges(i)),A(i,Z),function(e,t){s.traverse(e,function(r,_){_.type==c.ANTIALIASING&&s.traverse_inputs(e,r,function(e,t,r){var _=t;if(_.type==c.MOTION_BLUR)for(var n=0;n<_.slinks_internal.length;n++){var a=_.slinks_internal[n];a.min_filter=l.TF_LINEAR,a.mag_filter=l.TF_LINEAR}}),t||s.traverse_inputs(e,r,function(e,t,r){"DEPTH"==r.from&&(r.use_renderbuffer=!0)})}),s.traverse(e,function(t,r){var _={};for(var n in function e(t,r,_){s.traverse_inputs(t,r,function(r,n,a){var o=a;o.active&&o.from==o.to&&(_[o.from]=_[o.from]||[],-1==_[o.from].indexOf(o)&&_[o.from].push(o),e(t,r,_))}),s.traverse_outputs(t,r,function(e,t,r){var n=r;n.active&&(_[n.from]=_[n.from]||[],-1==_[n.from].indexOf(n)&&_[n.from].push(n))});var n=s.get_node_attr(t,r);if(n.type==c.MOTION_BLUR)for(var a=0;a<n.slinks_internal.length;a++){var o=n.slinks_internal[a];_[o.from].push(o)}}(e,t,_),_){for(var a=_[n],o=a[0],i=0;i<a.length;i++)if(a[i].min_filter==l.TF_LINEAR){o=a[i];break}var E=a[0];for(i=0;i<a.length;i++)if(a[i].mag_filter==l.TF_LINEAR){E=a[i];break}var T=a[0];for(i=0;i<a.length;i++)if(!a[i].use_renderbuffer){T=a[i];break}for(i=0;i<a.length;i++)a[i].min_filter=o.min_filter,a[i].mag_filter=E.mag_filter,a[i].use_renderbuffer=T.use_renderbuffer}})}(i,Z),T.enabled){var R_=function(e){var t=null,r=0;return s.traverse(e,function(e,_){if(_.type==T.subs_type){if(r==T.subs_number)return t=_,!0;r++}}),t}(i);R_&&function(e,t){var r=s.node_by_attr(e,t),_=c.create_subs_postprocessing("NONE"),n=s.append_node_attr(e,_),a=s.get_sink_nodes(e)[0];s.traverse_edges(e,function(t,r,_){r==a&&s.reconnect_edges(e,t,a,t,n)});var o=function e(t,r){var _=!1,n=s.node_by_attr(r,t);if(s.out_edge_count(r,n)){var a=s.get_out_edge(r,n,0),o=s.get_edge_attr(r,n,a,0);_="COLOR"==o.from&&"COLOR"==o.to||"DEPTH"==o.from&&"DEPTH"==o.to?e(s.get_node_attr(r,a),r):"RESOLVE"==o.to}return _}(t,e);s.traverse_edges(e,function(n,a,i){if(n==r){if(o){var E=c.create_subs_resolve();s.append_node_attr(e,E);var l=I("COLOR","RESOLVE",1,1,1,!0,!0);l.multisample=!0,l.use_renderbuffer=!0;var u=I("DEPTH","RESOLVE",1,1,1,!0,!0);u.multisample=!0,u.use_renderbuffer=!0,s.append_edge_attr(e,t,E,l),s.append_edge_attr(e,t,E,u),t=E}return s.append_edge_attr(e,t,_,I(T.slink_type,"u_color",i.size,i.size_mult_x,i.size_mult_y,i.update_dim,i.apply_resolution_factors)),!0}}),s.append_edge(e,n,a,I("SCREEN","NONE",.5,.5,.5,!0,!0))}(i,R_)}if(S(i),h(i),z&&s.traverse(i,function(e,t){t.type!=c.SHADOW_RECEIVE&&t.type!=c.MAIN_BLEND&&t.type!=c.MAIN_XRAY||function(e,t){for(var r=0,_=L(e,t),n=0,a=0;a<_.length;a++){var o=_[a];o.type==c.SHADOW_CAST&&(n++,t.p_light_matrix=t.p_light_matrix||new Array,t.p_light_matrix[o.shadow_lamp_index>0?o.shadow_lamp_index:r]=o.camera.proj_matrix,r++)}t.v_light_ts&&t.v_light_r||(u.mac_os_shadow_hack?t.v_light_tsr=new Float32Array(9*n):(t.v_light_ts=new Float32Array(4*n),t.v_light_r=new Float32Array(4*n)))}(i,t)}),!F.has_reflexible)for(Te=0;Te<g.length;Te++)g[Te].active=!1;return i},t.multiply_size_mult_by_graph=function(e,t,r){var _=[];s.traverse(e,function(t,r){if(-1==P.indexOf(r.type)&&r.slinks_internal.length&&Y(e,r,c.STEREO))for(var n=0;n<r.slinks_internal.length;n++){var a=r.slinks_internal[n];-1==_.indexOf(a)&&_.push(a)}}),s.traverse_edges(e,function(t,r,n){var a=s.get_node_attr(e,t),o=s.get_node_attr(e,r);-1==P.indexOf(a.type)&&Y(e,o,c.STEREO)&&-1==_.indexOf(n)&&_.push(n)});for(var n=0;n<_.length;n++)_[n].size_mult_x*=t,_[n].size_mult_y*=r},t.set_texel_size=function(e,t,r){var _=e.texel_size_multiplier;e.texel_size[0]=t*e.texel_mask[0]*_,e.texel_size[1]=r*e.texel_mask[1]*_},t.set_texel_size_mult=R,t.create_performance_graph=function(){var e=s.create(),t=c.create_subs_perf(),r=_.create_camera(_.TYPE_NONE);r.width=512,r.height=512,t.camera=r,s.append_node_attr(e,t),t.slinks_internal.push(I("COLOR","u_color",512,1,1,!1,!1));var n=c.create_subs_sink();return s.append_node_attr(e,n),s.append_edge_attr(e,t,n,I("COLOR","NONE",512,1,1,!1,!1)),S(e),h(e),e},t.find_on_screen=function(e){var t=null;return s.traverse(e,function(e,r){return!(!r.camera||null!==r.camera.framebuffer||(t=r,0))}),t},t.find_input=function(e,t,r){for(var _=L(e,t),n=0;n<_.length;n++)if(_[n].type==r)return _[n];return null},t.get_inputs_by_type=function(e,t,r){for(var _=L(e,t),n=[],a=0;a<_.length;a++)_[a].type==r&&n.push(_[a]);return n},t.has_lower_subs=Y,t.has_upper_subs=function e(t,r,_){if(r.type==_)return!0;for(var n=L(t,r),a=0;a<n.length;a++)if(e(t,n[a],_))return!0;return!1},t.get_inputs=L,t.get_outputs=M,t.find_subs=function(e,t){var r=null;return s.traverse(e,function(e,_){return _.type==t&&(r=_,!0)}),r},t.debug_convert_to_dot=function(e){var t="digraph scenegraph {\n";t+="    ",t+='size="11.7,16.5";\n',t+="    ",t+='ratio="fill";\n',t+="    ",t+='node [shape=box margin="0.25,0.055"];\n';var r=function(e){var t=[],r=[];return g(e,function(e,_,n,a){e.texture&&-1==t.indexOf(e.texture)&&(t.push(e.texture),r.push(e.texture,t.length-1))}),r}(e);return s.traverse(e,function(e,_){t+="    ",t+=function(e,t,r){var _=c.subs_label(t);if(t.camera){_+="\\n";for(var n=0;n<r.length;n+=2){var a=t.camera.color_attachment;r[n]==a&&(l.is_renderbuffer(a)?_+="CR"+r[n+1]+" ":_+="C"+r[n+1]+" ")}for(n=0;n<r.length;n+=2){var o=t.camera.depth_attachment;r[n]==o&&(l.is_renderbuffer(o)?_+="DR"+r[n+1]:_+="D"+r[n+1])}}for(t.slinks_internal.length&&(_+="\\n-----\\n"),n=0;n<t.slinks_internal.length;n++)_+=x(t.slinks_internal[n],0,0,r);if(t.type==c.SINK)var i="dotted";else i=t.enqueue?"solid":"dashed";return i+=",bold",String(e)+' [label="'+_+'" color="black" style="'+i+'"];\n'}(e,_,r)}),s.traverse_edges(e,function(e,_,n){t+="    ",t+=function(e,t,r,_){var n=x(r,0,0,_);if(r.active)var a="solid";else a="dotted";return String(e)+" -> "+String(t)+' [label="'+n+'" style="'+a+'"];\n'}(e,_,n,r)}),t+="}"},t.create_rendering_queue=function(e){for(var t=s.topsort_attr(e),r=[],_=0;_<t.length;_++){var n=t[_];n.enqueue&&r.push(n)}return r}}),Ss=A("__sfx",function(e,t){var r=ha(e),_=Wo(e),n=ga(e),a=ri(e),o=_.defaults,i=_.sfx,s=.3,E=20,c=30,l=40,T=50,u=.015,d=5,f=new Float32Array(3),P=new Float32Array(3),A=Yr(),S=[],p=[],m=null,O=null,v=[],N=[1],g=null;function h(e,t,r){var _=e.sfx;if("NONE"!=_.behavior){var n=_.loop,o=_.pitch;if(_.src&&(n||r>=0)){_.base_seed=Math.floor(5e4*Math.random());var s=m.currentTime+t;if(s=Math.max(0,s),_.start_time=s,_.state=E,"POSITIONAL"==_.behavior&&"none"==O._sfx.distance_model&&(_.behavior="BACKGROUND_SOUND"),function(e,t){var r=e.sfx;if(!r.proc_chain_in){var _=Fa(e.render.world_tsr),n=Ba(e.render.world_tsr);if(i.mix_mode)(a=m.createBiquadFilter()).type="peaking";else var a=null;var o=m.createGain();switch(r.behavior){case"POSITIONAL":"string"!=typeof(c=m.createPanner()).panningModel?(c.panningModel=c.EQUALPOWER,c.distanceModel=c.INVERSE_DISTANCE):(c.panningModel="equalpower",c.distanceModel=t.distance_model),c.setPosition(_[0],_[1],_[2]),he(_,r.last_position);var s=f;if(sn(n,O_,s),c.setOrientation(s[0],s[1],s[2]),c.refDistance=r.dist_ref,c.maxDistance=r.dist_max,c.rolloffFactor=r.attenuation,c.coneInnerAngle=r.cone_angle_inner,c.coneOuterAngle=r.cone_angle_outer,c.coneOuterGain=r.cone_volume_outer,(l=m.createGain()).gain.value=C(r),a?(c.connect(a),a.connect(l)):c.connect(l),l.connect(o),r.proc_chain_in=c,r.volume_random){var E=m.createGain();o.connect(E),E.connect(t.proc_chain_in)}else E=null,o.connect(t.proc_chain_in);break;case"BACKGROUND_SOUND":var c=null;(l=m.createGain()).gain.value=C(r),a?(r.proc_chain_in=a,a.connect(l)):r.proc_chain_in=l,l.connect(o),r.volume_random?(E=m.createGain(),o.connect(E),E.connect(t.proc_chain_in)):(E=null,o.connect(t.proc_chain_in));break;case"BACKGROUND_MUSIC":var l;c=null,E=null,(l=m.createGain()).gain.value=C(r),a?(r.proc_chain_in=a,a.connect(l)):r.proc_chain_in=l,l.connect(o),o.connect(t.proc_chain_in)}r.panner_node=c,r.filter_node=a,r.gain_node=l,r.fade_gain_node=o,r.rand_gain_node=E}}(e,O._sfx),"POSITIONAL"==_.behavior||"BACKGROUND_SOUND"==_.behavior){var c=m.createBufferSource();if(c.buffer=_.src,c.playbackRate.value=o,n){if(_.source_node&&_.source_node.disconnect(),_.source_node2&&_.source_node2.disconnect(),c.loop=!0,c.loopStart=_.loop_start,c.loopEnd=_.loop_end,_.loop_end){var l=m.createBufferSource();l.buffer=_.src,l.playbackRate.value=o,_.source_node2=l,l.connect(_.proc_chain_in)}c.start(s),_.duration=0}else{var T=c.buffer?c.buffer.duration:0;if(r>T){var u=s+r+_.fade_out;c.loop=!0,c.start(s),c.stop(u),_.duration=r}else c.loop=!1,c.start(s),_.duration=T}c.connect(_.proc_chain_in),_.source_node=c,I(_),b(_),Y(_)}else if("BACKGROUND_MUSIC"==_.behavior){a.clear_timeout(_.bgm_start_timeout),a.clear_timeout(_.bgm_stop_timeout);var d=function(){!function(e){var t=e.sfx,r=t.src;r&&(r.volume=1,r.loop=t.loop,t.source_node=t.source_node||m.createMediaElementSource(r),t.source_node.connect(t.proc_chain_in),t.state==E&&(r.currentTime&&(r.currentTime=0),r.play()))}(e)};if(0==t?d():_.bgm_start_timeout=a.set_timeout(d,1e3*t),n)_.duration=0;else{var P=D(e);_.duration=P}}L(_,s)}}}function R(e){var t=e.sfx,r=t.duration;h(e,t.delay+t.delay_random*Math.random(),r)}function I(e){var t=e.source_node2||e.source_node;z_(t.onended)&&(t.onended=function(){e.state=T})}function b(e){e.volume_random&&e.rand_gain_node.gain.cancelScheduledValues(e.start_time),e.pitch_random&&(e.source_node.playbackRate.cancelScheduledValues(e.start_time),e.source_node2&&e.source_node2.playbackRate.cancelScheduledValues(e.start_time)),e.vp_rand_end_time=e.start_time}function Y(e){if(e.volume_random||e.pitch_random){var t=e.rand_gain_node,r=e.source_node,_=r.buffer?r.buffer.duration:0;if(_){var n=e.start_time;N[0]=e.base_seed;for(var a=0;a<d;){var o=e.pitch+e.pitch_random*en(N);if(n>=e.vp_rand_end_time){if(e.volume_random){var i=1-Un(e.volume_random,0,1)*Math.random();t.gain.setTargetAtTime(i,n,u)}e.pitch_random&&(r.playbackRate.setTargetAtTime(o,n,u),e.source_node2&&e.source_node2.playbackRate.setTargetAtTime(o,n,u)),a++}n+=_/o}e.vp_rand_end_time=n-.001}}}function L(e,t){if(e.fade_in||e.fade_out){var r=e.fade_gain_node;r.gain.cancelScheduledValues(t),e.fade_in?(r.gain.setTargetAtTime(0,t,u),r.gain.linearRampToValueAtTime(1,t+e.fade_in)):r.gain.setTargetAtTime(1,t,u),e.fade_out&&!e.loop&&(r.gain.setTargetAtTime(1,t+e.duration,u),r.gain.linearRampToValueAtTime(0,t+e.duration+e.fade_out))}}function M(e){"SPEAKER"!=e.type&&r.panic("Wrong object type");var t=e.sfx;if(t.state!=T){if(t.state==E||t.state==l){var _=t.fade_gain_node,n=m.currentTime;if(t.fade_out&&(_.gain.setTargetAtTime(_.gain.value,n,u),_.gain.linearRampToValueAtTime(0,n+t.fade_out,u)),"BACKGROUND_MUSIC"==t.behavior)t.src&&(a.clear_timeout(t.bgm_start_timeout),a.clear_timeout(t.bgm_stop_timeout),t.bgm_stop_timeout=a.set_timeout(function(){var t;(t=e.sfx.src)&&(t.currentTime&&(t.currentTime=0),t.pause())},1e3*t.fade_out));else{var o=t.source_node;o.onended=function(){},t.duration<o.buffer.duration?t.fade_out&&t.state==E?o.stop(n+t.fade_out):t.state==E&&(o.stop(0),o.disconnect()):o.disconnect(),t.start_time=0,t.pause_time=0,t.buf_offset=0}t.state=c}}else t.state=c}function x(e){var t=e.sfx;if(t.state==E){var r=m.currentTime;if(t.pause_time=r,"BACKGROUND_MUSIC"==t.behavior){var _=t.src;_&&_.pause()}else t.buf_offset=r>t.start_time?function(e,t){N[0]=e.base_seed;for(var r,_=e.source_node.buffer.duration,n=e.start_time;n<t;)n+=_/(r=e.pitch+e.pitch_random*en(N));return(_/r-(n-t))*r}(t,r):0,t.source_node.onended=function(){},t.source_node.stop(0),t.source_node.disconnect(),b(t);t.state=l}}function y(e){var t=e.sfx;if(t.state==l){var r=m.currentTime;if(t.start_time+=r-t.pause_time,"BACKGROUND_MUSIC"==t.behavior)t.src.play();else{!function(e){var t=e.sfx,r=m.createBufferSource();if(r.loop=t.source_node.loop,r.loopStart=t.source_node.loopStart,r.loopEnd=t.source_node.loopEnd,r.buffer=t.source_node.buffer,r.playbackRate.value=t.source_node.playbackRate.value,r.connect(t.proc_chain_in),t.source_node=r,t.source_node2){var _=m.createBufferSource();_.loop=t.source_node2.loop,_.buffer=t.source_node2.buffer,_.playbackRate.value=t.source_node2.playbackRate.value,_.connect(t.proc_chain_in),t.source_node2=_}}(e),t.vp_rand_end_time=r;var _=t.source_node;I(t),_.start(t.start_time,t.buf_offset),Y(t)}L(t,t.start_time),t.state=E}}function w(e,t,r){var _=1,n=t.doppler_factor;if(n>0){var a=t.speed_of_sound;if(0!=Be(e.velocity,e.velocity)||0!=Be(t.listener_velocity,t.listener_velocity)){var o=be(e.last_position,t.listener_last_eye,f),i=De(o),E=Be(o,t.listener_velocity)/i,c=Be(o,e.velocity)/i;E=-E,c=-c;var l=a/n;_=(a-n*(E=Math.min(E,l)))/(a-n*(c=Math.min(c,l))),isFinite(_)||(_=0),_=Math.min(_,16),_=Cn(_=Math.max(_,.125),e.last_doppler_shift,r,s),e.source_node.playbackRate.value=_,e.last_doppler_shift=_}}}function U(e){var t=e.sfx;return!(!t||t.state!=E&&t.state!=l&&t.state!=c&&t.state!=T)}function C(e){return e.muted?0:e.volume}function D(e){var t=e.sfx;if("POSITIONAL"==t.behavior||"BACKGROUND_SOUND"==t.behavior){var r=t.src;return r?r.duration:0}var _=t.src;return _?_.duration:0}t.AST_NONE=10,t.AST_ARRAY_BUFFER=20,t.AST_HTML_ELEMENT=30,t.create_sfx=function(){return{uuid:-1,filepath:"",behavior:"NONE",muted:!1,volume:1,pitch:1,attenuation:1,dist_ref:1,dist_max:1e4,cone_angle_inner:360,cone_angle_outer:360,cone_volume_outer:1,autoplay:!1,cyclic:!1,loop:!1,loop_start:0,loop_end:0,delay:0,delay_random:0,volume_random:0,pitch_random:0,fade_in:0,fade_out:0,start_time:0,pause_time:0,buf_offset:0,duration:0,vp_rand_end_time:0,base_seed:1,src:null,state:10,last_position:new Float32Array(3),velocity:new Float32Array(3),enable_doppler:!1,last_doppler_shift:1,bgm_start_timeout:-1,bgm_stop_timeout:-1,duck_time:0,proc_chain_in:null,source_node:null,source_node2:null,panner_node:null,filter_node:null,gain_node:null,fade_gain_node:null,rand_gain_node:null,update_counter:0}},t.init=function(){var e=document.createElement("audio"),t=document.createElement("video");e.canPlayType&&(""!=e.canPlayType("audio/ogg")&&(S.push("ogg"),S.push("ogv"),S.push("oga")),""!=e.canPlayType("audio/mpeg")&&S.push("mp3"),""!=e.canPlayType("audio/mp4")&&(S.push("mp4"),S.push("m4v"),S.push("m4a")),""!=e.canPlayType("audio/webm")&&S.push("webm")),t.canPlayType&&(""!=t.canPlayType("video/ogg")&&(p.push("ogv"),p.push("ogg"),p.push("oga")),""!=t.canPlayType("video/mp4")&&(p.push("m4v"),p.push("mp4")),""!=t.canPlayType("video/webm")&&p.push("webm"),""!=t.canPlayType("video/mpeg")&&p.push("mp3"))},t.attach_scene_sfx=function(e){if(i.webaudio&&!m&&(m=function(){var e=window.AudioContext||window.webkitAudioContext;if(e){try{var t=new e}catch(e){return n.error('Unable to initialize AudioContext: "'+e+'". The audio is disabled.'),null}return t.createGain?t:(n.warn("deprecated WebAudio implementation"),null)}return n.warn("WebAudio is not supported"),null}())&&n.log("%cINIT WEBAUDIO: "+m.sampleRate+"Hz","color: #00a"),m){var t={listener_last_eye:new Float32Array(3),listener_velocity:new Float32Array(3),update_counter:0},_=m.createGain(),a=m.createGain();if(t.gain_node=_,t.fade_gain_node=a,_.connect(a),a.connect(m.destination),e.b4w_enable_dynamic_compressor){var o=m.createDynamicsCompressor(),s=e.b4w_dynamic_compressor_settings;o.threshold.value=s.threshold,o.knee.value=s.knee,o.ratio.value=s.ratio,o.attack.value=s.attack,o.release.value=s.release,o.connect(_),t.compressor_node=o,t.proc_chain_in=o}else t.compressor_node=null,t.proc_chain_in=_;switch(e.audio_distance_model){case"INVERSE":case"INVERSE_CLAMPED":t.distance_model="inverse";break;case"LINEAR":case"LINEAR_CLAMPED":t.distance_model="linear";break;case"EXPONENT":case"EXPONENT_CLAMPED":t.distance_model="exponential";break;case"NONE":t.distance_model="none";break;default:r.panic("Wrong audio distance model")}t.doppler_factor=e.audio_doppler_factor,t.speed_of_sound=e.audio_doppler_speed,t.muted=!1,t.volume=e.audio_volume,_.gain.value=C(t),t.duck_time=0}else t=null;e._sfx=t},t.set_active_scene=function(e){O=e},t.detect_audio_container=function(e){return e||(e="ogg"),S.indexOf(e)>-1?e:S.indexOf("m4a")>-1?"m4a":S.indexOf("oga")>-1?"oga":""},t.detect_video_container=function(e){return e||(e="webm"),p.indexOf(e)>-1?e:p.indexOf("m4v")>-1?"m4v":p.indexOf("webm")>-1?"webm":""},t.update_object=function(e,t){var _=e.data,a=t.sfx;if(e.data.sound){switch(a.uuid=e.data.sound.uuid,a.filepath=e.data.sound.filepath,_.b4w_behavior){case"POSITIONAL":case"BACKGROUND_SOUND":a.behavior=m?_.b4w_behavior:"NONE";break;case"BACKGROUND_MUSIC":a.behavior=m?!window.MediaElementAudioSourceNode&&(n.warn("MediaElementAudioSourceNode not found"),1)||o.chrome_html_bkg_music_hack?"BACKGROUND_SOUND":"BACKGROUND_MUSIC":"NONE";break;default:r.panic("Wrong speaker behavior")}_.sound||(a.behavior="NONE"),a.enable_doppler=_.b4w_enable_doppler,a.muted=_.muted,a.volume=_.volume,a.pitch=_.pitch,a.attenuation=_.attenuation,a.dist_ref=_.distance_reference,a.dist_max=_.distance_max||1e4,a.cone_angle_inner=_.cone_angle_inner,a.cone_angle_outer=_.cone_angle_outer,a.cone_volume_outer=_.cone_volume_outer,a.autoplay=_.b4w_auto_play,a.cyclic=_.b4w_cyclic_play,a.loop=_.b4w_loop,a.loop_start=_.b4w_loop_start,a.loop_end=_.b4w_loop_end,a.delay=_.b4w_delay,a.delay_random=_.b4w_delay_random,a.volume_random=_.b4w_volume_random,a.pitch_random=_.b4w_pitch_random,a.fade_in=_.b4w_fade_in,a.fade_out=_.b4w_fade_out,v.push(t)}},t.source_type=function(e){switch("SPEAKER"!=e.type&&r.panic("Wrong object type"),e.sfx.behavior){case"POSITIONAL":case"BACKGROUND_SOUND":return t.AST_ARRAY_BUFFER;case"BACKGROUND_MUSIC":return t.AST_HTML_ELEMENT;case"NONE":return t.AST_NONE;default:r.panic("Wrong speaker behavior")}},t.update_spkobj=function(e,t){var _=e.sfx;switch(_.behavior){case"POSITIONAL":case"BACKGROUND_SOUND":case"BACKGROUND_MUSIC":_.src=t;break;case"NONE":break;default:r.panic("Wrong speaker behavior")}},t.play_empty_sound=function(){var e=m.createBufferSource();e.buffer=m.createBuffer(1,22050,22050),e.connect(m.destination),e.start(0)},t.decode_audio_data=function(e,t,r){m?m.decodeAudioData(e,t,r):r()},t.speaker_remove=function(e){M(e),e.sfx=null,v.splice(v.indexOf(e),1)},t.cleanup=function(){for(var e=0;e<v.length;e++){var t=v[e].sfx;if("BACKGROUND_MUSIC"==t.behavior){var r=t.src;r&&r.pause()}else t.source_node&&t.source_node.disconnect(),t.source_node2&&t.source_node2.disconnect()}if(O&&O._sfx){var _=O._sfx;_.listener_last_eye[0]=0,_.listener_last_eye[1]=0,_.listener_last_eye[2]=0,_.listener_velocity[0]=0,_.listener_velocity[1]=0,_.listener_velocity[2]=0}O=null,v.splice(0),g=null},t.update=function(e,t){if(m&&0!=v.length){for(var r=0;r<v.length;r++){var _=v[r],n=_.sfx,a=n.source_node,o=m.currentTime;!n.loop&&n.state==E&&n.duration&&n.start_time+n.duration<o&&("BACKGROUND_MUSIC"==n.behavior||a&&!z_(a.onended))&&(n.state=T),n.cyclic&&n.state==T&&R(_),n.state==E&&n.vp_rand_end_time-o<3&&Y(n)}g&&g.speakers.length&&(-1==g.active||e>g.active_start_time+g.durations[g.active])&&function(e,t){if(e.active>-1&&M(e.speakers[e.active]),-1==e.active&&e.random)var r=Math.round(Math.random()*(e.speakers.length-1));else if(e.random){var _=1+Math.round(Math.random()*(e.speakers.length-2));r=(e.active+_)%e.speakers.length}else r=(e.active+1)%e.speakers.length;R(e.speakers[r]),e.active=r,e.active_start_time=t}(g,e)}},t.play=h,t.play_def=R,t.stop=M,t.is_playing=function(e){return e.sfx.state==E},t.speaker_pause=x,t.speaker_resume=y,t.loop_stop=function(e,t,r){var _=e.sfx,n=_.source_node2;if(U(e)&&("POSITIONAL"==_.behavior||"BACKGROUND_SOUND"==_.behavior)&&n){var a=m.currentTime+t;_.source_node.stop(a),n.start(a,_.loop_end)}},t.playrate=function(e,t){var r=e.sfx;r.pitch=t,!U(e)||"POSITIONAL"!=r.behavior&&"BACKGROUND_SOUND"!=r.behavior||(r.source_node.playbackRate.value=t,r.source_node2&&(r.source_node2.playbackRate.value=t),b(r),Y(r))},t.get_playrate=function(e){return e.sfx.pitch},t.cyclic=function(e,t){e.sfx.cyclic=Boolean(t)},t.is_autoplay=function(e){return e.sfx.autoplay},t.is_cyclic=function(e){return e.sfx.cyclic},t.listener_update_transform=function(e,t,r,_,n){var a=e._sfx;if(a){var o=f;o[0]=0,o[1]=0,o[2]=-1,We(o,r,o);var i=P;i[0]=0,i[1]=1,i[2]=0,We(i,r,i);var s=m.listener;if(s.setPosition(t[0],t[1],t[2]),s.setOrientation(o[0],o[1],o[2],i[0],i[1],i[2]),_&&a.update_counter!=n){if(a.listener_stride)a.listener_stride=!1,he(t,a.listener_last_eye);else{var E=a.listener_velocity;E[0]=(t[0]-a.listener_last_eye[0])/_,E[1]=(t[1]-a.listener_last_eye[1])/_,E[2]=(t[2]-a.listener_last_eye[2])/_,he(t,a.listener_last_eye);for(var c=0;c<v.length;c++){var l=v[c],T=l.sfx;U(l)&&"POSITIONAL"==T.behavior&&T.enable_doppler&&w(T,a,_)}}a.update_counter=n}else he(t,a.listener_last_eye)}},t.listener_stride=function(){var e=O._sfx;e&&(e.listener_stride=!0)},t.speaker_update_transform=function(e,t,r){var _=e.sfx;if(U(e)&&"POSITIONAL"==_.behavior){var n=Ga(e.render.world_tsr,f),a=Xa(e.render.world_tsr,A),o=_.panner_node;o.setPosition(n[0],n[1],n[2]);var i=P;if(sn(a,O_,i),o.setOrientation(i[0],i[1],i[2]),_.enable_doppler){var s=_.last_position;if(t&&_.update_counter!=r){if(_.stride)he(n,s),_.stride=!1;else{var E=_.velocity;E[0]=(n[0]-s[0])/t,E[1]=(n[1]-s[1])/t,E[2]=(n[2]-s[2])/t,he(n,s),w(_,O._sfx,t)}_.update_counter=r}else he(n,s)}}},t.speaker_stride=function(e){var t=e.sfx;U(e)&&"POSITIONAL"==t.behavior&&t.enable_doppler&&(t.stride=!0)},t.get_spk_behavior=function(e){return e.sfx.behavior},t.check_active_speakers=function(){for(var e=0;e<v.length;e++)if(U(v[e]))return!0;return!1},t.set_master_volume=function(e){var t=O._sfx;t&&(t.volume=e,m&&(t.gain_node.gain.value=C(t)))},t.get_master_volume=function(){var e=O._sfx;return e?e.volume:0},t.set_volume=function(e,t){var r=e.sfx;r.volume=t,U(e)&&(r.gain_node.gain.value=C(r))},t.get_volume=function(e){return e.sfx.volume},t.mute=function(e,t){e.sfx.muted=Boolean(t),U(e)&&(e.sfx.gain_node.gain.value=C(e.sfx))},t.is_muted=function(e){return e.sfx.muted},t.mute_master=function(e){var t=O._sfx;t&&(t.muted=Boolean(e),m&&(t.gain_node.gain.value=C(t)))},t.is_master_muted=function(){var e=O._sfx;return!!e&&e.muted},t.get_speaker_objects=function(){return v},t.pause=function(){for(var e=0;e<v.length;e++)x(v[e])},t.resume=function(){for(var e=0;e<v.length;e++)y(v[e])},t.set_compressor_params=function(e,t){if(e._sfx&&e._sfx.compressor_node){var r=e._sfx.compressor_node;r.threshold.value=t.threshold,r.knee.value=t.knee,r.ratio.value=t.ratio,r.attack.value=t.attack,r.release.value=t.release}},t.get_compressor_params=function(e){if(!e._sfx||!e._sfx.compressor_node)return null;var t=e._sfx.compressor_node;return{threshold:t.threshold.value,knee:t.knee.value,ratio:t.ratio.value,attack:t.attack.value,release:t.release.value}},t.duck=function(e,t,r){if(U(e)){var _=e.sfx,n=_.fade_gain_node,a=m.currentTime;n.gain.setTargetAtTime(n.gain.value,a,u),n.gain.linearRampToValueAtTime(t,a+r),_.duck_time=r}},t.unduck=function(e){if(U(e)){var t=e.sfx,r=t.fade_gain_node,_=m.currentTime;r.gain.setTargetAtTime(r.gain.value,_,u),r.gain.linearRampToValueAtTime(1,_+t.duck_time),t.duck_time=0}},t.duck_master=function(e,t){if(m){var r=O._sfx,_=r.fade_gain_node,n=m.currentTime;_.gain.setTargetAtTime(_.gain.value,n,u),_.gain.linearRampToValueAtTime(e,n+t),r.duck_time=t}},t.unduck_master=function(){if(m){var e=O._sfx,t=e.fade_gain_node,r=m.currentTime;t.gain.setTargetAtTime(t.gain.value,r,u),t.gain.linearRampToValueAtTime(1,r+e.duck_time),e.duck_time=0}},t.apply_playlist=function(e,t,r){g={active:-1,active_start_time:0,random:r,speakers:[],durations:[]};for(var _=0;_<e.length;_++){var a=e[_],o=D(a);0!=o?(M(a),a.sfx.cyclic=!1,g.speakers.push(a),g.durations.push(o+t)):n.warn("Ignoring speaker with zero duration: "+a.name)}},t.get_duration=D,t.clear_playlist=function(){if(g)for(var e=g.speakers,t=0;t<e.length;t++)M(e[t]);g=null},t.get_positional_params=function(e){var t=e.sfx;return t&&"POSITIONAL"==t.behavior?{dist_ref:t.dist_ref,dist_max:t.dist_max,attenuation:t.attenuation}:null},t.set_positional_params=function(e,t){var r=e.sfx;if(r&&"POSITIONAL"==r.behavior){r.dist_ref=t.dist_ref,r.dist_max=t.dist_max,r.attenuation=t.attenuation;var _=r.panner_node;_&&(_.refDistance=r.dist_ref,_.maxDistance=r.dist_max,_.rolloffFactor=r.attenuation)}},t.set_filter_params=function(e,t){var r=e.sfx;r&&r.filter_node&&(r.filter_node.frequency.value=t.freq,r.filter_node.Q.value=t.Q,r.filter_node.gain.value=t.gain)},t.get_filter_params=function(e){var t=e.sfx;return t&&t.filter_node?{freq:t.filter_node.frequency.value,Q:t.filter_node.Q.value,gain:t.filter_node.gain.value}:null},t.get_filter_freq_response=function(e,t,r,_){var n=e.sfx;if(!n||!n.filter_node)return null;n.filter_node.getFrequencyResponse(t,r,_)},t.reset=function(){S.length=0,p.length=0,m=null}}),ps=A("__scenes",function(e,t){var r=ha(e),_=Ks(e),n=oE(e),a=Wo(e),o=aE(e),i=ni(e),s=$o(e),E=us(e),c=ds(e),l=ks(e),T=Ms(e),u=ys(e),d=os(e),f=fs(e),P=Ps(e),A=ga(e),S=Qi(e),p=As(e),m=Ss(e),O=Gs(e),v=ai(e),N=ys(e),g=a.debug_subs,h=a.defaults,R=a.context_limits,I=a.outlining,b=a.scenes,Y=[v.GRASS_MAP,v.SHADOW_CAST,v.MAIN_OPAQUE,v.MAIN_BLEND,v.MAIN_XRAY,v.MAIN_GLOW,v.MAIN_PLANE_REFLECT,v.MAIN_CUBE_REFLECT,v.MAIN_PLANE_REFLECT_BLEND,v.MAIN_CUBE_REFLECT_BLEND,v.COLOR_PICKING,v.COLOR_PICKING_XRAY,v.SHADOW_RECEIVE,v.OUTLINE_MASK,v.DEBUG_VIEW];t.OBJECT_SUBSCENE_TYPES=Y;var L=[v.MAIN_OPAQUE,v.MAIN_BLEND,v.MAIN_XRAY,v.MAIN_GLOW,v.MAIN_PLANE_REFLECT,v.MAIN_CUBE_REFLECT,v.GOD_RAYS,v.GOD_RAYS_COMBINE,v.SKY,v.MAIN_PLANE_REFLECT_BLEND,v.MAIN_CUBE_REFLECT_BLEND,v.LUMINANCE_TRUNCED,v.SHADOW_RECEIVE,v.SHADOW_CAST,v.COLOR_PICKING,v.COLOR_PICKING_XRAY,v.OUTLINE_MASK],M=[v.MAIN_OPAQUE,v.SSAO,v.MAIN_BLEND,v.MAIN_XRAY,v.MAIN_GLOW,v.MAIN_PLANE_REFLECT,v.MAIN_CUBE_REFLECT,v.MAIN_PLANE_REFLECT_BLEND,v.MAIN_CUBE_REFLECT_BLEND],x=[v.SHADOW_CAST,v.MAIN_OPAQUE,v.MAIN_BLEND,v.MAIN_XRAY,v.MAIN_GLOW,v.MAIN_PLANE_REFLECT,v.MAIN_CUBE_REFLECT,v.MAIN_PLANE_REFLECT_BLEND,v.MAIN_CUBE_REFLECT_BLEND,v.COLOR_PICKING,v.COLOR_PICKING_XRAY,v.SHADOW_RECEIVE,v.GOD_RAYS,v.OUTLINE_MASK,v.DEBUG_VIEW],y=[v.MAIN_OPAQUE,v.MAIN_BLEND,v.MAIN_XRAY,v.MAIN_GLOW,v.MAIN_PLANE_REFLECT,v.MAIN_CUBE_REFLECT,v.MAIN_PLANE_REFLECT_BLEND,v.MAIN_CUBE_REFLECT_BLEND],w=8,U=null,C=null,D=[],F=null,G=1e-4,k=2,K=Math.PI/2,B=10,X=.1,z=.005,j=.005,q=new Float32Array(2),Z=new Float32Array(3),ee=new Float32Array(3),te=new Float32Array(4),re=new Float32Array(4),_e=new Float32Array(16),ne=new Float32Array(24),ae=new Float32Array(24),oe={max_x:0,min_x:0,max_y:0,min_y:0,max_z:0,min_z:0},ie={max_x:0,min_x:0,max_y:0,min_y:0,max_z:0,min_z:0},se=0,Ee=-1/0,ce=new Uint8Array(4);function le(){return U||(U=Te(D)),U}function Te(e){for(var t=0;t<e.length;t++){var r=e[t];if(!r._render_to_textures||!r._render_to_textures.length)return r}return null}function ue(){return C||r.panic("No active scene available"),C}function de(){return D}function fe(e){if(e.b4w_reflexible){for(var t=e._object.materials,r=0;r<t.length;r++){var _=t[r].blend_mode;if("OPAQUE"!=_&&"CLIP"!=_&&"ALPHA_ANTIALIASING"!=_)return!0}return!1}}function Pe(e,t){for(var r=ze(e,[v.MAIN_OPAQUE,v.MAIN_BLEND,v.MAIN_GLOW]),_=0;_<r.length;_++)r[_].bsdf_cube_sky_dim=t}function Ae(e,t,r,a,o){switch(e.type){case v.MAIN_OPAQUE:Se(e,t,r,"OPAQUE",a,o);break;case v.MAIN_BLEND:Se(e,t,r,"BLEND",a,o);break;case v.MAIN_XRAY:Se(e,t,r,"XRAY",a,o);break;case v.MAIN_GLOW:Se(e,t,r,"GLOW",a,o);break;case v.MAIN_PLANE_REFLECT:case v.MAIN_CUBE_REFLECT:ge(e,t,r,!1,a,o);break;case v.MAIN_PLANE_REFLECT_BLEND:case v.MAIN_CUBE_REFLECT_BLEND:ge(e,t,r,!0,a,o);break;case v.SHADOW_RECEIVE:!function(e,t,r,n,a){for(var o=d.get_scene_data(t,n),i=o.batches,s=0;s<i.length;s++){var E=i[s];if("SHADOW"==E.type&&"RECEIVE"==E.subtype&&E.shadow_receive&&(a||(me(E,e,t,r,"SHADOW",n),_.update_shader(E)))){var c=v.init_bundle(E,t.render,o.batch_world_bounds[s]);v.append_draw_data(e,c),Me(r,e,E,!1),ve(E)}}}(e,t,r,a,o);break;case v.SHADOW_CAST:!function(e,t,r,n,a){for(var o=!1,i=t.render,s=d.get_scene_data(t,n),E=s.batches,c=p.find_subs(r,v.GRASS_MAP),l=0;l<E.length;l++){var T=E[l];if("SHADOW"==T.type&&"CAST"==T.subtype){if(o=!0,!a){pe(T);var u=e.num_lights;_.set_batch_directive(T,"NUM_LIGHTS",u);var f=u%2==0?u/2:Math.floor(u/2)+1;if(_.set_batch_directive(T,"NUM_LFACTORS",f),Oe(T.shaders_info,e.camera),O.set_directive(T.shaders_info,"SHADOW_USAGE","SHADOW_CASTING"),T.dynamic_grass&&c&&Ne(T,c,i),_.set_batch_directive(T,"SHADOW_TEX_RES",O.glsl_value(n._render.shadow_params.csm_resolution)),!_.update_shader(T))continue}T.dynamic_grass&&(n._render.shadow_params.dynamic_grass_cast=!0);var P=v.init_bundle(T,i,s.batch_world_bounds[l]);v.append_draw_data(e,P),Me(r,e,T,!1),ve(T)}}if(o){var A=n._render.shadow_params;Ye(e,n,p.find_subs(r,v.MAIN_OPAQUE).camera,A,!0)}}(e,t,r,a,o);break;case v.COLOR_PICKING:case v.COLOR_PICKING_XRAY:!function(e,t,r,n,a){for(var o=t.render,i=d.get_scene_data(t,n),s=i.batches,E=0;E<s.length;E++){var c=s[E];if("COLOR_ID"==c.type&&(e.type==v.COLOR_PICKING&&"COLOR_ID"==c.subtype||e.type==v.COLOR_PICKING_XRAY&&"COLOR_ID_XRAY"==c.subtype)&&(a||(me(c,e,t,r,"COLOR_ID",n),_.set_batch_directive(c,"USE_OUTLINE",0),_.update_shader(c)))){var l=v.init_bundle(c,o,i.batch_world_bounds[E]);v.append_draw_data(e,l)}}}(e,t,r,a,o);break;case v.OUTLINE_MASK:!function(e,t,r,n,a){for(var o=t.render,i=d.get_scene_data(t,n),s=i.batches,E=0;E<s.length;E++){var c=s[E];if("COLOR_ID"==c.type&&"OUTLINE"==c.subtype&&(a||(me(c,e,t,r,"COLOR_ID",n),_.set_batch_directive(c,"USE_OUTLINE",1),_.update_shader(c)))){var l=v.init_bundle(c,o,i.batch_world_bounds[E]);v.append_draw_data(e,l)}}}(e,t,r,a,o);break;case v.GRASS_MAP:!function(e,t,r,o){for(var i=t.render,s=d.get_scene_data(t,a),E=s.batches,c=0;c<E.length;c++){var l=E[c];if("GRASS_MAP"==l.type){if(!o&&!_.update_shader(l)){if("DEBUG"!==Ki())continue;_.apply_shader(l,"error.glslv","error.glslf"),_.update_shader(l)}var T=v.init_bundle(l,i,s.batch_world_bounds[c]);v.append_draw_data(e,T);var u=e.camera,f=i.bb_world,P=e.grass_map_dim[0],A=e.grass_map_dim[1],S=e.grass_map_dim[2];0==P&&0==A?(P=f.min_z,A=f.max_z):(P=Math.min(P,f.min_z),A=Math.max(A,f.max_z));var p=(A-P)*G;A+=p,e.grass_map_dim[0]=P-=p,e.grass_map_dim[1]=A,n.set_frustum2(u,S/2,S/2,-A,-P),n.set_projection(u,!1)}}}(e,t,0,o);break;case v.DEBUG_VIEW:!function(e,t,r,n,o){for(var i=t.render,s=d.get_scene_data(t,a),E=s.batches,c=0;c<E.length;c++){var l=E[c];if("DEBUG_VIEW"==l.type){if(!o){if(l.dynamic_grass){var T=p.find_subs(r,v.GRASS_MAP);T&&Ne(l,T,i)}if(!_.update_shader(l)){if("DEBUG"!==Ki())return;_.apply_shader(l,"error.glslv","error.glslf"),_.update_shader(l)}}var u=v.init_bundle(l,i,s.batch_world_bounds[c]);v.append_draw_data(e,u),Me(r,e,l,!1),ve(l)}}}(e,t,r,0,o)}}function Se(e,t,r,n,a,o){for(var i=t.render,s=d.get_scene_data(t,a),E=s.batches,c=0;c<E.length;c++){var l=E[c];if(!l.shadow_cast_only&&!l.reflexible_only&&("MAIN"==l.type||"NODES_GLOW"==l.type||"PARTICLES"==l.type||"LINE"==l.type)&&("OPAQUE"==l.subtype&&"OPAQUE"==n||"BLEND"==l.subtype&&"BLEND"==n||"XRAY"==l.subtype&&"XRAY"==n||"NODES_GLOW"==l.type&&"GLOW"==n)){if(!o&&(me(l,e,t,r,n,a),!_.update_shader(l))){if("DEBUG"!==Ki())continue;_.apply_shader(l,"error.glslv","error.glslf"),_.update_shader(l)}var T=v.init_bundle(l,i,s.batch_world_bounds[c]);v.append_draw_data(e,T),Me(r,e,l,!1),ve(l)}}}function pe(e){e.lod_settings.use_smoothing&&_.set_batch_directive(e,"USE_LOD_SMOOTHING",1)}function me(e,t,n,o,i,E){var c=n.render,l=E._render,T=d.get_scene_data(n,E),u="NO_SHADOWS",f=ze(E,[v.SHADOW_CAST]);if(f.length&&e.shadow_receive){switch(i){case"OPAQUE":u="SHADOW_MAPPING_OPAQUE";break;case"BLEND":case"XRAY":u="SHADOW_MAPPING_BLEND";break;case"COLOR_ID":case"REFLECT":case"GLOW":u="NO_SHADOWS";break;case"SHADOW":u="SHADOW_MASK_GENERATION";break;default:r.panic("Wrong subscene type")}for(var P=0;P<f.length;P++)_.assign_shadow_receive_dirs(e,E._render.shadow_params,f[P])}var A="NO_SOFT_SHADOWS";if(l.shadow_params&&l.shadow_params.soft_shadows)switch(h.shadow_blur_samples){case"16x":A="POISSON_X_16";break;case"8x":A="POISSON_X_8";break;case"4x":A="POISSON_X_4"}var S=e.shaders_info;if(O.set_directive(S,"SHADOW_USAGE",u),O.set_directive(S,"POISSON_DISK_NUM",A),pe(e),e.dynamic_grass){var m=p.find_subs(o,v.GRASS_MAP);m&&Ne(e,m,c)}if(Oe(S,t.camera),"SHADOW"!=e.type&&"COLOR_ID"!=i||e.has_nodes){var g=t.num_lights;O.set_directive(S,"NUM_LIGHTS",g);var R=g%2==0?g/2:Math.floor(g/2)+1;O.set_directive(S,"NUM_LFACTORS",R),O.set_directive(S,"REFLECTION_PASS","REFL_PASS_NONE"),O.set_directive(S,"SSAO_ONLY",0);var I=l.water_params;if(I&&(O.set_directive(S,"WATER_EFFECTS",1),O.set_directive(S,"WAVES_HEIGHT",O.glsl_value(I.waves_height)),O.set_directive(S,"WAVES_LENGTH",O.glsl_value(I.waves_length)),O.set_directive(S,"WATER_LEVEL",O.glsl_value(I.water_level))),t.caustics&&e.caustics){O.set_directive(S,"CAUSTICS",1);var b=l.shadow_params;if(b){var Y=b.lamp_types,L=0;for(P=0;P<Y.length;P++)"SUN"==Y[P]&&(L=P);O.set_directive(S,"SUN_NUM",L)}O.set_directive(S,"CAUST_SCALE",O.glsl_value(t.caust_scale)),O.set_directive(S,"CAUST_SPEED",O.glsl_value(t.caust_speed,2)),O.set_directive(S,"CAUST_BRIGHT",O.glsl_value(t.caust_brightness))}var M=T.cube_refl_subs,x=T.plane_refl_subs,y=p.find_subs(o,v.SKY),w=p.find_subs(o,v.IRRADIANCE),U=p.find_subs(o,v.ROUGHNESS_CONVOLUTION);if(-1!==e.texture_names.indexOf("u_mirrormap"))O.set_directive(S,"REFLECTION_TYPE","REFL_MIRRORMAP");else if(e.reflective&&w&&U&&!M&&!x.length)_.append_texture(e,w.camera.color_attachment,"u_cube_irradiance"),_.append_texture(e,U.camera.color_attachment,"u_cube_r_convolution"),O.set_directive(S,"REFLECTION_TYPE","REFL_PBR_STANDARD");else if(!e.reflective||M||x.length||h.quality==a.P_LOW)if(e.reflective&&M){var C=M.camera.color_attachment;l.reflection_params.has_reflexible||(M.force_do_not_render=!0,y&&(C=y.camera.color_attachment)),_.append_texture(e,C,"u_cube_reflection"),O.set_directive(S,"REFLECTION_TYPE","REFL_CUBE")}else if(e.reflective&&x)for(P=0;P<x.length;P++)_.append_texture(e,C=x[P].camera.color_attachment,"u_plane_reflection"),O.set_directive(S,"REFLECTION_TYPE","REFL_PLANE");else O.set_directive(S,"REFLECTION_TYPE","REFL_NONE");else y?(_.append_texture(e,y.camera.color_attachment,"u_sky_reflection"),O.set_directive(S,"REFLECTION_TYPE","REFL_PBR_SIMPLE")):O.set_directive(S,"REFLECTION_TYPE","REFL_NONE");y?e.draw_proc_sky?_.append_texture(e,C=y.camera.color_attachment,"u_sky"):y.procedural_skydome&&(e.cube_fog=y.cube_fog,O.set_directive(S,"PROCEDURAL_FOG",1)):O.set_directive(S,"PROCEDURAL_FOG",0);var G=l.world_light_set;if(G.use_environment_light)if(O.set_directive(S,"USE_ENVIRONMENT_LIGHT",1),"SKY_TEXTURE"==G.environment_color){if(G.environment_texture_slot){var k=G.environment_texture_slot.texture;C=N.get_batch_texture(G.environment_texture_slot),_.append_texture(e,C,"u_sky_texture",k.name)}else y&&_.append_texture(e,C=y.camera.color_attachment,"u_sky_texture");O.set_directive(S,"SKY_TEXTURE",1)}else"SKY_COLOR"==G.environment_color&&O.set_directive(S,"SKY_COLOR",1);var K=l.world_fog_set;if(K.use_fog&&(O.set_directive(S,"USE_FOG",1),O.set_directive(S,"FOG_TYPE",K.falloff)),e.refractive&&e.blend?(h.depth_tex_available&&O.set_directive(S,"USE_REFRACTION_CORRECTION",1),"MAIN"==e.type&&e.has_nodes||"NODES_GLOW"==e.type?(O.set_directive(S,"REFRACTIVE",1),O.set_directive(S,"USE_REFRACTION",l.refractions?1:0)):O.set_directive(S,"REFRACTIVE",l.refractions?1:0),(l.materials_params.refractions||l.refractions)&&O.set_directive(S,"HAS_REFRACT_TEXTURE",1)):(O.set_directive(S,"REFRACTIVE",0),O.set_directive(S,"USE_REFRACTION",0),O.set_directive(S,"USE_REFRACTION_CORRECTION",0)),e.water&&(h.shore_smoothing&&e.water_shore_smoothing&&p.find_subs(o,v.DEPTH_PACK)?O.set_directive(S,"SHORE_SMOOTHING",1):O.set_directive(S,"SHORE_SMOOTHING",0),O.set_directive(S,"DYNAMIC",e.water_dynamic&&I&&I.waves_height?1:0)),"PARTICLES"==e.type&&O.set_directive(S,"COLOR_RAMP_LENGTH",e.particles_data.color_ramp_length),!e.forked_batch)for(var B=e.textures,X=0;X<B.length;X++)if("SCENE"==(C=B[X]).source)for(var H=0;H<D.length;H++)for(var Q=D[H],z=D[H]._render_to_textures,V=0;V<z.length;V++)z[V]==C&&s.append_edge_attr(F,Q,E,null)}}function Oe(e,t){O.set_directive(e,"CAMERA_TYPE",t.type==n.TYPE_ORTHO||t.type==n.TYPE_ORTHO_ASPECT||t.type==n.TYPE_ORTHO_ASYMMETRIC?"CAM_TYPE_ORTHO":"CAM_TYPE_PERSP")}function ve(e){e.textures.length>w&&A.warn(e.type,"too many textures used - "+e.textures.length+" (max "+w+'), materials "'+e.material_names.join(", ")+'"')}function Ne(e,t,r){e.grass_map_dim=t.grass_map_dim;var _=t.grass_map_dim[0],a=t.grass_map_dim[1],o=t.grass_map_dim[2],i=r.bb_local,s=Math.max(i.max_x-i.min_x,i.max_y-i.min_y);o=0==o?s:Math.max(o,s),t.grass_map_dim[2]=o;var E=t.camera;n.set_frustum2(E,o/2,o/2,-a,-_),n.set_projection(E,!1);var c=e.grass_size||0;c=0==c?s:Math.max(c,s),e.grass_size=c}function ge(e,t,r,n,a,o){for(var i=t.render,s=d.get_scene_data(t,a),E=s.batches,c=0;c<E.length;c++){var l=E[c];if(("MAIN"==l.type||"PARTICLES"==l.type||"LINE"==l.type)&&"REFLECT"==l.subtype&&l.blend==n){if(e.type==v.MAIN_PLANE_REFLECT||e.type==v.MAIN_PLANE_REFLECT_BLEND){if(it(a,e)==i.plane_reflection_id)continue}else if(st(a,e)==i.cube_reflection_id)continue;if(!o){me(l,e,t,r,"REFLECT",a);var T=l.shaders_info;if(O.set_directive(T,"WATER_EFFECTS",0),O.set_directive(T,"REFLECTION_PASS",e.type==v.MAIN_PLANE_REFLECT||e.type==v.MAIN_PLANE_REFLECT_BLEND?"REFL_PASS_PLANE":"REFL_PASS_CUBE"),O.set_directive(T,"TEXTURE_NORM",0),!_.update_shader(l)){if("DEBUG"!==Ki())continue;_.apply_shader(l,"error.glslv","error.glslf"),_.update_shader(l)}}var u=v.init_bundle(l,i,s.batch_world_bounds[c]);v.append_draw_data(e,u),Me(r,e,l,!1),ve(l)}}}function Ie(e){!function(e){var t=T.get_scene_objs(e,"LAMP",T.DATA_ID_ALL),r=d.get_shadow_lamps(t,h.ssao&&e.b4w_enable_ssao);if(r.length)for(var _=0;_<r.length;_++)for(var a=r[_],o=a.render,i=Ga(o.world_tsr,Z),s=Xa(o.world_tsr,te),E=0;E<a.scenes_data.length;E++){var c=a.scenes_data[E],l=c.shadow_subscenes;if(c.scene==e)for(var u=0;u<l.length;u++)n.set_view_trans_quat(l[u].camera,i,s)}}(e);var t=Ve(e,v.MAIN_OPAQUE),r=!0,_=e._render.shadow_params;s.traverse(e._render.graph,function(n,a){a.type===v.SHADOW_CAST&&(Ye(a,e,t.camera,_,r),r=!1)})}function be(e){s.traverse(e._render.graph,function(e,t){t.type===v.OUTLINE&&(t.draw_outline_flag=1)})}function Ye(e,t,r,_,a){if(0!=e.draw_data.length){var o=e.camera;if(Ma(r.world_tsr,o.world_tsr),Ma(r.view_tsr,o.shadow_cast_billboard_view_tsr),"SUN"===_.lamp_types[e.shadow_lamp_index]||"HEMI"===_.lamp_types[e.shadow_lamp_index]){var i=go(function(e,t,r){!function(e){e.max_x=0,e.min_x=0,e.max_y=0,e.min_y=0,e.max_z=0,e.min_z=0}(r);for(var _=0;_<e.draw_data.length;_++)for(var n=e.draw_data[_].bundles,a=0;a<n.length;a++){var o=n[a].batch,i=n[a].obj_render;if(o.dynamic_grass){var s=Xa(t,te),E=We(O_,s,ee),c=-E[0],l=E[1],T=Ga(t,ee),u=T[0]-o.grass_size*(1+c)/2,d=T[1]-o.grass_size*(1-l)/2,f=No(o.bounds_local.bb,i.world_tsr,ie),P=f.max_z-f.min_z;(A=ie).min_x=u,A.min_y=d,A.min_z=o.grass_map_dim[0]-P,A.max_x=u+o.grass_size,A.max_y=d+o.grass_size,A.max_z=o.grass_map_dim[1]+P}else var A=i.bb_world;0==_&&0==a?So(A,r):Oo(r,A)}return r}(e,r.world_tsr,oe),ne);if(An(i,o.view_matrix,i),_.enable_csm){var s=he(r.csm_centers[e.csm_index],Z);An(s,V(r.view_matrix,_e),s),An(s,o.view_matrix,s);var E=r.csm_radii[e.csm_index];if(a){se=0,Ee=-1/0;for(var c=2;c<i.length;c+=3)se=Math.min(se,i[c]),Ee=Math.max(Ee,i[c])}(l=oe).max_x=s[0]+E,l.max_y=s[1]+E,l.max_z=Ee,l.min_x=s[0]-E,l.min_y=s[1]-E,l.min_z=se}else{var l,T=function(e,t){var r=ae;r.set(e);var _=K/(B-1),n=Q(_e);$(n,_,O_,n);for(var a=-1,o=-1,i=0;i<B;i++){var s=vo(r,0,r.length,ie),E=(s.max_x-s.min_x)*(s.max_y-s.min_y);(-1==a||a-E>X)&&(a=E,o=i,So(s,t)),An(r,n,r)}return o*_}(i,l=oe);if(T>0){var u=Q(_e);$(u,T,O_,u),W(u,o.view_matrix,o.view_matrix),za(o.view_matrix,o.view_tsr)}l=function(e){var t=e.max_x-e.min_x,r=e.max_y-e.min_y;if(t&&r){var _=Math.abs(t-r)/2;t/r>k?(e.max_y+=_,e.min_y-=_):r/t>k&&(e.max_x+=_,e.min_x-=_)}return e.max_x+=z,e.max_y+=z,e.max_z+=j,e.min_x-=z,e.min_y-=z,e.min_z-=j,e}(l),Le(e,t._render.graph)}n.set_frustum_asymmetric(o,l.min_x,l.max_x,l.min_y,l.max_y,-l.max_z,-l.min_z),n.set_projection(o,!1)}else"SPOT"!==_.lamp_types[e.shadow_lamp_index]&&"POINT"!==_.lamp_types[e.shadow_lamp_index]||n.set_projection(o,!1)}}function Le(e,t){for(var r=e.camera,_=p.get_outputs(t,e),n=0;n<_.length;n++){var a=_[n];if(a.type==v.MAIN_OPAQUE||a.type==v.SHADOW_RECEIVE||a.type==v.MAIN_BLEND||a.type==v.MAIN_XRAY)if(h.mac_os_shadow_hack)a.v_light_tsr.set(r.view_tsr,9*e.shadow_lamp_index);else{var o=Fa(r.view_tsr),i=ka(r.view_tsr),s=Ba(r.view_tsr);ar(o[0],o[1],o[2],i,re),a.v_light_ts.set(re,4*e.shadow_lamp_index),a.v_light_r.set(s,4*e.shadow_lamp_index)}}}function Me(e,t,n,a){var o=s.node_by_attr(e,t);s.traverse_inputs(e,o,function(e,t,o){var i=o,s=t;if(i.active){switch(i.from){case"COLOR":case"CUBEMAP":var E=s.camera.color_attachment;break;case"DEPTH":E=s.camera.depth_attachment;break;case"SCREEN":E=null;break;case v.MAIN_CUBE_REFLECT:return;default:r.panic("Wrong slink")}switch(i.to){case"COLOR":case"CUBEMAP":case"DEPTH":case"NONE":case"SCREEN":case"OFFSCREEN":case"RESOLVE":case"COPY":case"u_cube_reflection":case"u_plane_reflection":break;default:if(!E){if(a)return;r.panic("Connection of SCREEN is forbidden")}E.w_renderbuffer&&r.panic("Batch texture can't use renderbuffer"),O.check_uniform(n.shader,i.to)&&(a?_.replace_texture(n,E,i.to):_.append_texture(n,E,i.to))}}});for(var i=0;i<t.slinks_internal.length;i++){var E=t.slinks_internal[i],c=t.textures_internal[i];switch(E.to){case"COLOR":case"CUBEMAP":case"DEPTH":case"NONE":case"SCREEN":case"OFFSCREEN":case"RESOLVE":case"COPY":break;default:c.w_renderbuffer&&r.panic("Batch texture can't use renderbuffer"),O.check_uniform(n.shader,E.to)&&(a?_.replace_texture(n,c,E.to):_.append_texture(n,c,E.to))}}}function xe(e,t){if(e.render.hide=t,d.is_lamp(e))for(var r=0;r<e.scenes_data.length;r++)for(var _=e.scenes_data[r],n=ze(_.scene,L),a=0;a<n.length;a++)s=(o=e).render,(i=n[a]).light_positions[4*(c=_.light_index)+3]=(E=o.light).use_diffuse&&!s.hide?1:0,i.light_color_intensities[4*c+3]=E.use_specular&&!s.hide?1:0,i.need_perm_uniforms_update=!0;var o,i,s,E,c}function we(e,t){for(var r=ze(t,L),a=e.light,o=e.render,i=d.get_scene_data(e,t),s=Fa(o.world_tsr),E=Ba(o.world_tsr),c=0;c<r.length;c++){switch(Ue(e,i,O=r[c]),a.type){case"SUN":O.sun_quaternion.set(E),O.sun_intensity=a.color_intensity,he(a.direction,O.sun_direction),O.type==v.SKY&&O.procedural_skydome&&(O.need_fog_update=a.need_sun_fog_update,Fe(t,O));break;case"HEMI":case"POINT":case"SPOT":break;default:A.error("Unknown light type: "+a.type+'".')}for(var l=O.draw_data,T=0;T<l.length;T++)for(var u=l[T].bundles,f=0;f<u.length;f++){var P=u[f].batch;P.lamp_uuid_indexes&&_.set_lamp_data(P,e)}}var S=Ve(t,v.MAIN_OPAQUE).camera,p=i.shadow_subscenes,m=t._render.shadow_params;for(c=0;c<p.length;c++){var O;n.set_view_trans_quat((O=p[c]).camera,s,E),Ye(O,t,S,m,!0),Le(O,t._render.graph)}}function Ue(e,t,r){var _=e.render,n=e.light,a=t.light_index,o=Fa(e.render.world_tsr),i=n.color_intensity;r.light_directions.set(n.direction,3*a),re[0]=o[0],re[1]=o[1],re[2]=o[2],re[3]=n.use_diffuse&&!_.hide?1:0,r.light_positions.set(re,4*a),re[0]=i[0],re[1]=i[1],re[2]=i[2],re[3]=n.use_specular&&!_.hide?1:0,r.light_color_intensities.set(re,4*a),r.need_perm_uniforms_update=!0}function Ce(e){var t=Ve(e,v.SKY);t&&Fe(e,t)}function Fe(e,t){if(f.prerender_subs(t),S.draw(t),t.need_fog_update)for(var r=ze(e,M),n=0;n<r.length;n++)for(var a=r[n].draw_data,o=0;o<a.length;o++)for(var i=a[o].bundles,s=0;s<i.length;s++){var E=i[s];if(E.do_render){var c=E.batch;_.check_batch_perm_uniform(c,"u_cube_fog")&&S.update_batch_permanent_uniform(c,"u_cube_fog")}}!function(e){var t=Ve(e,v.IRRADIANCE);t&&(f.prerender_subs(t),S.draw(t));var r=Ve(e,v.ROUGHNESS_CONVOLUTION);r&&(f.prerender_subs(r),S.draw(r));var _=Ve(e,v.BRDF);_&&(f.prerender_subs(_),S.draw(_))}(e)}function ke(e){var t=e.camera;S.render_target_cleanup(t.framebuffer,t.color_attachment,t.depth_attachment,t.width,t.height);for(var r=e.draw_data,n=0;n<r.length;n++)for(var a=r[n].bundles,o=0;o<a.length;o++){var i=a[o].batch;i&&_.clear_batch(i)}}function Xe(e){for(var t=[],r=0;r<e.length;r++)for(var _=e[r]._object.materials,n=0;n<_.length;n++){var a=_[n];-1==t.indexOf(a)&&t.push(a)}return t}function He(e,t,r,_){var n=t,a=r;o.is_hidpi()&&(n*=window.devicePixelRatio,a*=window.devicePixelRatio);var i=le();if(i){var s=i._render;n*=s.resolution_factor,a*=s.resolution_factor}return n*=e.size_mult_x,a*=e.size_mult_y,_[0]=Math.floor(n),_[1]=Math.floor(a),_}function Qe(e,t,r){var _=e._render,a=d.get_scene_data(e._camera,e).cameras;if(0!=r)var o=t/r;else o=1;for(var i=0;i<a.length;i++){var s=a[i];n.set_aspect(s,o),n.set_projection(s,!1),_.shadow_params&&n.update_camera_shadows(s,_.shadow_params)}if(_.shadow_params){_.need_shadow_update=!0;var E=ze(e,[v.SHADOW_RECEIVE]);for(i=0;i<E.length;i++)E[i].need_perm_uniforms_update=!0;var c=ze(e,[v.MAIN_BLEND]);for(i=0;i<c.length;i++)c[i].need_perm_uniforms_update=!0}!function(e,t,r){var _=e._render.graph,n=1/0;p.traverse_slinks(_,function(e,_,a,o){e.update_dim&&(n=Math.min(n,function(e,t,r){var _=He(e,t,r,q);return _[0]>R.max_texture_size||_[1]>R.max_texture_size?(A.warn("Texture size exceeds platform limits, downscaling"),Math.min(R.max_texture_size/_[0],R.max_texture_size/_[0])):1}(e,t,r)))}),p.traverse_slinks(_,function(a,o,i,s){var E,c,l;if(a.update_dim)if(s&&s.type==v.SINK||i.is_pp&&!a.apply_resolution_factors?(E=t*a.size_mult_x,c=r*a.size_mult_y):(E=(l=He(a,t,r,q))[0]*n,c=l[1]*n),o)for(var T=0;T<i.slinks_internal.length;T++)i.slinks_internal[T]==a&&N.resize(a.texture,E,c);else{N.is_texture(a.texture)&&(N.resize(a.texture,E,c),a.texture.use_mipmap&&(s.last_mip_map_ind=a.texture.mipmap_count));var u=i.camera;switch(u.width=E,u.height=c,i.type){case v.DOF:qe(e,{dof_power:i.camera.dof_power});break;case v.GLOW_COMBINE:$e(e,{small_glow_mask_width:i.small_glow_mask_width,large_glow_mask_width:i.large_glow_mask_width});break;case v.BLOOM:Ze(e,{blur:i.bloom_blur});break;case v.RESIZE:u.width=u.color_attachment.width,u.height=u.color_attachment.height;break;case v.OUTLINE:var d=p.find_input(_,i,v.POSTPROCESSING),f=p.find_input(_,d,v.POSTPROCESSING),P=p.find_input(_,f,v.POSTPROCESSING),A=p.find_input(_,P,v.POSTPROCESSING);p.set_texel_size(d,1/E,1/E),p.set_texel_size(f,1/E,1/E),p.set_texel_size(P,1/E,1/E),p.set_texel_size(A,1/E,1/E);break;default:p.set_texel_size(i,1/E,1/c)}}})}(e,t,r)}function ze(e,t){for(var r=[],_=0;_<t.length;_++){var n=t[_];e._render.graph&&s.traverse(e._render.graph,function(e,t){t.type==n&&r.push(t)})}return r}function Ve(e,t){return p.find_subs(e._render.graph,t)}function je(e){var t=le();t&&s.traverse(t._render.graph,function(t,r){var _=r.camera;_&&_.type==n.TYPE_HMD_RIGHT&&(r.force_do_not_render=e)})}function qe(e,t){var r=ze(e,[v.DOF]);if(!r.length)return A.error("DOF is not enabled on the scene. Check camera settings"),0;for(var _=0;_<r.length;_++)Je(r[_],t,e)}function Je(e,t,r){var _=e.dof_bokeh,n=_?ze(r,[v.COC]):[],a=r._render.graph;if("boolean"==typeof t.dof_on&&(e.camera.dof_on=t.dof_on,_))for(var o=0;o<n.length;o++)n[o].camera.dof_on=t.dof_on;if("number"==typeof t.dof_distance&&(e.camera.dof_distance=t.dof_distance,_))for(o=0;o<n.length;o++)n[o].camera.dof_distance=t.dof_distance;if("number"==typeof t.dof_front_start&&(e.camera.dof_front_start=t.dof_front_start,_))for(o=0;o<n.length;o++)n[o].camera.dof_front_start=t.dof_front_start;if("number"==typeof t.dof_front_end&&(e.camera.dof_front_end=t.dof_front_end,_))for(o=0;o<n.length;o++)n[o].camera.dof_front_end=t.dof_front_end;if("number"==typeof t.dof_rear_start&&(e.camera.dof_rear_start=t.dof_rear_start,_))for(o=0;o<n.length;o++)n[o].camera.dof_rear_start=t.dof_rear_start;if("number"==typeof t.dof_rear_end&&(e.camera.dof_rear_end=t.dof_rear_end,_))for(o=0;o<n.length;o++)n[o].camera.dof_rear_end=t.dof_rear_end;if("number"==typeof t.dof_bokeh_intensity&&(e.camera.dof_bokeh_intensity=t.dof_bokeh_intensity,_&&((u=p.get_inputs_by_type(a,e,v.POSTPROCESSING))[0].camera.dof_bokeh_intensity=t.dof_bokeh_intensity,u[1].camera.dof_bokeh_intensity=t.dof_bokeh_intensity,u[0]=p.find_input(a,u[0],v.POSTPROCESSING),u[0].camera.dof_bokeh_intensity=t.dof_bokeh_intensity)),"number"==typeof t.dof_power)if(_){var i=t.dof_power;e.camera.dof_power=i,i/=2;var s=e.camera.width,E=e.camera.height,c=[1/s,0],l=[1/s*.5,1/E*.866],T=[-1/s*.5,1/E*.866],u=p.get_inputs_by_type(a,e,v.POSTPROCESSING);p.set_texel_size_mult(u[0],i),p.set_texel_size(u[0],T[0],T[1]),p.set_texel_size_mult(u[1],i),p.set_texel_size(u[1],l[0],l[1]),u[0]=p.find_input(a,u[0],v.POSTPROCESSING),p.set_texel_size_mult(u[0],i),p.set_texel_size(u[0],c[0],c[1]),e.camera.dof_foreground_blur&&(u[0]=p.find_input(a,u[0],v.COC),u[0]=p.find_input(a,u[0],v.POSTPROCESSING),p.set_texel_size(u[0],1/s,1/E),u[0]=p.find_input(a,u[0],v.POSTPROCESSING),p.set_texel_size(u[0],1/s,1/E))}else{e.camera.dof_power=t.dof_power;var d=p.find_input(a,e,v.POSTPROCESSING),f=p.find_input(a,d,v.POSTPROCESSING);p.set_texel_size_mult(d,e.camera.dof_power),p.set_texel_size(d,1/e.camera.width,1/e.camera.height),p.set_texel_size_mult(f,e.camera.dof_power),p.set_texel_size(f,1/e.camera.width,1/e.camera.height)}}function Ze(e,t){var r=ze(e,[v.LUMINANCE_TRUNCED]),_=ze(e,[v.BLOOM]);if(!r.length||!_.length)return A.error("Bloom is not enabled on the scene"),0;if("number"==typeof t.key)for(var n=0;n<r.length;n++)r[n].bloom_key=t.key,r[n].need_perm_uniforms_update=!0;if("number"==typeof t.edge_lum)for(n=0;n<r.length;n++)r[n].bloom_edge_lum=t.edge_lum,r[n].need_perm_uniforms_update=!0;if("number"==typeof t.blur)for(n=0;n<_.length;n++){_[n].bloom_blur=t.blur;for(var a=e._render.graph,o=_[n].camera.width/.5,i=_[n].camera.height/.5,s=p.get_inputs_by_type(a,_[n],v.POSTPROCESSING),E=0;E<s.length;++E){var c=s[E],l=p.find_input(a,c,v.POSTPROCESSING),T=o*c.bloom_blur_scale,u=i*c.bloom_blur_scale;p.set_texel_size_mult(c,t.blur),p.set_texel_size(c,1/T,1/u),p.set_texel_size_mult(l,t.blur),p.set_texel_size(l,1/T,1/u)}}if("number"==typeof t.average_luminance)for(n=0;n<r.length;n++)r[n].adaptive_bloom||(r[n].average_luminance=t.average_luminance,r[n].need_perm_uniforms_update=!0)}function $e(e,t){var r=ze(e,[v.GLOW_COMBINE]);if(!r.length)return A.error("Glow is not enabled on the scene"),null;for(var _=0;_<r.length;_++)et(r[_],t,e)}function et(e,t,r){for(var _=r._render.graph,n=p.get_inputs(_,e),a=0;a<n.length;++a){var o=n[a];if(o.type==v.POSTPROCESSING&&"GLOW_MASK_LARGE"==o.subtype)var i=o;if(o.type==v.POSTPROCESSING&&"GLOW_MASK_SMALL"==o.subtype)var s=o}var E=p.find_input(_,i,v.POSTPROCESSING),c=p.find_input(_,s,v.POSTPROCESSING);"number"==typeof t.small_glow_mask_coeff&&(e.small_glow_mask_coeff=t.small_glow_mask_coeff,e.need_perm_uniforms_update=!0),"number"==typeof t.large_glow_mask_coeff&&(e.large_glow_mask_coeff=t.large_glow_mask_coeff,e.need_perm_uniforms_update=!0),"number"==typeof t.small_glow_mask_width&&(e.small_glow_mask_width=t.small_glow_mask_width,p.set_texel_size_mult(s,t.small_glow_mask_width),p.set_texel_size(s,1/e.camera.width,1/e.camera.height),s.need_perm_uniforms_update=!0,p.set_texel_size_mult(c,t.small_glow_mask_width),p.set_texel_size(c,1/e.camera.width,1/e.camera.height),c.need_perm_uniforms_update=!0),"number"==typeof t.large_glow_mask_width&&(e.large_glow_mask_width=t.large_glow_mask_width,p.set_texel_size_mult(i,t.large_glow_mask_width),p.set_texel_size(i,1/e.camera.width,1/e.camera.height),i.need_perm_uniforms_update=!0,p.set_texel_size_mult(E,t.large_glow_mask_width),p.set_texel_size(E,1/e.camera.width,1/e.camera.height),E.need_perm_uniforms_update=!0)}function tt(e,t,r){var _=e._render,n=_.water_params;if(!n.dynamic)return n.water_level;var a=n.waves_height,o=n.waves_length,i=n.water_level,s=De(_.wind)||1,E=Ve(e,v.MAIN_OPAQUE).time,c=q;c[0]=20/o*(t-.25*(E*=s)),c[1]=20/o*(r-.25*E);var l=yn(c);c[0]=17/o*(r+.1*E),c[1]=17/o*(t+.1*E);var T=l+yn(c)-1,u=n.dst_noise_scale0,d=n.dst_noise_scale1,f=n.dst_noise_freq0,P=n.dst_noise_freq1,A=q;A[0]=u*(t+f*E),A[1]=u*(r+f*E);var S=Yn(A);A[0]=d*(r-P*E),A[1]=d*(t-P*E);var p=a*S*Yn(A);if(n.shoremap_image){var m=(t-n.shoremap_center[0])/n.shoremap_size[0],O=(n.shoremap_center[1]+r)/n.shoremap_size[1];if(O+=.5,(m+=.5)>1||m<0||O>1||O<0)var N=p;else{var g=Bn(_.shore_distances,n.shoremap_tex_size,m,O),h=n.dir_min_shore_fac,R=n.dir_freq,I=n.dir_noise_scale,b=n.dir_noise_freq,Y=n.dir_min_noise_fac,L=n.dst_min_fac,M=o/n.max_shore_dist/Math.PI,x=[I/o*(t+b*E),I/o*(r+b*E)],y=Math.sqrt(g),w=a*Math.max(g,h)*Math.sin(y/M+R*E)*Math.max(Yn(x),Y),U=Math.max(y,L);N=w*(1-U)+p*U,T*=g}}else N=p;return i+(N+.05*T)}function rt(e,t,r){t.is_for_outline&&t.type==v.POSTPROCESSING&&r.do_render!=t.do_render&&(t.do_render=r.do_render),r.do_render||t.type!=v.OUTLINE||(t.draw_outline_flag=0)}function _t(e,t,r,n){for(var a=s.get_node_attr(e,t).draw_data,o=0;o<a.length;o++)for(var i=a[o].bundles,E=0;E<i.length;E++)_.replace_texture(i[E].batch,n,r)}function nt(e){for(var t=ze(e,[v.GRASS_MAP]),r=0;r<t.length;r++){var _=t[r],a=_.camera,o=e._camera.render,i=Ga(o.world_tsr,Z),s=ee;s[0]=0,s[1]=0,s[2]=-_.grass_map_dim[2]/2;var E=Xa(o.world_tsr,te);We(s,E,s),s[0]+=i[0],s[1]+=i[1],s[2]=0,Cr(E),n.set_view_trans_quat(a,s,E)}}function at(e,t){s.traverse(e,function(_,a){var o=a;if(o.type==v.MOTION_BLUR){o.slinks_internal[0]&&o.textures_internal[0]||r.panic("Wrong MOTION_BLUR subscene");var i=o.slinks_internal[0],E=o.textures_internal[0];o.textures_internal[0]=o.camera.color_attachment,s.traverse_outputs(e,_,function(t,r,_){_.active&&_t(e,t,_.to,E)}),function e(t,r,_,a){var o=s.get_node_attr(t,r);n.set_attachment(o.camera,_,a),o.assign_texture=!0,s.traverse_outputs(t,r,function(e,r,n){var o=n;o.active&&o.from==_&&p.check_slink_tex_conn(o)&&_t(t,e,o.to,a)}),s.traverse_inputs(t,r,function(r,n,o){o.active&&o.from==_&&o.from==o.to&&e(t,r,_,a)})}(e,_,i.from,E),_t(e,_,i.to,o.textures_internal[0]),o.motion_blur_exp=Math.exp(-t/o.mb_factor)}})}function ot(e){return e._render.wind}function it(e,t){for(var r=e._render.reflection_params.plane_refl_subs,_=0;_<r.length;_++)for(var n=0;n<r[_].length;n++)if(r[_][n]==t)return _;var a=e._render.reflection_params.plane_refl_subs_blend;for(_=0;_<a.length;_++)for(n=0;n<a[_].length;n++)if(a[_][n]==t)return _;return null}function st(e,t){if(!e._render.reflection_params)return null;for(var r=e._render.reflection_params.cube_refl_subs,_=0;_<r.length;_++)if(r[_]==t)return _;var n=e._render.reflection_params.cube_refl_subs_blend;for(_=0;_<n.length;_++)if(n[_]==t)return _;return null}t.create_scene_render=function(){return{}},t.set_active=function(e){C=e,m.set_active_scene(e)},t.prepare_rendering=function(e,t){var r=e._render,_=p.create_rendering_queue(r.graph);if(e==t){Qe(e,o.get_viewport_width(),o.get_viewport_height());for(var n=0;n<_.length;n++)e._render.queue.push(_[n])}else{var a=e._render_to_textures[0];for(Qe(e,a.source_size,a.source_size),n=0;n<_.length;n++)t._render.queue.push(_[n])}for(var i=ze(e,x),s=0;s<i.length;s++)i[s].wind.set(r.wind);for(n=0;n<r.queue.length;n++)r.queue[n].type==v.SHADOW_CAST&&S.draw(r.queue[n])},t.get_main=le,t.find_main_scene=Te,t.get_active=ue,t.check_active=function(){return!!C},t.get_camera=function(e){return e._camera},t.get_all_scenes=de,t.get_rendered_scenes=function(){if(1==D.length)return D;for(var e=0;e<D.length;e++)s.traverse(a=D[e]._render.graph,function(t,r){for(var n=r,a=n.draw_data,o=0;o<a.length;o++)for(var i=a[o].bundles,s=0;s<i.length;s++){for(var E=i[s],c=E.batch.textures,l=E.batch.bpy_tex_names,T=null,d=0;d<c.length;d++)if("SCENE"==c[d].source&&c[d].source_id==D[e].name&&n.type!=v.COPY){A.error('Texture-scene loop detected. A scene is rendered to texture "'+l[d]+'" yet this texture belongs to the same scene.'),T=E.batch;break}if(T){var f=T.textures;for(T.textures=[],T.texture_names=[],_.update_batch_material_error(T,null),_.update_shader(T),v.append_draw_data(n,E),d=0;d<f.length;d++)u.cleanup_unused(f[d])}}});var t=[];for(e=0;e<D.length;e++){var r=D[e];if(!r._render_to_textures.length){var n=s.node_by_attr(F,r);s.enforce_acyclic(F,n);var a=s.subgraph_node_conn(F,n,s.BACKWARD_DIR);a=s.topsort(a),s.traverse(a,function(e,r){t.push(r)});break}}return t},t.append_scene=function(e,t,r,_,i){e._render_to_textures=e._render_to_textures||[],e._nla=null;var E=e._render,T=d.get_scene_data(e._camera,e),u=e._camera.render;E.video_textures=[];var f=e.world;E.lamps_number=r.length,E.sun_exist=function(e){for(var t=0;t<e.length;t++)if("SUN"==e[t].light.type)return!0;return!1}(r),E.sky_params=function(e,t){var r=e.b4w_sky_settings,_={};return _.render_sky=r.render_sky||r.procedural_skydome,_.procedural_skydome=r.procedural_skydome,_.use_as_environment_lighting=r.use_as_environment_lighting,_.sky_color=r.color,_.rayleigh_brightness=r.rayleigh_brightness,_.mie_brightness=r.mie_brightness,_.spot_brightness=r.spot_brightness,_.scatter_strength=r.scatter_strength,_.rayleigh_strength=r.rayleigh_strength,_.mie_strength=r.mie_strength,_.rayleigh_collection_power=r.rayleigh_collection_power,_.mie_collection_power=r.mie_collection_power,_.mie_distribution=r.mie_distribution,_.reflexible=r.reflexible,_.reflexible_only=r.reflexible_only,!t&&r.procedural_skydome&&A.warn("There is no sun on the scene. Procedural sky will use a default sun position."),_}(f,E.sun_exist),E.world_light_set=function(e,t){var r=e.light_settings,_={};if(_.environment_energy=r.environment_energy,_.use_environment_light=r.use_environment_light,_.environment_color=r.environment_color,_.horizon_color=e.horizon_color.slice(0),_.zenith_color=e.zenith_color.slice(0),_.use_sky_paper=e.use_sky_paper,_.use_sky_blend=e.use_sky_blend,_.use_sky_real=e.use_sky_real,_.sky_texture_slot=null,_.sky_texture_param=null,_.environment_texture_slot=null,_.ngraph_proxy_id="",t.render_sky&&e.use_nodes&&e.node_tree){var n=l.compose_ngraph_proxy(e.node_tree,e.uuid,!1,e.name+"(World)",e.name,"MAIN",null,[]);_.ngraph_proxy_id=n.id}var a=!0;if(_.use_environment_light&&"SKY_TEXTURE"==_.environment_color&&(!t.procedural_skydome||!t.use_as_environment_lighting)){for(var o=null,i=0;i<e.texture_slots.length;i++)if(e.texture_slots[i].texture.b4w_use_as_environment_lighting&&!e.texture_slots[i].texture.b4w_use_as_skydome){o=e.texture_slots[i];break}o?_.environment_texture_slot=o:a=!1}for(i=0;i<e.texture_slots.length;i++)if(e.texture_slots[i].texture.b4w_use_as_skydome){var s=e.texture_slots[i];if(s.texture.image){a=!0,_.sky_texture_slot=s;var E=Math.min(R.max_cube_map_texture_size,N.calc_pot_size(s.texture.image.size[0]/3));_.sky_texture_param={tex_size:E,blend_factor:s.blend_factor,horizon_factor:s.horizon_factor,zenith_up_factor:s.zenith_up_factor,zenith_down_factor:s.zenith_down_factor,color:s.color,default_value:s.default_value,invert:s.invert,use_rgb_to_intensity:s.use_rgb_to_intensity,blend_type:s.blend_type,use_map_blend:s.use_map_blend,use_map_horizon:s.use_map_horizon,use_map_zenith_up:s.use_map_zenith_up,use_map_zenith_down:s.use_map_zenith_down}}break}return _.use_environment_light=!!_.use_environment_light&&a,_}(f,E.sky_params),E.world_fog_set=function(e){var t=e.fog_settings,r={};r.use_fog=t.use_fog,r.intensity=t.intensity,r.depth=t.depth,r.start=t.start,r.height=t.height,r.falloff=t.falloff,r.color=t.use_custom_color?t.color.slice(0):e.horizon_color.slice(0);var _=r.color;return r.fog_color_density=new Float32Array([_[0],_[1],_[2],1/r.depth]),r.fog_params=new Float32Array([r.intensity,r.depth,r.start,r.height]),r}(f),E.hmd_stereo_use=!e._render_to_textures.length&&function(e){if("HMD"==h.stereo){if(e.cameras[0].type!=n.TYPE_PERSP)return A.warn("Head-mounted display stereo is disabled for the non-perspective camera"),h.stereo="NONE",!1;if(!c.can_use_device(c.DEVICE_HMD))return A.warn("Head-mounted display stereo is disabled for the non-WebVR and non-mobile devices"),h.stereo="NONE",!1}return"HMD"==h.stereo}(T),E.anaglyph_use=!e._render_to_textures.length&&function(e){return e.cameras[0].type!=n.TYPE_PERSP&&"ANAGLYPH"==h.stereo?(A.warn("Anaglyph stereo is disabled for the non-perspective camera"),h.stereo="NONE",!1):"ANAGLYPH"==h.stereo}(T),E.sidebyside_use=!e._render_to_textures.length&&function(e){return e.cameras[0].type!=n.TYPE_PERSP&&"SIDEBYSIDE"==h.stereo?(A.warn("Side-by-side stereo is disabled for the non-perspective camera"),h.stereo="NONE",!1):"SIDEBYSIDE"==h.stereo}(T),E.anchor_visibility=!E.anaglyph_use&&!E.sidebyside_use&&function(e,t){switch(e.b4w_enable_anchors_visibility){case"OFF":return!1;case"ON":return!0;case"AUTO":for(var r=0;r<t.length;r++){var _=t[r]._object;if(_.anchor&&_.anchor.detect_visibility)return!0}return!1}}(e,i),E.reflection_params=function(e,t,r){if(!h.reflections)return!1;switch(e.b4w_render_reflections){case"OFF":return!1}for(var _=[],n=0,a=!1,o=!1,i=!1,s=0;s<t.length;s++){var E=t[s];if(E.render.reflective&&"CUBE"==E.render.reflection_type&&n++,E.render.reflective&&"PBR"==E.render.reflection_type&&(o=!0),E.reflective_objs.length){for(var c=null,l=0;l<_.length;l++)if(_[l]==E){c=l;break}null==c&&_.push(E)}}for(s=0;s<r.length;s++){var T=r[s];T.b4w_reflexible&&(a=!0),fe(T)&&(i=!0)}return{refl_plane_objs:_,num_cube_refl:n,cube_refl_subs:[],cube_refl_subs_blend:[],plane_refl_subs:[],plane_refl_subs_blend:[],has_reflexible:a,has_pbr_reflexible:o,has_blend_reflexible:i}}(e,t,_),E.bloom_params=function(e){if(!h.bloom||!e.b4w_enable_bloom)return null;var t={},r=e.b4w_bloom_settings;return t.blur=r.blur,t.edge_lum=r.edge_lum,t.key=r.key,t.adaptive=r.adaptive,t.average_luminance=r.average_luminance,t}(e),E.mb_params=function(e){var t={},r=e.b4w_motion_blur_settings;return t.mb_decay_threshold=r.motion_blur_decay_threshold,t.mb_factor=r.motion_blur_factor,t}(e),E.cc_params=function(e){var t={},r=e.b4w_color_correction_settings;return t.brightness=r.brightness,t.contrast=r.contrast,t.exposure=r.exposure,t.saturation=r.saturation,t}(e),E.god_rays_params=function(e){var t={},r=e.b4w_god_rays_settings;return t.intensity=r.intensity,t.max_ray_length=r.max_ray_length,t.steps_per_pass=r.steps_per_pass,t}(e),E.outline_params=function(e){var t={};return t.outline_color=e.b4w_outline_color,t.outline_factor=e.b4w_outline_factor,t}(e),E.glow_params=function(e){var t={},r=e.b4w_glow_settings;return t.small_glow_mask_coeff=r.small_glow_mask_coeff,t.large_glow_mask_coeff=r.large_glow_mask_coeff,t.small_glow_mask_width=r.small_glow_mask_width,t.large_glow_mask_width=r.large_glow_mask_width,t}(e),E.dof=h.dof&&(u.dof_distance>0||u.dof_object),E.motion_blur=h.motion_blur&&e.b4w_enable_motion_blur,E.compositing=h.compositing&&e.b4w_enable_color_correction,E.antialiasing=h.antialiasing&&1==h.msaa_samples&&"NONE"!=e.b4w_antialiasing_quality,E.ssao=h.ssao&&e.b4w_enable_ssao,E.god_rays=h.god_rays&&e.b4w_enable_god_rays&&E.sun_exist,E.depth_tex=h.depth_tex_available,E.glow_over_blend=e.b4w_glow_settings.render_glow_over_blend,E.ssao_params=function(e){var t={},r=e.b4w_ssao_settings;return t.radius_increase=r.radius_increase,t.hemisphere=r.hemisphere,t.blur_depth=r.blur_depth,t.blur_discard_value=r.blur_discard_value,t.influence=r.influence,t.dist_factor=r.dist_factor,t.samples=r.samples,t}(e);var P=function(e){for(var t={refractions:!1},r=Xe(_),n=function(e,r){if(e)for(var _=e.nodes,a=0;a<_.length;a++){var o=_[a];"GROUP"==o.type&&o.node_group&&n(o.node_group.node_tree,r),"GROUP"==o.type&&"B4W_REFRACTION"==o.node_tree_name&&(t.refractions=!0),"BSDF_TRANSPARENT"==o.type&&(o.b4w_use_alpha?r.blend_mode="ALPHA_SORT":t.refractions=!0)}},a=0;a<r.length;a++){var o=r[a];o.is_refractive&&(t.refractions=!0),o.node_tree&&n(o.node_tree,o)}return t}();switch(E.materials_params=P,E.refractions=function(e,t){if(!h.refractions)return!1;switch(e.b4w_render_refractions){case"OFF":return!1;case"ON":return!0;case"AUTO":return t.refractions}}(e,P),E.shadow_params=function(e,t,r){if(!function(e,t,r){if(0==t.length)return!1;if(!h.shadows)return!1;switch(e.b4w_render_shadows){case"OFF":return!1;case"ON":return!0}var _=!1,n=!1,a=h.ssao&&e.b4w_enable_ssao;if(0==t.length&&!a)return!1;for(var o=0;o<r.length;o++){var i=r[o];if(i.b4w_shadow_cast&&(_=!0),i.b4w_shadow_receive&&(n=!0),(a||_)&&n)return!0}return!1}(e,t,r))return null;var _=e.b4w_shadow_settings,n={};_.csm_resolution>R.max_texture_size?(n.csm_resolution=R.max_texture_size,A.error("Shadow map texture has unsupported size. Changed to "+R.max_texture_size+".")):n.csm_resolution=_.csm_resolution,h.shadow_blur_samples=h.shadow_blur_samples?h.shadow_blur_samples:_.blur_samples,n.soft_shadows=_.soft_shadows;var a=d.get_shadow_lamps(t,h.ssao&&e.b4w_enable_ssao);n.self_shadow_polygon_offset=_.self_shadow_polygon_offset,n.self_shadow_normal_offset=_.self_shadow_normal_offset,n.enable_csm=_.b4w_enable_csm&&1==a.length,_.b4w_enable_csm&&_.csm_num>1&&a.length>1&&A.warn("Disabling Cascaded Shadow Maps because of multiple shadow casting lamps."),n.lamp_types=[],n.spot_sizes=[],n.clip_start=[],n.clip_end=[];for(var o=0;o<a.length;o++)n.lamp_types.push(a[o].light.type),n.spot_sizes.push(a[o].light.spot_size),n.clip_start.push(a[o].light.clip_start),n.clip_end.push(a[o].light.clip_end),"SPOT"!=n.lamp_types[o]&&"POINT"!=n.lamp_types[o]||!n.enable_csm||(A.warn("Generating shadows for SPOT or POINT light. Disabling Cascaded Shadow Maps"),n.enable_csm=!1);return n.enable_csm?(n.csm_num=_.csm_num,n.csm_first_cascade_border=_.csm_first_cascade_border,n.first_cascade_blur_radius=_.first_cascade_blur_radius,n.csm_last_cascade_border=_.csm_last_cascade_border,n.last_cascade_blur_radius=_.last_cascade_blur_radius,n.fade_last_cascade=_.fade_last_cascade,n.blend_between_cascades=_.blend_between_cascades):(n.csm_num=1,n.csm_first_cascade_border=_.csm_first_cascade_border,n.first_cascade_blur_radius=_.first_cascade_blur_radius,n.csm_last_cascade_border=_.csm_last_cascade_border,n.last_cascade_blur_radius=_.last_cascade_blur_radius,n.fade_last_cascade=!1,n.blend_between_cascades=!1),n}(e,r,_),E.water_params=function(e){for(var t=Xe(e),r=[],_=0;_<t.length;_++){var n=t[_];if(n.water_settings.is_water){for(var a={},o=0;o<e.length;o++)for(var i=e[o],s=i._object.materials,E=0;E<s.length;E++)s[E]==n&&(a.water_level=i.location[2]);a.fog_color_density=new Float32Array(4),a.fog_color_density.set(n.water_settings.fog_color),a.fog_color_density[3]=n.water_settings.fog_density,n.water_settings.is_dynamic?(a.dynamic=!0,a.waves_height=n.water_settings.waves_height,a.waves_length=n.water_settings.waves_length,a.dst_noise_scale0=n.water_settings.dst_noise_scale0,a.dst_noise_scale1=n.water_settings.dst_noise_scale1,a.dst_noise_freq0=n.water_settings.dst_noise_freq0,a.dst_noise_freq1=n.water_settings.dst_noise_freq1,a.dir_min_shore_fac=n.water_settings.dir_min_shore_fac,a.dir_freq=n.water_settings.dir_freq,a.dir_noise_scale=n.water_settings.dir_noise_scale,a.dir_noise_freq=n.water_settings.dir_noise_freq,a.dir_min_noise_fac=n.water_settings.dir_min_noise_fac,a.dst_min_fac=n.water_settings.dst_min_fac,a.waves_hor_fac=n.water_settings.waves_hor_fac):(a.dynamic=!1,a.waves_height=0,a.waves_length=0),a.caustics=n.water_settings.enable_caust,a.caustic_scale=n.water_settings.caust_scale,a.caustic_brightness=n.water_settings.caust_brightness,a.caustic_speed=new Float32Array([.3,.7]),a.shoremap_image=null;var c=n.texture_slots;for(o=0;o<c.length;o++){var l=c[o].texture;if(!0===l.b4w_shore_dist_map&&"FILE"==l.image.source){a.shoremap_image=l.image,a.shoremap_tex_size=l.image.size[0],a.max_shore_dist=l.b4w_max_shore_dist;var T=l.b4w_shore_boundings;a.shoremap_center=[(T[0]+T[1])/2,(T[2]+T[3])/2],a.shoremap_size=[T[0]-T[1],T[2]-T[3]]}}r.push(a)}}if(r.length>0){if(!(a=r[0]).dynamic)for(_=0;_<r.length;_++)r[_].dynamic&&(a=r[_]);return a}return null}(_),E.xray=function(e){for(var t=0;t<e.length;t++)for(var r=e[t]._object.materials,_=0;_<r.length;_++){var n=r[_];if(n.render_above_all&&"OPAQUE"!=n.blend_mode&&"CLIP"!=n.blend_mode&&"ALPHA_ANTIALIASING"!=n.blend_mode)return!0}return!1}(_),E.soft_particles=function(e){for(var t=0;t<e.length;t++)for(var r=e[t].particle_systems,_=0;_<r.length;_++)if(d.check_obj_soft_particles_accessibility(e[t]._object,r[_].settings))return!0;return!1}(_),E.shore_smoothing=function(e){if(!h.shore_smoothing)return!1;for(var t=Xe(e),r=0;r<t.length;r++){var _=t[r];if(_.water_settings.is_water&&_.water_settings.shore_smoothing)return!0}return!1}(_),E.dynamic_grass=function(e,t){if(!h.dynamic_grass)return!1;switch(e.b4w_render_dynamic_grass){case"OFF":return!1;case"ON":return!0}for(var r=!1,_=!1,n=0;n<t.length;n++){for(var a=t[n],o=a._object.materials,i=0;i<o.length;i++)o[i].terrain_settings.is_terrain&&(r=!0);var s=a.particle_systems;for(i=0;i<s.length;i++){var E=s[i].settings;"HAIR"==E.type&&E.b4w_dynamic_grass&&(_=!0)}if(r&&_)return!0}return!1}(e,_),E.color_picking=function(e,t){if(I.outlining_overview_mode)return!0;if(!h.enable_selectable)return!1;switch(e.b4w_enable_object_selection){case"OFF":return!1;case"ON":return!0;case"AUTO":for(var r=0;r<t.length;r++)if(t[r]._object.render.selectable)return!0;return!1}}(e,_),E.outline=function(e,t){if(I.outlining_overview_mode)return!0;if(!h.enable_outlining)return!1;switch(e.b4w_enable_outlining){case"OFF":return!1;case"ON":return!0;case"AUTO":for(var r=0;r<t.length;r++)if(t[r]._object.render.outlining)return!0;return!1}}(e,_),E.glow_materials=function(e,t){if(!h.glow_materials)return!1;switch(e.b4w_enable_glow_materials){case"OFF":return!1;case"ON":return!0;case"AUTO":for(var r=0;r<t.length;r++)for(var _=t[r]._object.materials,n=0;n<_.length;n++)if(l.check_material_glow_output(_[n]))return!0;return!1}}(e,_),E.lod_smooth_type=e.b4w_lod_smooth_type,E.lod_hyst_interval=e.b4w_lod_hyst_interval,h.reflection_quality?h.reflection_quality:e.b4w_reflection_quality){case"LOW":E.cubemap_refl_size=b.cube_reflect_low,E.plane_refl_size=b.plane_reflect_low;break;case"MEDIUM":E.cubemap_refl_size=b.cube_reflect_medium,E.plane_refl_size=b.plane_reflect_medium;break;case"HIGH":E.cubemap_refl_size=b.cube_reflect_high,E.plane_refl_size=b.plane_reflect_high;break;default:E.cubemap_refl_size=b.cube_reflect_low,E.plane_refl_size=b.plane_reflect_low}o.is_hidpi()?(A.log("%cENABLE HIDPI MODE","color: #00a"),E.aa_quality="AA_QUALITY_LOW",E.resolution_factor=1,h.msaa_samples=1):h.msaa_samples>1?(A.log("%cENABLE MSAA RENDERING: "+h.msaa_samples+"x","color: #00a"),E.resolution_factor=1):(E.aa_quality="AA_QUALITY_"+e.b4w_antialiasing_quality,E.resolution_factor=h.quality===a.P_ULTRA?1.33:1);var S=e._render_to_textures.sort(function(e,t){return t.source_size-e.source_size});E.graph=p.create_rendering_graph(E,T,u,S),E.queue=[],E.need_shadow_update=!1,E.need_grass_map_update=!1,E.need_outline=!1,E.wind=new Float32Array(3),D.push(e),F||(F=s.create()),s.append_node_attr(F,e);for(var m=0;m<t.length;m++)d.scene_data_set_active(t[m],!0,e);var O=o.get_container();o.resize(O.clientWidth,O.clientHeight,!0)},t.append_scene_vtex=function(e,t,r){for(var _=0;_<t.length;_++){var n=t[_]._render;n&&n.is_movie&&(n.vtex_data_id=r,e._render.video_textures.push(t[_]))}},t.get_graph=function(e){return e._render.graph},t.generate_auxiliary_batches=function(e,t){s.traverse(t,function(r,n){var a=n,o=null;switch(a.type){case v.POSTPROCESSING:o=_.create_postprocessing_batch(a.pp_effect);break;case v.SSAO:o=_.create_ssao_batch(a);break;case v.SSAO_BLUR:o=_.create_ssao_blur_batch(a);break;case v.DEPTH_PACK:o=_.create_depth_pack_batch();break;case v.GOD_RAYS:o=_.create_god_rays_batch(a.pack,a.water,a.steps_per_pass);break;case v.GOD_RAYS_COMBINE:o=_.create_god_rays_combine_batch();break;case v.MOTION_BLUR:o=_.create_motion_blur_batch(a.mb_decay_threshold);break;case v.COC:o=_.create_coc_batch(a.coc_type);break;case v.DOF:o=_.create_dof_batch(a);var i=a.camera.dof_power;if(a.dof_bokeh){i/=2;var s=p.get_inputs_by_type(t,a,v.POSTPROCESSING);p.set_texel_size_mult(s[0],i),p.set_texel_size_mult(s[1],i),s[0]=p.find_input(t,s[0],v.POSTPROCESSING),p.set_texel_size_mult(s[0],i)}else{var E=p.find_input(t,a,v.POSTPROCESSING),c=p.find_input(t,E,v.POSTPROCESSING);p.set_texel_size_mult(E,i),p.set_texel_size_mult(c,i)}break;case v.OUTLINE:o=_.create_outline_batch();var l=p.find_input(t,a,v.POSTPROCESSING),T=p.find_input(t,l,v.POSTPROCESSING),u=p.find_input(t,T,v.POSTPROCESSING),f=p.find_input(t,u,v.POSTPROCESSING);p.set_texel_size_mult(T,a.blur_texel_size_mult),p.set_texel_size_mult(l,a.blur_texel_size_mult),p.set_texel_size_mult(f,a.ext_texel_size_mult*a.outline_factor),p.set_texel_size_mult(u,a.ext_texel_size_mult*a.outline_factor);break;case v.GLOW_COMBINE:o=_.create_glow_combine_batch();break;case v.COMPOSITING:o=_.create_compositing_batch();break;case v.ANTIALIASING:o=_.create_antialiasing_batch(a);break;case v.SMAA_RESOLVE:case v.SMAA_EDGE_DETECTION:case v.SMAA_BLENDING_WEIGHT_CALCULATION:case v.SMAA_NEIGHBORHOOD_BLENDING:o=_.create_smaa_batch(a.type);break;case v.STEREO:o=_.create_stereo_batch(a.subtype);break;case v.SKY:o=_.create_cube_sky_batch(e,a);break;case v.IRRADIANCE:o=_.create_cube_irradiance_batch(e,a);break;case v.ROUGHNESS_CONVOLUTION:o=_.create_cube_roughness_convolution_batch(e,a);break;case v.BRDF:o=_.create_brdf_batch(e,a);break;case v.LUMINANCE:o=_.create_luminance_batch();break;case v.AVERAGE_LUMINANCE:o=_.create_average_luminance_batch();break;case v.LUMINANCE_TRUNCED:o=_.create_luminance_truncated_batch(a.adaptive_bloom);break;case v.BLOOM:o=_.create_bloom_combine_batch(a.bloom_blur_num);break;case v.RESIZE:o=_.create_postprocessing_batch("NONE");break;case v.VELOCITY:o=_.create_velocity_batch();break;case v.ANCHOR_VISIBILITY:o=_.create_anchor_visibility_batch();break;case v.PERFORMANCE:o=_.create_performance_batch()}if(o){var P=v.init_bundle(o,d.create_render("NONE"));v.append_draw_data(a,P),Me(t,a,o,!1),ve(o)}})},t.append_object=function(e,t,r){switch(t.type){case"MESH":case"LINE":case"WORLD":var _=e._render.graph,n=t.render;!p.find_subs(_,v.SHADOW_CAST)&&n.shadow_receive&&(n.shadow_receive=!1);for(var a=ze(e,Y),o=0;o<a.length;o++)Ae(a[o],t,_,e,r);break;case"LAMP":we(t,e)}for(var i=d.get_scene_data(t,e),s=i.batches,E=0;E<s.length;E++)null==s[E].shader&&"PHYSICS"!=s[E].type&&(d.scene_data_remove_batch(i,E),E--);d.scene_data_set_active(t,!0,e)},t.init_cube_sky_dim=function(e,t){if(e&&e._render&&e._render.graph){var r=e._render.graph,n=p.find_subs(e._render.graph,v.SKY);if(n){var a=null;if(p.traverse_slinks(r,function(e,t,r,_){if("CUBEMAP"==e.from&&r.type==v.SKY&&_.type==v.SINK)return a=e.texture,!0}),a){var o=b.cubemap_tex_size,i=_.get_batch_by_type(t,"SKY",e);if(i&&i.has_nodes){var s=l.get_ngraph_proxy_cached(i.ngraph_proxy_id),E=l.get_max_env_texture_height(s.graph);-1!=E&&(o=u.calc_pot_size(E/2))}else{var c=e._render.world_light_set.sky_texture_param;c&&(o=c.tex_size)}o=Math.min(o,R.max_cube_map_texture_size),n.camera.width=o,n.camera.height=o,N.set_cubemap_tex_size(a,o),Pe(e,o);var T=p.find_subs(e._render.graph,v.IRRADIANCE);if(T){T.camera.width=32,T.camera.height=32;var d=null;p.traverse_slinks(r,function(e,t,r,_){if("CUBEMAP"==e.from&&r.type==v.IRRADIANCE&&_.type==v.MAIN_OPAQUE)return d=e.texture,!0}),d&&N.set_cubemap_tex_size(d,32)}var f=p.find_subs(e._render.graph,v.ROUGHNESS_CONVOLUTION);if(f){f.camera.width=128,f.camera.height=128;var P=null;p.traverse_slinks(r,function(e,t,r,_){if("CUBEMAP"==e.from&&r.type==v.ROUGHNESS_CONVOLUTION&&_.type==v.MAIN_OPAQUE)return P=e.texture,!0}),P&&N.set_cubemap_tex_size(P,128)}}}}},t.update_cube_sky_dim=function(e,t){for(var r=e.scenes_data,_=0;_<r.length;_++){var n=r[_].scene,a=n._render.graph,o=p.find_subs(n._render.graph,v.SKY);if(o){var i=null;if(p.traverse_slinks(a,function(e,t,r,_){if("CUBEMAP"==e.from&&r.type==v.SKY&&_.type==v.IRRADIANCE)return i=e.texture,!0}),i){var s=u.calc_pot_size(t.height/2);s=Math.min(s,R.max_cube_map_texture_size),o.camera.width=s,o.camera.height=s,N.set_cubemap_tex_size(i,s),Pe(n,s)}}}},t.schedule_shadow_update=function(e){e._render.need_shadow_update=!0},t.update_shadow_billboard_view=function(e,t){s.traverse(t,function(t,r){var _=r;_.type===v.SHADOW_CAST&&(Ma(e.world_tsr,_.camera.world_tsr),Ma(e.view_tsr,_.camera.shadow_cast_billboard_view_tsr))})},t.update_shadow_receive_subs=Le,t.get_csm_borders=function(e,t){for(var r=e._render.shadow_params,_=new Float32Array(r.csm_num),a=0;a<r.csm_num;a++)_[a]=n.csm_far_plane(r,t,a);return _},t.connect_render_targets_batch=Me,t.change_visibility_rec=function e(t,r){xe(t,r);for(var _=0;_<t.cons_descends.length;_++)t.cons_descends[_].parent==t&&e(t.cons_descends[_],r)},t.change_visibility=xe,t.is_hidden=function(e){return e.render.hide},t.remove_object_bundles=function(e,t){for(var r=0;r<e.scenes_data.length;r++)for(var n=ze(e.scenes_data[r].scene,Y),a=0;a<n.length;a++)for(var o=n[a].draw_data,i=0;i<o.length;i++)for(var s=o[i].bundles,E=s.length-1;E>=0;E--){var c=s[E];c.obj_render==e.render&&(c.batch?"undefined"!=typeof t&&-1==c.batch.material_names.indexOf(t)&&0!=c.batch.material_names.length||(_.clear_batch(c.batch),s.splice(E,1)):s.splice(E,1))}},t.update_lamp_scene_color_intensity=function(e,t){for(var r=e.light,_=d.get_scene_data(e,t).light_index,n=ze(t,L),a=0;a<n.length;a++){var o=n[a];o.light_color_intensities.set(r.color_intensity,4*_),o.need_perm_uniforms_update=!0}},t.update_lamp_scene=we,t.update_sky_texture=function(e){for(var t=e.scenes_data,r=0;r<t.length;r++)Ce(t[r].scene)},t.update_world_texture=Ce,t.update_sky=Fe,t.cleanup=function(){for(var e=0;e<D.length;e++){var t=D[e];s.traverse(t._render.graph,function(e,t){t.type!=v.SINK&&ke(t)}),t._render.graph=null,t._render.queue=[]}U=null,C=null,D.length=0,F=null},t.make_frustum_shot=function(e,t,r){var a,o=n.extract_frustum_corners(e,e.near,e.far,null,!0),i=P.generate_frustum(o),s=d.create_render("DYNAMIC");s.bb_world=s.bb_local={max_x:1e12,min_x:-1e12,max_y:1e12,min_y:-1e12,max_z:1e12,min_z:-1e12},s.bs_world=s.bs_local=(a||(a=Yo()),Re(0,0,0,a.center),a.radius=1e12,a);var E=s.bs_world.radius;s.be_world=s.be_local=yo([E,0,0],[0,E,0],[0,0,E],s.bs_world.center);var c=_.create_shadeless_batch(i,r,.5);c.do_not_cull=!0;var l=v.init_bundle(c,s);v.append_draw_data(t,l)},t.get_scene_timeline=function(e){return[e.frame_start,e.frame_end]},t.setup_dim=function(e,t,r){o.setup_viewport_dim(e,t,r),C&&Qe(C,e,t)},t.subs_array=ze,t.get_subs=Ve,t.render_both_eyes=function(){je(!1)},t.render_one_eye=function(){je(!0)},t.get_environment_colors=function(e){var t=Ve(e,v.MAIN_OPAQUE),r=t.horizon_color,_=t.zenith_color,n=[],a=[];return n[0]=r[0],n[1]=r[1],n[2]=r[2],a[0]=_[0],a[1]=_[1],a[2]=_[2],[t.environment_energy,n,a]},t.set_environment_colors=function(e,t,r,_){for(var n=ze(e,L),a=0;a<n.length;a++){var o=n[a];o.horizon_color.set(r),o.zenith_color.set(_),o.environment_energy=t,o.need_perm_uniforms_update=!0}var i=p.find_subs(e._render.graph,v.SKY);i&&Fe(e,i)},t.get_sky_params=function(e){var t=Ve(e,v.SKY);if(t&&t.procedural_skydome){var r={};return r.color=new Array(3),he(t.sky_color,r.color),r.procedural_skydome=t.procedural_skydome,r.use_as_environment_lighting=t.use_as_environment_lighting,r.rayleigh_brightness=t.rayleigh_brightness,r.mie_brightness=t.mie_brightness,r.spot_brightness=t.spot_brightness,r.scatter_strength=t.scatter_strength,r.rayleigh_strength=t.rayleigh_strength,r.mie_strength=t.mie_strength,r.rayleigh_collection_power=t.rayleigh_collection_power,r.mie_collection_power=t.mie_collection_power,r.mie_distribution=t.mie_distribution,r}return null},t.get_fog_intensity=function(e){return ze(e,M)[0].fog_params[0]},t.get_fog_depth=function(e){return ze(e,M)[0].fog_params[1]},t.get_fog_start=function(e){return ze(e,M)[0].fog_params[2]},t.get_fog_height=function(e){return ze(e,M)[0].fog_params[3]},t.set_fog_intensity=function(e,t){for(var r=ze(e,M),_=0;_<r.length;_++){var n=r[_];n.fog_params[0]=t,n.need_perm_uniforms_update=!0}},t.set_fog_depth=function(e,t){for(var r=ze(e,M),_=0;_<r.length;_++){var n=r[_];n.fog_params[1]=t,n.need_perm_uniforms_update=!0}},t.set_fog_start=function(e,t){for(var r=ze(e,M),_=0;_<r.length;_++){var n=r[_];n.fog_params[2]=t,n.need_perm_uniforms_update=!0}},t.set_fog_height=function(e,t){for(var r=ze(e,M),_=0;_<r.length;_++){var n=r[_];n.fog_params[3]=t,n.need_perm_uniforms_update=!0}},t.get_fog_color_density=function(e,t){var r=t||[],_=ze(e,M)[0].fog_color_density;return r[0]=_[0],r[1]=_[1],r[2]=_[2],r[3]=_[3],r},t.set_fog_color_density=function(e,t){for(var r=ze(e,M),_=0;_<r.length;_++){var n=r[_];n.fog_color_density.set(t),n.need_perm_uniforms_update=!0}},t.get_ssao_params=function(e){var t=Ve(e,v.SSAO),r=Ve(e,v.SSAO_BLUR),_=Ve(e,v.MAIN_OPAQUE);if(!t)return null;var n={};return n.quality=t.ssao_samples,n.use_hemisphere=t.ssao_hemisphere,n.use_blur_depth=r.ssao_blur_depth,n.blur_discard_value=r.ssao_blur_discard_value,n.radius_increase=t.ssao_radius_increase,n.influence=t.ssao_influence,n.dist_factor=t.ssao_dist_factor,n.ssao_only=_.ssao_only,n.ssao_white=t.ssao_white,n},t.get_dof_params=function(e){var t=Ve(e,v.DOF);if(!t)return null;var r={};return r.dof_on=t.camera.dof_on,r.dof_bokeh=t.dof_bokeh,r.dof_distance=t.camera.dof_distance,r.dof_front_start=t.camera.dof_front_start,r.dof_front_end=t.camera.dof_front_end,r.dof_rear_start=t.camera.dof_rear_start,r.dof_rear_end=t.camera.dof_rear_end,r.dof_power=t.camera.dof_power,r.dof_bokeh_intensity=t.camera.dof_bokeh_intensity,r.dof_object=t.camera.dof_object,r},t.set_dof_params=qe,t.get_god_rays_params=function(e){var t=ze(e,[v.GOD_RAYS]),r=Ve(e,v.GOD_RAYS_COMBINE);if(!t||!r)return null;var n={};return n.god_rays_max_ray_length=t[0].max_ray_length,n.god_rays_intensity=r.god_rays_intensity,n.god_rays_steps=_.get_batch_directive(t[0].draw_data[0].bundles[0].batch,"STEPS_PER_PASS")[1],n},t.set_god_rays_params=function(e,t){var r=ze(e,[v.GOD_RAYS]),n=ze(e,[v.GOD_RAYS_COMBINE]);if(!r.length||!n.length)return A.error("God Rays are not enabled on the scene"),0;if("number"==typeof t.god_rays_intensity)for(var a=0;a<n.length;a++)n[a].god_rays_intensity=t.god_rays_intensity;if("number"==typeof t.god_rays_max_ray_length){var o=t.god_rays_max_ray_length;for(a=0;a<r.length;a++)r[a].max_ray_length=o,r[a].radial_blur_step=o/r[a].steps_per_pass/(a+1),r[a].need_perm_uniforms_update=!0}if("number"==typeof t.god_rays_steps){var i=O.glsl_value(t.god_rays_steps,1);for(o=r[0].max_ray_length,a=0;a<r.length;a++){r[a].steps_per_pass=i,r[a].radial_blur_step=o/i/(a+1),r[a].need_perm_uniforms_update=!0;var s=r[a].draw_data[0].bundles[0],E=s.batch;_.set_batch_directive(E,"STEPS_PER_PASS",i),_.update_shader(E),v.append_draw_data(r[a],s)}}for(a=0;a<n.length;a++)n.need_perm_uniforms_update=!0},t.get_bloom_params=function(e){var t=Ve(e,v.LUMINANCE_TRUNCED),r=Ve(e,v.BLOOM);if(!t||!r)return null;var _={};return _.key=t.bloom_key,_.edge_lum=t.bloom_edge_lum,_.blur=r.bloom_blur,_.adaptive=t.adaptive_bloom,_.average_luminance=t.average_luminance,_},t.set_bloom_params=Ze,t.get_glow_material_params=function(e){var t=Ve(e,v.GLOW_COMBINE);if(!t)return null;var r={};return r.small_glow_mask_coeff=t.small_glow_mask_coeff,r.large_glow_mask_coeff=t.large_glow_mask_coeff,r.small_glow_mask_width=t.small_glow_mask_width,r.large_glow_mask_width=t.large_glow_mask_width,r},t.set_glow_material_params=$e,t.get_wind_params=function(e){var t=ot(e),r=De(t);if(0==r)return null;var _=bn(Math.atan2(t[0],-t[1])),n={};return n.wind_dir=_,n.wind_strength=r,n},t.schedule_grass_map_update=function(e){e._render.need_grass_map_update=!0},t.get_water_surface_level=tt,t.get_water_mat_params=function(e,t){var r=e._render.water_params,_=Ve(e,v.MAIN_OPAQUE);if(_&&r){t.waves_height=r.waves_height,t.waves_length=r.waves_length,t.water_fog_density=_.water_fog_color_density[3];var n=t.water_fog_color=[];n[0]=_.water_fog_color_density[0],n[1]=_.water_fog_color_density[1],n[2]=_.water_fog_color_density[2]}},t.set_water_params=function(e,t){var r=e._render.water_params;if(!r)return A.error("set_water_params() - no water parameters on the scene"),null;"number"==typeof t.dst_noise_scale0&&(r.dst_noise_scale0=t.dst_noise_scale0),"number"==typeof t.dst_noise_scale1&&(r.dst_noise_scale1=t.dst_noise_scale1),"number"==typeof t.dst_noise_freq0&&(r.dst_noise_freq0=t.dst_noise_freq0),"number"==typeof t.dst_noise_freq1&&(r.dst_noise_freq1=t.dst_noise_freq1),"number"==typeof t.dir_min_shore_fac&&(r.dir_min_shore_fac=t.dir_min_shore_fac),"number"==typeof t.dir_freq&&(r.dir_freq=t.dir_freq),"number"==typeof t.dir_noise_scale&&(r.dir_noise_scale=t.dir_noise_scale),"number"==typeof t.dir_noise_freq&&(r.dir_noise_freq=t.dir_noise_freq),"number"==typeof t.dir_min_noise_fac&&(r.dir_min_noise_fac=t.dir_min_noise_fac),"number"==typeof t.dst_min_fac&&(r.dst_min_fac=t.dst_min_fac),"number"==typeof t.waves_hor_fac&&(r.waves_hor_fac=t.waves_hor_fac),"number"==typeof t.water_dynamic&&(r.dynamic=t.water_dynamic);for(var _=ze(e,y),n=0;n<_.length;n++){var a=_[n];"number"==typeof t.water_fog_density&&r.fog_color_density&&(a.water_fog_color_density[3]=t.water_fog_density),"object"==typeof t.water_fog_color&&r.fog_color_density&&a.water_fog_color_density.set(t.water_fog_color),a.need_perm_uniforms_update=!0}},t.get_shore_dist=function(e,t,r){var _=e._render.water_params;if(!_.shoremap_image)return 100;var n=_.water_level,a=(t[0]-_.shoremap_center[0])/_.shoremap_size[0],o=(_.shoremap_center[1]+t[1])/_.shoremap_size[1];if(o+=.5,!((a+=.5)>1||a<0||o>1||o<0)){var i=_.max_shore_dist*Bn(C._render.shore_distances,_.shoremap_tex_size,a,o),s=(n-t[2])*r;return Math.sqrt(i*i+s*s)}},t.update=function(e,t){S.clear();for(var r=ue()._camera.render,_=0;_<D.length;_++){var n=(m=D[_])._render.graph;if((O=m._render).water_params)var a=Fa(r.world_tsr),o=a[2]-tt(m,a[0],a[1]);for(var i=0;i<O.video_textures.length;i++){var c=O.video_textures[i]._render,l=c.video_file,T=c.seq_video;if((!m.b4w_use_nla||!c.use_nla)&&(l||T)&&N.video_is_played(c)){var u=N.video_get_current_frame(c),d=N.video_get_start_frame(c);l&&h.is_mobile_device&&(d-=5);var P=N.video_get_end_frame(c);if(u>=P&&c.use_cyclic||u<d)N.reset_video(c),T&&(c.seq_last_discrete_mark=N.seq_video_get_discrete_timemark(c,e));else if(u>=P&&!c.use_cyclic)N.pause_video(c);else if(N.video_update_is_available(c))if(l)N.update_video_texture(c);else{var A=N.seq_video_get_discrete_timemark(c,e);A!=c.seq_last_discrete_mark&&(N.update_seq_video_texture(c),c.seq_cur_frame++),c.seq_last_discrete_mark=A}}}s.traverse(n,function(t,r){var _=r;x.indexOf(_.type)>-1&&(_.time=e),O.water_params&&(_.cam_water_depth=o)})}for(_=0;_<D.length;_++){n=(O=(m=D[_])._render).graph;var m,O,g=O.queue;if(g.length){O.need_shadow_update&&(Ie(m),O.need_shadow_update=!1),O.need_grass_map_update&&(nt(m),O.need_grass_map_update=!1),O.need_outline&&(be(m),O.need_outline=!1),O.motion_blur&&at(n,t);var R=p.find_subs(n,v.OUTLINE_MASK);for(i=0;i<g.length;i++){var I=g[i];f.prerender_subs(I),R&&rt(0,I,R),S.draw(I)}}}h.show_hud_debug_info&&E.show_debug_info(D,t)},t.request_outline=function(e){e._render.need_outline=!0},t.get_all_subscenes=function(e){var t=[];return s.traverse(e._render.graph,function(e,r){t.push(r)}),t},t.get_cam_water_depth=function(){var e=Ve(C,v.MAIN_BLEND);return e||C._render.water_params?e.cam_water_depth:null},t.update_scene_permanent_uniforms=function(e){s.traverse(e._render.graph,function(e,t){t.need_perm_uniforms_update=!0})},t.set_debug_view_mode=function(e,t){e.debug_view_mode=t,e.do_render=t!=i.DV_NONE,e.blend=t==i.DV_TRANSPARENT_WIREFRAME,e.need_perm_uniforms_update=!0;for(var r=ue(),_=0;_<y.length;_++)for(var n=ze(r,[y[_]]),a=0;a<n.length;a++)n[a].do_not_debug=t==i.DV_RENDER_TIME},t.set_debug_colors_seed=function(e,t){e.debug_colors_seed=t,e.need_perm_uniforms_update=!0},t.set_render_time_threshold=function(e,t){e.debug_render_time_threshold=t,e.need_perm_uniforms_update=!0},t.set_wireframe_edge_color=function(e,t){for(var r=e.draw_data,_=0;_<r.length;_++)for(var n=r[_].bundles,a=0;a<n.length;a++){var o=n[a].batch;he(t,o.wireframe_edge_color),o.shader.need_uniforms_update=!0}},t.update_force_scene=function(e,t){var r=t.field,_=e._render.wind;if(r&&"WIND"==r.type&&_){var n=Ba(t.render.world_tsr);We(S_,n,_),Ke(_,_),ye(_,r.strength,_);for(var a=ze(e,x),o=0;o<a.length;o++)a[o].wind.set(_);return!0}return!1},t.pick_color=function(e,t,r){var _=Ve(e,v.COLOR_PICKING);if(_){var a=g.enabled&&(g.subs_type===v.COLOR_PICKING||g.subs_type===v.COLOR_PICKING_XRAY);if(a)var i=o.canvas_to_viewport_coords(t,r,q,_.camera);else{var s=o.get_canvas();n.set_color_pick_proj(_.camera,t,r,s.clientWidth,s.clientHeight)}f.prerender_subs(_),_.do_render&&S.draw(_);var E=Ve(e,v.COLOR_PICKING_XRAY);if(E){H(_.camera.proj_matrix,E.camera.proj_matrix),H(_.camera.view_proj_matrix,E.camera.view_proj_matrix),fn(E.camera.view_proj_matrix,E.camera.frustum_planes),f.prerender_subs(E),E.do_render&&S.draw(E);var c=E.camera}else c=_.camera;return _.do_render||E&&E.do_render?a?(i[1]=c.height-i[1],S.read_pixels(c.framebuffer,i[0],i[1],1,1,ce)):S.read_pixels(E?E.camera.framebuffer:_.camera.framebuffer,0,0,1,1,ce):null}return A.error("Object Selection is not available on the scene"),null},t.set_outline_color=function(e){for(var t=ze(ue(),[v.OUTLINE]),r=0;r<t.length;r++){var _=t[r];_.outline_color.set(e),_.need_perm_uniforms_update=!0}},t.get_wind=ot,t.get_meta_tags=function(e){var t={title:"",description:""};return e.b4w_tags&&(t.title=e.b4w_tags.title,t.description=e.b4w_tags.description),t},t.get_custom_prop=function(e){return e.b4w_custom_prop},t.update_cube_reflect_subs=function(e,t){var r=Z;Ge(t,r);for(var _=0;_<6;_++){var n=e.cube_view_matrices[_],a=e.cube_cam_frustums[_],o=e.camera;J(k_[_],r,n),W(o.proj_matrix,n,o.view_proj_matrix),fn(o.view_proj_matrix,a)}},t.update_plane_reflect_subs=function(e,t,r){!function(e,t,r,_){_||(_=new Float32Array(4)),We(r,t,_),_[3]=-Be(e,_)}(t,r,S_,e.camera.reflection_plane)},t.assign_scene_data_subs=function(e,t,r){var _=e._render.reflection_params;if(_&&t)for(var n=0;n<t.length;n++){var a=t[n],o=d.get_scene_data(a,e);if(-1!=a.render.plane_reflection_id){var i=_.plane_refl_subs,s=_.plane_refl_subs_blend,E=a.render.plane_reflection_id;s.length&&E<s.length?o.plane_refl_subs=s[E]:i.length&&E<i.length&&(o.plane_refl_subs=i[E])}else if(-1!=a.render.cube_reflection_id){var c=_.cube_refl_subs,l=_.cube_refl_subs_blend;E=a.render.cube_reflection_id,l.length?o.cube_refl_subs=l[E]:c.length&&(o.cube_refl_subs=c[E])}}if(r){var T=d.get_shadow_lamps(r,h.ssao&&e.b4w_enable_ssao),u=e._render.shadow_params;for(n=0;n<T.length;n++)if(o=d.get_scene_data(T[n],e),u)for(var f=ze(e,[v.SHADOW_CAST]),P=0;P<f.length;P++)n==f[P].shadow_lamp_index&&o.shadow_subscenes.push(f[P])}},t.marker_frame=function(e,t){return e.timeline_markers[t]},t.set_hmd_params=function(e){var t=Ve(ue(),v.STEREO);t&&(e.distortion_coefs&&(t.distortion_params[0]=e.distortion_coefs[0],t.distortion_params[1]=e.distortion_coefs[1],t.need_perm_uniforms_update=!0),e.chromatic_aberration_coefs&&(t.chromatic_aberration_coefs[0]=e.chromatic_aberration_coefs[0],t.chromatic_aberration_coefs[1]=e.chromatic_aberration_coefs[1],t.chromatic_aberration_coefs[2]=e.chromatic_aberration_coefs[2],t.chromatic_aberration_coefs[3]=e.chromatic_aberration_coefs[3],t.need_perm_uniforms_update=!0),e.base_line_factor&&(t.distortion_params[2]=e.base_line_factor,t.need_perm_uniforms_update=!0),e.inter_lens_factor&&(t.distortion_params[3]=e.inter_lens_factor,t.need_perm_uniforms_update=!0),null!=e.enable_hmd_stereo&&(t.enable_hmd_stereo=e.enable_hmd_stereo,t.need_perm_uniforms_update=!0))},t.multiply_size_mult=function(e,r){for(var _=de(),n=0;n<_.length;n++){var a=t.get_graph(_[n]);p.multiply_size_mult_by_graph(a,e,r)}},t.update_all_mesh_shaders=function(e){for(var t=T.get_scene_objs(e,"LAMP",T.DATA_ID_ALL),r=ze(e,Y),n=0;n<r.length;n++)for(var a=r[n],o=a.draw_data,i=0;i<o.length;i++)for(var s=o[i].bundles,E=0;E<s.length;E++){var c=s[E],l=c.batch;"MAIN"==l.type&&(_.update_batch_lights(l,t,e),_.update_shader(l),v.append_draw_data(a,c))}},t.recalculate_draw_data=function(e){for(var t=0;t<D.length;t++)s.traverse(D[t]._render.graph,function(t,r){for(var _=r,n=_.draw_data,a=0;a<n.length;a++)for(var o=n[a].bundles,i=0;i<o.length;i++){var s=o[i];s.batch==e&&v.append_draw_data(_,s)}})}}),ms=A("__constraints",function(e,t){var r=ha(e),_=Ns(e),n=oE(e),a=1,o=2,i=3,s=5,E=7,c=8,l=9,T=11,u=12,d=13,f=14,P=15,A=16,S=17,p=18;t.CONS_TYPE_STIFF_OBJ=a,t.CONS_TYPE_STIFF_BONE=o,t.CONS_TYPE_TRACK_OBJ=i,t.CONS_TYPE_FOLLOW_OBJ=s,t.CONS_TYPE_STIFF_TRANS_OBJ=E,t.CONS_TYPE_COPY_LOC_OBJ=c,t.CONS_TYPE_SEMI_STIFF_OBJ=u,t.CONS_TYPE_CHILD_OF=d,t.CONS_TYPE_CHILD_OF_BONE=f,t.CONS_TYPE_SEMI_SOFT_OBJ=P,t.CONS_TYPE_STIFF_TRANS_ROT_OBJ=A,t.CONS_TYPE_STIFF_VIEWPORT=S,t.BONE_CONS_TYPE_STIFF_OBJ=p;var m=new Float32Array(2),O=new Float32Array(2),v=new Float32Array(3),N=new Float32Array(3),g=new Float32Array(4),h=new Float32Array(4),R=ba(),I=new Float32Array(3);function b(e){return{type:e,obj_parent:null,target:null,use_offset:!1,tsr_restore:null,tsr_offset:null,euler_offset:null,axes:null,track_axis:null,vertical_axis:null,use_target_z:!1,influence:0,bone_name:"",softness:0,clamp_left:0,clamp_right:0,clamp_up:0,clamp_down:0,dist_min:0,dist_max:0,left_edge:!1,left_right_dist:0,top_edge:!1,top_bottom_dist:0,distance:0,hor_units:"",vert_units:""}}function Y(e,t){e.constraint&&e.constraint.obj_parent&&L(e.constraint.obj_parent,e),t.obj_parent&&function(e,t){-1==e.cons_descends.indexOf(t)?e.cons_descends.push(t):r.panic("Descendant object override is forbidden")}(t.obj_parent,e),e.constraint=t}function L(e,t){var _=e.cons_descends.indexOf(t);-1!=_?e.cons_descends.splice(_,1):r.panic("No descendant object")}function M(e,t,r,_,n,a){var o=b(i);o.obj_parent=t,o.track_axis=new Float32Array(r),o.vertical_axis=new Float32Array(_),o.use_target_z=n,o.tsr_restore=new Float32Array(e.render.world_tsr),o.influence=a,Y(e,o),G(e,o,0)}function x(e,t,r,_,n,a){var o=b(c);o.obj_parent=t,o.tsr_offset=ba(),wa(r,o.tsr_offset),o.axes=new Float32Array(_),o.influence=a,o.use_offset=n,o.tsr_restore=new Float32Array(e.render.world_tsr),Y(e,o),G(e,o,0)}function y(e,t,r,_,n){var a=b(l);a.obj_parent=t;var o=Xa(e.render.world_tsr,h);a.euler_offset=on(o,new Float32Array(3)),a.axes=new Float32Array(r),a.influence=n,a.use_offset=_,a.tsr_restore=new Float32Array(e.render.world_tsr),Y(e,a),G(e,a,0)}function w(e,t,r){var _=b(T);_.obj_parent=t,_.tsr_offset=ba(),Ma(e.render.world_tsr,_.tsr_offset),_.tsr_restore=new Float32Array(e.render.world_tsr),_.influence=r,Y(e,_),G(e,_,0)}function U(e,t,r){var _=b(d);_.obj_parent=t,_.tsr_offset=new Float32Array(r),Y(e,_),G(e,_,0)}function D(e,t,r,_){var n=b(f);n.obj_parent=t,n.bone_name=r,n.tsr_offset=new Float32Array(_),Y(e,n),G(e,n,0)}function F(e,t,r){var _=b(S);if(_.obj_parent=t,_.tsr_restore=new Float32Array(e.render.world_tsr),_.tsr_offset=ba(),z_(r.right)?(_.left_edge=!1,_.left_right_dist=r.right):z_(r.left)?(_.left_edge=!0,_.left_right_dist=r.left):(_.left_edge=!0,_.left_right_dist=0),z_(r.bottom)?(_.top_edge=!1,_.top_bottom_dist=r.bottom):z_(r.top)?(_.top_edge=!0,_.top_bottom_dist=r.top):(_.top_edge=!0,_.top_bottom_dist=0),_.distance=z_(r.distance)?r.distance:0,z_(r.rotation))var n=new Float32Array(r.rotation);else n=Yr();Da(n,_.tsr_offset),_.hor_units=z_(r.hor_units)?r.hor_units:"widths",_.vert_units=z_(r.vert_units)?r.vert_units:"heights",Y(e,_),G(e,_,0)}function G(e,t,r){switch(t.type){case a:Va(t.obj_parent.render.world_tsr,t.tsr_offset,e.render.world_tsr);break;case u:var _=Fa(e.render.world_tsr),p=Ba(e.render.world_tsr),b=Ga(t.tsr_offset,v),Y=t.obj_parent.render.world_tsr,L=Ba(t.obj_parent.render.world_tsr);Fr(Vr(t.parent_prev_rotation,t.parent_prev_rotation),p,p),Fr(L,p,p),ja(b,Y,_),nr(L,t.parent_prev_rotation),function(e,t){var r=Ba(e.render.world_tsr),_=Fr(Ba(t.obj_parent.render.world_tsr),Xa(t.tsr_offset,h),g),a=n.get_camera_angles_from_quat(_,e.render.vertical_axis,m),o=n.get_camera_angles_from_quat(r,e.render.vertical_axis,O),i=na(o[0],a[0]+t.clamp_right,a[0]+t.clamp_left),s=na(o[1],a[1]+t.clamp_down,a[1]+t.clamp_up);!function(e,t,r,_,n){if(r||_){var a=Cr(l_);r&&Fr(a,Dr(t,r,T_),a);var o=nr(e,n);if(_){var i=Dr(sn(o,P_,Jr),_,T_);mr(i,i),Fr(a,i,a)}Fr(a,o,o),mr(o,o)}}(r,e.render.vertical_axis,i,s,r)}(e,t);break;case P:_=Fa(e.render.world_tsr),p=Ba(e.render.world_tsr);var M=Fa(Y=t.obj_parent.render.world_tsr),x=t.softness,y=v,w=nr(p,g);ja(b=Ga(t.tsr_offset,N),Y,y),Dn(y,_,r,x,_),Sa(_,w,M,O_),Fn(w,p,r,.16*x,p);break;case o:p=Ba(e.render.world_tsr);var U=R,D=(b=Ga(t.tsr_offset,N),ka(t.tsr_offset)),F=Xa(t.tsr_offset,g);Ji(t.obj_parent,t.bone_name,!0,!1,U),Va(t.obj_parent.render.world_tsr,U,U),p[0]=U[4],p[1]=U[5],p[2]=U[6],p[3]=U[7],Fr(p,F,p),Ua(D*U[3],e.render.world_tsr),ja(b,U,_=Fa(e.render.world_tsr));break;case i:_=Fa(e.render.world_tsr),p=Ba(e.render.world_tsr);var G=Fa(t.obj_parent.render.world_tsr),k=t.influence;if(t.use_target_z)var K=Xa(t.obj_parent.render.world_tsr,g),B=We(S_,K,v);else B=S_;Sa(_,p,G,t.track_axis);var X=be(G,_,N);Ke(X,X),function(e,r,_,n){var a=We(t.vertical_axis,e,Zr),o=be(_,ye(n,Be(n,_),$r),$r),i=Cr(l_);Ke(o,o),Math.abs(Be(a,o))<.999999&&_a(a,o,i),mr(i,i),Fr(i,e,e)}(p,0,B,X),Xr(J=Xa(t.tsr_restore,g),p,k,p),wa(_,t.tsr_restore);break;case s:Sa(_=Fa(e.render.world_tsr),p=Ba(e.render.world_tsr),G=Fa(t.obj_parent.render.world_tsr),O_);var H=Ue(_,G);if(H>t.dist_max)var Q=H-t.dist_max;else Q=H<t.dist_min?H-t.dist_min:0;Q&&(be(G,_,v),Ke(v,v),ye(v,Q,v),Ie(_,v,_));break;case E:Y=t.obj_parent.render.world_tsr,_=Fa(e.render.world_tsr),ja(b=Ga(t.tsr_offset,v),Y,_),Da(Ba(e.render.world_tsr),t.tsr_restore);break;case c:M=Fa(t.obj_parent.render.world_tsr),_=Fa(e.render.world_tsr);var z=t.axes,V=Ga(t.tsr_offset,v);b=Re(0,0,0,N),t.use_offset&&Ie(b,V,b),k=t.influence,z[0]&&(_[0]=(1-k)*V[0]+k*(W_(z[0])*M[0]+b[0])),z[1]&&(_[1]=(1-k)*V[1]+k*(W_(z[1])*M[1]+b[1])),z[2]&&(_[2]=(1-k)*V[2]+k*(W_(z[2])*M[2]+b[2])),Da(Ba(e.render.world_tsr),t.tsr_restore);break;case l:z=t.axes;var j=function(e,t,r){var _=C(e,i_),n=Jr,a=Zr;return Oa(_,n,a),he(Math.abs(n[0]-t[0])+Math.abs(n[1]-t[1])+Math.abs(n[2]-t[2])>Math.abs(a[0]-t[0])+Math.abs(a[1]-t[1])+Math.abs(a[2]-t[2])?a:n,r),r}(L=Xa(t.obj_parent.render.world_tsr,g),t.euler_offset,N);pa(j,t.euler_offset),z[0]?(t.use_offset&&ma(j,Re(t.euler_offset[0],0,0,v),j),j[0]=W_(z[0])*j[0]):j[0]=t.euler_offset[0],z[1]?(t.use_offset&&ma(j,Re(0,t.euler_offset[1],0,v),j),j[1]=W_(z[1])*j[1]):j[1]=t.euler_offset[1],z[2]?(t.use_offset&&ma(j,Re(0,0,t.euler_offset[2],v),j),j[2]=W_(z[2])*j[2]):j[2]=t.euler_offset[2],pa(j,t.euler_offset),k=t.influence;var q=rn(j,g);Xr(ie=Xa(t.tsr_restore,h),q,k,Ba(e.render.world_tsr)),wa(Fa(e.render.world_tsr),t.tsr_restore);break;case T:k=t.influence,M=Ga(t.obj_parent.render.world_tsr,v),L=Xa(t.obj_parent.render.world_tsr,g);var W=Ga(t.tsr_offset,N),J=Xa(t.tsr_offset,h);cn(W,M,k,Fa(e.render.world_tsr)),Xr(J,L,k,Ba(e.render.world_tsr)),wa(Fa(e.render.world_tsr),t.tsr_restore);break;case A:p=Ba(e.render.world_tsr),Y=t.obj_parent.render.world_tsr,L=Ba(t.obj_parent.render.world_tsr),b=Ga(t.tsr_offset,N),Fr(L,F=Xa(t.tsr_offset,g),p),ja(b,Y,_=Fa(e.render.world_tsr));break;case d:Va(t.obj_parent.render.world_tsr,t.tsr_offset,e.render.world_tsr);break;case f:var Z=t.tsr_offset;Ji(t.obj_parent,t.bone_name,!0,!1,U=R),Va(t.obj_parent.render.world_tsr,U,U),Va(U,Z,e.render.world_tsr);break;case S:var $=t.obj_parent,ee=n.get_first_cam($),te=(_=Fa(e.render.world_tsr),n.get_edge(ee,"LEFT")),re=n.get_edge(ee,"RIGHT"),_e=n.get_edge(ee,"TOP"),ne=n.get_edge(ee,"BOTTOM");if("heights"==t.hor_units)var ae=_e-ne;else ae=re-te;if(_[0]=t.left_edge?te+ae*t.left_right_dist:re-ae*t.left_right_dist,"heights"==t.vert_units)var oe=_e-ne;else oe=re-te;_[1]=t.top_edge?_e-oe*t.top_bottom_dist:ne+oe*t.top_bottom_dist,n.is_ortho(ee)?_[2]=-t.distance:(_[2]=-1,Ke(_,_),ye(_,t.distance/Math.abs(_[2]),_)),Za(_,$.render.world_tsr,_),Ie(Fa($.render.world_tsr),_,_);var ie=Ba(e.render.world_tsr);Fr(Ba($.render.world_tsr),F=Xa(t.tsr_offset,h),ie)}if("CAMERA"==e.render.type&&e.render.move_style!=n.MS_STATIC){var se=e.render.vertical_axis;t.type==u&&(se=We(se,L=Ba(t.obj_parent.render.world_tsr),I)),n.correct_up(e,se)}}function k(e,t,r,_,n,a){var o=b(p);o.bone_name=r,o.target=t,o.tsr_offset=ba(),wa(new Float32Array(_),o.tsr_offset),Da(new Float32Array(n),o.tsr_offset),Ua(a,o.tsr_offset),function(e,t){var r=t.target,_=t.bone_name,n=e.render.bone_pointers[_];(function(e,t,_){for(var n=r.cons_armat_bone_descends,a=0;a<n;a++){var o=n[a];if(o[0]==t&&o[1]==_)return void n.splice(a,1)}})(0,e,_),r.cons_armat_bone_descends.push([e,_]),n.constraint=t}(e,o),K(e,o)}function K(e,t){switch(t.type){case p:var r=t.target.render.world_tsr,_=R;Ha(e.render.world_tsr,_),Va(_,r,_),Zi(e,t.bone_name,_,!1)}e.need_update_transform=!0}t.append_stiff_obj=function(e,t,r,_,n){var o=b(a);o.obj_parent=t,o.tsr_offset=ba(),_=_||Yr(),wa(r,o.tsr_offset),Ua(n,o.tsr_offset),Da(_,o.tsr_offset),o.tsr_restore=new Float32Array(e.render.world_tsr),Y(e,o),G(e,o,0)},t.append_stiff_bone=function(e,t,r,_,n,a){var i=b(o);i.obj_parent=t,i.bone_name=r,i.tsr_restore=new Float32Array(e.render.world_tsr),i.tsr_offset=ba(),wa(new Float32Array(_),i.tsr_offset),Da(new Float32Array(n),i.tsr_offset),Ua(a,i.tsr_offset),Y(e,i),G(e,i,0)},t.append_semi_stiff_obj=function(e,t,r,_,n,a,o,i){var s=b(u),E=Ba(e.render.world_tsr),c=Ba(t.render.world_tsr);_?(nr(_,E),Fr(c,E,E)):_=Yr(),s.obj_parent=t,s.tsr_offset=ba(),wa(r,s.tsr_offset),Da(_,s.tsr_offset),s.parent_prev_rotation=new Float32Array(c),s.clamp_left=Jn(n),s.clamp_right=Jn(a),s.clamp_up=Wn(o,-Math.PI,Math.PI),s.clamp_down=Wn(i,-Math.PI,Math.PI),s.tsr_restore=new Float32Array(e.render.world_tsr),Y(e,s),G(e,s,0)},t.append_semi_soft_obj=function(e,t,r,_){var n=b(P);n.obj_parent=t,n.softness=_,n.tsr_restore=new Float32Array(e.render.world_tsr),n.tsr_offset=ba(),wa(new Float32Array(r),n.tsr_offset),Y(e,n),G(e,n,0)},t.append_stiff_trans_rot_obj=function(e,t,r,_,n){var a=b(A);a.obj_parent=t,a.tsr_restore=new Float32Array(e.render.world_tsr),a.tsr_offset=ba(),wa(new Float32Array(r),a.tsr_offset),Da(new Float32Array(_),a.tsr_offset),Ua(n,a.tsr_offset),Y(e,a),G(e,a,0)},t.remove_parent_descendant=L,t.append_track_obj=M,t.append_follow_obj=function(e,t,r,_){var n=b(s);n.obj_parent=t,n.dist_min=r,n.dist_max=_,n.tsr_restore=new Float32Array(e.render.world_tsr),Y(e,n),G(e,n,0)},t.append_stiff_trans_obj=function(e,t,r){var _=b(E);_.obj_parent=t,_.tsr_offset=ba(),_.tsr_restore=new Float32Array(e.render.world_tsr),wa(new Float32Array(r),_.tsr_offset),Y(e,_),G(e,_,0)},t.append_copy_loc_obj=x,t.append_copy_rot_obj=y,t.append_copy_trans_obj=w,t.append_child_of=U,t.append_child_of_bone=D,t.append_stiff_viewport=F,t.update_constraint=function(e,t){e.constraint&&G(e,e.constraint,t)},t.update_bone_constraint=function(e,t){var r=e.render.bone_pointers[t];r.constraint&&K(e,r.constraint)},t.check_constraint=function(e){return!!e.constraint},t.remove=function(e,t){e.constraint.obj_parent&&L(e.constraint.obj_parent,e),t&&Ma(e.constraint.tsr_restore,e.render.world_tsr),e.constraint=null},t.get_type=function(e){return e.constraint?e.constraint.type:null},t.has_child_of=function(e){var t=e.constraint;return!(!t||t.type!=d&&t.type!=f)},t.get_child_of_parent_tsr=function(e){var t=e.constraint;if(t&&t.type==d)return t.obj_parent.render.world_tsr;if(t&&t.type==f){var r=R;return Ji(t.obj_parent,t.bone_name,!0,!1,r),Va(t.obj_parent.render.world_tsr,r,r),r}return null},t.get_child_of_offset=function(e){var t=e.constraint;return!t||t.type!=d&&t.type!=f?null:t.tsr_offset},t.prepare_object_relations=function(e,t){for(var r=t.render,n=0;n<e.constraints.length;n++){var a=e.constraints[n],o=a.type;if(a.target){var i=a.target._object;if("COPY_LOCATION"==o)x(t,i,new Float32Array(Fa(t.render.world_tsr)),new Float32Array(a.axes),a.use_offset,a.influence);else if("COPY_ROTATION"==o)y(t,i,new Float32Array(a.axes),a.use_offset,a.influence);else if("COPY_TRANSFORMS"==o)w(t,i,a.influence);else if("TRACK_TO"==o){var s=a.track_axis;if("TRACK_Y"==s)var E=A_;else"TRACK_NEGATIVE_Y"==s?E=m_:"TRACK_X"==s?E=P_:"TRACK_NEGATIVE_X"==s?E=p_:"TRACK_Z"==s?E=S_:"TRACK_NEGATIVE_Z"==s&&(E=O_);var c=a.up_axis;if("UP_X"==c)var l=P_;else"UP_Y"==c?l=A_:"UP_Z"==c&&(l=S_);M(t,i,E,l,a.use_target_z,a.influence)}}}if(t.parent){!t.parent_is_dupli&&t.physics_settings.use_collision_compound&&t.parent.physics_settings.use_collision_compound&&(t.use_obj_physics=!1);var T=!1;for(n=0;n<t.scenes_data.length;n++)if(t.scenes_data[n].scene._physics){T=!0;break}if(T&&_.has_dynamic_settings(t)){if(t.parent_is_dupli)var u=Ma(r.world_tsr,ba());else u=r.world_tsr;Va(t.parent.render.world_tsr,u,r.world_tsr)}else if(t.parent_is_dupli||!t.parent_bone)if(u=Ma(r.world_tsr,ba()),t.viewport_alignment&&"CAMERA"==t.parent.type){var d={distance:t.viewport_alignment.distance,rotation:Ba(u)};switch(t.viewport_alignment.alignment){case"TOP_LEFT":d.top=0,d.left=0;break;case"TOP":d.top=0,d.left=.5;break;case"TOP_RIGHT":d.top=0,d.right=0;break;case"LEFT":d.top=.5,d.left=0;break;case"CENTER":d.top=.5,d.left=.5;break;case"RIGHT":d.top=.5,d.right=0;break;case"BOTTOM_LEFT":d.bottom=0,d.left=0;break;case"BOTTOM":d.bottom=0,d.left=.5;break;case"BOTTOM_RIGHT":d.bottom=0,d.right=0}F(t,t.parent,d)}else U(t,t.parent,u);else u=Ma(r.world_tsr,ba()),D(t,t.parent,t.parent_bone,u)}if("ARMATURE"==t.type){var f=e.pose.bones;for(n=0;n<f.length;n++){var P=f[n],A=P.constraints;if(A)for(var S=0;S<A.length;S++){var p=A[S];"COPY_TRANSFORMS"!=p.type||p.subtarget||p.mute||k(t,i=p.target._object,P.name,u_,d_,1)}}}},t.check_compatibility=function(e,t){return function e(t,r){for(var _=0;_<t.length;_++){var n=t[_];if(!e(n.cons_descends,r)||n.name==r.name)return!1}return!0}(e.cons_descends,t)},t.check_self_applying=function(e,t){return e.name!=t.name}}),Os=A("__transform",function(e,t){var r=oE(e),_=ms(e),n=Ms(e),a=os(e),o=ps(e),i=Ss(e),s=new Float32Array(3),E=new Float32Array(3),c=new Float32Array(4),l=ba(),T=ba(),u=0,d=0;function f(e,t){_.has_child_of(e)?wa(t,_.get_child_of_offset(e)):wa(t,e.render.world_tsr)}function P(e,t){var r=e.render;if(_.has_child_of(e)){Da(t,r.world_tsr);var n=Ha(_.get_child_of_parent_tsr(e),l),a=_.get_child_of_offset(e);Va(n,r.world_tsr,a)}else Da(t,r.world_tsr)}function A(e,t){_.has_child_of(e)?Da(t,_.get_child_of_offset(e)):Da(t,e.render.world_tsr)}function S(e,t){return Xa(e.render.world_tsr,t),t}function p(e,t){return _.has_child_of(e)?Xa(_.get_child_of_offset(e),t):Xa(e.render.world_tsr,t),t}function m(e,t){_.has_child_of(e)?Ma(t,_.get_child_of_offset(e)):Ma(t,e.render.world_tsr)}function O(e,t){return _.has_child_of(e)?Ma(_.get_child_of_offset(e),t):Ma(e.render.world_tsr,t),t}t.update=function(e){u=e,d++},t.set_translation=function(e,t){var r=e.render;if(_.has_child_of(e)){wa(t,r.world_tsr);var n=Ha(_.get_child_of_parent_tsr(e),l),a=_.get_child_of_offset(e);Va(n,r.world_tsr,a)}else wa(t,r.world_tsr)},t.set_translation_rel=f,t.get_translation=function(e,t){return Ga(e.render.world_tsr,t),t},t.get_translation_rel=function(e,t){return _.has_child_of(e)?Ga(_.get_child_of_offset(e),t):Ga(e.render.world_tsr,t),t},t.set_rotation=P,t.set_rotation_rel=A,t.get_rotation=S,t.get_rotation_rel=p,t.set_rotation_euler=function(e,t){P(e,rn(t,c))},t.set_rotation_euler_rel=function(e,t){A(e,rn(t,c))},t.get_rotation_euler=function(e,t){return on(S(e,c),t)},t.get_rotation_euler_rel=function(e,t){return on(p(e,c),t)},t.set_scale=function(e,t){var r=e.render;if(_.has_child_of(e)){var n=_.get_child_of_offset(e);Ua(t/ka(_.get_child_of_parent_tsr(e)),n)}else Ua(t,r.world_tsr)},t.set_scale_rel=function(e,t){var r=e.render;_.has_child_of(e)?Ua(t,_.get_child_of_offset(e)):Ua(t,r.world_tsr)},t.get_scale=function(e){return ka(e.render.world_tsr)},t.get_scale_rel=function(e){return _.has_child_of(e)?ka(_.get_child_of_offset(e)):ka(e.render.world_tsr)},t.set_tsr=function(e,t){if(Ma(t,e.render.world_tsr),_.has_child_of(e)){var r=Ha(_.get_child_of_parent_tsr(e),l),n=_.get_child_of_offset(e);Va(r,e.render.world_tsr,n)}},t.set_tsr_rel=m,t.get_tsr=function(e,t){return Ma(e.render.world_tsr,t)},t.get_tsr_rel=O,t.get_object_size=function(e){var t=e.render,r=t.bb_original,_=ka(t.world_tsr),n=_*(r.max_x-r.min_x),a=_*(r.max_y-r.min_y),o=_*(r.max_z-r.min_z);return.5*Math.sqrt(n*n+a*a+o*o)},t.get_object_center=function(e,t,r){if(t)he((_=e.render).bs_world.center,r);else{var _,n=(_=e.render).bb_original;r[0]=(n.max_x+n.min_x)/2,r[1]=(n.max_y+n.min_y)/2,r[2]=(n.max_z+n.min_z)/2,ja(r,_.world_tsr,r)}return r},t.move_local=function(e,t,r,_){var n=O(e,l),a=s;a[0]=t,a[1]=r,a[2]=_,ja(a,n,a),f(e,a)},t.rotate_local=function(e,t){var r=O(e,l),_=Da(t,xa(T));Va(r,_,_),m(e,_)},t.update_transform=function e(t){var E=t.render,T=t.scenes_data,f=t.type;_.update_constraint(t,u),"CAMERA"==f&&r.update_camera(t),No(E.bb_local,E.world_tsr,E.bb_world),ho(E.bs_local,E.world_tsr,E.bs_world);for(var P=0;P<T.length;P++)for(var A=T[P].batches,S=0;S<A.length;S++)a.update_world_bounds_from_batch_tsr(A[S],E.world_tsr,T[P].batch_world_bounds[S]);switch(f){case"MESH":t.need_inv_zup_tsr&&Ha(t.render.world_tsr,t.render.world_tsr_inv),(M=t.armobj)&&(Ha(M.render.world_tsr,l),Va(l,E.world_tsr,l),Ka(l,E.arm_rel_trans),Xa(l,E.arm_rel_quat)),E.force_zsort=!0;break;case"CAMERA":for(P=0;P<T.length;P++)r.update_camera_transform(t,T[P]);break;case"SPEAKER":i.speaker_update_transform(t,u,d);break;case"LAMP":!function(e){var t=e.light;if(t){if(sn(Ba(e.render.world_tsr),S_,t.direction),Ke(t.direction,t.direction),"SUN"==t.type){var r=Math.acos(Be(t.prev_direction,f_)),_=Math.acos(Be(t.direction,f_)),n=Math.floor(r/.025),a=Math.floor(_/.025);t.need_sun_fog_update=n!=a}he(t.direction,t.prev_direction)}}(t)}var p=Ga(E.world_tsr,s),m=Xa(E.world_tsr,c);for(P=0;P<T.length;P++){var O=T[P];if(O.is_active){var v=O.scene,N=v._render;switch(A=O.batches,f){case"MESH":E.shadow_cast&&o.schedule_shadow_update(v);var g=O.cube_refl_subs;null!=E.cube_reflection_id&&g&&o.update_cube_reflect_subs(g,p);break;case"EMPTY":n.update_force(t);break;case"CAMERA":if(o.get_active()==v&&o.get_camera(v)==t){if(o.schedule_grass_map_update(v),N.shadow_params){(N.shadow_params.enable_csm||N.shadow_params.dynamic_grass_cast)&&o.schedule_shadow_update(v);var h=a.get_scene_data(t,v);o.update_shadow_billboard_view(h.cameras[0],N.graph)}i.listener_update_transform(v,p,m,u,d)}break;case"LAMP":o.update_lamp_scene(t,v)}var R=O.plane_refl_subs,I=t.reflective_objs;if(I.length)for(S=0;S<R.length;S++){var b=R[S].camera;o.update_plane_reflect_subs(R[S],p,m),a.update_refl_objects(I,b.reflection_plane),r.set_view(b,o.get_camera(v))}}}var Y=t.cons_descends;for(P=0;P<Y.length;P++)e(Y[P]);var L=t.cons_armat_bone_descends;for(P=0;P<L.length;P++){var M,x=L[P];_.update_bone_constraint(M=x[0],x[1])}},t.distance=function(e,t){return Ue(Ga(e.render.world_tsr,s),Ga(t.render.world_tsr,E))},t.obj_point_distance=function(e,t){return Ue(Ga(e.render.world_tsr,s),t)}}),vs=A("__navmesh",function(e,t){var r=wi(e),_=ve(),n=ve(),a=tr(),o=tr(),i=tr(),s=B(),E=B(),c=B(),l=ve(),T=ve(),u=ve(),d=ve(),f=ve();function P(e,t){return parseFloat(e.toFixed(t))}function A(e,t){if(e.indexOf)return e.indexOf(t);for(var r=0;r<e.length;r++)if(e[r]==t)return r;return-1}var S=function(e,t){function r(e){var t=e[0];e[0]=e[1],e[1]=e[2],e[2]=t}for(var _=e.vertex_ids,n=t.vertex_ids,a=[],o=0;o<_.length;o++)A(n,_[o])>=0&&a.push(_[o]);if(a.length<2)return[];for(A(a,_[0])>=0&&A(a,_[_.length-1])>=0&&r(_),A(a,n[0])>=0&&A(a,n[n.length-1])>=0&&r(n),a=[],o=0;o<_.length;o++)A(n,_[o])>=0&&a.push(_[o]);return a};function p(e,t){e.push(t[0]),e.push(t[1]),e.push(t[2])}function m(e,t,r,a){return W_(Be(a,Xe(be(t,e,_),be(r,e,n),_)))}function O(e,t){return be(e,t,_),Be(_,_)<1e-5}function v(e,t,r){var a=be(t.right,t.left,_),o=r.normal,i=t.normal,s=Math.acos(Be(o,i));s*=-W_(Be(a,Xe(o,i,n)));var E=Q(c);return J(E,t.left,E),$(E,s,a,E),J(E,ye(t.left,-1,n),E),W(e,E,e),e}function N(e,t,r,n,s,E,c){var l=je(r,E,a);l[3]=1;var T=be(je(n,E,_),l,o),u=Xe(s,be(t,e,_),i);if(Math.abs(Be(u,T))<.01)var d=.5;else Ke(u,u),u[3]=-Be(u,t),d=-Or(u,l)/Or(u,T);return we(r,be(n,r,_),d,c)}function g(e,t,r,_,n,a,o,i,E){for(var c=Q(s),l=n;l<r;l++)e[l].is_crucial&&(l>n||!l)&&(p(o,N(t,_,e[l].left,e[l].right,a,c,ve())),i&&p(E,e[l].normal),l&&v(c,e[l],e[l-1]))}function h(e,t,r,_,n){for(var a=null,o=Number.MAX_VALUE,i=0;i<e.length;i++){var s=e[i],E=n(r,s.centroid,s.vertex_ids,t,o);E<o&&(a=s,o=E)}return _>0&&o>_?null:a}function R(e,t){for(var r=0;r<e.neighbours.length;r++)if(e.neighbours[r]===t.id)return e.portals[r]}function I(e,t,r,_,n){e.push({left:t,right:r,is_crucial:_,normal:n})}t.navmesh_build_from_bufs_data=function(e){for(var t=r.get_vbo_source_by_type(e.vbo_source_data,r.VBO_FLOAT),a=e.ibo_array,o=[],i=0;i<a.length;i+=3)o.push({indices:new Uint32Array([a[i],a[i+1],a[i+2]]),centroid:new Float32Array(3),normal:new Float32Array(3)});var s,E=[];for(i=0;i<t.length;i+=3){var c=new Float32Array(3);c[0]=t[i],c[1]=t[i+1],c[2]=t[i+2],E.push(c)}return function(e){for(var t={},r=e.vertices,_=0;_<r.length;_++)r[_][0]=P(r[_][0],2),r[_][1]=P(r[_][1],2),r[_][2]=P(r[_][2],2);t.vertices=e.vertices;var n=function(e){for(var t=e.polygons,r=[],_=0,n=function(e){for(var t=e.neighbours,r=0;r<t.length;r++){var _=t[r];void 0==_.island&&(_.island=e.island,n(_))}},a=0;a<t.length;a++){var o=t[a];void 0==o.island&&(o.island=_++,n(o)),r[o.island]||(r[o.island]=[]),r[o.island].push(t[a])}return r}(e);t.islands=[];var a=function(e,t){for(var r=0;r<e.length;r++)if(t===e[r])return r};for(_=0;_<n.length;_++){for(var o=[],i=n[_],s=0;s<i.length;s++){for(var E=[],c=i[s],l=0;l<c.neighbours.length;l++)E.push(a(i,c.neighbours[l]));var T=[];for(l=0;l<c.neighbours.length;l++)T.push(S(c,c.neighbours[l]));c.centroid[0]=P(c.centroid[0],2),c.centroid[1]=P(c.centroid[1],2),c.centroid[2]=P(c.centroid[2],2),o.push({id:a(i,c),neighbours:E,vertex_ids:c.vertex_ids,centroid:c.centroid,normal:c.normal,portals:T,f:0,g:0,h:0,cost:1,visited:!1,closed:!1,parent:null})}t.islands.push(o)}return t}((function(e){var t,r;for(t=0;t<e.faces.length;t++)Ie(e.vertices[(r=e.faces[t]).indices[0]],e.vertices[r.indices[1]],_),Ie(_,e.vertices[r.indices[2]],_),ye(_,1/3,r.centroid)}(s={vertices:E,faces:o}),function(e){for(var t=0;t<e.faces.length;t++){var r=e.faces[t],a=Xe(be(e.vertices[r.indices[1]],e.vertices[r.indices[0]],_),be(e.vertices[r.indices[2]],e.vertices[r.indices[0]],n),_);Ke(a,a),he(a,r.normal)}}(s),function(e){var t,r,_,n,a,o,i={},s=[],E=[],c=Math.pow(10,4);for(_=0,n=e.vertices.length;_<n;_++)t=e.vertices[_],void 0===i[r=Math.round(t[0]*c)+"_"+Math.round(t[1]*c)+"_"+Math.round(t[2]*c)]?(i[r]=_,s.push(t),E[_]=s.length-1):E[_]=E[i[r]];var l=[];for(_=0,n=e.faces.length;_<n;_++){(a=e.faces[_]).indices[0]=E[a.indices[0]],a.indices[1]=E[a.indices[1]],a.indices[2]=E[a.indices[2]],o=[a.indices[0],a.indices[1],a.indices[2]];for(var T=0;T<3;T++)if(o[T]==o[(T+1)%3]){l.push(_);break}}for(_=l.length-1;_>=0;_--)e.faces.splice(l[_],1);for(e.vertices.length=0,_=0;_<s.length;_++)e.vertices.push(s[_])}(s),function(e){for(var t=[],r=e.vertices,_=0,n=0;n<e.faces.length;n++){var a=e.faces[n];t.push({id:_++,vertex_ids:a.indices,centroid:a.centroid,normal:a.normal,neighbours:[]})}var o,i,s={polygons:t,vertices:r},E={};for(n=0;n<t.length;n++)for(var c=0;c<3;c++)(u=(o=t[n].vertex_ids[c])>(i=t[n].vertex_ids[(c+1)%3])?i+"-"+o:o+"-"+i)in E||(E[u]=[]),E[u].push(t[n]);for(var l=Object.keys(E),T=(n=0,l.length);n<T;n++){var u=l[n];for(c=0;c<E[u].length;c++)for(var d=c+1;d<E[u].length;d++)E[u][c].neighbours.push(E[u][d]),E[u][d].neighbours.push(E[u][c])}return s}(s)))},t.navmesh_get_island=function(e,t,r){for(var n=null,a=Number.MAX_VALUE,o=e.islands,i=0;i<o.length;i++)for(var s=0;s<o[i].length;s++){var E=o[i][s];be(E.centroid,t,_);var c=r(t,E.centroid,E.vertex_ids,e.vertices,a);c<a&&(n=i,a=c)}return n},t.is_vector_in_poly=function(e,t,r){for(var _=[],n=0;n<t.length;n++)_.push(r[t[n]]);return!!function(e,t){for(var r=!1,_=-1,n=e.length,a=n-1;++_<n;a=_)(e[_][1]<=t[1]&&t[1]<e[a][1]||e[a][1]<=t[1]&&t[1]<e[_][1])&&t[0]<(e[a][0]-e[_][0])*(t[1]-e[_][1])/(e[a][1]-e[_][1])+e[_][0]&&(r=!r);return r}(_,e)},t.navmesh_find_path=function(e,t,r,n){var a=function(e,t,r,n){var a=e.islands[n.island],o=e.vertices,i=h(a,o,t,n.allowed_distance,n.distance_to_closest);if(!i)return null;var s=h(a,o,r,n.allowed_distance,n.distance_to_farthest);return s?function(e,t,r,n,a,o){function i(e,t){return be(e,t,_),Be(_,_)}function s(e,t){for(var r=[],_=0;_<t.neighbours.length;_++)r.push(e[t.neighbours[_]]);return r}!function(e){for(var t=0;t<e.length;t++){var r=e[t];r.f=0,r.g=0,r.h=0,r.cost=1,r.visited=!1,r.closed=!1,r.parent=null}}(e);var E,c,l,T={content:[],score_function:function(e){return e.f}};for(St(T,t);T.content.length>0;){var u=(c=(E=T).content[0],l=E.content.pop(),E.content.length>0&&(E.content[0]=l,Ot(E,0)),c);if(u===r){for(var d=u,f=[];d.parent;)f.push(d),d=d.parent;return f.push(t),f.reverse()}u.closed=!0;for(var P=s(e,u),A=0,S=P.length;A<S;A++){var p=P[A];if(!p.closed){var m=u.g+Ue(p.centroid,u.centroid),O=p.visited;(!O||m<p.g)&&(p.visited=!0,p.parent=u,p.h=p.h||i(p.centroid,a)+i(p.centroid,n),p.g=m,p.f=p.g+p.h,O?mt(T,p):St(T,p))}}}return[]}(a,i,s,t,r):null}(e,t,r,n);return a&&a.length?n.do_not_pull_string?function(e,t){if(n.return_normals){for(var r=new Float32Array(3*e.length),_=0;_<e.length;_++)r.set(e[_].centroid,3*_);return{positions:r,normals:null}}var a=new Float32Array(3*e.length),o=new Float32Array(3*e.length);for(_=0;_<e.length;_++)a.set(e[_].centroid,3*_),o.set(e[_].normal,3*_);return{positions:a,normals:o}}(a):function(e,t,r,_,n){var a=[];I(a,t,t,!1,e[0]&&e[0].normal||S_);for(var o=0;o<e.length;o++){var i=e[o],s=e[o+1];if(s){var c=Math.abs(Be(i.normal,s.normal))<.999,P=R(i,s);I(a,_[P[0]],_[P[1]],c,s.normal)}}return I(a,r,r,!1,a[a.length-1].normal),function(e,t){var r,_,n,a,o,i,s=[],c=[],P=0,A=0,S=0;r=e[0].right,n=e[0].right,a=he(_=e[0].left,l),o=he(n,T),i=he(e[0].normal,f),p(s,r),t&&p(c,e[0].normal);var N=Q(E);function h(t,s){A=P=s,S=P,_=r=t,n=r,he(t,a),he(t,o),he(e[P].normal,i)}for(var R=1;R<e.length;R++){var I=e[R].left,b=e[R].right,Y=je(I,N,u),L=je(b,N,d);if(e[R].is_crucial&&v(N,e[R],e[R-1]),m(r,o,L,i)<=0){if(!(O(r,n)||m(r,a,L,i)>0)){var M=O(a,r);M||g(e,a,A,r,P,i,s,t,c),N=Q(N),h(_,A),R=P,M||(p(s,r),t&&p(c,e[R].normal));continue}n=b,he(L,o),S=R}if(m(r,a,Y,i)>=0){if(!(O(r,_)||m(r,o,Y,i)<0)){var x=O(o,r);x||g(e,o,S,r,P,i,s,t,c),N=Q(N),h(n,S),R=P,x||(p(s,r),t&&p(c,e[R].normal));continue}_=I,he(Y,a),A=R}}var y=e.length-1,w=e[y].left,U=O(r,w);return U||g(e,a,y,r,P,i,s,t,c),U&&P||p(s,w),t?(p(c,e[y].normal),{positions:new Float32Array(s),normals:new Float32Array(c)}):{positions:new Float32Array(s),normals:null}}(a,n)}(a,t,r,e.vertices,n.return_normals):null}}),Ns=A("__physics",function(e,t){var r=ha(e),_=Wo(e),n=ss(e),a=Ts(e),o=os(e),i=ga(e),s=ps(e),E=ai(e),c=Os(e),l=vs(e),T=Ks(e),u=_.physics,d=_.defaults,f=_.assets,P=0,A=[],S=[],p={},m=[],O=["ANY"],v={body:0,constraint:0,ray_test:0},N=new Float32Array(3),g=new Float32Array(3),h=new Float32Array(4),R=ba(),I=ba(),b=10,Y=20;function L(e,t){for(var r=e.cons_descends,_=0;_<r.length;_++)r[_].physics_settings.use_collision_compound&&t.push(r[_]),L(r[_],t);return null}function M(e,t,r){for(var _=e._physics.bundles,n=0;n<_.length;n++)for(var a=_[n].physics,o=0;o<a.collision_tests.length;o++){var i=a.collision_tests[o];"ANY"!=i.collision_id&&r!=i.collision_id||ce(i,e,t)}}function x(e,t){for(var r=e._physics.bundles,_=0;_<r.length;_++){var n=r[_].batch;if(n&&n.id==t.id)return!0}return!1}function y(e,t,r){if(a.is_active(e))switch(t){case a.IN_LOADED:w(e)._physics.worker_loaded=!0;var _=Date.now()-performance.now();a.post_msg(e,a.OUT_INIT,_,u.max_fps,u.calc_fps?d.fps_measurement_interval:0);break;case a.IN_LOG:i.log_raw("URANIUM:",r.slice(1));break;case a.IN_ERROR:i.error(r);break;case a.IN_FBMSG:n.fbmsg.apply(this,r.slice(1));break;case a.IN_TRANSFORM:(E=C(r.body_id))&&function(e,t,_,n,a,o){var i=e.physics;i.curr_time=r.time,ya(_,ka(e.render.world_tsr),n,i.curr_tsr),he(a,i.linvel),he(o,i.angvel)}(E,0,r.trans,r.quat,r.linvel,r.angvel);break;case a.IN_PROP_OFFSET:var o=C(r.chassis_hull_body_id);o&&function(e,t,_,n){ya(r.trans,1,r.quat,e.vehicle.prop_offsets[r.prop_ind])}(o);break;case a.IN_FLOATER_BOB_TRANSFORM:var s=C(r[1]);s&&function(e,t,_,n){var a=e.floater.bobs[r[2]];c.set_translation(a,r[3]),c.set_rotation(a,n),c.update_transform(a)}(s,0,0,r[4]);break;case a.IN_VEHICLE_SPEED:(E=C(r[1]))&&(E.vehicle.speed=r[2]);break;case a.IN_COLLISION:D(w(e),r.body_id_a,r.body_id_b,r.result,null,null,0);break;case a.IN_COLLISION_POS_NORM:D(w(e),r.body_id_a,r.body_id_b,r.result,r.coll_point,r.coll_norm,r.coll_dist);break;case a.IN_COLLISION_IMPULSE:var E;if(E=C(r[1])){var l=E.physics;l.col_imp_test_cb&&l.col_imp_test_cb(r[2])}break;case a.IN_RAY_HIT:case a.IN_RAY_HIT_POS_NORM:var T=w(e)._physics.ray_tests[r.id];if(T){var f=C(r.body_id_hit);t==a.IN_RAY_HIT?G(T,r.hit_fract,f,r.hit_time,null,null):G(T,r.hit_fract,f,r.hit_time,r.hit_pos,r.hit_norm)}break;case a.IN_REMOVE_RAY_TEST:fe(r.id);break;case a.IN_PING:var S=A.indexOf(e),p=(r[2]-r[1]).toFixed(3),m=(performance.now()-r[2]).toFixed(3),O=(performance.now()-r[1]).toFixed(3);i.log("Physics #"+S+" Ping: OUT "+p+" ms, IN "+m+" ms, ALL "+O+" ms");break;case a.IN_FPS:P=r[1];break;case a.IN_DEBUG_STATS:S=A.indexOf(e),i.log("Worker: #"+String(S)),i.log(r[1]);break;default:i.error("Wrong message: "+t)}}function w(e){for(var t=0;t<A.length;t++)if(A[t]==e)return S[t]}function U(e){for(var t=0;t<S.length;t++)if(S[t]==e)return A[t]}function C(e){return p[e]||null}function D(e,t,r,_,n,a,o){for(var i=e._physics.bundles,s=0;s<i.length;s++)for(var E=i[s].physics,c=0;c<E.collision_tests.length;c++){for(var l=E.collision_tests[c],T=l.pairs,u=!1,d=0;d<T.length;d++){var f=T[d];if(f[0]===t&&f[1]===r){l.pair_results[d]=_,u=!0;break}}if(u){var P=F(l);if(n&&l.body_id_src!=t&&((S=n)[0]=S[0]+(p=a)[0]*(m=o),S[1]=S[1]+p[1]*m,S[2]=S[2]+p[2]*m,p[0]*=-1,p[1]*=-1,p[2]*=-1),P)A=C(l.body_id_src==t?r:t);else var A=null;l.callback(P,A,n,a,o)}}var S,p,m}function F(e){for(var t=e.pair_results,r=!1,_=0;_<t.length;_++)r=r||t[_];return r}function G(e,t,r,_,n,a){var o=e.callback;n?o(e.id,t,r,_,n,a):o(e.id,t,r,_)}function k(e,t,r){e&&a.is_fallback(e)&&a.post_msg(e,a.OUT_UPDATE_WORLD,t,r);for(var _=0;_<m.length;_++){var n=m[_],o=n.physics;if(o.simulated&&o.curr_time){if(a.is_fallback(e))var i=t-o.curr_time;else i=performance.now()/1e3-o.curr_time;i=Math.min(i,10/u.max_fps),i-=1/u.max_fps,d.no_phy_interp_hack&&(i=0);var s=R;_o(o.curr_tsr,i,o.linvel,o.angvel,R),c.set_tsr(n,s),c.update_transform(n),se(n),n.vehicle&&K(n),n.vehicle&&n.vehicle.steering_wheel&&pe(n),n.vehicle&&n.vehicle.speedometer&&me(n),n.vehicle&&n.vehicle.tachometer&&Oe(n)}}a.post_msg_arr(e)}function K(e){for(var t=e.vehicle.props,r=e.render.world_tsr,_=R,n=0;n<t.length;n++){var a=t[n];Va(r,e.vehicle.prop_offsets[n],_),c.set_tsr(a,_),c.update_transform(a)}}function B(){return v.body++,v.body}function X(e,t,r){var _=t._render.water_params;if(a.post_msg(r,a.OUT_APPEND_WATER,_.water_level),e.water_dynamics){var n={};n.dst_noise_scale0=e.dst_noise_scale0,n.dst_noise_scale1=e.dst_noise_scale1,n.dst_noise_freq0=e.dst_noise_freq0,n.dst_noise_freq1=e.dst_noise_freq1,n.dir_min_shore_fac=e.dir_min_shore_fac,n.dir_freq=e.dir_freq,n.dir_noise_scale=e.dir_noise_scale,n.dir_noise_freq=e.dir_noise_freq,n.dir_min_noise_fac=e.dir_min_noise_fac,n.dst_min_fac=e.dst_min_fac,n.waves_hor_fac=e.waves_hor_fac;var o=_.waves_height,i=_.waves_length;_.shoremap_image?a.post_msg(r,a.OUT_ADD_WATER_WRAPPER,n,_.shoremap_size[0],_.shoremap_size[1],_.shoremap_center[0],_.shoremap_center[1],_.max_shore_dist,o,i,_.shoremap_tex_size,t._render.shore_distances):a.post_msg(r,a.OUT_ADD_WATER_WRAPPER,n,0,0,0,0,0,o,i,0,null)}}function H(e,t,r){if(r)var _=e.physics.body_id;else _=B();var n=t.submesh;return{body_id:_,submesh:n,positions:n.va_frames[0].a_position,indices:n.indices||null,trans:Fa(e.render.world_tsr),friction:t.friction,restitution:t.elasticity,collision_id:t.collision_id,collision_id_num:V(t.collision_id),collision_margin:t.collision_margin,collision_group:t.collision_group,collision_mask:t.collision_mask}}function Q(e,t,r){var _=H(e,t);a.post_msg(r,a.OUT_APPEND_STATIC_MESH_BODY,_.body_id,_.positions,_.indices,_.trans,_.friction,_.restitution,_.collision_id_num,_.collision_margin,_.collision_group,_.collision_mask);var n=j(_.body_id,"STATIC_MESH");return n.collision_id=_.collision_id,n.collision_id_num=_.collision_id_num,n}function z(e,t,r){var _=H(e,t,!0);a.post_msg(r,a.OUT_UPDATE_STATIC_MESH_BODY,_.body_id,_.positions,_.indices,_.trans,_.friction,_.restitution,_.collision_id_num,_.collision_margin,_.collision_group,_.collision_mask)}function V(e){var t=O.indexOf(e);return-1==t?(O.push(e),O.length-1):t}function j(e,t){return{body_id:e,type:t,mass:0,is_ghost:!1,simulated:!0,is_vehicle:!1,is_character:!1,is_floater:!1,cons_id:null,collision_id:"",collision_id_num:0,collision_callbacks:{},collision_tests:[],col_imp_test_cb:null,curr_time:0,curr_tsr:new Float32Array([0,0,0,1,0,0,0,1]),linvel:new Float32Array(3),angvel:new Float32Array(3),cached_trans:new Float32Array(3),cached_quat:new Float32Array(4),navmesh:null}}function q(e,t,r){var _=B(),n=t.submesh,o=n.va_frames[0].a_position,i=n.indices||null,s=t.collision_id,E=V(s),c=t.collision_margin,l=t.collision_group,T=t.collision_mask,u=Fa(e.render.world_tsr);a.post_msg(r,a.OUT_APPEND_GHOST_MESH_BODY,_,o,i,u,E,c,l,T);var d=j(_,"STATIC_MESH");return d.is_ghost=!0,d.collision_id=s,d.collision_id_num=E,d}function W(e,t,r){var _=e.render,n=e.physics_settings,a=n.physics_type;if(r)var o=function(e){for(var t in p)if(p[t]===e)return t;return-1}(e);else o=B();if(!(o<=0)){if("CAMERA"==e.type)var i=J(c=n.use_collision_bounds?n.collision_bounds_type:"BOX",_),s=.5,E=0;else if("EMPTY"==e.type){var c="EMPTY";i=null,s=0,E=0}else{i=J(c=n.use_collision_bounds?n.collision_bounds_type:"BOX",_);var l=ka(_.world_tsr);1!=l&&function(e,t,r){switch(t){case"BOX":e.min_x*=r,e.max_x*=r,e.min_y*=r,e.max_y*=r,e.min_z*=r,e.max_z*=r;break;case"CYLINDER":case"CONE":case"CAPSULE":e.height*=r,e.radius*=r;break;case"SPHERE":e.radius*=r}}(i,c,l),s=_.friction,E=_.elasticity}var T=Z(i);return{body_id:o,trans:Fa(_.world_tsr),quat:Ba(_.world_tsr),is_ghost:n.use_ghost,disable_sleeping:n.use_sleep,mass:n.mass,velocity_min:n.velocity_min,velocity_max:n.velocity_max,damping:n.damping,rotation_damping:n.rotation_damping,collision_id:e.collision_id,collision_id_num:V(e.collision_id),collision_margin:n.collision_margin,collision_group:n.collision_group,collision_mask:n.collision_mask,size:_.bs_local.radius,worker_bounding:T,correct_bound_offset:e.correct_bounding_offset,restitution:E,friction:s,bounding_type:c,physics_type:a,comp_children_params:function(e,t,r,_){if(!t.length)return[];var n=[],a={};a.quat=new Float32Array([0,0,0,1]),a.trans=new Float32Array(3),a.worker_bounding=_,a.bounding_type=r,n.push(a);var o=Ha(e.world_tsr,R),i=h;Vr(Ba(e.world_tsr),i);for(var s=0;s<t.length;s++){var E={},c=t[s],l=c.physics_settings.collision_bounds_type,T=new Float32Array(4),u=new Float32Array(3),d=Fa(c.render.world_tsr),f=Ba(c.render.world_tsr);ja(d,o,u),Fr(i,f,T),E.trans=u,E.quat=T,E.bounding_type=l,E.worker_bounding=Z(J(l,c.render)),n.push(E)}return n}(_,t,c,T)}}}function J(e,t){switch(e){case"BOX":var r=t.bb_local;break;case"CYLINDER":r=t.bcyl_local;break;case"CONE":r=t.bcon_local;break;case"SPHERE":r=t.bs_local;break;case"CAPSULE":r=t.bcap_local}return r}function Z(e){if(!e)return null;var t=e,r={};return"number"==typeof t.min_x&&(r.min_x=t.min_x),"number"==typeof t.min_y&&(r.min_y=t.min_y),"number"==typeof t.min_z&&(r.min_z=t.min_z),"number"==typeof t.max_x&&(r.max_x=t.max_x),"number"==typeof t.max_y&&(r.max_y=t.max_y),"number"==typeof t.max_z&&(r.max_z=t.max_z),"object"==typeof t.center&&(r.center=t.center),"number"==typeof t.radius&&(r.radius=t.radius),"number"==typeof t.height&&(r.height=t.height),r}function $(e,t,r,_,n){var o=Fa(e.render.world_tsr),i=Ha(t.render.world_tsr,R),s=new Float32Array(3);switch(ja(o,i,s),t.vehicle.type){case b:var E=t.vehicle_settings,c=e.render.bb_local;a.post_msg(n,a.OUT_ADD_CAR_WHEEL,r,s,E.suspension_rest_length,E.roll_influence,(c.max_z-c.min_z)/2,_);break;case Y:a.post_msg(n,a.OUT_ADD_BOAT_BOB,r,s,e.bob_synchronize_pos)}}function ee(e){return Boolean(e._physics)}function te(e){if(!re(e))for(var t=0;t<e.physics_constraints.length;t++){var r=e.physics_constraints[t],_=r.target,n=r.pivot_type;if(_.physics){var a=_e(r),o=ne(r);"HINGE"==n&&kr(o,Math.PI/2,o);var i=xa(R);i=Da(o,i=wa(a,i));var s=Va(e.render.world_tsr,i,R),E=Ha(_.render.world_tsr,I),c=Va(E,s,E);oe(n,e,a,o,_,Fa(c),Ba(c),ae(r),null,null)}}}function re(e){return e.physics&&e.physics.cons_id}function _e(e){return new Float32Array([e.pivot_x,e.pivot_y,e.pivot_z])}function ne(e){return rn(new Float32Array([e.axis_x,e.axis_y,e.axis_z]),new Float32Array(4))}function ae(e){var t={};return t.use_limit_x=e.use_limit_x,t.use_limit_y=e.use_limit_y,t.use_limit_z=e.use_limit_z,t.use_angular_limit_x=e.use_angular_limit_x,t.use_angular_limit_y=e.use_angular_limit_y,t.use_angular_limit_z=e.use_angular_limit_z,t.limit_max_x=e.limit_max_x,t.limit_min_x=e.limit_min_x,t.limit_max_y=e.limit_max_y,t.limit_min_y=e.limit_min_y,t.limit_max_z=e.limit_max_z,t.limit_min_z=e.limit_min_z,t.limit_angle_max_x=e.limit_angle_max_x,t.limit_angle_min_x=e.limit_angle_min_x,t.limit_angle_max_y=e.limit_angle_max_y,t.limit_angle_min_y=e.limit_angle_min_y,t.limit_angle_max_z=e.limit_angle_max_z,t.limit_angle_min_z=e.limit_angle_min_z,t}function oe(e,t,r,_,n,o,i,s,E,c){var l=(v.constraint++,v.constraint.toString(16)),T=t.physics.body_id,u=n.physics.body_id,d=ie(T);a.post_msg(d,a.OUT_APPEND_CONSTRAINT,l,e,s,T,r,_,u,o,i,E,c),t.physics.cons_id=l}function ie(e){for(var t=0;t<S.length;t++)for(var r=S[t]._physics.bundles,_=0;_<r.length;_++)if(r[_].physics.body_id==e)return A[t];return null}function se(e){if(function(e){var t=e.physics;return!!t&&(0===t.mass||!0===t.is_ghost||!1===t.simulated||"RIGID_BODY"!==t.type&&"DYNAMIC"!==t.type)}(e)&&function(e){var t=Ga(e.render.world_tsr,N),r=Xa(e.render.world_tsr,h);return t[0]!=e.physics.cached_trans[0]||t[1]!=e.physics.cached_trans[1]||t[2]!=e.physics.cached_trans[2]||r[0]!=e.physics.cached_quat[0]||r[1]!=e.physics.cached_quat[1]||r[2]!=e.physics.cached_quat[2]||r[3]!=e.physics.cached_quat[3]}(e)){var t=e.physics,r=e.render,_=a.get_msg_cache(a.OUT_SET_TRANSFORM);_.body_id=t.body_id;var n=Ga(r.world_tsr,_.trans),o=Xa(r.world_tsr,_.quat);he(n,t.cached_trans),nr(o,t.cached_quat),"DYNAMIC"==t.type&&Cr(_.quat);var i=ie(t.body_id);a.post_msg(i,a.OUT_SET_TRANSFORM)}for(var s=e.cons_descends,E=0;E<s.length;E++)se(s[E])}function Ee(e,t,r,_,n){var a=n||new Float32Array(3),o=Ba(e.render.world_tsr);return a[0]=t,a[1]=r,a[2]=_,We(a,o,a)}function ce(e,t,_){var n=e.pairs,o=e.pair_results,i=e.body_id_src,s=[];!function(e,t,_,n){_||r.panic("At least one destination required");for(var a=0;a<t._physics.bundles.length;a++){var o=t._physics.bundles[a];if("ANY"==e||o.physics.collision_id==e&&"NAVMESH"!=o.physics.type){var i=o.physics.body_id;_&&-1==_.indexOf(i)&&_.push(i)}}}(e.collision_id,t,s);for(var E=0;E<s.length;E++){var c=s[E];i<c&&!le(n,i,c)?(n.push([i,c]),o.push(!1)):i>c&&!le(n,c,i)&&(n.push([c,i]),o.push(!1))}a.post_msg(_,a.OUT_ACTIVATE,i),a.post_msg(_,a.OUT_APPEND_COLLISION_TEST,n,e.calc_pos_norm)}function le(e,t,r){for(var _=0;_<e.length;_++)if(e[_][0]==t&&e[_][1]==r)return!0;return!1}function Te(e,t,r){for(var _=e._physics.bundles,n=r,o=0;o<_.length;o++)for(var i=_[o].physics,s=0;s<i.collision_tests.length;s++)for(var E=i.collision_tests[s],c=0;c<E.pairs.length;c++)for(var l=E.pairs[c],T=0;T<n.length;T++){var u=n[T];l[0]==u[0]&&l[1]==u[1]&&(n.splice(T,1),T--)}n.length&&a.post_msg(t,a.OUT_REMOVE_COLLISION_TEST,n)}function ue(e){if(de(e)){var t=e.physics,r=ie(t.body_id);a.post_msg(r,a.OUT_CLEAR_COLLISION_IMPULSE_TEST,t.body_id),t.col_imp_test_cb=null}}function de(e){return!(!e.physics||!e.physics.col_imp_test_cb)}function fe(e){var t=Pe(e),r=Ae(e),_=t._physics;_.ray_tests[e]&&(delete _.ray_tests[e],_.ray_tests_arr.splice(_.ray_tests_arr.indexOf,1),a.post_msg(r,a.OUT_REMOVE_RAY_TEST,e))}function Pe(e){for(var t=0;t<S.length;t++){var r=S[t];if(r._physics.ray_tests[e])return r}return null}function Ae(e){for(var t=0;t<S.length;t++)if(S[t]._physics.ray_tests[e])return A[t];return null}function Se(e,t,r){if(t.steering_wheel){var _=e.physics.body_id,n=t.engine_force*t.force_max,o=t.brake_force*t.brake_max,i=-t.steering*t.steering_max*2*Math.PI/t.steering_ratio;switch(t.inverse_control&&(i*=-1),t.type){case b:a.post_msg(r,a.OUT_UPDATE_CAR_CONTROLS,_,n,o,i);break;case Y:a.post_msg(r,a.OUT_UPDATE_BOAT_CONTROLS,_,n,o,i)}}}function pe(e){var t=e.vehicle,r=t.steering_wheel;if(r){var _=e.vehicle.steering_wheel_axis;Va(e.render.world_tsr,e.vehicle.steering_wheel_tsr,r.render.world_tsr);var n=N;Za(_,e.render.world_tsr,n);var a=h;Dr(n,-t.steering*t.steering_max*2*Math.PI,a);var o=Ba(r.render.world_tsr);Fr(a,o,o),c.update_transform(r)}}function me(e){var t=e.vehicle,r=t.speedometer;if(r){var _=e.vehicle.speedometer_axis;Va(e.render.world_tsr,e.vehicle.speedometer_tsr,r.render.world_tsr);var n=N;Za(_,e.render.world_tsr,n);var a=h,o=Math.abs(t.speed)*t.speed_ratio;o>t.max_speed_angle&&(o=t.max_speed_angle),Dr(n,-o,a);var i=Ba(r.render.world_tsr);Fr(a,i,i),mr(i,i),c.update_transform(r)}}function Oe(e){var t=e.vehicle,r=t.tachometer;if(r){var _=e.vehicle.tachometer_axis;Va(e.render.world_tsr,e.vehicle.tachometer_tsr,r.render.world_tsr);var n=N;Za(_,e.render.world_tsr,n);var a=h;Dr(n,-Math.abs(t.engine_force)*t.delta_tach_angle,a);var o=Ba(r.render.world_tsr);Fr(a,o,o),mr(o,o),c.update_transform(r)}}function ve(e){return e.is_vehicle&&"CHASSIS"==e.vehicle_settings.part}function Ne(e){return e.is_vehicle&&"HULL"==e.vehicle_settings.part}function ge(e){return"NAVMESH"==e.physics_settings.physics_type}function Ie(e){return e.is_floating&&"MAIN_BODY"==e.floating_settings.part}t.init_scene_physics=function(e){e._physics={worker_loaded:!1,bundles:[],ray_tests:{},ray_tests_arr:[]};var t=u.uranium_path;f.prevent_caching&&(t+="?v="+Hi()),i.log("%cLOAD PHYSICS","color: #0a0",u.use_workers?"Using Separate Worker Thread,":"Using Same Thread,","Max FPS: "+u.max_fps),i.log("%cPHYSICS PATH","color: #0a0",t);var r=a.create_worker(t,!u.use_workers);a.attach_handler(r,y),A.push(r),S.push(e),u.ping&&setInterval(function(){a.post_msg(r,a.OUT_PING,performance.now())},1e3)},t.check_worker_loaded=function(e){return!e._physics||e._physics.worker_loaded},t.cleanup=function(){for(var e=0;e<A.length;e++)a.terminate(A[e]);for(var t in A.length=0,S.length=0,p={},m.length=0,O=["ANY"],v)v[t]=0},t.append_object=function(e,t){if(ee(t)){var r=e.physics_settings,_=U(t),n=[];r.use_collision_compound&&L(e,n);var s=t._physics.bundles;if(ve(e)||Ne(e)||e.is_character||Ie(e)||e.use_obj_physics){var E=ge(e);if(E)var c=function(e,t){var r=j(B(),"NAVMESH"),_=o.get_scene_data(e,t).batches;r.navmesh=null;for(var n=0;n<_.length;n++){var a=_[n];if("PHYSICS"==a.type){r.navmesh=l.navmesh_build_from_bufs_data(a.bufs_data);break}}return r}(e,t);else c=function(e,t,r){var _=W(e,t,!1);a.post_msg(r,a.OUT_APPEND_BOUNDING_BODY,_.body_id,_.trans,_.quat,_.physics_type,_.is_ghost,_.disable_sleeping,_.mass,_.velocity_min,_.velocity_max,_.damping,_.rotation_damping,_.collision_id_num,_.collision_margin,_.collision_group,_.collision_mask,_.bounding_type,_.worker_bounding,_.size,_.friction,_.restitution,_.comp_children_params,_.correct_bound_offset),p[_.body_id]=e,m.push(e);var n=j(_.body_id,"BOUNDING");return n.type=_.physics_type,n.mass=_.mass,n.is_ghost=_.is_ghost,n.collision_id=_.collision_id,n.collision_id_num=_.collision_id_num,n}(e,n,_);e.physics=c;var T={batch:null,physics:c};E||(s.push(T),M(t,_,c.collision_id))}else for(var u=o.get_scene_data(e,t).batches,d=0;d<u.length;d++){var f=u[d];"PHYSICS"!=f.type||x(t,f)||(f.submesh.base_length?f.water&&t._render.water_params?X(f,t,_):(c=f.use_ghost?q(e,f,_):Q(e,f,_),e.physics=c,s.push(T={batch:f,physics:c}),M(t,_,c.collision_id)):i.error("Object "+e.name+" has collision material with no assigned vertices"))}for(ve(e)||Ne(e)?(function(e,t){var r=e.physics.body_id;if(ve(e)?(e.vehicle.type=b,a.post_msg(t,a.OUT_APPEND_CAR,r,e.vehicle.suspension_compression,e.vehicle.suspension_stiffness,e.vehicle.suspension_damping,e.vehicle.wheel_friction,e.vehicle.max_suspension_travel_cm)):Ne(e)&&(e.vehicle.type=Y,a.post_msg(t,a.OUT_APPEND_BOAT,r,e.vehicle.floating_factor,e.vehicle.water_lin_damp,e.vehicle.water_rot_damp)),e.vehicle.props){var _=e.vehicle.props;switch(e.vehicle.type){case b:$(_[0],e,r,!0,t),$(_[1],e,r,!0,t),$(_[2],e,r,!1,t),$(_[3],e,r,!1,t);break;case Y:for(var n=0;n<_.length;n++)$(_[n],e,r,!1,t)}}}(e,_),Se(e,e.vehicle,_)):e.is_character?function(e,t){var r=e.render,_=e.physics,n=r.bb_local.max_z-r.bb_local.min_z,o=_.body_id,i=e.character_settings,s=i.walk_speed,E=i.run_speed,c=i.step_height,l=i.jump_strength,T=i.waterline,u=function(e){var t=Ba(e.render.world_tsr),r=N,_=g;switch(e.type){case"CAMERA":r[0]=0,r[1]=-1,r[2]=0,We(r,t,r),_[0]=0,_[1]=0,_[2]=-1;break;case"MESH":r[0]=0,r[1]=0,r[2]=1,We(r,t,r),_[0]=0,_[1]=0,_[2]=1;break;case"EMPTY":r[0]=0,r[1]=1,r[2]=0,We(r,t,r),_[0]=0,_[1]=1,_[2]=0}r[1]=0,Ke(r,r);var n=Be(r,_),a=-r[0]*_[2]>0?-1:1;return Math.acos(n)*a}(e);a.post_msg(t,a.OUT_APPEND_CHARACTER,o,u,n,s,E,c,l,T),_.is_character=!0}(e,_):Ie(e)&&function(e,t){var r=e.physics.body_id;if(a.post_msg(t,a.OUT_APPEND_FLOATER,r,e.floater.floating_factor,e.floater.water_lin_damp,e.floater.water_rot_damp),e.floater.bobs)for(var _=e.floater.bobs,n=0;n<_.length;n++){var o=_[n],i=Fa(o.render.world_tsr),s=Ha(e.render.world_tsr,R),E=new Float32Array(3);ja(i,s,E),a.post_msg(t,a.OUT_ADD_FLOATER_BOB,r,E,o.bob_synchronize_pos)}e.physics.is_floater=!0}(e,_),d=0;d<m.length;d++){var P=m[d];P.physics&&te(P)}}},t.find_obj_by_body_id=C,t.update=function(e,t){for(var r=0;r<A.length;r++){k(A[r],e,t);var _=S[r],n=_._render.water_params;if(n&&n.waves_height>0){var o=s.get_subs(_,E.MAIN_OPAQUE),i=De(o.wind)||1;a.post_msg(A[r],a.OUT_SET_WATER_TIME,o.time*i)}}},t.get_active_scene=function(){return S[0]},t.pause=function(){for(var e=0;e<A.length;e++)a.post_msg(A[e],a.OUT_PAUSE)},t.resume=function(){for(var e=0;e<A.length;e++)a.post_msg(A[e],a.OUT_RESUME)},t.enable_simulation=function(e){var t=e.physics;if(t||r.panic("No object physics"),!t.simulated){var _=t.body_id,n=ie(_);t.simulated=!0,a.post_msg(n,a.OUT_ENABLE_SIMULATION,_)}},t.disable_simulation=function(e){var t=e.physics;if(t||r.panic("No object physics"),t.simulated){var _=t.body_id,n=ie(_);t.simulated=!1,a.post_msg(n,a.OUT_DISABLE_SIMULATION,_)}},t.scene_has_physics=ee,t.obj_has_physics=function(e){return Boolean(e.physics)},t.has_dynamic_physics=function(e){var t=e.physics;return!!(t&&t.simulated&&("RIGID_BODY"==t.type||"DYNAMIC"==t.type)&&t.mass>0&&0==t.is_ghost)},t.has_simulated_physics=function(e){var t=e.physics;return!(!t||!t.simulated)},t.set_gravity=function(e,t,r,_){var n=e.physics.body_id,o=ie(n);a.post_msg(o,a.OUT_SET_GRAVITY,n,t,r,_)},t.has_constraint=re,t.apply_constraint=oe,t.clear_constraint=function(e){var t=e.physics,r=t.cons_id,_=ie(t.body_id);a.post_msg(_,a.OUT_REMOVE_CONSTRAINT,r),t.cons_id=null},t.pull_to_constraint_pivot=function(e,r,_,n,a,o){var i=ya(r,1,_,R),s=ya(a,1,o,I);Ha(i,i),Va(s,i,i),c.get_tsr(n,s),Va(s,i,i),c.set_tsr(e,i),c.update_transform(e);var E=Fa(e.render.world_tsr),l=Ba(e.render.world_tsr);t.set_transform(e,E,l)},t.set_transform=function(e,t,r){var _=e.physics,n=a.get_msg_cache(a.OUT_SET_TRANSFORM);ya(Ga(e.render.world_tsr,n.trans),1,Xa(e.render.world_tsr,n.quat),_.curr_tsr),n.body_id=_.body_id,he(t,n.trans),nr(r,n.quat);var o=ie(_.body_id);a.post_msg(o,a.OUT_SET_TRANSFORM)},t.sync_transform=se,t.sync_bounding=function(e,t){var r=e.physics_settings,_=U(t),n=[];r.use_collision_compound&&L(e,n),(ve(e)||Ne(e)||e.is_character||Ie(e)||e.use_obj_physics)&&(ge(e)||function(e,t,r){var _=W(e,t,!0);a.post_msg(r,a.OUT_UPDATE_BOUNDING_BODY,_.body_id,_.trans,_.quat,_.physics_type,_.is_ghost,_.disable_sleeping,_.mass,_.velocity_min,_.velocity_max,_.damping,_.rotation_damping,_.collision_id_num,_.collision_margin,_.collision_group,_.collision_mask,_.bounding_type,_.worker_bounding,_.size,_.friction,_.restitution,_.comp_children_params,_.correct_bound_offset)}(e,n,_))},t.sync_mesh=function(e,t){for(var r=U(t),_=e.scenes_data[0].batches,n=0;n<_.length;n++){var a=_[n];"PHYSICS"==a.type&&(T.update_batch_geometry(_[n],_[n].submesh,e.render.shape_keys_values),a.use_ghost?i.error("The function is not implemented for ghost objects yet"):z(e,a,r),M(t,r,e.physics.collision_id))}},t.apply_velocity=function(e,t,r,_){var n=N;Ee(e,t,r,_,n);var o=e.physics.body_id,i=Math.abs(0),s=Math.abs(0),E=Math.abs(0),c=Math.abs(n[0]),l=Math.abs(n[1]),T=Math.abs(n[2]);n[0]=c?n[0]/c*Math.max(c,i):0,n[1]=l?n[1]/l*Math.max(l,s):0,n[2]=T?n[2]/T*Math.max(T,E):0;var u=ie(o);a.post_msg(u,a.OUT_SET_LINEAR_VELOCITY,o,n[0],n[1],n[2])},t.apply_velocity_world=function(e,t,r,_){var n=e.physics.body_id,o=ie(n);a.post_msg(o,a.OUT_SET_LINEAR_VELOCITY,n,t,r,_)},t.apply_force=function(e,t,r,_,n){var o=N;n?(o[0]=t,o[1]=r,o[2]=_):Ee(e,t,r,_,o);var i=e.physics.body_id,s=ie(i);a.post_msg(s,a.OUT_APPLY_CENTRAL_FORCE,i,o[0],o[1],o[2])},t.apply_torque=function(e,t,r,_){var n=N;Ee(e,t,r,_,n);var o=e.physics.body_id,i=ie(o);a.post_msg(i,a.OUT_APPLY_TORQUE,o,n[0],n[1],n[2])},t.set_angular_velocity=function(e,t,r,_){var n=e.physics.body_id,o=ie(n);a.post_msg(o,a.OUT_SET_ANGULAR_VELOCITY,n,t,r,_)},t.set_character_move_dir=function(e,t,r){var _=e.physics.body_id,n=ie(_);a.post_msg(n,a.OUT_SET_CHARACTER_MOVE_DIR,_,t,r)},t.set_character_move_type=function(e,t){var r=e.physics.body_id,_=ie(r);a.post_msg(_,a.OUT_SET_CHARACTER_MOVE_TYPE,r,t)},t.set_character_walk_velocity=function(e,t){var r=e.physics.body_id,_=ie(r);a.post_msg(_,a.OUT_SET_CHARACTER_WALK_VELOCITY,r,t)},t.set_character_run_velocity=function(e,t){var r=e.physics.body_id,_=ie(r);a.post_msg(_,a.OUT_SET_CHARACTER_RUN_VELOCITY,r,t)},t.set_character_fly_velocity=function(e,t){var r=e.physics.body_id,_=ie(r);a.post_msg(_,a.OUT_SET_CHARACTER_FLY_VELOCITY,r,t)},t.character_jump=function(e){var t=e.physics.body_id,r=ie(t);a.post_msg(r,a.OUT_CHARACTER_JUMP,t)},t.character_rotation_inc=function(e,t,r){var _=e.physics.body_id,n=ie(_);a.post_msg(n,a.OUT_CHARACTER_ROTATION_INCREMENT,_,t,r)},t.set_character_rotation=function(e,t,r){var _=e.physics.body_id,n=ie(_);a.post_msg(n,a.OUT_SET_CHARACTER_ROTATION,_,t,r)},t.set_character_rotation_h=function(e,t){var r=e.physics.body_id,_=ie(r);a.post_msg(_,a.OUT_SET_CHARACTER_HOR_ROTATION,r,t)},t.set_character_rotation_v=function(e,t){var r=e.physics.body_id,_=ie(r);a.post_msg(_,a.OUT_SET_CHARACTER_VERT_ROTATION,r,t)},t.set_character_vert_move_dir_angle=function(e,t){var r=e.physics.body_id,_=ie(r);a.post_msg(_,a.OUT_SET_CHARACTER_VERT_MOVE_DIR_ANGLE,r,t)},t.append_collision_test=function(e,t,r,_){var n=e.physics;if(!n.navmesh){for(var a=n.body_id,o=0;o<n.collision_tests.length;o++)if((i=n.collision_tests[o]).collision_id==t&&i.callback==r)return;var i;n.collision_tests.push(i={body_id_src:a,calc_pos_norm:_||!1,collision_id:t,callback:r,pairs:[],pair_results:[]});var s=ie(a);ce(i,w(s),s)}},t.remove_collision_test=function(e,t,r){for(var _=e.physics,n=ie(_.body_id),a=w(n),o=0;o<_.collision_tests.length;o++){var i=_.collision_tests[o];if(i.collision_id==t&&i.callback==r){if(F(i)){var s=Re(0,0,0,N);i.callback(!1,null,s,s,0)}_.collision_tests.splice(o,1),o--,Te(a,n,i.pairs)}}},t.apply_collision_impulse_test=function(e,t){de(e)&&ue(e);var r=e.physics,_=ie(r.body_id);a.post_msg(_,a.OUT_APPLY_COLLISION_IMPULSE_TEST,r.body_id),r.col_imp_test_cb=t},t.clear_collision_impulse_test=ue,t.append_ray_test=function(e,t,r,_,n,o,i,s,E){var c=(v.ray_test++,v.ray_test),l={id:c,body_id:e?e.physics.body_id:0,from:new Float32Array(t),to:new Float32Array(r),collision_id:_,collision_id_num:V(_),autoremove:o,calc_all_hits:i,calc_pos_norm:s,ign_src_rot:E,callback:n},T=ie(l.body_id)||A[0],u=w(T)._physics;return u.ray_tests[c]=l,u.ray_tests_arr.push(l),a.post_msg(T,a.OUT_APPEND_RAY_TEST,l.id,l.body_id,l.from,l.to,l.collision_id_num,l.autoremove,l.calc_all_hits,l.calc_pos_norm,l.ign_src_rot),c},t.remove_ray_test=fe,t.change_ray_test_from_to=function(e,t,r){var _=Pe(e),n=Ae(e),o=_._physics.ray_tests[e];o&&!o.autoremove&&(o.from.set(t),o.to.set(r),a.post_msg(n,a.OUT_CHANGE_RAY_TEST_FROM_TO,e,t,r))},t.is_ray_test=function(e){return!!Pe(e)._physics.ray_tests[e]},t.vehicle_throttle=function(e,t){var r=e.vehicle;r.engine_force=t,Se(e,r,ie(e.physics.body_id))},t.vehicle_steer=function(e,t){var r=e.vehicle;r.steering=t,Se(e,r,ie(e.physics.body_id))},t.vehicle_brake=function(e,t){var r=e.vehicle;r.brake_force=t,Se(e,r,ie(e.physics.body_id))},t.is_vehicle_chassis=ve,t.is_vehicle_hull=Ne,t.is_navigation_mesh=ge,t.is_car_wheel=function(e){if(!e.is_vehicle)return!1;var t=e.vehicle_settings.part;return"WHEEL_FRONT_LEFT"==t||"WHEEL_FRONT_RIGHT"==t||"WHEEL_BACK_LEFT"==t||"WHEEL_BACK_RIGHT"==t},t.is_boat_bob=function(e){return!!e.is_vehicle&&"BOB"==e.vehicle_settings.part},t.is_floater_bob=function(e){return!!e.is_floating&&"BOB"==e.floating_settings.part},t.is_vehicle_steering_wheel=function(e){return!(!e.is_vehicle||"STEERING_WHEEL"!=e.vehicle_settings.part)},t.is_vehicle_speedometer=function(e){return!(!e.is_vehicle||"SPEEDOMETER"!=e.vehicle_settings.part)},t.is_vehicle_tachometer=function(e){return!(!e.is_vehicle||"TACHOMETER"!=e.vehicle_settings.part)},t.get_vehicle_speed=function(e){return e.vehicle.speed},t.wheel_index=function(e){switch(e){case"WHEEL_FRONT_RIGHT":return 0;case"WHEEL_FRONT_LEFT":return 1;case"WHEEL_BACK_LEFT":return 2;case"WHEEL_BACK_RIGHT":return 3}},t.has_character_physics=function(e){return e.physics&&e.physics.is_character},t.is_floater_main=Ie,t.get_fps=function(){return P},t.debug_workers=function(){for(var e=0;e<A.length;e++)a.post_msg(A[e],a.OUT_DEBUG)},t.remove_object=function(e){var t=e.physics.body_id;if("BOUNDING"==e.physics.type){var r=m.indexOf(e);-1==r&&i.error("Object "+e.name+" doesn't have bounding physics"),delete p[t],m.splice(r,1)}var _=ie(t),n=w(_);!function(e,t,r){for(var _=e._physics.bundles,n=[],o=0;o<_.length;o++)for(var i=_[o].physics,s=0;s<i.collision_tests.length;s++)for(var E=i.collision_tests[s],c=0;c<E.pairs.length;c++){var l=E.pairs[c],T=E.pair_results[c];if(l[0]==r||l[1]==r){if(E.pairs.splice(c,1),E.pair_results.splice(c,1),c--,T&&!F(E)){var u=Re(0,0,0,N);E.callback(!1,null,u,u,0)}n.push(l)}}n.length&&a.post_msg(t,a.OUT_REMOVE_COLLISION_TEST,n)}(n,_,t),de(e)&&ue(e);for(var o=n._physics.bundles,s=0;s<o.length;s++)o[s].physics.body_id==t&&(o.splice(s,1),s--);a.post_msg(_,a.OUT_REMOVE_BODY,t)},t.has_dynamic_settings=function(e){var t=e.physics_settings;return e.is_vehicle||e.is_floating||e.is_character||e.use_obj_physics&&!t.use_ghost&&t.mass>0&&("DYNAMIC"==t.physics_type||"RIGID_BODY"==t.physics_type)}}),gs=A("__animation",function(e,t){var r=ha(e),_=Wo(e),n=os(e),a=is(e),o=Ns(e),i=ga(e),s=ps(e),E=Ss(e),c=ai(e),l=ri(e),T=Os(e),u=_.animation,d=_.context_limits,f=1e-6;t.LAST_FRAME_EPSILON=f;var P=10,A=20,S=30,p=40,m=50,O=60,v=70,N=80;t.OBJ_ANIM_TYPE_NONE=0,t.OBJ_ANIM_TYPE_ARMATURE=P,t.OBJ_ANIM_TYPE_OBJECT=A,t.OBJ_ANIM_TYPE_VERTEX=S,t.OBJ_ANIM_TYPE_SOUND=p,t.OBJ_ANIM_TYPE_PARTICLES=m,t.OBJ_ANIM_TYPE_MATERIAL=O,t.OBJ_ANIM_TYPE_LIGHT=v,t.OBJ_ANIM_TYPE_ENVIRONMENT=N;var g=0,h=-1;t.SLOT_0=g,t.SLOT_1=1,t.SLOT_2=2,t.SLOT_3=3,t.SLOT_4=4,t.SLOT_5=5,t.SLOT_6=6,t.SLOT_7=7,t.SLOT_ALL=h;var R=10,I=20,b=30;t.AB_CYCLIC=R,t.AB_FINISH_RESET=I,t.AB_FINISH_STOP=b;var Y=0,L=1,M=2,x=3,y=4,w=5,U=6,C=7,D=new Array(3),F=new Float32Array(3),G=new Float32Array(3),k=new Float32Array(4),K=new Float32Array(4),B=new Float32Array(4),X=new Float32Array(4),H=new Float32Array(4),Q=new Float32Array(4),z=new Float32Array(4),V=new Float32Array(4),j=ba(),q=ba(),W=[],J=[];function Z(e,t){var r=e.anim_slots[t];r&&r.finish_callback&&r.exec_finish_callback&&(r.exec_finish_callback=!1,r.finish_callback(e,t))}function $(e,t,r){var _=e.anim_slots[r];_.type=S;var n=t.frame_start,a=t.frame_end-n+1;_.start=n,_.length=a,_.current_frame_float=n,_.animation_name=t.name;for(var o=0,i=0;i<e.vertex_anim.length;i++){var s=e.vertex_anim[i];if(s==t)break;o+=s.frame_end-s.frame_start+1}_.va_frame_offset=o}function ee(e,t,r){t.type=m,t.animation_name=r.name,t.start=r.frame_start,t.length=r.frame_end-t.start,r.cyclic||(t.length+=r.lifetime_frames)}function te(e,t){var r={type:null,animation_name:null,action_frame_range:null,action_step:0,action_bflags:null,channels_mask:new Int8Array(8),quats:null,trans:null,bone_space_quats:null,bone_space_trans:null,skinning_data:[],play:!1,behavior:I,current_frame_float:0,start:0,length:0,trans_smooth_period:0,quat_smooth_period:0,exec_finish_callback:!1,va_frame_offset:null,speed:1,volume:null,pitch:null,color:null,energy:null,zenith_color:null,horizon_color:null,fog_intensity:null,fog_depth:null,fog_start:null,fog_height:null,fog_color:null,nodemat_values:[],node_value_inds:[],nodemat_rgbs:[],node_rgb_inds:[],node_batches:null};if(!e.anim_slots.length)for(var _=0;_<8;_++)e.anim_slots.push(null);e.anim_slots[t]=r}function re(e){-1==W.indexOf(e)&&W.push(e)}function _e(e){return e.replace(/_B4W_BAKED$/,"")}function ne(e,t){return{name_list:e,action:t}}function ae(e,t,r){if(e.animation_data){var _=e.animation_data.action;_&&_._render.type==O&&t.push(ne(r,_))}for(var n=e.nodes,a=0;a<n.length;a++){var o=n[a];if(o.node_group){var i=o.node_group.node_tree;if(i){var s=r.slice();s.push(o.name),ae(i,t,s)}}}}function oe(e){return!(!n.is_mesh(e)||!e.render.vertex_anim)}function ie(e,t,r){var _=e.anim_slots;if(r==h)for(var n=0;n<8;n++){var a;(a=_[n])&&(a.current_frame_float=t,Ee(e,0,n,!0))}else(a=_[r])&&(a.current_frame_float=t,Ee(e,0,r,!0))}function se(e,t,r){if(t==h)for(var _=0;_<8;_++){var n;(n=e[_])&&r(n)}else(n=e[t])&&r(n)}function Ee(e,t,r,_){me(e,t,r,_),Z(e,r),e.render.anim_mixing&&(he(e,t),ve(e,t))}function ce(e,t,r,_){var o=r.frame_range;if(o[0]>o[1])return i.warn('Incompatible action "'+r.name+'" has been applied to object "'+e.name+'"'),!1;var s=r._render,E=e.anim_slots[_];switch(E.animation_name=r.name,E.action_frame_range=o,E.action_step=s.pierce_step,E.action_bflags=s.bflags,E.channels_mask.set(s.channels_mask),E.start=o[0],E.length=o[1]-o[0],E.current_frame_float=o[0],s.type){case P:if(n.is_armature(e)){E.type=P;var c=le(e,t,r);c||Te(e,t,r,c=Re(r,e.render.bone_pointers)),E.trans=c.trans,E.quats=c.quats,E.bone_space_quats=c.bone_space_quats,E.bone_space_trans=c.bone_space_trans,ue(e,_,r,c)}break;case p:n.is_speaker(e)&&(E.volume=s.params.volume||null,E.pitch=s.params.pitch||null,E.type=p);break;case v:n.is_lamp(e)&&(E.color=s.params.color||null,E.energy=s.params.energy||null,E.type=v);break;case O:if("MESH"==e.type||"WORLD"==e.type){E.type=O;var l=function(e,t,r,_){var n=[],a=[],o=[],i=[],s=[],E=r._render,c=t?t[0]:null;for(var l in E.params)for(var T=Pe(l,t),u=0;u<e.scenes_data.length;u++)for(var d=e.scenes_data[u].batches,f=0;f<d.length;f++){var P=d[f];if(_||!c||-1!=P.material_names.indexOf(c)){var A=P.node_rgb_inds,S=Se(l,T,E,a,n,P.node_value_inds),p=Ae(l,T,E,i,o,A);(S||p)&&s.push(P)}}return{val_inds:n,values:a,rgb_inds:o,rgbs:i,node_batches:s}}(e,t,r,n.is_world(e));E.node_value_inds=l.val_inds,E.nodemat_values=l.values,E.node_rgb_inds=l.rgb_inds,E.nodemat_rgbs=l.rgbs,E.node_batches=l.node_batches}break;case A:var T=s.params.tsr;if(!T)return i.warn('Incompatible action "'+r.name+'" has been applied to object "'+e.name+'"'),!1;E.type=A;var u=le(e,t,r);u||Te(e,t,r,u=pe(0,r,T)),E.trans=u.trans,E.quats=u.quats,a.obj_has_particles(e)&&a.update_start_pos(e,E.trans[0],E.quats[0]);break;case N:n.is_world(e)&&(E.energy=s.params["light_settings.environment_energy"]||null,E.horizon_color=s.params.horizon_color||null,E.zenith_color=s.params.zenith_color||null,E.fog_intensity=s.params["mist_settings.intensity"]||null,E.fog_depth=s.params["mist_settings.depth"]||null,E.fog_start=s.params["mist_settings.start"]||null,E.fog_height=s.params["mist_settings.height"]||null,E.fog_color=s.params.b4w_fog_color||null,E.type=N)}return n.is_armature(e)&&s.type!=P&&fe(e,_),!0}function le(e,t,r){var _=e.action_anim_cache;if(t)var n=t.join("%join%");else n=null;for(var a=0;a<_.length;a+=3)if(r==_[a]&&n==_[a+1])return _[a+2];return null}function Te(e,t,r,_){var n=e.action_anim_cache;if(t)var a=t.join("%join%");else a=null;n.push(r,a,_)}function ue(e,t,r,_){var n=e.render,a=n.skinned_renders,o=e.anim_slots[t],i=o.skinning_data,s=function(e,t){for(var r=e.skinning_data_cache,_=0;_<r.length;_+=2)if(t==r[_])return r[_+1];return null}(n,r);if(s)o.skinning_data=s;else{for(var E=0;E<a.length;E++){var c=be(_,a[E].bone_skinning_info);i.push(c)}!function(e,t,r){e.skinning_data_cache.push(t,r)}(n,r,i)}if(n.anim_mixing){var l=n.blend_skel_slots;if(t>l[1]){var T=l[1];l[1]=t,l[0]=T}else t>l[0]&&t<l[1]&&(l[0]=t);de(e)}}function de(e){var t=e.render.blend_skel_slots;if(-1!=t[0]&&-1!=t[1]){var r=e.anim_slots,_=r[t[1]].current_frame_float,n=Math.floor(_),a=_-n,o=r[t[0]];_=o.current_frame_float,n=Math.floor(_),o.current_frame_float=n+a}}function fe(e,t){var r=e.render.blend_skel_slots,_=r[1];if(r[0]=-1,r[1]=-1,t!=h)for(var n=e.anim_slots,a=_;a>=g;a--){var o=n[a];if(o&&o.type==P){if(a>r[1]){r[1]=a;continue}a>r[0]&&(r[1]=a);break}}}function Pe(e,t){var r=e.match(/"(.*?)"/)[1];if(t&&t.length>1){for(var _=t[1],n=2;n<t.length;n++)_=_+"%join%"+t[n];_+="%join%"+r}else _=r;return _}function Ae(e,t,r,_,n,a){if(!a)return!1;for(var o=!1,i=0;i<a.length;i+=2)t==a[i]&&(n.push(a[i+1]),_.push(new Float32Array(r.params[e])),o=!0);return o}function Se(e,t,r,_,n,a){if(!a)return!1;for(var o=!1,i=0;i<a.length;i+=3)t==a[i]&&(n.push(4*a[i+1]+a[i+2]),_.push(new Float32Array(r.params[e])),o=!0);return o}function pe(e,t,r){for(var _=t._render.num_pierced,n=[],a=[],o=0;o<_;o++)n.push(r.subarray(8*o,8*o+4)),a.push(r.subarray(8*o+4,8*o+8));return{trans:n,quats:a}}function me(e,t,_,i){var u=e.anim_slots[_];if(u&&null!=u.type&&(u.play||i)){var d=e.render,g=u.current_frame_float,h=u.start,k=u.length;g+=u.speed*t*l.get_framerate();var K=u.type,B=u.speed;if(B>=0&&g>=h+k||B<0&&g<h)switch(i||(u.exec_finish_callback=!0),u.behavior){case R:g=B>=0?(g-h)%k+h:h+k-f;break;case I:g=B>=0?h:h+k-f,u.play=!1;break;case b:g=B>=0?h+k-f:h,u.play=!1}switch(u.current_frame_float=g,K){case P:if(!d.anim_mixing){var X=(re=Oe(u))[0],V=re[1],q=re[2];d.quats_before=u.quats[X],d.quats_after=u.quats[V],d.trans_before=u.trans[X],d.trans_after=u.trans[V],d.frame_factor=q,function(e,t,r,_){for(var n=e.skinned_renders,a=t.skinning_data,o=0;o<n.length;o++){var i=n[o],s=a[o];i.quats_before=s.quats[r],i.quats_after=s.quats[_],i.trans_before=s.trans[r],i.trans_after=s.trans[_],i.frame_factor=e.frame_factor}}(d,u,X,V),T.update_transform(e)}break;case A:var W=function(e,t,r,_){var n=r[0],a=r[1],o=r[2],i=e.trans,s=i[n][1],E=i[n][2],c=i[a][1],l=i[a][2];return _[0]=(1-o)*i[n][0]+o*i[a][0],_[1]=(1-o)*s+o*c,_[2]=(1-o)*E+o*l,_}(u,0,re=Oe(u),F),J=function(e,t,r,_){var n=re[0],a=re[1],o=re[2],i=e.quats,s=Q;s[0]=i[n][0],s[1]=i[n][1],s[2]=i[n][2],s[3]=i[n][3];var E=z;return E[0]=i[a][0],E[1]=i[a][1],E[2]=i[a][2],E[3]=i[a][3],Xr(s,E,o,_),_}(u,0,0,H),Z=function(e,t,r){var _=re[2],n=e.trans;return(1-_)*n[re[0]][3]+_*n[re[1]][3]}(u);if(e.parent&&e.pinverse_tsr){var $=j;ya(W,Z,J,$),Va(e.pinverse_tsr,$,$),Ga($,W),Xa($,J),Z=ka($)}if(u.trans_smooth_period){var ee=G;T.get_translation(e,ee),Dn(W,ee,t,u.trans_smooth_period,W)}if(u.quat_smooth_period){var te=Q;T.get_rotation(e,te),Fn(J,te,t,u.quat_smooth_period,J)}(pe=u.channels_mask)[0]&&T.set_translation_rel(e,W),pe[1]&&T.set_rotation_rel(e,J),pe[2]&&T.set_scale_rel(e,Z),T.update_transform(e),o.sync_transform(e);break;case S:var re=function(e){var t=e.current_frame_float-e.start;t<0&&(t=0),t>=e.length&&(t=e.length);var r=Math.floor(t),_=r+1,n=t-r;e.behavior!=R&&_==e.length&&(_=r-=1,n=1);var a=e.va_frame_offset;return D[0]=r+a,D[1]=_+a,D[2]=n,D}(u);d.va_frame=re[0],d.va_frame_factor=re[2];break;case p:var _e=(re=Oe(u))[0],ne=re[1],ae=re[2];u.volume&&E.set_volume(e,(1-ae)*u.volume[_e]+ae*u.volume[ne]),u.pitch&&E.playrate(e,(1-ae)*u.pitch[_e]+ae*u.pitch[ne]);break;case m:if(u.behavior==R)var oe=(g-h)/l.get_framerate();else oe=g/l.get_framerate();a.set_time(e,u.animation_name,oe);break;case O:_e=(re=Oe(u))[0],ne=re[1],ae=re[2];for(var ie=u.nodemat_values,se=u.node_value_inds,Ee=u.nodemat_rgbs,ce=u.node_rgb_inds,le=u.node_batches,Te=0;Te<se.length;Te++)for(var ue=ie[Te],de=se[Te],fe=(1-ae)*ue[_e]+ae*ue[ne],Pe=0;Pe<le.length;Pe++)le[Pe].node_values[de]=fe;for(Te=0;Te<ce.length;Te++){var Ae=Ee[Te],Se=(de=ce[Te],He(Ae.subarray(3*_e,3*_e+3),Ae.subarray(3*ne,3*ne+3),ae,F));for(Pe=0;Pe<le.length;Pe++)le[Pe].node_rgbs[3*de]=Se[0],le[Pe].node_rgbs[3*de+1]=Se[1],le[Pe].node_rgbs[3*de+2]=Se[2]}n.is_world(e)&&s.update_sky_texture(e);break;case v:_e=(re=Oe(u))[0],ne=re[1],ae=re[2];var pe=u.channels_mask;(ge=u.energy)&&pe[0]&&ns(e.light,(1-ae)*ge[_e]+ae*ge[ne]);var me=u.color;me&&pe[1]&&(F[0]=(1-ae)*me[3*_e]+ae*me[3*ne],F[1]=(1-ae)*me[3*_e+1]+ae*me[3*ne+1],F[2]=(1-ae)*me[3*_e+2]+ae*me[3*ne+2],_s(e.light,F));var ve=e.scenes_data;for(Te=0;Te<ve.length;Te++)s.update_lamp_scene_color_intensity(e,ve[Te].scene);break;case N:_e=(re=Oe(u))[0],ne=re[1],ae=re[2],pe=u.channels_mask;var Ne=s.get_subs((ve=e.scenes_data)[0].scene,c.MAIN_OPAQUE),ge=u.energy;if(pe[Y])var he=(1-ae)*ge[_e]+ae*ge[ne];else he=Ne.energy;var Re=u.horizon_color;if(pe[L]){F[0]=(1-ae)*Re[3*_e]+ae*Re[3*ne],F[1]=(1-ae)*Re[3*_e+1]+ae*Re[3*ne+1],F[2]=(1-ae)*Re[3*_e+2]+ae*Re[3*ne+2];var Ie=F}else Ie=Ne.horizon_color;var be=u.zenith_color;if(pe[M]){G[0]=(1-ae)*be[3*_e]+ae*be[3*ne],G[1]=(1-ae)*be[3*_e+1]+ae*be[3*ne+1],G[2]=(1-ae)*be[3*_e+2]+ae*be[3*ne+2];var Ye=G}else Ye=Ne.zenith_color;var Le=u.fog_intensity;if(pe[x])var Me=(1-ae)*Le[_e]+ae*Le[ne];var xe=u.fog_depth;if(pe[y])var ye=(1-ae)*xe[_e]+ae*xe[ne];var we=u.fog_start;if(pe[w])var Ue=(1-ae)*we[_e]+ae*we[ne];var Ce=u.fog_height;if(pe[U])var De=(1-ae)*Ce[_e]+ae*Ce[ne];var Fe=u.fog_color;if(pe[C]){H[0]=(1-ae)*Fe[3*_e]+ae*Fe[3*ne],H[1]=(1-ae)*Fe[3*_e+1]+ae*Fe[3*ne+1],H[2]=(1-ae)*Fe[3*_e+2]+ae*Fe[3*ne+2];var Ge=H}for(Te=0;Te<ve.length;Te++){var ke=e.scenes_data[Te].scene;(pe[Y]||pe[L]||pe[M])&&s.set_environment_colors(ke,he,Ie,Ye),pe[x]&&s.set_fog_intensity(ke,Me),pe[y]&&s.set_fog_depth(ke,ye),pe[w]&&s.set_fog_start(ke,Ue),pe[U]&&s.set_fog_height(ke,De),pe[C]&&s.set_fog_color_density(ke,Ge)}break;default:r.panic("Unknown animation type:"+K)}}}function Oe(e){var t=e.action_frame_range[0],r=e.action_frame_range[1]-t,_=e.current_frame_float-t;_<0&&(_=0),_>=r&&(_=r),_/=e.action_step;var n=Math.floor(_);if(e.action_bflags[n])var a=_-n;else a=0;var o=Math.ceil(n+a);return D[0]=n,D[1]=o,D[2]=a,D}function ve(e,t){var r=e.render,_=r.anim_mix_factor,n=r.blend_skel_slots,a=n[0],o=n[1];if(-1!=o){if(-1!=a){var i=e.anim_slots[a];if(i.play||0==t||r.mix_with_current){var s=Oe(i),E=s[0],c=s[1];r.frame_factor=s[2];var l=i.quats[E],u=i.quats[c],d=i.trans[E],f=i.trans[c]}else _=1}else _=1;var P=e.anim_slots[o];if(P.play||0==t||r.mix_with_current){var A=Oe(P),S=A[0],p=A[1];r.frame_factor=A[2]}else{if(-1==a||!i.play)return;_=0}var m=P.quats[S],O=P.quats[p],v=P.trans[S],N=P.trans[p];if(1!=_||r.mix_with_current)if(0!=_||r.mix_with_current){var g=r.bone_pointers;if(r.mix_with_current&&!r.trans_curr&&!r.quats_curr)for(var h in r.trans_curr=new Float32Array(r.trans_before.length),r.quats_curr=new Float32Array(r.quats_before.length),g)(R=g[h]).parent_bone_ptr||ge(r,R);for(var h in g){var R;(R=g[h]).parent_bone_ptr||Ne(r,R,i,P,E,c,S,p)}}else r.quats_before.set(l),r.quats_after.set(u),r.trans_before.set(d),r.trans_after.set(f);else r.quats_before.set(m),r.quats_after.set(O),r.trans_before.set(v),r.trans_after.set(N);T.update_transform(e),$i(e)}}function Ne(e,t,r,_,n,a,o,i){var s=t.parent_bone_ptr,E=e.anim_mix_factor,c=H,l=Q,T=k,u=K,d=z,f=V,P=B,A=X,S=4*t.bone_index,p=_.bone_space_quats[o],m=_.bone_space_trans[o],O=_.bone_space_quats[i],v=_.bone_space_trans[i];if(!e.mix_with_current)var N=r.bone_space_quats[n],g=r.bone_space_trans[n],h=r.bone_space_quats[a],R=r.bone_space_trans[a];for(var I=0;I<4;I++)l[I]=p[S+I],u[I]=m[S+I],f[I]=O[S+I],A[I]=v[S+I],e.mix_with_current?(c[I]=e.quats_curr[S+I],T[I]=e.trans_curr[S+I],d[I]=e.quats_curr[S+I],P[I]=e.trans_curr[S+I]):(c[I]=N[S+I],T[I]=g[S+I],d[I]=h[S+I],P[I]=R[S+I]);for(Xr(c,l,E,c),cn(T,u,E,T),Ca(T,j),Da(c,j),s&&Va(s.tsr_local_pose_b,j,j),Ma(j,t.tsr_local_pose_b),Va(j,t.tsr_local_rest_i,j),Ka(j,T),Xa(j,c),Xr(d,f,E,d),cn(P,A,E,P),Ca(P,j),Da(d,j),s&&Va(s.tsr_local_pose_a,j,j),Ma(j,t.tsr_local_pose_a),Va(j,t.tsr_local_rest_i,j),Ka(j,P),Xa(j,d),I=0;I<4;I++)e.quats_before[S+I]=c[I],e.trans_before[S+I]=T[I],e.quats_after[S+I]=d[I],e.trans_after[S+I]=P[I];var b=t.descend_bones_ptrs;for(I=0;I<b.length;I++)Ne(e,b[I],r,_,n,a,o,i)}function ge(e,t){for(var r=4*t.bone_index,_=t.parent_bone_ptr,n=e.anim_mix_factor,a=k,o=H,i=K,s=Q,E=0;E<4;E++)a[E]=e.trans_before[r+E],o[E]=e.quats_before[r+E],i[E]=e.trans_after[r+E],s[E]=e.quats_after[r+E];for(Ca(a,j),Da(o,j),Va(j,t.tsr_local_rest,j),Ma(j,t.tsr_local_pose_b),_&&(Ha(_.tsr_local_pose_b,q),Va(q,j,j)),Ka(j,a),Xa(j,o),Ca(i,j),Da(s,j),Va(j,t.tsr_local_rest,j),Ma(j,t.tsr_local_pose_a),_&&(Ha(_.tsr_local_pose_a,q),Va(q,j,j)),Ka(j,i),Xa(j,s),Xr(o,s,n,o),cn(a,i,n,a),E=0;E<4;E++)e.quats_curr[r+E]=o[E],e.trans_curr[r+E]=a[E];var c=t.descend_bones_ptrs;for(E=0;E<c.length;E++)ge(e,c[E])}function he(e,t){var r=e.render,_=r.anim_mix_factor,n=r.anim_mix_factor_change_speed;if(0!=n){!r.mix_with_current||r.trans_curr||r.quats_curr||(_=r.anim_mix_factor=0);var a=r.anim_destination_mix_factor-_,o=n*t;W_(a)==W_(n)&&Math.abs(o)<Math.abs(a)?r.anim_mix_factor+=o:(r.anim_mix_factor=r.anim_destination_mix_factor,r.anim_mix_factor_change_speed=0,r.anim_mix_cb&&(r.anim_mix_cb(),r.anim_mix_cb=null),r.mix_with_current&&(r.trans_curr=null,r.quats_curr=null,r.mix_with_current=!1))}}function Re(e,t){for(var r=[],_=[],n=[],a=[],o=e._render.num_pierced,i=0;i<o;i++){for(var s in t){var E=t[s],c=E.tsr_basis,l=e._render.bones[s];l?Ma(l.subarray(8*i,8*i+8),c):xa(c),E.tsr_channel_cache_valid=!1}var T=Ie(t);r.push(T.trans),_.push(T.quats),n.push(T.bone_space_trans),a.push(T.bone_space_quats)}return{trans:r,quats:_,bone_space_trans:n,bone_space_quats:a}}function Ie(e){var t=[],r=[],_=[],n=[],a=new Float32Array(4),o=new Float32Array(4);for(var i in e){var s=e[i];Le(s,a,o);var E=s.bone_index;Va(s.tsr_bone_rest,s.tsr_basis,j);for(var c=0;c<4;c++){var l=4*E+c;t[l]=a[c],r[l]=o[c],_[l]=j[c],n[l]=j[c+4]}}return{trans:t,quats:r,bone_space_trans:_,bone_space_quats:n}}function be(e,t){for(var r=[],_=[],n=e.trans,a=e.quats,o=0;o<n.length;o++){var i=Ye(n[o],a[o],t);r.push(i.trans),_.push(i.quats)}return{trans:r,quats:_}}function Ye(e,t,r){var _=[],n=[];for(var a in r)for(var o=r[a],i=o.bone_index,s=o.deform_bone_index,E=0;E<4;E++){var c=4*s+E,l=4*i+E;_[c]=e[l],n[c]=t[l]}return{trans:_=new Float32Array(_),quats:n=new Float32Array(n)}}function Le(e,t,r){var _=e.chain,n=_[_.length-1],a=n.tsr_channel_cache;n.tsr_channel_cache_valid||xa(a);for(var o=_.length-1;o>=0;o--){var i=_[o],s=i.tsr_channel_cache;if(i.tsr_channel_cache_valid)a=s;else{var E=i.tsr_local_rest,c=i.tsr_basis;Ha(E,j),Va(c,j,j),Va(E,j,j),Va(a,j,s),a=s,i.tsr_channel_cache_valid=!0}}var l=i.tsr_channel_cache;t[0]=l[0],t[1]=l[1],t[2]=l[2],t[3]=l[3],r[0]=l[4],r[1]=l[5],r[2]=l[6],r[3]=l[7],mr(r,r)}function Me(e,t,r){var _=t[0],n=t[1],a=(r[1]-n)/(r[0]-_);return a*e+(n-a*_)}function xe(e,t,r,_){var n,a,o,i,s=[],E=[];s[0]=e[0]-t[0],s[1]=e[1]-t[1],E[0]=_[0]-r[0],E[1]=_[1]-r[1],o=_[0]-e[0],(n=Math.abs(s[0]))+(a=Math.abs(E[0]))!=0&&n+a>o&&(t[0]=e[0]-(i=o/(n+a))*s[0],t[1]=e[1]-i*s[1],r[0]=_[0]-i*E[0],r[1]=_[1]-i*E[1])}function ye(e,t,r,_,n){return we(function e(t,r,_,n,a,o,i){var s=t+(r-t)/2,E=we(s,n,a,o,i)-_;return Math.abs(E)<.02?s:E>0?e(t,s,_,n,a,o,i):e(s,r,_,n,a,o,i)}(0,1,e,t[0],r[0],_[0],n[0]),t[1],r[1],_[1],n[1])}function we(e,t,r,_,n){var a=1-e;return t*a*a*a+3*r*a*a*e+3*_*a*e*e+n*e*e*e}function Ue(e,t){te(e,t),re(e)}function Ce(e,t){T.update_transform(e),o.sync_transform(e),Ee(e,0,t,!0)}function De(e,t,r,_){if(_=_||g,n.is_mesh(e)){var a=Fe(e,r);if(a)return Ue(e,_),$(e,a,_),Ce(e,_),!0;var o=Ge(e,r);if(o&&"EMITTER"==o.p_type)return Ue(e,_),function(e,t,r){for(var _=e.scenes_data,n=0;n<_.length;n++)for(var a=_[n].batches,o=0;o<a.length;o++){var i=a[o].particles_data;i&&i.name==t&&ee(0,e.anim_slots[r],i)}}(e,o.name,_),Ce(e,_),!0}var s=J_("name",r,J)||J_("name",r+"_B4W_BAKED",J);if(s){if(Ue(e,_),ce(e,t,s,_))return Ce(e,_),!0;e.anim_slots[_]=null}return i.error('Unsupported object: "'+e.name+'" or animation name: "'+r+'"'),!1}function Fe(e,t){for(var r=0;r<e.vertex_anim.length;r++){var _=e.vertex_anim[r];if(_.name===t)return _}return null}function Ge(e,t){for(var r=e.scenes_data,_=0;_<r.length;_++)for(var n=r[_].batches,a=0;a<n.length;a++){var o=n[a].particles_data;if(o&&o.name===t)return o}return null}function ke(e){for(var t=e.modifiers,r=0;r<t.length;r++){var _=t[r];if("ARMATURE"==_.type)return _.object}return null}t.get_max_bones=function(){return Rn((d.max_vertex_uniform_vectors-50)/4)},t.frame_to_sec=function(e){return e/l.get_framerate()},t.update=function(e){for(var t=0;t<W.length;t++){for(var r=W[t],_=0;_<8;_++)me(r,e,_);r.render.anim_mixing&&(he(r,e),ve(r,e))}for(t=0;t<W.length;t++)for(r=W[t],_=0;_<8&&r.anim_slots.length;_++)Z(r,_)},t.get_all_actions=function(){return J},t.get_anim_names=function(e){var t=[];if(oe(e))for(var r=0;r<e.vertex_anim.length;r++)t.push(e.vertex_anim[r].name);var _=function(e){for(var t=[],r=0;r<J.length;r++){var _=J[r],n=_._render;n.type==A?t.push(_):_._render.type!=O||"MESH"!=e.type&&"WORLD"!=e.type?n.type==P&&"ARMATURE"==e.type?t.push(_):n.type==p&&"SPEAKER"==e.type?t.push(_):n.type==N&&"WORLD"==e.type&&t.push(_):t.push(_)}return t}(e);for(r=0;r<_.length;r++)t.push(_e(_[r].name));if(a.obj_has_particles(e)&&a.obj_has_anim_particles(e)){var n=e.scenes_data;for(r=0;r<n.length;r++)for(var o=n[r].batches,i=0;i<o.length;i++){var s=o[i].particles_data;s&&t.push(s.name)}}return t},t.strip_baked_suffix=_e,t.get_anim_type=function(e,t){var r=e.anim_slots[t];return r?r.type:0},t.apply_def=function(e){for(var t=g,r=e.scenes_data,_=0;_<r.length;_++)for(var n=r[_].batches,a=0;a<n.length;a++){var o=n[a].particles_data;o&&"EMITTER"==o.p_type&&!n[a].forked_batch&&(Ue(e,t),ee(0,e.anim_slots[t],o),Ce(e,t),e.anim_slots[t].behavior=o.cyclic?R:e.anim_behavior_def,t++)}var i=function(e){return e.def_action_slots.slice()}(e);for(_=0;_<i.length;_++){var s=i[_],E=s.name_list,c=s.action;Ue(e,t),ce(e,E,c,t)?(Ce(e,t),e.anim_slots[t].behavior=e.anim_behavior_def,t++):e.anim_slots[t]=null}oe(e)&&(Ue(e,t),$(e,e.vertex_anim[0],t),Ce(e,t),e.anim_slots[t].behavior=e.anim_behavior_def,t++)},t.anim_behavior_bpy_b4w=function(e){switch(e){case"CYCLIC":return R;case"FINISH_RESET":return I;case"FINISH_STOP":return b;default:r.panic("Wrong animation behavior")}},t.get_bpy_material_actions=function(e){for(var t=[],r=e.data.materials,_=0;_<r.length;_++){var n=r[_],a=n.node_tree;a&&ae(a,t,[n.name])}return t},t.get_bpy_world_material_actions=function(e){var t=[],r=e.node_tree;return r&&ae(r,t,[e.name]),t},t.init_action_slot=ne,t.play=function(e,t,r){se(e.anim_slots,r,function(e){e.play=!0,e.finish_callback=t||null,e.exec_finish_callback=!1}),e.render.anim_mixing&&de(e)},t.stop=function(e,t){se(e.anim_slots,t,function(e){e.play=!1,e.finish_callback=null,e.exec_finish_callback=!1})},t.is_play=function(e,t){var r=e.anim_slots;if(t==h){for(var _=0;_<8;_++)if(r[_]&&r[_].play)return!0}else{var n=r[t];if(n)return n.play}return!1},t.set_frame=ie,t.set_first_frame=function(e,t){se(e.anim_slots,t=t||g,function(r){ie(e,r.start,t)})},t.get_current_frame_float=function(e,t){var r=e.anim_slots[t];return r&&r.current_frame_float?r.current_frame_float:0},t.is_cyclic=function(e,t){var r=e.anim_slots[t];return r&&r.behavior==R},t.set_behavior=function(e,t,r){se(e.anim_slots,r,function(e){e.behavior=t})},t.get_behavior=function(e,t){var r=e.anim_slots[t];return r&&r.behavior},t.apply_smoothing=function(e,t,r,_){se(e.anim_slots,_,function(e){e.trans_smooth_period=t||0,e.quat_smooth_period=r||0})},t.remove_slot_animation=function(e,t){if(t==h)for(var r=0;r<8;r++)e.anim_slots[r]=null;else e.anim_slots[t]=null;e.render.anim_mixing&&fe(e,t)},t.update_object_animation=Ee,t.obj_is_animatable=function(e){if("ARMATURE"==e.type)return!0;if(e.armobj)return!0;if("WORLD"==e.type)return!0;for(var t=0;t<e.def_action_slots.length;t++){var r=e.def_action_slots[t].action._render.type;if(r==A||r==P||r==p&&"SPEAKER"==e.type||r==v&&"LAMP"==e.type||r==O&&"MESH"==e.type)return!0}return!(!a.obj_has_particles(e)||!a.obj_has_anim_particles(e))||!("MESH"!=e.type||!e.vertex_anim.length)},t.bpy_mesh_empty_is_animatable=function(e){if(ke(e))return!0;if(e._def_action_slots)for(var t=0;t<e._def_action_slots.length;t++){var r=e._def_action_slots[t].action._render.type;if(r==A||r==O&&"MESH"==e.type)return!0}return!(!a.bpy_obj_has_particles(e)||!a.bpy_obj_has_anim_particles(e))||!("MESH"!=e.type||!e.data.b4w_vertex_anim.length)},t.is_animated=function(e){return Boolean(e.anim_slots.length)},t.init_action_cache=function(e,t,r,_,a){if(r)var o=J_("uuid",r,J);else o=J_("name",_,J)||J_("name",_+"_B4W_BAKED",J);if(o){te(e,a),re(e);var s=o.frame_range;if(s[0]>s[1])return i.warn('Incompatible action "'+o.name+'" has been applied to object "'+e.name+'"'),!1;var E=o._render;switch(E.type){case P:if(n.is_armature(e)){var c=le(e,t,o);c||Te(e,t,o,c=Re(o,e.render.bone_pointers)),ue(e,a,o,c)}break;case A:var l=E.params.tsr;if(!l)return i.warn('Incompatible action "'+o.name+'" has been applied to object "'+e.name+'"'),!1;var T=le(e,t,o);T||Te(e,t,o,T=pe(0,o,l))}}},t.delete_cached_anim_data_by_mat=function(e,t){for(var r=e.action_anim_cache,_=[],n=0;n<r.length;n+=3)(r[n]._render.type!=O||null!==r[n+1]&&r[n+1].split("%join%")[0]!=t)&&_.push(r[n],r[n+1],r[n+2]);e.action_anim_cache=_},t.calc_pose_data=Ie,t.extract_skinned_pose_data=Ye,t.append_action=function(e){var t=new RegExp(/pose.bones\[\".+\"\]/g),_=ba(),n=function(e,n,a,o,i){if(a.search(t)>-1)var s=n,E=a.split('"')[1],c=_;else s=e,8==i?(E="tsr",c=_):i>1?(E=a,c=new Float32Array(i)):(E=a,c=0);return s[E]||(s[E]=function(e,t){if("object"==typeof t&&t.length)for(var _=t.length,n=new Float32Array(e*_),a=0;a<e;a++)for(var o=0;o<_;o++)n[a*_+o]=t[o];else if("number"==typeof t)for(n=new Float32Array(e),a=0;a<e;a++)n[a]=t;else r.panic("Wrong storage default value");return n}(o,c)),s[E]},a=function(e,t){if(e.indexOf("location")>-1)var r=0,_=t;else e.indexOf("rotation_quaternion")>-1?(r=4,_=0==t?3:t-1):e.indexOf("scale")>-1?(r=3,_=0):(r=0,_=t);return r+_},o=function(e,t){for(var r=0;r<t;r++){var _=e.subarray(8*r+4,8*r+8);mr(_,_)}},i=e._render={type:0,num_pierced:0,pierce_step:0,params:null,bones:null,bflags:null,channels_mask:new Int8Array(8)};i.pierce_step=1/u.frame_steps;var s=e.fcurves,E={},c={},l=0;for(var T in s){var d=s[T];for(var f in d){var S=d[f],m=S._pierced_points;l||(l=m.length);for(var g=n(E,c,T,l,S.num_channels),h=g.length/l,R=a(T,0|f),I=0;I<l;I++)g[I*h+R]=m[I]}}if(Vn(E)){for(var b in E)"tsr"==b&&o(E[b],l);i.params=E}if(Vn(c)){for(var D in c)o(c[D],l);i.bones=c}i.num_pierced=l,i.bflags=e._bflags,"tsr"in E&&function(e,t){for(var r in t[0]=t[1]=t[2]=0,e)"location"==r?t[0]=1:"rotation_quaternion"==r?t[1]=1:"scale"==r&&(t[2]=1)}(s,i.channels_mask),("color"in E||"energy"in E)&&function(e,t){for(var r in t[0]=t[1]=0,e)"energy"==r?t[0]=1:"color"==r&&(t[1]=1)}(s,i.channels_mask),("light_settings.environment_energy"in E||"horizon_color"in E||"zenith_color"in E||"mist_settings.intensity"in E||"mist_settings.depth"in E||"mist_settings.start"in E||"mist_settings.height"in E||"b4w_fog_color"in E)&&function(e,t){for(var r in t[Y]=t[L]=t[M]=0,t[x]=t[y]=t[w]=0,t[U]=t[C]=0,e)"light_settings.environment_energy"==r?t[Y]=1:"horizon_color"==r?t[L]=1:"zenith_color"==r?t[M]=1:"mist_settings.intensity"==r?t[x]=1:"mist_settings.depth"==r?t[y]=1:"mist_settings.start"==r?t[w]=1:"mist_settings.height"==r?t[U]=1:"b4w_fog_color"==r&&(t[C]=1)}(s,i.channels_mask),function(e){var t=e._render;t.type=t.bones?P:t.params?"volume"in t.params||"pitch"in t.params?p:function(e){var t=e._render.params;if(t)for(var r in t)if(-1!=r.indexOf("nodes"))return!0;return!1}(e)?O:function(e){if(e._render.params){var t=e.fcurves;for(var r in t)if("color"==r&&!t[r][3])return!0;if("energy"==r)return!0}return!1}(e)?v:function(e){var t=e._render.params;return"light_settings.environment_energy"in t||"horizon_color"in t||"zenith_color"in t||"mist_settings.intensity"in t||"mist_settings.depth"in t||"mist_settings.start"in t||"mist_settings.height"in t||"b4w_fog_color"in t}(e)?N:function(e){if(e._render.params){var t=e.fcurves;for(var r in t)if("location"==r||"rotation_quaternion"==r||"scale"==r)return!0}return!1}(e)?A:0:0}(e),J.push(e)},t.get_approx_curve_length=function(e,t){return(t-e)*u.frame_steps+1},t.approximate_curve=function(e,t,_,n,a,o){for(var i=new Float32Array(2),s=new Float32Array(2),E=new Float32Array(2),c=new Float32Array(2),l=t[1],T=t[2],d=t[e.last_frame_offset+1],f=t[e.last_frame_offset+2],P=0,A=0,S=null,p=a;p<=o;p++)if(p<l)for(var m=0;m<u.frame_steps;m++)_[P++]=T;else if(p>d)for(m=0;m<u.frame_steps;m++)_[P++]=f;else{var O=t[A],v=3;0===O&&(v+=2),0===S&&(v+=2);var N=2===O?0:1;if(t[A+1]==t[A+v+1]){S=O,A+=v;continue}var g=0;if(p==t[A+1]&&(N&&(n[P]=1),_[P]=t[A+2],P++,g++),p==d)for(m=g;m<u.frame_steps;m++)_[P++]=f;else for(i[0]=t[A+1],i[1]=t[A+2],0!==O?(s[0]=0,s[1]=0):0===S?(s[0]=t[A+5],s[1]=t[A+6]):(s[0]=t[A+3],s[1]=t[A+4]),0!==O?(E[0]=0,E[1]=0):(E[0]=t[A+v+3],E[1]=t[A+v+4]),c[0]=t[A+v+1],c[1]=t[A+v+2],m=g;m<u.frame_steps;m++){var h=p+m/u.frame_steps;switch(O){case 0:xe(i,s,E,c),N&&(n[P]=1),_[P]=ye(h,i,s,E,c),P++;break;case 1:N&&(n[P]=1),_[P]=Me(h,i,c),P++;break;case 2:N&&(n[P]=1),_[P]=t[A+2],P++;break;default:r.panic("Unknown keyframe interpolation mode: "+O)}}p+1==t[A+v+1]&&(S=O,A+=v)}},t.apply=De,t.apply_by_uuid=function(e,t,r,_){_=_||g;var n=J_("uuid",r,J);if(n){if(Ue(e,_),ce(e,t,n,_))return Ce(e,_),!0;e.anim_slots[_]=null}return i.error('Unsupported object: "'+e.name+'" or animation uuid: "'+r+'"'),!1},t.validate_action_by_name=function(e,t){var r=J_("name",t,J)||J_("name",t+"_B4W_BAKED",J);if(r){if(0==r._render.type)return!1}else if(!(Ge(e,t)||n.is_mesh(e)&&Fe(e,t)))return!1;return!0},t.get_slot_num_by_anim=function(e,t){for(var r=e.anim_slots,_=0;_<r.length;_++){var n=r[_];if(n&&_e(n.animation_name)==_e(t))return _}return-1},t.get_anim_by_slot_num=function(e,t){var r=e.anim_slots[t];return r&&r.animation_name?_e(r.animation_name):null},t.remove=function(e){e.anim_slots.length=0;var t=W.indexOf(e);-1!=t&&W.splice(t,1)},t.remove_actions=function(e){for(var t=J.length-1;t>=0;t--)J[t]._data_id==e&&J.splice(t,1)},t.apply_to_first_empty_slot=function(e,t){if(!e.anim_slots.length)return De(e,null,t,g)?g:-1;for(var r=0;r<e.anim_slots.length;r++)if(!e.anim_slots[r])return De(e,null,t,r)?r:-1},t.set_skel_mix_factor=function(e,t,r,_){var n=e.render;n.anim_mix_factor_change_speed=(t-n.anim_mix_factor)/r,n.anim_destination_mix_factor=t,n.anim_mix_cb&&n.anim_mix_cb(),n.anim_mix_cb=_},t.mix_from_cur_pos=function(e,t,r,_){var n=e.render;n.blend_skel_slots[1]=t,n.anim_mix_factor_change_speed=1/r,n.anim_destination_mix_factor=1,n.anim_mix_cb&&n.anim_mix_cb(),n.anim_mix_cb=_,n.trans_curr=null,n.quats_curr=null,n.mix_with_current=!0},t.set_speed=function(e,t,r){se(e.anim_slots,r,function(e){e.speed=t})},t.get_speed=function(e,t){return e.anim_slots[t].speed},t.get_anim_start_frame=function(e,t){return e.anim_slots[t].start},t.get_anim_length=function(e,t){return e.anim_slots[t].length},t.cleanup=function(){W.length=0,J.length=0},t.fcurve_replace_euler_by_quat=function(e){var t=(e[0]||e[1]||e[2])._pierced_points.length,r=H,_=F,n=Boolean(e[0]);n||(e[0]={_pierced_points:new Float32Array(t),num_channels:8});var a=Boolean(e[1]);a||(e[1]={_pierced_points:new Float32Array(t),num_channels:8});var o=Boolean(e[2]);o||(e[2]={_pierced_points:new Float32Array(t),num_channels:8}),e[3]={_pierced_points:new Float32Array(t),num_channels:8};for(var i=0;i<t;i++)_[0]=n?e[0]._pierced_points[i]:0,_[1]=a?e[1]._pierced_points[i]:0,_[2]=o?e[2]._pierced_points[i]:0,rn(_,r),e[0]._pierced_points[i]=r[3],e[1]._pierced_points[i]=r[0],e[2]._pierced_points[i]=r[1],e[3]._pierced_points[i]=r[2]},t.get_bpy_armobj=ke,t.slot_by_anim_type=function(e,t){for(var r=7,_=0,n=0;n<J.length;n++){var a=J[n];if(a.name==t){_=a._render.type;break}}if(0==_)if(Fe(e,t))_=S;else{var o=Ge(e,t);o&&"EMITTER"==o.p_type&&(_=m)}for(n=0;n<8;n++){var i=e.anim_slots[n];if(i){if(i.type==_)return n}else n<r&&(r=n)}return r}});function hs(){return{name:"",type:"",uuid:"",use_nodes:!1,node_tree:null,texture_slots:[],blend_mode:"",use_shadeless:!1,use_transparency:!1,use_backface_culling:!1,use_tangent_shading:!1,use_orco_tex_coord:!1,use_vertex_color_paint:!1,use_double_sided_lighting:!1,do_not_render:!1,render_above_all:!1,is_lens_flares:!1,is_wettable:!1,is_refractive:!1,refr_bump:0,pass_index:0,offset_z:0,diffuse_shader:"",diffuse_color:new Float32Array(3),diffuse_intensity:0,diffuse_toon_size:0,diffuse_toon_smooth:0,roughness:0,diffuse_fresnel:0,diffuse_fresnel_factor:0,darkness:0,alpha:0,specular_shader:"",specular_color:new Float32Array(3),specular_intensity:0,specular_toon_size:0,specular_toon_smooth:0,specular_hardness:0,specular_ior:0,specular_slope:0,specular_alpha:0,emit:0,ambient:0,water_settings:{is_water:!1,shore_smoothing:!1,absorb_factor:0,foam_factor:0,shallow_col:new Float32Array(3),shore_col:new Float32Array(3),shallow_col_fac:0,shore_col_fac:0,fog_color:new Float32Array(3),fog_density:0,sss_strength:0,sss_width:0,norm_uv_velocity:0,is_dynamic:!1,waves_height:0,waves_length:0,dst_noise_scale0:0,dst_noise_scale1:0,dst_noise_freq0:0,dst_noise_freq1:0,dir_min_shore_fac:0,dir_freq:0,dir_noise_scale:0,dir_noise_freq:0,dir_min_noise_fac:0,dst_min_fac:0,waves_hor_fac:0,is_generated_mesh:!1,num_cascads:0,num_subdivs:0,detailed_dist:0,enable_caust:!1,caust_scale:0,caust_brightness:0},terrain_settings:{is_terrain:!1,dynamic_grass_size:"",dynamic_grass_color:""},raytrace_mirror:{reflect_factor:0,fresnel:0,fresnel_factor:0},halo_settings:{size:0,hardness:0,rings_color:new Float32Array(3),lines_color:new Float32Array(3),ring_count:0,line_count:0,star_tip_count:0,is_sky_stars:!1,stars_blend_height:0,stars_min_height:0},physics_settings:{use_coll_physics:!1,use_ghost:!1,friction:0,elasticity:0,collision_id:"",collision_margin:0,collision_group:0,collision_mask:0}}}function Rs(){var e=hs();return e.name="DEFAULT",e.type="SURFACE",e.uuid=zn(),e.use_nodes=!1,e.node_tree=null,e.texture_slots=[],e.blend_mode="OPAQUE",e.use_shadeless=!1,e.use_transparency=!1,e.use_backface_culling=!0,e.use_vertex_color_paint=!1,e.use_double_sided_lighting=!1,e.render_above_all=!1,e.is_refractive=!1,e.refr_bump=0,e.pass_index=0,e.offset_z=0,e.diffuse_shader="LAMBERT",e.diffuse_color.set([.8,.8,.8]),e.diffuse_intensity=.8,e.alpha=1,e.specular_shader="COOKTORR",e.specular_color.set([1,1,1]),e.specular_intensity=.5,e.specular_hardness=50,e.specular_alpha=1,e.emit=0,e.ambient=1,e.water_settings.is_water=!1,e.terrain_settings.is_terrain=!1,e.raytrace_mirror.reflect_factor=0,e.raytrace_mirror.fresnel=0,e.raytrace_mirror.fresnel_factor=1.25,e.physics_settings.use_coll_physics=!1,e}function Is(e,t){t.name=e.name,t.type=e.type,t.uuid=e.uuid,t.use_nodes=e.use_nodes,t.node_tree=e.node_tree,t.texture_slots=e.texture_slots,t.blend_mode=e.game_settings.alpha_blend,t.use_shadeless=e.use_shadeless,t.use_transparency=e.use_transparency,t.use_backface_culling=e.game_settings.use_backface_culling,t.use_tangent_shading=e.use_tangent_shading,t.use_orco_tex_coord=e.use_orco_tex_coord,t.use_vertex_color_paint=e.use_vertex_color_paint,t.use_double_sided_lighting=e.b4w_double_sided_lighting,t.do_not_render=e.b4w_do_not_render,t.render_above_all=e.b4w_render_above_all,t.is_lens_flares=e.b4w_lens_flares,t.is_wettable=e.b4w_wettable,t.is_refractive=e.b4w_refractive,t.refr_bump=e.b4w_refr_bump,t.pass_index=e.pass_index,t.offset_z=e.offset_z,t.diffuse_shader=e.diffuse_shader,t.diffuse_color.set(e.diffuse_color),t.diffuse_intensity=e.diffuse_intensity,t.diffuse_toon_size=e.diffuse_toon_size,t.diffuse_toon_smooth=e.diffuse_toon_smooth,t.roughness=e.roughness,t.diffuse_fresnel=e.diffuse_fresnel,t.diffuse_fresnel_factor=e.diffuse_fresnel_factor,t.darkness=e.darkness,t.alpha=e.alpha,t.specular_shader=e.specular_shader,t.specular_color.set(e.specular_color),t.specular_intensity=e.specular_intensity,t.specular_toon_size=e.specular_toon_size,t.specular_toon_smooth=e.specular_toon_smooth,t.specular_hardness=e.specular_hardness,t.specular_ior=e.specular_ior,t.specular_slope=e.specular_slope,t.specular_alpha=e.specular_alpha,t.emit=e.emit,t.ambient=e.ambient;var r=t.water_settings;r.is_water=e.b4w_water,r.shore_smoothing=e.b4w_water_shore_smoothing,r.absorb_factor=e.b4w_water_absorb_factor,r.foam_factor=e.b4w_foam_factor,r.shallow_col.set(e.b4w_shallow_water_col),r.shore_col.set(e.b4w_shore_water_col),r.shallow_col_fac=e.b4w_shallow_water_col_fac,r.shore_col_fac=e.b4w_shore_water_col_fac,r.fog_color.set(e.b4w_water_fog_color),r.fog_density=e.b4w_water_fog_density,r.sss_strength=e.b4w_water_sss_strength,r.sss_width=e.b4w_water_sss_width,r.norm_uv_velocity=e.b4w_water_norm_uv_velocity,r.is_dynamic=e.b4w_water_dynamic,r.waves_height=e.b4w_waves_height,r.waves_length=e.b4w_waves_length,r.dst_noise_scale0=e.b4w_water_dst_noise_scale0,r.dst_noise_scale1=e.b4w_water_dst_noise_scale1,r.dst_noise_freq0=e.b4w_water_dst_noise_freq0,r.dst_noise_freq1=e.b4w_water_dst_noise_freq1,r.dir_min_shore_fac=e.b4w_water_dir_min_shore_fac,r.dir_freq=e.b4w_water_dir_freq,r.dir_noise_scale=e.b4w_water_dir_noise_scale,r.dir_noise_freq=e.b4w_water_dir_noise_freq,r.dir_min_noise_fac=e.b4w_water_dir_min_noise_fac,r.dst_min_fac=e.b4w_water_dst_min_fac,r.waves_hor_fac=e.b4w_water_waves_hor_fac,r.is_generated_mesh=e.b4w_generated_mesh,r.num_cascads=e.b4w_water_num_cascads,r.num_subdivs=e.b4w_water_subdivs,r.detailed_dist=e.b4w_water_detailed_dist,r.enable_caust=e.b4w_water_enable_caust,r.caust_scale=e.b4w_water_caust_scale,r.caust_brightness=e.b4w_water_caust_brightness;var _=t.terrain_settings;_.is_terrain=e.b4w_terrain,_.dynamic_grass_size=e.b4w_dynamic_grass_size,_.dynamic_grass_color=e.b4w_dynamic_grass_color;var n=t.raytrace_mirror;n.reflect_factor=e.raytrace_mirror.reflect_factor,n.fresnel=e.raytrace_mirror.fresnel,n.fresnel_factor=e.raytrace_mirror.fresnel_factor;var a=t.halo_settings;a.size=e.halo.size,a.hardness=e.halo.hardness,a.rings_color.set(e.halo.b4w_halo_rings_color),a.lines_color.set(e.halo.b4w_halo_lines_color),a.ring_count=e.halo.ring_count,a.line_count=e.halo.line_count,a.star_tip_count=e.halo.star_tip_count,a.is_sky_stars=e.b4w_halo_sky_stars,a.stars_blend_height=e.b4w_halo_stars_blend_height,a.stars_min_height=e.b4w_halo_stars_min_height;var o=t.physics_settings;o.use_coll_physics=e.b4w_collision,o.use_ghost=e.b4w_use_ghost,o.friction=e.physics.friction,o.elasticity=e.physics.elasticity,o.collision_id=e.b4w_collision_id,o.collision_margin=e.b4w_collision_margin,o.collision_group=e.b4w_collision_group,o.collision_mask=e.b4w_collision_mask}function bs(e){var t=e;t.name=e.name,t.type=e.type,t.uuid=e.uuid,t.use_nodes=e.use_nodes,t.node_tree=e.node_tree,t.texture_slots=e.texture_slots.slice(),t.blend_mode=e.blend_mode,t.use_shadeless=e.use_shadeless,t.use_transparency=e.use_transparency,t.use_backface_culling=e.use_backface_culling,t.use_tangent_shading=e.use_tangent_shading,t.use_orco_tex_coord=e.use_orco_tex_coord,t.use_vertex_color_paint=e.use_vertex_color_paint,t.use_double_sided_lighting=e.use_double_sided_lighting,t.do_not_render=e.do_not_render,t.render_above_all=e.render_above_all,t.is_lens_flares=e.is_lens_flares,t.is_wettable=e.is_wettable,t.is_refractive=e.is_refractive,t.refr_bump=e.refr_bump,t.pass_index=e.pass_index,t.offset_z=e.offset_z,t.diffuse_shader=e.diffuse_shader,t.diffuse_color.set(e.diffuse_color),t.diffuse_intensity=e.diffuse_intensity,t.diffuse_toon_size=e.diffuse_toon_size,t.diffuse_toon_smooth=e.diffuse_toon_smooth,t.roughness=e.roughness,t.diffuse_fresnel=e.diffuse_fresnel,t.diffuse_fresnel_factor=e.diffuse_fresnel_factor,t.darkness=e.darkness,t.alpha=e.alpha,t.specular_shader=e.specular_shader,t.specular_color.set(e.specular_color),t.specular_intensity=e.specular_intensity,t.specular_toon_size=e.specular_toon_size,t.specular_toon_smooth=e.specular_toon_smooth,t.specular_hardness=e.specular_hardness,t.specular_ior=e.specular_ior,t.specular_slope=e.specular_slope,t.specular_alpha=e.specular_alpha,t.emit=e.emit,t.ambient=e.ambient;var r=e.water_settings,_=t.water_settings;_.is_water=r.is_water,_.shore_smoothing=r.shore_smoothing,_.absorb_factor=r.absorb_factor,_.foam_factor=r.foam_factor,_.shallow_col.set(r.shallow_col),_.shore_col.set(r.shore_col),_.shallow_col_fac=r.shallow_col_fac,_.shore_col_fac=r.shore_col_fac,_.fog_color=r.fog_color,_.fog_density=r.fog_density,_.sss_strength=r.sss_strength,_.sss_width=r.sss_width,_.norm_uv_velocity=r.norm_uv_velocity,_.is_dynamic=r.is_dynamic,_.waves_height=r.waves_height,_.waves_length=r.waves_length,_.dst_noise_scale0=r.dst_noise_scale0,_.dst_noise_scale1=r.dst_noise_scale1,_.dst_noise_freq0=r.dst_noise_freq0,_.dst_noise_freq1=r.dst_noise_freq1,_.dir_min_shore_fac=r.dir_min_shore_fac,_.dir_freq=r.dir_freq,_.dir_noise_scale=r.dir_noise_scale,_.dir_noise_freq=r.dir_noise_freq,_.dir_min_noise_fac=r.dir_min_noise_fac,_.dst_min_fac=r.dst_min_fac,_.waves_hor_fac=r.waves_hor_fac,_.is_generated_mesh=r.is_generated_mesh,_.num_cascads=r.num_cascads,_.num_subdivs=r.num_subdivs,_.detailed_dist=r.detailed_dist,_.enable_caust=r.enable_caust,_.caust_scale=r.caust_scale,_.caust_brightness=r.caust_brightness;var n=e.terrain_settings,a=t.terrain_settings;a.is_terrain=n.is_terrain,a.dynamic_grass_size=n.dynamic_grass_size,a.dynamic_grass_color=n.dynamic_grass_color;var o=e.raytrace_mirror,i=t.raytrace_mirror;i.reflect_factor=o.reflect_factor,i.fresnel=o.fresnel,i.fresnel_factor=o.fresnel_factor;var s=e.halo_settings,E=t.halo_settings;E.size=s.size,E.hardness=s.hardness,E.rings_color.set(s.rings_color),E.lines_color.set(s.lines_color),E.ring_count=s.ring_count,E.line_count=s.line_count,E.star_tip_count=s.star_tip_count,E.is_sky_stars=s.is_sky_stars,E.stars_blend_height=s.stars_blend_height,E.stars_min_height=s.stars_min_height;var c=e.physics_settings,l=t.physics_settings;return l.use_coll_physics=c.use_coll_physics,l.use_ghost=c.use_ghost,l.friction=c.friction,l.elasticity=c.elasticity,l.collision_id=c.collision_id,l.collision_margin=c.collision_margin,l.collision_group=c.collision_group,l.collision_mask=c.collision_mask,t}var Ys,Ls=A("__nla",function(e,t){var r=gs(e),_=Ms(e),n=os(e),a=ga(e),o=ps(e),i=Ss(e),s=ys(e),E=ri(e),c=[],l=-1,T=1e-6;function u(e,t,r){for(var _=0;_<e.length;_++){var n=e[_];t.frame_start>n.frame_end||t.frame_end<n.frame_start?(a.warn("NLA: Strip is out of scene range: "+r+" ["+n.frame_start+":"+n.frame_end+"]"),e.splice(_,1),_--):n.anim_name||"CLIP"!=n.type||(a.warn('NLA: no action in strip for object "'+r+'".'),e.splice(_,1),_--)}}function d(e,t){for(var r=0;r<e.length;r++){for(var _=e[r],n=t.frame_start,a=t.frame_end+1,o=0;o<e.length;o++){var i=e[o];_.anim_slot==i.anim_slot&&(i.frame_end<=_.frame_start&&(n=_.frame_start),i.frame_start>=_.frame_end&&(a=Math.min(a,i.frame_start)))}_.ext_frame_start=n,_.ext_frame_end=a,f(_)}}function f(e){e.action_frame_final=e.repeat%1==0?e.action_frame_end:e.action_frame_start+e.repeat%1*(e.action_frame_end-e.action_frame_start)}function P(e,t){for(var _=r.get_all_actions(),n=[],a=0,o=0;o<e.length;o++){var i=e[o];if(""!=i.anim_uuid)var s=J_("uuid",i.anim_uuid,_);else{var E=i.anim_name;s=J_("name",E,_)||J_("name",E+"_B4W_BAKED",_)}if(s){var c=s.fcurves,l=[];for(var T in c)l.push(T);n.push(l)}}for(o=0;o<n.length;o++){for(var u=!1,d=0;d<o;d++)if(ia(n[o],n[d])){e[o].anim_slot=e[d].anim_slot,u=!0;break}u||(e[o].anim_slot=t+a++)}return a}function A(e,t,r){if(e.animation_data){var _=e.animation_data.nla_tracks;if(_)for(var n=0;n<_.length;n++)_[n].name_list=r,t.push(_[n])}var a=e.nodes;for(n=0;n<a.length;n++){var o=a[n];if(o.node_group){var i=o.node_group.node_tree;if(i){var s=r.slice();s.push(o.name),A(i,t,s)}}}}function S(e,t){e.is_stopped=!0,e.frame_offset-=t-e.range_end,e.user_callback&&e.user_callback()}function p(e,t){return e.user_callback&&e.user_callback(),x(e.range_start,t),e.rewinded_to_start=!0,g(e,t)}function m(e,t,r){for(var _=0;_<e.objects.length;_++){var n=e.objects[_];if(n)for(var a=0;a<n.length;a++){for(var o=n[a],i=o.nla_events,s=0;s<i.length;s++)"SOUND"==(E=i[s]).type&&t<e.last_frame-T&&(E.scheduled=!1);for(s=0;s<i.length;s++){var E;switch((E=i[s]).type){case"CLIP":if(E.ext_frame_start<=t&&t<E.ext_frame_end&&!E.scheduled){for(h(o,E),_=0;_<i.length;_++)i[_]!=E&&i[_].anim_slot==E.anim_slot&&(i[_].scheduled=!1);E.scheduled=!0}E.scheduled&&R(o,E,t);break;case"SOUND":(t<e.last_frame-T||e.last_frame<E.frame_start)&&E.frame_start<=t&&t<E.frame_end&&(E.scheduled||(b(o,E,t),E.scheduled=!0)),e.last_frame<E.frame_end&&E.frame_end<=t&&E.scheduled&&(E.scheduled=!1)}}}}}function O(e,t,r){for(var _=0;_<t.textures.length;_++){var n=t.textures[_];if(n.video_file||n.seq_video){var a=s.video_get_current_frame(n),o=N(r,n),i=s.video_get_start_frame(n),E=!1,c=!1;if((t.force_update||t.rewinded_to_start)&&(c=!0),!t.is_stopped){var l=(f=v(r,d=n),d.frame_offset<=f&&f<=d.frame_offset+s.video_get_duration(d)),T=s.video_is_played(n);n.use_cyclic&&o==i&&(c=!0),T||a==o||(c=!0),l&&!T?s.play_video(n):l&&T?E=!0:!l&&T&&(n.video_file&&a<o?E=!0:s.pause_video(n))}if(c)s.set_frame_video(n.video_tex_name,o,n.vtex_data_id),n.seq_video&&(n.seq_last_discrete_mark=s.seq_video_get_discrete_timemark(n,e));else if(E&&s.video_update_is_available(n))if(n.video_file)s.update_video_texture(n);else{var u=s.seq_video_get_discrete_timemark(n,e);u!=n.seq_last_discrete_mark&&(n.seq_cur_frame=o,s.update_seq_video_texture(n)),n.seq_last_discrete_mark=u}}}var d,f}function v(e,t){var r=Math.round(e)-t.frame_start;return t.use_cyclic&&(r%=t.frame_duration)<0&&(r+=t.frame_duration),t.frame_offset+r}function N(e,t){var r=Un(v(e,t),t.frame_offset,t.frame_offset+s.video_get_duration(t)-1);return t.seq_video&&(r=s.video_frame_to_seq_frame(t,r))==t.seq_movie_length&&r--,r}function g(e,t){var r=(t-l)*E.get_framerate()+e.frame_offset;return r>e.frame_start?(r-=e.frame_start,e.cyclic&&(r%=e.frame_end-e.frame_start+1),r+=e.frame_start):r=e.frame_start,r}function h(e,t,_,n){var a=t.name_list;""!=t.anim_uuid?r.apply_by_uuid(e,a,t.anim_uuid,t.anim_slot):r.apply(e,a,t.anim_name,t.anim_slot),r.set_behavior(e,r.AB_FINISH_STOP,t.anim_slot);var o=I(t.frame_start,t);r.set_frame(e,o,t.anim_slot)}function R(e,t,_,n){var a=I(_,t),o=r.get_current_frame_float(e,t.anim_slot);Math.abs(a-o)>T&&r.set_frame(e,a,t.anim_slot)}function I(e,t){if((e=Un(e,t.frame_start,t.frame_end))==t.frame_end)var r=t.action_frame_final;else r=t.action_frame_start+(e-t.frame_start)/t.scale%(t.action_frame_end-t.action_frame_start);return t.use_reverse&&(r=t.action_frame_end-r+t.action_frame_start),r}function b(e,t,r){var _=(t.frame_start-r)/E.get_framerate(),n=(t.frame_end-t.frame_start)/E.get_framerate();i.play(e,_,n)}function Y(e,t){for(var r=[],_=0;_<e.length;_++){var n=e[_],a=n.strips;if(a)for(var o=0;o<a.length;o++){var i=a[o],s={type:"CLIP",frame_start:0,frame_end:0,scheduled:!1,paused:!1,anim_name:"",anim_uuid:"",anim_slot:0,name_list:null,action_frame_start:0,action_frame_end:0,ext_frame_start:0,ext_frame_end:0,use_reverse:!1,scale:1,repeat:1,action_frame_final:0};s.type=i.type,s.frame_start=i.frame_start,s.frame_end=i.frame_end,s.anim_slot=t,s.action_frame_start=i.action_frame_start,s.action_frame_end=i.action_frame_end,s.use_reverse=i.use_reverse,s.scale=i.scale,s.repeat=i.repeat,i.action&&(s.anim_name=i.action.name,s.anim_uuid=i.action.uuid,s.name_list=n.name_list),r.push(s)}}return r}function L(e){return!("SPEAKER"!=e.type&&"LAMP"!=e.type||!e.data.animation_data||!e.data.animation_data.nla_tracks.length)}function M(e,t){if(e.animation_data){var r=e.animation_data.nla_tracks;if(r&&r.length)return!0}for(var _=e.nodes,n=0;n<_.length;n++){var a=_[n];if(a.node_group){var o=a.node_group.node_tree;o&&M(o,t)}}return!1}function x(e,t){var r=o.get_active();if(r._nla){var _=g(r._nla,t);r._nla.frame_offset-=_-e,r._nla.force_update=!0}}t.update_object=function(e,t){var r=function(e){for(var t=null,r=e.scenes_data.length-1;r>=0;r--){var _=e.scenes_data[r];if(_.scene.b4w_use_nla&&(t=_,_.scene._is_main))break}return t}(t);if(r){r.obj_has_nla_on_scene=!0;var _=0,a=e.animation_data;if(a&&a.nla_tracks.length){var o=a.nla_tracks;(n.is_armature(t)||n.is_camera(t)||n.is_mesh(t)||n.is_empty(t)||n.is_line(t)||n.is_lamp(t)||n.is_speaker(t)||n.is_world(t))&&(c=Y(o,_)).length&&(t.nla_events=t.nla_events.concat(c),_++)}if(L(e)&&(c=Y(o=e.data.animation_data.nla_tracks,_)).length&&(t.nla_events=t.nla_events.concat(c),_++),n.is_mesh(t))for(var i=t.materials,s=0;s<i.length;s++){var E=i[s];E.use_nodes&&E.node_tree&&(A(E.node_tree,o=[],[E.name]),(c=Y(o,_)).length&&(_+=P(c,_),t.nla_events=t.nla_events.concat(c)))}if(n.is_world(t)){var c;e.use_nodes&&e.node_tree&&(A(e.node_tree,o=[],[e.name]),(c=Y(o,_)).length&&(_+=P(c,_),t.nla_events=t.nla_events.concat(c)))}else{for(s=0;s<e.particle_systems.length;s++){var l=e.particle_systems[s],T=l.settings;"EMITTER"==T.type&&T.b4w_allow_nla&&((d={type:"CLIP",frame_start:0,frame_end:0,scheduled:!1,paused:!1,anim_name:"",anim_uuid:"",anim_slot:0,name_list:null,action_frame_start:0,action_frame_end:0,ext_frame_start:0,ext_frame_end:0,use_reverse:!1,scale:1,repeat:1,action_frame_final:0}).type="CLIP",d.frame_start=r.scene.frame_start,d.frame_end=r.scene.frame_end+1,d.anim_name=l.name,d.anim_slot=_,d.action_frame_start=d.frame_start,d.action_frame_end=d.frame_end,t.nla_events.push(d),_++)}var u=_+1;for(s=0;s<t.vertex_anim.length;s++){var d,f=t.vertex_anim[s];f.allow_nla&&(_=u,(d={type:"CLIP",frame_start:0,frame_end:0,scheduled:!1,paused:!1,anim_name:"",anim_uuid:"",anim_slot:0,name_list:null,action_frame_start:0,action_frame_end:0,ext_frame_start:0,ext_frame_end:0,use_reverse:!1,scale:1,repeat:1,action_frame_final:0}).type="CLIP",d.frame_start=f.frame_start,d.frame_end=f.frame_end,d.anim_name=f.name,d.anim_slot=_,d.action_frame_start=d.frame_start,d.action_frame_end=d.frame_end,t.nla_events.push(d))}}}},t.update_scene=function(e,t,r){e._nla||(e._nla={frame_start:e.frame_start,frame_end:e.frame_end,frame_offset:0,last_frame:-1,range_end:e.frame_end,range_start:e.frame_start,user_callback:null,cyclic:t,objects:[],textures:[],scene_name:e.name,is_stopped:!1,force_update:!1,rewinded_to_start:!0},c.push(e._nla));for(var n=e._nla,a=_.get_scene_objs_derived(e,"ALL",r),o=0;o<a.length;o++){var i=a[o];if(i.nla_events.length){n.objects[r]||(n.objects[r]=[]);for(var s=0;s<i.scenes_data.length;s++){var E=i.scenes_data[s];E.scene==e&&E.obj_has_nla_on_scene&&n.objects[r].push(i)}u(i.nla_events,n,i.name),d(i.nla_events,n)}}var l=e._render.video_textures;for(o=0;o<l.length;o++){var T=l[o]._render;if(T.use_nla&&(T.video_file||T.seq_video)&&T.vtex_data_id==r){var f={type:"CLIP",frame_start:0,frame_end:0,scheduled:!1,paused:!1,anim_name:"",anim_uuid:"",anim_slot:0,name_list:null,action_frame_start:0,action_frame_end:0,ext_frame_start:0,ext_frame_end:0,use_reverse:!1,scale:1,repeat:1,action_frame_final:0};f.type="VIDEO",T.use_cyclic?(f.frame_start=0,f.frame_end=n.frame_end):(f.frame_start=Un(T.frame_start,0,n.frame_end),f.frame_end=Un(T.frame_start+T.frame_duration,0,n.frame_end)),f.anim_name=l[o].name,n.textures.push(T)}}},t.prepare=function(){for(var e=0;e<c.length;e++)for(var t=c[e],_=0;_<t.objects.length;_++){var n=t.objects[_];if(n)for(e=0;e<n.length;e++)for(var a=n[e],o=a.nla_events,i=0;i<o.length;i++){var s=o[i];r.init_action_cache(a,s.name_list,s.uuid,s.anim_name,s.anim_slot)}}},t.start=function(){l=0},t.get_start_time=function(){return l},t.get_frame_offset=function(e){return e._nla?e._nla.frame_offset:null},t.set_frame_offset=function(e,t){return!!e._nla&&(e._nla.frame_offset=t,!0)},t.update=function(e,t){if(!(l<0)){0==l&&(l=e);for(var r=0;r<c.length;r++){var _=c[r];_.is_stopped&&(_.frame_offset-=E.get_framerate()*t);var n=g(_,e);(!_.is_stopped||_.force_update)&&n>=_.range_end&&(_.cyclic?n=p(_,e):S(_,n)),_.is_stopped&&!_.force_update||(m(_,n),O(e,_,n),_.last_frame=n),_.force_update=!1,_.rewinded_to_start=!1}}},t.cleanup=function(e){if(0==e)c.length=0,l=-1;else for(var t=0;t<c.length;t++)c[t].objects[e]=null},t.bpy_obj_has_nla=function(e){var t=e.animation_data;return!!(t&&t.nla_tracks.length||L(e)||function(e){if("MESH"!=e.type||!e.data)return!1;var t=e.data.materials;if(!t)return!1;for(var r=0;r<t.length;r++){var _=t[r],n=_.node_tree;if(_.use_nodes&&n&&M(n))return!0}return!1}(e))},t.set_frame=x,t.get_frame=function(e){var t=o.get_active();return t._nla?g(t._nla,e):-1},t.stop_nla=function(){var e=o.get_active();if(e._nla){e._nla.is_stopped=!0;for(var t=e._nla.textures,r=0;r<t.length;r++)s.pause_video(t[r])}},t.play_nla=function(e){var t=o.get_active();t._nla&&(t._nla.is_stopped=!1,t._nla.user_callback=e||null)},t.get_frame_start=function(){var e=o.get_active();return e._nla?e._nla.frame_start:-1},t.get_frame_end=function(){var e=o.get_active();return e._nla?e._nla.frame_end:-1},t.is_play=function(){var e=o.get_active();return!!e._nla&&!e._nla.is_stopped},t.check_nla=function(){var e=o.get_active();return!!e._nla&&e.b4w_use_nla},t.check_logic_nodes=function(){var e=o.get_active();return!!e._nla&&e.b4w_logic_nodes.length>0},t.set_range=function(e,t){var r=o.get_active();if(!r._nla)return!1;r._nla.range_start=e,r._nla.range_end=t},t.set_range_end=function(e){var t=o.get_active();if(!t._nla)return!1;t._nla.range_end=e},t.set_range_start=function(e){var t=o.get_active();if(!t._nla)return!1;t._nla.range_start=e},t.reset_range=function(){var e=o.get_active();if(!e._nla)return!1;var t=e._nla;t.range_start=t.frame_start,t.range_end=t.frame_end},t.set_cyclic=function(e){var t=o.get_active();if(!t._nla)return!1;t._nla.cyclic=e},t.clear_callback=function(){var e=o.get_active();e._nla&&(e._nla.user_callback=null)},t.set_offset_from_range_start=function(e){var t=o.get_active()._nla;t&&(t.frame_offset=-(e-l)*E.get_framerate()+t.range_start,t.force_update=!0)},t.get_frame_end=function(){var e=o.get_active()._nla;return e?e.frame_end:null}}),Ms=A("__objects",function(e,t){var r=gs(e),_=ha(e),n=Ks(e),a=oE(e),o=Wo(e),i=ms(e),s=aE(e),E=Jo(e),c=wi(e),l=Ls(e),T=os(e),u=is(e),d=Ns(e),f=ga(e),P=Ps(e),A=ps(e),S=ai(e),p=Ss(e),m=ys(e),O=ri(e),v=Os(e),N=Bs(e),g=Qi(e),h=o.defaults,R=o.outlining,I=!1,b={ALL:[]},Y=0,L=0,M=[],x=[],y=new Float32Array(3),w=new Float32Array(4),U=-1,C=.4;function D(e){for(var t=e.scenes_data,r=e.render,_=0;_<t.length;_++){var n=t[_].scene;n._render.outline&&r.outline_intensity&&A.request_outline(n)}}function F(e){e.render.outline_intensity=0;var t=x.indexOf(e);-1!=t&&x.splice(t,1)}function G(e,t){return-1!=e._bsdf_types.indexOf(t)}function k(e){if(e.field)for(var t=e.scenes_data,r=0;r<t.length;r++)A.update_force_scene(t[r].scene,e)}function K(e,t){for(var r=e.scenes_data,_=t.scenes_data,n=0;n<r.length;n++){for(var a=!1,o=0;o<_.length;o++)if(r[n].scene==_[o].scene){a=!0;break}a||B(t,r[n].scene)&&T.append_scene_data(t,r[n].scene)}}function B(e,t){return!(!t._is_main&&"SPEAKER"==e.type||!t._is_primary_thread&&"LAMP"==e.type)}function X(e){var t=r.bpy_mesh_empty_is_animatable(e),_=e.b4w_do_not_batch,n=e.b4w_collision,a=e.b4w_vehicle,o=e.b4w_floating,i=e.b4w_character,s=u.has_dynamic_grass_particles(e),E=l.bpy_obj_has_nla(e),c=e.data.b4w_shape_keys.length>0,T=e.b4w_dynamic_geometry,d=H(e);return I||t||_||n||a||c||o||s||i||E||T||function(e){for(var t=e.data,r=0;r<t.materials.length;r++){var _=t.materials[r];if(_.water_settings.is_water)return!0;if(_.is_lens_flares)return!0;if(z(_.node_tree))return!0}return!1}(e)||d}function H(e){var t=!1,r=e.constraints.length;if(r){for(var _=null,n=r-1;n>=0;n--){var a=e.constraints[n];if("LOCKED_TRACK"!=a.type||"REFLECTION PLANE"!=a.name){_=a;break}}if(!_)return!1;if(!_.target)return!1;var o=_.target,i=o.type;if(o.parent){var s=o.parent.type;return"MESH"==s?t||X(o.parent):"EMPTY"!=s||t||Q(o.parent)}t="MESH"==i?t||X(o):"EMPTY"!=i||t||Q(o)}return t}function Q(e){var t=r.bpy_mesh_empty_is_animatable(e),_=l.bpy_obj_has_nla(e),n=e.b4w_do_not_batch,a=Boolean(e.b4w_anchor),o=H(e);return t||_||n||a||o}function z(e){if(!e)return!1;for(var t=e.nodes,r=0;r<t.length;r++){var _=t[r];if("VECT_TRANSFORM"==_.type){var n=_.convert_from,a=_.convert_to;if(_.outputs[0].is_linked&&("WORLD"!=n||"CAMERA"!=a)&&("CAMERA"!=n||"WORLD"!=a)&&("OBJECT"!=n||"OBJECT"!=a))return!0}if("NORMAL_MAP"==_.type){var o=_.space;if(_.outputs[0].is_linked&&("OBJECT"==o||"BLENDER_OBJECT"==o))return!0}if("TEX_COORD"==_.type&&_.outputs[3].is_linked)return!0;if("OBJECT_INFO"==_.type&&(_.outputs[0].is_linked||_.outputs[1].is_linked||_.outputs[3].is_linked))return!0}return!1}function j(e){if(Z(e,b.ALL,!1,U)){for(var t,r=1;Z(e+(t="."+(String(r).length<3?("000"+String(r)).slice(-3):String(r))),b.ALL,!1,U);)r++;return f.error('Object "'+e+'" already exists. Name was replaced by "'+e+t+'".'),t}return""}function q(e,t,r){for(var _=b[t]||[],n=[],a=0;a<_.length;a++){var o=_[a];if(o.render.data_id==r||r==U)for(var i=o.scenes_data,s=0;s<i.length;s++)i[s].scene==e&&n.push(o)}return n}function W(e,t){var r=b[e]||[];if(t==U)return r;for(var _=[],n=0;n<r.length;n++){var a=r[n];a.render.data_id==t&&_.push(a)}return _}function J(e,t,r,_){for(var a=0;a<e.scenes_data.length;a++)for(var o=e.scenes_data[a].batches,i=0;i<o.length;i++){var s=o[i];s.bufs_data&&(s.bufs_data.cleanup_gl_data_on_unload=t),s.cleanup_gl_data_on_unload=t,s.shader&&(s.shader.cleanup_gl_data_on_unload=r),n.set_cleanup_nodemat(_)}}function Z(e,t,r,_,n){for(var a=null,o=0;o<t.length;o++){var i=t[o];if(!((r?i.origin_name:i.name)!=e||i.render.data_id!=_&&_!=U||n&&i.is_meta||T.get_dg_parent(a=i)))break}return a}function $(e,t){var r=0,_=e.outline_animation;0==_.time_start&&(_.time_start=t);var n=t-_.time_start;if(_.relapses&&n/_.period>=_.relapses)F(e);else{var a=n%_.period;if(a<_.outline_time){var o=a/(_.outline_time/5),i=Math.floor(o);switch(i){case 0:r=(o-i)/2;break;case 1:r=(o-i)/2+.5;break;case 2:r=1;break;case 3:r=1-(o-i)/2;break;case 4:r=.5-(o-i)/2}}e.render.outline_intensity=r}}function ee(e){b.ALL.push(e),b[e.type]||(b[e.type]=[]),b[e.type].push(e);var t=e.render.plane_reflection_id;if(null!=t)for(var r=0;r<M.length;r++){var _=M[r];_.render.plane_reflection_id==t&&_.reflective_objs.push(e)}}function te(e,t,r){if(!t.is_lod)return!0;var _=e.lod_settings;if(_.dest_coverage!=_.coverage)if(_.use_smoothing){var n=W_(_.dest_coverage-_.coverage);_.coverage+=n*O.get_delta()/C,_.coverage=Un(_.coverage,0,1)}else _.coverage=_.dest_coverage;if("STATIC"==t.type)var a=t.lod_center;else a=Ie(t.bs_world.center,t.main_lod_offset,y);var o=Ue(a,r);if(0==_.hyst_prev_state)var i=Math.max(t.lod_dist_min-_.hyst_interval_min/2,0),s=t.lod_dist_max+_.hyst_interval_max/2;else-1==_.hyst_prev_state?(i=t.lod_dist_min+_.hyst_interval_min/2,s=t.lod_dist_max+_.hyst_interval_max/2):(i=Math.max(t.lod_dist_min-_.hyst_interval_min/2,0),s=Math.max(t.lod_dist_max-_.hyst_interval_max/2,0));return _.hyst_prev_state=o<i?-1:o<s?0:1,_.dest_coverage=o<i||o>s?0:1,_.cmp_logic=0==_.dest_coverage?-1:1,Math.abs(o-_.prev_dist)>h.lod_leap_smooth_threshold&&(0==_.coverage||1==_.coverage)&&(_.coverage=_.dest_coverage),_.prev_dist=o,0!=_.dest_coverage||0!=_.coverage}t.GET_OBJECT_BY_NAME=0,t.GET_OBJECT_BY_DUPLI_NAME=1,t.GET_OBJECT_BY_DUPLI_NAME_LIST=2,t.DATA_ID_ALL=U,t.update=function(e,t){for(var r=0;r<x.length;r++){var _=x[r];$(_,e),_.render.outline_intensity&&D(_)}var n=b.ARMATURE;if(n)for(r=0;r<n.length;r++){var a=n[r];a.need_update_transform&&(v.update_transform(a),a.need_update_transform=!1)}},t.set_outline_intensity=function(e,t){e.render.outline_intensity=t,D(e)},t.apply_outline_anim=function(e,t,r,_){var n=e.outline_animation;n.time_start=0,n.outline_time=t,n.period=r,n.relapses=_,-1==x.indexOf(e)&&x.push(e)},t.clear_outline_anim=F,t.create_object_from_bpy=function(e,t){var o,i,s=T.create_object(t?"%meta_world%"+e.name:e.name,t?"WORLD":e.type,t?"%meta_world%"+e.name:e.origin_name);if("MESH"==s.type)for(var c=0;c<e.data.materials.length;c++)s.materials.push(e.data.materials[c]);for(c=0;c<e._scenes.length;c++)T.append_scene_data(s,e._scenes[c]);return e._object=s,t?((i=s).uuid=(o=e).uuid,i.is_meta=!1,i.def_action_slots=o._def_action_slots,i.is_dynamic=o._is_dynamic,i.render=T.create_render(i.type),i.use_default_animation=o.b4w_use_default_animation,i.anim_behavior_def=r.anim_behavior_bpy_b4w(o.b4w_anim_behavior),ee(i)):function(e,t){if(t.uuid=e.uuid,t.is_meta=!1,t.def_action_slots=e._def_action_slots,t.is_dynamic=e._is_dynamic,t.is_hair_dupli=e._is_hair_dupli||!1,function(e,t){t.is_vehicle=e.b4w_vehicle,t.is_character=e.b4w_character,t.is_floating=e.b4w_floating,t.use_obj_physics=e.b4w_collision,t.collision_id=e.b4w_collision_id,t.correct_bounding_offset=e.b4w_correct_bounding_offset;var r=e.game;t.physics_settings={physics_type:r.physics_type,use_ghost:r.use_ghost,use_sleep:r.use_sleep,mass:r.mass,velocity_min:r.velocity_min,velocity_max:r.velocity_max,damping:r.damping,rotation_damping:r.rotation_damping,lock_location_x:r.lock_location_x,lock_location_y:r.lock_location_y,lock_location_z:r.lock_location_z,lock_rotation_x:r.lock_rotation_x,lock_rotation_y:r.lock_rotation_y,lock_rotation_z:r.lock_rotation_z,collision_margin:r.collision_margin,collision_group:r.collision_group,collision_mask:r.collision_mask,use_collision_bounds:r.use_collision_bounds,collision_bounds_type:r.collision_bounds_type,use_collision_compound:r.use_collision_compound};var _=e.b4w_vehicle_settings;_&&(t.vehicle_settings={name:_.name,part:_.part,suspension_rest_length:_.suspension_rest_length,suspension_compression:_.suspension_compression,suspension_stiffness:_.suspension_stiffness,suspension_damping:_.suspension_damping,wheel_friction:_.wheel_friction,roll_influence:_.roll_influence,max_suspension_travel_cm:_.max_suspension_travel_cm,force_max:_.force_max,brake_max:_.brake_max,steering_max:_.steering_max,max_speed_angle:_.max_speed_angle,delta_tach_angle:_.delta_tach_angle,speed_ratio:_.speed_ratio,steering_ratio:_.steering_ratio,inverse_control:_.inverse_control,floating_factor:_.floating_factor,water_lin_damp:_.water_lin_damp,water_rot_damp:_.water_rot_damp,synchronize_position:_.synchronize_position});var n=e.b4w_floating_settings;n&&(t.floating_settings={name:n.name,part:n.part,floating_factor:n.floating_factor,water_lin_damp:n.water_lin_damp,water_rot_damp:n.water_rot_damp,synchronize_position:n.synchronize_position});var a=e.b4w_character_settings;a&&(t.character_settings={walk_speed:a.walk_speed,run_speed:a.run_speed,step_height:a.step_height,jump_strength:a.jump_strength,waterline:a.waterline});for(var o=0;o<e.constraints.length;o++){var i=e.constraints[o];"RIGID_BODY_JOINT"==i.type&&t.physics_constraints.push({target:i.target._object,pivot_type:i.pivot_type,pivot_x:i.pivot_x,pivot_y:i.pivot_y,pivot_z:i.pivot_z,axis_x:i.axis_x,axis_y:i.axis_y,axis_z:i.axis_z,use_limit_x:i.use_limit_x,use_limit_y:i.use_limit_y,use_limit_z:i.use_limit_z,use_angular_limit_x:i.use_angular_limit_x,use_angular_limit_y:i.use_angular_limit_y,use_angular_limit_z:i.use_angular_limit_z,limit_max_x:i.limit_max_x,limit_max_y:i.limit_max_y,limit_max_z:i.limit_max_z,limit_min_x:i.limit_min_x,limit_min_y:i.limit_min_y,limit_min_z:i.limit_min_z,limit_angle_max_x:i.limit_angle_max_x,limit_angle_max_y:i.limit_angle_max_y,limit_angle_max_z:i.limit_angle_max_z,limit_angle_min_x:i.limit_angle_min_x,limit_angle_min_y:i.limit_angle_min_y,limit_angle_min_z:i.limit_angle_min_z})}}(e,t),"MESH"===t.type)var o=t.is_dynamic?"DYNAMIC":"STATIC";else o=t.type;var i=t.render=T.create_render(o);!function(e,t){e.parent?(t.parent=e.parent._object,"BONE"==e.parent_type&&"ARMATURE"==e.parent.type&&(t.parent_bone=e.parent_bone),e.pinverse_tsr&&(t.pinverse_tsr=ba(),Ma(e.pinverse_tsr,t.pinverse_tsr))):e.dg_parent&&(t.parent=e.dg_parent._object,t.parent_is_dupli=!0)}(e,t);var s=e.location,c=e.scale[0],l=w;switch(ta(e.rotation_quaternion,l),v.set_translation(t,s),v.set_rotation(t,l),v.set_scale(t,c),t.use_default_animation=e.b4w_use_default_animation,t.anim_behavior_def=r.anim_behavior_bpy_b4w(e.b4w_anim_behavior),e.b4w_object_tags&&(t.metatags={title:e.b4w_object_tags.title,description:e.b4w_object_tags.description,category:e.b4w_object_tags.category}),t.custom_prop=e.b4w_custom_prop,e.b4w_viewport_alignment&&(t.viewport_alignment={alignment:e.b4w_viewport_alignment.alignment,distance:e.b4w_viewport_alignment.distance}),i.hide=e.b4w_hidden_on_load,i.hide_children=e.b4w_hide_chldr_on_load,e.type){case"ARMATURE":!function(t,r){for(var _=e.data.bones,n=e.pose.bones,a={},o=0;o<n.length;o++){var i=(d=n[o]).bone,s=a[u=i.name]={bone_index:0,vgroup_index:-1,parent_bone_ptr:null,descend_bones_ptrs:[],chain:[],constraint:null,tsr_bone_rest:ba(),tsr_bone_pose:ba(),tsr_local_rest:ba(),tsr_local_rest_i:ba(),tsr_local_pose:ba(),tsr_local_pose_b:ba(),tsr_local_pose_a:ba(),tsr_basis:ba(),tsr_channel_cache:ba(),tsr_channel_cache_valid:!1,tail:new Float32Array(3)},E=new Float32Array(i.matrix_local),c=new Float32Array(16);V(E,c);var l=new Float32Array(d.matrix_basis),T=s.tail;be(j_(i.tail_local),j_(i.head_local),T),Sn(T,c,T),za(E,s.tsr_local_rest),za(l,s.tsr_basis),Ma(s.tsr_local_rest,s.tsr_local_pose),Ha(s.tsr_local_rest,s.tsr_local_rest_i)}for(o=0;o<_.length;o++){var u,d,f=(d=J_("name",u=_[o].name,n)).parent_recursive;(s=a[u]).chain.push(s);for(var P=0;P<f.length;P++){var A;s.chain.push(A=a[f[P].name])}f.length?(s.parent_bone_ptr=A=a[f[0].name],Ha(A.tsr_local_rest,zi),Va(zi,s.tsr_local_rest,s.tsr_bone_rest),A.descend_bones_ptrs.push(s)):Ma(s.tsr_local_rest,s.tsr_bone_rest),s.bone_index=o,s.name=u,Va(s.tsr_bone_rest,s.tsr_basis,s.tsr_bone_pose)}r.render.bone_pointers=a}(0,t);var u=i.bone_pointers,d=r.calc_pose_data(u);for(var f in e.b4w_animation_mixing?(i.quats_before=new Float32Array(d.quats),i.quats_after=new Float32Array(d.quats),i.trans_before=new Float32Array(d.trans),i.trans_after=new Float32Array(d.trans)):(i.quats_before=d.quats,i.quats_after=d.quats,i.trans_before=d.trans,i.trans_after=d.trans),u){var P=u[f];1==P.chain.length&&es(P,!0,d.trans,d.quats)}i.pose_data=d,i.frame_factor=0,i.anim_mixing=e.b4w_animation_mixing;break;case"MESH":i.bb_original=n.bb_bpy_to_b4w(e.data.b4w_boundings.bb),t.is_boundings_overridden=e.data.is_boundings_overridden,i.do_not_render=e.b4w_do_not_render,i.selectable=R.outlining_overview_mode||e.b4w_selectable,i.origin_selectable=e.b4w_selectable,i.outlining=R.outlining_overview_mode||e.b4w_outlining,i.origin_outlining=e.b4w_outlining,i.outline_on_select=R.outlining_overview_mode||e.b4w_outline_on_select,i.billboard=e.b4w_billboard,i.billboard_pres_glob_orientation=e.b4w_pres_glob_orientation,i.billboard_type="BASIC",i.billboard_spherical="SPHERICAL"==e.b4w_billboard_geometry;var A=i.outline_anim_settings_default;if(A.outline_duration=e.b4w_outline_settings.outline_duration,A.outline_period=e.b4w_outline_settings.outline_period,A.outline_relapses=e.b4w_outline_settings.outline_relapses,i.selectable&&(i.color_id=E.gen_color_id(Y),Y++),function(e,t){for(var r=0;r<e.data.b4w_vertex_anim.length;r++){var _=e.data.b4w_vertex_anim[r];t.vertex_anim.push({name:_.name,frame_start:_.frame_start,frame_end:_.frame_end,averaging:_.averaging,averaging_interval:_.averaging_interval,allow_nla:_.allow_nla})}t.render.vertex_anim=!!t.vertex_anim.length}(e,t),function(e,t){"MESH"!=e.type&&_.panic("Wrong object type: "+e.name);var r=t.render;if(e.data.b4w_shape_keys.length){r.use_shape_keys=!0;for(var n=0;n<e.data.b4w_shape_keys.length;n++){var a={};a.value=e.data.b4w_shape_keys[n].value,a.name=e.data.b4w_shape_keys[n].name,r.shape_keys_values.push(a)}}else r.use_shape_keys=!1}(e,t),i.shadow_cast=e.b4w_shadow_cast,i.shadow_receive=e.b4w_shadow_receive,i.shadow_cast_only=e.b4w_shadow_cast_only&&i.shadow_cast,i.reflexible=e.b4w_reflexible,i.reflexible_only=e.b4w_reflexible_only&&i.reflexible,i.reflective=e.b4w_reflective,i.reflection_type=e.b4w_reflection_type,i.reflective||function(e){for(var t=e.materials,r=0;r<t.length;r++){var _=t[r];_.use_nodes&&(G(_.node_tree,"BSDF_GLOSSY")||G(_.node_tree,"BSDF_DIFFUSE")||G(_.node_tree,"BSDF_PRINCIPLED"))&&(e.render.reflective=!0,e.render.reflection_type="PBR")}}(t),i.caustics=e.b4w_caustics,i.wind_bending=e.b4w_wind_bending,e.b4w_wind_bending){i.wind_bending_angle=e.b4w_wind_bending_angle;var S=n.wb_angle_to_amp(In(e.b4w_wind_bending_angle),i.bb_original,e.scale[0]);i.wind_bending_amp=S,i.wind_bending_freq=e.b4w_wind_bending_freq,i.detail_bending_freq=e.b4w_detail_bending_freq,i.detail_bending_amp=e.b4w_detail_bending_amp,i.branch_bending_amp=e.b4w_branch_bending_amp,i.main_bend_col=e.b4w_main_bend_stiffness_col;var m=e.b4w_detail_bend_colors;i.detail_bend_col.leaves_stiffness=m.leaves_stiffness_col,i.detail_bend_col.leaves_phase=m.leaves_phase_col,i.detail_bend_col.overall_stiffness=m.overall_stiffness_col}if(i.dynamic_geometry=e.b4w_dynamic_geometry,i.dynamic_geometry){t._bpy_obj=e;for(var O=0;O<t.materials.length;O++)t.mat_inheritance_data.original_mat_names.push(t.materials[O].name),t.mat_inheritance_data.is_disabled.push(!1)}var N=t.materials[0];i.friction=N.physics_settings.friction,i.elasticity=N.physics_settings.elasticity,i.lod_dist_min=0,i.lod_dist_max=T.LOD_DIST_MAX_INFINITY,i.pass_index=e.pass_index;break;case"LINE":i.bb_local={max_x:0,min_x:0,max_y:0,min_y:0,max_z:0,min_z:0},i.be_local=Mo(),i.bb_world={max_x:0,min_x:0,max_y:0,min_y:0,max_z:0,min_z:0},i.be_world=Mo();break;case"CAMERA":a.camera_object_to_camera(e,t),a.assign_boundings(t);break;case"LAMP":!function(e,t){var r=e.data,_=t.light=function(e){var t={name:"",type:r.type,use_diffuse:!1,use_specular:!1,prev_direction:new Float32Array(3),direction:new Float32Array(3),color:new Float32Array(3),color_intensity:new Float32Array(3),energy:0,default_energy:0,distance:0,use_sphere:!1,spot_size:0,spot_blend:0,clip_start:.1,clip_end:30,falloff_type:"",generate_shadows:!1,need_sun_fog_update:!1,dynamic_intensity:!1};return t.use_diffuse=!0,t.use_specular=!0,t.energy=1,t.distance=25,t.falloff_type="INVERSE_SQUARE",t}();_.name=t.name,_.use_diffuse=r.use_diffuse,_.use_specular=r.use_specular;var n=sn(Ba(t.render.world_tsr),S_,rs);Ke(n,n),_.direction.set(n),_.color[0]=r.color[0],_.color[1]=r.color[1],_.color[2]=r.color[2],_.energy=_.default_energy=r.energy,as(_),_.distance=r.distance,_.use_sphere=r.use_sphere,_.clip_start=r.clip_start,_.clip_end=r.clip_end,"POINT"!==_.type&&"SPOT"!==_.type||(_.distance=r.distance),"SPOT"===_.type?(_.spot_blend=r.spot_blend,_.spot_size=r.spot_size):"POINT"===_.type&&(_.spot_size=Math.PI/2),_.generate_shadows=r.b4w_generate_shadows,_.dynamic_intensity=r.b4w_dynamic_intensity}(e,t);break;case"SPEAKER":t.sfx=p.create_sfx();var g=!1;for(O=0;O<t.scenes_data.length;O++)if(t.scenes_data[O].scene._sfx){g=!0;break}g&&p.update_object(e,t);break;case"EMPTY":i.bb_local={max_x:0,min_x:0,max_y:0,min_y:0,max_z:0,min_z:0};var h=Yo();i.bs_local=h,e.field&&(t.field={type:e.field.type,strength:e.field.strength}),e.b4w_anchor&&(t.anchor={type:e.b4w_anchor.type,detect_visibility:e.b4w_anchor.detect_visibility,element_id:e.b4w_anchor.element_id,max_width:e.b4w_anchor.max_width})}ee(t)}(e,s),s},t.update_object_relations=function(e,t){var _=t.render;if("MESH"==t.type){var n=r.get_bpy_armobj(e);if(n){var a=n._object,o=a.render.pose_data;!function(e,t,_){var n=t.render,a=e.data;t.armobj=_;var o=a.vertex_groups;if(o.length){var i=_.render.bone_pointers,s=0,E={};for(var c in i){var l=J_("name",c,o);l&&(E[c]={vgroup_index:l.index,bone_index:i[c].bone_index,deform_bone_index:s++})}n.bone_skinning_info=E;var T=s,u=r.get_max_bones();n.max_bones=T,T>2*u?(n.is_skinning=!1,f.error('too many bones for "'+e.name+'" / '+n.max_bones+" bones (max "+u+" with blending, "+2*u+" without blending). Skinning will be disabled.")):n.is_skinning=!0}}(e,t,a);var s=r.extract_skinned_pose_data(o.trans,o.quats,_.bone_skinning_info);n.b4w_animation_mixing?(_.quats_before=new Float32Array(s.quats),_.quats_after=new Float32Array(s.quats),_.trans_before=new Float32Array(s.trans),_.trans_after=new Float32Array(s.trans)):(_.quats_before=s.quats,_.quats_after=s.quats,_.trans_before=s.trans,_.trans_after=s.trans),_.arm_rel_trans=new Float32Array(4),_.arm_rel_quat=Yr(),_.pose_data=s,_.frame_factor=0}_.reflective&&function(e,t){var r=t.render;if("CUBE"==r.reflection_type)r.cube_reflection_id=L++;else if("PLANE"==r.reflection_type){var _=function(e,t){for(var r=e.constraints,_=0;_<r.length;_++){var n=r[_];if("LOCKED_TRACK"==n.type&&"REFLECTION PLANE"==n.name){if(n.target&&n.target._object)return n.target._object;f.warn('Reflection plane target for object: "'+t.name+"\" is not present on the scene. Using object's Z-axis.")}}return null}(e,t);_||(_=function(e){var t=E.unique_name("%reflection%"),r=T.create_object(t,"EMPTY"),_=T.create_render("EMPTY");return r.render=_,K(e,r),i.append_stiff_obj(r,e,[0,0,0],null,1),ee(r),r}(t));for(var n=null,a=0;a<M.length;a++)if(M[a]==_){n=a;break}null==n&&(n=M.length,M.push(_)),_.render.plane_reflection_id=n,r.plane_reflection_id=n,_.reflective_objs.push(t)}}(e,t)}},t.update_force=k,t.copy_scene_data=K,t.check_bpy_obj_scene_compatibility=B,t.update_objects_dynamics=function(e){for(var t=0;t<e.length;t++){var _=e[t];!_.render||"DYNAMIC"!=_.render.type&&"CAMERA"!=_.render.type||v.update_transform(_),_.use_default_animation&&r.obj_is_animatable(_)&&(r.apply_def(_),_.anim_slots.length&&r.play(_,null,r.SLOT_ALL))}},t.bpy_obj_is_dynamic=function(e){if(e.b4w_hidden_on_load)return!0;if(e.dg_parent&&e.dg_parent._is_dynamic)return!0;if(e.parent&&e.parent._is_dynamic)return!0;switch(e.type){case"MESH":return X(e);case"EMPTY":return Q(e);default:return!0}},t.get_meta_tags=function(e){return ln(e.metatags)},t.get_custom_prop=function(e){return e.custom_prop},t.cleanup=function(){Y=0,L=0,M.length=0,x.length=0,b={ALL:[]}},t.copy=function(e,t,r){var _=function(e,t,r){var _=t,a=T.get_dg_parent(e),o=a?T.gen_dupli_name(a.name,t):t,i=j(o),s=T.create_object(o+=i,e.type,_+=i);s.is_meta=e.is_meta,s._bpy_obj=e._bpy_obj,s.mat_inheritance_data.original_mat_names=T.copy_bpy_object_props_by_link(e.mat_inheritance_data.original_mat_names),s.mat_inheritance_data.is_disabled=T.copy_bpy_object_props_by_link(e.mat_inheritance_data.is_disabled),s.is_dynamic=e.is_dynamic,s.is_hair_dupli=e.is_hair_dupli,s.use_default_animation=e.use_default_animation,s.def_action_slots=e.def_action_slots,s.render=T.clone_render(e.render),s.render.is_lod=!1,s.metatags=T.copy_object_props_by_value(e.metatags),s.custom_prop=T.copy_object_props_by_value(e.custom_prop),K(e,s),s.action_anim_cache=T.copy_bpy_object_props_by_link(e.action_anim_cache),s.parent=T.copy_bpy_object_props_by_link(e.parent),s.parent_is_dupli=e.parent_is_dupli,s.parent_bone=e.parent_bone,s.vertex_anim=T.copy_bpy_object_props_by_link(e.vertex_anim),s.anim_behavior_def=e.anim_behavior_def,e.physics&&!(e.is_vehicle||e.is_character||e.is_floating)&&(s.use_obj_physics=e.use_obj_physics,s.physics=null),s.collision_id=e.collision_id,s.correct_bounding_offset=e.correct_bounding_offset,s.physics_settings=T.copy_object_props_by_value(e.physics_settings),function(e,t,r){for(var _=[],a=0;a<e.scenes_data.length;a++){var o=t.scenes_data[a],i=e.scenes_data[a].batches;if(r){for(var s=o.batches,E=0;E<i.length;E++)if(!i[E].forked_batch){var l=T.copy_object_props_by_value(i[E]);l.bufs_data=c.clone_bufs_data(i[E].bufs_data),T.append_batch(t,o.scene,l),_.push(i[E].bufs_data)}for(E=0;E<i.length;E++)if(i[E].forked_batch){var u=T.copy_object_props_by_value(i[E]);T.append_batch(t,o.scene,u);for(var d=0;d<_.length;d++)_[d]==i[E].bufs_data&&(u.bufs_data=s[d].bufs_data)}for(E=0;E<s.length;E++)s[E].bufs_data&&c.update_gl_buffers(s[E].bufs_data),h.allow_vao_ext&&s[E].bufs_data&&g.assign_vao(s[E]),s[E].odd_id_prop=n.generate_odd_id(s[E],t.render,t.uuid),n.update_batch_id(s[E]);m.share_batch_canvas_textures(s)}else for(E=0;E<i.length;E++)T.append_batch(t,o.scene,i[E])}}(e,s,r);for(var E=0;E<e.materials.length;E++)s.materials.push(bs(e.materials[E]));return T.scene_data_set_active(s,!1),ee(s),s}(e,t,r);return _.render.is_copied=!0,_.render.is_copied_deep=r,_.render.color_id=E.gen_color_id(Y),Y++,_},t.get_bpy_def_action_slots=function(e,t){var _=[],n=e.animation_data,a=e.data?e.data.animation_data:null;if(n&&n.action){var o=n.action;(o._render.type==r.OBJ_ANIM_TYPE_OBJECT||o._render.type==r.OBJ_ANIM_TYPE_ARMATURE&&"ARMATURE"==e.type||o._render.type==r.OBJ_ANIM_TYPE_LIGHT&&"LAMP"==e.type||o._render.type==r.OBJ_ANIM_TYPE_ENVIRONMENT&&t)&&_.push(r.init_action_slot(null,o))}return a&&a.action&&("SPEAKER"==e.type||"LAMP"==e.type)&&_.push(r.init_action_slot(null,a.action)),"MESH"==e.type&&_.push.apply(_,r.get_bpy_material_actions(e)),t&&_.push.apply(_,r.get_bpy_world_material_actions(e)),_},t.update_boundings=function(e){for(var t=e.render,r=null,_=e.scenes_data[0].batches,a=0;a<_.length;a++){var o=e.scenes_data[0].batch_world_bounds[a];if((E=_[a]).bufs_data&&o.be&&o.bb){var i=c.get_vbo_type_by_attr_name("a_position");(l=c.get_vbo_source_by_type(E.bufs_data.vbo_source_data,i))&&(n.update_local_bounds_from_pos(E,l.subarray(u=E.bufs_data.pointers.a_position.offset,E.bufs_data.pointers.a_position.length+u)),T.update_world_bounds_from_batch_tsr(E,t.world_tsr,o),"MAIN"==E.type&&(r?Oo(r,E.bounds_local.bb):r=mo(E.bounds_local.bb)))}}if(r=r||{max_x:0,min_x:0,max_y:0,min_y:0,max_z:0,min_z:0},t.billboard)T.update_render_bounds_billboard(e,r);else{var s=[];for(a=0;a<_.length;a++){var E,l;if("MAIN"==(E=_[a]).type&&(i=c.get_vbo_type_by_attr_name("a_position"),l=c.get_vbo_source_by_type(E.bufs_data.vbo_source_data,i))){var u,d=_[a].bufs_data.pointers;s.push(l.subarray(u=d.a_position.offset,d.a_position.length+u))}}T.update_render_bounds_from_pos_arrays(e,r,s)}if(h.debug_view)for(a=0;a<_.length;a++)if("DEBUG_VIEW"===_[a].type&&_[a].debug_sphere){var f=t.be_local,A=P.generate_uv_sphere(16,8,1,f.center,!1,!1);c.scale_submesh_xyz(A,[f.axis_x[0],f.axis_y[1],f.axis_z[2]],f.center),c.submesh_drop_indices(A,1,!0),A.va_common.a_polyindex=c.extract_polyindices(A),n.update_batch_geometry(_[a],A);break}},t.get_scene_objs=q,t.get_scene_objs_derived=function(e,t,r){for(var _=b[t]||[],n=[],a=0;a<_.length;a++){var o=_[a];if(!(o.render.data_id!=r&&r!=U||o.is_meta))for(var i=o.scenes_data,s=0;s<i.length;s++)i[s].scene==e&&n.push(o)}return n},t.get_all_objects=W,t.get_first_character=function(e){var t=b.MESH;if(t)for(var r=0;r<t.length;r++){var _=t[r];if(d.has_character_physics(_))for(var n=_.scenes_data,a=0;a<n.length;a++)if(n[a].scene==e)return _}return null},t.obj_switch_cleanup_flags=J,t.get_selectable_objects=function(){var e=[],t=b.MESH;if(t)for(var r=0;r<t.length;r++){var _=t[r];_.render.selectable&&!_.is_meta&&e.push(_)}return e},t.get_outlining_objects=function(){var e=[],t=b.MESH;if(t)for(var r=0;r<t.length;r++){var _=t[r];_.render.outlining&&!_.is_meta&&e.push(_)}return e},t.get_object=function(){var e=null,r=b.ALL;switch(arguments[0]){case t.GET_OBJECT_BY_NAME:e=Z(arguments[1],r,!0,arguments[2],arguments[3]);break;case t.GET_OBJECT_BY_DUPLI_NAME:e=function(e,t,r,_){for(var n=0;n<r.length;n++){var a=r[n];if(a.origin_name==t&&(a.render.data_id==_||_==U)){var o=T.get_dg_parent(a);if(o&&o.origin_name==e)return a}}return null}(arguments[1],arguments[2],r,arguments[3]);break;case t.GET_OBJECT_BY_DUPLI_NAME_LIST:e=function(e,t,r){for(var _=0;_<t.length;_++){for(var n=t[_],a=e.length-1,o=n,i=!0;a>=0&&i;)i=o&&o.origin_name==e[a]&&(o.render.data_id==r||r==U),o&&(o=T.get_dg_parent(o)),a--;if(i&&!o)return n}return null}(arguments[1],r,arguments[2])}return e},t.get_world_by_name=function(e,t){return Z("%meta_world%"+e,b.WORLD,!0,t)},t.get_world_name=function(e){return e.origin_name.replace("%meta_world%","")},t.pick_object=function(e,r){var _=A.get_main();if(!_)return f.error("No active scene"),null;var n=A.get_subs(_,S.STEREO);if(n&&n.enable_hmd_stereo){var a=s.get_canvas();e=a.clientHeight/2,r=a.clientWidth/2}var o=N.pick_anchor(e,r);if(o)return o;var i=A.pick_color(_,e,r);if(!i)return null;for(var E=q(_,"MESH",U),c=0;c<E.length;c++){var l=E[c].render,T=l.color_id;if(T&&Math.abs(255*T[0]-i[0])<3&&Math.abs(255*T[1]-i[1])<3&&Math.abs(255*T[2]-i[2])<3){if(l.outlining&&l.outline_on_select)if(R.outlining_overview_mode)t.apply_outline_anim(E[c],R.outline_duration,R.outline_period,R.outline_relapses);else{var u=l.outline_anim_settings_default;t.apply_outline_anim(E[c],u.outline_duration,u.outline_period,u.outline_relapses)}return E[c]}}return null},t.set_wind_params=function(e,t){for(var r=q(e,"EMPTY",U),_=0;_<r.length;_++){var n=r[_];if(n.field&&"WIND"===n.field.type){var a=n;break}}if(!a)return f.error("There is no wind on the scene"),0;if("number"==typeof t.wind_dir){var o=In(t.wind_dir);Re(Math.sin(o),-Math.cos(o),0,y),En(y,S_,w),v.set_rotation(a,w)}"number"==typeof t.wind_strength&&(a.field.strength=t.wind_strength),k(a)},t.remove_object=function(e){i.check_constraint(e)&&i.remove(e),function(e){var t=b.ALL,r=b[e.type],_=t.indexOf(e),n=r.indexOf(e);-1!=_&&t.splice(_,1),-1!=n&&r.splice(n,1)}(e)},t.objects_storage_add=ee,t.objects_storage_check=function(e){return b[e.type]&&b[e.type].indexOf(e)>-1},t.update_lod_scene=function(e,t){e.render.is_lod&&function(e,t){var r=e.render,_=t._render;if(r.is_lod)for(var n=v.get_translation(t._camera,y),a=0;a<e.scenes_data.length;a++)if(e.scenes_data[a].scene==t)for(var o=0;o<e.scenes_data[a].batches.length;o++){var i=e.scenes_data[a].batches[o],s=i.lod_settings;if(h.lod_smooth_transitions&&("SHADOW"!=i.type||"RECEIVE"!=i.subtype||h.reuse_depth_optimization)){var E=_.lod_smooth_type;("ALL"==E||"NON-OPAQUE"==E&&(i.blend||i.alpha_clip))&&(s.use_smoothing=!0)}te(i,r,n),s.coverage=s.dest_coverage,s.hyst_interval_min=Math.min(_.lod_hyst_interval,.6*r.lod_lower_border_range),s.hyst_interval_max=Math.min(_.lod_hyst_interval,.6*r.lod_upper_border_range)}}(e,t)},t.update_lod_visibility=te,t.set_hair_particles_wind_bend_params=function(e){for(var t=e.render,r=t.wind_bending_amp,_=t.wind_bending_freq,n=t.detail_bending_freq,a=t.detail_bending_amp,o=t.branch_bending_amp,i=e.scenes_data,s=0;s<i.length;s++)for(var E=i[s].batches,l=0;l<E.length;l++){var T=E[l].bufs_data,u=T.pointers,d=u.au_wind_bending_amp,f=u.au_wind_bending_freq,P=u.au_detail_bending_amp,A=u.au_detail_bending_freq,S=u.au_branch_bending_amp;if(f){var p=Array.apply(null,Array(f.length)).map(function(){return _});c.update_gl_buffer_sub_data(T,c.VBO_FLOAT,new Float32Array(p),f.offset)}d&&(p=Array.apply(null,Array(d.length)).map(function(){return r}),c.update_gl_buffer_sub_data(T,c.VBO_FLOAT,new Float32Array(p),d.offset)),P&&(p=Array.apply(null,Array(P.length)).map(function(){return a}),c.update_gl_buffer_sub_data(T,c.VBO_FLOAT,new Float32Array(p),P.offset)),A&&(p=Array.apply(null,Array(A.length)).map(function(){return n}),c.update_gl_buffer_sub_data(T,c.VBO_FLOAT,new Float32Array(p),A.offset)),S&&(p=Array.apply(null,Array(S.length)).map(function(){return o}),c.update_gl_buffer_sub_data(T,c.VBO_FLOAT,new Float32Array(p),S.offset))}},t.inherit_material=function(e,t,_,a){if(e.render.dynamic_geometry&&_.render.dynamic_geometry){var o=n.find_batch_material(e,t,"MAIN"),i=null;n.iterate_batches_by_mat(_,a,function(e){i||(i={}),e.particles_data&&(i[e.particles_data.name]=e.particles_data)},"PARTICLES");for(var s=function(e,t){J(e,!0,!1,!0);for(var _=W("ALL",U),n=0;n<_.length;n++){var a=_[n];a!=e&&J(a,!1,!1,!1)}for(A.remove_object_bundles(e,t),n=0;n<e.scenes_data.length;n++)for(var o=e.scenes_data[n].batches.length-1;o>=0;o--){var i=e.scenes_data[n].batches[o];0!=i.material_names.length&&-1==i.material_names.indexOf(t)||T.scene_data_remove_batch(e.scenes_data[n],o)}for(d.obj_has_physics(e)&&d.remove_object(e),n=0;n<_.length;n++)_[n]!=e&&J(_[n],!0,!0,!0);r.delete_cached_anim_data_by_mat(e,t);var s=e._bpy_obj._object;return e._bpy_obj._object=e,s}(_,a),E=function(e,t,r,_){var n=e.mat_inheritance_data.original_mat_names.indexOf(t),a=r.mat_inheritance_data.original_mat_names.indexOf(_),o=e.materials[n];r.materials[a]=o;var i=o.name;o.name=_;for(var s=0;s<r.materials.length;s++)r.mat_inheritance_data.is_disabled[s]=!(s==a);return i}(e,t,_,a),l=A.get_active(),f=0;f<_.scenes_data.length;f++){var P=_.scenes_data[f].scene;A.set_active(P);var S=q(P,"LAMP",0),p=_.scenes_data[f].batches;_.scenes_data[f].batches=[],_.scenes_data[f].batch_world_bounds=[],n.generate_main_batches(P,[_._bpy_obj],S,[]),n.create_forked_batches(_,A.get_graph(P),P),A.assign_scene_data_subs(P,[_]),A.append_object(P,_,!1),d.append_object(_,P);for(var O=0;O<p.length;O++)T.append_batch(_,P,p[O])}!function(e,t,r,_){for(var n=0;n<r.materials.length;n++)r.mat_inheritance_data.is_disabled[n]=!1;var a=e.mat_inheritance_data.original_mat_names.indexOf(t);e.materials[a].name=_}(e,t,_,E),function(e,t){e._bpy_obj._object=t,J(e,!0,!0,!0)}(_,s),function(e,t,_,a,o){for(var i=1;i<e.render.shape_keys_values.length;i++)c.apply_shape_key(e,e.render.shape_keys_values[i].name,e.render.shape_keys_values[i].value);if(r.is_animated(e))for(i=0;i<e.anim_slots.length;i++){var s=e.anim_slots[i];if(s)switch(s.type){case r.OBJ_ANIM_TYPE_PARTICLES:var E=r.get_current_frame_float(e,i);r.set_frame(e,E,i);break;case r.OBJ_ANIM_TYPE_MATERIAL:if(s.node_batches)for(var l=s.node_batches.length-1;l>=0;l--)-1!=s.node_batches[l].material_names.indexOf(t)&&s.node_batches.splice(l,1)}}if(a&&n.iterate_batches_by_mat(e,t,function(t){if(t.particles_data){var r=t.particles_data.name;if(a[r]){var _=t.particles_data.count_factor!=a[r].count_factor;t.particles_data=u.clone_particles_data(a[r]),_&&u.set_factor(e,r,t.particles_data.count_factor)}}},"PARTICLES"),o){var T=n.find_batch_material(e,t,"MAIN");T&&(T.diffuse_color.set(o.diffuse_color),T.diffuse_intensity=o.diffuse_intensity,T.diffuse_color_factor=o.diffuse_color_factor,T.diffuse_params.set(o.diffuse_params),T.specular_color.set(o.specular_color),T.specular_color_factor=o.specular_color_factor,T.specular_params.set(o.specular_params),T.specular_alpha=o.specular_alpha,T.emit=o.emit,T.ambient=o.ambient,T.alpha_factor=o.alpha_factor,T.mirror_factor=o.mirror_factor,T.normal_factor=o.normal_factor,T.reflect_factor=o.reflect_factor,T.refr_bump=o.refr_bump,T.fresnel_params.set(o.fresnel_params),T.parallax_scale=o.parallax_scale,T.texture_scale.set(o.texture_scale),T.shallow_water_col.set(o.shallow_water_col),T.shallow_water_col_fac=o.shallow_water_col_fac,T.shore_water_col.set(o.shore_water_col),T.shore_water_col_fac=o.shore_water_col_fac,T.foam_factor=o.foam_factor,T.water_norm_uv_velocity=o.water_norm_uv_velocity,T.node_values=o.node_values.slice(),T.node_rgbs=o.node_rgbs.slice())}n.iterate_batches_by_mat(e,t,function(t){for(var r=0;r<t.bpy_tex_names.length;r++){var n=t.bpy_tex_names[r],a=t.textures[r];if("IMAGE"==a.source||"ENVIRONMENT"==a.source){var o=m.get_texture_by_name(_,n);o&&a.img_full_filepath!=o.img_full_filepath&&m.set_texture_by_name(e,n,o)}}})}(_,a,e,i,o),A.set_active(l)}},t.create_line=function(e){e=e||"",e+=j(e);var t=T.create_object(e,"LINE");return t.render=T.create_render("EMPTY"),t.is_dynamic=!0,n.generate_line_batches(A.get_main(),[t]),A.append_object(A.get_main(),t),ee(t),t},t.generate_mesh_render_boundings=function(e,t){var r=t.render,_=mo(r.bb_original);r.billboard?T.update_render_bounds_billboard(t,_):T.update_render_bounds_from_bpy(t,_,e.data.b4w_boundings)},t.set_nodemat_value=function(e,t,r,_){for(var a=T.is_world(e),o=!1,i=0;i<e.scenes_data.length;i++)for(var s=e.scenes_data[i].batches,E=0;E<s.length;E++){var c=s[E];(a||-1!=c.material_names.indexOf(t))&&(o|=n.set_nodemat_value(c,r,_))}return o&&a&&A.update_sky_texture(e),o},t.set_nodemat_rgb=function(e,t,r,_,a,o){for(var i=T.is_world(e),s=!1,E=0;E<e.scenes_data.length;E++)for(var c=e.scenes_data[E].batches,l=0;l<c.length;l++){var u=c[l];(i||-1!=u.material_names.indexOf(t))&&(s|=n.set_nodemat_rgb(u,r,_,a,o))}return s&&i&&A.update_sky_texture(e),s},t.get_nodemat_value=function(e,t,r){var _=n.find_batch_material_any(e,t,"MAIN")||n.find_batch_material_any(e,t,"PARTICLES");return n.get_nodemat_value(_,r)},t.get_nodemat_rgb=function(e,t,r,_){var a=n.find_batch_material_any(e,t,"MAIN")||n.find_batch_material_any(e,t,"PARTICLES");return n.get_nodemat_rgb(a,r,_)}}),xs=A("__curve",function(e,t){var r=ha(e);function _(e,t,r,_,n){var a=_.length;n||(n=new Float32Array(a));for(var o=a+e,i=new Float32Array(o),s=1;s<=o-1;s++)i[s-1]=t>=r[s-1]&&t<r[s+1-1]?1:0;for(var E=2;E<=e;E++)for(s=1;s<=o-E;s++){if(0!=i[s-1])var c=(t-r[s-1])*i[s-1]/(r[s+E-1-1]-r[s-1]);else c=0;if(0!=i[s+1-1])var l=(r[s+E-1]-t)*i[s+1-1]/(r[s+E-1]-r[s+1-1]);else l=0;i[s-1]=c+l}t==r[o-1]&&(i[a-1]=1);var T=0;for(s=1;s<=a;s++)T+=i[s-1]*_[s-1];for(s=1;s<=a;s++)n[s-1]=0!=T?i[s-1]*_[s-1]/T:0;return n}function n(e){var t=e.knot;return t[t.length-1]}function a(e){var t=e.cumulative_length;return t[t.length-1]}function o(e,t,r,_,n){var a=1-e;return t*a*a*a+3*r*a*a*e+3*_*a*e*e+n*e*e*e}t.create_spline=function(e){var t={},n=e.data,a=n.splines[0];if(!a||"NURBS"!=a.type||!a.use_endpoint_u)return null;var o=a.order_u;t.order=o;var i=a.points,s=function(e,t,r){r||(r=[]);var _=e+t,n=e+2;r[0]=0;for(var a=2;a<=_;a++)r[a-1]=a>t&&a<n?r[a-2]+1:r[a-2];return r}(i.length/5,o,[]);t.knot=s,"2D"==n.dimensions?t.is_3d=!1:"3D"==n.dimensions?t.is_3d=!0:r.panic("Wrong curve dimensions");for(var E=[],c=[],l=0;l<i.length;l+=5)E.push(i[l]),E.push(i[l+1]),E.push(i[l+2]),t.is_3d&&E.push(i[l+3]),c.push(i[l+4]);t.cpoints=E,t.weights=c,i=function(e,t,r){r||(r=[]);for(var n=e.cpoints,a=e.is_3d?4:3,o=e.weights,i=e.knot,s=e.order,E=n.length/a,c=E+s,l=0,T=i[c-1]/999,u=0;u<1e3;u++){i[c-1]-l<5e-6&&(l=i[c-1]);for(var d=_(s,l,i,o),f=0;f<a;f++){r[a*u+f]=0;for(var P=0;P<E;P++)r[a*u+f]+=d[P]*n[a*P+f]}l+=T}return r}(t,0,[]);var T=t.is_3d?4:3,u=new Float32Array(1e3);for(u[0]=0,l=1;l<1e3;l+=1){var d=i[(l-1)*T],f=i[(l-1)*T+1],P=i[(l-1)*T+2],A=i[l*T],S=i[l*T+1],p=i[l*T+2],m=Math.sqrt((A-d)*(A-d)+(S-f)*(S-f)+(p-P)*(p-P));u[l]=u[l-1]+m}return t.cumulative_length=u,t},t.spline_point=function(e,t,r){r||(r=[]),t=function(e,t){Math.max(t,0);var r=n(e);return Math.min(t,r)}(e,t);var a=e.cpoints,o=e.is_3d?4:3,i=e.weights,s=e.knot,E=e.order,c=a.length/o,l=c+E;s[l-1]-t<5e-6&&(t=s[l-1]);var T=new Float32Array(c);_(E,t,s,i,T);for(var u=0;u<o;u++){r[u]=0;for(var d=0;d<c;d++)r[u]+=T[d]*a[o*d+u]}return r},t.spline_derivative=function(e,t,r){r||(r=[]);var _=e.cpoints,n=e.is_3d?4:3,a=e.weights,o=e.knot,i=e.order,s=_.length/n,E=s+i;o[E-1]-t<5e-6&&(t=o[E-1]);var c=new Float32Array(s);!function(e,t,r,_,n){var a=_.length;n||(n=new Float32Array(a));var o=new Float32Array(a),i=new Float32Array(a);!function(e,t,r,_,n,a){n||(n=new Float32Array(e)),a||(a=new Float32Array(e));for(var o=e+t,i=new Float32Array(o),s=new Float32Array(o),E=1;E<=o-1;E++)i[E-1]=r>=_[E-1]&&r<_[E+1-1]?1:0;r==_[o-1]&&(i[e-1]=1);for(var c=2;c<=t;c++)for(E=1;E<=o-c;E++){if(0!=i[E-1])var l=(r-_[E-1])*i[E-1]/(_[E+c-1-1]-_[E-1]);else l=0;if(0!=i[E+1-1])var T=(_[E+c-1]-r)*i[E+1-1]/(_[E+c-1]-_[E+1-1]);else T=0;if(0!=i[E-1])var u=i[E-1]/(_[E+c-1-1]-_[E-1]);else u=0;if(0!=i[E+1-1])var d=-i[E+1-1]/(_[E+c-1]-_[E+1-1]);else d=0;if(0!=s[E-1])var f=(r-_[E-1])*s[E-1]/(_[E+c-1-1]-_[E-1]);else f=0;if(0!=s[E+1-1])var P=(_[E+c-1]-r)*s[E+1-1]/(_[E+c-1]-_[E+1-1]);else P=0;i[E-1]=l+T,s[E-1]=u+d+f+P}for(E=1;E<=e;E++)n[E-1]=i[E-1],a[E-1]=s[E-1]}(a,e,t,r,o,i);for(var s=0,E=1;E<=a;E++)s+=o[E-1]*_[E-1];var c=0;for(E=1;E<=a;E++)c+=i[E-1]*_[E-1];for(E=1;E<=a;E++)n[E-1]=0!=s?i[E-1]*_[E-1]/s+o[E-1]*_[E-1]*c/(s*s):0}(i,t,o,a,c);for(var l=0;l<n;l++){r[l]=0;for(var T=0;T<s;T++)r[l]+=c[T]*_[n*T+l]}return r},t.spline_max_t=n,t.spline_length=a,t.spline_len_to_t=function(e,t){if(t<=0)return 0;var r=n(e);if(t>=a(e))return r;var _=e.cumulative_length,o=pn(_,t,0,_.length-1);return r*(o+(t-_[o])/(_[o+1]-_[o]))/1e3},t.linear_interpolation=function(e,t,r,_,n){return r+(n-_)*(e-r)/(t-_)},t.linear=function(e,t,r){var _=t[0],n=t[1],a=(r[1]-n)/(r[0]-_);return a*e+(n-a*_)},t.bezier=function(e,t,r,_,n,a){return o(function e(t,r,_,n,a,i,s,E){var c=t+(r-t)/2,l=o(c,n,a,i,s)-_;return E=E||.01,Math.abs(l)<E?c:l>0?e(t,c,_,n,a,i,s,E):e(c,r,_,n,a,i,s,E)}(0,1,e,t[0],r[0],_[0],n[0],a),t[1],r[1],_[1],n[1])},t.calchandle_curvemap=function(e,t,r,_,n){var a=new Float32Array(3),o=new Float32Array(3),i=new Float32Array(3),s=new Float32Array(3),E=new Float32Array(3),c=new Float32Array(3);he(e[1],o),null==t?(he(r[1],i),a[0]=2*o[0]-i[0],a[1]=2*o[1]-i[1]):he(t[1],a),null==r?(he(t[1],a),i[0]=2*o[0]-a[0],i[1]=2*o[1]-a[1]):he(r[1],i),be(o,a,s),be(i,o,E);var l=De(s),T=De(E);if(0==l&&(l=1),0==T&&(T=1),"AUTO"==_||"AUTO"==n){c[0]=E[0]/T+s[0]/l,c[1]=E[1]/T+s[1]/l;var u=2.5614*De(c);0!=u&&("AUTO"==_&&we(o,c,-(l/=u),e[0]),"AUTO"==n&&we(o,c,T/=u,e[2]))}"VECTOR"==_&&we(o,s,-1/3,e[0]),"VECTOR"==n&&we(o,E,1/3,e[2])},t.correct_bezpart=function(e,t,r,_){var n,a,o,i,s=[],E=[];s[0]=e[0]-t[0],s[1]=e[1]-t[1],E[0]=_[0]-r[0],E[1]=_[1]-r[1],o=_[0]-e[0],(n=Math.abs(s[0]))+(a=Math.abs(E[0]))!=0&&n+a>o&&(t[0]=e[0]-(i=o/(n+a))*s[0],t[1]=e[1]-i*s[1],r[0]=_[0]-i*E[0],r[1]=_[1]-i*E[1])}}),ys=A("__textures",function(e,t){var r=ha(e),_=Us(e),n=Wo(e),a=ti(e),o=ws(e),i=Zo(e),s=ga(e),E=ri(e),c=Qi(e),l=Ms(e),T=os(e),u=xs(e),d=ps(e),f=n.defaults,P=n.context_limits,A=n.sfx,S=null,p=null,m=null;t.TF_NEAREST=0,t.TF_LINEAR=0,t.TF_NEAREST_MIPMAP_NEAREST=0,t.TF_LINEAR_MIPMAP_NEAREST=0,t.TF_NEAREST_MIPMAP_LINEAR=0,t.TF_LINEAR_MIPMAP_LINEAR=0,t.TT_RGBA_INT=10,t.TT_RGB_INT=20,t.TT_RGBA_FLOAT=30,t.TT_RGB_FLOAT=40,t.TT_DEPTH=50,t.TT_RB_RGBA=60,t.TT_RB_DEPTH=70,t.TT_RB_RGBA_MS=80,t.TT_RB_DEPTH_MS=90,t.CURVE_NODES_TEXT_SIZE=128,t.COLORRAMP_TEXT_SIZE=128,t.PART_COLORRAMP_TEXT_SIZE=128;var O,v={textures:[],loaded_status:[]},N={},g={},h=2,R=null,I=["TEXTURE_CUBE_MAP_POSITIVE_X","TEXTURE_CUBE_MAP_NEGATIVE_X","TEXTURE_CUBE_MAP_POSITIVE_Y","TEXTURE_CUBE_MAP_NEGATIVE_Y","TEXTURE_CUBE_MAP_POSITIVE_Z","TEXTURE_CUBE_MAP_NEGATIVE_Z"],b=[[2,0],[0,0],[2,1],[1,0],[1,1],[0,1]];function Y(){return m||(m=R.createFramebuffer()),m}function L(){return p||(p=R.createTexture()),p}function M(e,t,r){e.img_uuid=t.uuid,e.img_filepath=t.filepath,e.img_source=t.source,e.img_name=t.name,e.img_full_filepath=cs(r+t.filepath),e.img_comp_method=t._comp_method,-1==v.textures.indexOf(e)&&(v.textures.push(e),v.loaded_status.push(!1))}function x(e,t,r){var _=t.indexOf(".dds")>-1,n=t.indexOf(".pvr")>-1;e.img_comp_method=_?"dds":n?"pvr":"",e.img_filepath=t,e.img_full_filepath=r,e.img_uuid=zn(),v.textures.push(e),v.loaded_status.push(!0)}function y(e,r,_){var n={type:0,source:"",source_id:"",width:0,height:0,compress_ratio:1,anisotropic_filtering:0,source_size:1024,enable_canvas_mipmapping:!1,canvas_context:null,w_target:0,w_texture:null,w_renderbuffer:null,is_movie:!1,vtex_data_id:-1,video_file:null,video_tex_name:"",movie_length:0,fps:0,frame_start:0,frame_offset:0,frame_duration:0,need_resize:!1,scale_fac:1,use_mipmap:!1,mipmap_count:0,seq_video:null,seq_movie_length:0,seq_fps:0,seq_cur_frame:-1,seq_video_played:!1,seq_last_discrete_mark:-1,video_was_stopped:!1,use_auto_refresh:!1,use_cyclic:!1,use_nla:!1,repeat:!0,img_full_filepath:"",img_filepath:"",img_uuid:"",img_source:"",img_name:"",img_comp_method:""};if(n.type=e,n.source="NONE",n.use_mipmap=_,e==t.TT_RB_RGBA||e==t.TT_RB_DEPTH||e==t.TT_RB_RGBA_MS||e==t.TT_RB_DEPTH_MS)n.w_renderbuffer=R.createRenderbuffer();else{var a=R.TEXTURE_2D,o=R.createTexture();R.bindTexture(a,o),R.texParameteri(a,R.TEXTURE_MAG_FILTER,R.LINEAR),R.texParameteri(a,R.TEXTURE_MIN_FILTER,_?O[f.texture_min_filter]:R.LINEAR),R.texParameteri(a,R.TEXTURE_WRAP_S,R.CLAMP_TO_EDGE),R.texParameteri(a,R.TEXTURE_WRAP_T,R.CLAMP_TO_EDGE);var i=X(n),s=H(n),E=z(n);if(e==t.TT_DEPTH)var c=null;else c=e==t.TT_RGBA_FLOAT?new Float32Array([204,204,204,255]):new Uint8Array([204,204,204,255]);R.texImage2D(a,0,s,1,1,0,i,E,c),f.compared_mode_depth&&r&&R.texParameterf(a,R.TEXTURE_COMPARE_MODE,R.COMPARE_REF_TO_TEXTURE),R.bindTexture(a,null),n.w_target=a,n.w_texture=o}return n}function w(e){var t=e.w_target;R.bindTexture(t,e.w_texture);var r=X(e),_=H(e),n=z(e),a=e.canvas_context.canvas;R.pixelStorei(R.UNPACK_FLIP_Y_WEBGL,!0),R.texImage2D(t,0,_,r,n,a),R.pixelStorei(R.UNPACK_FLIP_Y_WEBGL,!1),e.enable_canvas_mipmapping&&R.generateMipmap(t),R.bindTexture(t,null),e.width=a.width,e.height=a.height}function U(e){var t=e.w_target;R.bindTexture(t,e.w_texture),R.pixelStorei(R.UNPACK_FLIP_Y_WEBGL,!0),4!=e.video_file.length?e.need_resize?F(e,e.video_file,e.width*e.scale_fac,e.height*e.scale_fac,!1):R.texImage2D(t,0,R.RGBA,R.RGBA,R.UNSIGNED_BYTE,e.video_file):R.texImage2D(t,0,R.RGBA,1,1,0,R.RGBA,R.UNSIGNED_BYTE,e.video_file),R.bindTexture(t,null)}function C(e){var t=e.w_target;R.bindTexture(t,e.w_texture),R.pixelStorei(R.UNPACK_FLIP_Y_WEBGL,!0),e.need_resize?F(e,e.seq_video[e.seq_cur_frame],e.width*e.scale_fac,e.height*e.scale_fac,!1):R.texImage2D(t,0,R.RGBA,R.RGBA,R.UNSIGNED_BYTE,e.seq_video[e.seq_cur_frame]),R.bindTexture(t,null)}function D(){return S||(S=document.createElement("canvas")),S}function F(e,t,r,_,n){n||(k(R.TEXTURE_2D),R.texImage2D(R.TEXTURE_2D,0,R.RGBA,R.RGBA,R.UNSIGNED_BYTE,t)),R.bindTexture(R.TEXTURE_2D,null);var a=Y(),o=L();c.draw_resized_texture(e,r,_,a,o,"NONE")}function G(e,t,r,_){for(var n=0;n<6;n++){var a=I[n],o=b[n],i=D();i.width=_,i.height=_;var s=i.getContext("2d");s.translate(_/2,_/2),"TEXTURE_CUBE_MAP_POSITIVE_X"==a?(s.rotate(Math.PI/2),s.scale(1,-1)):"TEXTURE_CUBE_MAP_NEGATIVE_X"==a?(s.rotate(Math.PI/2),s.scale(-1,1)):"TEXTURE_CUBE_MAP_POSITIVE_Y"==a||"TEXTURE_CUBE_MAP_POSITIVE_Z"==a?s.scale(1,-1):"TEXTURE_CUBE_MAP_NEGATIVE_Y"!=a&&"TEXTURE_CUBE_MAP_NEGATIVE_Z"!=a||s.scale(-1,1),s.drawImage(t,o[0]*r,o[1]*r,r,r,-_/2,-_/2,_,_),f.d3d9_canvas_resizing_hack?R.texImage2D(R[a],0,R.RGBA,_,_,0,R.RGBA,R.UNSIGNED_BYTE,new Uint8Array(s.getImageData(0,0,_,_).data.buffer)):R.texImage2D(R[a],0,R.RGBA,R.RGBA,R.UNSIGNED_BYTE,i)}}function k(e){R.bindTexture(e,null);var t,r=L();R.bindTexture(e,r),R.texParameteri(t=e,R.TEXTURE_WRAP_S,R.CLAMP_TO_EDGE),R.texParameteri(t,R.TEXTURE_WRAP_T,R.CLAMP_TO_EDGE),R.texParameteri(t,R.TEXTURE_MAG_FILTER,R.LINEAR),R.texParameteri(t,R.TEXTURE_MIN_FILTER,R.LINEAR)}function K(e,t,r){var n,l=e.source,T=e.w_texture,u=e.w_target,d=e.img_comp_method,S=e.img_filepath,p=1,m=1;if(R.bindTexture(u,T),e.repeat?(R.texParameteri(u,R.TEXTURE_WRAP_S,R.REPEAT),R.texParameteri(u,R.TEXTURE_WRAP_T,R.REPEAT)):(R.texParameteri(u,R.TEXTURE_WRAP_S,R.CLAMP_TO_EDGE),R.texParameteri(u,R.TEXTURE_WRAP_T,R.CLAMP_TO_EDGE)),R.texParameteri(u,R.TEXTURE_MIN_FILTER,e.is_movie||"NODE_TEX"==l?R.LINEAR:O[f.texture_min_filter]),e.anisotropic_filtering&&R.texParameterf(u,i.get_aniso().TEXTURE_MAX_ANISOTROPY_EXT,e.anisotropic_filtering),4==t.length){var v=!0;t=new Uint8Array([255*t[0],255*t[1],255*t[2],255*t[3]])}if("IMAGE"==l)if(v)R.texImage2D(u,0,R.RGBA,1,1,0,R.RGBA,R.UNSIGNED_BYTE,t),e.width=1,e.height=1;else if(d){var N=a.get_width_height(t,d),b=Ta(N.width)||Ta(N.height);if(V(N.width,N.height))return void s.error('Image "'+S+'" has unsupported size: '+N.width+"x"+N.height+". Max available: "+P.max_texture_size+"x"+P.max_texture_size+".");p=N.width,m=N.height,(b||"pvr"==d)&&(e.need_resize=!0,k(u),p=B(p*e.scale_fac),m=B(m*e.scale_fac)),"dds"==d?a.upload_dds_levels(R,i.get_s3tc(),t,!0):"pvr"==d&&a.upload_pvr_levels(R,i.get_pvr(),t,!0),e.need_resize&&(F(e,null,p,m,!0),R.bindTexture(u,T),R.generateMipmap(u)),e.width=p,e.height=m,e.compress_ratio=a.get_compress_ratio(t,d)}else{if(R.pixelStorei(R.UNPACK_FLIP_Y_WEBGL,!0),e.is_movie?f.seq_video_fallback?(p=t[0].width,m=t[0].height):(p=t.videoWidth,m=t.videoHeight):(p=t.width,m=t.height),e.width=p,e.height=m,V(p,m)&&(s.warn('Image "'+S+'" has unsupported size: '+p+"x"+m+". Max available: "+P.max_texture_size+"x"+P.max_texture_size+". Reduced image size will be used."),e.scale_fac=Math.min(P.max_texture_size/p,P.max_texture_size/m),e.need_resize=!0),e.is_movie)if(r in g||(g[r]={}),g[r][e.video_tex_name]=e,f.seq_video_fallback)e.seq_video=t,e.seq_movie_length=t.length,e.fps=e.seq_fps*e.movie_length/t.length,M=t[0];else{e.video_file=t,e.video_file.loop=e.use_cyclic,e.fps=t.duration?e.movie_length/t.duration:E.get_framerate(),A.disable_playback_rate_hack||(t.playbackRate=E.get_framerate()/e.fps,A.clamp_playback_rate_hack&&t.playbackRate>h&&(t.playbackRate=h));var M=t;(n=e).video_file.oncanplay=function(){Z(n)&&U(n)}}else M=t;if(p=B(e.width*e.scale_fac),m=B(e.height*e.scale_fac),e.need_resize||f.resize_texture_canvas_hack){var x=D(),y=x.getContext("2d");x.width=p,x.height=m,y.drawImage(M,0,0,e.width,e.height,0,0,p,m),f.d3d9_canvas_resizing_hack?R.texImage2D(u,0,R.RGBA,p,m,0,R.RGBA,R.UNSIGNED_BYTE,new Uint8Array(y.getImageData(0,0,p,m).data.buffer)):R.texImage2D(u,0,R.RGBA,R.RGBA,R.UNSIGNED_BYTE,x)}else f.webgl2||!Ta(e.width)&&!Ta(e.height)?R.texImage2D(u,0,R.RGBA,R.RGBA,R.UNSIGNED_BYTE,M):(F(e,M,p,m,!1),e.need_resize=!0);e.width=p,e.height=m,e.is_movie||(R.bindTexture(u,T),R.generateMipmap(u))}else if("ENVIRONMENT_MAP"==l)if(v){for(var w=0;w<6;w++)R.texImage2D(R["TEXTURE_CUBE_MAP_"+I[w]],0,R.RGBA,1,1,0,R.RGBA,R.UNSIGNED_BYTE,t);e.width=3,e.height=2}else{if(R.pixelStorei(R.UNPACK_FLIP_Y_WEBGL,!1),t.width%3||t.height%2)return void s.error('Cubemap Image "'+S+'" has unsupported size: '+t.width+"x"+t.height+". The width must be multiple of three and the height - multiple of two.");var C=t.width/3;if(C>P.max_cube_map_texture_size){s.warn('Cubemap Image "'+S+'" has unsupported size: '+t.width+"x"+t.height+". Max available: "+3*P.max_cube_map_texture_size+"x"+2*P.max_cube_map_texture_size+". Reduced image size will be used.");var K=B(C*(P.max_cube_map_texture_size/C));e.need_resize=!0}else K=B(C),!f.webgl2&&V(3*K,2*K)&&(e.need_resize=!0);e.need_resize||f.resize_cubemap_canvas_hack?G(0,t,C,K):function(e,t,r,_){k(R.TEXTURE_2D),R.texImage2D(R.TEXTURE_2D,0,R.RGBA,R.RGBA,R.UNSIGNED_BYTE,t),R.bindTexture(R.TEXTURE_2D,null);for(var n=0;n<6;n++)R.texImage2D(R.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,R.RGBA,r,r,0,R.RGBA,R.UNSIGNED_BYTE,null);R.bindTexture(e.w_target,null);var a=Y();R.bindFramebuffer(R.FRAMEBUFFER,a);var o=L();for(n=0;n<6;n++)c.draw_resized_cubemap_texture(e,R[I[n]],r,_,o,n);R.bindFramebuffer(R.FRAMEBUFFER,null),R.bindTexture(e.w_target,e.w_texture),R.texParameteri(e.w_target,R.TEXTURE_MIN_FILTER,O[f.texture_min_filter]),R.texParameteri(e.w_target,R.TEXTURE_MAG_FILTER,R.LINEAR)}(e,t,K,C),o.ff_cubemap_out_of_memory()&&(s.warn("Firefox detected, setting max cubemap size to 256, use canvas for resizing."),G(0,t,C,_.NVIDIA_OLD_GPU_CUBEMAP_MAX_SIZE)),e.width=3*K,e.height=2*K,R.generateMipmap(u)}else"NODE_TEX"==l&&(R.pixelStorei(R.UNPACK_FLIP_Y_WEBGL,!1),R.texImage2D(u,0,R.RGBA,t.width,t.height,0,R.RGBA,R.UNSIGNED_BYTE,t.data),e.width=t.width,e.height=t.height);R.bindTexture(u,null)}function B(e){return Ta(e)?Un(Math.pow(2,(0|e).toString(2).length),2,P.max_texture_size):e}function X(e){var _;switch(e.type){case t.TT_RGBA_INT:_=R.RGBA;break;case t.TT_RGB_INT:_=R.RGB;break;case t.TT_RGBA_FLOAT:_=R.RGBA;break;case t.TT_RGB_FLOAT:_=R.RGB;break;case t.TT_DEPTH:_=R.DEPTH_COMPONENT;break;default:r.panic("Wrong texture type")}return _}function H(e){var _;switch(e.type){case t.TT_RGBA_INT:_=f.webgl2?R.RGBA8:R.RGBA;break;case t.TT_RGB_INT:_=f.webgl2?R.RGB8:R.RGB;break;case t.TT_RGBA_FLOAT:_=f.webgl2?R.RGBA32F:R.RGBA;break;case t.TT_RGB_FLOAT:_=f.webgl2?R.RGB8:R.RGB;break;case t.TT_DEPTH:_=f.webgl2?Q(P.depth_bits):R.DEPTH_COMPONENT;break;default:r.panic("Wrong texture type")}return _}function Q(e){var t;switch(e){case 16:t=R.DEPTH_COMPONENT16;break;case 24:t=R.DEPTH_COMPONENT24;break;case 32:t=R.DEPTH_COMPONENT32F;break;default:t=R.DEPTH_COMPONENT24}return t}function z(e){var _;switch(e.type){case t.TT_RGBA_INT:case t.TT_RGB_INT:_=R.UNSIGNED_BYTE;break;case t.TT_RGBA_FLOAT:case t.TT_RGB_FLOAT:_=R.FLOAT;break;case t.TT_DEPTH:_=R.UNSIGNED_INT;break;default:r.panic("Wrong texture type")}return _}function V(e,t){return e>P.max_texture_size||t>P.max_texture_size}function j(e){e.video_file?e.video_file.play():e.seq_video&&(e.seq_video_played=!0),e.video_was_stopped=!1}function q(e){e.video_file?e.video_file.pause():e.seq_video&&(e.seq_video_played=!1),e.video_was_stopped=!0}function W(e){e.video_file?e.video_file.currentTime=e.frame_offset/e.fps:e.seq_video&&(e.seq_cur_frame=$(e,e.frame_offset),C(e))}function J(e){return e.video_file?!e.video_file.paused:!!e.seq_video&&e.seq_video_played}function Z(e){return e.video_file||e.seq_video?!e.video_file||e.video_file.readyState>=2:0}function $(e,t){return Math.round(t*e.seq_movie_length/e.movie_length)}function ee(e,t){if(T.is_dynamic(e))return re(e,t);for(var r=e.meta_objects,_=0;_<r.length;_++){var n=re(r[_],t);if(n)return n}return null}function te(e,t,r){if(T.is_dynamic(e))_e(e,t,r);else for(var _=e.meta_objects,n=0;n<_.length;n++)_e(_[n],t,r)}function re(e,t){var r=e.scenes_data;if(r.length)for(var _=r[0].batches,n=0;n<_.length;n++){var a=_[n];if("MAIN"==a.type||"SKY"==a.type)for(var o=0;o<a.textures.length;o++)if(a.bpy_tex_names[o]==t)return a.textures[o]}return null}function _e(e,t,r){var _=e.scenes_data;if(_.length)for(var n=_[0].batches,a=0;a<n.length;a++){var o=n[a];if("MAIN"==o.type)for(var i=0;i<o.textures.length;i++)if(o.bpy_tex_names[i]==t){var s=o.textures[i];o.textures[i]=r,ce(s)}}}function ne(e,t){var r=e.scenes_data;if(r.length)for(var _=r[0].batches,n=0;n<_.length;n++){var a=_[n];if("MAIN"==a.type)for(var o=0;o<a.textures.length;o++){var i=a.textures[o],s=a.bpy_tex_names[o];-1==t.indexOf(s)&&"NODE_TEX"!=i.source&&t.push(s)}}}function ae(e){var t={type:0,source:"",source_id:"",width:0,height:0,compress_ratio:1,anisotropic_filtering:0,source_size:1024,enable_canvas_mipmapping:!1,canvas_context:null,w_target:0,w_texture:null,w_renderbuffer:null,is_movie:!1,vtex_data_id:-1,video_file:null,video_tex_name:"",movie_length:0,fps:0,frame_start:0,frame_offset:0,frame_duration:0,need_resize:!1,scale_fac:1,use_mipmap:!1,mipmap_count:0,seq_video:null,seq_movie_length:0,seq_fps:0,seq_cur_frame:-1,seq_video_played:!1,seq_last_discrete_mark:-1,video_was_stopped:!1,use_auto_refresh:!1,use_cyclic:!1,use_nla:!1,repeat:!0,img_full_filepath:"",img_filepath:"",img_uuid:"",img_source:"",img_name:"",img_comp_method:""};t.source="CANVAS",t.width=e.width,t.height=e.height,t.enable_canvas_mipmapping=e.enable_canvas_mipmapping,t.type=e.type;var r=document.createElement("canvas");return r.width=t.width,r.height=t.height,t.canvas_context=r.getContext("2d"),t.w_target=R.TEXTURE_2D,t.w_texture=R.createTexture(),R.bindTexture(R.TEXTURE_2D,t.w_texture),R.texParameteri(R.TEXTURE_2D,R.TEXTURE_MIN_FILTER,t.enable_canvas_mipmapping?O[f.texture_min_filter]:R.LINEAR),R.texParameteri(R.TEXTURE_2D,R.TEXTURE_MAG_FILTER,R.LINEAR),R.bindTexture(R.TEXTURE_2D,null),t}function oe(e,t,r){for(var _=e.elements,n=e.interpolation,a=0;a<t;a++){var o=a/(t-1),i=se(_,o,!0),s=Ee(_,o,!0);i&&s&&("CONSTANT"==n?r.push.apply(r,i.color):ie(r,i,s,o)),s&&!i&&r.push.apply(r,s.color),i&&!s&&r.push.apply(r,i.color)}}function ie(e,t,r,_){if(t==r)e.push.apply(e,t.color);else{var n=u.linear_interpolation(r.color[0],r.position,t.color[0],t.position,_);e.push(n);var a=u.linear_interpolation(r.color[1],r.position,t.color[1],t.position,_);e.push(a);var o=u.linear_interpolation(r.color[2],r.position,t.color[2],t.position,_);e.push(o);var i=u.linear_interpolation(r.color[3],r.position,t.color[3],t.position,_);e.push(i)}}function se(e,t,r){for(var _=null,n=0;n<e.length;n++){if(r)var a=t-e[n].position;else a=t-e[n][1][0];if(a>=0)if(_){if(r)var o=t-_.position;else o=t-e[n][1][0];a<=o&&(_=e[n])}else _=e[n]}return _}function Ee(e,t,r){for(var _=null,n=0;n<e.length;n++){if(r)var a=e[n].position-t;else a=e[n][1][0]-t;if(a>=0)if(_){if(r)var o=_.position-t;else o=_[1][0]-t;a<=o&&(_=e[n])}else _=e[n]}return _}function ce(e){f.enable_texture_cache||function(e){for(var t=l.get_all_objects("ALL",l.DATA_ID_ALL),r=0;r<t.length;r++){var _=t[r];if(le(_,e))return!0;for(var n=_.meta_objects,a=0;a<n.length;a++)if(le(n[a],e))return!0}return!1}(e)||function(e){e.w_texture&&R.deleteTexture(e.w_texture);var t=v.textures.indexOf(e);-1!=t&&(v.textures.splice(t,1),v.loaded_status.splice(t,1))}(e)}function le(e,t){for(var r=0;r<e.scenes_data.length;r++)for(var _=e.scenes_data[r].batches,n=0;n<_.length;n++)for(var a=_[n].textures,o=0;o<a.length;o++)if(a[o]==t)return!0}function Te(e,t){for(var r=0;r<v.textures.length;r++){var _=v.textures[r];if(_.img_full_filepath==e&&_.type==t.type&&_.source==t.source&&_.repeat==t.repeat&&_.anisotropic_filtering==t.anisotropic_filtering&&_.use_nla==t.use_nla)return _}return null}t.setup_context=function(e){O=[e.NEAREST_MIPMAP_NEAREST,e.NEAREST_MIPMAP_LINEAR,e.LINEAR_MIPMAP_NEAREST,e.LINEAR_MIPMAP_LINEAR],t.TF_NEAREST=e.NEAREST,t.TF_LINEAR=e.LINEAR,t.TF_NEAREST_MIPMAP_NEAREST=e.NEAREST_MIPMAP_NEAREST,t.TF_LINEAR_MIPMAP_NEAREST=e.LINEAR_MIPMAP_NEAREST,t.TF_NEAREST_MIPMAP_LINEAR=e.NEAREST_MIPMAP_LINEAR,t.TF_LINEAR_MIPMAP_LINEAR=e.LINEAR_MIPMAP_LINEAR,R=e},t.get_canvas_context=function(e,t){return t in N&&e in N[t]?N[t][e].canvas_context:null},t.update_canvas_context=function(e,t){return t in N&&e in N[t]&&(w(N[t][e]),!0)},t.append_img_info=M,t.create_texture=y,t.create_cubemap_texture=function(e,r){var _=R.createTexture(),n=R.TEXTURE_CUBE_MAP;R.bindTexture(n,_),R.texParameteri(n,R.TEXTURE_MAG_FILTER,R.LINEAR),R.texParameteri(n,R.TEXTURE_MIN_FILTER,r?O[f.texture_min_filter]:R.LINEAR),R.texParameteri(n,R.TEXTURE_WRAP_S,R.CLAMP_TO_EDGE),R.texParameteri(n,R.TEXTURE_WRAP_T,R.CLAMP_TO_EDGE);for(var a=0;a<6;a++)R.texImage2D(R[I[a]],0,R.RGBA,e,e,0,R.RGBA,R.UNSIGNED_BYTE,null);R.bindTexture(n,null);var o={type:0,source:"",source_id:"",width:0,height:0,compress_ratio:1,anisotropic_filtering:0,source_size:1024,enable_canvas_mipmapping:!1,canvas_context:null,w_target:0,w_texture:null,w_renderbuffer:null,is_movie:!1,vtex_data_id:-1,video_file:null,video_tex_name:"",movie_length:0,fps:0,frame_start:0,frame_offset:0,frame_duration:0,need_resize:!1,scale_fac:1,use_mipmap:!1,mipmap_count:0,seq_video:null,seq_movie_length:0,seq_fps:0,seq_cur_frame:-1,seq_video_played:!1,seq_last_discrete_mark:-1,video_was_stopped:!1,use_auto_refresh:!1,use_cyclic:!1,use_nla:!1,repeat:!0,img_full_filepath:"",img_filepath:"",img_uuid:"",img_source:"",img_name:"",img_comp_method:""};return o.type=t.TT_RGBA_INT,o.source="NONE",o.width=3*e,o.height=2*e,o.compress_ratio=1,o.use_mipmap=r,o.w_texture=_,o.w_target=R.TEXTURE_CUBE_MAP,o},t.set_cubemap_tex_size=function(e,t){var r=e.w_target;R.bindTexture(r,e.w_texture);for(var _=0;_<6;_++)R.texImage2D(R[I[_]],0,R.RGBA,t,t,0,R.RGBA,R.UNSIGNED_BYTE,null);R.bindTexture(r,null),e.width=3*t,e.height=2*t},t.set_filters=function(e,t,r){var _=e.w_target;R.bindTexture(_,e.w_texture),t&&R.texParameteri(_,R.TEXTURE_MIN_FILTER,t),r&&R.texParameteri(_,R.TEXTURE_MAG_FILTER,r),R.bindTexture(_,null)},t.resize=function(e,_,n){if(_=Math.max(_,1),n=Math.max(n,1),e.width!=_||e.height!=n){switch(e.type){case t.TT_RB_RGBA:R.bindRenderbuffer(R.RENDERBUFFER,e.w_renderbuffer),R.renderbufferStorage(R.RENDERBUFFER,R.RGB565,_,n),R.bindRenderbuffer(R.RENDERBUFFER,null);break;case t.TT_RB_DEPTH:R.bindRenderbuffer(R.RENDERBUFFER,e.w_renderbuffer),R.renderbufferStorage(R.RENDERBUFFER,Q(P.depth_bits),_,n),R.bindRenderbuffer(R.RENDERBUFFER,null);break;case t.TT_RB_RGBA_MS:R.bindRenderbuffer(R.RENDERBUFFER,e.w_renderbuffer),R.renderbufferStorageMultisample(R.RENDERBUFFER,f.msaa_samples,R.RGBA8,_,n),R.bindRenderbuffer(R.RENDERBUFFER,null);break;case t.TT_RB_DEPTH_MS:R.bindRenderbuffer(R.RENDERBUFFER,e.w_renderbuffer),R.renderbufferStorageMultisample(R.RENDERBUFFER,f.msaa_samples,Q(P.depth_bits),_,n),R.bindRenderbuffer(R.RENDERBUFFER,null);break;default:var a=e.w_target;R.bindTexture(a,e.w_texture);var o=X(e),i=H(e),s=z(e);if(e.use_mipmap){if(!f.webgl2){var E=Math.max(_,n);_=B(E),n=B(E)}e.mipmap_count=Math.round(Math.log(Math.max(_,n))/Math.log(2)+.5)}R.texImage2D(a,0,i,_,n,0,o,s,null),R.bindTexture(a,null)}V(_,n)?r.panic('Slink texture "'+e.type+'" has unsupported size: '+_+"x"+n+". Max available: "+P.max_texture_size+"x"+P.max_texture_size+"."):(e.width=_,e.height=n)}},t.create_texture_bpy=function(e,r,_,n,a){var o=e.type;if("BLEND"==o)return null;var E=e.image,c={type:0,source:"",source_id:"",width:0,height:0,compress_ratio:1,anisotropic_filtering:0,source_size:1024,enable_canvas_mipmapping:!1,canvas_context:null,w_target:0,w_texture:null,w_renderbuffer:null,is_movie:!1,vtex_data_id:-1,video_file:null,video_tex_name:"",movie_length:0,fps:0,frame_start:0,frame_offset:0,frame_duration:0,need_resize:!1,scale_fac:1,use_mipmap:!1,mipmap_count:0,seq_video:null,seq_movie_length:0,seq_fps:0,seq_cur_frame:-1,seq_video_played:!1,seq_last_discrete_mark:-1,video_was_stopped:!1,use_auto_refresh:!1,use_cyclic:!1,use_nla:!1,repeat:!0,img_full_filepath:"",img_filepath:"",img_uuid:"",img_source:"",img_name:"",img_comp_method:""};if(c.type=t.TT_RGBA_INT,c.width=1,c.height=1,function(e,t,r){if(f.anisotropic_available){var _=t.b4w_anisotropic_filtering;if("DEFAULT"===_&&(_=r),"OFF"!==_&&f.anisotropic_filtering){var n=parseFloat(_.split("x")[0]);e.anisotropic_filtering=n}}}(c,e,r),function(e,t){("REPEAT"!=t.extension||t.b4w_shore_dist_map)&&(e.repeat=!1)}(c,e),E){"IMAGE"==o&&"MOVIE"==E.source&&function(e,t){e.is_movie=!0,e.video_tex_name=t.name,e.frame_start=t.frame_start,e.frame_offset=t.frame_offset,e.frame_duration=t.frame_duration,e.use_auto_refresh=t.use_auto_refresh,e.use_cyclic=t.use_cyclic,e.movie_length=t.movie_length,e.use_nla=t.b4w_nla_video,0!=e.frame_offset&&s.warn('Frame offset for texture "'+t.name+'" has a nonzero value. Can lead to undefined behaviour for mobile devices.')}(c,e),c.source=o;var l=Te(cs(a+E.filepath),c);if(l)return l;M(c,E,a)}var T=new Uint8Array([204,204,204,255]);switch(o){case"IMAGE":var u=R.createTexture();R.bindTexture(d=R.TEXTURE_2D,u),R.texImage2D(d,0,R.RGBA,1,1,0,R.RGBA,R.UNSIGNED_BYTE,T);break;case"NONE":if("NONE"==e.b4w_source_type)return null;u=R.createTexture();var d=R.TEXTURE_2D;if(c.source=e.b4w_source_type,"SCENE"==c.source){if(!e.b4w_source_id)return null;var P=J_("name",e.b4w_source_id,_);if(!P)return null;c.source_id=e.b4w_source_id,c.source_size=e.b4w_source_size,P._render_to_textures=P._render_to_textures||[],P._render_to_textures.push(c),R.bindTexture(d,u),R.texImage2D(d,0,R.RGBA,1,1,0,R.RGBA,R.UNSIGNED_BYTE,T)}else"CANVAS"==c.source&&(function(e,t,r){var _=t.b4w_source_id,n=t.b4w_source_size;e.source_id=_,e.enable_canvas_mipmapping=t.b4w_enable_canvas_mipmapping;var a=document.createElement("canvas");a.width=n,a.height=n,e.canvas_context=a.getContext("2d"),r in N||(N[r]={}),N[r][_]=e}(c,e,n),R.bindTexture(d,u));break;case"ENVIRONMENT_MAP":u=R.createTexture(),R.bindTexture(d=R.TEXTURE_CUBE_MAP,u);for(var A=["POSITIVE_X","NEGATIVE_X","POSITIVE_Y","NEGATIVE_Y","POSITIVE_Z","NEGATIVE_Z"],S=0;S<6;S++)R.texImage2D(R["TEXTURE_CUBE_MAP_"+A[S]],0,R.RGBA,1,1,0,R.RGBA,R.UNSIGNED_BYTE,T);break;default:return s.error('texture "'+e.name+'" has unsupported type "'+o+'"'),null}return c.w_texture=u,c.w_target=d,"NONE"==o?(R.texParameteri(d,R.TEXTURE_MIN_FILTER,c.enable_canvas_mipmapping?O[f.texture_min_filter]:R.LINEAR),c.anisotropic_filtering&&R.texParameterf(d,i.get_aniso().TEXTURE_MAX_ANISOTROPY_EXT,c.anisotropic_filtering),"CANVAS"==c.source&&w(c)):(R.generateMipmap(d),R.bindTexture(d,null)),c},t.update_texture_canvas=w,t.update_video_texture=U,t.update_seq_video_texture=C,t.update_texture=K,t.calc_pot_size=B,t.is_texture=function(e){return!(!e||!e.w_texture&&!e.w_renderbuffer)},t.is_renderbuffer=function(e){return!(!e||!e.w_renderbuffer)},t.is_float=function(e){return e.type==t.TT_RGBA_FLOAT||e.type==t.TT_RGB_FLOAT},t.get_texture_texel_size=function(e){var r=0;switch(e.type){case t.TT_RGBA_INT:case t.TT_RGB_INT:r=4;break;case t.TT_RGBA_FLOAT:case t.TT_RGB_FLOAT:r=32;break;case t.TT_DEPTH:r=3;break;case t.TT_RB_RGBA:case t.TT_RB_DEPTH:r=2;break;case t.TT_RB_RGBA_MS:r=4*f.msaa_samples;break;case t.TT_RB_DEPTH_MS:r=3*f.msaa_samples}return r},t.cleanup=function(){if(!f.seq_video_fallback)for(var e in g)for(var t in g[e])g[e][t].video_file.pause(),g[e][t].video_file.src="",g[e][t].video_file.load();v.textures.length=0,v.loaded_status.length=0,N={},g={}},t.pause=function(){for(var e in g)for(var t in g[e]){var r=g[e][t];J(r)&&q(r)}},t.reset=function(){for(var e in g)for(var t in g[e])W(g[e][t])},t.play=function(e){for(var t in g)for(var r in g[t]){var _=g[t][r];e&&!_.video_was_stopped||j(_)}},t.get_video_texture=function(e,t){return t in g&&e in g[t]?g[t][e]:null},t.video_allow_nla=function(e){return e.use_nla},t.play_video=j,t.pause_video=q,t.reset_video=W,t.set_frame_video=function(e,t,r){if(r in g&&e in g[r]){var _=g[r][e];return _.video_file?_.video_file.currentTime=t/_.fps:_.seq_video&&(_.seq_cur_frame=t,C(_)),!0}return!1},t.video_is_played=J,t.video_update_is_available=Z,t.video_get_current_frame=function(e){return e.video_file||e.seq_video?e.video_file?Math.round(e.video_file.currentTime*e.fps):e.seq_cur_frame:0},t.video_get_start_frame=function(e){return e.video_file||e.seq_video?e.video_file?e.frame_offset:$(e,e.frame_offset):0},t.video_get_end_frame=function(e){if(!e.video_file&&!e.seq_video)return 0;var t=Math.min(e.frame_duration,e.movie_length-e.frame_offset);return e.video_file?e.frame_offset+t:$(e,e.frame_offset+t)},t.seq_video_get_discrete_timemark=function(e,t){return Math.round(t*e.seq_fps*(E.get_framerate()/e.fps))},t.video_get_duration=function(e){return Math.min(e.frame_duration,e.movie_length-e.frame_offset)},t.video_frame_to_seq_frame=$,t.get_canvas_context_by_object=function(e,t){var r=ee(e,t);return r&&"CANVAS"==r.source?r.canvas_context:null},t.get_texture_by_name=ee,t.set_texture_by_name=te,t.get_texture_names=function(e){var t=[];if(T.is_dynamic(e))ne(e,t);else for(var r=e.meta_objects,_=0;_<r.length;_++)ne(r[_],t);return t},t.share_batch_canvas_textures=function(e){for(var t={},r=0;r<e.length;r++){for(var _=e[r].textures,n=e[r].texture_names,a=[],o=[],i=0;i<_.length;i++){var s=_[i],E=n[i];"CANVAS"==s.source&&(E in t?s=t[E]:((c=s=ae(_[i])).canvas_context.drawImage(_[i].canvas_context.canvas,0,0),w(c),t[E]=s)),a.push(s),o.push(E)}e[r].textures=a}var c},t.extract_col_ramps_data=function(e,t){for(var r=[],_=0;_<e.length;_++)oe(e[_].data.value.color_ramp,t,r);return new Uint8Array(r.map(function(e){return Un(255*e,0,255)}))},t.calc_color_ramp_data=oe,t.extract_vec_curves_data=function(e,t){for(var r=new Float32Array(3),_=new Float32Array(3),n=[],a=0;a<e.length;a++){for(var o=e[a].data.value,i=[],s=o.curve_mapping.curves_data,E=o.curve_mapping.curve_extend,c=o.curve_mapping.curves_handle_types,l=0;l<s.length;l++){for(var T=E[l],d=s[l],f=[],P=c[l],A=0;A<d.length;A++)f.push([new Float32Array(3),new Float32Array(d[A].concat(0)),new Float32Array(3)]);for(u.calchandle_curvemap(f[0],null,f[1],P[0],P[0]),A=1;A<f.length-1;A++)u.calchandle_curvemap(f[A],f[A-1],f[A+1],P[A],P[A]);if(u.calchandle_curvemap(f[f.length-1],f[f.length-2],null,P[f.length-1],P[f.length-1]),f.length>2){if("AUTO"==P[0]){be(f[0][2],f[0][1],r);var S=De(r);he(f[1][0],_),_[0]<f[0][1][0]&&(_[0]=f[0][1][0]),be(_,f[0][1],_),(p=De(_))>1e-8&&(ye(_,S/p,_),Ie(f[0][1],_,f[0][2]),be(f[0][1],_,f[0][0]))}var p,m=f.length-1;"AUTO"==P[0]&&(be(f[m][0],f[m][1],r),S=De(r),he(f[m-1][2],_),_[0]>f[m][1][0]&&(_[0]=f[m][1][0]),be(_,f[m][1],_),(p=De(_))>1e-8&&(ye(_,S/p,_),Ie(f[m][1],_,f[m][0]),be(f[m][1],_,f[m][2])))}for(m=0;m<f.length-1;m++)u.correct_bezpart(f[m][1],f[m][2],f[m+1][0],f[m+1][1]);var O=[];if(s.length<=3)var v=Math.round(-t/2),N=Math.round(t/2);else v=0,N=t;for(A=v;A<N;A++){var g=A/(N-1),h=se(f,g,!1),R=Ee(f,g,!1);if(h&&R)O.push(u.bezier(g,h[1],h[2],R[0],R[1],.001));else if(R&&!h)if("EXTRAPOLATED"==T){var I=R[1][0]==R[2][0]?R[1][1]:u.linear(g,R[1],R[2]);O.push(I)}else O.push(R[1][1]);else h&&!R&&("EXTRAPOLATED"==T?(I=h[0][0]==h[1][0]?h[1][1]:u.linear(g,h[0],h[1]),O.push(I)):O.push(h[1][1]))}i.push(O)}n.push(i)}var b=[];for(A=0;A<n.length;A++)for(i=n[A],l=0;l<i[0].length;l++){if(i.length<=3){var Y=Un(127.5*(i[0][l]+1),0,255),L=Un(127.5*(i[1][l]+1),0,255),M=Un(127.5*(i[2][l]+1),0,255);m=255}else Y=Un(255*i[0][l],0,255),L=Un(255*i[1][l],0,255),M=Un(255*i[2][l],0,255),m=Un(255*i[3][l],0,255);b.push(Y,L,M,m)}return new Uint8Array(b)},t.create_color_ramp_texture=function(e,r){var _=y(t.TT_RGBA_INT,!1);return _.source="NODE_TEX",_.repeat=!1,K(_,{width:r,height:e.length/(4*r),data:e}),_},t.change_image=function(e,t,r,_,n){var a=cs(n);if("WORLD"!=e.type){var o=Te(a,t);if(o)var i=o;else!function(e,t){R.bindTexture(e.w_target,e.w_texture);var r=R.getTexParameter(e.w_target,R.TEXTURE_MAG_FILTER),_=R.getTexParameter(e.w_target,R.TEXTURE_MIN_FILTER),n=R.getTexParameter(e.w_target,R.TEXTURE_WRAP_S),a=R.getTexParameter(e.w_target,R.TEXTURE_WRAP_T);t.w_texture=R.createTexture(),R.bindTexture(t.w_target,t.w_texture),R.texParameteri(t.w_target,R.TEXTURE_MAG_FILTER,r),R.texParameteri(t.w_target,R.TEXTURE_MIN_FILTER,_),R.texParameteri(t.w_target,R.TEXTURE_WRAP_S,n),R.texParameteri(t.w_target,R.TEXTURE_WRAP_T,a),R.bindTexture(t.w_target,null)}(t,i=function(e){var t={type:0,source:"",source_id:"",width:0,height:0,compress_ratio:1,anisotropic_filtering:0,source_size:1024,enable_canvas_mipmapping:!1,canvas_context:null,w_target:0,w_texture:null,w_renderbuffer:null,is_movie:!1,vtex_data_id:-1,video_file:null,video_tex_name:"",movie_length:0,fps:0,frame_start:0,frame_offset:0,frame_duration:0,need_resize:!1,scale_fac:1,use_mipmap:!1,mipmap_count:0,seq_video:null,seq_movie_length:0,seq_fps:0,seq_cur_frame:-1,seq_video_played:!1,seq_last_discrete_mark:-1,video_was_stopped:!1,use_auto_refresh:!1,use_cyclic:!1,use_nla:!1,repeat:!0,img_full_filepath:"",img_filepath:"",img_uuid:"",img_source:"",img_name:"",img_comp_method:""};return t.type=e.type,t.anisotropic_filtering=e.anisotropic_filtering,t.source=e.source,t.source_id=e.source_id,t.width=e.width,t.height=e.height,t.compress_ratio=e.compress_ratio,t.source_size=e.source_size,t.enable_canvas_mipmapping=e.enable_canvas_mipmapping,t.canvas_context=e.canvas_context,t.w_target=e.w_target,t.w_texture=e.w_texture,t.w_renderbuffer=e.w_renderbuffer,t.is_movie=e.is_movie,t.vtex_data_id=e.vtex_data_id,t.video_file=e.video_file,t.video_tex_name=e.video_tex_name,t.movie_length=e.movie_length,t.fps=e.fps,t.frame_start=e.frame_start,t.frame_offset=e.frame_offset,t.frame_duration=e.frame_duration,t.need_resize=e.need_resize,t.scale_fac=e.scale_fac,t.seq_video=e.seq_video,t.seq_movie_length=e.seq_movie_length,t.seq_fps=e.seq_fps,t.seq_cur_frame=e.seq_cur_frame,t.seq_video_played=e.seq_video_played,t.seq_last_discrete_mark=e.seq_last_discrete_mark,t.video_was_stopped=e.video_was_stopped,t.use_auto_refresh=e.use_auto_refresh,t.use_cyclic=e.use_cyclic,t.use_nla=e.use_nla,t.repeat=e.repeat,t.img_filepath=e.img_filepath,t.img_full_filepath=e.img_full_filepath,t.img_uuid=e.img_uuid,t.img_source=e.img_source,t.img_name=e.img_name,t.img_comp_method=e.img_comp_method,t}(t)),x(i,n,a),K(i,_,0);te(e,r,i)}else x(i=t,n,a),K(i,_,0),d.update_cube_sky_dim(e,i),d.update_sky_texture(e)},t.cleanup_unused=ce,t.get_batch_texture=function(e){return e.texture._render},t.reset_mod=function(){R=null},t.get_img_textures=function(){return v.textures},t.get_cache_loaded_status=function(e){var t=v.textures.indexOf(e);return-1!=t&&v.loaded_status[t]},t.set_cache_loaded_status=function(e,t){var r=v.textures.indexOf(e);-1!=r&&(v.loaded_status[r]=t)}}),ws=A("__debug_check",function(e,t){var r=ha(e),_=Wo(e),n=ga(e),a=ys(e),o=_.defaults,i=-1,s=-1,E=null,c=[];t.setup_context=function(e){for(var t=["INVALID_ENUM","INVALID_VALUE","INVALID_OPERATION","OUT_OF_MEMORY","INVALID_FRAMEBUFFER_OPERATION","CONTEXT_LOST_WEBGL"],r=0;r<t.length;r++){var _=t[r];_ in e&&(c[e[_]]=_)}E=e},t.browser=function(e){switch(e.toLowerCase()){case"chrome":return l("mozilla")&&l("applewebkit")&&l("chrome");case"firefox":return l("mozilla")&&l("gecko")&&l("firefox");case"msie":return l("mozilla")&&l("trident")&&l("msie");case"opera":return l("opera")&&l("presto");case"safari":return l("mozilla")&&l("applewebkit")&&l("safari")&&!l("chrome");default:return!1}};var l=function(e){return navigator.userAgent.toLowerCase().indexOf(e)>-1};t.finite=function(e){if(kn(e)){for(var t=0;t<e.length;t++)if(!isFinite(e[t]))return!1;return Boolean(e.length)}return!!isFinite(e)},t.gl=function(e){if(o.gl_debug){var t=E.getError();t!=E.NO_ERROR&&r.panic(t in c?"GL Error: "+t+", gl."+c[t]+" ("+e+")":"Unknown GL error: "+t+" ("+e+")")}},t.bound_fb=function(){if(!o.gl_debug&&!o.check_framebuffer_hack)return!0;switch(E.checkFramebufferStatus(E.FRAMEBUFFER)){case E.FRAMEBUFFER_COMPLETE:return!0;case E.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return n.error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT"),!1;case E.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return n.error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT"),!1;case E.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return n.error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS"),!1;case E.FRAMEBUFFER_UNSUPPORTED:return n.error("Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED"),!1;case E.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:return n.error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MULTISAMPLE"),!1;default:return n.error("FRAMEBUFFER CHECK FAILED"),!1}},t.depth_only_issue=function(){if(-1!=s)return s;var e=E.createFramebuffer();E.bindFramebuffer(E.FRAMEBUFFER,e);var t=a.create_texture(a.TT_DEPTH,!1);return a.resize(t,1,1),E.framebufferTexture2D(E.FRAMEBUFFER,E.DEPTH_ATTACHMENT,t.w_target,t.w_texture,0),E.checkFramebufferStatus(E.FRAMEBUFFER)!=E.FRAMEBUFFER_COMPLETE?(s=!0,n.warn("depth-only issue was found")):s=!1,E.bindFramebuffer(E.FRAMEBUFFER,null),E.deleteFramebuffer(e),s},t.multisample_issue=function(){if(1==o.msaa_samples)return!1;if(-1!=i)return i;var e=E.createRenderbuffer();E.bindRenderbuffer(E.RENDERBUFFER,e),E.renderbufferStorageMultisample(E.RENDERBUFFER,o.msaa_samples,E.RGBA8,1,1);var t=E.getRenderbufferParameter(E.RENDERBUFFER,E.RENDERBUFFER_SAMPLES);return t!=o.msaa_samples?(i=!0,n.warn("multisample issue was found: requested "+o.msaa_samples+", got "+t),E.getError()==E.INVALID_OPERATION&&n.warn("the error from multisample issue detected, ignoring")):i=!1,E.bindRenderbuffer(E.RENDERBUFFER,null),i},t.ff_cubemap_out_of_memory=function(){return!(!l("firefox")||E.getError()!=E.OUT_OF_MEMORY||(n.warn("Firefox/old GPUs cubemap issue was found."),0))},t.reset=function(){E=null}}),Us=A("__compat",function(e,t){var r=Wo(e),_=ws(e),n=Zo(e),a=ga(e),o=Qi(e),i=["R600","RV610","RV630","RV620","RV635","RV670","RS780","RS880","RV770","RV730","RV710","RV740","CEDAR","REDWOOD","JUNIPER","CYPRESS","PALM (Wrestler/Ontario)","SUMO (Llano)","SUMO2 (Llano)","ARUBA (Trinity/Richland)","BARTS","TURKS","CAICOS","CAYMAN"];t.NVIDIA_OLD_GPU_CUBEMAP_MAX_SIZE=256;var s=r.animation,E=r.defaults,c=r.debug_subs,l=r.context,T=r.context_limits,u=r.sfx,d=r.physics,f=r.assets;function P(e){return navigator.userAgent.indexOf(e)>-1}function A(){return navigator.userAgent.match(/Windows Phone/i)||navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)}function S(){return!window.ActiveXObject&&"ActiveXObject"in window}t.detect_tegra_invalid_enum_issue=function(e){e.getError()==e.INVALID_ENUM&&a.warn("Possible Tegra invalid enum issue detected, ignoring")},t.set_hardware_defaults=function(e,p){var m=function(e){p&&a.warn(e)};T.max_combined_texture_image_units=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS),T.max_fragment_uniform_vectors=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),T.max_texture_image_units=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),T.max_varying_vectors=e.getParameter(e.MAX_VARYING_VECTORS),T.max_vertex_attribs=e.getParameter(e.MAX_VERTEX_ATTRIBS),T.max_vertex_texture_image_units=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),T.max_vertex_uniform_vectors=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),T.max_cube_map_texture_size=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),T.max_renderbuffer_size=e.getParameter(e.MAX_RENDERBUFFER_SIZE),T.max_texture_size=e.getParameter(e.MAX_TEXTURE_SIZE),T.max_viewport_dims=e.getParameter(e.MAX_VIEWPORT_DIMS);var O=n.get_renderer_info();if(O){var v=e.getParameter(O.UNMASKED_VENDOR_WEBGL),N=e.getParameter(O.UNMASKED_RENDERER_WEBGL);v.indexOf("Qualcomm")>-1&&N.indexOf("330")>-1&&(P("Chrome")||P("Firefox"))&&(m("Chrome/Firefox and Qualcomm 330 detected, force enable WebGL 1, disable blending cascaded shadow maps."),E.webgl2=!1,E.chrome_csm_blend_hack=!0)}T.depth_bits=E.webgl2?24:16,E.webgl2&&!c.enabled&&(E.compared_mode_depth=!0),E.webgl2?(E.msaa_samples=Math.min(E.msaa_samples,e.getParameter(e.MAX_SAMPLES)),P("Firefox")&&(m("Firefox and WebGL 2 detected, applying framebuffer hack."),E.check_framebuffer_hack=!0),P("Windows")&&P("Chrome")&&(m("Windows, Chrome and WebGL 2 detected, applying multisample hack, disabling MSAA."),E.msaa_samples=1)):E.msaa_samples=1,P("Firefox")&&"NONE"!==E.stereo&&(m("Firefox and Stereo rendering detected, disable texture reusage"),E.firefox_tex_reuse_hack=!0),(E.webgl2&&_.multisample_issue()||P("Firefox"))&&(m("Firefox detected, disabling multisample"),E.msaa_samples=1),P("Mac OS X")&&P("Chrome/60")&&(m("macOS and Chrome 60 detected, disabling multisample"),E.msaa_samples=1),o.set_draw_methods();var g=Boolean(n.get_depth_texture());if(P("Firefox/28.0")&&(P("Linux")||P("Macintosh"))&&(m("Firefox 28 detected, applying depth hack"),g=!1),P("Windows Phone")||(P("iPad")||P("iPhone")?(m("iOS detected, applying alpha hack, applying vertex animation mix normals hack, disable smaa. Disable ssao for performance. Initialize WebAudio context with empty sound. Applying glow hack."),l.alpha||(E.background_color[3]=1),E.ios_copy_tex_hack=!0,E.vert_anim_mix_normals_hack=!0,E.smaa=!1,E.ssao=!1,E.init_wa_context_hack=!0,Boolean(n.get_pvr())&&f.pvr_available&&(E.compress_format="pvr")):P("Mac OS X")&&P("Safari")&&!P("Chrome")&&(m("OS X / Safari detected, force to wait complete loading. Applying playback rate hack for video textures. Applying canvas alpha hack."),E.safari_canvas_alpha_hack=!0,u.audio_loading_hack=!0,u.clamp_playback_rate_hack=!0)),P("Windows")&&(P("Chrome/40")||P("Firefox/33")||P("Firefox/34")||P("Firefox/35")||P("Firefox/36"))&&(m("Windows/Chrome40 or Firefox33-36 detected. Applying clear procedural skydome hack."),E.clear_procedural_sky_hack=!0),P("Chrome")&&!A()&&r.is_built_in_data()&&(m('Chrome (non-mobile) was detected for a single HTML-exported file. "Background Music" speakers were changed to "Background Sound".'),E.chrome_html_bkg_music_hack=!0),P("Mac OS X")&&(E.mac_os_shadow_hack=!0,m("OS X detected, applying shadows hack")),A()&&(m("Mobile detected, applying various hacks for video textures."),E.is_mobile_device=!0,P("iPad")||P("iPhone")||P("Windows Phone")||(m("Mobile (not iOS) detected, disable playback rate for video textures."),u.disable_playback_rate_hack=!0)),P("iPad")&&(m('iPad detected, use "autoplay" hack for video textures.'),E.ipad_video_hack=!0),(P("Firefox/35.0")||P("Firefox/36.0"))&&P("Windows")&&(m("Windows/Firefox 35/36 detected, applying shadows slink hack"),E.shadows_color_slink_hack=!0),(P("iPhone")||S())&&(m("iPhone or IE11 detected. Enable sequential video fallback for video textures."),E.seq_video_fallback=!0),T.max_varying_vectors<10&&(m("Not enough varyings, disable shadows on blend objects"),E.disable_blend_shadows_hack=!0),P("Windows Phone")&&(m("Windows Phone detected. Disable debug view mode, glow materials, ssao, smaa, shadows, reflections, refractions."),E.debug_view=!1,E.glow_materials=!1,E.ssao=!1,E.smaa=!1,E.shadows=!1,E.reflections=!1,E.refractions=!1,E.quality_aa_method=!1),(P("UCBrowser")||P("Chrome")&&P("Nexus")&&E.is_mobile_device)&&(m("Mobile Nexus Chrome or UCBrowser detected, disable workers."),d.use_workers=!1),P("Firefox")&&(m("Firefox detected, disabling workers"),d.use_workers=!1),(S()||P("Edge"))&&(m("IE11 or Edge detected, disabling workers"),d.use_workers=!1),P("Chrome")&&P("Linux")&&(m("Chrome and Linux detected, disabling wasm physics."),d.use_wasm=!1),O){v=e.getParameter(O.UNMASKED_VENDOR_WEBGL),N=e.getParameter(O.UNMASKED_RENDERER_WEBGL),v.indexOf("Intel")&&(N.indexOf("3000")>-1||N.indexOf("2000")>-1)&&(E.reuse_depth_optimization=!1,m("Intel HD Graphics 2000/3000 detected, disable depth reuse.")),P("Chrome")&&N.indexOf("Mali-T720")>-1&&(m('Chrome and ARM Mali-T720 detected, changing "Alpha Anti-Aliasing" materials to "Alpha Clip".'),E.mali_alpha_antialias_hack=!0),N.indexOf("AMD")>-1&&P("Windows")&&P("Firefox")&&(m("AMD, Windows and Firefox detected, disabling depth textures."),g=!1),v.indexOf("ARM")>-1&&/\b4\d{2}\b/.test(N)&&(m("ARM Mali-400 series detected, applying lamps, depth and frames blending hacks"),g=!1,s.frames_blending_hack=!0,E.mali4_lamps_hack=!0),v.indexOf("ARM")>-1&&N.indexOf("Mali-T604")>-1&&(m("ARM Mali-T604 detected, disabling shadows."),E.shadows=!1),v.indexOf("ARM")>-1&&N.indexOf("Mali-T760")>-1&&(m("ARM Mali-T760 detected, disabling SSAO."),E.ssao=!1,E.skinning_hack=!0,E.webgl2&&(E.msaa_samples=1,m("ARM Mali-T760 and WebGL 2 detected, switching MSAA samples to 1."))),v.indexOf("ARM")>-1&&N.indexOf("Mali-T720")>-1&&(m("ARM Mali-T720 detected, disabling depth textures."),g=!1,E.webgl2&&(E.msaa_samples=1,m("ARM Mali-T720 and WebGL 2 detected, switching MSAA samples to 1."))),v.indexOf("Qualcomm")>-1&&N.indexOf("Adreno")>-1&&(m("Qualcomm Adreno detected, applying shader constants hack."),E.shader_constants_hack=!0,N.indexOf("420")>-1&&(m("Qualcomm Adreno420 detected, setting max cubemap size to 12288x8192, setting max texture size to 4096x4096."),T.max_texture_size=Math.min(T.max_texture_size,4096),T.max_cube_map_texture_size=Math.min(T.max_cube_map_texture_size,4096)),P("Chrome")&&(N.match(/4../)||N.match(/5../))&&(m("Qualcomm Adreno 4xx or 5xx detected, switch MSAA samples to 1."),E.msaa_samples=1)),v.indexOf("NVIDIA")>-1&&N.indexOf("Tegra 3")>-1&&(m("NVIDIA Tegra 3 detected, force low quality for B4W_LEVELS_OF_QUALITY nodes."),E.force_low_quality_nodes=!0),P("Windows")&&P("Chrome")&&!P("Edge")&&(N.match(/NVIDIA GeForce 8..0/)||N.match(/NVIDIA GeForce 9..0/)||N.match(/NVIDIA GeForce( (G|GT|GTS|GTX))? 2../))&&(m("Chrome / Windows / NVIDIA GeForce 8/9/200 series detected, setting max cubemap size to 768x512, use canvas for resizing."),T.max_cube_map_texture_size=t.NVIDIA_OLD_GPU_CUBEMAP_MAX_SIZE,E.resize_cubemap_canvas_hack=!0),N.indexOf("PowerVR")>-1&&N.indexOf("SGX")>-1&&(m("PowerVR SGX series detected, use canvas for resizing. Disable shadows. Apply skinning hack, disable skin blending between frames."),E.resize_cubemap_canvas_hack=!0,E.skinning_hack=!0,E.shadows=!1),P("Windows")&&N.indexOf("Direct3D9")>-1&&(m("DirectX 9.0 detected, using canvas for resizing textures/cubemap textures."),E.d3d9_canvas_resizing_hack=!0,E.resize_cubemap_canvas_hack=!0,E.resize_texture_canvas_hack=!0);for(var h="",R=0;R<i.length;R++)if(N.indexOf(i[R])>-1){h=i[R];break}h&&(m("Architecture "+h+" detected. Blending between frames and shadows on blend objects will be disabled."),E.skinning_hack=!0,E.disable_blend_shadows_hack=!0)}if(0==T.max_vertex_texture_image_units&&(m("Vertex textures are not allowed. Disabling vertex textures"),E.allow_vertex_textures=!1),g||(E.foam=!1,E.dynamic_grass=!1,E.water_dynamic=!1,E.shore_smoothing=!1,E.shore_distance=!1,E.smaa=!1,E.ssao=!1,E.rgba_fallback_shadows=!0),E.use_compression=Boolean(n.get_s3tc())||"pvr"==E.compress_format,E.depth_tex_available=g,e.getShaderPrecisionFormat)var I=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT);e.getShaderPrecisionFormat&&0!==I.precision||(E.precision="mediump"),(S()&&P("Touch")||P("Edge"))&&(m("IE11 and touchscreen or Edge detected. Behaviour of the mouse move sensor will be changed."),E.ie11_edge_touchscreen_hack=!0),(S()||P("Edge"))&&(E.ie_edge_anchors_floor_hack=!0,E.ie11_edge_mouseoffset_hack=!0,E.resize_cubemap_canvas_hack=!0),A()&&P("Firefox")&&(a.log("Mobile firefox detected. Applying autoplay media hack.Setting max cubemap size to 12288x8192, setting max texture size to 4096x4096."),E.mobile_firefox_media_hack=!0,T.max_texture_size=Math.min(T.max_texture_size,4096),T.max_cube_map_texture_size=Math.min(T.max_cube_map_texture_size,4096));var b=Boolean(n.get_aniso());E.anisotropic_available=b;var Y=Boolean(n.get_texture_lod());E.texture_lod_available=Y;var L=Boolean(n.get_texture_float());E.tex_float_available=L;var M=Boolean(n.get_texture_half_float());E.tex_hfloat_available=M;var x=Boolean(n.get_texture_float_linear());E.tex_float_lin_available=x;var y=Boolean(n.get_texture_half_float_linear());E.tex_hfloat_lin_available=y;var w=Boolean(n.get_color_buffer_float());E.cbuffer_float_available=w;var U=Boolean(n.get_color_buffer_half_float());E.cbuffer_hfloat_available=U},t.check_user_agent=P,t.detect_mobile=A,t.apply_context_alpha_hack=function(){P("Firefox/35.0")&&P("Windows")&&(a.warn("Windows/Firefox 35 detected, forcing context's alpha"),r.context.alpha=!0)},t.is_ie11=S});!function(e){("undefined"!=typeof window?window:"undefined"!=typeof self?self:this).pako=function e(t,r,_){function n(o,i){if(!r[o]){if(!t[o]){var s="function"==typeof Ys&&Ys;if(!i&&s)return s(o,!0);if(a)return a(o,!0);var E=new Error("Cannot find module '"+o+"'");throw E.code="MODULE_NOT_FOUND",E}var c=r[o]={exports:{}};t[o][0].call(c.exports,function(e){return n(t[o][1][e]||e)},c,c.exports,e,t,r,_)}return r[o].exports}for(var a="function"==typeof Ys&&Ys,o=0;o<_.length;o++)n(_[o]);return n}({1:[function(e,t,r){var _="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;r.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var r=t.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(var _ in r)r.hasOwnProperty(_)&&(e[_]=r[_])}}return e},r.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var n={arraySet:function(e,t,r,_,n){if(t.subarray&&e.subarray)e.set(t.subarray(r,r+_),n);else for(var a=0;a<_;a++)e[n+a]=t[r+a]},flattenChunks:function(e){var t,r,_,n,a,o;for(_=0,t=0,r=e.length;t<r;t++)_+=e[t].length;for(o=new Uint8Array(_),n=0,t=0,r=e.length;t<r;t++)o.set(a=e[t],n),n+=a.length;return o}},a={arraySet:function(e,t,r,_,n){for(var a=0;a<_;a++)e[n+a]=t[r+a]},flattenChunks:function(e){return[].concat.apply([],e)}};r.setTyped=function(e){e?(r.Buf8=Uint8Array,r.Buf16=Uint16Array,r.Buf32=Int32Array,r.assign(r,n)):(r.Buf8=Array,r.Buf16=Array,r.Buf32=Array,r.assign(r,a))},r.setTyped(_)},{}],2:[function(e,t,r){var _=e("./common"),n=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch(e){n=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){a=!1}for(var o=new _.Buf8(256),i=0;i<256;i++)o[i]=i>=252?6:i>=248?5:i>=240?4:i>=224?3:i>=192?2:1;function s(e,t){if(t<65537&&(e.subarray&&a||!e.subarray&&n))return String.fromCharCode.apply(null,_.shrinkBuf(e,t));for(var r="",o=0;o<t;o++)r+=String.fromCharCode(e[o]);return r}o[254]=o[254]=1,r.string2buf=function(e){var t,r,n,a,o,i=e.length,s=0;for(a=0;a<i;a++)55296==(64512&(r=e.charCodeAt(a)))&&a+1<i&&56320==(64512&(n=e.charCodeAt(a+1)))&&(r=65536+(r-55296<<10)+(n-56320),a++),s+=r<128?1:r<2048?2:r<65536?3:4;for(t=new _.Buf8(s),o=0,a=0;o<s;a++)55296==(64512&(r=e.charCodeAt(a)))&&a+1<i&&56320==(64512&(n=e.charCodeAt(a+1)))&&(r=65536+(r-55296<<10)+(n-56320),a++),r<128?t[o++]=r:r<2048?(t[o++]=192|r>>>6,t[o++]=128|63&r):r<65536?(t[o++]=224|r>>>12,t[o++]=128|r>>>6&63,t[o++]=128|63&r):(t[o++]=240|r>>>18,t[o++]=128|r>>>12&63,t[o++]=128|r>>>6&63,t[o++]=128|63&r);return t},r.buf2binstring=function(e){return s(e,e.length)},r.binstring2buf=function(e){for(var t=new _.Buf8(e.length),r=0,n=t.length;r<n;r++)t[r]=e.charCodeAt(r);return t},r.buf2string=function(e,t){var r,_,n,a,i=t||e.length,E=new Array(2*i);for(_=0,r=0;r<i;)if((n=e[r++])<128)E[_++]=n;else if((a=o[n])>4)E[_++]=65533,r+=a-1;else{for(n&=2===a?31:3===a?15:7;a>1&&r<i;)n=n<<6|63&e[r++],a--;a>1?E[_++]=65533:n<65536?E[_++]=n:(E[_++]=55296|(n-=65536)>>10&1023,E[_++]=56320|1023&n)}return s(E,_)},r.utf8border=function(e,t){var r;for((t=t||e.length)>e.length&&(t=e.length),r=t-1;r>=0&&128==(192&e[r]);)r--;return r<0?t:0===r?t:r+o[e[r]]>t?r:t}},{"./common":1}],3:[function(e,t,r){t.exports=function(e,t,r,_){for(var n=65535&e|0,a=e>>>16&65535|0,o=0;0!==r;){r-=o=r>2e3?2e3:r;do{a=a+(n=n+t[_++]|0)|0}while(--o);n%=65521,a%=65521}return n|a<<16|0}},{}],4:[function(e,t,r){t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],5:[function(e,t,r){var _=function(){for(var e,t=[],r=0;r<256;r++){e=r;for(var _=0;_<8;_++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t}();t.exports=function(e,t,r,n){var a=_,o=n+r;e^=-1;for(var i=n;i<o;i++)e=e>>>8^a[255&(e^t[i])];return-1^e}},{}],6:[function(e,t,r){t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],7:[function(e,t,r){t.exports=function(e,t){var r,_,n,a,o,i,s,E,c,l,T,u,d,f,P,A,S,p,m,O,v,N,g,h,R;h=e.input,n=(_=e.next_in)+(e.avail_in-5),R=e.output,o=(a=e.next_out)-(t-e.avail_out),i=a+(e.avail_out-257),s=(r=e.state).dmax,E=r.wsize,c=r.whave,l=r.wnext,T=r.window,u=r.hold,d=r.bits,f=r.lencode,P=r.distcode,A=(1<<r.lenbits)-1,S=(1<<r.distbits)-1;e:do{d<15&&(u+=h[_++]<<d,u+=h[_++]<<(d+=8),d+=8),p=f[u&A];t:for(;;){if(u>>>=m=p>>>24,d-=m,0==(m=p>>>16&255))R[a++]=65535&p;else{if(!(16&m)){if(0==(64&m)){p=f[(65535&p)+(u&(1<<m)-1)];continue t}if(32&m){r.mode=12;break e}e.msg="invalid literal/length code",r.mode=30;break e}O=65535&p,(m&=15)&&(d<m&&(u+=h[_++]<<d,d+=8),O+=u&(1<<m)-1,u>>>=m,d-=m),d<15&&(u+=h[_++]<<d,u+=h[_++]<<(d+=8),d+=8),p=P[u&S];r:for(;;){if(u>>>=m=p>>>24,d-=m,!(16&(m=p>>>16&255))){if(0==(64&m)){p=P[(65535&p)+(u&(1<<m)-1)];continue r}e.msg="invalid distance code",r.mode=30;break e}if(v=65535&p,d<(m&=15)&&(u+=h[_++]<<d,(d+=8)<m&&(u+=h[_++]<<d,d+=8)),(v+=u&(1<<m)-1)>s){e.msg="invalid distance too far back",r.mode=30;break e}if(u>>>=m,d-=m,v>(m=a-o)){if((m=v-m)>c&&r.sane){e.msg="invalid distance too far back",r.mode=30;break e}if(N=0,g=T,0===l){if(N+=E-m,m<O){O-=m;do{R[a++]=T[N++]}while(--m);N=a-v,g=R}}else if(l<m){if(N+=E+l-m,(m-=l)<O){O-=m;do{R[a++]=T[N++]}while(--m);if(N=0,l<O){O-=m=l;do{R[a++]=T[N++]}while(--m);N=a-v,g=R}}}else if(N+=l-m,m<O){O-=m;do{R[a++]=T[N++]}while(--m);N=a-v,g=R}for(;O>2;)R[a++]=g[N++],R[a++]=g[N++],R[a++]=g[N++],O-=3;O&&(R[a++]=g[N++],O>1&&(R[a++]=g[N++]))}else{N=a-v;do{R[a++]=R[N++],R[a++]=R[N++],R[a++]=R[N++],O-=3}while(O>2);O&&(R[a++]=R[N++],O>1&&(R[a++]=R[N++]))}break}}break}}while(_<n&&a<i);u&=(1<<(d-=(O=d>>3)<<3))-1,e.next_in=_-=O,e.next_out=a,e.avail_in=_<n?n-_+5:5-(_-n),e.avail_out=a<i?i-a+257:257-(a-i),r.hold=u,r.bits=d}},{}],8:[function(e,t,r){var _=e("../utils/common"),n=e("./adler32"),a=e("./crc32"),o=e("./inffast"),i=e("./inftrees"),s=1,E=2,c=0,l=-2,T=1,u=852,d=592;function f(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function P(e){var t;return e&&e.state?(e.total_in=e.total_out=(t=e.state).total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=T,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new _.Buf32(u),t.distcode=t.distdyn=new _.Buf32(d),t.sane=1,t.back=-1,c):l}function A(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,P(e)):l}function S(e,t){var r,_;return e&&e.state?(_=e.state,t<0?(r=0,t=-t):(r=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?l:(null!==_.window&&_.wbits!==t&&(_.window=null),_.wrap=r,_.wbits=t,A(e))):l}function p(e,t){var r,n;return e?(n=new function(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new _.Buf16(320),this.work=new _.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0},e.state=n,n.window=null,(r=S(e,t))!==c&&(e.state=null),r):l}var m,O,v=!0;function N(e){if(v){var t;for(m=new _.Buf32(512),O=new _.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(i(s,e.lens,0,288,m,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;i(E,e.lens,0,32,O,0,e.work,{bits:5}),v=!1}e.lencode=m,e.lenbits=9,e.distcode=O,e.distbits=5}function g(e,t,r,n){var a,o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new _.Buf8(o.wsize)),n>=o.wsize?(_.arraySet(o.window,t,r-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):((a=o.wsize-o.wnext)>n&&(a=n),_.arraySet(o.window,t,r-n,a,o.wnext),(n-=a)?(_.arraySet(o.window,t,r-n,n,0),o.wnext=n,o.whave=o.wsize):(o.wnext+=a,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=a))),0}r.inflateReset=A,r.inflateReset2=S,r.inflateResetKeep=P,r.inflateInit=function(e){return p(e,15)},r.inflateInit2=p,r.inflate=function(e,t){var r,u,d,P,A,S,p,m,O,v,h,R,I,b,Y,L,M,x,y,w,U,C,D,F,G=0,k=new _.Buf8(4),K=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return l;12===(r=e.state).mode&&(r.mode=13),A=e.next_out,d=e.output,P=e.next_in,u=e.input,m=r.hold,O=r.bits,v=S=e.avail_in,h=p=e.avail_out,C=c;e:for(;;)switch(r.mode){case T:if(0===r.wrap){r.mode=13;break}for(;O<16;){if(0===S)break e;S--,m+=u[P++]<<O,O+=8}if(2&r.wrap&&35615===m){r.check=0,k[0]=255&m,k[1]=m>>>8&255,r.check=a(r.check,k,2,0),m=0,O=0,r.mode=2;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&m)<<8)+(m>>8))%31){e.msg="incorrect header check",r.mode=30;break}if(8!=(15&m)){e.msg="unknown compression method",r.mode=30;break}if(O-=4,U=8+(15&(m>>>=4)),0===r.wbits)r.wbits=U;else if(U>r.wbits){e.msg="invalid window size",r.mode=30;break}r.dmax=1<<U,e.adler=r.check=1,r.mode=512&m?10:12,m=0,O=0;break;case 2:for(;O<16;){if(0===S)break e;S--,m+=u[P++]<<O,O+=8}if(r.flags=m,8!=(255&r.flags)){e.msg="unknown compression method",r.mode=30;break}if(57344&r.flags){e.msg="unknown header flags set",r.mode=30;break}r.head&&(r.head.text=m>>8&1),512&r.flags&&(k[0]=255&m,k[1]=m>>>8&255,r.check=a(r.check,k,2,0)),m=0,O=0,r.mode=3;case 3:for(;O<32;){if(0===S)break e;S--,m+=u[P++]<<O,O+=8}r.head&&(r.head.time=m),512&r.flags&&(k[0]=255&m,k[1]=m>>>8&255,k[2]=m>>>16&255,k[3]=m>>>24&255,r.check=a(r.check,k,4,0)),m=0,O=0,r.mode=4;case 4:for(;O<16;){if(0===S)break e;S--,m+=u[P++]<<O,O+=8}r.head&&(r.head.xflags=255&m,r.head.os=m>>8),512&r.flags&&(k[0]=255&m,k[1]=m>>>8&255,r.check=a(r.check,k,2,0)),m=0,O=0,r.mode=5;case 5:if(1024&r.flags){for(;O<16;){if(0===S)break e;S--,m+=u[P++]<<O,O+=8}r.length=m,r.head&&(r.head.extra_len=m),512&r.flags&&(k[0]=255&m,k[1]=m>>>8&255,r.check=a(r.check,k,2,0)),m=0,O=0}else r.head&&(r.head.extra=null);r.mode=6;case 6:if(1024&r.flags&&((R=r.length)>S&&(R=S),R&&(r.head&&(U=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),_.arraySet(r.head.extra,u,P,R,U)),512&r.flags&&(r.check=a(r.check,u,R,P)),S-=R,P+=R,r.length-=R),r.length))break e;r.length=0,r.mode=7;case 7:if(2048&r.flags){if(0===S)break e;R=0;do{U=u[P+R++],r.head&&U&&r.length<65536&&(r.head.name+=String.fromCharCode(U))}while(U&&R<S);if(512&r.flags&&(r.check=a(r.check,u,R,P)),S-=R,P+=R,U)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=8;case 8:if(4096&r.flags){if(0===S)break e;R=0;do{U=u[P+R++],r.head&&U&&r.length<65536&&(r.head.comment+=String.fromCharCode(U))}while(U&&R<S);if(512&r.flags&&(r.check=a(r.check,u,R,P)),S-=R,P+=R,U)break e}else r.head&&(r.head.comment=null);r.mode=9;case 9:if(512&r.flags){for(;O<16;){if(0===S)break e;S--,m+=u[P++]<<O,O+=8}if(m!==(65535&r.check)){e.msg="header crc mismatch",r.mode=30;break}m=0,O=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=12;break;case 10:for(;O<32;){if(0===S)break e;S--,m+=u[P++]<<O,O+=8}e.adler=r.check=f(m),m=0,O=0,r.mode=11;case 11:if(0===r.havedict)return e.next_out=A,e.avail_out=p,e.next_in=P,e.avail_in=S,r.hold=m,r.bits=O,2;e.adler=r.check=1,r.mode=12;case 12:if(5===t||6===t)break e;case 13:if(r.last){m>>>=7&O,O-=7&O,r.mode=27;break}for(;O<3;){if(0===S)break e;S--,m+=u[P++]<<O,O+=8}switch(r.last=1&m,O-=1,3&(m>>>=1)){case 0:r.mode=14;break;case 1:if(N(r),r.mode=20,6===t){m>>>=2,O-=2;break e}break;case 2:r.mode=17;break;case 3:e.msg="invalid block type",r.mode=30}m>>>=2,O-=2;break;case 14:for(m>>>=7&O,O-=7&O;O<32;){if(0===S)break e;S--,m+=u[P++]<<O,O+=8}if((65535&m)!=(m>>>16^65535)){e.msg="invalid stored block lengths",r.mode=30;break}if(r.length=65535&m,m=0,O=0,r.mode=15,6===t)break e;case 15:r.mode=16;case 16:if(R=r.length){if(R>S&&(R=S),R>p&&(R=p),0===R)break e;_.arraySet(d,u,P,R,A),S-=R,P+=R,p-=R,A+=R,r.length-=R;break}r.mode=12;break;case 17:for(;O<14;){if(0===S)break e;S--,m+=u[P++]<<O,O+=8}if(r.nlen=257+(31&m),O-=5,r.ndist=1+(31&(m>>>=5)),O-=5,r.ncode=4+(15&(m>>>=5)),m>>>=4,O-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=30;break}r.have=0,r.mode=18;case 18:for(;r.have<r.ncode;){for(;O<3;){if(0===S)break e;S--,m+=u[P++]<<O,O+=8}r.lens[K[r.have++]]=7&m,m>>>=3,O-=3}for(;r.have<19;)r.lens[K[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,C=i(0,r.lens,0,19,r.lencode,0,r.work,D={bits:r.lenbits}),r.lenbits=D.bits,C){e.msg="invalid code lengths set",r.mode=30;break}r.have=0,r.mode=19;case 19:for(;r.have<r.nlen+r.ndist;){for(;L=(G=r.lencode[m&(1<<r.lenbits)-1])>>>16&255,M=65535&G,!((Y=G>>>24)<=O);){if(0===S)break e;S--,m+=u[P++]<<O,O+=8}if(M<16)m>>>=Y,O-=Y,r.lens[r.have++]=M;else{if(16===M){for(F=Y+2;O<F;){if(0===S)break e;S--,m+=u[P++]<<O,O+=8}if(m>>>=Y,O-=Y,0===r.have){e.msg="invalid bit length repeat",r.mode=30;break}U=r.lens[r.have-1],R=3+(3&m),m>>>=2,O-=2}else if(17===M){for(F=Y+3;O<F;){if(0===S)break e;S--,m+=u[P++]<<O,O+=8}O-=Y,U=0,R=3+(7&(m>>>=Y)),m>>>=3,O-=3}else{for(F=Y+7;O<F;){if(0===S)break e;S--,m+=u[P++]<<O,O+=8}O-=Y,U=0,R=11+(127&(m>>>=Y)),m>>>=7,O-=7}if(r.have+R>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=30;break}for(;R--;)r.lens[r.have++]=U}}if(30===r.mode)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=30;break}if(r.lenbits=9,C=i(s,r.lens,0,r.nlen,r.lencode,0,r.work,D={bits:r.lenbits}),r.lenbits=D.bits,C){e.msg="invalid literal/lengths set",r.mode=30;break}if(r.distbits=6,r.distcode=r.distdyn,C=i(E,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,D={bits:r.distbits}),r.distbits=D.bits,C){e.msg="invalid distances set",r.mode=30;break}if(r.mode=20,6===t)break e;case 20:r.mode=21;case 21:if(S>=6&&p>=258){e.next_out=A,e.avail_out=p,e.next_in=P,e.avail_in=S,r.hold=m,r.bits=O,o(e,h),A=e.next_out,d=e.output,p=e.avail_out,P=e.next_in,u=e.input,S=e.avail_in,m=r.hold,O=r.bits,12===r.mode&&(r.back=-1);break}for(r.back=0;L=(G=r.lencode[m&(1<<r.lenbits)-1])>>>16&255,M=65535&G,!((Y=G>>>24)<=O);){if(0===S)break e;S--,m+=u[P++]<<O,O+=8}if(L&&0==(240&L)){for(x=Y,y=L,w=M;L=(G=r.lencode[w+((m&(1<<x+y)-1)>>x)])>>>16&255,M=65535&G,!(x+(Y=G>>>24)<=O);){if(0===S)break e;S--,m+=u[P++]<<O,O+=8}m>>>=x,O-=x,r.back+=x}if(m>>>=Y,O-=Y,r.back+=Y,r.length=M,0===L){r.mode=26;break}if(32&L){r.back=-1,r.mode=12;break}if(64&L){e.msg="invalid literal/length code",r.mode=30;break}r.extra=15&L,r.mode=22;case 22:if(r.extra){for(F=r.extra;O<F;){if(0===S)break e;S--,m+=u[P++]<<O,O+=8}r.length+=m&(1<<r.extra)-1,m>>>=r.extra,O-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=23;case 23:for(;L=(G=r.distcode[m&(1<<r.distbits)-1])>>>16&255,M=65535&G,!((Y=G>>>24)<=O);){if(0===S)break e;S--,m+=u[P++]<<O,O+=8}if(0==(240&L)){for(x=Y,y=L,w=M;L=(G=r.distcode[w+((m&(1<<x+y)-1)>>x)])>>>16&255,M=65535&G,!(x+(Y=G>>>24)<=O);){if(0===S)break e;S--,m+=u[P++]<<O,O+=8}m>>>=x,O-=x,r.back+=x}if(m>>>=Y,O-=Y,r.back+=Y,64&L){e.msg="invalid distance code",r.mode=30;break}r.offset=M,r.extra=15&L,r.mode=24;case 24:if(r.extra){for(F=r.extra;O<F;){if(0===S)break e;S--,m+=u[P++]<<O,O+=8}r.offset+=m&(1<<r.extra)-1,m>>>=r.extra,O-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=30;break}r.mode=25;case 25:if(0===p)break e;if(r.offset>(R=h-p)){if((R=r.offset-R)>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=30;break}I=R>r.wnext?r.wsize-(R-=r.wnext):r.wnext-R,R>r.length&&(R=r.length),b=r.window}else b=d,I=A-r.offset,R=r.length;R>p&&(R=p),p-=R,r.length-=R;do{d[A++]=b[I++]}while(--R);0===r.length&&(r.mode=21);break;case 26:if(0===p)break e;d[A++]=r.length,p--,r.mode=21;break;case 27:if(r.wrap){for(;O<32;){if(0===S)break e;S--,m|=u[P++]<<O,O+=8}if(e.total_out+=h-=p,r.total+=h,h&&(e.adler=r.check=r.flags?a(r.check,d,h,A-h):n(r.check,d,h,A-h)),h=p,(r.flags?m:f(m))!==r.check){e.msg="incorrect data check",r.mode=30;break}m=0,O=0}r.mode=28;case 28:if(r.wrap&&r.flags){for(;O<32;){if(0===S)break e;S--,m+=u[P++]<<O,O+=8}if(m!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=30;break}m=0,O=0}r.mode=29;case 29:C=1;break e;case 30:C=-3;break e;case 31:return-4;case 32:default:return l}return e.next_out=A,e.avail_out=p,e.next_in=P,e.avail_in=S,r.hold=m,r.bits=O,(r.wsize||h!==e.avail_out&&r.mode<30&&(r.mode<27||4!==t))&&g(e,e.output,e.next_out,h-e.avail_out)?(r.mode=31,-4):(h-=e.avail_out,e.total_in+=v-=e.avail_in,e.total_out+=h,r.total+=h,r.wrap&&h&&(e.adler=r.check=r.flags?a(r.check,d,h,e.next_out-h):n(r.check,d,h,e.next_out-h)),e.data_type=r.bits+(r.last?64:0)+(12===r.mode?128:0)+(20===r.mode||15===r.mode?256:0),(0===v&&0===h||4===t)&&C===c&&(C=-5),C)},r.inflateEnd=function(e){if(!e||!e.state)return l;var t=e.state;return t.window&&(t.window=null),e.state=null,c},r.inflateGetHeader=function(e,t){var r;return e&&e.state?0==(2&(r=e.state).wrap)?l:(r.head=t,t.done=!1,c):l},r.inflateSetDictionary=function(e,t){var r,_=t.length;return e&&e.state?0!==(r=e.state).wrap&&11!==r.mode?l:11===r.mode&&n(1,t,_,0)!==r.check?-3:g(e,t,_,_)?(r.mode=31,-4):(r.havedict=1,c):l},r.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":1,"./adler32":3,"./crc32":5,"./inffast":7,"./inftrees":9}],9:[function(e,t,r){var _=e("../utils/common"),n=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],o=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],i=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,r,s,E,c,l,T){var u,d,f,P,A,S,p,m,O,v=T.bits,N=0,g=0,h=0,R=0,I=0,b=0,Y=0,L=0,M=0,x=0,y=null,w=0,U=new _.Buf16(16),C=new _.Buf16(16),D=null,F=0;for(N=0;N<=15;N++)U[N]=0;for(g=0;g<s;g++)U[t[r+g]]++;for(I=v,R=15;R>=1&&0===U[R];R--);if(I>R&&(I=R),0===R)return E[c++]=20971520,E[c++]=20971520,T.bits=1,0;for(h=1;h<R&&0===U[h];h++);for(I<h&&(I=h),L=1,N=1;N<=15;N++)if(L<<=1,(L-=U[N])<0)return-1;if(L>0&&(0===e||1!==R))return-1;for(C[1]=0,N=1;N<15;N++)C[N+1]=C[N]+U[N];for(g=0;g<s;g++)0!==t[r+g]&&(l[C[t[r+g]]++]=g);if(0===e?(y=D=l,S=19):1===e?(y=n,w-=257,D=a,F-=257,S=256):(y=o,D=i,S=-1),x=0,g=0,N=h,A=c,b=I,Y=0,f=-1,P=(M=1<<I)-1,1===e&&M>852||2===e&&M>592)return 1;for(;;){p=N-Y,l[g]<S?(m=0,O=l[g]):l[g]>S?(m=D[F+l[g]],O=y[w+l[g]]):(m=96,O=0),u=1<<N-Y,h=d=1<<b;do{E[A+(x>>Y)+(d-=u)]=p<<24|m<<16|O|0}while(0!==d);for(u=1<<N-1;x&u;)u>>=1;if(0!==u?(x&=u-1,x+=u):x=0,g++,0==--U[N]){if(N===R)break;N=t[r+l[g]]}if(N>I&&(x&P)!==f){for(0===Y&&(Y=I),A+=h,L=1<<(b=N-Y);b+Y<R&&!((L-=U[b+Y])<=0);)b++,L<<=1;if(M+=1<<b,1===e&&M>852||2===e&&M>592)return 1;E[f=x&P]=I<<24|b<<16|A-c|0}}return 0!==x&&(E[A+x]=N-Y<<24|64<<16|0),T.bits=I,0}},{"../utils/common":1}],10:[function(e,t,r){t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],11:[function(e,t,r){t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],"/lib/inflate.js":[function(e,t,r){var _=e("./zlib/inflate"),n=e("./utils/common"),a=e("./utils/strings"),o=e("./zlib/constants"),i=e("./zlib/messages"),s=e("./zlib/zstream"),E=e("./zlib/gzheader"),c=Object.prototype.toString;function l(e){if(!(this instanceof l))return new l(e);this.options=n.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0;var r=_.inflateInit2(this.strm,t.windowBits);if(r!==o.Z_OK)throw new Error(i[r]);this.header=new E,_.inflateGetHeader(this.strm,this.header)}function T(e,t){var r=new l(t);if(r.push(e,!0),r.err)throw r.msg||i[r.err];return r.result}l.prototype.push=function(e,t){var r,i,s,E,l,T,u=this.strm,d=this.options.chunkSize,f=this.options.dictionary,P=!1;if(this.ended)return!1;i=t===~~t?t:!0===t?o.Z_FINISH:o.Z_NO_FLUSH,u.input="string"==typeof e?a.binstring2buf(e):"[object ArrayBuffer]"===c.call(e)?new Uint8Array(e):e,u.next_in=0,u.avail_in=u.input.length;do{if(0===u.avail_out&&(u.output=new n.Buf8(d),u.next_out=0,u.avail_out=d),(r=_.inflate(u,o.Z_NO_FLUSH))===o.Z_NEED_DICT&&f&&(T="string"==typeof f?a.string2buf(f):"[object ArrayBuffer]"===c.call(f)?new Uint8Array(f):f,r=_.inflateSetDictionary(this.strm,T)),r===o.Z_BUF_ERROR&&!0===P&&(r=o.Z_OK,P=!1),r!==o.Z_STREAM_END&&r!==o.Z_OK)return this.onEnd(r),this.ended=!0,!1;u.next_out&&(0!==u.avail_out&&r!==o.Z_STREAM_END&&(0!==u.avail_in||i!==o.Z_FINISH&&i!==o.Z_SYNC_FLUSH)||("string"===this.options.to?(s=a.utf8border(u.output,u.next_out),E=u.next_out-s,l=a.buf2string(u.output,s),u.next_out=E,u.avail_out=d-E,E&&n.arraySet(u.output,u.output,s,E,0),this.onData(l)):this.onData(n.shrinkBuf(u.output,u.next_out)))),0===u.avail_in&&0===u.avail_out&&(P=!0)}while((u.avail_in>0||0===u.avail_out)&&r!==o.Z_STREAM_END);return r===o.Z_STREAM_END&&(i=o.Z_FINISH),i===o.Z_FINISH?(r=_.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===o.Z_OK):i!==o.Z_SYNC_FLUSH||(this.onEnd(o.Z_OK),u.avail_out=0,!0)},l.prototype.onData=function(e){this.chunks.push(e)},l.prototype.onEnd=function(e){e===o.Z_OK&&(this.result="string"===this.options.to?this.chunks.join(""):n.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},r.Inflate=l,r.inflate=T,r.inflateRaw=function(e,t){return(t=t||{}).raw=!0,T(e,t)},r.ungzip=T},{"./utils/common":1,"./utils/strings":2,"./zlib/constants":4,"./zlib/gzheader":6,"./zlib/inflate":8,"./zlib/messages":10,"./zlib/zstream":11}]},{},[])("/lib/inflate.js")}();var Cs=window.pako.inflate,Ds=A("__assets",function(e,t){var r=ha(e),_=Wo(e),n=Us(e),a=ga(e),o=Ss(e),i=_.defaults,s=_.assets;t.AT_ARRAYBUFFER=10,t.AT_ARRAYBUFFER_ZIP=20,t.AT_JSON=30,t.AT_JSON_ZIP=40,t.AT_TEXT=50,t.AT_AUDIOBUFFER=60,t.AT_IMAGE_ELEMENT=70,t.AT_AUDIO_ELEMENT=80,t.AT_VIDEO_ELEMENT=90,t.AT_SEQ_VIDEO_ELEMENT=100;var E=10,c=20,l=30,T=40,u=[],d=0,f={},P={},A={},S={},p={};function m(){return _.is_built_in_data()?b4w.require(_.paths.built_in_data_module).data:null}function O(){var e={_source_url:null,_parse_response:function(t){switch(e.responseType){case"json":case"text":return t;case"arraybuffer":for(var r=atob(t),_=r.length,n=new Int8Array(_),a=0;a<_;a++)n[a]=r.charCodeAt(a);return n.buffer;default:return t}},status:0,readyState:0,response:"",responseType:"",onreadystatechange:null,overrideMimeType:function(){},addEventListener:function(){},open:function(t,r,_){e._source_url=r,e.readyState=1},send:function(){e.status=404,e.readyState=4;var t=m();t&&e._source_url in t&&(e.status=200,t[e._source_url]&&(e.response=e._parse_response(t[e._source_url]))),"[object Function]"==={}.toString.call(e.onreadystatechange)&&e.onreadystatechange()}};return e}function v(e){for(var _=0,n=0;n<e.length;n++){var a=e[n];if(a.state===c&&_++,_>=s.max_requests)break;if(a.state===E)switch(a.state=c,_++,a.type){case t.AT_JSON_ZIP:case t.AT_ARRAYBUFFER:case t.AT_ARRAYBUFFER_ZIP:N(a,"arraybuffer");break;case t.AT_JSON:N(a,"json");break;case t.AT_TEXT:N(a,"text");break;case t.AT_AUDIOBUFFER:g(a);break;case t.AT_IMAGE_ELEMENT:h(a);break;case t.AT_AUDIO_ELEMENT:R(a);break;case t.AT_VIDEO_ELEMENT:I(a);break;case t.AT_SEQ_VIDEO_ELEMENT:b(a);break;default:r.panic("Wrong asset type: "+a.type)}}}function N(e,r){var _=e.url.split("?v=")[0];if(_ in P)e.asset_cb("json"==r?ln(P[_]):P[_],e.id,e.type,e.url,e.param);else{var n=m();if(n&&e.url in n)var o=new O;else o=new XMLHttpRequest;var i=null;if("GET"==e.request_method)o.open("GET",e.url,!0);else if("POST"==e.request_method)switch(o.open("POST",e.url,!0),e.type){case t.AT_TEXT:i="text/plain";break;case t.AT_JSON:i="application/json"}if(e.overwrite_header)for(var s in e.overwrite_header)"Content-Type"==s?i=e.overwrite_header[s]:o.setRequestHeader(s,e.overwrite_header[s]);i&&o.setRequestHeader("Content-Type",i),"text"==r?(o.overrideMimeType("text/plain"),o.responseType="text"):"json"==r?(o.overrideMimeType("application/json"),o.responseType="text"):o.responseType=r,o.onreadystatechange=function(){if(e.state!=T&&4==o.readyState){if(200==o.status||0==o.status){var n=o.response;if(!n||"arraybuffer"==r&&0==n.byteLength)a.error("empty responce when trying to get "+e.url),e.asset_cb(null,e.id,e.type,e.url,e.param);else{switch(e.type){case t.AT_JSON_ZIP:try{n=Cs(n,{to:"string"})}catch(t){return a.error(t+" (parsing gzipped file "+e.url+")"),void e.asset_cb(null,e.id,e.type,e.url,e.param)}case t.AT_JSON:try{n=JSON.parse(n,e.json_reviver)}catch(t){return a.error(t+" (parsing JSON "+e.url+")"),void e.asset_cb(null,e.id,e.type,e.url,e.param)}break;case t.AT_ARRAYBUFFER_ZIP:try{n=Cs(n).buffer}catch(t){return a.error(t+" (parsing gzipped file "+e.url+")"),void e.asset_cb(null,e.id,e.type,e.url,e.param)}}e.is_fetch&&(P[_]=e.type==t.AT_JSON||e.type==t.AT_JSON_ZIP?ln(n):n),e.asset_cb(n,e.id,e.type,e.url,e.param)}}else a.error(o.status+" when trying to get "+e.url),e.asset_cb(null,e.id,e.type,e.url,e.param);e.state=l}},o.addEventListener("progress",function(t){t.lengthComputable&&e.progress_cb(t.loaded/t.total)},!1),o.send(e.post_data)}}function g(e){var t=e.url.split("?v=")[0];if(t in p)return e.asset_cb(p[t],e.id,e.type,e.url,e.param),void(e.state=l);"GET"!=e.request_method&&r.panic("Unsupported request type for audio buffer");var _=m();if(_&&e.url in _)var n=new O;else n=new XMLHttpRequest;n.open("GET",e.url,!0),n.responseType="arraybuffer",n.onreadystatechange=function(){if(e.state!=T&&4==n.readyState)if(200==n.status||0==n.status){var t=n.response;t?o.decode_audio_data(t,function(t){if(e.asset_cb(t,e.id,e.type,e.url,e.param),e.state=l,e.is_fetch){var r=e.url.split("?v=")[0];p[r]=t}},function(){a.error("failed to decode "+e.url),e.asset_cb(null,e.id,e.type,e.url,e.param),e.state=l}):(a.error("empty responce when trying to get "+e.url),e.asset_cb(null,e.id,e.type,e.url,e.param),e.state=l)}else a.error(n.status+" when trying to get "+e.url),e.asset_cb(null,e.id,e.type,e.url,e.param),e.state=l},n.send()}function h(e){var t=e.url.split("?v=")[0];if(t in A)return e.asset_cb(A[t],e.id,e.type,e.url,e.param),void(e.state=l);"GET"!=e.request_method&&r.panic("Unsupported request type for image element");var _=document.createElement("img");i.allow_cors&&(_.crossOrigin="Anonymous"),_.onload=function(){if(e.state!=T&&(e.asset_cb(_,e.id,e.type,e.url,e.param),e.state=l,e.is_fetch)){var t=e.url.split("?v=")[0];A[t]=_}},_.addEventListener("error",function(){e.state!=T&&(a.error("could not load image: "+e.url),e.asset_cb(null,e.id,e.type,e.url,e.param),e.state=l)},!1);var o=m();if(o&&e.url in o)if(o[e.url]){var s=function(t){var r="image";switch(ls(e.url).toLowerCase()){case"jpeg":case"jpg":r+="/jpeg";break;case"png":r+="/png"}return r}();_.src="data:"+s+";base64,"+o[e.url]}else{if(n.is_ie11())(E=document.createEvent("CustomEvent")).initCustomEvent("error",!1,!1,null);else var E=new CustomEvent("error");_.dispatchEvent(E)}else _.src=e.url}function R(e){var t=e.url.split("?v=")[0];if(t in S)return e.asset_cb(S[t],e.id,e.type,e.url,e.param),void(e.state=l);"GET"!=e.request_method&&r.panic("Unsupported request type for audio element");var _=document.createElement("audio");i.allow_cors&&(_.crossOrigin="Anonymous"),_.addEventListener("loadeddata",function(){if(e.state!=T&&(e.asset_cb(_,e.id,e.type,e.url,e.param),e.state=l,e.is_fetch)){var t=e.url.split("?v=")[0];S[t]=_}},!1),_.addEventListener("error",function(){e.state!=T&&(a.error("could not load sound: "+e.url),e.asset_cb(null,e.id,e.type,e.url,e.param),e.state=l)},!1),_.addEventListener("stalled",function(){e.state!=T&&(a.error("could not load sound: "+e.url),e.asset_cb(null,e.id,e.type,e.url,e.param),e.state=l)},!1);var o=m();if(o&&e.url in o)if(o[e.url]){var s=function(t){var r="audio";switch(ls(e.url).toLowerCase()){case"ogv":case"ogg":r+="/ogg";break;case"mp3":r+="/mpeg";break;case"m4v":case"mp4":r+="/mp4";break;case"webm":r+="/webm"}return r}();_.src="data:"+s+";base64,"+o[e.url],e.state!=T&&(e.asset_cb(_,e.id,e.type,e.url,e.param),e.state=l)}else{if(n.is_ie11())(E=document.createEvent("CustomEvent")).initCustomEvent("error",!1,!1,null);else var E=new CustomEvent("error");_.dispatchEvent(E)}else _.src=e.url,i.is_mobile_device&&_.load();i.mobile_firefox_media_hack&&(_.autoplay=!0,_.pause()),setTimeout(function(){_.some_prop_to_prevent_gc=1},5e3)}function I(e){var t=e.url.split("?v=")[0];if(t in A)return e.asset_cb(A[t],e.id,e.type,e.url,e.param),void(e.state=l);"GET"!=e.request_method&&r.panic("Unsupported request type for video element");var _=document.createElement("video");function o(t){e.state!=T&&(a.error("could not load video: "+e.url,e.param),e.asset_cb(null,e.id,e.type,e.url),e.state=l)}_.muted=!0,i.allow_cors&&(_.crossOrigin="Anonymous"),_.addEventListener("loadeddata",function(){if(_.removeEventListener("error",o,!1),e.state!=T&&(e.asset_cb(_,e.id,e.type,e.url,e.param),e.state=l,e.is_fetch)){var t=e.url.split("?v=")[0];A[t]=_}},!1),_.addEventListener("error",o,!1);var s=m();if(s&&e.url in s)if(s[e.url]){var E=function(t){var r="video";switch(ls(e.url).toLowerCase()){case"ogv":r+="/ogg";break;case"webm":r+="/webm";break;case"m4v":case"mp4":r+="/mp4"}return r}();_.src="data:"+E+";base64,"+s[e.url],e.state!=T&&_.addEventListener("loadeddata",function(){e.asset_cb(_,e.id,e.type,e.url,e.param),e.state=l},!1)}else{if(n.is_ie11())(c=document.createEvent("CustomEvent")).initCustomEvent("error",!1,!1,null);else var c=new CustomEvent("error");_.dispatchEvent(c)}else _.src=e.url,i.is_mobile_device&&_.load();(i.mobile_firefox_media_hack||i.ipad_video_hack)&&(_.autoplay=!0,_.pause()),setTimeout(function(){_.some_prop_to_prevent_gc=1},1e4)}function b(e){var t=e.url.split("?v=")[0];if(t in A)return e.asset_cb(A[t],e.id,e.type,e.url,e.param),void(e.state=l);"GET"!=e.request_method&&r.panic("Unsupported request type for seq video element");var _=m();if(_&&e.url in _)var n=new O;else n=new XMLHttpRequest;function o(t){if(e.asset_cb(t,e.id,e.type,e.url,e.param),e.state=l,e.is_fetch){var r=e.url.split("?v=")[0];A[r]=t}}n.open("GET",e.url,!0),n.responseType="arraybuffer",n.onreadystatechange=function(){if(e.state!=T&&4==n.readyState)if(200==n.status||0==n.status){var t=n.response;t?function(e,t){for(var r=new Int32Array(e),_=new Int8Array(e),n=r[3],a={images:[],blobs:[],fps:r[4]},o=20,i=0;i<n;i++){var s=r[o/4],E=_.subarray(o+4,o+4+s),c=new Blob([E],{type:"image/jpg"}),l=document.createElement("img");l.src=window.URL.createObjectURL(c),a.images.push(l),a.blobs.push(c),o+=s+8-s%4}l.onload=function(){for(var e=0;e<a.images.length;e++)window.URL.revokeObjectURL(a.images[e].src);delete a.blobs,t(a)}}(t,o):(a.error("empty responce when trying to get "+e.url),e.asset_cb(null,e.id,e.type,e.url,e.param),e.state=l)}else a.error(n.status+" when trying to get "+e.url),e.asset_cb(null,e.id,e.type,e.url,e.param),e.state=l},n.addEventListener("progress",function(t){t.lengthComputable&&e.progress_cb(t.loaded/t.total)},!1),n.send()}t.split_extension=function(e){var t=e.split("."),r=Array(2);return r[0]=t.slice(0,-1).join("."),r[1]=String(t.slice(-1)),r},t.get_text_sync=function(e){if(f[e])return f[e];if(s.prevent_caching)var t=e+"?v="+Hi();else t=e;var _=new XMLHttpRequest;if(_.overrideMimeType("text/plain"),_.open("GET",t,!1),_.send(null),200==_.status||0==_.status){var n=_.responseText;if(n.length)return f[e]=n,n;r.panic("Error XHR: responce is empty, GET "+e)}else r.panic("Error XHR: "+_.status+", GET "+e)},t.cleanup=function(){for(var e=0;e<u.length;e++)u[e].state=T;u=[],d=0,f={}},t.enqueue=function(e,t,r,_,n){for(var a=0;a<e.length;a++){var o=e[a],i={id:o.id,type:o.type,url:o.url,is_fetch:o.is_fetch,request_method:o.request_method?o.request_method:"GET",overwrite_header:o.overwrite_header?o.overwrite_header:null,post_data:o.post_data?o.post_data:null,param:o.param?o.param:null,state:E,asset_cb:t||function(){},pack_cb:r||function(){},progress_cb:_||function(){},json_reviver:n||null,pack_index:d};if(s.prevent_caching){var c=m();c&&i.url in c||(i.url+="?v="+Hi())}u.push(i)}v(u),d++},t.update=function(){v(u),function(e){for(var t=0,r=!0,_=0;_<e.length;_++){var n=e[_];if(n.pack_index===e[t].pack_index)n.state!==l&&(r=!1);else{if(r){e[_-1].pack_cb();var a=_-t;e.splice(t,a),_-=a}t=_,r=e[_].state===l}if(_===e.length-1&&r){var o=e[_];e.splice(t),o.pack_cb()}}}(u)},t.check_image_extension=function(e){return"png"==e||"jpg"==e||"jpeg"==e||"gif"==e||"bmp"==e||"dds"==e||"pvr"==e},t.clear_cache=function(){P={},A={},S={},p={}}});f.module.shader_texts=function(e,t){e["anchors.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"txt",TOKENS:["GLSL_OUT","vec4","GLSL_OUT_FRAG_COLOR",";","void","main","(",")","{","GLSL_OUT_FRAG_COLOR","=","vec4","(","1.0",")",";","}"]}]},e["anchors.glslv"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"ANCHOR_NUM",TOKENS:["0"]},{TYPE:"include",FILE:"std.glsl"},{TYPE:"txt",TOKENS:["uniform","vec3","u_position","[","ANCHOR_NUM","]",";","uniform","mat4","u_view_proj_matrix",";","uniform","vec2","u_texel_size",";","GLSL_IN","float","a_index",";","void","main","(",")","{","int","c","=","int","(","mod","(","a_index",",","3.0",")",")",";","int","d","=","int","(","a_index","/","3.0",")",";","vec2","e",";","if","(","c","==","0",")","{","e","=","vec2","(","-","4.0","*","u_texel_size","[","0","]",",","-","u_texel_size","[","1","]",")",";","}","else","if","(","c","==","1",")","{","e","=","vec2","(","4.0","*","u_texel_size","[","0","]",",","-","u_texel_size","[","1","]",")",";","}","else","{","e","=","vec2","(","0.0",",","5.0","*","u_texel_size","[","1","]",")",";","}","vec4","f","=","u_view_proj_matrix","*","vec4","(","u_position","[","d","]",",","1.0",")",";","f",".","xy","+=","e","*","f",".","w",";","gl_Position","=","f",";","}"]}]},e["color_id.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"PRECISION",TOKENS:["highp"]},{TYPE:"var",NAME:"NODES",TOKENS:["0"]},{TYPE:"var",NAME:"USE_TBN_SHADING",TOKENS:["0"]},{TYPE:"var",NAME:"ALPHA",TOKENS:["0"]},{TYPE:"var",NAME:"ALPHA_CLIP",TOKENS:["0"]},{TYPE:"var",NAME:"TEXTURE_COLOR",TOKENS:["0"]},{TYPE:"var",NAME:"SHADOW_USAGE",TOKENS:["NO_SHADOWS"]},{TYPE:"var",NAME:"USE_OUTLINE",TOKENS:["0"]},{TYPE:"var",NAME:"USE_VIEW_TSR",TOKENS:["0"]},{TYPE:"var",NAME:"USE_VIEW_TSR_INVERSE",TOKENS:["0"]},{TYPE:"var",NAME:"USE_MODEL_TSR",TOKENS:["0"]},{TYPE:"var",NAME:"USE_MODEL_TSR_INVERSE",TOKENS:["0"]},{TYPE:"var",NAME:"CALC_TBN_SPACE",TOKENS:["0"]},{TYPE:"var",NAME:"CAMERA_TYPE",TOKENS:["CAM_TYPE_PERSP"]},{TYPE:"var",NAME:"USE_POSITION_CLIP",TOKENS:["0"]},{TYPE:"var",NAME:"USE_REFRACTION",TOKENS:["0"]},{TYPE:"var",NAME:"USE_REFRACTION_CORRECTION",TOKENS:["0"]},{TYPE:"var",NAME:"USE_ENVIRONMENT_LIGHT",TOKENS:["0"]},{TYPE:"var",NAME:"TEXTURE_BLEND_TYPE",TOKENS:["TEXTURE_BLEND_TYPE_MIX"]},{TYPE:"var",NAME:"NUM_LIGHTS",TOKENS:["0"]},{TYPE:"var",NAME:"NUM_LAMP_LIGHTS",TOKENS:["0"]},{TYPE:"var",NAME:"SKY_TEXTURE",TOKENS:["0"]},{TYPE:"var",NAME:"SKY_COLOR",TOKENS:["0"]},{TYPE:"var",NAME:"NUM_VALUES",TOKENS:["0"]},{TYPE:"var",NAME:"NUM_RGBS",TOKENS:["0"]},{TYPE:"var",NAME:"REFLECTION_TYPE",TOKENS:["REFL_NONE"]},{TYPE:"var",NAME:"POISSON_DISK_NUM",TOKENS:["NO_SOFT_SHADOWS"]},{TYPE:"var",NAME:"USE_DERIVATIVES_EXT",TOKENS:["0"]},{TYPE:"var",NAME:"USE_LOD_SMOOTHING",TOKENS:["0"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["GLSL1","USE_DERIVATIVES_EXT",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"extension",TOKENS:["GL_OES_standard_derivatives",":","enable"]}]}}]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","ALPHA",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"math.glslv"}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_LOD_SMOOTHING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"coverage.glslf"}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","ALPHA",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","float","u_time",";","uniform","float","u_environment_energy",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_LIGHTS",0,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_light_positions","[","NUM_LIGHTS","]",";","uniform","vec3","u_light_directions","[","NUM_LIGHTS","]",";","uniform","vec4","u_light_color_intensities","[","NUM_LIGHTS","]",";"]}]}}]},{TYPE:"txt",TOKENS:["uniform","vec3","u_camera_eye_frag",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_FRESNEL","USE_NODE_LAYER_WEIGHT",{TYPE:"logical_or_expr",PLACES:2},"CAMERA_TYPE","CAM_TYPE_ORTHO",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec3","u_camera_direction",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2},"USE_VIEW_TSR",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat3","u_view_tsr_frag",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_VIEW_TSR_INVERSE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat3","u_view_tsr_inverse",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_MODEL_TSR"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat3","u_model_tsr",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_MODEL_TSR_INVERSE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat3","u_model_tsr_inverse",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","samplerCube","u_sky_texture",";"]}]}},{TYPE:"elif",EXPRESSION:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec3","u_horizon_color",";","uniform","vec3","u_zenith_color",";"]}]}}]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_diffuse_color",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_COLOR"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_sampler",";","uniform","float","u_alpha_factor",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_OUTLINE",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec3","u_color_id",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_CURVE_VEC","USE_NODE_CURVE_RGB","USE_NODE_VALTORGB",{TYPE:"logical_or_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_nodes_texture",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","ALPHA",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_plane_reflection",";"]}]}},{TYPE:"elif",EXPRESSION:["REFLECTION_TYPE","REFL_CUBE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","samplerCube","u_cube_reflection",";"]}]}},{TYPE:"elif",EXPRESSION:["REFLECTION_TYPE","REFL_MIRRORMAP",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_B4W_REFRACTION"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_refractmap",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_REFRACTION","USE_REFRACTION_CORRECTION",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","PRECISION","sampler2D","u_scene_depth",";"]}]}}]}]}}]},{TYPE:"txt",TOKENS:["uniform","float","u_emit",";","uniform","float","u_ambient",";","uniform","vec2","u_fresnel_params",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_TYPE","REFL_MIRRORMAP",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","float","u_mirror_factor",";"]}]}},{TYPE:"elif",EXPRESSION:["REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_refl_plane",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_LAMP"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec3","u_lamp_light_positions","[","NUM_LAMP_LIGHTS","]",";","uniform","vec3","u_lamp_light_directions","[","NUM_LAMP_LIGHTS","]",";","uniform","vec3","u_lamp_light_color_intensities","[","NUM_LAMP_LIGHTS","]",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_VALUE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_node_values","[","NUM_VALUES","]",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_RGB"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec3","u_node_rgbs","[","NUM_RGBS","]",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["POISSON_DISK_NUM","NO_SOFT_SHADOWS",{TYPE:"non_equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_pcf_blur_radii",";"]}]}}]},{TYPE:"txt",TOKENS:["uniform","vec4","u_csm_center_dists",";","uniform","PRECISION","GLSL_SMPLR2D_SHDW","u_shadow_map0",";","uniform","PRECISION","GLSL_SMPLR2D_SHDW","u_shadow_map1",";","uniform","PRECISION","GLSL_SMPLR2D_SHDW","u_shadow_map2",";","uniform","PRECISION","GLSL_SMPLR2D_SHDW","u_shadow_map3",";","uniform","sampler2D","u_shadow_mask",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_OUTLINE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","float","u_outline_intensity",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_OBJECT_INFO"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec3","u_obj_info",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_LOD_SMOOTHING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","float","u_lod_coverage",";","uniform","float","u_lod_cmp_logic",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","ALPHA",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","h",";","GLSL_IN","vec4","i",";","GLSL_IN","vec3","j",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CALC_TBN_SPACE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","k",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2},"USE_POSITION_CLIP",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","l",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_B4W_REFRACTION","USE_REFRACTION",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","float","m",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","n",";","GLSL_IN","vec4","o",";","GLSL_IN","vec4","u",";","GLSL_IN","vec4","v",";"]}]}}]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_COLOR"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec2","A",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_TBN_SHADING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","B",";"]}]}}]},{TYPE:"txt",TOKENS:["GLSL_OUT","vec4","GLSL_OUT_FRAG_COLOR",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","ALPHA",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"nodes.glslf"}]}}]},{TYPE:"txt",TOKENS:["void","main","(",")","{"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_LOD_SMOOTHING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["if","(","!","C","(","u_lod_coverage",",","u_lod_cmp_logic",")",")","discard",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["ALPHA"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","D","=","normalize","(","u_camera_eye_frag","-","h",")",";","vec3","E",";","vec3","F",";","vec3","G",";","vec4","H",";","float","I",";","J","(","D",",","E",",","F",",","G",",","H",",","I",")",";","float","L","=","I",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_COLOR"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","L","=","(","GLSL_TEXTURE","(","u_sampler",",","A",")",")",".","a",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","M","=","u_alpha_factor","*","L",";","M","+=","(","1.0","-","step","(","0.0",",","M",")",")",";","L","=","mix","(","M",",","1.0",",","u_diffuse_color",".","a",")",";"]}]}}]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","L","=","u_diffuse_color",".","a",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["ALPHA_CLIP"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["if","(","L","<","0.5",")","discard",";","L","=","1.0",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_OUTLINE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT_FRAG_COLOR","=","vec4","(","1.0",",","1.0",",","1.0",",","u_outline_intensity",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT_FRAG_COLOR","=","vec4","(","u_color_id",",","1.0",")",";"]}]}}]},{TYPE:"txt",TOKENS:["}"]}]},e["color_id.glslv"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"PRECISION",TOKENS:["highp"]},{TYPE:"var",NAME:"NODES",TOKENS:["0"]},{TYPE:"var",NAME:"CAUSTICS",TOKENS:["0"]},{TYPE:"var",NAME:"CALC_TBN_SPACE",TOKENS:["0"]},{TYPE:"var",NAME:"MAIN_BEND_COL",TOKENS:["0"]},{TYPE:"var",NAME:"DETAIL_BEND",TOKENS:["0"]},{TYPE:"var",NAME:"CALC_TBN",TOKENS:["0"]},{TYPE:"var",NAME:"USE_TBN_SHADING",TOKENS:["0"]},{TYPE:"var",NAME:"USE_POSITION_CLIP",TOKENS:["0"]},{TYPE:"var",NAME:"ALPHA",TOKENS:["0"]},{TYPE:"var",NAME:"TEXTURE_COLOR",TOKENS:["0"]},{TYPE:"var",NAME:"AU_QUALIFIER",TOKENS:["GLSL_IN"]},{TYPE:"var",NAME:"STATIC_BATCH",TOKENS:["0"]},{TYPE:"var",NAME:"WIND_BEND",TOKENS:["0"]},{TYPE:"var",NAME:"BEND_CENTER_ONLY",TOKENS:["0"]},{TYPE:"var",NAME:"BILLBOARD",TOKENS:["0"]},{TYPE:"var",NAME:"BILLBOARD_JITTERED",TOKENS:["0"]},{TYPE:"var",NAME:"DYNAMIC_GRASS",TOKENS:["0"]},{TYPE:"var",NAME:"SKINNED",TOKENS:["0"]},{TYPE:"var",NAME:"FRAMES_BLENDING",TOKENS:["0"]},{TYPE:"var",NAME:"VERTEX_ANIM",TOKENS:["0"]},{TYPE:"var",NAME:"SMAA_JITTER",TOKENS:["0"]},{TYPE:"var",NAME:"VERTEX_ANIM_MIX_NORMALS_FACTOR",TOKENS:["u_va_frame_factor"]},{TYPE:"var",NAME:"MAX_BONES",TOKENS:["0"]},{TYPE:"var",NAME:"REFLECTION_TYPE",TOKENS:["REFL_NONE"]},{TYPE:"var",NAME:"REFRACTIVE",TOKENS:["0"]},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",FILE:"math.glslv"},{TYPE:"include",FILE:"to_world.glslv"},{TYPE:"include",FILE:"scale_texcoord.glslv"},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["STATIC_BATCH"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["const","mat3","u_model_tsr","=","mat3","(","0.0",",","0.0",",","0.0",",","1.0",",","0.0",",","0.0",",","0.0",",","1.0",",","0.0",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","PRECISION","mat3","u_model_tsr",";"]}]}}]},{TYPE:"txt",TOKENS:["uniform","mat3","u_view_tsr",";","uniform","mat4","u_proj_matrix",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["BILLBOARD","DYNAMIC_GRASS",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec3","u_camera_eye",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","ALPHA",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_JITTER"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_B4W_REFRACTION"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SKINNED"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_quatsb","[","MAX_BONES","]",";","uniform","vec4","u_transb","[","MAX_BONES","]",";","uniform","vec4","u_arm_rel_trans",";","uniform","vec4","u_arm_rel_quat",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FRAMES_BLENDING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_quatsa","[","MAX_BONES","]",";","uniform","vec4","u_transa","[","MAX_BONES","]",";","uniform","float","u_frame_factor",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WIND_BEND"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["BILLBOARD_JITTERED"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","float","u_jitter_amp",";","uniform","float","u_jitter_freq",";"]}]}}]},{TYPE:"txt",TOKENS:["uniform","vec3","u_wind",";","uniform","PRECISION","float","u_time",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["VERTEX_ANIM"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","float","u_va_frame_factor",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_COLOR"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec3","u_texture_scale",";"]}]}}]},{TYPE:"txt",TOKENS:["GLSL_IN","vec3","a_position",";","GLSL_IN","vec4","a_tbn",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","ALPHA",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_TBN_SHADING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","a_shade_tangs",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SKINNED"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","a_influence",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WIND_BEND"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["MAIN_BEND_COL"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","float","a_bending_col_main",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DETAIL_BEND"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","a_bending_col_detail",";","AU_QUALIFIER","float","au_detail_bending_amp",";","AU_QUALIFIER","float","au_branch_bending_amp",";","AU_QUALIFIER","float","au_detail_bending_freq",";"]}]}}]}]}}]},{TYPE:"txt",TOKENS:["AU_QUALIFIER","float","au_wind_bending_amp",";","AU_QUALIFIER","float","au_wind_bending_freq",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["BEND_CENTER_ONLY"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","a_emitter_center",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WIND_BEND","BILLBOARD",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["VERTEX_ANIM"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","a_position_next",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","ALPHA",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","USE_NODE_NORMAL_MAP","CAUSTICS","CALC_TBN_SPACE",{TYPE:"logical_or_expr",PLACES:5}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","a_tbn_next",";"]}]}}]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_COLOR"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec2","a_texcoord",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_TBN_SHADING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec3","B",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","ALPHA",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec3","h",";","GLSL_OUT","vec4","i",";","GLSL_OUT","vec3","j",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CALC_TBN_SPACE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec4","k",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2},"USE_POSITION_CLIP",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec3","l",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_B4W_REFRACTION","REFRACTIVE",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","float","m",";"]}]}}]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_COLOR"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec2","A",";"]}]}}]}]}}]},{TYPE:"include",FILE:"skin.glslv"},{TYPE:"include",FILE:"wind_bending.glslv"},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","ALPHA",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"nodes.glslv"}]}}]},{TYPE:"txt",TOKENS:["void","main","(",")","{","mat3","N","=","u_view_tsr",";","vec3","O","=","a_position",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","ALPHA","CALC_TBN_SPACE","USE_NODE_MATERIAL_BEGIN","USE_NODE_NORMAL_MAP","USE_NODE_GEOMETRY_NO","CAUSTICS","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{TYPE:"logical_and_expr",PLACES:3},{TYPE:"logical_or_expr",PLACES:6},{TYPE:"logical_and_expr",PLACES:3},"USE_TBN_SHADING","CALC_TBN",{TYPE:"logical_and_expr",PLACES:2},"USE_NODE_BSDF_BEGIN","USE_NODE_FRESNEL","USE_NODE_TEX_COORD_NO","USE_NODE_LAYER_WEIGHT","USE_NODE_BUMP",{TYPE:"logical_or_expr",PLACES:7}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","P",",","Q",";","vec4","S","=","R","(","a_tbn",",","P",",","Q",")",";","vec3","U","=","T","(","S",",","vec3","(","0.0",",","1.0",",","0.0",")",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CALC_TBN_SPACE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","V","=","T","(","S",",","vec3","(","1.0",",","0.0",",","0.0",")",")",";","vec3","W","=","Q","*","cross","(","U",",","V",")",";","vec4","Y","=","X","(","W",",","Q","*","P",")",";","V","=","T","(","Y",",","U",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","V","=","vec3","(","0.0",")",";","vec3","W","=","vec3","(","0.0",")",";"]}]}}]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","U","=","vec3","(","0.0",")",";","vec3","V","=","vec3","(","0.0",")",";","vec3","W","=","vec3","(","0.0",")",";"]}]}}]},{TYPE:"txt",TOKENS:["mat3","Z","=","u_model_tsr",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_TBN_SHADING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CALC_TBN"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","ac","=","normalize","(","_","(","u_model_tsr",",","U",")",")",";","vec3","ad","=","cross","(","vec3","(","0.0",",","0.0",",","1.0",")",",","ac",")",";","vec3","ae","=","cross","(","ac",",","ad",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","ae","=","a_shade_tangs",";"]}]}}]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","ae","=","vec3","(","0.0",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["VERTEX_ANIM"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["O","=","mix","(","O",",","a_position_next",",","u_va_frame_factor",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","ALPHA",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","USE_NODE_NORMAL_MAP","CAUSTICS","CALC_TBN_SPACE",{TYPE:"logical_or_expr",PLACES:5}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","af",",","ah",";","vec4","ai","=","R","(","a_tbn_next",",","af",",","ah",")",";","vec3","aj","=","T","(","ai",",","vec3","(","0.0",",","1.0",",","0.0",")",")",";","U","=","mix","(","U",",","aj",",","VERTEX_ANIM_MIX_NORMALS_FACTOR",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CALC_TBN_SPACE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","ak","=","T","(","ai",",","vec3","(","1.0",",","0.0",",","0.0",")",")",";","vec3","al","=","ah","*","cross","(","aj",",","ak",")",";","vec4","am","=","X","(","al",",","ah","*","af",")",";","ak","=","T","(","am",",","aj",")",";","V","=","mix","(","V",",","ak",",","u_va_frame_factor",")",";","W","=","mix","(","W",",","al",",","u_va_frame_factor",")",";"]}]}}]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SKINNED"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["an","(","O",",","V",",","W",",","U",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WIND_BEND","BILLBOARD",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","ao","=","au_center_pos",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","ao","=","vec3","(","0.0",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["BILLBOARD"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","aq","=","ap","(","Z",",","ao",")",";","Z","=","as","(","u_camera_eye",",","aq",",","N",",","Z",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WIND_BEND","BILLBOARD_JITTERED",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["Z","=","at","(","u_wind",",","u_time",",","u_jitter_amp",",","u_jitter_freq",",","aq",",","Z",")",";"]}]}}]},{TYPE:"txt",TOKENS:["au","aw","=","av","(","O","-","ao",",","ao",",","V",",","ae",",","W",",","U",",","Z",")",";","aw",".","ao","=","aq",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["au","aw","=","av","(","O",",","ao",",","V",",","ae",",","W",",","U",",","Z",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WIND_BEND"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","ALPHA",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["ax","(","aw",".","O",",","aw",".","ao",",","U",",","mat4","(","0.0",")",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["MAIN_BEND_COL","DETAIL_BEND",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","ay","=","T","(","a_tbn",",","vec3","(","0.0",",","1.0",",","0.0",")",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","ay","=","vec3","(","0.0",")",";"]}]}}]},{TYPE:"txt",TOKENS:["ax","(","aw",".","O",",","aw",".","ao",",","ay",",","mat4","(","0.0",")",")",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","ALPHA",{TYPE:"logical_and_expr",PLACES:2},{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_COLOR"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["A","=","az","(","a_texcoord",",","u_texture_scale",")",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","ALPHA",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["h","=","aw",".","O",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","USE_NODE_NORMAL_MAP","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{TYPE:"logical_and_expr",PLACES:3},"USE_NODE_TEX_COORD_NO","USE_NODE_BSDF_BEGIN","USE_NODE_FRESNEL","USE_NODE_TEX_COORD_RE","USE_NODE_LAYER_WEIGHT","USE_NODE_BUMP",{TYPE:"logical_or_expr",PLACES:12}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["j","=","aw",".","U",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CALC_TBN_SPACE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","aA","=","(","dot","(","cross","(","aw",".","U",",","aw",".","V",")",",","aw",".","W",")","<","0.0",")","?","-","1.0",":","1.0",";","k","=","vec4","(","aw",".","V",",","aA",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_TBN_SHADING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["B","=","aw",".","aB",";"]}]}}]},{TYPE:"txt",TOKENS:["i","=","vec4","(","ap","(","N",",","aw",".","O",")",",","1.0",")",";","vec4","f","=","u_proj_matrix","*","i",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_JITTER"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["f",".","xy","+=","u_subpixel_jitter","*","f",".","w",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2},"USE_POSITION_CLIP",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["l","=","aC","(","f",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_B4W_REFRACTION","REFRACTIVE",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["m","=","-","i",".","z","/","u_view_max_depth",";"]}]}}]},{TYPE:"txt",TOKENS:["J","(",")",";"]}]}}]},{TYPE:"txt",TOKENS:["gl_Position","=","u_proj_matrix","*","vec4","(","ap","(","N",",","aw",".","O",")",",","1.0",")",";","}"]}]},e["debug_view.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"DEBUG_SPHERE",TOKENS:["0"]},{TYPE:"var",NAME:"WIREFRAME_QUALITY",TOKENS:["0"]},{TYPE:"var",NAME:"ALPHA",TOKENS:["0"]},{TYPE:"var",NAME:"DEBUG_SPHERE_DYNAMIC",TOKENS:["0"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",FILE:"color_util.glslf"},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DEBUG_SPHERE",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","int","u_debug_view_mode",";","uniform","float","u_cluster_id",";","uniform","float","u_batch_debug_id_color",";","uniform","float","u_batch_debug_main_render_time",";","uniform","float","u_debug_colors_seed",";","uniform","float","u_debug_render_time_threshold",";","uniform","vec3","u_wireframe_edge_color",";"]}]}}]},{TYPE:"txt",TOKENS:["GLSL_IN","vec3","aD",";","GLSL_OUT","vec4","GLSL_OUT_FRAG_COLOR",";","const","float","aE","=","1.0",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DEBUG_SPHERE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DEBUG_SPHERE_DYNAMIC"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["const","vec3","aF","=","vec3","(","1.0",",","0.05",",","0.05",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["const","vec3","aF","=","vec3","(","0.05",",","0.05",",","1.0",")",";"]}]}}]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["const","vec3","aG","=","vec3","(","0.4",",","0.4",",","1.0",")",";","const","vec3","aH","=","vec3","(","1.0",",","0.4",",","0.4",")",";","const","vec3","aI","=","vec3","(","1.0",",","1.0",",","1.0",")",";","const","vec3","aJ","=","vec3","(","0.0",",","133.0","/","255.0",",","66.0","/","255.0",")",";","const","vec3","aK","=","vec3","(","160.0","/","255.0",",","38.0","/","255.0",",","33.0","/","255.0",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DEBUG_SPHERE",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","aP","(",")","{","float","aL","=","1.0",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WIREFRAME_QUALITY",0,{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","aM","=","sign","(","aD","-","vec3","(","0.02","*","aE",")",")",";","if","(","aM",".","x","<","0.0","||","aM",".","y","<","0.0","||","aM",".","z","<","0.0",")","aL","=","0.0",";"]}]}},{TYPE:"elif",EXPRESSION:["WIREFRAME_QUALITY",1,{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["GLSL1"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"extension",TOKENS:["GL_OES_standard_derivatives",":","enable"]}]}}]},{TYPE:"txt",TOKENS:["vec3","aN","=","fwidth","(","aD",")",";","vec3","aO","=","smoothstep","(","vec3","(","0.0",")",",","aN","*","aE",",","aD",")",";","aL","=","min","(","min","(","aO",".","x",",","aO",".","y",")",",","aO",".","z",")",";","aL","=","clamp","(","aL",",","0.0",",","1.0",")",";"]}]}}]},{TYPE:"txt",TOKENS:["return","aL",";","}"]}]}}]},{TYPE:"txt",TOKENS:["void","main","(",")","{","vec3","aQ","=","vec3","(","0.0",")",";","float","L","=","0.0",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DEBUG_SPHERE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","aM","=","sign","(","aD","-","vec3","(","0.02","*","aE",")",")",";","if","(","aM",".","x","<","0.0","||","aM",".","y","<","0.0","||","aM",".","z","<","0.0",")","{","aQ","=","aF",";","L","=","1.0",";","}","else","discard",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["if","(","u_debug_view_mode","==","DV_OPAQUE_WIREFRAME",")","{","float","aL","=","aP","(",")",";","aQ","=","vec3","(","mix","(","u_wireframe_edge_color",",","aI",",","aL",")",")",";","L","=","1.0",";","}","else","if","(","u_debug_view_mode","==","DV_TRANSPARENT_WIREFRAME",")","{","float","aL","=","aP","(",")",";","aQ","=","u_wireframe_edge_color",";","L","=","mix","(","1.0",",","0.0",",","aL",")",";","}","else","if","(","u_debug_view_mode","==","DV_FRONT_BACK_VIEW",")","{","float","aL","=","aP","(",")",";","if","(","gl_FrontFacing",")","aQ","=","mix","(","u_wireframe_edge_color",",","aG",",","aL",")",";","else","aQ","=","mix","(","u_wireframe_edge_color",",","aH",",","aL",")",";","L","=","1.0",";","}","else","if","(","u_debug_view_mode","==","DV_CLUSTERS_VIEW",")","{","float","aR","=","u_cluster_id","+","u_debug_colors_seed","+","2.0",";","aQ","=","vec3","(","fract","(","aR","*","19.73",")",",","fract","(","aR","*","6.34",")",",","fract","(","aR","*","1.56",")",")",";","L","=","1.0",";","}","else","if","(","u_debug_view_mode","==","DV_BATCHES_VIEW",")","{","float","aR","=","u_batch_debug_id_color","+","u_debug_colors_seed",";","aQ","=","vec3","(","fract","(","aR","*","19.73",")",",","fract","(","aR","*","6.34",")",",","fract","(","aR","*","1.56",")",")",";","L","=","1.0",";","}","else","if","(","u_debug_view_mode","==","DV_RENDER_TIME",")","{","float","aS",";","if","(","u_debug_render_time_threshold",">","0.0",")","aS","=","clamp","(","u_batch_debug_main_render_time",",","0.0",",","u_debug_render_time_threshold",")","/","u_debug_render_time_threshold",";","else","aS","=","1.0",";","float","aT","=","clamp","(","2.0","*","aS",",","0.0",",","1.0",")",";","float","aU","=","clamp","(","2.0","*","aS","-","1.0",",","0.0",",","1.0",")",";","float","aV","=","aS",";","aQ","=","mix","(","aJ",",","aK",",","vec3","(","aT",",","aU",",","aV",")",")",";","L","=","1.0",";","}"]}]}}]},{TYPE:"txt",TOKENS:["aW","(","aQ",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["ALPHA"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["aX","(","aQ",",","L",")",";"]}]}}]},{TYPE:"txt",TOKENS:["GLSL_OUT_FRAG_COLOR","=","vec4","(","aQ",",","L",")",";","}"]}]},e["debug_view.glslv"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"PRECISION",TOKENS:["highp"]},{TYPE:"var",NAME:"USE_INSTANCED_PARTCLS",TOKENS:["0"]},{TYPE:"var",NAME:"DEBUG_VIEW_SPECIAL_SKYDOME",TOKENS:["0"]},{TYPE:"var",NAME:"DEBUG_SPHERE",TOKENS:["0"]},{TYPE:"var",NAME:"WIND_BEND",TOKENS:["0"]},{TYPE:"var",NAME:"DYNAMIC_GRASS",TOKENS:["0"]},{TYPE:"var",NAME:"BILLBOARD",TOKENS:["0"]},{TYPE:"var",NAME:"VERTEX_ANIM",TOKENS:["0"]},{TYPE:"var",NAME:"SKINNED",TOKENS:["0"]},{TYPE:"var",NAME:"STATIC_BATCH",TOKENS:["0"]},{TYPE:"var",NAME:"AU_QUALIFIER",TOKENS:["GLSL_IN"]},{TYPE:"var",NAME:"BEND_CENTER_ONLY",TOKENS:["0"]},{TYPE:"var",NAME:"FRAMES_BLENDING",TOKENS:["0"]},{TYPE:"var",NAME:"MAIN_BEND_COL",TOKENS:["0"]},{TYPE:"var",NAME:"MAX_BONES",TOKENS:["0"]},{TYPE:"var",NAME:"DETAIL_BEND",TOKENS:["0"]},{TYPE:"var",NAME:"BILLBOARD_JITTERED",TOKENS:["0"]},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",FILE:"math.glslv"},{TYPE:"include",FILE:"to_world.glslv"},{TYPE:"txt",TOKENS:["GLSL_IN","vec3","a_position",";","GLSL_IN","vec4","a_tbn",";","GLSL_IN","float","a_polyindex",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_INSTANCED_PARTCLS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","a_part_ts",";","GLSL_IN","vec4","a_part_r",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DEBUG_SPHERE",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WIND_BEND"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["MAIN_BEND_COL"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","float","a_bending_col_main",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DETAIL_BEND"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","a_bending_col_detail",";","AU_QUALIFIER","float","au_detail_bending_amp",";","AU_QUALIFIER","float","au_branch_bending_amp",";","AU_QUALIFIER","float","au_detail_bending_freq",";"]}]}}]}]}}]},{TYPE:"txt",TOKENS:["AU_QUALIFIER","float","au_wind_bending_amp",";","AU_QUALIFIER","float","au_wind_bending_freq",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["BEND_CENTER_ONLY"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","a_emitter_center",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{TYPE:"logical_or_expr",PLACES:3},"USE_INSTANCED_PARTCLS",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["VERTEX_ANIM"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","a_position_next",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SKINNED"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","a_influence",";"]}]}}]}]}}]},{TYPE:"txt",TOKENS:["GLSL_OUT","vec3","aD",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["STATIC_BATCH"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["const","mat3","u_model_tsr","=","mat3","(","0.0",",","0.0",",","0.0",",","1.0",",","0.0",",","0.0",",","0.0",",","1.0",",","0.0",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat3","u_model_tsr",";"]}]}}]},{TYPE:"txt",TOKENS:["uniform","mat3","u_view_tsr",";","uniform","mat4","u_proj_matrix",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DEBUG_SPHERE",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WIND_BEND"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec3","u_wind",";","uniform","float","u_time",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["BILLBOARD","BILLBOARD_JITTERED",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","float","u_jitter_amp",";","uniform","float","u_jitter_freq",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC_GRASS","BILLBOARD",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec3","u_camera_eye",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["VERTEX_ANIM"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","float","u_va_frame_factor",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SKINNED"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_quatsb","[","MAX_BONES","]",";","uniform","vec4","u_transb","[","MAX_BONES","]",";","uniform","vec4","u_arm_rel_trans",";","uniform","vec4","u_arm_rel_quat",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FRAMES_BLENDING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_quatsa","[","MAX_BONES","]",";","uniform","vec4","u_transa","[","MAX_BONES","]",";","uniform","float","u_frame_factor",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC_GRASS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","PRECISION","sampler2D","u_grass_map_depth",";","uniform","sampler2D","u_grass_map_color",";","uniform","vec4","u_camera_quat",";","uniform","vec3","u_grass_map_dim",";","uniform","float","u_grass_size",";","uniform","float","u_scale_threshold",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DEBUG_SPHERE",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"skin.glslv"},{TYPE:"include",FILE:"wind_bending.glslv"},{TYPE:"include",FILE:"dynamic_grass.glslv"}]}}]},{TYPE:"txt",TOKENS:["void","main","(",")","{","if","(","a_polyindex","==","0.0",")","aD","=","vec3","(","1.0",",","0.0",",","0.0",")",";","else","if","(","a_polyindex","==","1.0",")","aD","=","vec3","(","0.0",",","0.0",",","1.0",")",";","else","aD","=","vec3","(","0.0",",","1.0",",","0.0",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DEBUG_VIEW_SPECIAL_SKYDOME"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["gl_Position","=","vec4","(","a_position",".","xy",",","0.9999999",",","1.0",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_INSTANCED_PARTCLS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["mat3","Z","=","mat3","(","a_part_ts","[","0","]",",","a_part_ts","[","1","]",",","a_part_ts","[","2","]",",","a_part_ts","[","3","]",",","a_part_r","[","0","]",",","a_part_r","[","1","]",",","a_part_r","[","2","]",",","a_part_r","[","3","]",",","1.0",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["STATIC_BATCH",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["Z","=","aY","(","u_model_tsr",",","Z",")",";"]}]}}]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["mat3","Z","=","u_model_tsr",";"]}]}}]},{TYPE:"txt",TOKENS:["mat3","N","=","u_view_tsr",";","vec3","O","=","a_position",";","vec4","S","=","R","(","a_tbn",")",";","vec3","U","=","T","(","S",",","vec3","(","0.0",",","1.0",",","0.0",")",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DEBUG_SPHERE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["au","aw","=","av","(","O",",","vec3","(","0.0",")",",","vec3","(","0.0",")",",","vec3","(","0.0",")",",","vec3","(","0.0",")",",","vec3","(","0.0",")",",","Z",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["VERTEX_ANIM"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["O","=","mix","(","O",",","a_position_next",",","u_va_frame_factor",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SKINNED"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","V","=","vec3","(","0.0",")",";","vec3","W","=","vec3","(","0.0",")",";","an","(","O",",","V",",","W",",","U",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{TYPE:"logical_or_expr",PLACES:3},"USE_INSTANCED_PARTCLS",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","ao","=","au_center_pos",";"]}]}},{TYPE:"elif",EXPRESSION:["DYNAMIC_GRASS","USE_INSTANCED_PARTCLS",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","ao","=","a_part_ts",".","xyz",";","O","=","ap","(","Z",",","O",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","ao","=","vec3","(","0.0",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC_GRASS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["au","aw","=","aZ","(","O",",","vec3","(","0.0",")",",","vec3","(","0.0",")",",","vec3","(","0.0",")",",","vec3","(","0.0",")",",","ao",",","u_grass_map_depth",",","u_grass_map_color",",","u_grass_map_dim",",","u_grass_size",",","u_camera_eye",",","u_camera_quat",",","N",",","Z",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["BILLBOARD"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","aq","=","ap","(","Z",",","ao",")",";","Z","=","as","(","u_camera_eye",",","aq",",","N",",","Z",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WIND_BEND","BILLBOARD_JITTERED",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","a_","=","aq",";","Z","=","at","(","u_wind",",","u_time",",","u_jitter_amp",",","u_jitter_freq",",","a_",",","Z",")",";"]}]}}]},{TYPE:"txt",TOKENS:["au","aw","=","av","(","O","-","ao",",","ao",",","vec3","(","0.0",")",",","vec3","(","0.0",")",",","vec3","(","0.0",")",",","vec3","(","0.0",")",",","Z",")",";","aw",".","ao","=","aq",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["au","aw","=","av","(","O",",","ao",",","vec3","(","0.0",")",",","vec3","(","0.0",")",",","vec3","(","0.0",")",",","vec3","(","0.0",")",",","Z",")",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WIND_BEND"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["ax","(","aw",".","O",",","aw",".","ao",",","U",",","mat4","(","0.0",")",")",";"]}]}}]}]}}]},{TYPE:"txt",TOKENS:["gl_Position","=","u_proj_matrix","*","vec4","(","ap","(","N",",","aw",".","O",")",",","1.0",")",";"]}]}}]},{TYPE:"txt",TOKENS:["}"]}]},e["error.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"txt",TOKENS:["GLSL_OUT","vec4","GLSL_OUT_FRAG_COLOR",";","void","main","(",")","{","GLSL_OUT_FRAG_COLOR","=","vec4","(","1.0",",","0.0",",","1.0",",","1.0",")",";","}"]}]},e["error.glslv"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",FILE:"math.glslv"},{TYPE:"txt",TOKENS:["GLSL_IN","vec3","a_position",";","uniform","mat3","u_view_tsr",";","uniform","mat4","u_proj_matrix",";","void","main","(",")","{","gl_Position","=","u_proj_matrix","*","bc","(","u_view_tsr",")","*","vec4","(","a_position",",","1.0",")",";","}"]}]},e["grass_map.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"DYNAMIC_GRASS_SIZE",TOKENS:["0"]},{TYPE:"var",NAME:"DYNAMIC_GRASS_COLOR",TOKENS:["0"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC_GRASS_SIZE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC_GRASS_COLOR"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","bd",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","float","bd",";"]}]}}]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC_GRASS_COLOR"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","bd",";"]}]}}]}]}}]},{TYPE:"txt",TOKENS:["GLSL_OUT","vec4","GLSL_OUT_FRAG_COLOR",";","void","main","(",")","{"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC_GRASS_SIZE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC_GRASS_COLOR"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT_FRAG_COLOR","=","bd",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT_FRAG_COLOR","=","vec4","(","bd",",","vec3","(","1.0",")",")",";"]}]}}]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC_GRASS_COLOR"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT_FRAG_COLOR","=","vec4","(","1.0",",","bd",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT_FRAG_COLOR","=","vec4","(","1.0",")",";"]}]}}]}]}}]},{TYPE:"txt",TOKENS:["}"]}]},e["grass_map.glslv"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"DYNAMIC_GRASS_SIZE",TOKENS:["0"]},{TYPE:"var",NAME:"DYNAMIC_GRASS_COLOR",TOKENS:["0"]},{TYPE:"var",NAME:"WIND_BEND",TOKENS:["0"]},{TYPE:"var",NAME:"STATIC_BATCH",TOKENS:["0"]},{TYPE:"var",NAME:"BILLBOARD",TOKENS:["0"]},{TYPE:"var",NAME:"BILLBOARD_JITTERED",TOKENS:["0"]},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",FILE:"math.glslv"},{TYPE:"include",FILE:"to_world.glslv"},{TYPE:"txt",TOKENS:["GLSL_IN","vec3","a_position",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC_GRASS_SIZE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","float","a_grass_size",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC_GRASS_COLOR"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","a_grass_color",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC_GRASS_SIZE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC_GRASS_COLOR"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec4","bd",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","float","bd",";"]}]}}]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC_GRASS_COLOR"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec3","bd",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["STATIC_BATCH"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["const","mat3","u_model_tsr","=","mat3","(","0.0",",","0.0",",","0.0",",","1.0",",","0.0",",","0.0",",","0.0",",","1.0",",","0.0",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat3","u_model_tsr",";"]}]}}]},{TYPE:"txt",TOKENS:["uniform","mat3","u_view_tsr",";","uniform","mat4","u_proj_matrix",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["BILLBOARD"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec3","u_camera_eye",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WIND_BEND","BILLBOARD_JITTERED",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec3","u_wind",";","uniform","float","u_time",";","uniform","float","u_jitter_amp",";","uniform","float","u_jitter_freq",";"]}]}}]},{TYPE:"txt",TOKENS:["void","main","(",")","{","mat3","N","=","u_view_tsr",";","mat3","Z","=","u_model_tsr",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["BILLBOARD"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","aq","=","ap","(","Z",",","vec3","(","0.0",")",")",";","Z","=","as","(","u_camera_eye",",","aq",",","N",",","u_model_tsr",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WIND_BEND","BILLBOARD_JITTERED",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["Z","=","at","(","u_wind",",","u_time",",","u_jitter_amp",",","u_jitter_freq",",","vec3","(","0.0",")",",","Z",")",";"]}]}}]},{TYPE:"txt",TOKENS:["au","aw","=","av","(","a_position",",","vec3","(","0.0",")",",","vec3","(","0.0",")",",","vec3","(","0.0",")",",","vec3","(","0.0",")",",","vec3","(","0.0",")",",","Z",")",";","aw",".","ao","=","aq",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["au","aw","=","av","(","a_position",",","vec3","(","0.0",")",",","vec3","(","0.0",")",",","vec3","(","0.0",")",",","vec3","(","0.0",")",",","vec3","(","0.0",")",",","Z",")",";"]}]}}]},{TYPE:"txt",TOKENS:["vec4","f","=","u_proj_matrix","*","vec4","(","ap","(","N",",","aw",".","O",")",",","1.0",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC_GRASS_SIZE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC_GRASS_COLOR"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["bd","=","vec4","(","a_grass_size",",","a_grass_color",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["bd","=","a_grass_size",";"]}]}}]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC_GRASS_COLOR"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["bd","=","a_grass_color",";"]}]}}]}]}}]},{TYPE:"txt",TOKENS:["gl_Position","=","f",";","}"]}]},e["halo.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"SKY_STARS",TOKENS:["0"]},{TYPE:"var",NAME:"WATER_EFFECTS",TOKENS:["0"]},{TYPE:"var",NAME:"DISABLE_FOG",TOKENS:["0"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"txt",TOKENS:["uniform","vec4","u_diffuse_color",";","uniform","vec3","u_halo_rings_color",";","uniform","vec3","u_halo_lines_color",";","uniform","float","u_halo_hardness",";","uniform","float","u_halo_size",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SKY_STARS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec3","u_sun_intensity",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WATER_EFFECTS","DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","float","u_halo_stars_blend",";","uniform","float","u_halo_stars_height",";","uniform","float","u_cam_water_depth",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SKY_STARS","WATER_EFFECTS","DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_and_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","be",";"]}]}}]},{TYPE:"txt",TOKENS:["GLSL_IN","vec2","A",";","GLSL_IN","float","bf",";","GLSL_OUT","vec4","GLSL_OUT_FRAG_COLOR",";"]},{TYPE:"include",FILE:"color_util.glslf"},{TYPE:"include",FILE:"halo_color.glslf"},{TYPE:"txt",TOKENS:["void","main","(",")","{","vec4","bi","=","bh","(",")",";","vec3","aQ","=","bi",".","rgb",";","float","aM","=","bi",".","a",";","aW","(","aQ",")",";","aX","(","aQ",",","aM",")",";","GLSL_OUT_FRAG_COLOR","=","vec4","(","aQ",",","aM",")",";","}"]}]},e["halo.glslv"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"PRECISION",TOKENS:["highp"]},{TYPE:"var",NAME:"WATER_EFFECTS",TOKENS:["0"]},{TYPE:"var",NAME:"DISABLE_FOG",TOKENS:["0"]},{TYPE:"var",NAME:"SKY_STARS",TOKENS:["0"]},{TYPE:"var",NAME:"STATIC_BATCH",TOKENS:["0"]},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",FILE:"math.glslv"},{TYPE:"include",FILE:"to_world.glslv"},{TYPE:"txt",TOKENS:["uniform","mat3","u_view_tsr",";","uniform","mat4","u_proj_matrix",";","uniform","PRECISION","float","u_halo_size",";","uniform","vec3","u_camera_eye",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["STATIC_BATCH"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["const","mat3","u_model_tsr","=","mat3","(","0.0",",","0.0",",","0.0",",","1.0",",","0.0",",","0.0",",","0.0",",","1.0",",","0.0",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat3","u_model_tsr",";"]}]}}]},{TYPE:"txt",TOKENS:["GLSL_IN","vec3","a_position",";","GLSL_IN","vec2","a_halo_bb_vertex",";","GLSL_IN","float","a_random_vals",";","GLSL_OUT","vec2","A",";","GLSL_OUT","float","bf",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WATER_EFFECTS","DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec4","be",";"]}]}}]},{TYPE:"txt",TOKENS:["void","main","(",")","{","mat3","N","=","u_view_tsr",";","mat3","Z","=","u_model_tsr",";","vec3","O","=","ap","(","Z",",","a_position",")",";","A","=","a_halo_bb_vertex","*","2.0","-","1.0",";","bf","=","a_random_vals",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SKY_STARS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["mat3","bk","=","bj","(","O",",","N",")",";","mat3","bl","=","N",";","bl","[","0","]","[","0","]","=","0.0",";","bl","[","0","]","[","1","]","=","0.0",";","bl","[","0","]","[","2","]","=","0.0",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["mat3","bk","=","bj","(","O",",","N",")",";"]}]}}]},{TYPE:"txt",TOKENS:["vec2","bm","=","(","a_halo_bb_vertex","*","2.0","-","1.0",")","*","u_halo_size",";","vec3","bn","=","vec3","(","bm","[","0","]",",","0.0",",","bm","[","1","]",")",";","vec3","bo","=","ap","(","bk",",","bn",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SKY_STARS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec4","f","=","u_proj_matrix","*","vec4","(","ap","(","bl",",","bo",")",",","1.0",")",";","f",".","z","=","0.99999","*","f",".","w",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WATER_EFFECTS","DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["be","=","vec4","(","bo",",","1.0",")",";"]}]}}]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec4","f","=","u_proj_matrix","*","vec4","(","ap","(","N",",","bo",")",",","1.0",")",";"]}]}}]},{TYPE:"txt",TOKENS:["gl_Position","=","f",";","}"]}]},e["irradiance_skybox.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",FILE:"color_util.glslf"},{TYPE:"txt",TOKENS:["uniform","samplerCube","u_sky_reflection",";","GLSL_OUT","vec4","GLSL_OUT_FRAG_COLOR",";","GLSL_IN","vec3","bp",";","void","main","(",")","{","vec3","bq","=","normalize","(","bp",")",";","vec3","bs",";","vec3","bt","=","vec3","(","0.0",")",";","vec3","bu","=","vec3","(","0.0",",","0.0",",","1.0",")",";","vec3","bv","=","vec3","(","1.0",",","0.0",",","0.0",")",";","const","float","bw","=","0.025",";","float","bx","=","0.0",";","for","(","float","by","=","0.0",";","by","<","2.0","*","M_PI",";","by","+=","bw",")","{","for","(","float","bz","=","0.0",";","bz","<","0.5","*","M_PI",";","bz","+=","bw",")","{","vec3","bA","=","vec3","(","sin","(","bz",")","*","cos","(","by",")",",","sin","(","bz",")","*","sin","(","by",")",",","cos","(","bz",")",")",";","vec3","bB","=","bA",".","x","*","bv","+","bA",".","y","*","bu","+","bA",".","z","*","bq",";","vec3","bs","=","GLSL_TEXTURE_CUBE","(","u_sky_reflection",",","bB",")",".","rgb",";","bC","(","bs",")",";","bt","+=","bs","*","cos","(","bz",")","*","sin","(","bz",")",";","bx","++",";","}","}","bt","=","M_PI","*","bt","*","(","1.0","/","float","(","bx",")",")",";","GLSL_OUT_FRAG_COLOR","=","vec4","(","bt",",","1.0",")",";","}"]}]},e["lens_flares.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",FILE:"color_util.glslf"},{TYPE:"txt",TOKENS:["uniform","sampler2D","u_sampler",";","GLSL_IN","vec2","A",";","GLSL_OUT","vec4","GLSL_OUT_FRAG_COLOR",";","void","main","(",")","{","vec4","aQ","=","GLSL_TEXTURE","(","u_sampler",",","A",")",";","aW","(","aQ",".","rgb",")",";","aX","(","aQ",".","rgb",",","aQ",".","a",")",";","GLSL_OUT_FRAG_COLOR","=","aQ",";","}"]}]},e["lens_flares.glslv"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"NUM_LIGHTS",TOKENS:["0"]},{TYPE:"define",NAME:"LIGHT_INDEX",TOKENS:["0"]},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",FILE:"math.glslv"},{TYPE:"txt",TOKENS:["uniform","mat3","u_view_tsr",";","uniform","mat4","u_proj_matrix",";","uniform","vec3","u_light_directions","[","NUM_LIGHTS","]",";","GLSL_IN","float","a_lf_dist",";","GLSL_IN","vec2","a_lf_bb_vertex",";","GLSL_IN","vec2","a_texcoord",";","GLSL_OUT","vec2","A",";","void","main","(",")","{","A","=","a_texcoord",";","vec3","bD","=","normalize","(","u_light_directions","[","LIGHT_INDEX","]",")",";","vec4","f","=","u_proj_matrix","*","vec4","(","_","(","u_view_tsr",",","bD",")",",","0.0",")",";","f",".","x","/=","f",".","w",";","f",".","y","/=","f",".","w",";","f","+=","99999.0","*","step","(","f",".","z",",","0.0",")",";","f","+=","100.0","*","(","step","(","1.0",",","abs","(","f",".","x",")",")","+","step","(","1.0",",","abs","(","f",".","y",")",")",")",";","f",".","x","=","a_lf_dist","*","f",".","x",";","f",".","y","=","a_lf_dist","*","f",".","y",";","float","bE","=","u_proj_matrix","[","1","]","[","1","]","/","u_proj_matrix","[","0","]","[","0","]",";","vec2","bF","=","vec2","(","a_lf_bb_vertex",".","x","/","bE",",","a_lf_bb_vertex",".","y",")",";","if","(","a_lf_dist","<","0.999",")","{","const","float","bG","=","1.9",";","bF","*=","(","1.0","+","bG","*","length","(","f",".","xy",")",")",";","}","gl_Position","=","vec4","(","f",".","xy","+","bF",",","0.999999",",","1.0",")",";","}"]}]},e["line.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"ALPHA",TOKENS:["0"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",FILE:"color_util.glslf"},{TYPE:"txt",TOKENS:["uniform","vec4","u_diffuse_color",";","GLSL_OUT","vec4","GLSL_OUT_FRAG_COLOR",";","void","main","(",")","{","vec3","aQ","=","u_diffuse_color",".","xyz",";","float","L","=","u_diffuse_color",".","a",";","aW","(","aQ",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["ALPHA"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["aX","(","aQ",",","L",")",";"]}]}}]},{TYPE:"txt",TOKENS:["GLSL_OUT_FRAG_COLOR","=","vec4","(","aQ",",","L",")",";","}"]}]},e["line.glslv"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",FILE:"math.glslv"},{TYPE:"include",FILE:"to_world.glslv"},{TYPE:"txt",TOKENS:["GLSL_IN","vec3","a_position",";","GLSL_IN","vec3","a_direction",";","uniform","mat3","u_model_tsr",";","uniform","mat3","u_view_tsr",";","uniform","mat4","u_proj_matrix",";","uniform","float","u_height",";","uniform","float","u_line_width",";","void","main","(",")","{","mat3","N","=","u_view_tsr",";","mat3","Z","=","u_model_tsr",";","au","aw","=","av","(","a_position",",","vec3","(","0.0",")",",","vec3","(","0.0",")",",","vec3","(","0.0",")",",","vec3","(","0.0",")",",","normalize","(","a_direction",")",",","Z",")",";","vec4","bH","=","u_proj_matrix","*","vec4","(","ap","(","N",",","aw",".","O",")",",","1.0",")",";","bH",".","xyz","/=","bH",".","w",";","vec4","bI","=","u_proj_matrix","*","vec4","(","ap","(","N",",","aw",".","O","+","aw",".","U",")",",","1.0",")",";","bI",".","xyz","/=","bI",".","w",";","float","bE","=","u_proj_matrix","[","1","]","[","1","]","/","u_proj_matrix","[","0","]","[","0","]",";","vec2","bJ","=","(","bI","-","bH",")",".","xy",";","bJ",".","x","*=","bE",";","float","bK","=","M_PI","/","2.0",";","mat2","bL","=","mat2","(","cos","(","bK",")",",","sin","(","bK",")",",","-","sin","(","bK",")",",","cos","(","bK",")",")",";","bJ","=","bL","*","bJ",";","bJ","=","normalize","(","bJ",")",";","vec2","bM","=","(","u_line_width","/","u_height",")","*","vec2","(","1.0","/","bE",",","1.0",")",";","gl_Position","=","vec4","(","bH",".","xy","+","bJ",".","xy","*","bM","/","2.0",",","bH",".","z",",","1.0",")",";","gl_Position","*=","bH",".","w",";","}"]}]},e["main.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"PRECISION",TOKENS:["highp"]},{TYPE:"var",NAME:"SHADELESS",TOKENS:["0"]},{TYPE:"var",NAME:"CAUSTICS",TOKENS:["0"]},{TYPE:"var",NAME:"USE_ENVIRONMENT_LIGHT",TOKENS:["0"]},{TYPE:"var",NAME:"SKY_TEXTURE",TOKENS:["0"]},{TYPE:"var",NAME:"SKY_COLOR",TOKENS:["0"]},{TYPE:"var",NAME:"NORMAL_TEXCOORD",TOKENS:["0"]},{TYPE:"var",NAME:"USE_VIEW_TSR",TOKENS:["0"]},{TYPE:"var",NAME:"USE_VIEW_TSR_INVERSE",TOKENS:["0"]},{TYPE:"var",NAME:"USE_MODEL_TSR",TOKENS:["0"]},{TYPE:"var",NAME:"USE_MODEL_TSR_INVERSE",TOKENS:["0"]},{TYPE:"var",NAME:"WATER_EFFECTS",TOKENS:["0"]},{TYPE:"var",NAME:"USE_FOG",TOKENS:["0"]},{TYPE:"var",NAME:"CALC_TBN_SPACE",TOKENS:["0"]},{TYPE:"var",NAME:"TEXTURE_NORM_CO",TOKENS:["TEXTURE_COORDS_NONE"]},{TYPE:"var",NAME:"PARALLAX",TOKENS:["0"]},{TYPE:"var",NAME:"USE_TBN_SHADING",TOKENS:["0"]},{TYPE:"var",NAME:"CAMERA_TYPE",TOKENS:["CAM_TYPE_PERSP"]},{TYPE:"var",NAME:"USE_POSITION_CLIP",TOKENS:["0"]},{TYPE:"var",NAME:"RGBA_SHADOWS",TOKENS:["0"]},{TYPE:"var",NAME:"USE_BSDF_SKY_DIM",TOKENS:["0"]},{TYPE:"var",NAME:"NODES",TOKENS:["0"]},{TYPE:"var",NAME:"ALPHA",TOKENS:["0"]},{TYPE:"var",NAME:"ALPHA_CLIP",TOKENS:["0"]},{TYPE:"var",NAME:"WETTABLE",TOKENS:["0"]},{TYPE:"var",NAME:"NUM_VALUES",TOKENS:["0"]},{TYPE:"var",NAME:"NUM_RGBS",TOKENS:["0"]},{TYPE:"var",NAME:"DISABLE_FOG",TOKENS:["0"]},{TYPE:"var",NAME:"SHADOW_USAGE",TOKENS:["NO_SHADOWS"]},{TYPE:"var",NAME:"NUM_LIGHTS",TOKENS:["0"]},{TYPE:"var",NAME:"NUM_LAMP_LIGHTS",TOKENS:["0"]},{TYPE:"var",NAME:"SSAO_ONLY",TOKENS:["0"]},{TYPE:"var",NAME:"REFLECTION_TYPE",TOKENS:["REFL_NONE"]},{TYPE:"var",NAME:"PROCEDURAL_FOG",TOKENS:["0"]},{TYPE:"var",NAME:"REFRACTIVE",TOKENS:["0"]},{TYPE:"var",NAME:"USE_REFRACTION",TOKENS:["0"]},{TYPE:"var",NAME:"USE_REFRACTION_CORRECTION",TOKENS:["0"]},{TYPE:"var",NAME:"CSM_SECTION1",TOKENS:["0"]},{TYPE:"var",NAME:"CSM_SECTION2",TOKENS:["0"]},{TYPE:"var",NAME:"CSM_SECTION3",TOKENS:["0"]},{TYPE:"var",NAME:"NUM_CAST_LAMPS",TOKENS:["0"]},{TYPE:"var",NAME:"WATER_LEVEL",TOKENS:["0.0"]},{TYPE:"var",NAME:"POISSON_DISK_NUM",TOKENS:["NO_SOFT_SHADOWS"]},{TYPE:"var",NAME:"USE_DERIVATIVES_EXT",TOKENS:["0"]},{TYPE:"var",NAME:"USE_TEXTURE_LOD_EXT",TOKENS:["0"]},{TYPE:"var",NAME:"USE_LOD_SMOOTHING",TOKENS:["0"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["GLSL1","USE_DERIVATIVES_EXT",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"extension",TOKENS:["GL_OES_standard_derivatives",":","enable"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["GLSL1","USE_TEXTURE_LOD_EXT",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"extension",TOKENS:["GL_EXT_shader_texture_lod",":","enable"]}]}}]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",FILE:"color_util.glslf"},{TYPE:"include",FILE:"math.glslv"},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_LOD_SMOOTHING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"coverage.glslf"}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADELESS",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CAUSTICS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"caustics.glslf"}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["RGBA_SHADOWS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"pack.glslf"}]}}]},{TYPE:"txt",TOKENS:["uniform","float","u_time",";","uniform","vec2","u_texel_size",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","samplerCube","u_sky_texture",";"]}]}},{TYPE:"elif",EXPRESSION:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec3","u_horizon_color",";","uniform","vec3","u_zenith_color",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["GLSL1","USE_BSDF_SKY_DIM",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","float","u_bsdf_cube_sky_dim",";"]}]}}]},{TYPE:"txt",TOKENS:["uniform","float","u_environment_energy",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADELESS",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_LIGHTS",0,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_light_positions","[","NUM_LIGHTS","]",";","uniform","vec3","u_light_directions","[","NUM_LIGHTS","]",";","uniform","vec4","u_light_color_intensities","[","NUM_LIGHTS","]",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CAUSTICS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_sun_quaternion",";","uniform","vec3","u_sun_intensity",";","uniform","vec3","u_sun_direction",";"]}]}}]}]}}]},{TYPE:"txt",TOKENS:["uniform","vec3","u_camera_eye_frag",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_FRESNEL","USE_NODE_LAYER_WEIGHT",{TYPE:"logical_or_expr",PLACES:2},"CAMERA_TYPE","CAM_TYPE_ORTHO",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec3","u_camera_direction",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NORMAL_TEXCOORD","REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2},"USE_VIEW_TSR",{TYPE:"logical_or_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat3","u_view_tsr_frag",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_VIEW_TSR_INVERSE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat3","u_view_tsr_inverse",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_MODEL_TSR"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat3","u_model_tsr",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_MODEL_TSR_INVERSE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat3","u_model_tsr_inverse",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_fog_color_density",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WATER_EFFECTS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_underwater_fog_color_density",";","uniform","float","u_cam_water_depth",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["PROCEDURAL_FOG"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat4","u_cube_fog",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_FOG"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_fog_params",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_LOD_SMOOTHING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","float","u_lod_coverage",";","uniform","float","u_lod_cmp_logic",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_plane_reflection",";"]}]}},{TYPE:"elif",EXPRESSION:["REFLECTION_TYPE","REFL_CUBE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","samplerCube","u_cube_reflection",";"]}]}},{TYPE:"elif",EXPRESSION:["REFLECTION_TYPE","REFL_MIRRORMAP",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","samplerCube","u_mirrormap",";"]}]}},{TYPE:"elif",EXPRESSION:["REFLECTION_TYPE","REFL_PBR_SIMPLE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","samplerCube","u_sky_reflection",";"]}]}},{TYPE:"elif",EXPRESSION:["REFLECTION_TYPE","REFL_PBR_STANDARD",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","samplerCube","u_cube_irradiance",";","uniform","samplerCube","u_cube_r_convolution",";","uniform","sampler2D","u_brdf",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_shadow_mask",";"]}]}},{TYPE:"elif",EXPRESSION:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["POISSON_DISK_NUM","NO_SOFT_SHADOWS",{TYPE:"non_equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_pcf_blur_radii",";"]}]}}]},{TYPE:"txt",TOKENS:["uniform","vec4","u_csm_center_dists",";","uniform","PRECISION","GLSL_SMPLR2D_SHDW","u_shadow_map0",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION1","NUM_CAST_LAMPS",1,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","PRECISION","GLSL_SMPLR2D_SHDW","u_shadow_map1",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION2","NUM_CAST_LAMPS",2,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","PRECISION","GLSL_SMPLR2D_SHDW","u_shadow_map2",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION3","NUM_CAST_LAMPS",3,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","PRECISION","GLSL_SMPLR2D_SHDW","u_shadow_map3",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFRACTIVE","USE_NODE_B4W_REFRACTION",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_refractmap",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_B4W_REFRACTION","USE_REFRACTION","REFRACTIVE","USE_REFRACTION_CORRECTION",{TYPE:"logical_and_expr",PLACES:4}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","PRECISION","sampler2D","u_scene_depth",";"]}]}}]},{TYPE:"txt",TOKENS:["uniform","float","u_emit",";","uniform","float","u_ambient",";","uniform","vec2","u_fresnel_params",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2},"REFLECTION_TYPE","REFL_CUBE",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[]}},{TYPE:"elif",EXPRESSION:["REFLECTION_TYPE","REFL_MIRRORMAP",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","float","u_mirror_factor",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_refl_plane",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_LAMP","NUM_LAMP_LIGHTS",0,{TYPE:"non_equal_expr",PLACES:2},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec3","u_lamp_light_positions","[","NUM_LAMP_LIGHTS","]",";","uniform","vec3","u_lamp_light_directions","[","NUM_LAMP_LIGHTS","]",";","uniform","vec3","u_lamp_light_color_intensities","[","NUM_LAMP_LIGHTS","]",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_VALUE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_node_values","[","NUM_VALUES","]",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_RGB"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec3","u_node_rgbs","[","NUM_RGBS","]",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_CURVE_VEC","USE_NODE_CURVE_RGB","USE_NODE_VALTORGB",{TYPE:"logical_or_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_nodes_texture",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_OBJECT_INFO"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec3","u_obj_info",";"]}]}}]},{TYPE:"txt",TOKENS:["GLSL_IN","vec3","h",";","GLSL_IN","vec3","j",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1},"TEXTURE_NORM_CO","TEXTURE_COORDS_NONE",{TYPE:"non_equal_expr",PLACES:2},"PARALLAX",{TYPE:"logical_and_expr",PLACES:2},"SHADELESS",{TYPE:"logic_negative_expr",PLACES:1},"CAUSTICS","WATER_EFFECTS",{TYPE:"logical_and_expr",PLACES:3},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{TYPE:"equal_expr",PLACES:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:6}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","i",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_NORM_CO","TEXTURE_COORDS_NONE",{TYPE:"non_equal_expr",PLACES:2},"CALC_TBN_SPACE",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","k",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_TBN_SHADING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","B",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","n",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION1","NUM_CAST_LAMPS",1,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","o",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION2","NUM_CAST_LAMPS",2,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","u",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION3","NUM_CAST_LAMPS",3,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","v",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{TYPE:"equal_expr",PLACES:2},"REFRACTIVE","USE_POSITION_CLIP",{TYPE:"logical_or_expr",PLACES:4}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","l",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFRACTIVE","USE_NODE_B4W_REFRACTION",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","float","m",";"]}]}}]},{TYPE:"txt",TOKENS:["GLSL_OUT","vec4","GLSL_OUT_FRAG_COLOR",";"]},{TYPE:"include",FILE:"nodes.glslf"},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"fog.glslf"}]}}]},{TYPE:"txt",TOKENS:["void","main","(",")","{"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_LOD_SMOOTHING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["if","(","!","C","(","u_lod_coverage",",","u_lod_cmp_logic",")",")","discard",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1},"TEXTURE_NORM_CO","TEXTURE_COORDS_NONE",{TYPE:"non_equal_expr",PLACES:2},"PARALLAX",{TYPE:"logical_and_expr",PLACES:2},"SHADELESS",{TYPE:"logic_negative_expr",PLACES:1},"CAUSTICS","WATER_EFFECTS",{TYPE:"logical_and_expr",PLACES:3},{TYPE:"logical_or_expr",PLACES:4}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","bN","=","length","(","i",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WATER_EFFECTS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","bO","=","h",".","z","-","WATER_LEVEL",";"]}]}}]},{TYPE:"txt",TOKENS:["vec3","D","=","normalize","(","u_camera_eye_frag","-","h",")",";","vec3","E",";","vec3","F",";","vec3","G",";","vec4","H",";","float","I",";","J","(","D",",","E",",","F",",","G",",","H",",","I",")",";","vec3","aQ","=","E",";","float","L","=","I",";","vec3","U","=","G",";","vec4","bP","=","H",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADELESS",{TYPE:"logic_negative_expr",PLACES:1},"WATER_EFFECTS",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WETTABLE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["aQ","=","max","(","aQ","-","sqrt","(","0.01","*","-","min","(","bO",",","0.0",")",")",",","0.5","*","aQ",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CAUSTICS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["bQ","(","aQ",",","bO",",","u_time",",","bP",",","U",",","u_sun_direction",",","u_sun_intensity",",","u_sun_quaternion",",","h",",","bN",")",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["ALPHA"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["ALPHA_CLIP"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["if","(","L","<","0.5",")","discard",";","L","=","1.0",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["L","=","min","(","1.0",",","L",")",";"]}]}}]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["L","=","1.0",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WATER_EFFECTS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["bR","(","aQ",",","bN",",","D",",","bO",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["bR","(","aQ",",","bN",",","D",",","1.0",")",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SSAO_ONLY","SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","bS","=","GLSL_TEXTURE_PROJ","(","u_shadow_mask",",","l",")",".","a",";","aQ","=","vec3","(","bS",")",";"]}]}}]},{TYPE:"txt",TOKENS:["aQ","=","max","(","vec3","(","0.0",")",",","aQ",")",";","aW","(","aQ",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["ALPHA","ALPHA_CLIP",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["aX","(","aQ",",","L",")",";"]}]}}]},{TYPE:"txt",TOKENS:["GLSL_OUT_FRAG_COLOR","=","vec4","(","aQ",",","L",")",";","}"]}]},e["main.glslv"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"PRECISION",TOKENS:["highp"]},{TYPE:"var",NAME:"SHADELESS",TOKENS:["0"]},{TYPE:"var",NAME:"CAUSTICS",TOKENS:["0"]},{TYPE:"var",NAME:"CALC_TBN_SPACE",TOKENS:["0"]},{TYPE:"var",NAME:"MAIN_BEND_COL",TOKENS:["0"]},{TYPE:"var",NAME:"DETAIL_BEND",TOKENS:["0"]},{TYPE:"var",NAME:"CALC_TBN",TOKENS:["0"]},{TYPE:"var",NAME:"USE_INSTANCED_PARTCLS",TOKENS:["0"]},{TYPE:"var",NAME:"TEXTURE_NORM_CO",TOKENS:["TEXTURE_COORDS_NONE"]},{TYPE:"var",NAME:"USE_TBN_SHADING",TOKENS:["0"]},{TYPE:"var",NAME:"PARALLAX",TOKENS:["0"]},{TYPE:"var",NAME:"WATER_EFFECTS",TOKENS:["0"]},{TYPE:"var",NAME:"SMAA_JITTER",TOKENS:["0"]},{TYPE:"var",NAME:"USE_POSITION_CLIP",TOKENS:["0"]},{TYPE:"var",NAME:"NODES",TOKENS:["0"]},{TYPE:"var",NAME:"AU_QUALIFIER",TOKENS:["GLSL_IN"]},{TYPE:"var",NAME:"STATIC_BATCH",TOKENS:["0"]},{TYPE:"var",NAME:"WIND_BEND",TOKENS:["0"]},{TYPE:"var",NAME:"BEND_CENTER_ONLY",TOKENS:["0"]},{TYPE:"var",NAME:"BILLBOARD",TOKENS:["0"]},{TYPE:"var",NAME:"BILLBOARD_JITTERED",TOKENS:["0"]},{TYPE:"var",NAME:"DYNAMIC_GRASS",TOKENS:["0"]},{TYPE:"var",NAME:"SKINNED",TOKENS:["0"]},{TYPE:"var",NAME:"FRAMES_BLENDING",TOKENS:["0"]},{TYPE:"var",NAME:"VERTEX_ANIM",TOKENS:["0"]},{TYPE:"var",NAME:"DISABLE_FOG",TOKENS:["0"]},{TYPE:"var",NAME:"SHADOW_USAGE",TOKENS:["NO_SHADOWS"]},{TYPE:"var",NAME:"REFLECTION_PASS",TOKENS:["REFL_PASS_NONE"]},{TYPE:"var",NAME:"REFLECTION_TYPE",TOKENS:["REFL_NONE"]},{TYPE:"var",NAME:"REFRACTIVE",TOKENS:["0"]},{TYPE:"var",NAME:"MAC_OS_SHADOW_HACK",TOKENS:["0"]},{TYPE:"var",NAME:"CSM_SECTION1",TOKENS:["0"]},{TYPE:"var",NAME:"CSM_SECTION2",TOKENS:["0"]},{TYPE:"var",NAME:"CSM_SECTION3",TOKENS:["0"]},{TYPE:"var",NAME:"NUM_CAST_LAMPS",TOKENS:["0"]},{TYPE:"var",NAME:"TEXCOORD",TOKENS:["0"]},{TYPE:"var",NAME:"VERTEX_COLOR",TOKENS:["0"]},{TYPE:"var",NAME:"VERTEX_ANIM_MIX_NORMALS_FACTOR",TOKENS:["u_va_frame_factor"]},{TYPE:"var",NAME:"MAX_BONES",TOKENS:["0"]},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",FILE:"math.glslv"},{TYPE:"include",FILE:"to_world.glslv"},{TYPE:"include",FILE:"scale_texcoord.glslv"},{TYPE:"txt",TOKENS:["GLSL_IN","vec3","a_position",";","GLSL_IN","vec4","a_tbn",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_INSTANCED_PARTCLS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","a_part_ts",";","GLSL_IN","vec4","a_part_r",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_TBN_SHADING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","a_shade_tangs",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SKINNED"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","a_influence",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{TYPE:"logical_or_expr",PLACES:3},"USE_INSTANCED_PARTCLS",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WIND_BEND"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["MAIN_BEND_COL"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","float","a_bending_col_main",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DETAIL_BEND"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","a_bending_col_detail",";","AU_QUALIFIER","float","au_detail_bending_amp",";","AU_QUALIFIER","float","au_branch_bending_amp",";","AU_QUALIFIER","float","au_detail_bending_freq",";"]}]}}]}]}}]},{TYPE:"txt",TOKENS:["AU_QUALIFIER","float","au_wind_bending_amp",";","AU_QUALIFIER","float","au_wind_bending_freq",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["BEND_CENTER_ONLY"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","a_emitter_center",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["VERTEX_ANIM"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","a_position_next",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES",{TYPE:"logic_negative_expr",PLACES:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","USE_NODE_NORMAL_MAP","CAUSTICS","CALC_TBN_SPACE","USE_NODE_TEX_COORD_NO","USE_NODE_BSDF_BEGIN","USE_NODE_TEX_COORD_RE",{TYPE:"logical_or_expr",PLACES:9}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","a_tbn_next",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXCOORD"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec2","a_texcoord",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["VERTEX_COLOR"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","a_color",";"]}]}}]}]}}]},{TYPE:"txt",TOKENS:["GLSL_OUT","vec3","h",";","GLSL_OUT","vec3","j",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1},"TEXTURE_NORM_CO","TEXTURE_COORDS_NONE",{TYPE:"non_equal_expr",PLACES:2},"PARALLAX",{TYPE:"logical_and_expr",PLACES:2},"SHADELESS",{TYPE:"logic_negative_expr",PLACES:1},"CAUSTICS","WATER_EFFECTS",{TYPE:"logical_and_expr",PLACES:3},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{TYPE:"equal_expr",PLACES:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:6}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec4","i",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_NORM_CO","TEXTURE_COORDS_NONE",{TYPE:"non_equal_expr",PLACES:2},"CALC_TBN_SPACE",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec4","k",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec3","bT",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXCOORD"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec2","A",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["VERTEX_COLOR","DYNAMIC_GRASS",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec3","bU",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec4","n",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION1","NUM_CAST_LAMPS",1,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec4","o",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION2","NUM_CAST_LAMPS",2,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec4","u",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION3","NUM_CAST_LAMPS",3,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec4","v",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{TYPE:"equal_expr",PLACES:2},"REFRACTIVE","USE_POSITION_CLIP",{TYPE:"logical_or_expr",PLACES:4}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec3","l",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFRACTIVE","NODES",{TYPE:"logic_negative_expr",PLACES:1},"USE_NODE_B4W_REFRACTION",{TYPE:"logical_or_expr",PLACES:2},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","float","m",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_TBN_SHADING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec3","B",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["STATIC_BATCH"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["const","mat3","u_model_tsr","=","mat3","(","0.0",",","0.0",",","0.0",",","1.0",",","0.0",",","0.0",",","0.0",",","1.0",",","0.0",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","PRECISION","mat3","u_model_tsr",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_PASS","REFL_PASS_PLANE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat4","u_view_refl_matrix",";"]}]}}]},{TYPE:"txt",TOKENS:["uniform","mat3","u_view_tsr",";","uniform","mat4","u_proj_matrix",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES",{TYPE:"logic_negative_expr",PLACES:1},"BILLBOARD","DYNAMIC_GRASS",{TYPE:"logical_or_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec3","u_camera_eye",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_JITTER"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC_GRASS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","PRECISION","sampler2D","u_grass_map_depth",";","uniform","sampler2D","u_grass_map_color",";","uniform","vec4","u_camera_quat",";","uniform","vec3","u_grass_map_dim",";","uniform","float","u_grass_size",";","uniform","float","u_scale_threshold",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SKINNED"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_quatsb","[","MAX_BONES","]",";","uniform","vec4","u_transb","[","MAX_BONES","]",";","uniform","vec4","u_arm_rel_trans",";","uniform","vec4","u_arm_rel_quat",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FRAMES_BLENDING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_quatsa","[","MAX_BONES","]",";","uniform","vec4","u_transa","[","MAX_BONES","]",";","uniform","float","u_frame_factor",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WIND_BEND"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["BILLBOARD_JITTERED"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","float","u_jitter_amp",";","uniform","float","u_jitter_freq",";"]}]}}]},{TYPE:"txt",TOKENS:["uniform","vec3","u_wind",";","uniform","PRECISION","float","u_time",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["VERTEX_ANIM"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","float","u_va_frame_factor",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec3","u_texture_scale",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","float","u_normal_offset",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["MAC_OS_SHADOW_HACK"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat3","u_v_light_tsr","[","NUM_CAST_LAMPS","]",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_v_light_ts","[","NUM_CAST_LAMPS","]",";","uniform","vec4","u_v_light_r","[","NUM_CAST_LAMPS","]",";"]}]}}]},{TYPE:"txt",TOKENS:["uniform","mat4","u_p_light_matrix0",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION1","NUM_CAST_LAMPS",1,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION2","NUM_CAST_LAMPS",2,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION3","NUM_CAST_LAMPS",3,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFRACTIVE","USE_NODE_B4W_REFRACTION",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{TYPE:"include",FILE:"dynamic_grass.glslv"},{TYPE:"include",FILE:"shadow.glslv"},{TYPE:"include",FILE:"skin.glslv"},{TYPE:"include",FILE:"wind_bending.glslv"},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"nodes.glslv"}]}}]},{TYPE:"txt",TOKENS:["void","main","(",")","{"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_PASS","REFL_PASS_PLANE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["mat4","bV","=","u_view_refl_matrix",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["mat4","bV","=","mat4","(","0.0",")",";"]}]}}]},{TYPE:"txt",TOKENS:["mat3","N","=","u_view_tsr",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_INSTANCED_PARTCLS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["mat3","Z","=","mat3","(","a_part_ts","[","0","]",",","a_part_ts","[","1","]",",","a_part_ts","[","2","]",",","a_part_ts","[","3","]",",","a_part_r","[","0","]",",","a_part_r","[","1","]",",","a_part_r","[","2","]",",","a_part_r","[","3","]",",","1.0",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["STATIC_BATCH",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["Z","=","aY","(","u_model_tsr",",","Z",")",";"]}]}}]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["mat3","Z","=","u_model_tsr",";"]}]}}]},{TYPE:"txt",TOKENS:["vec3","O","=","a_position",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CALC_TBN_SPACE","USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","USE_NODE_NORMAL_MAP","CAUSTICS","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{TYPE:"logical_and_expr",PLACES:3},"NODES",{TYPE:"logic_negative_expr",PLACES:1},"USE_TBN_SHADING","CALC_TBN",{TYPE:"logical_and_expr",PLACES:2},"USE_NODE_BSDF_BEGIN","USE_NODE_FRESNEL","USE_NODE_TEX_COORD_NO","USE_NODE_TEX_COORD_RE","USE_NODE_LAYER_WEIGHT","USE_NODE_BUMP",{TYPE:"logical_or_expr",PLACES:14}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","P",",","Q",";","vec4","S","=","R","(","a_tbn",",","P",",","Q",")",";","vec3","bW","=","T","(","S",",","vec3","(","0.0",",","1.0",",","0.0",")",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CALC_TBN_SPACE","USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","USE_NODE_NORMAL_MAP","CAUSTICS","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{TYPE:"logical_and_expr",PLACES:3},"NODES",{TYPE:"logic_negative_expr",PLACES:1},"USE_NODE_BSDF_BEGIN","USE_NODE_FRESNEL","USE_NODE_TEX_COORD_NO","USE_NODE_TEX_COORD_RE","USE_NODE_LAYER_WEIGHT","USE_NODE_BUMP",{TYPE:"logical_or_expr",PLACES:13}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","U","=","bW",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","U","=","vec3","(","0.0",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CALC_TBN_SPACE","NODES",{TYPE:"logic_negative_expr",PLACES:1},"TEXTURE_NORM_CO","TEXTURE_COORDS_UV_ORCO",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_and_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","V","=","T","(","S",",","vec3","(","1.0",",","0.0",",","0.0",")",")",";","vec3","W","=","Q","*","cross","(","U",",","V",")",";","vec4","Y","=","X","(","W",",","Q","*","P",")",";","V","=","T","(","Y",",","U",")",";"]}]}},{TYPE:"elif",EXPRESSION:["NODES",{TYPE:"logic_negative_expr",PLACES:1},"TEXTURE_NORM_CO","TEXTURE_COORDS_NORMAL",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","bX","=","ap","(","Z",",","O",")",";","vec3","ac","=","normalize","(","_","(","Z",",","bW",")",")",";","vec3","D","=","bX","-","u_camera_eye",";","vec3","W","=","cross","(","D",",","ac",")",";","vec3","V","=","cross","(","ac",",","W",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","V","=","vec3","(","0.0",")",";","vec3","W","=","vec3","(","0.0",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_TBN_SHADING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CALC_TBN"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","ac","=","normalize","(","_","(","Z",",","bW",")",")",";","vec3","ad","=","cross","(","vec3","(","0.0",",","0.0",",","1.0",")",",","ac",")",";","vec3","ae","=","cross","(","ac",",","ad",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","ae","=","a_shade_tangs",";"]}]}}]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","ae","=","vec3","(","0.0",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["VERTEX_ANIM"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["O","=","mix","(","O",",","a_position_next",",","u_va_frame_factor",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES",{TYPE:"logic_negative_expr",PLACES:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_NORMAL_MAP","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","TEXTURE_NORM_CO","TEXTURE_COORDS_NONE",{TYPE:"non_equal_expr",PLACES:2},"USE_NODE_BSDF_BEGIN","USE_NODE_TEX_COORD_RE","USE_NODE_BUMP",{TYPE:"logical_or_expr",PLACES:10}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","af",",","ah",";","vec4","ai","=","R","(","a_tbn_next",",","af",",","ah",")",";","vec3","aj","=","T","(","ai",",","vec3","(","0.0",",","1.0",",","0.0",")",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES",{TYPE:"logic_negative_expr",PLACES:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_NORMAL_MAP","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","USE_NODE_BSDF_BEGIN","USE_NODE_BUMP",{TYPE:"logical_or_expr",PLACES:8}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["U","=","mix","(","U",",","aj",",","VERTEX_ANIM_MIX_NORMALS_FACTOR",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_NORM_CO","TEXTURE_COORDS_NONE",{TYPE:"non_equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","ak","=","T","(","ai",",","vec3","(","1.0",",","0.0",",","0.0",")",")",";","vec3","al","=","ah","*","cross","(","aj",",","ak",")",";","vec4","am","=","X","(","al",",","ah","*","af",")",";","ak","=","T","(","am",",","aj",")",";","V","=","mix","(","V",",","ak",",","u_va_frame_factor",")",";","W","=","mix","(","W",",","al",",","u_va_frame_factor",")",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SKINNED"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["an","(","O",",","V",",","W",",","U",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{TYPE:"logical_or_expr",PLACES:3},"USE_INSTANCED_PARTCLS",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","ao","=","au_center_pos",";"]}]}},{TYPE:"elif",EXPRESSION:["DYNAMIC_GRASS","USE_INSTANCED_PARTCLS",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","ao","=","a_part_ts",".","xyz",";","O","=","ap","(","Z",",","O",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","ao","=","vec3","(","0.0",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC_GRASS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["au","aw","=","aZ","(","O",",","V",",","ae",",","W",",","U",",","ao",",","u_grass_map_depth",",","u_grass_map_color",",","u_grass_map_dim",",","u_grass_size",",","u_camera_eye",",","u_camera_quat",",","N",",","Z",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["BILLBOARD"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","aq","=","ap","(","Z",",","ao",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_PASS","REFL_PASS_PLANE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["O","=","(","bV","*","vec4","(","O",",","1.0",")",")",".","xyz",";","ao","=","(","bV","*","vec4","(","ao",",","1.0",")",")",".","xyz",";","aq","=","(","bV","*","vec4","(","aq",",","1.0",")",")",".","xyz",";"]}]}}]},{TYPE:"txt",TOKENS:["Z","=","as","(","u_camera_eye",",","aq",",","N",",","Z",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WIND_BEND","BILLBOARD_JITTERED",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","a_","=","aq",";","Z","=","at","(","u_wind",",","u_time",",","u_jitter_amp",",","u_jitter_freq",",","a_",",","Z",")",";"]}]}}]},{TYPE:"txt",TOKENS:["au","aw","=","av","(","O","-","ao",",","ao",",","V",",","ae",",","W",",","U",",","Z",")",";","aw",".","ao","=","aq",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["au","aw","=","av","(","O",",","ao",",","V",",","ae",",","W",",","U",",","Z",")",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_NORM_CO","TEXTURE_COORDS_NONE",{TYPE:"non_equal_expr",PLACES:2},"CALC_TBN_SPACE",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","aA","=","(","dot","(","cross","(","aw",".","U",",","aw",".","V",")",",","aw",".","W",")","<","0.0",")","?","-","1.0",":","1.0",";","k","=","vec4","(","aw",".","V",",","aA",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_TBN_SHADING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["B","=","aw",".","aB",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WIND_BEND"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["ax","(","aw",".","O",",","aw",".","ao",",","U",",","bV",")",";"]}]}}]},{TYPE:"txt",TOKENS:["h","=","aw",".","O",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES",{TYPE:"logic_negative_expr",PLACES:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","USE_NODE_NORMAL_MAP","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{TYPE:"logical_and_expr",PLACES:3},"USE_NODE_TEX_COORD_NO","USE_NODE_BSDF_BEGIN","USE_NODE_FRESNEL","USE_NODE_TEX_COORD_RE","USE_NODE_LAYER_WEIGHT","USE_NODE_BUMP",{TYPE:"logical_or_expr",PLACES:13}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["j","=","aw",".","U",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["bT","=","u_camera_eye","-","aw",".","O",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXCOORD"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["A","=","az","(","a_texcoord",",","u_texture_scale",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC_GRASS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["bU","=","aw",".","aQ",";"]}]}},{TYPE:"elif",EXPRESSION:["VERTEX_COLOR"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["bU","=","a_color",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_PASS","REFL_PASS_PLANE",{TYPE:"equal_expr",PLACES:2},"BILLBOARD",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec4","bY","=","bV","*","vec4","(","aw",".","O",",","1.0",")",";","bY",".","xyz","=","ap","(","N",",","bY",".","xyz",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec4","bY","=","vec4","(","ap","(","N",",","aw",".","O",")",",","1.0",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1},"TEXTURE_NORM_CO","TEXTURE_COORDS_NONE",{TYPE:"non_equal_expr",PLACES:2},"PARALLAX",{TYPE:"logical_and_expr",PLACES:2},"SHADELESS",{TYPE:"logic_negative_expr",PLACES:1},"CAUSTICS","WATER_EFFECTS",{TYPE:"logical_and_expr",PLACES:3},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{TYPE:"equal_expr",PLACES:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:6}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["i","=","bY",";"]}]}}]},{TYPE:"txt",TOKENS:["vec4","f","=","u_proj_matrix","*","bY",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_JITTER"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["f",".","xy","+=","u_subpixel_jitter","*","f",".","w",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{TYPE:"equal_expr",PLACES:2},"REFRACTIVE","USE_POSITION_CLIP",{TYPE:"logical_or_expr",PLACES:4}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["l","=","aC","(","f",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["bZ","(","aw",".","O",",","aw",".","U",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFRACTIVE","NODES",{TYPE:"logic_negative_expr",PLACES:1},"USE_NODE_B4W_REFRACTION",{TYPE:"logical_or_expr",PLACES:2},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["m","=","-","bY",".","z","/","u_view_max_depth",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["J","(",")",";"]}]}}]},{TYPE:"txt",TOKENS:["gl_Position","=","f",";","}"]}]},e["main_stack.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"PRECISION",TOKENS:["highp"]},{TYPE:"var",NAME:"TEXTURE_NORM_CO",TOKENS:["TEXTURE_COORDS_NONE"]},{TYPE:"var",NAME:"TEXTURE_SPEC_CO",TOKENS:["TEXTURE_COORDS_NONE"]},{TYPE:"var",NAME:"CAUSTICS",TOKENS:["0"]},{TYPE:"var",NAME:"USE_FOG",TOKENS:["0"]},{TYPE:"var",NAME:"TEXTURE_COLOR0_CO",TOKENS:["TEXTURE_COORDS_NONE"]},{TYPE:"var",NAME:"TEXTURE_COLOR1_CO",TOKENS:["TEXTURE_COORDS_NONE"]},{TYPE:"var",NAME:"PARALLAX",TOKENS:["0"]},{TYPE:"var",NAME:"CALC_TBN_SPACE",TOKENS:["0"]},{TYPE:"var",NAME:"USE_TBN_SHADING",TOKENS:["0"]},{TYPE:"var",NAME:"REFLECTION_PASS",TOKENS:["REFL_PASS_PLANE"]},{TYPE:"var",NAME:"RGBA_SHADOWS",TOKENS:["0"]},{TYPE:"var",NAME:"TEXTURE_SPEC",TOKENS:["0"]},{TYPE:"var",NAME:"ALPHA_AS_SPEC",TOKENS:["0"]},{TYPE:"var",NAME:"TEXTURE_STENCIL_ALPHA_MASK",TOKENS:["0"]},{TYPE:"var",NAME:"TEXTURE_STENCIL_ALPHA_MASK_CO",TOKENS:["TEXTURE_COORDS_NONE"]},{TYPE:"var",NAME:"NORMAL_TEXCOORD",TOKENS:["0"]},{TYPE:"var",NAME:"USE_REFRACTION_CORRECTION",TOKENS:["0"]},{TYPE:"var",NAME:"DOUBLE_SIDED_LIGHTING",TOKENS:["0"]},{TYPE:"var",NAME:"SHADELESS",TOKENS:["0"]},{TYPE:"var",NAME:"TEXCOORD",TOKENS:["0"]},{TYPE:"var",NAME:"VERTEX_COLOR",TOKENS:["0"]},{TYPE:"var",NAME:"WETTABLE",TOKENS:["0"]},{TYPE:"var",NAME:"CSM_SECTION1",TOKENS:["0"]},{TYPE:"var",NAME:"CSM_SECTION2",TOKENS:["0"]},{TYPE:"var",NAME:"CSM_SECTION3",TOKENS:["0"]},{TYPE:"var",NAME:"NUM_CAST_LAMPS",TOKENS:["0"]},{TYPE:"var",NAME:"NUM_LIGHTS",TOKENS:["0"]},{TYPE:"var",NAME:"WATER_LEVEL",TOKENS:["0.0"]},{TYPE:"var",NAME:"PROCEDURAL_FOG",TOKENS:["0"]},{TYPE:"var",NAME:"TEXTURE_BLEND_TYPE",TOKENS:["TEXTURE_BLEND_TYPE_MIX"]},{TYPE:"var",NAME:"SKY_TEXTURE",TOKENS:["0"]},{TYPE:"var",NAME:"SKY_COLOR",TOKENS:["0"]},{TYPE:"var",NAME:"ALPHA",TOKENS:["0"]},{TYPE:"var",NAME:"ALPHA_CLIP",TOKENS:["0"]},{TYPE:"var",NAME:"PARALLAX_LOD_DIST",TOKENS:["5.0"]},{TYPE:"var",NAME:"PARALLAX_STEPS",TOKENS:["5.0"]},{TYPE:"var",NAME:"USE_ENVIRONMENT_LIGHT",TOKENS:["0"]},{TYPE:"var",NAME:"REFLECTION_TYPE",TOKENS:["REFL_NONE"]},{TYPE:"var",NAME:"REFRACTIVE",TOKENS:["0"]},{TYPE:"var",NAME:"DISABLE_FOG",TOKENS:["0"]},{TYPE:"var",NAME:"WATER_EFFECTS",TOKENS:["0"]},{TYPE:"var",NAME:"SHADOW_USAGE",TOKENS:["NO_SHADOWS"]},{TYPE:"var",NAME:"DYNAMIC_GRASS",TOKENS:["0"]},{TYPE:"var",NAME:"POISSON_DISK_NUM",TOKENS:["NO_SOFT_SHADOWS"]},{TYPE:"var",NAME:"SSAO_ONLY",TOKENS:["0"]},{TYPE:"var",NAME:"USE_LOD_SMOOTHING",TOKENS:["0"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",FILE:"color_util.glslf"},{TYPE:"include",FILE:"math.glslv"},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_LOD_SMOOTHING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"coverage.glslf"}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADELESS",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CAUSTICS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"caustics.glslf"}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["RGBA_SHADOWS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"pack.glslf"}]}}]},{TYPE:"txt",TOKENS:["uniform","float","u_time",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","samplerCube","u_sky_texture",";"]}]}},{TYPE:"elif",EXPRESSION:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec3","u_horizon_color",";","uniform","vec3","u_zenith_color",";"]}]}}]},{TYPE:"txt",TOKENS:["uniform","float","u_environment_energy",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADELESS",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_LIGHTS",0,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_light_positions","[","NUM_LIGHTS","]",";","uniform","vec3","u_light_directions","[","NUM_LIGHTS","]",";","uniform","vec4","u_light_color_intensities","[","NUM_LIGHTS","]",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CAUSTICS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_sun_quaternion",";","uniform","vec3","u_sun_intensity",";","uniform","vec3","u_sun_direction",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NORMAL_TEXCOORD","REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2},"REFRACTIVE",{TYPE:"logical_or_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat3","u_view_tsr_frag",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_fog_color_density",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WATER_EFFECTS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_underwater_fog_color_density",";","uniform","float","u_cam_water_depth",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["PROCEDURAL_FOG"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat4","u_cube_fog",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_FOG"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_fog_params",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_LOD_SMOOTHING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","float","u_lod_coverage",";","uniform","float","u_lod_cmp_logic",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_COLOR0_CO","TEXTURE_COORDS_NONE",{TYPE:"non_equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_colormap0",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_SPEC","ALPHA_AS_SPEC",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_specmap0",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_NORM_CO","TEXTURE_COORDS_NONE",{TYPE:"non_equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_normalmap0",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_STENCIL_ALPHA_MASK"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_colormap1",";","uniform","sampler2D","u_stencil0",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_plane_reflection",";"]}]}},{TYPE:"elif",EXPRESSION:["REFLECTION_TYPE","REFL_CUBE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","samplerCube","u_cube_reflection",";"]}]}},{TYPE:"elif",EXPRESSION:["REFLECTION_TYPE","REFL_MIRRORMAP",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_shadow_mask",";"]}]}},{TYPE:"elif",EXPRESSION:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["POISSON_DISK_NUM","NO_SOFT_SHADOWS",{TYPE:"non_equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_pcf_blur_radii",";"]}]}}]},{TYPE:"txt",TOKENS:["uniform","vec4","u_csm_center_dists",";","uniform","PRECISION","GLSL_SMPLR2D_SHDW","u_shadow_map0",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION1","NUM_CAST_LAMPS",1,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","PRECISION","GLSL_SMPLR2D_SHDW","u_shadow_map1",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION2","NUM_CAST_LAMPS",2,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","PRECISION","GLSL_SMPLR2D_SHDW","u_shadow_map2",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION3","NUM_CAST_LAMPS",3,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","PRECISION","GLSL_SMPLR2D_SHDW","u_shadow_map3",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFRACTIVE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_refractmap",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFRACTIVE","USE_REFRACTION_CORRECTION",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","PRECISION","sampler2D","u_scene_depth",";"]}]}}]},{TYPE:"txt",TOKENS:["uniform","float","u_emit",";","uniform","float","u_ambient",";","uniform","vec2","u_fresnel_params",";","uniform","float","u_specular_alpha",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2},"REFLECTION_TYPE","REFL_CUBE",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","float","u_reflect_factor",";"]}]}},{TYPE:"elif",EXPRESSION:["REFLECTION_TYPE","REFL_MIRRORMAP",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","float","u_mirror_factor",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_refl_plane",";"]}]}}]},{TYPE:"txt",TOKENS:["uniform","vec4","u_diffuse_color",";","uniform","vec2","u_diffuse_params",";","uniform","float","u_diffuse_intensity",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_NORM_CO","TEXTURE_COORDS_NONE",{TYPE:"non_equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","float","u_normal_factor",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_COLOR0_CO","TEXTURE_COORDS_NONE",{TYPE:"non_equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","float","u_diffuse_color_factor",";","uniform","float","u_alpha_factor",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_SPEC"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","float","u_specular_color_factor",";"]}]}}]},{TYPE:"txt",TOKENS:["uniform","vec3","u_specular_color",";","uniform","vec3","u_specular_params",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_NORM_CO","TEXTURE_COORDS_NONE",{TYPE:"non_equal_expr",PLACES:2},"PARALLAX",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","float","u_parallax_scale",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFRACTIVE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","float","u_refr_bump",";"]}]}}]},{TYPE:"txt",TOKENS:["GLSL_IN","vec3","h",";","GLSL_IN","vec3","j",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1},"TEXTURE_NORM_CO","TEXTURE_COORDS_NONE",{TYPE:"non_equal_expr",PLACES:2},"PARALLAX",{TYPE:"logical_and_expr",PLACES:2},"SHADELESS",{TYPE:"logic_negative_expr",PLACES:1},"CAUSTICS",{TYPE:"logical_and_expr",PLACES:2},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{TYPE:"equal_expr",PLACES:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:5}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","i",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_NORM_CO","TEXTURE_COORDS_NONE",{TYPE:"non_equal_expr",PLACES:2},"CALC_TBN_SPACE",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","k",";"]}]}}]},{TYPE:"txt",TOKENS:["GLSL_IN","vec3","bT",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_TBN_SHADING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","B",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXCOORD"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec2","A",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["VERTEX_COLOR","DYNAMIC_GRASS",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","bU",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","n",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION1","NUM_CAST_LAMPS",1,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","o",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION2","NUM_CAST_LAMPS",2,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","u",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION3","NUM_CAST_LAMPS",3,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","v",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{TYPE:"equal_expr",PLACES:2},"REFRACTIVE",{TYPE:"logical_or_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","l",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFRACTIVE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","float","m",";"]}]}}]},{TYPE:"txt",TOKENS:["GLSL_OUT","vec4","GLSL_OUT_FRAG_COLOR",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADELESS",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"shadow.glslf"}]}}]},{TYPE:"include",FILE:"mirror.glslf"},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFRACTIVE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"refraction.glslf"}]}}]},{TYPE:"include",FILE:"environment.glslf"},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADELESS",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"lighting_nodes.glslf"}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"fog.glslf"}]}}]},{TYPE:"txt",TOKENS:["void","main","(",")","{"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_LOD_SMOOTHING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["if","(","!","C","(","u_lod_coverage",",","u_lod_cmp_logic",")",")","discard",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1},"TEXTURE_NORM_CO","TEXTURE_COORDS_NONE",{TYPE:"non_equal_expr",PLACES:2},"PARALLAX",{TYPE:"logical_and_expr",PLACES:2},"SHADELESS",{TYPE:"logic_negative_expr",PLACES:1},"CAUSTICS","WATER_EFFECTS",{TYPE:"logical_and_expr",PLACES:3},{TYPE:"logical_or_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","bN","=","length","(","i",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WATER_EFFECTS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","bO","=","h",".","z","-","WATER_LEVEL",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXCOORD"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec2","b_","=","A",";"]}]}}]},{TYPE:"txt",TOKENS:["vec3","ca","=","normalize","(","j",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DOUBLE_SIDED_LIGHTING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_PASS","REFL_PASS_PLANE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["if","(","gl_FrontFacing","==","false",")"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["if","(","gl_FrontFacing",")"]}]}}]},{TYPE:"txt",TOKENS:["ca","=","ca",";","else","ca","=","-","ca",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_NORM_CO","TEXTURE_COORDS_NONE",{TYPE:"non_equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","W","=","cross","(","ca",",","k",".","xyz",")","*","k",".","w",";","mat3","cb","=","mat3","(","k",".","xyz",",","W",",","ca",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NORMAL_TEXCOORD","REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2},"REFRACTIVE",{TYPE:"logical_or_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["mat3","N","=","u_view_tsr_frag",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NORMAL_TEXCOORD"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec2","cc","=","normalize","(","_","(","N",",","j",")",")",".","st",";","cc","=","cc","*","vec2","(","0.495",")","+","vec2","(","0.5",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_NORM_CO","TEXTURE_COORDS_NONE",{TYPE:"non_equal_expr",PLACES:2},"PARALLAX",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["if","(","bN","<","PARALLAX_LOD_DIST",")","{","float","cd","=","clamp","(","0.5","*","(","PARALLAX_LOD_DIST","-","bN",")",",","0.0",",","1.0",")",";","float","ce","=","u_parallax_scale","*","cd",";","vec3","cf","=","normalize","(","bT","*","cb",")",";","float","cg","=","1.0","/","PARALLAX_STEPS",";","vec2","ch","=","cf",".","xy","*","ce","/","(","PARALLAX_STEPS","*","cf",".","z",")",";","float","ci","=","1.0",";","float","cj",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_NORM_CO","TEXTURE_COORDS_NORMAL",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec2","ck","=","cc",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec2","ck","=","b_",";"]}]}}]},{TYPE:"txt",TOKENS:["cj","=","GLSL_TEXTURE","(","u_normalmap0",",","ck",")",".","a",";","for","(","float","cl","=","1.0",";","cl","<=","PARALLAX_STEPS",";","cl","++",")","{","if","(","cj","<","ci",")","{","ci","-=","cg",";","ck","-=","ch",";","cj","=","GLSL_TEXTURE","(","u_normalmap0",",","ck",")",".","a",";","}","}","vec2","cm","=","ck","+","ch",";","float","cn","=","GLSL_TEXTURE","(","u_normalmap0",",","cm",")",".","a","-","(","ci","+","cg",")",";","float","co","=","cj","-","ci",";","float","cp","=","co","/","(","co","-","cn",")",";","ck","=","cp","*","cm","+","(","1.0","-","cp",")","*","ck",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_NORM_CO","TEXTURE_COORDS_NORMAL",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXCOORD"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["b_","+=","ck","-","cc",";"]}]}}]},{TYPE:"txt",TOKENS:["cc","=","ck",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NORMAL_TEXCOORD"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["cc","+=","ck","-","b_",";"]}]}}]},{TYPE:"txt",TOKENS:["b_","=","ck",";"]}]}}]},{TYPE:"txt",TOKENS:["}"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_NORM_CO","TEXTURE_COORDS_NONE",{TYPE:"non_equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec4","cq",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_NORM_CO","TEXTURE_COORDS_NORMAL",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["cq","=","GLSL_TEXTURE","(","u_normalmap0",",","cc",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["cq","=","GLSL_TEXTURE","(","u_normalmap0",",","b_",")",";"]}]}}]},{TYPE:"txt",TOKENS:["vec3","cr","=","cq",".","rgb","-","0.5",";","cr","=","mix","(","vec3","(","0.0",",","0.0",",","1.0",")",",","cr",",","u_normal_factor",")",";","vec3","U","=","cb","*","cr",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","U","=","ca",";"]}]}}]},{TYPE:"txt",TOKENS:["U","=","normalize","(","U",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NORMAL_TEXCOORD"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["cc","=","normalize","(","_","(","N",",","U",")",")",".","st",";","cc","=","cc","*","vec2","(","0.495",")","+","vec2","(","0.5",")",";"]}]}}]},{TYPE:"txt",TOKENS:["vec3","D","=","normalize","(","bT",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["VERTEX_COLOR","DYNAMIC_GRASS",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","cs","=","bU",";","bC","(","cs",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["VERTEX_COLOR","DYNAMIC_GRASS",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec4","ct","=","vec4","(","cs",",","1.0",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec4","ct","=","u_diffuse_color",";"]}]}}]},{TYPE:"txt",TOKENS:["float","cu","=","1.0",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_COLOR0_CO","TEXTURE_COORDS_NORMAL",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec4","cv","=","GLSL_TEXTURE","(","u_colormap0",",","cc",")",";"]}]}},{TYPE:"elif",EXPRESSION:["TEXTURE_COLOR0_CO","TEXTURE_COORDS_UV_ORCO",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec4","cv","=","GLSL_TEXTURE","(","u_colormap0",",","b_",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_COLOR0_CO","TEXTURE_COORDS_NONE",{TYPE:"non_equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["bC","(","cv",".","rgb",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_STENCIL_ALPHA_MASK"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec4","cw",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_COLOR1_CO","TEXTURE_COORDS_NORMAL",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["cw","=","GLSL_TEXTURE","(","u_colormap1",",","cc",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["cw","=","GLSL_TEXTURE","(","u_colormap1",",","b_",")",";"]}]}}]},{TYPE:"txt",TOKENS:["bC","(","cw",".","rgb",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_STENCIL_ALPHA_MASK_CO","TEXTURE_COORDS_NORMAL",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec4","cx","=","GLSL_TEXTURE","(","u_stencil0",",","cc",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec4","cx","=","GLSL_TEXTURE","(","u_stencil0",",","b_",")",";"]}]}}]},{TYPE:"txt",TOKENS:["cv","=","mix","(","cv",",","cw",",","cx",".","r",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["ct",".","rgb","=","mix","(","ct",".","rgb",",","cv",".","rgb",",","u_diffuse_color_factor",")",";","float","M","=","u_alpha_factor","*","cv",".","a",";","M","+=","(","1.0","-","step","(","0.0",",","M",")",")",";","ct",".","a","=","mix","(","M",",","1.0",",","u_diffuse_color",".","a",")",";","cu","=","cv",".","a",";"]}]}},{TYPE:"elif",EXPRESSION:["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["ct",".","rgb","*=","mix","(","vec3","(","1.0",")",",","cv",".","rgb",",","u_diffuse_color_factor",")",";","ct",".","a","=","cv",".","a",";","cu","=","cv",".","a",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADELESS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","aQ","=","ct",".","rgb",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","cy","=","u_diffuse_intensity","*","ct",".","rgb",";","vec3","cA","=","u_environment_energy","*","cz","(","U",")",";","vec3","cB","=","u_ambient","*","cA",";","vec4","bP","=","cC","(","cy",")",";","vec3","cD","=","u_emit","*","ct",".","rgb",";","vec3","cE","=","u_specular_color",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_SPEC"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["ALPHA_AS_SPEC"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","cF","=","vec3","(","cu",")",";"]}]}},{TYPE:"elif",EXPRESSION:["TEXTURE_SPEC_CO","TEXTURE_COORDS_NORMAL",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","cF","=","GLSL_TEXTURE","(","u_specmap0",",","cc",")",".","rgb",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","cF","=","GLSL_TEXTURE","(","u_specmap0",",","b_",")",".","rgb",";"]}]}}]},{TYPE:"txt",TOKENS:["bC","(","cF",".","rgb",")",";","cE","=","mix","(","cE",",","cF",",","u_specular_color_factor",")",";"]}]}}]},{TYPE:"txt",TOKENS:["float","cG","=","u_specular_params","[","0","]",";","vec2","cH","=","vec2","(","u_specular_params","[","1","]",",","u_specular_params","[","2","]",")",";","vec3","cI","=","cG","*","cE",";","vec3","aQ",";","vec3","cJ",";","cK","(","cD",",","cB",",","cy",",","cI",",","h",",","U",",","D",",","cH",",","u_diffuse_params",",","bP",",","0.0",",","vec4","(","0.0",")",",","aQ",",","cJ",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["cL","(","aQ",",","D",",","U",",","u_reflect_factor",",","N",")",";"]}]}},{TYPE:"elif",EXPRESSION:["REFLECTION_TYPE","REFL_CUBE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["cL","(","aQ",",","D",",","U",",","u_reflect_factor",",","mat3","(","0.0",")",")",";"]}]}},{TYPE:"elif",EXPRESSION:["REFLECTION_TYPE","REFL_MIRRORMAP",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["cL","(","aQ",",","D",",","U",",","u_mirror_factor",",","mat3","(","0.0",")",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADELESS",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["aQ","+=","cJ",";"]}]}}]},{TYPE:"txt",TOKENS:["float","L","=","ct",".","a",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADELESS",{TYPE:"logic_negative_expr",PLACES:1},"WATER_EFFECTS",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WETTABLE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["aQ","=","max","(","aQ","-","sqrt","(","0.01","*","-","min","(","bO",",","0.0",")",")",",","0.5","*","aQ",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CAUSTICS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["bQ","(","aQ",",","bO",",","u_time",",","bP",",","U",",","u_sun_direction",",","u_sun_intensity",",","u_sun_quaternion",",","h",",","bN",")",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["ALPHA"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["ALPHA_CLIP"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["if","(","L","<","0.5",")","discard",";","L","=","1.0",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADELESS",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","t","=","max","(","max","(","cJ",".","r",",","cJ",".","g",")",",","cJ",".","b",")","*","u_specular_alpha",";","L","=","ct",".","a","*","(","1.0","-","t",")","+","t",";"]}]}}]}]}}]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["L","=","1.0",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFRACTIVE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec2","cM","=","-","(","_","(","N",",","U",")",")",".","xy",";","aQ","=","mix","(","cN","(","l",",","cM","*","u_refr_bump",")",",","aQ",",","L",")",";","L","=","1.0",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WATER_EFFECTS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["bR","(","aQ",",","bN",",","D",",","bO",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["bR","(","aQ",",","bN",",","D",",","1.0",")",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SSAO_ONLY","SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","bS","=","GLSL_TEXTURE_PROJ","(","u_shadow_mask",",","l",")",".","a",";","aQ","=","vec3","(","bS",")",";"]}]}}]},{TYPE:"txt",TOKENS:["aW","(","aQ",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["ALPHA","ALPHA_CLIP",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["aX","(","aQ",",","L",")",";"]}]}}]},{TYPE:"txt",TOKENS:["GLSL_OUT_FRAG_COLOR","=","vec4","(","aQ",",","L",")",";","}"]}]},e["node_skybox.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"USE_VIEW_TSR",TOKENS:["0"]},{TYPE:"var",NAME:"USE_VIEW_TSR_INVERSE",TOKENS:["0"]},{TYPE:"var",NAME:"USE_MODEL_TSR",TOKENS:["0"]},{TYPE:"var",NAME:"USE_MODEL_TSR_INVERSE",TOKENS:["0"]},{TYPE:"var",NAME:"NUM_VALUES",TOKENS:["0"]},{TYPE:"var",NAME:"NUM_RGBS",TOKENS:["0"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",FILE:"color_util.glslf"},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_VALUE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_node_values","[","NUM_VALUES","]",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_RGB"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec3","u_node_rgbs","[","NUM_RGBS","]",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_VIEW_TSR"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat3","u_view_tsr_frag",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_VIEW_TSR_INVERSE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat3","u_view_tsr_inverse",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_MODEL_TSR"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat3","u_model_tsr",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_MODEL_TSR_INVERSE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat3","u_model_tsr_inverse",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_CURVE_VEC","USE_NODE_CURVE_RGB","USE_NODE_VALTORGB",{TYPE:"logical_or_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_nodes_texture",";"]}]}}]},{TYPE:"txt",TOKENS:["GLSL_IN","vec3","bp",";","GLSL_OUT","vec4","GLSL_OUT_FRAG_COLOR",";"]},{TYPE:"include",FILE:"nodes.glslf"},{TYPE:"txt",TOKENS:["void","main","(",")","{"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_TEXTURE_ENVIRONMENT_EQUIRECTANGULAR","USE_NODE_TEXTURE_ENVIRONMENT_MIRROR_BALL","USE_NODE_GEOMETRY_NO","USE_NODE_GEOMETRY_GL","USE_NODE_GEOMETRY_IN","USE_NODE_TEX_COORD_GE","USE_NODE_TEX_COORD_OB","USE_NODE_TEX_COORD_NO","USE_NODE_B4W_REFLECT_WORLD",{TYPE:"logical_or_expr",PLACES:9}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","D","=","-","normalize","(","bp",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","D",";"]}]}}]},{TYPE:"txt",TOKENS:["vec3","E",";","vec3","F",";","vec3","G",";","vec4","H",";","float","I",";","J","(","D",",","E",",","F",",","G",",","H",",","I",")",";","E","=","max","(","vec3","(","0.0",")",",","E",")",";","aW","(","E",")",";","GLSL_OUT_FRAG_COLOR","=","vec4","(","E",",","_1_0",")",";","}"]}]},e["particle_system.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"NUM_VALUES",TOKENS:["0"]},{TYPE:"var",NAME:"NUM_RGBS",TOKENS:["0"]},{TYPE:"var",NAME:"PRECISION",TOKENS:["highp"]},{TYPE:"var",NAME:"NUM_LAMP_LIGHTS",TOKENS:["0"]},{TYPE:"var",NAME:"NUM_LIGHTS",TOKENS:["0"]},{TYPE:"var",NAME:"PROCEDURAL_FOG",TOKENS:["0"]},{TYPE:"var",NAME:"SKY_TEXTURE",TOKENS:["0"]},{TYPE:"var",NAME:"NORMAL_TEXCOORD",TOKENS:["0"]},{TYPE:"var",NAME:"USE_VIEW_TSR",TOKENS:["0"]},{TYPE:"var",NAME:"USE_VIEW_TSR_INVERSE",TOKENS:["0"]},{TYPE:"var",NAME:"USE_MODEL_TSR",TOKENS:["0"]},{TYPE:"var",NAME:"USE_MODEL_TSR_INVERSE",TOKENS:["0"]},{TYPE:"var",NAME:"ALPHA",TOKENS:["0"]},{TYPE:"var",NAME:"ALPHA_CLIP",TOKENS:["0"]},{TYPE:"var",NAME:"SOFT_STRENGTH",TOKENS:["0.25"]},{TYPE:"var",NAME:"SOFT_PARTICLES",TOKENS:["0"]},{TYPE:"var",NAME:"NODES",TOKENS:["0"]},{TYPE:"var",NAME:"DISABLE_FOG",TOKENS:["0"]},{TYPE:"var",NAME:"WATER_EFFECTS",TOKENS:["0"]},{TYPE:"var",NAME:"USE_FOG",TOKENS:["0"]},{TYPE:"var",NAME:"USE_ENVIRONMENT_LIGHT",TOKENS:["0"]},{TYPE:"var",NAME:"SKY_COLOR",TOKENS:["0"]},{TYPE:"var",NAME:"REFLECTION_TYPE",TOKENS:["REFL_NONE"]},{TYPE:"var",NAME:"TEXTURE_NORM_CO",TOKENS:["TEXTURE_COORDS_NONE"]},{TYPE:"var",NAME:"CALC_TBN_SPACE",TOKENS:["0"]},{TYPE:"var",NAME:"USE_TBN_SHADING",TOKENS:["0"]},{TYPE:"var",NAME:"TEXTURE_COLOR",TOKENS:["0"]},{TYPE:"var",NAME:"CAMERA_TYPE",TOKENS:["CAM_TYPE_PERSP"]},{TYPE:"var",NAME:"USE_POSITION_CLIP",TOKENS:["0"]},{TYPE:"var",NAME:"USE_DERIVATIVES_EXT",TOKENS:["0"]},{TYPE:"var",NAME:"USE_TEXTURE_LOD_EXT",TOKENS:["0"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["GLSL1","USE_DERIVATIVES_EXT",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"extension",TOKENS:["GL_OES_standard_derivatives",":","enable"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["GLSL1","USE_TEXTURE_LOD_EXT",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"extension",TOKENS:["GL_EXT_shader_texture_lod",":","enable"]}]}}]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",FILE:"color_util.glslf"},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SOFT_PARTICLES","NODES",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"pack.glslf"}]}}]},{TYPE:"txt",TOKENS:["uniform","float","u_environment_energy",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_LIGHTS",0,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_light_positions","[","NUM_LIGHTS","]",";","uniform","vec3","u_light_directions","[","NUM_LIGHTS","]",";","uniform","vec4","u_light_color_intensities","[","NUM_LIGHTS","]",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_fog_color_density",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WATER_EFFECTS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_underwater_fog_color_density",";","uniform","float","u_cam_water_depth",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["PROCEDURAL_FOG"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat4","u_cube_fog",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_FOG"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_fog_params",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","samplerCube","u_sky_texture",";"]}]}},{TYPE:"elif",EXPRESSION:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec3","u_horizon_color",";","uniform","vec3","u_zenith_color",";"]}]}}]},{TYPE:"txt",TOKENS:["uniform","float","u_emit",";","uniform","float","u_ambient",";","uniform","float","u_time",";","uniform","vec3","u_camera_eye_frag",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_FRESNEL","USE_NODE_LAYER_WEIGHT",{TYPE:"logical_or_expr",PLACES:2},"CAMERA_TYPE","CAM_TYPE_ORTHO",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec3","u_camera_direction",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_LAMP"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec3","u_lamp_light_positions","[","NUM_LAMP_LIGHTS","]",";","uniform","vec3","u_lamp_light_directions","[","NUM_LAMP_LIGHTS","]",";","uniform","vec3","u_lamp_light_color_intensities","[","NUM_LAMP_LIGHTS","]",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_VALUE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_node_values","[","NUM_VALUES","]",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_RGB"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec3","u_node_rgbs","[","NUM_RGBS","]",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NORMAL_TEXCOORD","REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2},"USE_VIEW_TSR",{TYPE:"logical_or_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat3","u_view_tsr_frag",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_VIEW_TSR_INVERSE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat3","u_view_tsr_inverse",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_MODEL_TSR"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat3","u_model_tsr",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_MODEL_TSR_INVERSE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat3","u_model_tsr_inverse",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SOFT_PARTICLES"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","PRECISION","sampler2D","u_scene_depth",";","uniform","float","u_view_max_depth",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_CURVE_VEC","USE_NODE_CURVE_RGB","USE_NODE_VALTORGB",{TYPE:"logical_or_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_nodes_texture",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_OBJECT_INFO"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec3","u_obj_info",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_NORM_CO","TEXTURE_COORDS_NONE",{TYPE:"non_equal_expr",PLACES:2},"CALC_TBN_SPACE","USE_TBN_SHADING",{TYPE:"logical_or_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","k",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SOFT_PARTICLES","USE_POSITION_CLIP",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","l",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_COLOR","USE_NODE_TEX_COORD_UV","USE_NODE_UV_MERGED","USE_NODE_UVMAP","USE_NODE_GEOMETRY_UV","USE_NODE_GEOMETRY_OR","USE_NODE_TEX_COORD_GE",{TYPE:"logical_or_expr",PLACES:7}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec2","A",";"]}]}}]},{TYPE:"txt",TOKENS:["GLSL_IN","vec3","h",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SOFT_PARTICLES","DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1},"NODES",{TYPE:"logical_or_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","i",";"]}]}}]},{TYPE:"txt",TOKENS:["GLSL_IN","vec3","j",";","GLSL_OUT","vec4","GLSL_OUT_FRAG_COLOR",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"fog.glslf"}]}}]},{TYPE:"include",FILE:"math.glslv"},{TYPE:"include",FILE:"particles_nodes.glslf"},{TYPE:"txt",TOKENS:["void","main","(",")","{","vec3","D","=","normalize","(","u_camera_eye_frag","-","h",")",";","vec3","E",";","vec3","F",";","vec3","G",";","vec4","H",";","float","I",";","J","(","D",",","E",",","F",",","G",",","H",",","I",")",";","vec3","aQ","=","E",";","float","L","=","I",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["ALPHA"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["ALPHA_CLIP"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["if","(","L","<","0.5",")","discard",";","L","=","1.0",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["L","=","min","(","1.0",",","L",")",";"]}]}}]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["L","=","1.0",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["bR","(","aQ",",","length","(","i",")",",","D",",","1.0",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SOFT_PARTICLES"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","cO","=","-","i",".","z","/","u_view_max_depth",";","vec4","cP","=","GLSL_TEXTURE_PROJ","(","u_scene_depth",",","l",")",";","float","cR","=","cQ","(","cP",")",";","float","cS","=","cR","-","cO",";","float","cT","=","u_view_max_depth","/","SOFT_STRENGTH","*","cS",";","L","=","L","*","min","(","cT",",","1.0",")",";"]}]}}]},{TYPE:"txt",TOKENS:["aW","(","aQ",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["ALPHA","ALPHA_CLIP",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["aX","(","aQ",",","L",")",";"]}]}}]},{TYPE:"txt",TOKENS:["GLSL_OUT_FRAG_COLOR","=","vec4","(","aQ",",","L",")",";","}"]}]},e["particle_system.glslv"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"PRECISION",TOKENS:["highp"]},{TYPE:"var",NAME:"BILLBOARD_ALIGN",TOKENS:["BILLBOARD_ALIGN_VIEW"]},{TYPE:"var",NAME:"TEXTURE_NORM_CO",TOKENS:["TEXTURE_COORDS_NONE"]},{TYPE:"var",NAME:"CALC_TBN_SPACE",TOKENS:["0"]},{TYPE:"var",NAME:"USE_TBN_SHADING",TOKENS:["0"]},{TYPE:"var",NAME:"NODES",TOKENS:["0"]},{TYPE:"var",NAME:"HALO_PARTICLES",TOKENS:["0"]},{TYPE:"var",NAME:"TEXTURE_COLOR",TOKENS:["0"]},{TYPE:"var",NAME:"PARTICLES_SHADELESS",TOKENS:["0"]},{TYPE:"var",NAME:"DISABLE_FOG",TOKENS:["0"]},{TYPE:"var",NAME:"SOFT_PARTICLES",TOKENS:["0"]},{TYPE:"var",NAME:"COLOR_RAMP_LENGTH",TOKENS:["0"]},{TYPE:"var",NAME:"REFLECTION_PASS",TOKENS:["REFL_PASS_NONE"]},{TYPE:"var",NAME:"WORLD_SPACE",TOKENS:["0"]},{TYPE:"var",NAME:"USE_COLOR_RAMP",TOKENS:["0"]},{TYPE:"var",NAME:"USE_POSITION_CLIP",TOKENS:["0"]},{TYPE:"var",NAME:"CAUSTICS",TOKENS:["0"]},{TYPE:"var",NAME:"WIND_BEND",TOKENS:["0"]},{TYPE:"var",NAME:"MAIN_BEND_COL",TOKENS:["0"]},{TYPE:"var",NAME:"DETAIL_BEND",TOKENS:["0"]},{TYPE:"include",FILE:"std.glsl"},{TYPE:"txt",TOKENS:["GLSL_IN","vec3","a_position",";","GLSL_IN","vec4","a_tbn",";","GLSL_IN","vec3","a_p_data",";","GLSL_IN","vec4","a_p_vels",";","GLSL_IN","vec2","a_p_bb_vertex",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["HALO_PARTICLES",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","float","cU",";"]}]}}]},{TYPE:"txt",TOKENS:["GLSL_OUT","vec3","bU",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_NORM_CO","TEXTURE_COORDS_NONE",{TYPE:"non_equal_expr",PLACES:2},"CALC_TBN_SPACE","USE_TBN_SHADING",{TYPE:"logical_or_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec4","k",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_COLOR","HALO_PARTICLES","USE_NODE_TEX_COORD_UV","USE_NODE_UV_MERGED","USE_NODE_UVMAP","USE_NODE_GEOMETRY_UV","USE_NODE_GEOMETRY_OR","USE_NODE_TEX_COORD_GE",{TYPE:"logical_or_expr",PLACES:8}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec2","A",";"]}]}}]},{TYPE:"txt",TOKENS:["GLSL_OUT","vec3","h",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["PARTICLES_SHADELESS",{TYPE:"logic_negative_expr",PLACES:1},"DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec3","bT",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SOFT_PARTICLES","DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1},"NODES",{TYPE:"logical_or_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec4","i",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SOFT_PARTICLES","USE_POSITION_CLIP",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec3","l",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["HALO_PARTICLES"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","float","bf",";"]}]}}]},{TYPE:"txt",TOKENS:["GLSL_OUT","vec3","j",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["COLOR_RAMP_LENGTH",0,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_p_color_ramp","[","COLOR_RAMP_LENGTH","]",";"]}]}}]},{TYPE:"txt",TOKENS:["uniform","float","u_p_time",";","uniform","float","u_p_length",";","uniform","int","u_p_cyclic",";","uniform","float","u_p_fade_in",";","uniform","float","u_p_fade_out",";","uniform","float","u_p_nfactor",";","uniform","float","u_p_gravity",";","uniform","float","u_p_mass",";","uniform","float","u_p_wind_fac",";","uniform","float","u_p_max_lifetime",";","uniform","float","u_p_tilt",";","uniform","float","u_p_tilt_rand",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_PASS","REFL_PASS_PLANE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat4","u_view_refl_matrix",";"]}]}}]},{TYPE:"txt",TOKENS:["uniform","mat3","u_view_tsr",";","uniform","mat4","u_proj_matrix",";","uniform","vec3","u_wind",";","uniform","float","u_p_size",";","uniform","vec3","u_camera_eye",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WORLD_SPACE",{TYPE:"logic_negative_expr",PLACES:1},"NODES","HALO_PARTICLES",{TYPE:"logical_or_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","PRECISION","mat3","u_model_tsr",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_COLOR_RAMP"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_color_ramp_tex",";"]}]}}]},{TYPE:"include",FILE:"math.glslv"},{TYPE:"include",FILE:"to_world.glslv"},{TYPE:"include",FILE:"particles.glslv"},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"particles_nodes.glslv"}]}}]},{TYPE:"txt",TOKENS:["float","cX","(","vec2","cV",",","vec2","cW",")","{","return","(","atan","(","cW",".","y",",","cW",".","x",")","-","atan","(","cV",".","y",",","cV",".","x",")",")",";","}","void","main","(",")","{"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_PASS","REFL_PASS_PLANE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["mat4","bV","=","u_view_refl_matrix",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["mat4","bV","=","mat4","(","0.0",")",";"]}]}}]},{TYPE:"txt",TOKENS:["mat3","N","=","u_view_tsr",";","cY","pp",";","pp","=","cZ","(",")",";","float","c_",";","mat3","bk","=","da","(",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_PASS","REFL_PASS_PLANE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","db","=","(","bV","*","vec4","(","pp",".","O",",","1.0",")",")",".","xyz",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","db","=","pp",".","O",";"]}]}}]},{TYPE:"txt",TOKENS:["vec3","U","=","vec3","(","0.0",",","-","1.0",",","0.0",")",";","if","(","BILLBOARD_ALIGN","==","BILLBOARD_ALIGN_VIEW",")","{","c_","=","pp",".","bK",";","bk","=","bj","(","db",",","N",")",";","}","else","if","(","BILLBOARD_ALIGN","==","BILLBOARD_ALIGN_XY",")","{","c_","=","cX","(","vec2","(","EPSILON",",","1.0",")",",","vec2","(","U",".","x",",","-","U",".","y",")",")","+","pp",".","bK",";","bk","[","0","]","=","db",";","vec4","dc","=","X","(","RIGHT_VECTOR",",","-","M_PI","/","2.0",")",";","bk","=","dd","(","dc",",","bk",")",";","}","else","if","(","BILLBOARD_ALIGN","==","BILLBOARD_ALIGN_YZ",")","{","c_","=","pp",".","bK",";","bk","[","0","]","=","db",";","vec4","de","=","X","(","UP_VECTOR",",","M_PI","/","2.0",")",";","bk","=","dd","(","de",",","bk",")",";","}","else","if","(","BILLBOARD_ALIGN","==","BILLBOARD_ALIGN_ZX",")","{","c_","=","pp",".","bK",";","bk","[","0","]","=","db",";","}","vec3","bn","=","vec3","(","(","a_p_bb_vertex","[","0","]","*","2.0","-","1.0",")","*","pp",".","df","*","u_p_size",",","0.0",",","(","a_p_bb_vertex","[","1","]","*","2.0","-","1.0",")","*","pp",".","df","*","u_p_size",")",";","float","dg","=","a_p_data","[","2","]",";","float","dh","=","u_p_tilt","*","u_p_tilt_rand","*","(","2.0","*","dg","-","1.0",")",";","float","di","=","(","dh","+","u_p_tilt",")","*","M_PI",";","vec4","dj","=","X","(","TOWARD_VECTOR",",","di","+","c_",")",";","vec3","bo","=","ap","(","bk",",","T","(","dj",",","bn",")",")",";","vec4","bY","=","vec4","(","ap","(","N",",","bo",")",",","1.0",")",";","vec4","f","=","u_proj_matrix","*","bY",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["HALO_PARTICLES"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["bf","=","dg",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","PARTICLES_SHADELESS",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["mat3","dk","=","da","(",")",";","dj","=","X","(","TOWARD_VECTOR",",","c_",")",";","dk","=","dd","(","dj",",","dk",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CALC_TBN_SPACE","NODES",{TYPE:"logic_negative_expr",PLACES:1},"TEXTURE_NORM_CO","TEXTURE_COORDS_UV_ORCO",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_and_expr",PLACES:2},"USE_TBN_SHADING",{TYPE:"logical_or_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","V","=","vec3","(","1.0",",","0.0",",","0.0",")",";","vec3","W","=","vec3","(","0.0",",","0.0",",","1.0",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","V","=","vec3","(","0.0",")",";","vec3","W","=","vec3","(","0.0",")",";"]}]}}]},{TYPE:"txt",TOKENS:["au","aw","=","av","(","vec3","(","0.0",")",",","vec3","(","0.0",")",",","V",",","vec3","(","0.0",")",",","W",",","U",",","aY","(","bk",",","dk",")",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_NORM_CO","TEXTURE_COORDS_NONE",{TYPE:"non_equal_expr",PLACES:2},"CALC_TBN_SPACE","USE_TBN_SHADING",{TYPE:"logical_or_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","aA","=","(","dot","(","cross","(","aw",".","U",",","aw",".","V",")",",","aw",".","W",")","<","0.0",")","?","-","1.0",":","1.0",";","k","=","vec4","(","aw",".","V",",","aA",")",";"]}]}}]},{TYPE:"txt",TOKENS:["J","(","pp",".","O",",","pp",".","dl",",","pp",".","dm",",","pp",".","dn",",","pp",".","df",",","a_p_bb_vertex",",","a_p_data","[","0","]",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["PARTICLES_SHADELESS",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["au","aw","=","av","(","vec3","(","0.0",")",",","vec3","(","0.0",")",",","vec3","(","0.0",")",",","vec3","(","0.0",")",",","vec3","(","0.0",")",",","U",",","aY","(","bk",",","dk",")",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_COLOR"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["A","=","a_p_bb_vertex",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["HALO_PARTICLES"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["A","=","a_p_bb_vertex","*","2.0","-","1.0",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["cU","=","pp",".","L",";"]}]}}]},{TYPE:"txt",TOKENS:["bU","=","pp",".","aQ",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES",{TYPE:"logic_negative_expr",PLACES:1},"PARTICLES_SHADELESS",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_and_expr",PLACES:2},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{TYPE:"logical_and_expr",PLACES:3},"USE_NODE_TEX_COORD_NO","USE_NODE_BSDF_BEGIN","USE_NODE_FRESNEL","USE_NODE_TEX_COORD_RE","USE_NODE_LAYER_WEIGHT",{TYPE:"logical_or_expr",PLACES:11}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["j","=","aw",".","U",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SOFT_PARTICLES","USE_POSITION_CLIP",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["l","=","aC","(","f",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SOFT_PARTICLES","DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1},"NODES",{TYPE:"logical_or_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["i","=","bY",";"]}]}}]},{TYPE:"txt",TOKENS:["gl_Position","=","f",";","h","=","bo",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["PARTICLES_SHADELESS",{TYPE:"logic_negative_expr",PLACES:1},"DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["bT","=","u_camera_eye","-","bo",";"]}]}}]},{TYPE:"txt",TOKENS:["}"]}]},e["particle_system_stack.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"PRECISION",TOKENS:["highp"]},{TYPE:"var",NAME:"NUM_LIGHTS",TOKENS:["0"]},{TYPE:"var",NAME:"SKY_TEXTURE",TOKENS:["0"]},{TYPE:"var",NAME:"SKY_COLOR",TOKENS:["0"]},{TYPE:"var",NAME:"PROCEDURAL_FOG",TOKENS:["0"]},{TYPE:"var",NAME:"TEXTURE_BLEND_TYPE",TOKENS:["TEXTURE_BLEND_TYPE_MIX"]},{TYPE:"var",NAME:"ALPHA",TOKENS:["0"]},{TYPE:"var",NAME:"ALPHA_CLIP",TOKENS:["0"]},{TYPE:"var",NAME:"SOFT_STRENGTH",TOKENS:["0.25"]},{TYPE:"var",NAME:"SOFT_PARTICLES",TOKENS:["0"]},{TYPE:"var",NAME:"NODES",TOKENS:["0"]},{TYPE:"var",NAME:"HALO_PARTICLES",TOKENS:["0"]},{TYPE:"var",NAME:"TEXTURE_COLOR",TOKENS:["0"]},{TYPE:"var",NAME:"USE_ENVIRONMENT_LIGHT",TOKENS:["0"]},{TYPE:"var",NAME:"SKY_STARS",TOKENS:["0"]},{TYPE:"var",NAME:"DISABLE_FOG",TOKENS:["0"]},{TYPE:"var",NAME:"WATER_EFFECTS",TOKENS:["0"]},{TYPE:"var",NAME:"USE_FOG",TOKENS:["0"]},{TYPE:"var",NAME:"PARTICLES_SHADELESS",TOKENS:["0"]},{TYPE:"var",NAME:"USE_TBN_SHADING",TOKENS:["0"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",FILE:"color_util.glslf"},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SOFT_PARTICLES","NODES",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"pack.glslf"}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["HALO_PARTICLES",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_COLOR"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_sampler",";"]}]}}]},{TYPE:"txt",TOKENS:["uniform","float","u_environment_energy",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_LIGHTS",0,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_light_positions","[","NUM_LIGHTS","]",";","uniform","vec3","u_light_directions","[","NUM_LIGHTS","]",";","uniform","vec4","u_light_color_intensities","[","NUM_LIGHTS","]",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_COLOR"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","float","u_diffuse_color_factor",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","samplerCube","u_sky_texture",";"]}]}},{TYPE:"elif",EXPRESSION:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec3","u_horizon_color",";","uniform","vec3","u_zenith_color",";"]}]}}]},{TYPE:"txt",TOKENS:["uniform","vec2","u_diffuse_params",";","uniform","float","u_diffuse_intensity",";","uniform","float","u_emit",";","uniform","float","u_ambient",";","uniform","vec3","u_specular_color",";","uniform","vec3","u_specular_params",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","float","u_halo_size",";","uniform","vec3","u_halo_rings_color",";","uniform","float","u_halo_hardness",";","uniform","vec3","u_halo_lines_color",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SKY_STARS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec3","u_sun_intensity",";","uniform","float","u_halo_stars_blend",";","uniform","float","u_halo_stars_height",";"]}]}}]},{TYPE:"txt",TOKENS:["uniform","float","u_p_alpha_start",";","uniform","float","u_p_alpha_end",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_fog_color_density",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WATER_EFFECTS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_underwater_fog_color_density",";","uniform","float","u_cam_water_depth",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["PROCEDURAL_FOG"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat4","u_cube_fog",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_FOG"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_fog_params",";"]}]}}]}]}}]},{TYPE:"txt",TOKENS:["uniform","vec4","u_diffuse_color",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SOFT_PARTICLES"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","PRECISION","sampler2D","u_scene_depth",";","uniform","float","u_view_max_depth",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SOFT_PARTICLES"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","l",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_COLOR","HALO_PARTICLES","USE_NODE_TEX_COORD_UV","USE_NODE_UV_MERGED","USE_NODE_UVMAP","USE_NODE_GEOMETRY_UV","USE_NODE_GEOMETRY_OR","USE_NODE_TEX_COORD_GE",{TYPE:"logical_or_expr",PLACES:8}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec2","A",";"]}]}}]},{TYPE:"txt",TOKENS:["GLSL_IN","vec3","h",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["HALO_PARTICLES",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","float","cU",";"]}]}}]},{TYPE:"txt",TOKENS:["GLSL_IN","vec3","bU",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["PARTICLES_SHADELESS",{TYPE:"logic_negative_expr",PLACES:1},"DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","bT",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SOFT_PARTICLES","DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1},"NODES",{TYPE:"logical_or_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","i",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["HALO_PARTICLES"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","float","bf",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SKY_STARS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","be",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_TBN_SHADING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","B",";"]}]}}]},{TYPE:"txt",TOKENS:["GLSL_IN","vec3","j",";","GLSL_OUT","vec4","GLSL_OUT_FRAG_COLOR",";"]},{TYPE:"include",FILE:"lighting_nodes.glslf"},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"fog.glslf"}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["HALO_PARTICLES",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"environment.glslf"}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["HALO_PARTICLES"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"halo_color.glslf"}]}}]},{TYPE:"txt",TOKENS:["void","main","(",")","{"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["PARTICLES_SHADELESS",{TYPE:"logic_negative_expr",PLACES:1},"DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","D","=","normalize","(","bT",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["HALO_PARTICLES"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec4","bi","=","bh","(",")",";","vec3","aQ","=","bi",".","rgb","*","bU",";","float","dp","=","0.9","*","length","(","A",")",";","float","dq","=","smoothstep","(","u_p_alpha_start",",","u_p_alpha_end",",","dp",")",";","float","L","=","bi",".","a","*","(","1.0","-","dq",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec4","ct","=","u_diffuse_color",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_COLOR"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec4","cv","=","GLSL_TEXTURE","(","u_sampler",",","A",")",";","bC","(","cv",".","rgb",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["ct",".","rgb","=","mix","(","ct",".","rgb",",","cv",".","rgb",",","u_diffuse_color_factor",")",";"]}]}},{TYPE:"elif",EXPRESSION:["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["ct",".","rgb","*=","mix","(","vec3","(","1.0",")",",","cv",".","rgb",",","u_diffuse_color_factor",")",";"]}]}}]},{TYPE:"txt",TOKENS:["ct",".","a","=","cv",".","a",";"]}]}}]},{TYPE:"txt",TOKENS:["ct",".","rgb","*=","bU",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["PARTICLES_SHADELESS",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","cy","=","u_diffuse_intensity","*","ct",".","rgb",";","vec3","cD","=","u_emit","*","ct",".","rgb",";","vec3","U","=","normalize","(","j",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{TYPE:"logic_negative_expr",PLACES:1},"SKY_COLOR",{TYPE:"logical_and_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","cA","=","u_environment_energy","*","cz","(","vec3","(","0.0",")",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","cA","=","u_environment_energy","*","cz","(","U",")",";"]}]}}]},{TYPE:"txt",TOKENS:["vec3","cB","=","u_ambient","*","cA",";","float","cG","=","u_specular_params","[","0","]",";","vec2","cH","=","vec2","(","u_specular_params","[","1","]",",","u_specular_params","[","2","]",")",";","vec3","cI","=","cG","*","u_specular_color",";","vec3","aQ",";","vec3","cJ",";","cK","(","cD",",","cB",",","cy",",","cI",",","h",",","U",",","D",",","cH",",","u_diffuse_params",",","vec4","(","1.0",")",",","0.0",",","vec4","(","0.0",")",",","aQ",",","cJ",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","aQ","=","ct",".","rgb",";"]}]}}]},{TYPE:"txt",TOKENS:["float","L","=","ct",".","a","*","cU",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["ALPHA"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["ALPHA_CLIP"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["if","(","L","<","0.5",")","discard",";","L","=","1.0",";"]}]}}]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["L","=","1.0",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["bR","(","aQ",",","length","(","i",")",",","D",",","1.0",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SOFT_PARTICLES"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","cO","=","-","i",".","z","/","u_view_max_depth",";","vec4","cP","=","GLSL_TEXTURE_PROJ","(","u_scene_depth",",","l",")",";","float","cR","=","cQ","(","cP",")",";","float","cS","=","cR","-","cO",";","float","cT","=","u_view_max_depth","/","SOFT_STRENGTH","*","cS",";","L","=","L","*","min","(","cT",",","1.0",")",";"]}]}}]},{TYPE:"txt",TOKENS:["aW","(","aQ",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["ALPHA","ALPHA_CLIP",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["aX","(","aQ",",","L",")",";"]}]}}]},{TYPE:"txt",TOKENS:["GLSL_OUT_FRAG_COLOR","=","vec4","(","aQ",",","L",")",";","}"]}]},e["proc_skybox.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",FILE:"color_util.glslf"},{TYPE:"txt",TOKENS:["uniform","vec3","u_sky_color",";","uniform","vec3","u_sun_direction",";","uniform","float","u_rayleigh_brightness",";","uniform","float","u_mie_brightness",";","uniform","float","u_spot_brightness",";","uniform","float","u_scatter_strength",";","uniform","float","u_rayleigh_strength",";","uniform","float","u_mie_strength",";","uniform","float","u_rayleigh_collection_power",";","uniform","float","u_mie_collection_power",";","uniform","float","u_mie_distribution",";","GLSL_IN","vec3","bp",";","GLSL_OUT","vec4","GLSL_OUT_FRAG_COLOR",";","const","float","dr","=","0.99",";","const","float","ds","=","1.8",";","const","int","dt","=","8",";","float","dy","(","vec3","O",",","vec3","bD",")","{","float","a","=","dot","(","bD",",","bD",")",";","float","b","=","2.0","*","dot","(","bD",",","O",")",";","float","du","=","dot","(","O",",","O",")","-","1.0",";","float","dv","=","b","*","b","-","4.0","*","a","*","du",";","float","dw","=","sqrt","(","dv",")",";","float","q","=","(","-","b","-","dw",")","/","2.0",";","float","dx","=","du","/","q",";","return","dx",";","}","float","dA","(","float","L",",","float","g",")","{","float","a","=","3.0","*","(","1.0","-","g","*","g",")",";","float","b","=","2.0","*","(","2.0","+","g","*","g",")",";","float","du","=","1.0","+","L","*","L",";","float","dz","=","pow","(","1.0","+","g","*","g","-","2.0","*","g","*","L",",","1.5",")",";","dz","=","max","(","dz",",","0.00001",")",";","return","(","a","/","b",")","*","(","du","/","dz",")",";","}","float","dF","(","vec3","O",",","vec3","bD",",","float","dB",")","{","float","dC","=","dot","(","bD",",","-","O",")",";","if","(","dC","<","0.0",")","{","return","1.0",";","}","vec3","dD","=","O","+","dC","*","bD",";","if","(","length","(","dD",")","<","dB",")","{","return","0.0",";","}","else","if","(","length","(","dD",")",">=","dB",")","{","vec3","cW","=","normalize","(","dD",")","*","dB","-","O",";","float","dE","=","acos","(","dot","(","normalize","(","cW",")",",","bD",")",")",";","return","smoothstep","(","0.0",",","1.0",",","pow","(","dE","*","2.0",",","3.0",")",")",";","}","else","return","1.0",";","}","vec3","dG","(","float","aM",",","vec3","aQ",",","float","aL",")","{","return","aQ","-","aQ","*","pow","(","u_sky_color",",","vec3","(","aL","/","aM",")",")",";","}","void","main","(",")","{","vec3","bq","=","normalize","(","bp",")",";","vec3","dH","=","u_sun_direction",";","float","L","=","dot","(","bq",",","dH",")",";","float","dI","=","dA","(","L",",","-","0.01",")","*","u_rayleigh_brightness","*","dH",".","z",";","float","dJ","=","dA","(","L","-","0.5",",","u_mie_distribution",")","*","u_mie_brightness","*","(","1.0","-","dH",".","z",")",";","float","dK","=","smoothstep","(","0.0",",","100.0",",","dA","(","L",",","0.9995",")",")","*","u_spot_brightness",";","vec3","dL","=","vec3","(","0.0",",","0.0",",","dr",")",";","float","dM","=","dy","(","dL",",","bq",")",";","float","dN","=","dM","/","float","(","dt",")",";","float","dO","=","dF","(","dL",",","bq",",","dr","-","0.3",")",";","vec3","dP","=","vec3","(","0.0",",","0.0",",","0.0",")",";","vec3","dQ","=","vec3","(","0.0",",","0.0",",","0.0",")",";","for","(","int","cl","=","0",";","cl","<","dt",";","cl","++",")","{","float","dR","=","dN","*","float","(","cl",")",";","vec3","O","=","dL","+","bq","*","dR",";","float","dS","=","dF","(","O",",","dH",",","dr","-","0.2",")",";","float","dT","=","dy","(","O",",","dH",")",";","vec3","dU","=","dG","(","dT",",","vec3","(","ds",")",",","u_scatter_strength",")","*","dS",";","dP","+=","dG","(","sqrt","(","dR",")",",","u_sky_color","*","dU",",","u_rayleigh_strength",")",";","dQ","+=","dG","(","dR",",","dU",",","u_mie_strength",")",";","}","dP","=","dP","*","dO","*","pow","(","dM",",","u_rayleigh_collection_power",")","/","float","(","dt",")",";","dQ","=","(","dQ","*","dO","*","pow","(","dM",",","u_mie_collection_power",")",")","/","float","(","dt",")",";","vec3","aQ","=","vec3","(","dK","*","dQ","+","dJ","*","dQ","+","dI","*","dP",")",";","aW","(","aQ",")",";","GLSL_OUT_FRAG_COLOR","=","vec4","(","aQ",",","1.0",")",";","}"]}]},e["r_convolution_skybox.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",FILE:"color_util.glslf"},{TYPE:"txt",TOKENS:["uniform","samplerCube","u_sky_reflection",";","uniform","float","u_roughness",";","GLSL_OUT","vec4","GLSL_OUT_FRAG_COLOR",";","GLSL_IN","vec3","bp",";","float","dZ","(","int","cr",",","int","dV",")","{","float","dW","=","1.0","/","float","(","dV",")",";","float","dX","=","1.0",";","float","dY","=","0.0",";","for","(","int","cl","=","0",";","cl","<","32",";","++","cl",")","{","if","(","cr",">","0",")","{","dX","=","mod","(","float","(","cr",")",",","2.0",")",";","dY","+=","dX","*","dW",";","dW","=","dW","/","2.0",";","cr","=","int","(","float","(","cr",")","/","2.0",")",";","}","}","return","dY",";","}","vec2","ea","(","int","cl",",","int","d_",")","{","return","vec2","(","float","(","cl",")","/","float","(","d_",")",",","dZ","(","cl",",","2",")",")",";","}","vec3","eh","(","vec2","eb",",","vec3","d_",",","float","ec",")","{","float","a","=","ec","*","ec",";","float","by","=","2.0","*","M_PI","*","eb",".","x",";","float","ed","=","sqrt","(","(","1.0","-","eb",".","y",")","/","(","1.0","+","(","a","*","a","-","1.0",")","*","eb",".","y",")",")",";","float","ee","=","sqrt","(","1.0","-","ed","*","ed",")",";","vec3","ef",";","ef",".","x","=","cos","(","by",")","*","ee",";","ef",".","y","=","sin","(","by",")","*","ee",";","ef",".","z","=","ed",";","vec3","bu","=","abs","(","d_",".","z",")","<","0.999","?","vec3","(","0.0",",","0.0",",","1.0",")",":","vec3","(","1.0",",","0.0",",","0.0",")",";","vec3","V","=","normalize","(","cross","(","bu",",","d_",")",")",";","vec3","eg","=","cross","(","d_",",","V",")",";","vec3","bB","=","V","*","ef",".","x","+","eg","*","ef",".","y","+","d_","*","ef",".","z",";","return","normalize","(","bB",")",";","}","void","main","(",")","{","vec3","ei","=","vec3","(","0.0",")",";","if","(","u_roughness","!=","0.0",")","{","vec3","d_","=","normalize","(","bp",")",";","vec3","ej","=","d_",";","vec3","ek","=","ej",";","const","int","el","=","1024",";","float","em","=","0.0",";","for","(","int","cl","=","0",";","cl","<","el",";","++","cl",")","{","vec2","eb","=","ea","(","cl",",","el",")",";","vec3","ef","=","eh","(","eb",",","d_",",","u_roughness",")",";","vec3","en","=","normalize","(","2.0","*","dot","(","ek",",","ef",")","*","ef","-","ek",")",";","float","eo","=","max","(","dot","(","d_",",","en",")",",","0.0",")",";","if","(","eo",">","0.0",")","{","vec3","bs","=","GLSL_TEXTURE_CUBE","(","u_sky_reflection",",","en",")",".","rgb",";","bC","(","bs",")",";","ei","+=","bs","*","eo",";","em","+=","eo",";","}","}","ei","=","ei","/","em",";","}","else","{","vec3","bs","=","GLSL_TEXTURE_CUBE","(","u_sky_reflection",",","normalize","(","bp",")",")",".","rgb",";","bC","(","bs",")",";","ei","=","bs",";","}","GLSL_OUT_FRAG_COLOR","=","vec4","(","ei",",","1.0",")",";","}"]}]},e["shadow.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"PRECISION",TOKENS:["highp"]},{TYPE:"var",NAME:"NODES",TOKENS:["0"]},{TYPE:"var",NAME:"REFLECTION_TYPE",TOKENS:["REFL_NONE"]},{TYPE:"var",NAME:"USE_TBN_SHADING",TOKENS:["0"]},{TYPE:"var",NAME:"SHADELESS",TOKENS:["0"]},{TYPE:"var",NAME:"RGBA_SHADOWS",TOKENS:["0"]},{TYPE:"var",NAME:"USE_VIEW_TSR_INVERSE",TOKENS:["0"]},{TYPE:"var",NAME:"USE_MODEL_TSR_INVERSE",TOKENS:["0"]},{TYPE:"var",NAME:"USE_VIEW_TSR",TOKENS:["0"]},{TYPE:"var",NAME:"USE_MODEL_TSR",TOKENS:["0"]},{TYPE:"var",NAME:"USE_ENVIRONMENT_LIGHT",TOKENS:["0"]},{TYPE:"var",NAME:"SKY_TEXTURE",TOKENS:["0"]},{TYPE:"var",NAME:"SKY_COLOR",TOKENS:["0"]},{TYPE:"var",NAME:"USE_REFRACTION",TOKENS:["0"]},{TYPE:"var",NAME:"CALC_TBN_SPACE",TOKENS:["0"]},{TYPE:"var",NAME:"CAMERA_TYPE",TOKENS:["CAM_TYPE_PERSP"]},{TYPE:"var",NAME:"USE_POSITION_CLIP",TOKENS:["0"]},{TYPE:"var",NAME:"USE_REFRACTION_CORRECTION",TOKENS:["0"]},{TYPE:"var",NAME:"CSM_SECTION1",TOKENS:["0"]},{TYPE:"var",NAME:"CSM_SECTION2",TOKENS:["0"]},{TYPE:"var",NAME:"CSM_SECTION3",TOKENS:["0"]},{TYPE:"var",NAME:"NUM_LIGHTS",TOKENS:["0"]},{TYPE:"var",NAME:"NUM_LAMP_LIGHTS",TOKENS:["0"]},{TYPE:"var",NAME:"TEXTURE_BLEND_TYPE",TOKENS:["TEXTURE_BLEND_TYPE_MIX"]},{TYPE:"var",NAME:"NUM_VALUES",TOKENS:["0"]},{TYPE:"var",NAME:"NUM_RGBS",TOKENS:["0"]},{TYPE:"var",NAME:"NUM_CAST_LAMPS",TOKENS:["0"]},{TYPE:"var",NAME:"TEXTURE_COLOR",TOKENS:["0"]},{TYPE:"var",NAME:"ALPHA",TOKENS:["0"]},{TYPE:"var",NAME:"SHADOW_USAGE",TOKENS:["NO_SHADOWS"]},{TYPE:"var",NAME:"POISSON_DISK_NUM",TOKENS:["NO_SOFT_SHADOWS"]},{TYPE:"var",NAME:"USE_DERIVATIVES_EXT",TOKENS:["0"]},{TYPE:"var",NAME:"CAMERA_TYPE",TOKENS:["CAM_TYPE_PERSP"]},{TYPE:"var",NAME:"USE_LOD_SMOOTHING",TOKENS:["0"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["GLSL1","USE_DERIVATIVES_EXT",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"extension",TOKENS:["GL_OES_standard_derivatives",":","enable"]}]}}]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","ALPHA",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"math.glslv"}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["RGBA_SHADOWS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"depth_fetch.glslf"},{TYPE:"include",FILE:"pack.glslf"}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_LOD_SMOOTHING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"coverage.glslf"}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","ALPHA",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","float","u_time",";","uniform","float","u_environment_energy",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_LIGHTS",0,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_light_positions","[","NUM_LIGHTS","]",";","uniform","vec3","u_light_directions","[","NUM_LIGHTS","]",";","uniform","vec4","u_light_color_intensities","[","NUM_LIGHTS","]",";"]}]}}]},{TYPE:"txt",TOKENS:["uniform","vec3","u_camera_eye_frag",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_FRESNEL","USE_NODE_LAYER_WEIGHT",{TYPE:"logical_or_expr",PLACES:2},"CAMERA_TYPE","CAM_TYPE_ORTHO",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec3","u_camera_direction",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2},"USE_VIEW_TSR",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat3","u_view_tsr_frag",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_VIEW_TSR_INVERSE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat3","u_view_tsr_inverse",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_MODEL_TSR"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat3","u_model_tsr",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_MODEL_TSR_INVERSE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat3","u_model_tsr_inverse",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","samplerCube","u_sky_texture",";"]}]}},{TYPE:"elif",EXPRESSION:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec3","u_horizon_color",";","uniform","vec3","u_zenith_color",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_plane_reflection",";"]}]}},{TYPE:"elif",EXPRESSION:["REFLECTION_TYPE","REFL_CUBE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","samplerCube","u_cube_reflection",";"]}]}},{TYPE:"elif",EXPRESSION:["REFLECTION_TYPE","REFL_MIRRORMAP",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{TYPE:"txt",TOKENS:["uniform","float","u_emit",";","uniform","float","u_ambient",";","uniform","vec2","u_fresnel_params",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_TYPE","REFL_MIRRORMAP",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","float","u_mirror_factor",";"]}]}},{TYPE:"elif",EXPRESSION:["REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_refl_plane",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_LAMP"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec3","u_lamp_light_positions","[","NUM_LAMP_LIGHTS","]",";","uniform","vec3","u_lamp_light_directions","[","NUM_LAMP_LIGHTS","]",";","uniform","vec3","u_lamp_light_color_intensities","[","NUM_LAMP_LIGHTS","]",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_VALUE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_node_values","[","NUM_VALUES","]",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_RGB"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec3","u_node_rgbs","[","NUM_RGBS","]",";"]}]}}]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_COLOR"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_colormap0",";","uniform","float","u_alpha_factor",";"]}]}}]},{TYPE:"txt",TOKENS:["uniform","vec4","u_diffuse_color",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["POISSON_DISK_NUM","NO_SOFT_SHADOWS",{TYPE:"non_equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_pcf_blur_radii",";"]}]}}]},{TYPE:"txt",TOKENS:["uniform","vec4","u_csm_center_dists",";","uniform","PRECISION","GLSL_SMPLR2D_SHDW","u_shadow_map0",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION1","NUM_CAST_LAMPS",1,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","PRECISION","GLSL_SMPLR2D_SHDW","u_shadow_map1",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION2","NUM_CAST_LAMPS",2,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","PRECISION","GLSL_SMPLR2D_SHDW","u_shadow_map2",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION3","NUM_CAST_LAMPS",3,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","PRECISION","GLSL_SMPLR2D_SHDW","u_shadow_map3",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_shadow_mask",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_B4W_REFRACTION"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_refractmap",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_REFRACTION","USE_REFRACTION_CORRECTION",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","PRECISION","sampler2D","u_scene_depth",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_CURVE_VEC","USE_NODE_CURVE_RGB","USE_NODE_VALTORGB",{TYPE:"logical_or_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_nodes_texture",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_OBJECT_INFO"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec3","u_obj_info",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["RGBA_SHADOWS","SHADOW_USAGE","SHADOW_CASTING",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec2","u_camera_range",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_LOD_SMOOTHING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","float","u_lod_coverage",";","uniform","float","u_lod_cmp_logic",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","ALPHA",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","h",";","GLSL_IN","vec3","j",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CALC_TBN_SPACE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","k",";"]}]}}]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_COLOR"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec2","A",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{TYPE:"equal_expr",PLACES:2},"NODES","ALPHA",{TYPE:"logical_and_expr",PLACES:2},"SHADOW_USAGE","SHADOW_CASTING",{TYPE:"equal_expr",PLACES:2},"RGBA_SHADOWS",{TYPE:"logical_and_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","i",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","n",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION1","NUM_CAST_LAMPS",1,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","o",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION2","NUM_CAST_LAMPS",2,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","u",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION3","NUM_CAST_LAMPS",3,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","v",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2},"USE_POSITION_CLIP",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","l",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","ALPHA",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_B4W_REFRACTION","USE_REFRACTION",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","float","m",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_TBN_SHADING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","B",";"]}]}}]},{TYPE:"txt",TOKENS:["GLSL_OUT","vec4","GLSL_OUT_FRAG_COLOR",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADELESS",{TYPE:"logic_negative_expr",PLACES:1},"NODES","ALPHA",{TYPE:"logical_and_expr",PLACES:2},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"shadow.glslf"}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","ALPHA",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"nodes.glslf"}]}}]},{TYPE:"txt",TOKENS:["void","main","(",")","{"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_LOD_SMOOTHING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["if","(","!","C","(","u_lod_coverage",",","u_lod_cmp_logic",")",")","discard",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["ALPHA"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","D","=","normalize","(","u_camera_eye_frag","-","h",")",";","vec3","E",";","vec3","F",";","vec3","G",";","vec4","H",";","float","I",";","J","(","D",",","E",",","F",",","G",",","H",",","I",")",";","float","L","=","I",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_COLOR"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","L","=","(","GLSL_TEXTURE","(","u_colormap0",",","A",")",")",".","a",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","M","=","u_alpha_factor","*","L",";","M","+=","(","1.0","-","step","(","0.0",",","M",")",")",";","L","=","mix","(","M",",","1.0",",","u_diffuse_color",".","a",")",";"]}]}}]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","L","=","u_diffuse_color",".","a",";"]}]}}]}]}}]},{TYPE:"txt",TOKENS:["if","(","L","<","0.5",")","discard",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADOW_USAGE","NO_SHADOWS",{TYPE:"equal_expr",PLACES:2},"SHADOW_USAGE","SHADOW_CASTING",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["RGBA_SHADOWS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","eq","=","ep","(","-","i",".","z",",","u_camera_range",")",";","GLSL_OUT_FRAG_COLOR","=","er","(","eq",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT_FRAG_COLOR","=","vec4","(","1.0",")",";"]}]}}]}]}},{TYPE:"elif",EXPRESSION:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT_FRAG_COLOR","=","es","(","i",".","z",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","ALPHA",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CALC_TBN_SPACE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT_FRAG_COLOR",".","a","*=","clamp","(","k",".","r",",","0.999999999",",","1.0",")",";"]}]}}]}]}}]},{TYPE:"txt",TOKENS:["}"]}]},e["shadow.glslv"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"PRECISION",TOKENS:["highp"]},{TYPE:"var",NAME:"CAUSTICS",TOKENS:["0"]},{TYPE:"var",NAME:"CALC_TBN_SPACE",TOKENS:["0"]},{TYPE:"var",NAME:"MAIN_BEND_COL",TOKENS:["0"]},{TYPE:"var",NAME:"DETAIL_BEND",TOKENS:["0"]},{TYPE:"var",NAME:"CALC_TBN",TOKENS:["0"]},{TYPE:"var",NAME:"USE_INSTANCED_PARTCLS",TOKENS:["0"]},{TYPE:"var",NAME:"NODES",TOKENS:["0"]},{TYPE:"var",NAME:"USE_TBN_SHADING",TOKENS:["0"]},{TYPE:"var",NAME:"REFLECTION_TYPE",TOKENS:["REFL_NONE"]},{TYPE:"var",NAME:"SMAA_JITTER",TOKENS:["0"]},{TYPE:"var",NAME:"MAC_OS_SHADOW_HACK",TOKENS:["0"]},{TYPE:"var",NAME:"USE_POSITION_CLIP",TOKENS:["0"]},{TYPE:"var",NAME:"RGBA_SHADOWS",TOKENS:["0"]},{TYPE:"var",NAME:"REFRACTIVE",TOKENS:["0"]},{TYPE:"var",NAME:"AU_QUALIFIER",TOKENS:["GLSL_IN"]},{TYPE:"var",NAME:"BEND_CENTER_ONLY",TOKENS:["0"]},{TYPE:"var",NAME:"CSM_SECTION1",TOKENS:["0"]},{TYPE:"var",NAME:"CSM_SECTION2",TOKENS:["0"]},{TYPE:"var",NAME:"CSM_SECTION3",TOKENS:["0"]},{TYPE:"var",NAME:"HAIR_BILLBOARD",TOKENS:["0"]},{TYPE:"var",NAME:"FRAMES_BLENDING",TOKENS:["0"]},{TYPE:"var",NAME:"SHADOW_TEX_RES",TOKENS:["2048.0"]},{TYPE:"var",NAME:"VERTEX_ANIM",TOKENS:["0"]},{TYPE:"var",NAME:"NUM_CAST_LAMPS",TOKENS:["0"]},{TYPE:"var",NAME:"TEXTURE_COLOR",TOKENS:["0"]},{TYPE:"var",NAME:"ALPHA",TOKENS:["0"]},{TYPE:"var",NAME:"VERTEX_ANIM_MIX_NORMALS_FACTOR",TOKENS:["u_va_frame_factor"]},{TYPE:"var",NAME:"MAX_BONES",TOKENS:["0"]},{TYPE:"var",NAME:"WIND_BEND",TOKENS:["0"]},{TYPE:"var",NAME:"SHADOW_USAGE",TOKENS:["NO_SHADOWS"]},{TYPE:"var",NAME:"SKINNED",TOKENS:["0"]},{TYPE:"var",NAME:"DYNAMIC_GRASS",TOKENS:["0"]},{TYPE:"var",NAME:"BILLBOARD",TOKENS:["0"]},{TYPE:"var",NAME:"STATIC_BATCH",TOKENS:["0"]},{TYPE:"var",NAME:"BILLBOARD_JITTERED",TOKENS:["0"]},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",FILE:"math.glslv"},{TYPE:"include",FILE:"to_world.glslv"},{TYPE:"include",FILE:"scale_texcoord.glslv"},{TYPE:"txt",TOKENS:["GLSL_IN","vec3","a_position",";","GLSL_IN","vec4","a_tbn",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_INSTANCED_PARTCLS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","a_part_ts",";","GLSL_IN","vec4","a_part_r",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_TBN_SHADING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","a_shade_tangs",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SKINNED"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","a_influence",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{TYPE:"logical_or_expr",PLACES:3},"USE_INSTANCED_PARTCLS",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WIND_BEND"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["MAIN_BEND_COL"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","float","a_bending_col_main",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DETAIL_BEND"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","a_bending_col_detail",";","AU_QUALIFIER","float","au_detail_bending_amp",";","AU_QUALIFIER","float","au_branch_bending_amp",";","AU_QUALIFIER","float","au_detail_bending_freq",";"]}]}}]}]}}]},{TYPE:"txt",TOKENS:["AU_QUALIFIER","float","au_wind_bending_amp",";","AU_QUALIFIER","float","au_wind_bending_freq",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["BEND_CENTER_ONLY"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","a_emitter_center",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["VERTEX_ANIM"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","a_position_next",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","ALPHA",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","USE_NODE_NORMAL_MAP","CAUSTICS","CALC_TBN_SPACE",{TYPE:"logical_or_expr",PLACES:5}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","a_tbn_next",";"]}]}}]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","ALPHA",{TYPE:"logical_and_expr",PLACES:2},{TYPE:"logic_negative_expr",PLACES:1},"TEXTURE_COLOR",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec2","a_texcoord",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","ALPHA",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec3","h",";","GLSL_OUT","vec3","j",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CALC_TBN_SPACE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec4","k",";"]}]}}]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_COLOR"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec2","A",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{TYPE:"equal_expr",PLACES:2},"NODES","ALPHA",{TYPE:"logical_and_expr",PLACES:2},"SHADOW_USAGE","SHADOW_CASTING",{TYPE:"equal_expr",PLACES:2},"RGBA_SHADOWS",{TYPE:"logical_and_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec4","i",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec4","n",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION1","NUM_CAST_LAMPS",1,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec4","o",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION2","NUM_CAST_LAMPS",2,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec4","u",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION3","NUM_CAST_LAMPS",3,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec4","v",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2},"USE_POSITION_CLIP",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec3","l",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","ALPHA",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_B4W_REFRACTION","REFRACTIVE",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","float","m",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_TBN_SHADING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec3","B",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["STATIC_BATCH"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["const","mat3","u_model_tsr","=","mat3","(","0.0",",","0.0",",","0.0",",","1.0",",","0.0",",","0.0",",","0.0",",","1.0",",","0.0",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","PRECISION","mat3","u_model_tsr",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_JITTER"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{TYPE:"txt",TOKENS:["uniform","mat3","u_view_tsr",";","uniform","mat4","u_proj_matrix",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC_GRASS","BILLBOARD",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec3","u_camera_eye",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["BILLBOARD","SHADOW_USAGE","SHADOW_CASTING",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat3","u_shadow_cast_billboard_view_tsr",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC_GRASS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","PRECISION","sampler2D","u_grass_map_depth",";","uniform","sampler2D","u_grass_map_color",";","uniform","vec4","u_camera_quat",";","uniform","vec3","u_grass_map_dim",";","uniform","float","u_grass_size",";","uniform","float","u_scale_threshold",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SKINNED"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_quatsb","[","MAX_BONES","]",";","uniform","vec4","u_transb","[","MAX_BONES","]",";","uniform","vec4","u_arm_rel_trans",";","uniform","vec4","u_arm_rel_quat",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FRAMES_BLENDING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_quatsa","[","MAX_BONES","]",";","uniform","vec4","u_transa","[","MAX_BONES","]",";","uniform","float","u_frame_factor",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WIND_BEND"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["BILLBOARD_JITTERED"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","float","u_jitter_amp",";","uniform","float","u_jitter_freq",";"]}]}}]},{TYPE:"txt",TOKENS:["uniform","vec3","u_wind",";","uniform","PRECISION","float","u_time",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["VERTEX_ANIM"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","float","u_va_frame_factor",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","ALPHA",{TYPE:"logical_and_expr",PLACES:2},{TYPE:"logic_negative_expr",PLACES:1},"TEXTURE_COLOR",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec3","u_texture_scale",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","float","u_normal_offset",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["MAC_OS_SHADOW_HACK"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat3","u_v_light_tsr","[","NUM_CAST_LAMPS","]",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_v_light_ts","[","NUM_CAST_LAMPS","]",";","uniform","vec4","u_v_light_r","[","NUM_CAST_LAMPS","]",";"]}]}}]},{TYPE:"txt",TOKENS:["uniform","mat4","u_p_light_matrix0",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION1","NUM_CAST_LAMPS",1,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION2","NUM_CAST_LAMPS",2,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION3","NUM_CAST_LAMPS",3,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_B4W_REFRACTION"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{TYPE:"include",FILE:"dynamic_grass.glslv"},{TYPE:"include",FILE:"shadow.glslv"},{TYPE:"include",FILE:"skin.glslv"},{TYPE:"include",FILE:"wind_bending.glslv"},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","ALPHA",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"nodes.glslv"}]}}]},{TYPE:"txt",TOKENS:["void","main","(",")","{","mat3","N","=","u_view_tsr",";","vec3","O","=","a_position",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{TYPE:"equal_expr",PLACES:2},"CALC_TBN_SPACE","USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","USE_NODE_NORMAL_MAP","CAUSTICS","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{TYPE:"logical_and_expr",PLACES:3},"USE_NODE_BSDF_BEGIN","USE_NODE_FRESNEL","USE_NODE_TEX_COORD_NO","USE_NODE_TEX_COORD_RE","USE_NODE_LAYER_WEIGHT","USE_NODE_BUMP",{TYPE:"logical_or_expr",PLACES:13}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","P",",","Q",";","vec4","S","=","R","(","a_tbn",",","P",",","Q",")",";","vec3","bW","=","T","(","S",",","vec3","(","0.0",",","1.0",",","0.0",")",")",";","vec3","U","=","bW",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","U","=","vec3","(","0.0",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","ALPHA","CALC_TBN_SPACE",{TYPE:"logical_and_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","V","=","T","(","S",",","vec3","(","1.0",",","0.0",",","0.0",")",")",";","vec3","W","=","Q","*","cross","(","U",",","V",")",";","vec4","Y","=","X","(","W",",","Q","*","P",")",";","V","=","T","(","Y",",","U",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","V","=","vec3","(","0.0",")",";","vec3","W","=","vec3","(","0.0",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["VERTEX_ANIM"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["O","=","mix","(","O",",","a_position_next",",","u_va_frame_factor",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","ALPHA",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","USE_NODE_NORMAL_MAP","CAUSTICS","CALC_TBN_SPACE",{TYPE:"logical_or_expr",PLACES:5}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","af",",","ah",";","vec4","ai","=","R","(","a_tbn_next",",","af",",","ah",")",";","vec3","aj","=","T","(","ai",",","vec3","(","0.0",",","1.0",",","0.0",")",")",";","U","=","mix","(","U",",","aj",",","VERTEX_ANIM_MIX_NORMALS_FACTOR",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CALC_TBN_SPACE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","ak","=","T","(","ai",",","vec3","(","1.0",",","0.0",",","0.0",")",")",";","vec3","al","=","ah","*","cross","(","aj",",","ak",")",";","vec4","am","=","X","(","al",",","ah","*","af",")",";","ak","=","T","(","am",",","aj",")",";","V","=","mix","(","V",",","ak",",","u_va_frame_factor",")",";","W","=","mix","(","W",",","al",",","u_va_frame_factor",")",";"]}]}}]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SKINNED"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["an","(","O",",","V",",","W",",","U",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_INSTANCED_PARTCLS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["mat3","Z","=","mat3","(","a_part_ts","[","0","]",",","a_part_ts","[","1","]",",","a_part_ts","[","2","]",",","a_part_ts","[","3","]",",","a_part_r","[","0","]",",","a_part_r","[","1","]",",","a_part_r","[","2","]",",","a_part_r","[","3","]",",","1.0",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["STATIC_BATCH",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["Z","=","aY","(","u_model_tsr",",","Z",")",";"]}]}}]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["mat3","Z","=","u_model_tsr",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{TYPE:"logical_or_expr",PLACES:3},"USE_INSTANCED_PARTCLS",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","ao","=","au_center_pos",";"]}]}},{TYPE:"elif",EXPRESSION:["DYNAMIC_GRASS","USE_INSTANCED_PARTCLS",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","ao","=","a_part_ts",".","xyz",";","O","=","ap","(","Z",",","O",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","ao","=","vec3","(","0.0",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_TBN_SHADING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CALC_TBN"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","ac","=","normalize","(","_","(","Z",",","bW",")",")",";","vec3","ad","=","cross","(","vec3","(","0.0",",","0.0",",","1.0",")",",","ac",")",";","vec3","ae","=","cross","(","ac",",","ad",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","ae","=","a_shade_tangs",";"]}]}}]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","ae","=","vec3","(","0.0",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC_GRASS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["au","aw","=","aZ","(","O",",","vec3","(","0.0",")",",","vec3","(","0.0",")",",","vec3","(","0.0",")",",","U",",","ao",",","u_grass_map_depth",",","u_grass_map_color",",","u_grass_map_dim",",","u_grass_size",",","u_camera_eye",",","u_camera_quat",",","N",",","Z",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["BILLBOARD"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","aq","=","ap","(","Z",",","ao",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["HAIR_BILLBOARD",{TYPE:"logic_negative_expr",PLACES:1},"SHADOW_USAGE","SHADOW_CASTING",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["mat3","et","=","u_shadow_cast_billboard_view_tsr",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["mat3","et","=","N",";"]}]}}]},{TYPE:"txt",TOKENS:["Z","=","as","(","u_camera_eye",",","aq",",","et",",","Z",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WIND_BEND","BILLBOARD_JITTERED",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["Z","=","at","(","u_wind",",","u_time",",","u_jitter_amp",",","u_jitter_freq",",","aq",",","Z",")",";"]}]}}]},{TYPE:"txt",TOKENS:["au","aw","=","av","(","O","-","ao",",","ao",",","V",",","ae",",","W",",","U",",","Z",")",";","aw",".","ao","=","aq",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["au","aw","=","av","(","O",",","ao",",","V",",","ae",",","W",",","U",",","Z",")",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WIND_BEND"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["MAIN_BEND_COL","DETAIL_BEND",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","ay","=","bW",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","ay","=","vec3","(","0.0",")",";"]}]}}]},{TYPE:"txt",TOKENS:["ax","(","aw",".","O",",","aw",".","ao",",","ay",",","mat4","(","0.0",")",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","ALPHA",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["h","=","aw",".","O",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","USE_NODE_NORMAL_MAP","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{TYPE:"logical_and_expr",PLACES:3},"USE_NODE_TEX_COORD_NO","USE_NODE_BSDF_BEGIN","USE_NODE_FRESNEL","USE_NODE_TEX_COORD_RE","USE_NODE_LAYER_WEIGHT","USE_NODE_BUMP",{TYPE:"logical_or_expr",PLACES:12}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["j","=","aw",".","U",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CALC_TBN_SPACE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","aA","=","(","dot","(","cross","(","aw",".","U",",","aw",".","V",")",",","aw",".","W",")","<","0.0",")","?","-","1.0",":","1.0",";","k","=","vec4","(","aw",".","V",",","aA",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_TBN_SHADING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["B","=","aw",".","aB",";"]}]}}]}]}}]},{TYPE:"txt",TOKENS:["vec4","bY","=","vec4","(","ap","(","N",",","aw",".","O",")",",","1.0",")",";","vec4","f","=","u_proj_matrix","*","bY",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_JITTER"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["f",".","xy","+=","u_subpixel_jitter","*","f",".","w",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","ALPHA",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2},"USE_POSITION_CLIP",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["l","=","aC","(","f",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_B4W_REFRACTION","REFRACTIVE",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["m","=","-","bY",".","z","/","u_view_max_depth",";"]}]}}]},{TYPE:"txt",TOKENS:["J","(",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_COLOR"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["A","=","az","(","a_texcoord",",","u_texture_scale",")",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["bZ","(","aw",".","O",",","aw",".","U",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{TYPE:"equal_expr",PLACES:2},"NODES","ALPHA",{TYPE:"logical_and_expr",PLACES:2},"SHADOW_USAGE","SHADOW_CASTING",{TYPE:"equal_expr",PLACES:2},"RGBA_SHADOWS",{TYPE:"logical_and_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["i","=","bY",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADOW_USAGE","SHADOW_CASTING",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec2","eu","=","(","u_proj_matrix","*","vec4","(","N","[","0","]",",","1.0",")",")",".","xy",";","float","ev","=","SHADOW_TEX_RES","/","2.0",";","eu","=","floor","(","eu","*","ev","+","0.5",")","/","ev","-","eu",";","f",".","xy","+=","eu",";"]}]}}]},{TYPE:"txt",TOKENS:["gl_Position","=","f",";","}"]}]},e["sky.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"WO_SKYTEX",TOKENS:["0"]},{TYPE:"var",NAME:"WO_SKYREAL",TOKENS:["0"]},{TYPE:"var",NAME:"WO_SKYBLEND",TOKENS:["0"]},{TYPE:"var",NAME:"PROCEDURAL_SKYDOME",TOKENS:["0"]},{TYPE:"var",NAME:"WATER_EFFECTS",TOKENS:["0"]},{TYPE:"var",NAME:"DISABLE_FOG",TOKENS:["0"]},{TYPE:"var",NAME:"WO_SKYPAPER",TOKENS:["0"]},{TYPE:"var",NAME:"REFLECTION_PASS",TOKENS:["REFL_PASS_NONE"]},{TYPE:"var",NAME:"WATER_LEVEL",TOKENS:["0.0"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",FILE:"color_util.glslf"},{TYPE:"txt",TOKENS:["uniform","samplerCube","u_sky",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WATER_EFFECTS","DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1},"REFLECTION_PASS","REFL_PASS_NONE",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_and_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec3","u_camera_eye_frag",";","uniform","vec4","u_underwater_fog_color_density",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WO_SKYBLEND","WO_SKYPAPER",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_sky_tex_fac",";","uniform","vec3","u_sky_tex_color",";","uniform","float","u_sky_tex_dvar",";","uniform","vec3","u_horizon_color",";","uniform","vec3","u_zenith_color",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WO_SKYBLEND","WO_SKYPAPER","WO_SKYTEX",{TYPE:"logical_and_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"sky_blending.glslf"}]}}]},{TYPE:"txt",TOKENS:["GLSL_IN","vec3","bp",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["PROCEDURAL_SKYDOME",{TYPE:"logic_negative_expr",PLACES:1},"WO_SKYTEX","WO_SKYBLEND",{TYPE:"logical_or_expr",PLACES:2},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec2","A",";"]}]}}]},{TYPE:"txt",TOKENS:["GLSL_OUT","vec4","GLSL_OUT_FRAG_COLOR",";","void","main","(",")","{","vec3","bs",";","vec3","bq","=","normalize","(","bp",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WO_SKYBLEND","WO_SKYPAPER",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","ew","=","0.0",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WO_SKYREAL"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["ew","=","abs","(","A",".","y",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["ew","=","(","A",".","y","+","1.0",")","*","0.5",";"]}]}}]},{TYPE:"txt",TOKENS:["vec3","ex","=","u_horizon_color",";","vec3","ey","=","u_zenith_color",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WO_SKYTEX"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","ez","=","vec3","(","A",",","0.0",")",";","vec4","eA","=","GLSL_TEXTURE_CUBE","(","u_sky",",","bq",")",";","bC","(","eA",".","rgb",")",";","bs","=","eB","(","ex",",","ey",",","eA",",","ew",",","ez",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["bs","=","mix","(","ex",",","ey",",","ew",")",";"]}]}}]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["bs","=","GLSL_TEXTURE_CUBE","(","u_sky",",","bq",")",".","rgb",";","bC","(","bs",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WATER_EFFECTS","DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1},"REFLECTION_PASS","REFL_PASS_NONE",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_and_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","eC","=","WATER_LEVEL","-","u_camera_eye_frag",".","z",";","vec3","eD","=","vec3","(","0.0",")",";","vec3","eE","=","mix","(","u_underwater_fog_color_density",".","rgb",",","eD",",","min","(","-","bq",".","z",",","1.0",")",")",";","eE","*=","min","(","1.0","-","min","(","0.03","*","eC",",","0.8",")",",","1.0",")",";","float","aL","=","clamp","(","sign","(","0.01","*","eC","-","bq",".","z",")",",","0.0",",","1.0",")",";","bs","=","mix","(","bs",",","eE",",","aL",")",";"]}]}}]},{TYPE:"txt",TOKENS:["aW","(","bs",")",";","GLSL_OUT_FRAG_COLOR","=","vec4","(","bs",",","1.0",")",";","}"]}]},e["sky.glslv"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"PROCEDURAL_SKYDOME",TOKENS:["0"]},{TYPE:"var",NAME:"WO_SKYTEX",TOKENS:["0"]},{TYPE:"var",NAME:"WO_SKYBLEND",TOKENS:["0"]},{TYPE:"include",FILE:"std.glsl"},{TYPE:"txt",TOKENS:["uniform","mat4","u_sky_vp_inverse",";","GLSL_IN","vec3","a_position",";","GLSL_OUT","vec3","bp",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["PROCEDURAL_SKYDOME",{TYPE:"logic_negative_expr",PLACES:1},"WO_SKYTEX","WO_SKYBLEND",{TYPE:"logical_or_expr",PLACES:2},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec2","A",";"]}]}}]},{TYPE:"txt",TOKENS:["void","main","(",")","{","vec4","O","=","vec4","(","a_position",".","xy",",","0.9999999",",","1.0",")",";","vec4","bq","=","u_sky_vp_inverse","*","O",";","bp","=","bq",".","xyz",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["PROCEDURAL_SKYDOME",{TYPE:"logic_negative_expr",PLACES:1},"WO_SKYTEX","WO_SKYBLEND",{TYPE:"logical_or_expr",PLACES:2},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["A","=","a_position",".","xy",";"]}]}}]},{TYPE:"txt",TOKENS:["gl_Position","=","O",";","}"]}]},e["skybox.glslv"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"PROCEDURAL_SKYDOME",TOKENS:["0"]},{TYPE:"var",NAME:"WO_SKYTEX",TOKENS:["0"]},{TYPE:"var",NAME:"WO_SKYBLEND",TOKENS:["0"]},{TYPE:"include",FILE:"std.glsl"},{TYPE:"txt",TOKENS:["uniform","mat4","u_cube_view_matrix",";","GLSL_IN","vec3","a_position",";","GLSL_OUT","vec3","bp",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["PROCEDURAL_SKYDOME",{TYPE:"logic_negative_expr",PLACES:1},"WO_SKYTEX","WO_SKYBLEND",{TYPE:"logical_or_expr",PLACES:2},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec2","A",";"]}]}}]},{TYPE:"txt",TOKENS:["void","main","(",")","{","vec4","O","=","vec4","(","a_position",".","xy",",","0.999999",",","1.0",")",";","vec4","bq","=","u_cube_view_matrix","*","O",";","bp","=","bq",".","xyz",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["PROCEDURAL_SKYDOME",{TYPE:"logic_negative_expr",PLACES:1},"WO_SKYTEX","WO_SKYBLEND",{TYPE:"logical_or_expr",PLACES:2},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["A","=","a_position",".","xy",";"]}]}}]},{TYPE:"txt",TOKENS:["gl_Position","=","O",";","}"]}]},e["tex_skybox.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"WO_SKYTEX",TOKENS:["0"]},{TYPE:"var",NAME:"WO_SKYREAL",TOKENS:["0"]},{TYPE:"var",NAME:"WO_SKYBLEND",TOKENS:["0"]},{TYPE:"var",NAME:"WO_SKYPAPER",TOKENS:["0"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",FILE:"color_util.glslf"},{TYPE:"txt",TOKENS:["GLSL_OUT","vec4","GLSL_OUT_FRAG_COLOR",";","GLSL_IN","vec3","bp",";","GLSL_IN","vec2","A",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WO_SKYTEX"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","samplerCube","u_sky_texture",";"]}]}}]},{TYPE:"txt",TOKENS:["uniform","vec4","u_sky_tex_fac",";","uniform","vec3","u_sky_tex_color",";","uniform","float","u_sky_tex_dvar",";","uniform","vec3","u_horizon_color",";","uniform","vec3","u_zenith_color",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WO_SKYTEX"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"sky_blending.glslf"}]}}]},{TYPE:"txt",TOKENS:["void","main","(",")","{","vec3","bq","=","normalize","(","bp",")",";","vec3","bs",";","float","ew","=","0.0",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WO_SKYPAPER"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WO_SKYTEX"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["bs","=","GLSL_TEXTURE_CUBE","(","u_sky_texture",",","bq",")",".","xyz",";","bC","(","bs",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["bs","=","vec3","(","1.0",")",";"]}]}}]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WO_SKYBLEND"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","L","=","acos","(","bq",".","z",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WO_SKYREAL"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["ew","=","abs","(","L","*","INV_PI","-","0.5",")","*","2.0",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["ew","=","1.0","-","L","*","INV_PI",";"]}]}}]}]}}]},{TYPE:"txt",TOKENS:["vec3","ex","=","u_horizon_color",";","vec3","ey","=","u_zenith_color",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WO_SKYTEX"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec4","eA","=","GLSL_TEXTURE_CUBE","(","u_sky_texture",",","bq",")",";","bC","(","eA",".","rgb",")",";","vec3","ez","=","vec3","(","bp",".","xy",",","0.0",")",";","bs","=","eB","(","ex",",","ey",",","eA",",","ew",",","ez",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WO_SKYBLEND"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["bs","=","mix","(","ex",",","ey",",","ew",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["bs","=","ex",";"]}]}}]}]}}]}]}}]},{TYPE:"txt",TOKENS:["aW","(","bs",")",";","GLSL_OUT_FRAG_COLOR","=","vec4","(","bs",",","1.0",")",";","}"]}]},e["water.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"PRECISION",TOKENS:["highp"]},{TYPE:"var",NAME:"USE_FOG",TOKENS:["0"]},{TYPE:"var",NAME:"USE_TBN_SHADING",TOKENS:["0"]},{TYPE:"var",NAME:"DEBUG_WIREFRAME",TOKENS:["0"]},{TYPE:"var",NAME:"NUM_NORMALMAPS",TOKENS:["0"]},{TYPE:"var",NAME:"FOAM",TOKENS:["0"]},{TYPE:"var",NAME:"SHORE_PARAMS",TOKENS:["0"]},{TYPE:"var",NAME:"GENERATED_MESH",TOKENS:["0"]},{TYPE:"var",NAME:"ABSORB",TOKENS:["6.0"]},{TYPE:"var",NAME:"SSS_STRENGTH",TOKENS:["1.0"]},{TYPE:"var",NAME:"SSS_WIDTH",TOKENS:["0.45"]},{TYPE:"var",NAME:"ALPHA",TOKENS:["0"]},{TYPE:"var",NAME:"DISABLE_FOG",TOKENS:["0"]},{TYPE:"var",NAME:"NUM_LIGHTS",TOKENS:["0"]},{TYPE:"var",NAME:"WAVES_HEIGHT",TOKENS:["1.0"]},{TYPE:"var",NAME:"WATER_LEVEL",TOKENS:["0.0"]},{TYPE:"var",NAME:"PROCEDURAL_FOG",TOKENS:["0"]},{TYPE:"var",NAME:"SKY_TEXTURE",TOKENS:["0"]},{TYPE:"var",NAME:"USE_REFRACTION_CORRECTION",TOKENS:["0"]},{TYPE:"var",NAME:"SHORE_SMOOTHING",TOKENS:["0"]},{TYPE:"var",NAME:"DYNAMIC",TOKENS:["0"]},{TYPE:"var",NAME:"USE_ENVIRONMENT_LIGHT",TOKENS:["0"]},{TYPE:"var",NAME:"SKY_COLOR",TOKENS:["0"]},{TYPE:"var",NAME:"REFLECTION_TYPE",TOKENS:["REFL_NONE"]},{TYPE:"var",NAME:"WATER_EFFECTS",TOKENS:["0"]},{TYPE:"var",NAME:"REFRACTIVE",TOKENS:["0"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",FILE:"pack.glslf"},{TYPE:"include",FILE:"color_util.glslf"},{TYPE:"include",FILE:"math.glslv"},{TYPE:"define",NAME:"REFL_BUMP",TOKENS:["0.002"]},{TYPE:"txt",TOKENS:["uniform","float","u_time",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","samplerCube","u_sky_texture",";"]}]}},{TYPE:"elif",EXPRESSION:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec3","u_horizon_color",";","uniform","vec3","u_zenith_color",";"]}]}}]},{TYPE:"txt",TOKENS:["uniform","float","u_environment_energy",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_LIGHTS",0,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_light_positions","[","NUM_LIGHTS","]",";","uniform","vec3","u_light_directions","[","NUM_LIGHTS","]",";","uniform","vec4","u_light_color_intensities","[","NUM_LIGHTS","]",";"]}]}}]},{TYPE:"txt",TOKENS:["uniform","vec3","u_sun_intensity",";","uniform","vec3","u_sun_direction",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2},"SHORE_SMOOTHING","WATER_EFFECTS","DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_and_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","float","u_cam_water_depth",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_fog_color_density",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WATER_EFFECTS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_underwater_fog_color_density",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["PROCEDURAL_FOG"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat4","u_cube_fog",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_FOG"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_fog_params",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_NORMALMAPS",0,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_normalmap0",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFRACTIVE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_refractmap",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_plane_reflection",";"]}]}},{TYPE:"elif",EXPRESSION:["REFLECTION_TYPE","REFL_MIRRORMAP",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHORE_SMOOTHING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","PRECISION","sampler2D","u_scene_depth",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FOAM"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_foam",";"]}]}}]},{TYPE:"txt",TOKENS:["uniform","vec4","u_diffuse_color",";","uniform","vec2","u_diffuse_params",";","uniform","float","u_diffuse_intensity",";","uniform","float","u_ambient",";","uniform","vec2","u_fresnel_params",";","uniform","vec3","u_specular_color",";","uniform","vec3","u_specular_params",";","uniform","vec3","u_shallow_water_col",";","uniform","vec3","u_shore_water_col",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_NORMALMAPS",0,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","float","u_water_norm_uv_velocity",";","uniform","vec2","u_normalmap0_scale",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_NORMALMAPS",1,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec2","u_normalmap1_scale",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_NORMALMAPS",2,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec2","u_normalmap2_scale",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_NORMALMAPS",3,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec2","u_normalmap3_scale",";"]}]}}]}]}}]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_TYPE","REFL_MIRRORMAP",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","float","u_mirror_factor",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","float","u_reflect_factor",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHORE_SMOOTHING","DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","float","u_view_max_depth",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHORE_PARAMS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","float","u_water_shallow_col_fac",";","uniform","float","u_water_shore_col_fac",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FOAM"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","float","u_foam_factor",";","uniform","vec2","u_foam_uv_freq",";","uniform","vec2","u_foam_mag",";","uniform","vec2","u_foam_scale",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFRACTIVE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","float","u_refr_bump",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DEBUG_WIREFRAME"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["const","float","aE","=","1.0",";","uniform","vec3","u_wireframe_edge_color",";"]}]}}]},{TYPE:"txt",TOKENS:["GLSL_IN","vec3","bT",";","GLSL_IN","vec3","h",";","GLSL_IN","vec3","j",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_NORMALMAPS",0,{TYPE:"g_expr",PLACES:2},"FOAM",{TYPE:"logical_or_expr",PLACES:2},"GENERATED_MESH",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec2","A",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_NORMALMAPS",0,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","k",";","GLSL_IN","vec3","eF",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_NORMALMAPS",0,{TYPE:"g_expr",PLACES:2},"FOAM",{TYPE:"logical_or_expr",PLACES:2},"GENERATED_MESH","DYNAMIC",{TYPE:"logical_and_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","eG",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHORE_PARAMS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","eH",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2},"REFRACTIVE",{TYPE:"logical_or_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","l",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2},"REFRACTIVE","DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_or_expr",PLACES:4}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","float","m",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DEBUG_WIREFRAME"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","aD",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_TBN_SHADING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","B",";"]}]}}]},{TYPE:"txt",TOKENS:["GLSL_OUT","vec4","GLSL_OUT_FRAG_COLOR",";"]},{TYPE:"include",FILE:"environment.glslf"},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFRACTIVE","SHORE_SMOOTHING","USE_REFRACTION_CORRECTION",{TYPE:"logical_and_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"refraction.glslf"}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"fog.glslf"}]}}]},{TYPE:"txt",TOKENS:["vec3","eP","(","in","vec2","eI",",","in","vec3","U",",","in","vec3","eJ",",","in","vec3","eK",",","out","float","eL",",","in","float","eM",")","{","eL","=","0.0",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec2","eN","=","eI",".","xy","+","U",".","xy","*","REFL_BUMP","/","m",";","eL","=","u_reflect_factor",";","vec3","eO",";","if","(","u_cam_water_depth","<","0.0",")","{"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1},"WATER_EFFECTS",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["eO","=","u_underwater_fog_color_density",".","rgb",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["eO","=","u_diffuse_color",".","rgb",";"]}]}}]},{TYPE:"txt",TOKENS:["}","else","{","eO","=","GLSL_TEXTURE","(","u_plane_reflection",",","eN",")",".","rgb",";","bC","(","eO",")",";","}"]}]}},{TYPE:"elif",EXPRESSION:["REFLECTION_TYPE","REFL_MIRRORMAP",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["eL","=","u_mirror_factor",";","vec3","eO","=","eK","*","GLSL_TEXTURE_CUBE","(","u_mirrormap",",","eJ",")",".","rgb",";","bC","(","eO",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["eL","=","u_reflect_factor",";","vec3","eO","=","eK","*","vec3","(","0.3",",","0.5",",","1.0",")",";","bC","(","eO",")",";"]}]}}]},{TYPE:"txt",TOKENS:["eL","=","min","(","eL","*","eM",",","1.0",")",";","return","eO",";","}"]},{TYPE:"include",FILE:"lighting_nodes.glslf"},{TYPE:"txt",TOKENS:["void","main","(",")","{"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_NORMALMAPS",0,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["mat3","cb","=","mat3","(","k",",","eF",",","j",")",";"]}]}}]},{TYPE:"txt",TOKENS:["vec3","U","=","normalize","(","j",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC","FOAM",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WATER_EFFECTS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","bO","=","h",".","z","-","WATER_LEVEL",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","bO","=","h",".","z",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_NORMALMAPS",0,{TYPE:"g_expr",PLACES:2},"FOAM",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["GENERATED_MESH"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec2","b_","=","vec2","(","eG",".","x",",","-","eG",".","y",")","+","0.5",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec2","b_","=","vec2","(","h",".","x",",","-","h",".","y",")","+","0.5",";"]}]}}]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec2","b_","=","A",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_NORMALMAPS",0,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","eQ","=","vec3","(","0.0",")",";","eQ","+=","GLSL_TEXTURE","(","u_normalmap0",",","b_","*","u_normalmap0_scale","+","vec2","(","0.3",",","0.5",")","*","u_water_norm_uv_velocity","*","u_time",")",".","xyz","-","0.5",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_NORMALMAPS",1,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["eQ","+=","GLSL_TEXTURE","(","u_normalmap0",",","b_","*","u_normalmap1_scale","+","vec2","(","-","0.3",",","0.7",")","*","u_water_norm_uv_velocity","*","u_time",")",".","xyz","-","0.5",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_NORMALMAPS",2,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["eQ","+=","GLSL_TEXTURE","(","u_normalmap0",",","b_","*","u_normalmap2_scale","+","vec2","(","0.0",",","1.1",")","*","u_water_norm_uv_velocity","*","u_time",")",".","xyz","-","0.5",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_NORMALMAPS",3,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["eQ","+=","GLSL_TEXTURE","(","u_normalmap0",",","b_","*","u_normalmap3_scale","+","vec2","(","-","0.66",",","-","0.3",")","*","u_water_norm_uv_velocity","*","u_time",")",".","xyz","-","0.5",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_NORMALMAPS",0,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["U","=","mix","(","U",",","normalize","(","cb","*","eQ",")",",","0.3",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["U","=","mix","(","U",",","normalize","(","cb","*","eQ",")",",","0.5",")",";"]}]}}]},{TYPE:"txt",TOKENS:["U","=","normalize","(","U",")",";"]}]}}]},{TYPE:"txt",TOKENS:["vec3","D","=","normalize","(","bT",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2},"REFRACTIVE",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec2","eI","=","l",".","xy","/","l",".","z",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec2","eI","=","vec2","(","0.0",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFRACTIVE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec2","eR","=","eI","+","U",".","xy","*","u_refr_bump","/","m",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHORE_SMOOTHING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","L","=","u_diffuse_color",".","a",";","vec4","cP","=","GLSL_TEXTURE_PROJ","(","u_scene_depth",",","l",")",";","float","cR","=","cQ","(","cP",")",";","float","cS","=","max","(","cR","-","m",",","0.0",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFRACTIVE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","eT","=","eS","(","cR",",","eR",",","eI",")",";","float","eU","=","max","(","eT","-","m",",","0.0",")",";","float","eV","=","u_view_max_depth","/","ABSORB","*","eU",";","float","eW","=","min","(","L","*","eV",",","1.0",")",";","L","=","min","(","15.0","*","L","*","u_view_max_depth","*","cS",",","1.0",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","cT","=","u_view_max_depth","/","ABSORB","*","cS",";","if","(","u_cam_water_depth",">","0.0",")","L","=","min","(","L","*","cT",",","1.0",")",";"]}]}}]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","L","=","u_diffuse_color",".","a",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFRACTIVE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","eW","=","L",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFRACTIVE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["if","(","u_cam_water_depth","<","0.0",")","eW","=","0.0",";","vec3","eX","=","GLSL_TEXTURE","(","u_refractmap",",","eR",")",".","rgb",";","bC","(","eX",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHORE_PARAMS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","eY","=","pow","(","min","(","eH",".","b","/","u_water_shallow_col_fac",",","1.0",")",",","0.3",")",";","vec3","ct","=","mix","(","u_shallow_water_col",",","u_diffuse_color",".","rgb",",","eY",")",";","eY","=","pow","(","min","(","eH",".","b","/","u_water_shore_col_fac",",","1.0",")",",","0.3",")",";","ct","=","mix","(","u_shore_water_col",",","ct",",","eY",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","ct","=","u_diffuse_color",".","rgb",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FOAM"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHORE_SMOOTHING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","eZ","=","max","(","1.0","-","u_view_max_depth","*","cS",",","0.0",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","eZ","=","1.0","-","L",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","e_","=","max","(","bO","/","WAVES_HEIGHT","+","0.1",",","0.0",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHORE_PARAMS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","fa","=","normalize","(","vec3","(","eH",".","rg",",","0.0",")",")",";","vec3","fb","=","normalize","(","mix","(","UP_VECTOR",",","fa",",","0.8",")",")",";","float","fc","=","1.25","*","max","(","dot","(","U",",","fb",")","-","0.2",",","0.0",")",";","fc","+=","max","(","dot","(","U",",","-","UP_VECTOR",")",",","0.0",")",";","eZ","+=","fc","*","(","1.0","-","eH",".","b",")",";","e_","*=","(","1.0","-","0.95","*","pow","(","eH",".","b",",","0.1",")",")",";"]}]}}]},{TYPE:"txt",TOKENS:["eZ","+=","e_",";","eZ","=","min","(","u_foam_factor","*","eZ",",","1.0",")",";"]}]}}]},{TYPE:"txt",TOKENS:["vec4","fd","=","GLSL_TEXTURE","(","u_foam",",","u_foam_mag","*","sin","(","u_foam_uv_freq","*","u_time",")","+","b_","*","u_foam_scale",")",";"]}]}}]},{TYPE:"txt",TOKENS:["float","cG","=","u_specular_params","[","0","]",";","vec2","cH","=","vec2","(","u_specular_params","[","1","]",",","u_specular_params","[","2","]",")",";","vec3","cI","=","cG","*","u_specular_color",";","vec3","cA","=","u_environment_energy","*","cz","(","U",")",";","vec3","cB","=","u_ambient","*","cA",";","vec3","eK","=","cB","+","u_sun_intensity",";","float","eL",";","vec3","eJ","=","reflect","(","-","D",",","U",")",";","vec3","fe","=","normalize","(","eJ","+","D",")",";","float","ff","=","1.0","-","dot","(","D",",","fe",")",";","float","d_","=","u_fresnel_params","[","0","]",";","float","fg","=","u_fresnel_params","[","1","]",";","float","fh","=","fg","+","(","1.0","-","fg",")","*","pow","(","ff",",","d_",")",";","vec3","eO","=","eP","(","eI",",","U",",","eJ",",","eK",",","eL",",","fh",")",";","vec3","cy","=","u_diffuse_intensity","*","ct",";","vec3","aQ",";","vec3","cJ",";","cK","(","vec3","(","0.0",")",",","vec3","(","0.0",")",",","cy",",","cI",",","h",",","U",",","D",",","cH",",","u_diffuse_params",",","vec4","(","1.0",")",",","0.0",",","vec4","(","0.0",")",",","aQ",",","cJ",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","fi","=","max","(","dot","(","u_sun_direction",",","-","j",")","+","SSS_WIDTH",",","0.0",")","*","max","(","dot","(","-","D",",","u_sun_direction",")","-","0.5",",","0.0",")","*","max","(","0.0",",","length","(","u_sun_intensity",")","-","0.1",")",";","fi","=","clamp","(","SSS_STRENGTH","*","fi",",","0.0",",","1.0",")",";","aQ","=","mix","(","aQ",",","u_shallow_water_col",",","fi",")",";","aQ","=","mix","(","aQ",",","u_shore_water_col",",","fi",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFRACTIVE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["aQ","=","mix","(","eX",",","aQ",",","eW",")",";"]}]}}]},{TYPE:"txt",TOKENS:["aQ","=","mix","(","aQ",",","eO",",","eL",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FOAM"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","fj","=","mix","(","fd",".","g",",","fd",".","r",",","max","(","4.0","*","(","eZ","-","0.75",")",",","0.0",")",")",";","fj","=","mix","(","fd",".","b",",","fj",",","max","(","2.0","*","eZ","-","1.0",",","0.0",")",")",";","fj","=","mix","(","0.0",",","fj",",","eZ",")",";","aQ","=","mix","(","aQ",",","eK",",","fj",")",";"]}]}}]},{TYPE:"txt",TOKENS:["aQ","+=","cJ",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WATER_EFFECTS","DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","fk","=","m","*","u_view_max_depth",";","float","fl","=","1.0",";","if","(","u_cam_water_depth",">","1.0",")","fl","=","2.0",";","bR","(","aQ",",","fk",",","D",",","fl",")",";"]}]}}]},{TYPE:"txt",TOKENS:["aW","(","aQ",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFRACTIVE",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["L","=","max","(","L",",","cJ",".","r",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FOAM"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["L","+=","fj",";"]}]}}]}]}},{TYPE:"elif",EXPRESSION:["SHORE_SMOOTHING",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["L","=","1.0",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["ALPHA"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["aX","(","aQ",",","L",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DEBUG_WIREFRAME",1,{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["GLSL1"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"extension",TOKENS:["GL_OES_standard_derivatives",":","enable"]}]}}]},{TYPE:"txt",TOKENS:["vec3","aN","=","fwidth","(","aD",")",";","vec3","aO","=","smoothstep","(","vec3","(","0.0",")",",","aN","*","aE",",","aD",")",";","float","fm","=","min","(","min","(","aO",".","x",",","aO",".","y",")",",","aO",".","z",")",";","fm","=","clamp","(","fm",",","0.0",",","1.0",")",";","aQ","=","mix","(","u_wireframe_edge_color",",","aQ",",","fm",")",";","L","=","mix","(","1.0",",","L",",","fm",")",";"]}]}},{TYPE:"elif",EXPRESSION:["DEBUG_WIREFRAME",2,{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","aM","=","sign","(","aD","-","vec3","(","0.02","*","aE",")",")",";","float","fm","=","1.0",";","if","(","aM",".","x","<","0.0","||","aM",".","y","<","0.0","||","aM",".","z","<","0.0",")","fm","=","0.0",";","aQ","=","mix","(","u_wireframe_edge_color",",","aQ",",","fm",")",";","L","=","mix","(","1.0",",","L",",","fm",")",";"]}]}}]},{TYPE:"txt",TOKENS:["GLSL_OUT_FRAG_COLOR","=","vec4","(","aQ",",","L",")",";","}"]}]},e["water.glslv"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"PRECISION",TOKENS:["highp"]},{TYPE:"var",NAME:"USE_TBN_SHADING",TOKENS:["0"]},{TYPE:"var",NAME:"DEBUG_WIREFRAME",TOKENS:["0"]},{TYPE:"var",NAME:"NUM_NORMALMAPS",TOKENS:["0"]},{TYPE:"var",NAME:"FOAM",TOKENS:["0"]},{TYPE:"var",NAME:"SHORE_PARAMS",TOKENS:["0"]},{TYPE:"var",NAME:"MAX_SHORE_DIST",TOKENS:["100.0"]},{TYPE:"var",NAME:"SHORE_MAP_SIZE_X",TOKENS:["1.0"]},{TYPE:"var",NAME:"SHORE_MAP_SIZE_Y",TOKENS:["1.0"]},{TYPE:"var",NAME:"SHORE_MAP_CENTER_X",TOKENS:["0.0"]},{TYPE:"var",NAME:"SHORE_MAP_CENTER_Y",TOKENS:["0.0"]},{TYPE:"var",NAME:"GENERATED_MESH",TOKENS:["0"]},{TYPE:"var",NAME:"DST_NOISE_SCALE_0",TOKENS:["0.05"]},{TYPE:"var",NAME:"DST_NOISE_SCALE_1",TOKENS:["0.03"]},{TYPE:"var",NAME:"DST_NOISE_FREQ_0",TOKENS:["1.3"]},{TYPE:"var",NAME:"DST_NOISE_FREQ_1",TOKENS:["1.0"]},{TYPE:"var",NAME:"DIR_MIN_SHR_FAC",TOKENS:["0.4"]},{TYPE:"var",NAME:"DIR_FREQ",TOKENS:["0.5"]},{TYPE:"var",NAME:"DIR_NOISE_SCALE",TOKENS:["0.05"]},{TYPE:"var",NAME:"DIR_NOISE_FREQ",TOKENS:["0.07"]},{TYPE:"var",NAME:"DIR_MIN_NOISE_FAC",TOKENS:["0.5"]},{TYPE:"var",NAME:"DST_MIN_FAC",TOKENS:["0.2"]},{TYPE:"var",NAME:"WAVES_HOR_FAC",TOKENS:["5.0"]},{TYPE:"var",NAME:"DISABLE_FOG",TOKENS:["0"]},{TYPE:"var",NAME:"WAVES_HEIGHT",TOKENS:["1.0"]},{TYPE:"var",NAME:"WAVES_LENGTH",TOKENS:["10.0"]},{TYPE:"var",NAME:"WATER_LEVEL",TOKENS:["0.0"]},{TYPE:"var",NAME:"SHORE_SMOOTHING",TOKENS:["0"]},{TYPE:"var",NAME:"DYNAMIC",TOKENS:["0"]},{TYPE:"var",NAME:"REFLECTION_TYPE",TOKENS:["REFL_NONE"]},{TYPE:"var",NAME:"REFRACTIVE",TOKENS:["0"]},{TYPE:"var",NAME:"STATIC_BATCH",TOKENS:["0"]},{TYPE:"var",NAME:"WATER_EFFECTS",TOKENS:["0"]},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",FILE:"math.glslv"},{TYPE:"include",FILE:"to_world.glslv"},{TYPE:"include",FILE:"procedural.glslf"},{TYPE:"txt",TOKENS:["GLSL_IN","vec3","a_position",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["GENERATED_MESH",{TYPE:"logic_negative_expr",PLACES:1},"DYNAMIC",{TYPE:"logic_negative_expr",PLACES:1},"NUM_NORMALMAPS",0,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","a_tbn",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["GENERATED_MESH",{TYPE:"logic_negative_expr",PLACES:1},"NUM_NORMALMAPS",0,{TYPE:"g_expr",PLACES:2},"FOAM",{TYPE:"logical_or_expr",PLACES:2},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec2","a_texcoord",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DEBUG_WIREFRAME"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","float","a_polyindex",";"]}]}}]},{TYPE:"txt",TOKENS:["GLSL_OUT","vec3","bT",";","GLSL_OUT","vec3","h",";","GLSL_OUT","vec3","j",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_NORMALMAPS",0,{TYPE:"g_expr",PLACES:2},"FOAM",{TYPE:"logical_or_expr",PLACES:2},"GENERATED_MESH",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec2","A",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_NORMALMAPS",0,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec3","k",";","GLSL_OUT","vec3","eF",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_NORMALMAPS",0,{TYPE:"g_expr",PLACES:2},"FOAM",{TYPE:"logical_or_expr",PLACES:2},"GENERATED_MESH","DYNAMIC",{TYPE:"logical_and_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec3","eG",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHORE_PARAMS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec3","eH",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2},"REFRACTIVE",{TYPE:"logical_or_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec3","l",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2},"REFRACTIVE","DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_or_expr",PLACES:4}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","float","m",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DEBUG_WIREFRAME"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec3","aD",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_TBN_SHADING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec3","B",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["STATIC_BATCH"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["const","mat3","u_model_tsr","=","mat3","(","0.0",",","0.0",",","0.0",",","1.0",",","0.0",",","0.0",",","0.0",",","1.0",",","0.0",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat3","u_model_tsr",";"]}]}}]},{TYPE:"txt",TOKENS:["uniform","mat3","u_view_tsr",";","uniform","mat4","u_proj_matrix",";","uniform","vec3","u_camera_eye",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","PRECISION","float","u_time",";","uniform","vec3","u_wind",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2},"REFRACTIVE","DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_or_expr",PLACES:4}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHORE_PARAMS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_shore_dist_map",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHORE_PARAMS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","ft","(","in","vec2","fn",")","{","vec2","fo","=","0.5","+","vec2","(","(","fn",".","x","-","SHORE_MAP_CENTER_X",")","/","SHORE_MAP_SIZE_X",",","(","fn",".","y","-","SHORE_MAP_CENTER_Y",")","/","SHORE_MAP_SIZE_Y",")",";","vec4","fp","=","GLSL_TEXTURE","(","u_shore_dist_map",",","fo",")",";","const","vec2","fq","=","vec2","(","1.0","/","255.0",",","1.0",")",";","float","fr","=","dot","(","fp",".","ba",",","fq",")",";","vec2","fs","=","normalize","(","fp",".","rg","*","2.0","-","1.0",")",";","return","vec3","(","fs",",","fr",")",";","}"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"SMALL_WAVES_FAC",TOKENS:["0.2"]},{TYPE:"txt",TOKENS:["void","fI","(","inout","vec3","fn",",","in","float","fu",",","in","vec3","fp",")","{","float","fw","=","fv","(","DST_NOISE_SCALE_0","*","(","fn",".","xy","+","DST_NOISE_FREQ_0","*","fu",")",")","*","fv","(","DST_NOISE_SCALE_1","*","(","fn",".","yx","-","DST_NOISE_FREQ_1","*","fu",")",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHORE_PARAMS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","fx","=","WAVES_LENGTH","/","MAX_SHORE_DIST","/","M_PI",";","float","fr","=","fp",".","b",";","float","fy","=","sqrt","(","fr",")",";","float","fz","=","max","(","fr",",","DIR_MIN_SHR_FAC",")","*","sin","(","fy","/","fx","+","DIR_FREQ","*","fu",")",";","float","fA","=","max","(","fv","(","DIR_NOISE_SCALE","*","(","fn",".","xy","+","DIR_NOISE_FREQ","*","fu",")",")",",","DIR_MIN_NOISE_FAC",")",";","fz","*=","fA",";","float","fB","=","WAVES_HEIGHT","*","mix","(","fz",",","fw",",","max","(","fy",",","DST_MIN_FAC",")",")",";","vec2","fs","=","fp",".","rg",";","float","fC","=","WAVES_HOR_FAC","*","fz","*","max","(","MAX_SHORE_DIST","/","35.0","*","(","0.05","-","fr",")",",","0.0",")",";","vec2","fD","=","fC","*","fs",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","fB","=","WAVES_HEIGHT","*","fw",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["GENERATED_MESH"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec2","fE","=","1.0","*","(","fn",".","xy","-","0.3","*","fu",")",";","vec2","fF","=","0.7","*","(","fn",".","yx","+","0.07","*","fu",")",";","float","fH","=","fG","(","fE",")",".","x","+","fG","(","fF",")",".","x","-","1.0",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHORE_PARAMS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["fn",".","xy","+=","fD",";","fH","*=","fr",";"]}]}}]},{TYPE:"txt",TOKENS:["fB","+=","SMALL_WAVES_FAC","*","fH",";"]}]}}]},{TYPE:"txt",TOKENS:["fn",".","z","+=","fB",";","}"]}]}}]},{TYPE:"txt",TOKENS:["void","main","(",")","{"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DEBUG_WIREFRAME"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["if","(","a_polyindex","==","0.0",")","aD","=","vec3","(","1.0",",","0.0",",","0.0",")",";","else","if","(","a_polyindex","==","1.0",")","aD","=","vec3","(","0.0",",","0.0",",","1.0",")",";","else","aD","=","vec3","(","0.0",",","1.0",",","0.0",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["GENERATED_MESH"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","O","=","a_position",";","float","fJ","=","abs","(","O",".","z",")",";","vec2","fK","=","u_camera_eye",".","xy","-","mod","(","u_camera_eye",".","xy",",","fJ",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WATER_EFFECTS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["O",".","z","=","WATER_LEVEL",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["O",".","z","=","0.0",";"]}]}}]},{TYPE:"txt",TOKENS:["O",".","xy","+=","fK",";","vec3","bX","=","O",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_NORMALMAPS",0,{TYPE:"g_expr",PLACES:2},"FOAM",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["A","=","a_texcoord",";"]}]}}]},{TYPE:"txt",TOKENS:["au","aw","=","av","(","a_position",",","vec3","(","0.0",")",",","vec3","(","0.0",")",",","vec3","(","0.0",")",",","vec3","(","0.0",")",",","vec3","(","0.0",")",",","u_model_tsr",")",";","vec3","bX","=","aw",".","O",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHORE_PARAMS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["eH","=","ft","(","bX",".","xy",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","fL","=","length","(","u_wind",")",";","if","(","fL","==","0.0",")","fL","=","1.0",";","float","fM","=","u_time",";","fM","*=","fL",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["GENERATED_MESH"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","fN","=","fJ",";","vec3","fO","=","bX","+","vec3","(","fN",",","0.0",",","0.0",")",";","vec3","fP","=","bX","+","vec3","(","0.0",",","fN",",","0.0",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_NORMALMAPS",0,{TYPE:"g_expr",PLACES:2},"FOAM",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["eG","=","bX",";"]}]}}]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","fO","=","bX","+","vec3","(","0.05",",","0.0",",","0.0",")",";","vec3","fP","=","bX","+","vec3","(","0.0",",","0.05",",","0.0",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHORE_PARAMS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","fQ","=","ft","(","fO",".","xy",")",";","vec3","fR","=","ft","(","fP",".","xy",")",";","fI","(","fO",",","fM",",","fQ",")",";","fI","(","fP",",","fM",",","fR",")",";","fI","(","bX",",","fM",",","eH",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["fI","(","fO",",","fM",",","vec3","(","0.0",")",")",";","fI","(","fP",",","fM",",","vec3","(","0.0",")",")",";","fI","(","bX",",","fM",",","vec3","(","0.0",")",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["GENERATED_MESH","WATER_EFFECTS",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["if","(","a_position",".","z","<","0.0",")","{","bX",".","z","=","WATER_LEVEL","-","1.0",";","fO",".","z","=","bX",".","z",";","fP",".","z","=","bX",".","z",";","}"]}]}}]},{TYPE:"txt",TOKENS:["vec3","eg","=","normalize","(","fO","-","bX",")",";","vec3","V","=","normalize","(","fP","-","bX",")",";","j","=","normalize","(","cross","(","eg",",","V",")",")",";","float","fS","=","dot","(","j",",","UP_VECTOR",")",";","float","aL","=","clamp","(","0.8","-","fS",",","0.0",",","1.0",")",";","j","=","mix","(","j",",","UP_VECTOR",",","aL",")",";"]}]}},{TYPE:"elif",EXPRESSION:["GENERATED_MESH",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec4","S","=","R","(","a_tbn",")",";","j","=","T","(","S",",","vec3","(","0.0",",","1.0",",","0.0",")",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["j","=","vec3","(","0.0",",","0.0",",","1.0",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_NORMALMAPS",0,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["GENERATED_MESH",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","V","=","T","(","S",",","vec3","(","1.0",",","0.0",",","0.0",")",")",";"]}]}},{TYPE:"elif",EXPRESSION:["DYNAMIC",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","V","=","vec3","(","1.0",",","0.0",",","0.0",")",";"]}]}}]}]}}]},{TYPE:"txt",TOKENS:["k","=","V",";","eF","=","cross","(","j",",","k",")",";"]}]}}]},{TYPE:"txt",TOKENS:["h","=","bX",";","bT","=","u_camera_eye","-","bX",";","vec4","bY","=","vec4","(","ap","(","u_view_tsr",",","bX",")",",","1.0",")",";","vec4","f","=","u_proj_matrix","*","bY",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2},"REFRACTIVE",{TYPE:"logical_or_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","fT","=","f",".","x",";","float","fU","=","f",".","y",";","float","fV","=","f",".","w",";","l",".","x","=","(","fT","+","fV",")","/","2.0",";","l",".","y","=","(","fU","+","fV",")","/","2.0",";","l",".","z","=","fV",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2},"REFRACTIVE","DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_or_expr",PLACES:4}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["m","=","-","bY",".","z","/","u_view_max_depth",";"]}]}}]},{TYPE:"txt",TOKENS:["gl_Position","=","f",";","}"]}]},e["postprocessing/antialiasing.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"AA_METHOD",TOKENS:["AA_METHOD_FXAA_LIGHT"]},{TYPE:"var",NAME:"AA_QUALITY",TOKENS:["AA_QUALITY_LOW"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",FILE:"color_util.glslf"},{TYPE:"txt",TOKENS:["uniform","sampler2D","u_color",";","uniform","vec2","u_texel_size",";","GLSL_IN","vec2","A",";","GLSL_OUT","vec4","GLSL_OUT_FRAG_COLOR",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["AA_METHOD","AA_METHOD_FXAA_LIGHT",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_REDUCE_MIN",TOKENS:["(","1.0","/","128.0",")"]},{TYPE:"define",NAME:"FXAA_REDUCE_MUL",TOKENS:["(","1.0","/","8.0",")"]},{TYPE:"define",NAME:"FXAA_SPAN_MAX",TOKENS:["8.0"]},{TYPE:"txt",TOKENS:["vec4","fX","(","float","x",",","float","y",")","{","vec2","fW","=","A","+","vec2","(","x",",","y",")","*","u_texel_size",";","return","GLSL_TEXTURE","(","u_color",",","fW",")",";","}","vec4","gt","(",")","{","vec4","fY","=","fX","(","-","1.0",",","-","1.0",")",";","vec4","fZ","=","fX","(","1.0",",","-","1.0",")",";","vec4","f_","=","fX","(","-","1.0",",","1.0",")",";","vec4","gc","=","fX","(","1.0",",","1.0",")",";","vec4","gd","=","fX","(","0.0",",","0.0",")",";","float","gf","=","ge","(","gd",")",";","float","gh","=","ge","(","fY",")",";","float","gi","=","ge","(","fZ",")",";","float","gj","=","ge","(","f_",")",";","float","gk","=","ge","(","gc",")",";","float","gl","=","min","(","gf",",","min","(","min","(","gh",",","gi",")",",","min","(","gj",",","gk",")",")",")",";","float","gm","=","max","(","gf",",","max","(","max","(","gh",",","gi",")",",","max","(","gj",",","gk",")",")",")",";","vec2","bD",";","bD",".","x","=","-","(","(","gh","+","gi",")","-","(","gj","+","gk",")",")",";","bD",".","y","=","(","(","gh","+","gj",")","-","(","gi","+","gk",")",")",";","float","gn","=","max","(","(","gh","+","gi","+","gj","+","gk",")","*","(","0.25","*","FXAA_REDUCE_MUL",")",",","FXAA_REDUCE_MIN",")",";","float","go","=","1.0","/","(","min","(","abs","(","bD",".","x",")",",","abs","(","bD",".","y",")",")","+","gn",")",";","bD","=","min","(","vec2","(","FXAA_SPAN_MAX",",","FXAA_SPAN_MAX",")",",","max","(","vec2","(","-","FXAA_SPAN_MAX",",","-","FXAA_SPAN_MAX",")",",","bD","*","go",")",")","*","u_texel_size",";","vec4","gp","=","0.5","*","(","GLSL_TEXTURE","(","u_color",",","A","+","bD","*","(","1.0","/","3.0","-","0.5",")",")","+","GLSL_TEXTURE","(","u_color",",","A","+","bD","*","(","2.0","/","3.0","-","0.5",")",")",")",";","vec4","gq","=","gp","*","0.5","+","0.25","*","(","GLSL_TEXTURE","(","u_color",",","A","+","bD","*","-","0.5",")","+","GLSL_TEXTURE","(","u_color",",","A","+","bD","*","0.5",")",")",";","float","gs","=","ge","(","gq",")",";","if","(","(","gs","<","gl",")","||","(","gs",">","gm",")",")","return","gp",";","else","return","gq",";","}"]}]}},{TYPE:"elif",EXPRESSION:["AA_METHOD","AA_METHOD_FXAA_QUALITY",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_GREEN_AS_LUMA",TOKENS:["1"]},{TYPE:"include",FILE:"fxaa.glslf"},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["AA_QUALITY","AA_QUALITY_HIGH",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_QUALITY_PRESET",TOKENS:["39"]},{TYPE:"define",NAME:"FXAA_QUALITY_SUBPIX",TOKENS:["1.00"]},{TYPE:"define",NAME:"FXAA_QUALITY_EDGE_THRESHOLD",TOKENS:["0.063"]},{TYPE:"define",NAME:"FXAA_QUALITY_EDGE_THRESHOLD_MIN",TOKENS:["0.0312"]}]}},{TYPE:"elif",EXPRESSION:["AA_QUALITY","AA_QUALITY_MEDIUM",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_QUALITY_PRESET",TOKENS:["20"]},{TYPE:"define",NAME:"FXAA_QUALITY_SUBPIX",TOKENS:["0.65"]},{TYPE:"define",NAME:"FXAA_QUALITY_EDGE_THRESHOLD",TOKENS:["0.166"]},{TYPE:"define",NAME:"FXAA_QUALITY_EDGE_THRESHOLD_MIN",TOKENS:["0.0625"]}]}},{TYPE:"elif",EXPRESSION:["AA_QUALITY","AA_QUALITY_LOW",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_QUALITY_PRESET",TOKENS:["12"]},{TYPE:"define",NAME:"FXAA_QUALITY_SUBPIX",TOKENS:["0.50"]},{TYPE:"define",NAME:"FXAA_QUALITY_EDGE_THRESHOLD",TOKENS:["0.166"]},{TYPE:"define",NAME:"FXAA_QUALITY_EDGE_THRESHOLD_MIN",TOKENS:["0.0833"]}]}}]}]}}]},{TYPE:"txt",TOKENS:["void","main","(",")","{"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["AA_METHOD","AA_METHOD_FXAA_LIGHT",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT_FRAG_COLOR","=","gt","(",")",";"]}]}},{TYPE:"elif",EXPRESSION:["AA_METHOD","AA_METHOD_FXAA_QUALITY",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec2","gu","=","u_texel_size",";","GLSL_OUT_FRAG_COLOR","=","gv","(","A",",","u_color",",","gu",",","FXAA_QUALITY_SUBPIX",",","FXAA_QUALITY_EDGE_THRESHOLD",",","FXAA_QUALITY_EDGE_THRESHOLD_MIN",")",";"]}]}}]},{TYPE:"txt",TOKENS:["}"]}]},e["postprocessing/bloom_combine.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"var",NAME:"BLUR_PASS_NUM",TOKENS:["BLUR_PASS_5"]},{TYPE:"txt",TOKENS:["uniform","sampler2D","u_main",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["BLUR_PASS_NUM","BLUR_PASS_1",{TYPE:"ge_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_bloom_level_0",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["BLUR_PASS_NUM","BLUR_PASS_2",{TYPE:"ge_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_bloom_level_1",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["BLUR_PASS_NUM","BLUR_PASS_3",{TYPE:"ge_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_bloom_level_2",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["BLUR_PASS_NUM","BLUR_PASS_4",{TYPE:"ge_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_bloom_level_3",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["BLUR_PASS_NUM","BLUR_PASS_5",{TYPE:"ge_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_bloom_level_4",";"]}]}}]},{TYPE:"txt",TOKENS:["GLSL_IN","vec2","A",";","GLSL_OUT","vec4","GLSL_OUT_FRAG_COLOR",";","void","main","(",")","{","vec4","gw","=","GLSL_TEXTURE","(","u_main",",","A",")",";","vec4","gx","=","vec4","(","0.0",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["BLUR_PASS_NUM","BLUR_PASS_1",{TYPE:"ge_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["gx","+=","GLSL_TEXTURE","(","u_bloom_level_0",",","A",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["BLUR_PASS_NUM","BLUR_PASS_2",{TYPE:"ge_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["gx","+=","GLSL_TEXTURE","(","u_bloom_level_1",",","A",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["BLUR_PASS_NUM","BLUR_PASS_3",{TYPE:"ge_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["gx","+=","GLSL_TEXTURE","(","u_bloom_level_2",",","A",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["BLUR_PASS_NUM","BLUR_PASS_4",{TYPE:"ge_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["gx","+=","GLSL_TEXTURE","(","u_bloom_level_3",",","A",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["BLUR_PASS_NUM","BLUR_PASS_5",{TYPE:"ge_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["gx","+=","GLSL_TEXTURE","(","u_bloom_level_4",",","A",")",";"]}]}}]},{TYPE:"txt",TOKENS:["GLSL_OUT_FRAG_COLOR","=","gw","+","gx",";","}"]}]},e["postprocessing/coc.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"PRECISION",TOKENS:["highp"]},{TYPE:"var",NAME:"COC_TYPE",TOKENS:["COC_ALL"]},{TYPE:"txt",TOKENS:["precision","PRECISION","sampler2D",";"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",FILE:"depth_fetch.glslf"},{TYPE:"txt",TOKENS:["uniform","sampler2D","u_color",";","uniform","sampler2D","u_depth",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["COC_TYPE","COC_COMBINE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_coc_fg",";"]}]}}]},{TYPE:"txt",TOKENS:["uniform","float","u_view_max_depth",";","uniform","float","u_dof_dist",";","uniform","float","u_dof_front_start",";","uniform","float","u_dof_front_end",";","uniform","float","u_dof_rear_start",";","uniform","float","u_dof_rear_end",";","uniform","vec2","u_camera_range",";","GLSL_IN","vec2","A",";","GLSL_OUT","vec4","GLSL_OUT_FRAG_COLOR",";","void","main","(",")","{","vec4","aQ","=","GLSL_TEXTURE","(","u_color",",","A",")",";","if","(","u_dof_dist",">","0.0",")","{","float","eq","=","gy","(","u_depth",",","A",",","u_camera_range",")",";","eq","*=","u_view_max_depth",";","float","gz","=","0.0",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["COC_TYPE","COC_COMBINE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec4","gA","=","GLSL_TEXTURE","(","u_coc_fg",",","A",")",";","float","gB","=","gA",".","a",";"]}]}}]},{TYPE:"txt",TOKENS:["if","(","eq","<","u_dof_dist",")","gz","=","(","u_dof_dist","-","eq","-","u_dof_front_start",")","/","(","u_dof_front_end","-","u_dof_front_start",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["COC_TYPE","COC_FOREGROUND",{TYPE:"non_equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["else","gz","=","(","eq","-","u_dof_dist","-","u_dof_rear_start",")","/","(","u_dof_rear_end","-","u_dof_rear_start",")",";"]}]}}]},{TYPE:"txt",TOKENS:["gz","=","clamp","(","gz",",","0.0",",","1.0",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["COC_TYPE","COC_COMBINE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["gz","=","max","(","gz",",","gB",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["COC_TYPE","COC_FOREGROUND",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT_FRAG_COLOR","=","vec4","(","gz",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT_FRAG_COLOR","=","vec4","(","aQ",".","xyz","*","gz",",","gz",")",";"]}]}}]},{TYPE:"txt",TOKENS:["}","else","GLSL_OUT_FRAG_COLOR","=","vec4","(","aQ",".","xyz",",","0.0",")",";","}"]}]},e["postprocessing/compositing.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",FILE:"color_util.glslf"},{TYPE:"txt",TOKENS:["uniform","sampler2D","u_color",";","uniform","float","u_brightness",";","uniform","float","u_contrast",";","uniform","float","u_exposure",";","uniform","float","u_saturation",";","GLSL_IN","vec2","A",";","GLSL_OUT","vec4","GLSL_OUT_FRAG_COLOR",";","void","main","(",")","{","vec4","gC","=","GLSL_TEXTURE","(","u_color",",","A",")",";","vec3","aQ","=","gC",".","rgb",";","if","(","u_brightness","<","0.0",")","aQ","=","aQ","*","(","1.0","+","u_brightness",")",";","else","aQ","=","aQ","+","(","(","1.0","-","aQ",")","*","u_brightness",")",";","aQ","=","(","aQ","-","0.5",")","*","(","tan","(","(","u_contrast","+","1.0",")","*","M_PI_4",")",")","+","0.5",";","aQ","*=","u_exposure",";","float","ds","=","ge","(","vec4","(","aQ",",","0.0",")",")",";","aQ","=","mix","(","vec3","(","ds",")",",","aQ",",","u_saturation",")",";","GLSL_OUT_FRAG_COLOR","=","vec4","(","aQ",",","gC",".","a",")",";","}"]}]},e["postprocessing/depth_pack.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"PRECISION",TOKENS:["highp"]},{TYPE:"txt",TOKENS:["precision","PRECISION","sampler2D",";"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",FILE:"pack.glslf"},{TYPE:"include",FILE:"depth_fetch.glslf"},{TYPE:"txt",TOKENS:["uniform","sampler2D","u_depth",";","uniform","vec2","u_camera_range",";","GLSL_IN","vec2","A",";","GLSL_OUT","vec4","GLSL_OUT_FRAG_COLOR",";","void","main","(",")","{","GLSL_OUT_FRAG_COLOR","=","er","(","clamp","(","gy","(","u_depth",",","A",",","u_camera_range",")",",","0.0",",","0.999999",")",")",";","}"]}]},e["postprocessing/dof.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"PRECISION",TOKENS:["highp"]},{TYPE:"var",NAME:"DOF_TYPE",TOKENS:["DOF_SIMPLE"]},{TYPE:"txt",TOKENS:["precision","PRECISION","sampler2D",";"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DOF_TYPE","DOF_BOKEH",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","highp","sampler2D","u_sharp",";","uniform","highp","sampler2D","u_blurred1",";","uniform","highp","sampler2D","u_blurred2",";","uniform","float","u_dof_dist",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"depth_fetch.glslf"},{TYPE:"txt",TOKENS:["uniform","sampler2D","u_sharp",";","uniform","sampler2D","u_blurred",";","uniform","sampler2D","u_depth",";","uniform","float","u_view_max_depth",";","uniform","float","u_dof_dist",";","uniform","float","u_dof_front_end",";","uniform","float","u_dof_rear_end",";","uniform","vec2","u_camera_range",";"]}]}}]},{TYPE:"txt",TOKENS:["GLSL_IN","vec2","A",";","GLSL_OUT","vec4","GLSL_OUT_FRAG_COLOR",";","void","main","(",")","{","vec4","gD","=","GLSL_TEXTURE","(","u_sharp",",","A",")",";","if","(","u_dof_dist",">","0.0",")","{"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DOF_TYPE","DOF_BOKEH",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","gz",";","vec4","gE","=","GLSL_TEXTURE","(","u_blurred1",",","A",")",";","vec4","gF","=","GLSL_TEXTURE","(","u_blurred2",",","A",")",";","vec4","gG","=","min","(","gE",".","rgba",",","gF",".","rgba",")",";","gz","=","gG",".","a",";","if","(","gz",">","0.0",")","{","gG","=","vec4","(","gG",".","rgb","/","gz",",","gD",".","a",")",";","GLSL_OUT_FRAG_COLOR","=","mix","(","gD",",","gG",",","min","(","gz","*","5.0",",","1.0",")",")",";","}","else","GLSL_OUT_FRAG_COLOR","=","gD",";"]}]}},{TYPE:"elif",EXPRESSION:["DOF_TYPE","DOF_SIMPLE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","eq","=","gy","(","u_depth",",","A",",","u_camera_range",")",";","eq","*=","u_view_max_depth",";","float","gH",";","if","(","eq","<","u_dof_dist",")","gH","=","(","u_dof_dist","-","eq",")","/","u_dof_front_end",";","else","gH","=","(","eq","-","u_dof_dist",")","/","u_dof_rear_end",";","gH","=","clamp","(","gH",",","0.0",",","1.0",")",";","vec4","gI","=","GLSL_TEXTURE","(","u_blurred",",","A",")",";","GLSL_OUT_FRAG_COLOR","=","mix","(","gD",",","gI",",","gH",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT_FRAG_COLOR","=","gD",";"]}]}}]},{TYPE:"txt",TOKENS:["}","else","GLSL_OUT_FRAG_COLOR","=","gD",";","}"]}]},e["postprocessing/glow.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"txt",TOKENS:["uniform","sampler2D","u_src_color",";","uniform","sampler2D","u_glow_mask_small",";","uniform","sampler2D","u_glow_mask_large",";","uniform","float","u_glow_mask_small_coeff",";","uniform","float","u_glow_mask_large_coeff",";","GLSL_IN","vec2","A",";","GLSL_OUT","vec4","GLSL_OUT_FRAG_COLOR",";","void","main","(",")","{","vec4","gJ","=","GLSL_TEXTURE","(","u_src_color",",","A",")",";","vec4","gK","=","GLSL_TEXTURE","(","u_glow_mask_small",",","A",")",";","vec4","gL","=","GLSL_TEXTURE","(","u_glow_mask_large",",","A",")",";","GLSL_OUT_FRAG_COLOR","=","gJ",";","if","(","gL",".","a","!=","0.0",")","{","float","gM","=","u_glow_mask_large_coeff","*","gL",".","a",";","gM","=","clamp","(","gM",",","0.0",",","1.0",")",";","GLSL_OUT_FRAG_COLOR",".","rgb","=","mix","(","GLSL_OUT_FRAG_COLOR",".","rgb",",","gL",".","rgb","/","gL",".","a",",","gM",")",";","GLSL_OUT_FRAG_COLOR",".","a","=","mix","(","GLSL_OUT_FRAG_COLOR",".","a",",","1.0",",","gM",")",";","}","if","(","gK",".","a","!=","0.0",")","{","float","gN","=","u_glow_mask_small_coeff","*","gK",".","a",";","gN","=","clamp","(","gN",",","0.0",",","1.0",")",";","GLSL_OUT_FRAG_COLOR",".","rgb","=","mix","(","GLSL_OUT_FRAG_COLOR",".","rgb",",","gK",".","rgb","/","gK",".","a",",","gN",")",";","GLSL_OUT_FRAG_COLOR",".","a","=","mix","(","GLSL_OUT_FRAG_COLOR",".","a",",","1.0",",","gN",")",";","}","}"]}]},e["postprocessing/god_rays.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"PRECISION",TOKENS:["highp"]},{TYPE:"var",NAME:"DEPTH_RGBA",TOKENS:["0"]},{TYPE:"var",NAME:"WATER_EFFECTS",TOKENS:["0"]},{TYPE:"var",NAME:"STEPS_PER_PASS",TOKENS:["10.0"]},{TYPE:"txt",TOKENS:["precision","PRECISION","sampler2D",";"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",FILE:"depth_fetch.glslf"},{TYPE:"include",FILE:"procedural.glslf"},{TYPE:"include",FILE:"pack.glslf"},{TYPE:"txt",TOKENS:["uniform","float","u_time",";","uniform","float","u_radial_blur_step",";","uniform","sampler2D","u_input",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DEPTH_RGBA"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec2","u_camera_range",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DEPTH_RGBA","WATER_EFFECTS",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","float","gO",";","GLSL_IN","vec2","gP",";"]}]}}]},{TYPE:"txt",TOKENS:["GLSL_IN","vec2","A",";","GLSL_IN","vec4","gQ",";","GLSL_OUT","vec4","GLSL_OUT_FRAG_COLOR",";","void","main","(",")","{","vec2","cS","=","(","gQ",".","xy","-","A",")",";","float","aM","=","length","(","cS",")",";","vec2","gR","=","u_radial_blur_step","*","cS","/","aM",";","float","gS","=","aM","/","u_radial_blur_step",";","gR","*=","min","(","gS",",","STEPS_PER_PASS",")","/","STEPS_PER_PASS",";","gS","=","max","(","gS",",","STEPS_PER_PASS",")",";","vec2","gT","=","A",";","float","gU","=","0.0",";","const","int","gV","=","int","(","STEPS_PER_PASS",")",";","int","gW","=","int","(","gS","+","0.5",")",";","for","(","int","cl","=","0",";","cl","<","gV",";","cl","+=","1",")","{","if","(","cl","<=","gW",")","{"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DEPTH_RGBA"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","eq","=","gy","(","u_input",",","gT",",","u_camera_range",")",";","gU","+=","max","(","(","1.0","-","pow","(","aM",",","0.3",")",")","*","step","(","0.9",",","eq",")",",","0.0",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec4","gX","=","GLSL_TEXTURE","(","u_input",",","gT",")",";","gU","+=","cQ","(","gX",")",";"]}]}}]},{TYPE:"txt",TOKENS:["}","gT","+=","gR",";","}"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DEPTH_RGBA","WATER_EFFECTS",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec2","b_","=","A","+","gP",";","float","gY","=","fG","(","vec2","(","2.5","*","(","b_",".","x",")",",","2.5","*","(","b_",".","y",")","+","1.0","*","u_time",")",")",".","x","+","0.75","*","fG","(","vec2","(","5.0","*","(","b_",".","x",")","-","0.66","*","u_time",",","5.0","*","(","b_",".","y",")","+","0.66","*","u_time",")",")",".","x","+","0.5","*","fv","(","vec2","(","7.5","*","(","b_",".","x",")","+","0.33","*","u_time",",","7.5","*","(","b_",".","y",")","-","0.33","*","u_time",")",")",";","gY","*=","clamp","(","1.2","-","sqrt","(","0.2","*","aM",")",",","0.0",",","1.0",")","*","gO",";","gU","=","max","(","gY",",","gU",")",";"]}]}}]},{TYPE:"txt",TOKENS:["GLSL_OUT_FRAG_COLOR","=","er","(","gU","/","STEPS_PER_PASS",")",";","}"]}]},e["postprocessing/god_rays.glslv"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"DEPTH_RGBA",TOKENS:["0"]},{TYPE:"var",NAME:"WATER_EFFECTS",TOKENS:["0"]},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",FILE:"math.glslv"},{TYPE:"txt",TOKENS:["uniform","mat4","u_view_proj_matrix",";","uniform","vec3","u_sun_direction",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DEPTH_RGBA","WATER_EFFECTS",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_camera_quat",";","uniform","float","u_cam_water_depth",";"]}]}}]},{TYPE:"txt",TOKENS:["GLSL_IN","vec2","a_bb_vertex",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DEPTH_RGBA","WATER_EFFECTS",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","float","gO",";","GLSL_OUT","vec2","gP",";"]}]}}]},{TYPE:"txt",TOKENS:["GLSL_OUT","vec2","A",";","GLSL_OUT","vec4","gQ",";","void","main","(",")","{","A","=","a_bb_vertex",";","vec3","bD","=","normalize","(","u_sun_direction",")",";","gQ","=","u_view_proj_matrix","*","vec4","(","bD",",","0.0",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DEPTH_RGBA","WATER_EFFECTS",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["if","(","u_cam_water_depth","<","0.0",")","{","gO","=","1.0",";","vec3","gZ","=","vec3","(","0.0",",","1.0",",","0.0",")",";","vec3","g_","=","T","(","u_camera_quat",",","gZ",")",";","g_","=","normalize","(","g_",")",";","float","ha","=","dot","(","g_",",","vec3","(","0.0",",","1.0",",","0.0",")",")",";","float","hb","=","atan","(","g_",".","x",",","g_",".","z",")",";","gP","=","vec2","(","-","hb",",","acos","(","ha",")",")",";","}","else","{","gO","=","0.0",";","}"]}]}}]},{TYPE:"txt",TOKENS:["gQ",".","xy","=","0.5","*","(","gQ",".","xy","/","gQ",".","w","+","1.0",")",";","gQ","+=","99999.0","*","step","(","gQ",".","z",",","0.0",")",";","gl_Position","=","vec4","(","2.0","*","a_bb_vertex",".","xy","-","1.0",",","0.0",",","1.0",")",";","}"]}]},e["postprocessing/god_rays_combine.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"SAFARI_CANVAS_ALPHA_HACK",TOKENS:["0"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",FILE:"color_util.glslf"},{TYPE:"include",FILE:"pack.glslf"},{TYPE:"txt",TOKENS:["uniform","sampler2D","u_main",";","uniform","sampler2D","u_god_rays",";","uniform","float","u_god_rays_intensity",";","uniform","vec3","u_sun_intensity",";","GLSL_IN","vec2","A",";","GLSL_OUT","vec4","GLSL_OUT_FRAG_COLOR",";","void","main","(",")","{","vec4","hc","=","GLSL_TEXTURE","(","u_main",",","A",")",";","vec3","hd","=","clamp","(","u_sun_intensity",",","0.4",",","0.8",")",";","bC","(","hc",".","rgb",")",";","float","he","=","cQ","(","GLSL_TEXTURE","(","u_god_rays",",","A",")",")",";","vec3","hf","=","hc",".","rgb","+","u_god_rays_intensity","*","vec3","(","he",")","*","hd",";","aW","(","hf",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SAFARI_CANVAS_ALPHA_HACK"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT_FRAG_COLOR","=","vec4","(","hf",",","max","(","0.01",",","hc",".","a",")",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT_FRAG_COLOR","=","vec4","(","hf",",","hc",".","a",")",";"]}]}}]},{TYPE:"txt",TOKENS:["}"]}]},e["postprocessing/luminance.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"txt",TOKENS:["uniform","sampler2D","u_input",";","GLSL_IN","vec2","A",";","GLSL_OUT","vec4","GLSL_OUT_FRAG_COLOR",";","void","main","(",")","{","vec4","gw","=","GLSL_TEXTURE","(","u_input",",","A",")",";","float","hg","=","dot","(","gw",".","rgb",",","vec3","(","0.2126",",","0.7152",",","0.0722",")",")",";","GLSL_OUT_FRAG_COLOR","=","vec4","(","vec3","(","hg",")",",","1.0",")",";","}"]}]},e["postprocessing/luminance_av.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"txt",TOKENS:["uniform","sampler2D","u_input",";","uniform","float","u_mipmap_1x1",";","GLSL_IN","vec2","A",";","GLSL_OUT","vec4","GLSL_OUT_FRAG_COLOR",";","void","main","(",")","{","float","hh","=","max","(","GLSL_TEXTURE","(","u_input",",","A",",","u_mipmap_1x1",")",".","r",",","0.01",")",";","GLSL_OUT_FRAG_COLOR","=","vec4","(","vec3","(","hh",")",",","1.0",")",";","}"]}]},e["postprocessing/luminance_truncated.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"var",NAME:"ADAPTIVE_BLOOM",TOKENS:["0"]},{TYPE:"txt",TOKENS:["uniform","sampler2D","u_main",";","uniform","sampler2D","u_luminance",";","uniform","sampler2D","u_average_lum",";","uniform","float","u_bloom_edge_lum",";","uniform","float","u_bloom_key",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["ADAPTIVE_BLOOM",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","float","u_average_lum_val",";"]}]}}]},{TYPE:"txt",TOKENS:["GLSL_IN","vec2","A",";","GLSL_OUT","vec4","GLSL_OUT_FRAG_COLOR",";","void","main","(",")","{"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["ADAPTIVE_BLOOM"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","hh","=","GLSL_TEXTURE","(","u_average_lum",",","vec2","(","0.5",")",")",".","r",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","hh","=","u_average_lum_val",";"]}]}}]},{TYPE:"txt",TOKENS:["float","hi","=","GLSL_TEXTURE","(","u_luminance",",","A",")",".","r",";","vec4","aQ","=","GLSL_TEXTURE","(","u_main",",","A",")",";","float","hj","=","hi","/","hh",";","float","hk","=","u_bloom_edge_lum",";","GLSL_OUT_FRAG_COLOR","=","aQ","*","u_bloom_key","*","smoothstep","(","hk",",","hk","+","1.2",",","hj",")",";","}"]}]},e["postprocessing/motion_blur.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"txt",TOKENS:["uniform","sampler2D","u_mb_tex_curr",";","uniform","sampler2D","u_mb_tex_accum",";","uniform","float","u_motion_blur_exp",";","uniform","float","u_motion_blur_decay_threshold",";","float","hl","=","0.0042",";","GLSL_IN","vec2","A",";","GLSL_OUT","vec4","GLSL_OUT_FRAG_COLOR",";","void","main","(",")","{","vec4","hm","=","GLSL_TEXTURE","(","u_mb_tex_curr",",","A",")",";","vec4","hn","=","GLSL_TEXTURE","(","u_mb_tex_accum",",","A",")",";","if","(","length","(","hm","-","hn",")",">","u_motion_blur_decay_threshold",")","{","vec4","ho","=","(","1.0","-","u_motion_blur_exp",")","*","hm","+","u_motion_blur_exp","*","hn",";","vec4","hp","=","ho","-","hn",";","vec4","hq","=","hm","-","hn",";","vec4","cS","=","min","(","max","(","abs","(","hp",")",",","vec4","(","hl",")",")",",","abs","(","hq",")",")","*","sign","(","hp",")",";","GLSL_OUT_FRAG_COLOR","=","hn","+","cS",";","}","else","{","GLSL_OUT_FRAG_COLOR","=","hm",";","}","}"]}]},e["postprocessing/outline.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",FILE:"color_util.glslf"},{TYPE:"txt",TOKENS:["uniform","sampler2D","u_outline_src",";","uniform","sampler2D","u_outline_mask",";","uniform","sampler2D","u_outline_mask_blurred",";","uniform","vec3","u_outline_color",";","uniform","float","u_draw_outline",";","GLSL_IN","vec2","A",";","GLSL_OUT","vec4","GLSL_OUT_FRAG_COLOR",";","void","main","(",")","{","vec4","hr","=","GLSL_TEXTURE","(","u_outline_src",",","A",")",";","GLSL_OUT_FRAG_COLOR","=","hr",";","if","(","u_draw_outline","!=","0.0",")","{","vec4","hs","=","GLSL_TEXTURE","(","u_outline_mask",",","A",")",";","vec4","ht","=","GLSL_TEXTURE","(","u_outline_mask_blurred",",","A",")",";","float","hu","=","ht",".","a","-","hs",".","a",";","if","(","hu","!=","0.0",")","{","float","hv","=","smoothstep","(","0.0",",","1.0",",","ht",".","a",")",";","if","(","hs",".","a","==","0.0",")","{","vec3","hw","=","u_outline_color",";","aW","(","hw",")",";","vec4","hx","=","vec4","(","clamp","(","hw",",","0.0",",","1.0",")",",","1.0",")",";","GLSL_OUT_FRAG_COLOR","=","mix","(","hr",",","hx",",","hv",")",";","}","}","}","}"]}]},e["postprocessing/performance.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"txt",TOKENS:["uniform","sampler2D","u_color",";","GLSL_IN","vec2","A",";","GLSL_OUT","vec4","GLSL_OUT_FRAG_COLOR",";","void","main","(",")","{","vec4","aQ","=","vec4","(","0.0",")",";","for","(","int","cl","=","0",";","cl","<","10",";","cl","++",")","{","vec2","hy","=","vec2","(","fract","(","A","*","vec2","(","cl",")","*","vec2","(","1.431",",","3.921",")",")",")",";","aQ","+=","0.01","*","GLSL_TEXTURE","(","u_color",",","hy",")",";","}","GLSL_OUT_FRAG_COLOR","=","aQ",";","}"]}]},e["postprocessing/postprocessing.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"POST_EFFECT",TOKENS:["POST_EFFECT_NONE"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"txt",TOKENS:["uniform","vec2","u_texel_size",";","uniform","sampler2D","u_color",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["POST_EFFECT","FLIP_CUBEMAP_COORDS",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","int","u_tex_number",";","uniform","vec2","u_delta",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["POST_EFFECT","POST_EFFECT_DOF_BLUR",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","float","u_dof_bokeh_intensity",";"]}]}}]},{TYPE:"txt",TOKENS:["GLSL_IN","vec2","A",";","GLSL_OUT","vec4","GLSL_OUT_FRAG_COLOR",";","void","main","(",")","{"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["POST_EFFECT","POST_EFFECT_NONE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT_FRAG_COLOR","=","GLSL_TEXTURE","(","u_color",",","A",")",";"]}]}},{TYPE:"elif",EXPRESSION:["POST_EFFECT","POST_EFFECT_GRAYSCALE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec4","du","=","GLSL_TEXTURE","(","u_color",",","A",")",";","GLSL_OUT_FRAG_COLOR",".","rgb","=","vec3","(","(","du",".","r","+","du",".","g","+","du",".","b",")","/","3.0",")",";","GLSL_OUT_FRAG_COLOR",".","a","=","1.0",";"]}]}},{TYPE:"elif",EXPRESSION:["POST_EFFECT","POST_EFFECT_BLUR",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec2","fI","=","vec2","(","0.0",",","0.0",")",";","vec2","cS","=","u_texel_size",";","vec4","aQ",";","aQ","=","GLSL_TEXTURE","(","u_color",",","A",")",";","GLSL_OUT_FRAG_COLOR","=","aQ","*","0.2270270270",";","fI","+=","cS",";","aQ","=","GLSL_TEXTURE","(","u_color",",","A","+","fI",")",";","GLSL_OUT_FRAG_COLOR","+=","aQ","*","0.1945945946",";","aQ","=","GLSL_TEXTURE","(","u_color",",","A","-","fI",")",";","GLSL_OUT_FRAG_COLOR","+=","aQ","*","0.1945945946",";","fI","+=","cS",";","aQ","=","GLSL_TEXTURE","(","u_color",",","A","+","fI",")",";","GLSL_OUT_FRAG_COLOR","+=","aQ","*","0.1216216216",";","aQ","=","GLSL_TEXTURE","(","u_color",",","A","-","fI",")",";","GLSL_OUT_FRAG_COLOR","+=","aQ","*","0.1216216216",";","fI","+=","cS",";","aQ","=","GLSL_TEXTURE","(","u_color",",","A","+","fI",")",";","GLSL_OUT_FRAG_COLOR","+=","aQ","*","0.0540540541",";","aQ","=","GLSL_TEXTURE","(","u_color",",","A","-","fI",")",";","GLSL_OUT_FRAG_COLOR","+=","aQ","*","0.0540540541",";","fI","+=","cS",";","aQ","=","GLSL_TEXTURE","(","u_color",",","A","+","fI",")",";","GLSL_OUT_FRAG_COLOR","+=","aQ","*","0.0162162162",";","aQ","=","GLSL_TEXTURE","(","u_color",",","A","-","fI",")",";","GLSL_OUT_FRAG_COLOR","+=","aQ","*","0.0162162162",";"]}]}},{TYPE:"elif",EXPRESSION:["POST_EFFECT","POST_EFFECT_GLOW_BLUR",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec2","fI","=","vec2","(","0.0",",","0.0",")",";","vec2","cS","=","u_texel_size",";","vec4","aQ",";","aQ","=","GLSL_TEXTURE","(","u_color",",","A",")",";","GLSL_OUT_FRAG_COLOR","=","aQ","*","(","1.0","-","step","(","0.0",",","-","aQ",".","a",")",")","*","0.152507",";","fI","+=","cS",";","aQ","=","GLSL_TEXTURE","(","u_color",",","A","+","fI",")",";","GLSL_OUT_FRAG_COLOR","+=","aQ","*","(","1.0","-","step","(","0.0",",","-","aQ",".","a",")",")","*","0.141763",";","aQ","=","GLSL_TEXTURE","(","u_color",",","A","-","fI",")",";","GLSL_OUT_FRAG_COLOR","+=","aQ","*","(","1.0","-","step","(","0.0",",","-","aQ",".","a",")",")","*","0.141763",";","fI","+=","cS",";","aQ","=","GLSL_TEXTURE","(","u_color",",","A","+","fI",")",";","GLSL_OUT_FRAG_COLOR","+=","aQ","*","(","1.0","-","step","(","0.0",",","-","aQ",".","a",")",")","*","0.113861",";","aQ","=","GLSL_TEXTURE","(","u_color",",","A","-","fI",")",";","GLSL_OUT_FRAG_COLOR","+=","aQ","*","(","1.0","-","step","(","0.0",",","-","aQ",".","a",")",")","*","0.113861",";","fI","+=","cS",";","aQ","=","GLSL_TEXTURE","(","u_color",",","A","+","fI",")",";","GLSL_OUT_FRAG_COLOR","+=","aQ","*","(","1.0","-","step","(","0.0",",","-","aQ",".","a",")",")","*","0.079019",";","aQ","=","GLSL_TEXTURE","(","u_color",",","A","-","fI",")",";","GLSL_OUT_FRAG_COLOR","+=","aQ","*","(","1.0","-","step","(","0.0",",","-","aQ",".","a",")",")","*","0.079019",";","fI","+=","cS",";","aQ","=","GLSL_TEXTURE","(","u_color",",","A","+","fI",")",";","GLSL_OUT_FRAG_COLOR","+=","aQ","*","(","1.0","-","step","(","0.0",",","-","aQ",".","a",")",")","*","0.047383",";","aQ","=","GLSL_TEXTURE","(","u_color",",","A","-","fI",")",";","GLSL_OUT_FRAG_COLOR","+=","aQ","*","(","1.0","-","step","(","0.0",",","-","aQ",".","a",")",")","*","0.047383",";","fI","+=","cS",";","aQ","=","GLSL_TEXTURE","(","u_color",",","A","+","fI",")",";","GLSL_OUT_FRAG_COLOR","+=","aQ","*","(","1.0","-","step","(","0.0",",","-","aQ",".","a",")",")","*","0.024549",";","aQ","=","GLSL_TEXTURE","(","u_color",",","A","-","fI",")",";","GLSL_OUT_FRAG_COLOR","+=","aQ","*","(","1.0","-","step","(","0.0",",","-","aQ",".","a",")",")","*","0.024549",";","fI","+=","cS",";","aQ","=","GLSL_TEXTURE","(","u_color",",","A","+","fI",")",";","GLSL_OUT_FRAG_COLOR","+=","aQ","*","(","1.0","-","step","(","0.0",",","-","aQ",".","a",")",")","*","0.01099",";","aQ","=","GLSL_TEXTURE","(","u_color",",","A","-","fI",")",";","GLSL_OUT_FRAG_COLOR","+=","aQ","*","(","1.0","-","step","(","0.0",",","-","aQ",".","a",")",")","*","0.01099",";","fI","+=","cS",";","aQ","=","GLSL_TEXTURE","(","u_color",",","A","+","fI",")",";","GLSL_OUT_FRAG_COLOR","+=","aQ","*","(","1.0","-","step","(","0.0",",","-","aQ",".","a",")",")","*","0.00425",";","aQ","=","GLSL_TEXTURE","(","u_color",",","A","-","fI",")",";","GLSL_OUT_FRAG_COLOR","+=","aQ","*","(","1.0","-","step","(","0.0",",","-","aQ",".","a",")",")","*","0.00425",";","fI","+=","cS",";","aQ","=","GLSL_TEXTURE","(","u_color",",","A","+","fI",")",";","GLSL_OUT_FRAG_COLOR","+=","aQ","*","(","1.0","-","step","(","0.0",",","-","aQ",".","a",")",")","*","0.00142",";","aQ","=","GLSL_TEXTURE","(","u_color",",","A","-","fI",")",";","GLSL_OUT_FRAG_COLOR","+=","aQ","*","(","1.0","-","step","(","0.0",",","-","aQ",".","a",")",")","*","0.00142",";","GLSL_OUT_FRAG_COLOR","=","clamp","(","GLSL_OUT_FRAG_COLOR",",","0.0",",","1.0",")",";"]}]}},{TYPE:"elif",EXPRESSION:["POST_EFFECT","POST_EFFECT_DOF_BLUR",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec2","fI","=","vec2","(","0.0",",","0.0",")",";","vec2","cS","=","u_texel_size",";","vec4","aQ",";","vec4","hz",";","vec4","hA",";","float","gz",";","float","hB","=","u_dof_bokeh_intensity",";","aQ","=","GLSL_TEXTURE","(","u_color",",","A",")",";","hz","=","aQ",";","hA","=","aQ",";","gz","=","aQ",".","a",";","cS","=","gz","*","cS",";","for","(","int","cl","=","0",";","cl","<","12",";","cl","+=","2",")","{","fI","+=","cS",";","aQ","=","GLSL_TEXTURE","(","u_color",",","A","+","fI",")",";","hz","+=","aQ",";","hA","=","max","(","hA",",","aQ",")",";","aQ","=","GLSL_TEXTURE","(","u_color",",","A","-","fI",")",";","hz","+=","aQ",";","hA","=","max","(","hA",",","aQ",")",";","}","hz","/=","13.0",";","GLSL_OUT_FRAG_COLOR","=","mix","(","hz",",","hA",",","hB",")",";"]}]}},{TYPE:"elif",EXPRESSION:["POST_EFFECT","POST_EFFECT_ALPHA_BLUR",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec2","fI","=","vec2","(","0.0",",","0.0",")",";","vec2","cS","=","u_texel_size",";","vec4","aQ",";","vec4","hz",";","vec4","hA",";","aQ","=","GLSL_TEXTURE","(","u_color",",","A",")",";","hA","=","max","(","hA",",","aQ",")",";","hz","=","aQ",";","hz",".","a","=","aQ",".","a","*","0.2270270270",";","fI","+=","cS",";","aQ","=","GLSL_TEXTURE","(","u_color",",","A","+","fI",")",";","hA",".","a","=","max","(","hA",".","a",",","aQ",".","a",")",";","hz",".","a","+=","aQ",".","a","*","0.1945945946",";","aQ","=","GLSL_TEXTURE","(","u_color",",","A","-","fI",")",";","hA",".","a","=","max","(","hA",".","a",",","aQ",".","a",")",";","hz",".","a","+=","aQ",".","a","*","0.1945945946",";","fI","+=","cS",";","aQ","=","GLSL_TEXTURE","(","u_color",",","A","+","fI",")",";","hA",".","a","=","max","(","hA",".","a",",","aQ",".","a",")",";","hz",".","a","+=","aQ",".","a","*","0.1216216216",";","aQ","=","GLSL_TEXTURE","(","u_color",",","A","-","fI",")",";","hA",".","a","=","max","(","hA",".","a",",","aQ",".","a",")",";","hz",".","a","+=","aQ",".","a","*","0.1216216216",";","fI","+=","cS",";","aQ","=","GLSL_TEXTURE","(","u_color",",","A","+","fI",")",";","hA",".","a","=","max","(","hA",".","a",",","aQ",".","a",")",";","hz",".","a","+=","aQ",".","a","*","0.0540540541",";","aQ","=","GLSL_TEXTURE","(","u_color",",","A","-","fI",")",";","hA",".","a","=","max","(","hA",".","a",",","aQ",".","a",")",";","hz",".","a","+=","aQ",".","a","*","0.0540540541",";","fI","+=","cS",";","aQ","=","GLSL_TEXTURE","(","u_color",",","A","+","fI",")",";","hA",".","a","=","max","(","hA",".","a",",","aQ",".","a",")",";","hz",".","a","+=","aQ",".","a","*","0.0162162162",";","aQ","=","GLSL_TEXTURE","(","u_color",",","A","-","fI",")",";","hA",".","a","=","max","(","hA",".","a",",","aQ",".","a",")",";","hz",".","a","+=","aQ",".","a","*","0.0162162162",";","GLSL_OUT_FRAG_COLOR","=","mix","(","hz",",","hA",",","0.5",")",";"]}]}},{TYPE:"elif",EXPRESSION:["POST_EFFECT","POST_EFFECT_EXTEND",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec2","cS","=","u_texel_size",";","vec4","aQ","=","GLSL_TEXTURE","(","u_color",",","A",")",";","GLSL_OUT_FRAG_COLOR","=","aQ",";","if","(","aQ",".","a","==","0.0",")","{","aQ","=","GLSL_TEXTURE","(","u_color",",","A","+","cS",")",";","if","(","aQ",".","a",">","0.0",")","GLSL_OUT_FRAG_COLOR","=","vec4","(","1.0",",","1.0",",","1.0",",","aQ",".","a",")",";","else","{","aQ","=","GLSL_TEXTURE","(","u_color",",","A","-","cS",")",";","if","(","aQ",".","a",">","0.0",")","GLSL_OUT_FRAG_COLOR","=","vec4","(","1.0",",","1.0",",","1.0",",","aQ",".","a",")",";","}","}"]}]}},{TYPE:"elif",EXPRESSION:["POST_EFFECT","FLIP_CUBEMAP_COORDS",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","hC","=","u_delta","[","0","]",";","float","hD","=","u_delta","[","1","]",";","float","hE","=","1.0","/","3.0",";","float","hF","=","0.5",";","vec2","hG","=","vec2","(","hE",",","hF",")",";","if","(","u_tex_number","==","0",")","{","vec2","b_","=","mat2","(","0.0",",","-","1.0",",","1.0",",","0.0",")","*","A","*","hG","+","vec2","(","2.0","*","hE",",","hF",")",";","b_","[","0","]","=","max","(","b_","[","0","]",",","2.0","*","hE","+","hC",")",";","b_","[","1","]","=","max","(","b_","[","1","]",",","hD",")",";","GLSL_OUT_FRAG_COLOR","=","GLSL_TEXTURE","(","u_color",",","vec2","(","b_","[","0","]",",","hF","-","b_","[","1","]",")",")",";","}","else","if","(","u_tex_number","==","1",")","{","vec2","b_","=","mat2","(","0.0",",","-","1.0",",","1.0",",","0.0",")","*","A","*","hG","+","vec2","(","0.0",",","hF",")",";","b_","[","0","]","=","max","(","b_","[","0","]",",","hC",")",";","b_","[","1","]","=","min","(","b_","[","1","]",",","hF","-","hD",")",";","GLSL_OUT_FRAG_COLOR","=","GLSL_TEXTURE","(","u_color",",","vec2","(","hE","-","b_","[","0","]",",","b_","[","1","]",")",")",";","}","else","if","(","u_tex_number","==","2",")","{","vec2","b_","=","A","*","hG","+","vec2","(","2.0","*","hE",",","hF",")",";","b_","[","0","]","=","max","(","b_","[","0","]",",","2.0","*","hE","+","hC",")",";","b_","[","1","]","=","min","(","b_","[","1","]",",","1.0","-","hD",")",";","GLSL_OUT_FRAG_COLOR","=","GLSL_TEXTURE","(","u_color",",","vec2","(","b_","[","0","]",",","1.5","-","b_","[","1","]",")",")",";","}","else","if","(","u_tex_number","==","3",")","{","vec2","b_","=","A","*","hG","+","vec2","(","hE",",","0.0",")",";","b_","[","0","]","=","max","(","b_","[","0","]",",","hE","+","hC",")",";","b_","[","0","]","=","min","(","b_","[","0","]",",","2.0","*","hE","-","hC",")",";","b_","[","1","]","=","min","(","b_","[","1","]",",","hF","-","hD",")",";","GLSL_OUT_FRAG_COLOR","=","GLSL_TEXTURE","(","u_color",",","vec2","(","1.0","-","b_","[","0","]",",","b_","[","1","]",")",")",";","}","else","if","(","u_tex_number","==","4",")","{","vec2","b_","=","A","*","hG","+","vec2","(","hE",",","hF",")",";","b_","[","0","]","=","max","(","b_","[","0","]",",","hE","+","hC",")",";","b_","[","0","]","=","min","(","b_","[","0","]",",","2.0","*","hE","-","hC",")",";","b_","[","1","]","=","min","(","b_","[","1","]",",","1.0","-","hD",")",";","GLSL_OUT_FRAG_COLOR","=","GLSL_TEXTURE","(","u_color",",","vec2","(","b_","[","0","]",",","3.0","*","hF","-","b_","[","1","]",")",")",";","}","else","{","vec2","b_","=","A","*","hG","+","vec2","(","0.0",",","hF",")",";","b_","[","0","]","=","max","(","b_","[","0","]",",","hC",")",";","b_","[","1","]","=","min","(","b_","[","1","]",",","1.0","-","hD",")",";","b_","[","1","]","=","max","(","b_","[","1","]",",","hF","+","hD",")",";","GLSL_OUT_FRAG_COLOR","=","GLSL_TEXTURE","(","u_color",",","vec2","(","hE","-","b_","[","0","]",",","b_","[","1","]",")",")",";","}"]}]}}]},{TYPE:"txt",TOKENS:["}"]}]},e["postprocessing/postprocessing.glslv"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"include",FILE:"std.glsl"},{TYPE:"txt",TOKENS:["GLSL_IN","vec2","a_position",";","GLSL_OUT","vec2","A",";","void","main","(",")","{","A","=","2.0","*","a_position",";","gl_Position","=","vec4","(","4.0","*","(","a_position",".","xy","-","0.25",")",",","0.0",",","1.0",")",";","}"]}]},e["postprocessing/precompute_brdf.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"var",NAME:"PRECISION",TOKENS:["highp"]},{TYPE:"txt",TOKENS:["precision","PRECISION","sampler2D",";","precision","PRECISION","float",";","GLSL_IN","vec2","A",";","GLSL_OUT","vec4","GLSL_OUT_FRAG_COLOR",";","float","dZ","(","int","cr",",","int","dV",")","{","float","dW","=","1.0","/","float","(","dV",")",";","float","dX","=","1.0",";","float","dY","=","0.0",";","for","(","int","cl","=","0",";","cl","<","32",";","++","cl",")","{","if","(","cr",">","0",")","{","dX","=","mod","(","float","(","cr",")",",","2.0",")",";","dY","+=","dX","*","dW",";","dW","=","dW","/","2.0",";","cr","=","int","(","float","(","cr",")","/","2.0",")",";","}","}","return","dY",";","}","vec2","ea","(","int","cl",",","int","d_",")","{","return","vec2","(","float","(","cl",")","/","float","(","d_",")",",","dZ","(","cl",",","2",")",")",";","}","vec3","eh","(","vec2","eb",",","vec3","d_",",","float","ec",")","{","float","a","=","ec","*","ec",";","float","by","=","2.0","*","M_PI","*","eb",".","x",";","float","ed","=","sqrt","(","(","1.0","-","eb",".","y",")","/","(","1.0","+","(","a","*","a","-","1.0",")","*","eb",".","y",")",")",";","float","ee","=","sqrt","(","1.0","-","ed","*","ed",")",";","vec3","ef",";","ef",".","x","=","cos","(","by",")","*","ee",";","ef",".","y","=","sin","(","by",")","*","ee",";","ef",".","z","=","ed",";","vec3","bu","=","abs","(","d_",".","z",")","<","0.999","?","vec3","(","0.0",",","0.0",",","1.0",")",":","vec3","(","1.0",",","0.0",",","0.0",")",";","vec3","V","=","normalize","(","cross","(","bu",",","d_",")",")",";","vec3","eg","=","cross","(","d_",",","V",")",";","vec3","bB","=","V","*","ef",".","x","+","eg","*","ef",".","y","+","d_","*","ef",".","z",";","return","normalize","(","bB",")",";","}","float","hK","(","float","hH",",","float","ec",")","{","float","a","=","ec",";","float","hI","=","(","a","*","a",")","/","2.0",";","float","hJ","=","hH",";","float","dX","=","hH","*","(","1.0","-","hI",")","+","hI",";","return","hJ","/","dX",";","}","float","hN","(","vec3","d_",",","vec3","ek",",","vec3","en",",","float","ec",")","{","float","hH","=","max","(","dot","(","d_",",","ek",")",",","0.0",")",";","float","eo","=","max","(","dot","(","d_",",","en",")",",","0.0",")",";","float","hL","=","hK","(","hH",",","ec",")",";","float","hM","=","hK","(","eo",",","ec",")",";","return","hM","*","hL",";","}","vec2","hU","(","float","hH",",","float","ec",")","{","vec3","ek",";","ek",".","x","=","sqrt","(","1.0","-","hH","*","hH",")",";","ek",".","y","=","0.0",";","ek",".","z","=","hH",";","float","cB","=","0.0",";","float","hO","=","0.0",";","vec3","d_","=","vec3","(","0.0",",","0.0",",","1.0",")",";","const","int","el","=","1024",";","for","(","int","cl","=","0",";","cl","<","el",";","++","cl",")","{","vec2","eb","=","ea","(","cl",",","el",")",";","vec3","ef","=","eh","(","eb",",","d_",",","ec",")",";","vec3","en","=","normalize","(","2.0","*","dot","(","ek",",","ef",")","*","ef","-","ek",")",";","float","eo","=","max","(","en",".","z",",","0.0",")",";","float","hP","=","max","(","ef",".","z",",","0.0",")",";","float","hQ","=","max","(","dot","(","ek",",","ef",")",",","0.0",")",";","if","(","eo",">","0.0",")","{","float","hR","=","hN","(","d_",",","ek",",","en",",","ec",")",";","float","hS","=","(","hR","*","hQ",")","/","(","hP","*","hH",")",";","float","hT","=","pow","(","1.0","-","hQ",",","5.0",")",";","cB","+=","(","1.0","-","hT",")","*","hS",";","hO","+=","hT","*","hS",";","}","}","cB","/=","float","(","el",")",";","hO","/=","float","(","el",")",";","return","vec2","(","cB",",","hO",")",";","}","void","main","(",")","{","vec2","hV","=","hU","(","A",".","x",",","A",".","y",")",";","GLSL_OUT_FRAG_COLOR","=","vec4","(","hV",",","0.0",",","1.0",")",";","}"]}]},e["postprocessing/smaa.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"SMAA_PASS",TOKENS:["SMAA_RESOLVE"]},{TYPE:"var",NAME:"SMAA_REPROJECTION",TOKENS:["0"]},{TYPE:"var",NAME:"SMAA_PREDICATION",TOKENS:["0"]},{TYPE:"var",NAME:"SMAA_DISABLE_CORNER_DETECTION",TOKENS:["0"]},{TYPE:"var",NAME:"AA_METHOD",TOKENS:["AA_METHOD_SMAA_ULTRA"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",FILE:"pack.glslf"},{TYPE:"txt",TOKENS:["uniform","sampler2D","u_color",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_PASS","SMAA_RESOLVE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_color_prev",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_blend",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_REPROJECTION"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_velocity_tex",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_PASS","SMAA_EDGE_DETECTION",{TYPE:"equal_expr",PLACES:2},"SMAA_PREDICATION",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_predication_tex",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_search_tex",";","uniform","sampler2D","u_area_tex",";","uniform","vec4","u_subsample_indices",";"]}]}}]},{TYPE:"txt",TOKENS:["uniform","vec2","u_texel_size",";","GLSL_IN","vec2","A",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","hW",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","hX",";","GLSL_IN","vec4","hY",";","GLSL_IN","vec4","hZ",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec2","h_",";"]}]}}]},{TYPE:"txt",TOKENS:["GLSL_OUT","vec4","GLSL_OUT_FRAG_COLOR",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["AA_METHOD","AA_METHOD_SMAA_LOW",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"SMAA_THRESHOLD",TOKENS:["0.15"]},{TYPE:"define",NAME:"SMAA_DISABLE_DIAG_DETECTION",TOKENS:["1"]},{TYPE:"define",NAME:"SMAA_DISABLE_CORNER_DETECTION",TOKENS:["1"]}]}},{TYPE:"elif",EXPRESSION:["AA_METHOD","AA_METHOD_SMAA_MEDIUM",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"SMAA_THRESHOLD",TOKENS:["0.1"]},{TYPE:"define",NAME:"SMAA_DISABLE_DIAG_DETECTION",TOKENS:["1"]},{TYPE:"define",NAME:"SMAA_DISABLE_CORNER_DETECTION",TOKENS:["1"]}]}},{TYPE:"elif",EXPRESSION:["AA_METHOD","AA_METHOD_SMAA_HIGH",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"SMAA_THRESHOLD",TOKENS:["0.1"]},{TYPE:"define",NAME:"SMAA_DISABLE_DIAG_DETECTION",TOKENS:["0"]},{TYPE:"define",NAME:"SMAA_MAX_SEARCH_STEPS_DIAG",TOKENS:["8"]},{TYPE:"define",NAME:"SMAA_CORNER_ROUNDING",TOKENS:["25"]}]}},{TYPE:"elif",EXPRESSION:["AA_METHOD","AA_METHOD_SMAA_ULTRA",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"SMAA_THRESHOLD",TOKENS:["0.05"]},{TYPE:"define",NAME:"SMAA_DISABLE_DIAG_DETECTION",TOKENS:["0"]},{TYPE:"define",NAME:"SMAA_MAX_SEARCH_STEPS_DIAG",TOKENS:["16"]},{TYPE:"define",NAME:"SMAA_CORNER_ROUNDING",TOKENS:["25"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"SMAA_THRESHOLD",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"SMAA_THRESHOLD",TOKENS:["0.1"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"SMAA_DEPTH_THRESHOLD",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"SMAA_DEPTH_THRESHOLD",TOKENS:["(","0.1","*","SMAA_THRESHOLD",")"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"SMAA_MAX_SEARCH_STEPS_DIAG",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"SMAA_MAX_SEARCH_STEPS_DIAG",TOKENS:["8"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"SMAA_CORNER_ROUNDING",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"SMAA_CORNER_ROUNDING",TOKENS:["25"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR",TOKENS:["2.0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"SMAA_PREDICATION",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"SMAA_PREDICATION",TOKENS:["0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"SMAA_PREDICATION_THRESHOLD",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"SMAA_PREDICATION_THRESHOLD",TOKENS:["0.01"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"SMAA_PREDICATION_SCALE",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"SMAA_PREDICATION_SCALE",TOKENS:["2.0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"SMAA_PREDICATION_STRENGTH",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"SMAA_PREDICATION_STRENGTH",TOKENS:["0.4"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"SMAA_REPROJECTION",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"SMAA_REPROJECTION",TOKENS:["0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"SMAA_REPROJECTION_WEIGHT_SCALE",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"SMAA_REPROJECTION_WEIGHT_SCALE",TOKENS:["30.0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"SMAA_MAX_SEARCH_STEPS",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"SMAA_MAX_SEARCH_STEPS",TOKENS:["16"]}]}}]},{TYPE:"define",NAME:"SMAA_AREATEX_MAX_DISTANCE",TOKENS:["16"]},{TYPE:"define",NAME:"SMAA_AREATEX_MAX_DISTANCE_DIAG",TOKENS:["20"]},{TYPE:"define",NAME:"SMAA_AREATEX_PIXEL_SIZE",TOKENS:["(","1.0","/","vec2","(","160.0",",","560.0",")",")"]},{TYPE:"define",NAME:"SMAA_AREATEX_SUBTEX_SIZE",TOKENS:["(","1.0","/","7.0",")"]},{TYPE:"define",NAME:"SMAA_SEARCHTEX_SIZE",TOKENS:["vec2","(","66.0",",","33.0",")"]},{TYPE:"define",NAME:"SMAA_SEARCHTEX_PACKED_SIZE",TOKENS:["vec2","(","64.0",",","16.0",")"]},{TYPE:"define",NAME:"SMAA_CORNER_ROUNDING_NORM",TOKENS:["(","float","(","SMAA_CORNER_ROUNDING",")","/","100.0",")"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_PASS","SMAA_EDGE_DETECTION",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","id","(","vec2","b_",",","sampler2D","ia",")","{","float","p","=","GLSL_TEXTURE","(","ia",",","b_",")",".","r",";","float","ib","=","GLSL_TEXTURE","(","ia",",","hX",".","xy",")",".","r",";","float","ic","=","GLSL_TEXTURE","(","ia",",","hX",".","zw",")",".","r",";","return","vec3","(","p",",","ib",",","ic",")",";","}"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_PASS","SMAA_EDGE_DETECTION",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec2","ii","(","vec2","b_",",","sampler2D","ie",")","{","vec3","ig","=","id","(","b_",",","ie",")",";","vec2","cS","=","abs","(","ig",".","xx","-","ig",".","yz",")",";","vec2","ih","=","step","(","SMAA_PREDICATION_THRESHOLD",",","cS",")",";","return","SMAA_PREDICATION_SCALE","*","SMAA_THRESHOLD","*","(","1.0","-","SMAA_PREDICATION_STRENGTH","*","ih",")",";","}"]}]}}]},{TYPE:"txt",TOKENS:["void","im","(","bvec2","ij",",","inout","vec2","ik",",","vec2","il",")","{","if","(","ij",".","x",")","ik",".","x","=","il",".","x",";","if","(","ij",".","y",")","ik",".","y","=","il",".","y",";","}","void","im","(","bvec4","ij",",","inout","vec4","ik",",","vec4","il",")","{","im","(","ij",".","xy",",","ik",".","xy",",","il",".","xy",")",";","im","(","ij",".","zw",",","ik",".","zw",",","il",".","zw",")",";","}","vec2","io","(","vec2","x",")","{","return","sign","(","x",")","*","floor","(","abs","(","x",")","+",".5",")",";","}","vec4","io","(","vec4","x",")","{","return","sign","(","x",")","*","floor","(","abs","(","x",")","+",".5",")",";","}"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_PASS","SMAA_EDGE_DETECTION",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec2","iA","(","vec2","b_",",","sampler2D","ip"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_PREDICATION"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:[",","sampler2D","ie"]}]}}]},{TYPE:"txt",TOKENS:[")","{"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_PREDICATION"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec2","iq","=","ii","(","b_",",","ie",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec2","iq","=","vec2","(","SMAA_THRESHOLD",",","SMAA_THRESHOLD",")",";"]}]}}]},{TYPE:"txt",TOKENS:["vec3","ir","=","vec3","(","0.2126",",","0.7152",",","0.0722",")",";","float","en","=","dot","(","GLSL_TEXTURE","(","ip",",","b_",")",".","rgb",",","ir",")",";","float","is","=","dot","(","GLSL_TEXTURE","(","ip",",","hX",".","xy",")",".","rgb",",","ir",")",";","float","it","=","dot","(","GLSL_TEXTURE","(","ip",",","hX",".","zw",")",".","rgb",",","ir",")",";","vec4","cS",";","cS",".","xy","=","abs","(","en","-","vec2","(","is",",","it",")",")",";","vec2","ih","=","step","(","iq",",","cS",".","xy",")",";","if","(","dot","(","ih",",","vec2","(","1.0",",","1.0",")",")","==","0.0",")","discard",";","float","iu","=","dot","(","GLSL_TEXTURE","(","ip",",","hY",".","xy",")",".","rgb",",","ir",")",";","float","iv","=","dot","(","GLSL_TEXTURE","(","ip",",","hY",".","zw",")",".","rgb",",","ir",")",";","cS",".","zw","=","abs","(","en","-","vec2","(","iu",",","iv",")",")",";","vec2","iw","=","max","(","cS",".","xy",",","cS",".","zw",")",";","float","ix","=","dot","(","GLSL_TEXTURE","(","ip",",","hZ",".","xy",")",".","rgb",",","ir",")",";","float","iy","=","dot","(","GLSL_TEXTURE","(","ip",",","hZ",".","zw",")",".","rgb",",","ir",")",";","cS",".","zw","=","abs","(","vec2","(","is",",","it",")","-","vec2","(","ix",",","iy",")",")",";","iw","=","max","(","iw",".","xy",",","cS",".","zw",")",";","float","iz","=","max","(","iw",".","x",",","iw",".","y",")",";","ih",".","xy","*=","step","(","iz",",","SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR","*","cS",".","xy",")",";","return","ih",";","}"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_DISABLE_DIAG_DETECTION",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec2","iC","(","vec2","iB",")","{","iB",".","r","=","iB",".","r","*","abs","(","5.0","*","iB",".","r","-","5.0","*","0.75",")",";","return","io","(","iB",")",";","}","vec4","iC","(","vec4","iB",")","{","iB",".","rb","=","iB",".","rb","*","abs","(","5.0","*","iB",".","rb","-","5.0","*","0.75",")",";","return","io","(","iB",")",";","}","vec2","iE","(","sampler2D","iD",",","vec2","b_",",","vec2","bD",",","out","vec2","iB",")","{","vec4","fW","=","vec4","(","b_",",","-","1.0",",","1.0",")",";","vec3","t","=","vec3","(","u_texel_size",",","1.0",")",";","for","(","int","cl","=","0",";","cl","<","SMAA_MAX_SEARCH_STEPS_DIAG",";","cl","++",")","{","if","(","fW",".","z","<","float","(","SMAA_MAX_SEARCH_STEPS_DIAG","-","1",")","&&","fW",".","w",">","0.9",")","{","fW",".","xyz","+=","t","*","vec3","(","bD",",","1.0",")",";","iB","=","GLSL_TEXTURE","(","iD",",","fW",".","xy",",","0.0",")",".","rg",";","fW",".","w","=","dot","(","iB",",","vec2","(","0.5",",","0.5",")",")",";","}","}","return","fW",".","zw",";","}","vec2","iF","(","sampler2D","iD",",","vec2","b_",",","vec2","bD",",","out","vec2","iB",")","{","vec4","fW","=","vec4","(","b_",",","-","1.0",",","1.0",")",";","fW",".","x","+=","0.25","*","u_texel_size",".","x",";","vec3","t","=","vec3","(","u_texel_size",",","1.0",")",";","for","(","int","cl","=","0",";","cl","<","SMAA_MAX_SEARCH_STEPS_DIAG",";","cl","++",")","{","if","(","fW",".","z","<","float","(","SMAA_MAX_SEARCH_STEPS_DIAG","-","1",")","&&","fW",".","w",">","0.9",")","{","fW",".","xyz","=","t","*","vec3","(","bD",",","1.0",")","+","fW",".","xyz",";","iB","=","GLSL_TEXTURE","(","iD",",","fW",".","xy",",","0.0",")",".","rg",";","iB","=","iC","(","iB",")",";","fW",".","w","=","dot","(","iB",",","vec2","(","0.5",",","0.5",")",")",";","}","}","return","fW",".","zw",";","}","vec2","iH","(","sampler2D","iG",",","vec2","aM",",","vec2","iB",",","float","fI",")","{","vec2","b_","=","vec2","(","SMAA_AREATEX_MAX_DISTANCE_DIAG",",","SMAA_AREATEX_MAX_DISTANCE_DIAG",")","*","iB","+","aM",";","b_","=","SMAA_AREATEX_PIXEL_SIZE","*","b_","+","0.5","*","SMAA_AREATEX_PIXEL_SIZE",";","b_",".","x","+=","0.5",";","b_",".","y","+=","SMAA_AREATEX_SUBTEX_SIZE","*","fI",";","return","GLSL_TEXTURE","(","iG",",","b_",",","0.0",")",".","rg",";","}","vec2","iM","(","sampler2D","iD",",","sampler2D","iG",",","vec2","b_",",","vec2","iB",",","vec4","iI",")","{","vec2","ir","=","vec2","(","0.0",",","0.0",")",";","vec4","dz",";","vec2","iJ",";","if","(","iB",".","r",">","0.0",")","{","dz",".","xz","=","iE","(","iD",",","b_",",","vec2","(","-","1.0",",","1.0",")",",","iJ",")",";","dz",".","x","+=","float","(","iJ",".","y",">","0.9",")",";","}","else","dz",".","xz","=","vec2","(","0.0",",","0.0",")",";","dz",".","yw","=","iE","(","iD",",","b_",",","vec2","(","1.0",",","-","1.0",")",",","iJ",")",";","if","(","dz",".","x","+","dz",".","y",">","2.0",")","{","vec4","iK","=","vec4","(","-","dz",".","x","+","0.25",",","dz",".","x",",","dz",".","y",",","-","dz",".","y","-","0.25",")","*","u_texel_size",".","xyxy","+","b_",".","xyxy",";","vec4","du",";","du",".","xy","=","GLSL_TEXTURE","(","iD",",","iK",".","xy","+","u_texel_size","*","vec2","(","-","1",",","0",")",",","0.0",")",".","rg",";","du",".","zw","=","GLSL_TEXTURE","(","iD",",","iK",".","zw","+","u_texel_size","*","vec2","(","1",",","0",")",",","0.0",")",".","rg",";","du",".","yxwz","=","iC","(","du",".","xyzw",")",";","vec2","iL","=","vec2","(","2.0",",","2.0",")","*","du",".","xz","+","du",".","yw",";","im","(","bvec2","(","step","(","0.9",",","dz",".","zw",")",")",",","iL",",","vec2","(","0.0",",","0.0",")",")",";","ir","+=","iH","(","iG",",","dz",".","xy",",","iL",",","iI",".","z",")",";","}","dz",".","xz","=","iF","(","iD",",","b_",",","vec2","(","-","1",",","-","1",")",",","iJ",")",";","if","(","GLSL_TEXTURE","(","iD",",","b_","+","u_texel_size","*","vec2","(","1",",","0",")",",","0.0",")",".","r",">","0.0",")","{","dz",".","yw","=","iF","(","iD",",","b_",",","vec2","(","1",",","1",")",",","iJ",")",";","dz",".","y","+=","float","(","iJ",".","y",">","0.9",")",";","}","else","dz",".","yw","=","vec2","(","0.0",",","0.0",")",";","if","(","dz",".","x","+","dz",".","y",">","2.0",")","{","vec4","iK","=","vec4","(","-","dz",".","x",",","-","dz",".","x",",","dz",".","y",",","dz",".","y",")","*","u_texel_size",".","xyxy","+","b_",".","xyxy",";","vec4","du",";","du",".","x","=","GLSL_TEXTURE","(","iD",",","iK",".","xy","+","u_texel_size","*","vec2","(","-","1",",","0",")",",","0.0",")",".","g",";","du",".","y","=","GLSL_TEXTURE","(","iD",",","iK",".","xy","+","u_texel_size","*","vec2","(","0",",","-","1",")",",","0.0",")",".","r",";","du",".","zw","=","GLSL_TEXTURE","(","iD",",","iK",".","zw","+","u_texel_size","*","vec2","(","1",",","0",")",",","0.0",")",".","gr",";","vec2","iL","=","vec2","(","2.0",",","2.0",")","*","du",".","xz","+","du",".","yw",";","im","(","bvec2","(","step","(","0.9",",","dz",".","zw",")",")",",","iL",",","vec2","(","0",",","0",")",")",";","ir","+=","iH","(","iG",",","dz",".","xy",",","iL",",","iI",".","w",")",".","gr",";","}","return","ir",";","}"]}]}}]},{TYPE:"txt",TOKENS:["float","iP","(","sampler2D","iN",",","vec2","iB",",","float","fI",")","{","vec2","hG","=","SMAA_SEARCHTEX_SIZE","*","vec2","(","0.5",",","-","1.0",")",";","vec2","iO","=","SMAA_SEARCHTEX_SIZE","*","vec2","(","fI",",","1.0",")",";","hG","+=","vec2","(","-","1.0",",","1.0",")",";","iO","+=","vec2","(","0.5",",","-","0.5",")",";","hG","*=","1.0","/","SMAA_SEARCHTEX_PACKED_SIZE",";","iO","*=","1.0","/","SMAA_SEARCHTEX_PACKED_SIZE",";","return","GLSL_TEXTURE","(","iN",",","hG","*","iB","+","iO",",","0.0",")",".","r",";","}","float","iQ","(","sampler2D","iD",",","sampler2D","iN",",","vec2","b_",",","float","iJ",")","{","vec2","iB","=","vec2","(","0.0",",","1.0",")",";","for","(","int","cl","=","0",";","cl","<","SMAA_MAX_SEARCH_STEPS",";","cl","++",")","{","if","(","b_",".","x",">","iJ","&&","iB",".","g",">","0.8281","&&","iB",".","r","==","0.0",")","{","iB","=","GLSL_TEXTURE","(","iD",",","b_",",","0.0",")",".","rg",";","b_","=","-","vec2","(","2.0",",","0.0",")","*","u_texel_size","+","b_",";","}","}","float","fI","=","-","(","255.0","/","127.0",")","*","iP","(","iN",",","iB",",","0.0",")","+","3.25",";","return","u_texel_size",".","x","*","fI","+","b_",".","x",";","}","float","iR","(","sampler2D","iD",",","sampler2D","iN",",","vec2","b_",",","float","iJ",")","{","vec2","iB","=","vec2","(","0.0",",","1.0",")",";","for","(","int","cl","=","0",";","cl","<","SMAA_MAX_SEARCH_STEPS",";","cl","++",")","{","if","(","b_",".","x","<","iJ","&&","iB",".","g",">","0.8281","&&","iB",".","r","==","0.0",")","{","iB","=","GLSL_TEXTURE","(","iD",",","b_",",","0.0",")",".","rg",";","b_","=","vec2","(","2.0",",","0.0",")","*","u_texel_size","+","b_",";","}","}","float","fI","=","-","(","255.0","/","127.0",")","*","iP","(","iN",",","iB",",","0.5",")","+","3.25",";","return","-","u_texel_size",".","x","*","fI","+","b_",".","x",";","}","float","iS","(","sampler2D","iD",",","sampler2D","iN",",","vec2","b_",",","float","iJ",")","{","vec2","iB","=","vec2","(","1.0",",","0.0",")",";","for","(","int","cl","=","0",";","cl","<","SMAA_MAX_SEARCH_STEPS",";","cl","++",")","{","if","(","b_",".","y",">","iJ","&&","iB",".","r",">","0.8281","&&","iB",".","g","==","0.0",")","{","iB","=","GLSL_TEXTURE","(","iD",",","b_",",","0.0",")",".","rg",";","b_","=","-","vec2","(","0.0",",","2.0",")","*","u_texel_size","+","b_",";","}","}","float","fI","=","-","(","255.0","/","127.0",")","*","iP","(","iN",",","iB",".","gr",",","0.0",")","+","3.25",";","return","u_texel_size",".","y","*","fI","+","b_",".","y",";","}","float","iT","(","sampler2D","iD",",","sampler2D","iN",",","vec2","b_",",","float","iJ",")","{","vec2","iB","=","vec2","(","1.0",",","0.0",")",";","for","(","int","cl","=","0",";","cl","<","SMAA_MAX_SEARCH_STEPS",";","cl","++",")","{","if","(","b_",".","y","<","iJ","&&","iB",".","r",">","0.8281","&&","iB",".","g","==","0.0",")","{","iB","=","GLSL_TEXTURE","(","iD",",","b_",",","0.0",")",".","rg",";","b_","=","vec2","(","0.0",",","2.0",")","*","u_texel_size","+","b_",";","}","}","float","fI","=","-","(","255.0","/","127.0",")","*","iP","(","iN",",","iB",".","gr",",","0.5",")","+","3.25",";","return","-","u_texel_size",".","y","*","fI","+","b_",".","y",";","}","vec2","iW","(","sampler2D","iG",",","vec2","aM",",","float","iU",",","float","iV",",","float","fI",")","{","vec2","b_","=","vec2","(","SMAA_AREATEX_MAX_DISTANCE",",","SMAA_AREATEX_MAX_DISTANCE",")","*","io","(","4.0","*","vec2","(","iU",",","iV",")",")","+","aM",";","b_","=","SMAA_AREATEX_PIXEL_SIZE","*","b_","+","0.5","*","SMAA_AREATEX_PIXEL_SIZE",";","b_",".","y","=","SMAA_AREATEX_SUBTEX_SIZE","*","fI","+","b_",".","y",";","return","GLSL_TEXTURE","(","iG",",","b_",",","0.0",")",".","rg",";","}","void","iZ","(","sampler2D","iD",",","inout","vec2","ir",",","vec4","b_",",","vec2","dz",")","{"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_DISABLE_CORNER_DETECTION",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec2","iX","=","step","(","dz",".","xy",",","dz",".","yx",")",";","vec2","iY","=","(","1.0","-","SMAA_CORNER_ROUNDING_NORM",")","*","iX",";","iY","/=","iX",".","x","+","iX",".","y",";","vec2","aL","=","vec2","(","1.0",",","1.0",")",";","aL",".","x","-=","iY",".","x","*","GLSL_TEXTURE","(","iD",",","b_",".","xy","+","u_texel_size","*","vec2","(","0",",","1",")",",","0.0",")",".","r",";","aL",".","x","-=","iY",".","y","*","GLSL_TEXTURE","(","iD",",","b_",".","zw","+","u_texel_size","*","vec2","(","1",",","1",")",",","0.0",")",".","r",";","aL",".","y","-=","iY",".","x","*","GLSL_TEXTURE","(","iD",",","b_",".","xy","+","u_texel_size","*","vec2","(","0",",","-","2",")",",","0.0",")",".","r",";","aL",".","y","-=","iY",".","y","*","GLSL_TEXTURE","(","iD",",","b_",".","zw","+","u_texel_size","*","vec2","(","1",",","-","2",")",",","0.0",")",".","r",";","ir","*=","clamp","(","aL",",","0.0",",","1.0",")",";"]}]}}]},{TYPE:"txt",TOKENS:["}","void","i_","(","sampler2D","iD",",","inout","vec2","ir",",","vec4","b_",",","vec2","dz",")","{"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_DISABLE_CORNER_DETECTION",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec2","iX","=","step","(","dz",".","xy",",","dz",".","yx",")",";","vec2","iY","=","(","1.0","-","SMAA_CORNER_ROUNDING_NORM",")","*","iX",";","iY","/=","iX",".","x","+","iX",".","y",";","vec2","aL","=","vec2","(","1.0",",","1.0",")",";","aL",".","x","-=","iY",".","x","*","GLSL_TEXTURE","(","iD",",","b_",".","xy","+","u_texel_size","*","vec2","(","1",",","0",")",",","0.0",")",".","g",";","aL",".","x","-=","iY",".","y","*","GLSL_TEXTURE","(","iD",",","b_",".","zw","+","u_texel_size","*","vec2","(","1",",","1",")",",","0.0",")",".","g",";","aL",".","y","-=","iY",".","x","*","GLSL_TEXTURE","(","iD",",","b_",".","xy","+","u_texel_size","*","vec2","(","-","2",",","0",")",",","0.0",")",".","g",";","aL",".","y","-=","iY",".","y","*","GLSL_TEXTURE","(","iD",",","b_",".","zw","+","u_texel_size","*","vec2","(","-","2",",","1",")",",","0.0",")",".","g",";","ir","*=","clamp","(","aL",",","0.0",",","1.0",")",";"]}]}}]},{TYPE:"txt",TOKENS:["}"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec4","jc","(","vec2","b_",",","vec2","ja",",","sampler2D","iD",",","sampler2D","iG",",","sampler2D","iN",",","vec4","iI",")","{","vec4","ir","=","vec4","(","0.0",",","0.0",",","0.0",",","0.0",")",";","vec2","iB","=","GLSL_TEXTURE","(","iD",",","b_",")",".","rg",";","if","(","iB",".","g",">","0.0",")","{"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_DISABLE_DIAG_DETECTION",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["ir",".","rg","=","iM","(","iD",",","iG",",","b_",",","iB",",","iI",")",";","if","(","ir",".","r","==","-","ir",".","g",")","{"]}]}}]},{TYPE:"txt",TOKENS:["vec2","dz",";","vec3","iK",";","iK",".","x","=","iQ","(","iD",",","iN",",","hX",".","xy",",","hZ",".","x",")",";","iK",".","y","=","hY",".","y",";","dz",".","x","=","iK",".","x",";","float","iU","=","GLSL_TEXTURE","(","iD",",","iK",".","xy",",","0.0",")",".","r",";","iK",".","z","=","iR","(","iD",",","iN",",","hX",".","zw",",","hZ",".","y",")",";","dz",".","y","=","iK",".","z",";","dz","=","abs","(","io","(","dz","/","u_texel_size",".","xx","-","ja",".","xx",")",")",";","vec2","jb","=","sqrt","(","dz",")",";","float","iV","=","GLSL_TEXTURE","(","iD",",","iK",".","zy","+","u_texel_size","*","vec2","(","1",",","0",")",",","0.0",")",".","r",";","ir",".","rg","=","iW","(","iG",",","jb",",","iU",",","iV",",","iI",".","y",")",";","iK",".","y","=","b_",".","y",";","iZ","(","iD",",","ir",".","rg",",","iK",".","xyzy",",","dz",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_DISABLE_DIAG_DETECTION",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["}","else","iB",".","r","=","0.0",";"]}]}}]},{TYPE:"txt",TOKENS:["}","if","(","iB",".","r",">","0.0",")","{","vec2","dz",";","vec3","iK",";","iK",".","y","=","iS","(","iD",",","iN",",","hY",".","xy",",","hZ",".","z",")",";","iK",".","x","=","hX",".","x",";","dz",".","x","=","iK",".","y",";","float","iU","=","GLSL_TEXTURE","(","iD",",","iK",".","xy",",","0.0",")",".","g",";","iK",".","z","=","iT","(","iD",",","iN",",","hY",".","zw",",","hZ",".","w",")",";","dz",".","y","=","iK",".","z",";","dz","=","abs","(","io","(","dz","/","u_texel_size",".","yy","-","ja",".","yy",")",")",";","vec2","jb","=","sqrt","(","dz",")",";","float","iV","=","GLSL_TEXTURE","(","iD",",","iK",".","xz","+","u_texel_size","*","vec2","(","0",",","1",")",",","0.0",")",".","g",";","ir",".","ba","=","iW","(","iG",",","jb",",","iU",",","iV",",","iI",".","x",")",";","iK",".","x","=","b_",".","x",";","i_","(","iD",",","ir",".","ba",",","iK",".","xyxz",",","dz",")",";","}","return","ir",";","}"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec4","jl","(","vec2","b_",",","sampler2D","ip",",","sampler2D","jd"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_REPROJECTION"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:[",","sampler2D","je"]}]}}]},{TYPE:"txt",TOKENS:[")","{","vec4","a",";","a",".","x","=","GLSL_TEXTURE","(","jd",",","hW",".","xy",")",".","a",";","a",".","y","=","GLSL_TEXTURE","(","jd",",","hW",".","zw",")",".","g",";","a",".","wz","=","GLSL_TEXTURE","(","jd",",","b_",")",".","xz",";","if","(","dot","(","a",",","vec4","(","1.0",",","1.0",",","1.0",",","1.0",")",")","<","1e-5",")","{","vec4","aQ","=","GLSL_TEXTURE","(","ip",",","b_",",","0.0",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_REPROJECTION"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec4","jf","=","GLSL_TEXTURE","(","je",",","A",")",";","vec2","dl","=","2.0","*","jg","(","jf",")","-","1.0",";","aQ",".","a","=","sqrt","(","2.0","*","length","(","dl",")",")",";"]}]}}]},{TYPE:"txt",TOKENS:["return","aQ",";","}","else","{","bool","cj","=","max","(","a",".","x",",","a",".","z",")",">","max","(","a",".","y",",","a",".","w",")",";","vec4","jh","=","vec4","(","0.0",",","a",".","y",",","0.0",",","a",".","w",")",";","vec2","ji","=","a",".","yw",";","im","(","bvec4","(","cj",",","cj",",","cj",",","cj",")",",","jh",",","vec4","(","a",".","x",",","0.0",",","a",".","z",",","0.0",")",")",";","im","(","bvec2","(","cj",",","cj",")",",","ji",",","a",".","xz",")",";","ji","/=","dot","(","ji",",","vec2","(","1.0",",","1.0",")",")",";","vec4","jj","=","jh","*","vec4","(","u_texel_size",",","-","u_texel_size",")","+","b_",".","xyxy",";","vec4","aQ","=","ji",".","x","*","GLSL_TEXTURE","(","ip",",","jj",".","xy",",","0.0",")",";","aQ","+=","ji",".","y","*","GLSL_TEXTURE","(","ip",",","jj",".","zw",",","0.0",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_REPROJECTION"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec4","jf","=","GLSL_TEXTURE","(","je",",","jj",".","xy",")",";","vec2","jk","=","2.0","*","jg","(","jf",")","-","1.0",";","vec2","dl","=","ji",".","x","*","jk",";","jf","=","GLSL_TEXTURE","(","je",",","jj",".","zw",")",";","jk","=","2.0","*","jg","(","jf",")","-","1.0",";","dl","+=","ji",".","y","*","jk",";","aQ",".","a","=","sqrt","(","2.0","*","length","(","dl",")",")",";"]}]}}]},{TYPE:"txt",TOKENS:["return","aQ",";","}","}"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_PASS","SMAA_RESOLVE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec4","jq","(","vec2","b_",",","sampler2D","jm",",","sampler2D","jn"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_REPROJECTION"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:[",","sampler2D","je"]}]}}]},{TYPE:"txt",TOKENS:[")","{"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_REPROJECTION"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec4","jf","=","GLSL_TEXTURE","(","je",",","A",")",";","vec2","dl",";","dl","=","2.0","*","jg","(","jf",")","-","1.0",";","vec4","jo","=","GLSL_TEXTURE","(","jm",",","b_",")",";","vec4","jp","=","GLSL_TEXTURE","(","jn",",","b_","-","dl",")",";","float","cS","=","abs","(","jo",".","a","*","jo",".","a","-","jp",".","a","*","jp",".","a",")","/","2.0",";","float","cp","=","0.5","*","clamp","(","1.0","-","sqrt","(","cS",")","*","SMAA_REPROJECTION_WEIGHT_SCALE",",","0.0",",","1.0",")",";","vec4","aQ","=","mix","(","jo",",","jp",",","cp",")",";","aQ",".","a","=","1.0",";","return","aQ",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec4","jo","=","GLSL_TEXTURE","(","jm",",","b_",")",";","vec4","jp","=","GLSL_TEXTURE","(","jn",",","b_",")",";","return","mix","(","jo",",","jp",",","0.5",")",";"]}]}}]},{TYPE:"txt",TOKENS:["}"]}]}}]},{TYPE:"txt",TOKENS:["void","main","(",")","{"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_PASS","SMAA_EDGE_DETECTION",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec4","aQ","=","vec4","(","iA","(","A",",","u_color"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_PREDICATION"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:[",","u_predication_tex"]}]}}]},{TYPE:"txt",TOKENS:[")",",","0.0",",","0.0",")",";"]}]}},{TYPE:"elif",EXPRESSION:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec4","aQ","=","jc","(","A",",","h_",",","u_color",",","u_area_tex",",","u_search_tex",",","u_subsample_indices",")",";"]}]}},{TYPE:"elif",EXPRESSION:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec4","aQ","=","jl","(","A",",","u_color",",","u_blend"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_REPROJECTION"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:[",","u_velocity_tex"]}]}}]},{TYPE:"txt",TOKENS:[")",";"]}]}},{TYPE:"elif",EXPRESSION:["SMAA_PASS","SMAA_RESOLVE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec4","aQ","=","vec4","(","jq","(","A",",","u_color",",","u_color_prev"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_REPROJECTION"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:[",","u_velocity_tex"]}]}}]},{TYPE:"txt",TOKENS:[")",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec4","aQ","=","GLSL_TEXTURE","(","u_color",",","A",")",";"]}]}}]},{TYPE:"txt",TOKENS:["GLSL_OUT_FRAG_COLOR","=","aQ",";","}"]}]},e["postprocessing/smaa.glslv"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"PRECISION",TOKENS:["highp"]},{TYPE:"var",NAME:"SMAA_PASS",TOKENS:["SMAA_RESOLVE"]},{TYPE:"var",NAME:"AA_METHOD",TOKENS:["AA_METHOD_SMAA_LOW"]},{TYPE:"include",FILE:"std.glsl"},{TYPE:"txt",TOKENS:["uniform","PRECISION","vec2","u_texel_size",";","GLSL_IN","vec2","a_position",";","GLSL_OUT","vec2","A",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec4","hW",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec4","hX",";","GLSL_OUT","vec4","hY",";","GLSL_OUT","vec4","hZ",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec2","h_",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["AA_METHOD","AA_METHOD_SMAA_LOW",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"SMAA_MAX_SEARCH_STEPS",TOKENS:["4"]}]}},{TYPE:"elif",EXPRESSION:["AA_METHOD","AA_METHOD_SMAA_MEDIUM",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"SMAA_MAX_SEARCH_STEPS",TOKENS:["8"]}]}},{TYPE:"elif",EXPRESSION:["AA_METHOD","AA_METHOD_SMAA_HIGH",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"SMAA_MAX_SEARCH_STEPS",TOKENS:["16"]}]}},{TYPE:"elif",EXPRESSION:["AA_METHOD","AA_METHOD_SMAA_ULTRA",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"SMAA_MAX_SEARCH_STEPS",TOKENS:["32"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"SMAA_MAX_SEARCH_STEPS",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"SMAA_MAX_SEARCH_STEPS",TOKENS:["16"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_PASS","SMAA_EDGE_DETECTION",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["void","jr","(","vec2","b_",")","{","hX","=","u_texel_size",".","xyxy","*","vec4","(","-","1.0",",","0.0",",","0.0",",","-","1.0",")","+","b_",".","xyxy",";","hY","=","u_texel_size",".","xyxy","*","vec4","(","1.0",",","0.0",",","0.0",",","1.0",")","+","b_",".","xyxy",";","hZ","=","u_texel_size",".","xyxy","*","vec4","(","-","2.0",",","0.0",",","0.0",",","-","2.0",")","+","b_",".","xyxy",";","}"]}]}},{TYPE:"elif",EXPRESSION:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["void","js","(","vec2","b_",",","out","vec2","ja",")","{","ja","=","b_","/","u_texel_size",";","hX","=","u_texel_size",".","xyxy","*","vec4","(","-","0.25",",","-","0.125",",","1.25",",","-","0.125",")","+","b_",".","xyxy",";","hY","=","u_texel_size",".","xyxy","*","vec4","(","-","0.125",",","-","0.25",",","-","0.125",",","1.25",")","+","b_",".","xyxy",";","hZ","=","u_texel_size",".","xxyy","*","vec4","(","-","2.0",",","2.0",",","-","2.0",",","2.0",")","*","float","(","SMAA_MAX_SEARCH_STEPS",")","+","vec4","(","hX",".","xz",",","hY",".","yw",")",";","}"]}]}},{TYPE:"elif",EXPRESSION:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["void","jt","(","vec2","b_",")","{","hW","=","u_texel_size",".","xyxy","*","vec4","(","1.0",",","0.0",",","0.0",",","1.0",")","+","b_",".","xyxy",";","}"]}]}}]},{TYPE:"txt",TOKENS:["void","main","(",")","{","A","=","2.0","*","a_position",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_PASS","SMAA_EDGE_DETECTION",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["jr","(","A",")",";"]}]}},{TYPE:"elif",EXPRESSION:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["js","(","A",",","h_",")",";"]}]}},{TYPE:"elif",EXPRESSION:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["jt","(","A",")",";"]}]}}]},{TYPE:"txt",TOKENS:["gl_Position","=","vec4","(","4.0","*","(","a_position",".","xy","-","0.25",")",",","0.0",",","1.0",")",";","}"]}]},e["postprocessing/ssao.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"PRECISION",TOKENS:["highp"]},{TYPE:"var",NAME:"SSAO_WHITE",TOKENS:["0"]},{TYPE:"var",NAME:"SSAO_QUALITY",TOKENS:["SSAO_QUALITY_8"]},{TYPE:"var",NAME:"SSAO_HEMISPHERE",TOKENS:["0"]},{TYPE:"txt",TOKENS:["precision","PRECISION","sampler2D",";"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",FILE:"depth_fetch.glslf"},{TYPE:"txt",TOKENS:["uniform","sampler2D","u_color",";","uniform","sampler2D","u_depth",";","uniform","sampler2D","u_ssao_special_tex",";","uniform","vec2","u_camera_range",";","uniform","vec2","u_texel_size",";","uniform","float","u_ssao_radius_increase",";","uniform","float","u_ssao_influence",";","uniform","float","u_ssao_dist_factor",";","GLSL_IN","vec2","A",";","GLSL_OUT","vec4","GLSL_OUT_FRAG_COLOR",";","float","ju","(","in","vec2","fW",")","{","return","gy","(","u_depth",",","fW",",","u_camera_range",")",";","}","void","main","(",")","{","vec3","gC","=","GLSL_TEXTURE","(","u_color",",","A",")",".","rgb",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SSAO_WHITE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT_FRAG_COLOR","=","vec4","(","gC",",","1.0",")",";","return",";"]}]}}]},{TYPE:"txt",TOKENS:["vec3","jv","=","normalize","(","2.0","*","GLSL_TEXTURE","(","u_ssao_special_tex",",","A","*","0.25","/","u_texel_size",")",".","rgb","-","1.0",")",";","float","eq","=","ju","(","A",")",";","float","jw","=","eq","*","(","u_camera_range",".","y","-","u_camera_range",".","x",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SSAO_QUALITY","SSAO_QUALITY_8",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["const","float","jx","=","8.0",";","const","int","jy","=","1",";"]}]}},{TYPE:"elif",EXPRESSION:["SSAO_QUALITY","SSAO_QUALITY_16",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["const","float","jx","=","16.0",";","const","int","jy","=","2",";"]}]}},{TYPE:"elif",EXPRESSION:["SSAO_QUALITY","SSAO_QUALITY_24",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["const","float","jx","=","24.0",";","const","int","jy","=","3",";"]}]}},{TYPE:"elif",EXPRESSION:["SSAO_QUALITY","SSAO_QUALITY_32",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["const","float","jx","=","32.0",";","const","int","jy","=","4",";"]}]}}]},{TYPE:"txt",TOKENS:["float","jz","=","u_ssao_radius_increase","*","0.001",";","const","float","jA","=","1.0","+","2.4","/","jx",";","float","jB","=","0.0",";","for","(","int","cl","=","0",";","cl","<","jy",";","cl","++",")","for","(","int","x","=","-","1",";","x","<=","1",";","x","+=","2",")","for","(","int","y","=","-","1",";","y","<=","1",";","y","+=","2",")","for","(","int","z","=","-","1",";","z","<=","1",";","z","+=","2",")","{","vec3","jC","=","reflect","(","normalize","(","vec3","(","x",",","y",",","z",")",")",",","jv",")","*","(","jz","*=","jA",")",";","vec3","jD","=","vec3","(","A",",","jw",")",";","jD","+=","vec3","(","jC",".","xy",",","jC",".","z","*","jw","*","2.0",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SSAO_HEMISPHERE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["jD",".","z","-=","1.4","*","(","jD",".","z","-","jw",")","*","step","(","jw",",","jD",".","z",")",";"]}]}}]},{TYPE:"txt",TOKENS:["float","jE","=","ju","(","jD",".","xy",")","*","(","u_camera_range",".","y","-","u_camera_range",".","x",")",";","float","jF","=","clamp","(","(","jw","-","jE",")","/","jE",",","0.0",",","1.0",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SSAO_HEMISPHERE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["jB","+=","mix","(","1.0",",","jF",",","step","(","jE",",","jD",".","z",")",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["jB","+=","mix","(","step","(","jD",".","z",",","jE",")",",","0.5",",","jF",")",";"]}]}}]},{TYPE:"txt",TOKENS:["}","jB","=","jB","/","jx",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SSAO_HEMISPHERE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["jB","=","clamp","(","jB","*","jB","+","0.6","*","jB",",","0.0",",","1.0",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["jB","=","clamp","(","jB","*","jB","+","jB",",","0.0",",","1.0",")",";"]}]}}]},{TYPE:"txt",TOKENS:["float","jG","=","u_ssao_influence","*","(","1.0","-","u_ssao_dist_factor","*","eq",")",";","jB","=","mix","(","1.0",",","jB",",","jG",")",";","GLSL_OUT_FRAG_COLOR","=","vec4","(","gC",",","jB",")",";","}"]}]},e["postprocessing/ssao_blur.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"PRECISION",TOKENS:["highp"]},{TYPE:"var",NAME:"SSAO_BLUR_DEPTH",TOKENS:["0"]},{TYPE:"txt",TOKENS:["precision","PRECISION","sampler2D",";"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SSAO_BLUR_DEPTH"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"depth_fetch.glslf"}]}}]},{TYPE:"txt",TOKENS:["uniform","sampler2D","u_ssao_mask",";","uniform","vec2","u_texel_size",";","GLSL_IN","vec2","A",";","GLSL_OUT","vec4","GLSL_OUT_FRAG_COLOR",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SSAO_BLUR_DEPTH"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_depth",";","uniform","vec2","u_camera_range",";","uniform","float","u_ssao_blur_discard_value",";","float","ju","(","in","vec2","fW",")","{","return","gy","(","u_depth",",","fW",",","u_camera_range",")",";","}"]}]}}]},{TYPE:"txt",TOKENS:["void","main","(",")","{","float","jH","=","0.0",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SSAO_BLUR_DEPTH"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","jI","=","ju","(","A",")",";","float","cp","=","0.0",";","float","jJ","=","u_ssao_blur_discard_value","*","100.0",";"]}]}}]},{TYPE:"txt",TOKENS:["vec2","jK","=","vec2","(","-","2.0",")",";","for","(","int","cl","=","0",";","cl","<","4",";","++","cl",")","{","for","(","int","jL","=","0",";","jL","<","4",";","++","jL",")","{","vec2","fI","=","(","jK","+","vec2","(","float","(","cl",")",",","float","(","jL",")",")",")","*","u_texel_size",";","float","jM","=","GLSL_TEXTURE","(","u_ssao_mask",",","A","+","fI",")",".","a",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SSAO_BLUR_DEPTH"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","jN","=","ju","(","A","+","fI",")",";","float","jO","=","1.0","-","clamp","(","abs","(","jN","-","jI",")","*","jJ",",","0.0",",","1.0",")",";","jH","+=","jM","*","jO",";","cp","+=","jO",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["jH","+=","jM",";"]}]}}]},{TYPE:"txt",TOKENS:["}","}"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SSAO_BLUR_DEPTH"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT_FRAG_COLOR","=","vec4","(","GLSL_TEXTURE","(","u_ssao_mask",",","A",")",".","rgb",",","jH","/","cp",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT_FRAG_COLOR","=","vec4","(","GLSL_TEXTURE","(","u_ssao_mask",",","A",")",".","rgb",",","jH","/","16.0",")",";"]}]}}]},{TYPE:"txt",TOKENS:["}"]}]},e["postprocessing/stereo.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"ANAGLYPH",TOKENS:["0"]},{TYPE:"var",NAME:"SIDEBYSIDE",TOKENS:["0"]},{TYPE:"var",NAME:"EPSILON",TOKENS:["0.000001"]},{TYPE:"var",NAME:"DISTOR_SCALE",TOKENS:["0.8"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",FILE:"color_util.glslf"},{TYPE:"txt",TOKENS:["uniform","sampler2D","u_sampler_left",";","uniform","sampler2D","u_sampler_right",";","uniform","vec2","u_texel_size",";","GLSL_IN","vec2","A",";","GLSL_OUT","vec4","GLSL_OUT_FRAG_COLOR",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["ANAGLYPH",{TYPE:"logic_negative_expr",PLACES:1},"SIDEBYSIDE",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","int","u_enable_hmd_stereo",";","uniform","vec4","u_distortion_params",";","uniform","vec4","u_chromatic_aberration_coefs",";","void","jX","(","vec2","b_",",","vec2","ao",",","float","df",",","sampler2D","jP",")","{","vec2","bz","=","(","b_","-","ao",")","*","4.0","*","u_texel_size","[","0","]","/","u_texel_size","[","1","]","/","df",";","float","jQ","=","bz",".","x","*","bz",".","x","+","bz",".","y","*","bz",".","y",";","vec2","jR","=","bz","*","(","1.0","+","u_distortion_params","[","0","]","*","jQ","+","u_distortion_params","[","1","]","*","jQ","*","jQ",")",";","vec2","jS","=","jR","*","0.5","/","(","1.0","+","u_distortion_params","[","0","]","+","u_distortion_params","[","1","]",")",";","if","(","length","(","u_chromatic_aberration_coefs",")",">","0.0",")","{","vec2","jT","=","jS","*","(","1.0","+","u_chromatic_aberration_coefs","[","0","]","+","jQ","*","u_chromatic_aberration_coefs","[","1","]",")","+","0.5",";","vec2","jU","=","jS","+","0.5",";","vec2","jV","=","jS","*","(","1.0","+","u_chromatic_aberration_coefs","[","2","]","+","jQ","*","u_chromatic_aberration_coefs","[","3","]",")","+","0.5",";","if","(","clamp","(","jV",",","0.0",",","1.0",")","!=","jV",")","{","GLSL_OUT_FRAG_COLOR","=","vec4","(","0.0",")",";","}","else","{","vec4","jW","=","GLSL_TEXTURE","(","jP",",","jU",")",";","GLSL_OUT_FRAG_COLOR","[","0","]","=","GLSL_TEXTURE","(","jP",",","jT",")",".","x",";","GLSL_OUT_FRAG_COLOR","[","1","]","=","jW",".","y",";","GLSL_OUT_FRAG_COLOR","[","2","]","=","GLSL_TEXTURE","(","jP",",","jV",")",".","z",";","GLSL_OUT_FRAG_COLOR","[","3","]","=","jW",".","w",";","}","}","else","{","jS","+=","0.5",";","if","(","clamp","(","jS",",","0.0",",","1.0",")","!=","jS",")","{","GLSL_OUT_FRAG_COLOR","=","vec4","(","0.0",")",";","}","else","{","GLSL_OUT_FRAG_COLOR","=","GLSL_TEXTURE","(","jP",",","jS",")",";","}","}","}"]}]}}]},{TYPE:"txt",TOKENS:["void","main","(",")","{"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["ANAGLYPH"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec4","jY","=","GLSL_TEXTURE","(","u_sampler_left",",","A",")",";","vec4","jZ","=","GLSL_TEXTURE","(","u_sampler_right",",","A",")",";","vec3","j_","=","vec3","(","jY","[","0","]",",","jY","[","1","]",",","jY","[","2","]",")",";","bC","(","j_",")",";","vec3","ka","=","vec3","(","jZ","[","0","]",",","jZ","[","1","]",",","jZ","[","2","]",")",";","bC","(","ka",")",";","mat3","kb","=","mat3","(","0.437",",","-","0.062",",","-","0.048",",","0.449",",","-","0.062",",","-","0.050",",","0.164",",","-","0.024",",","-","0.017",")",";","mat3","bv","=","mat3","(","-","0.011",",","0.377",",","-","0.026",",","-","0.032",",","0.761",",","-","0.093",",","-","0.007",",","0.009",",","1.234",")",";","vec3","aQ","=","clamp","(","kb","*","j_",",","0.0",",","1.0",")","+","clamp","(","bv","*","ka",",","0.0",",","1.0",")",";","aW","(","aQ",")",";","GLSL_OUT_FRAG_COLOR","=","vec4","(","aQ",",","jY","[","3","]","+","jZ","[","3","]",")",";"]}]}},{TYPE:"elif",EXPRESSION:["SIDEBYSIDE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["if","(","A","[","0","]","<","0.5",")","{","vec2","b_","=","vec2","(","2.0","*","A","[","0","]",",","A","[","1","]",")",";","GLSL_OUT_FRAG_COLOR","=","GLSL_TEXTURE","(","u_sampler_left",",","b_",")",";","}","else","{","vec2","b_","=","vec2","(","2.0","*","(","A","[","0","]","-","0.5",")",",","A","[","1","]",")",";","GLSL_OUT_FRAG_COLOR","=","GLSL_TEXTURE","(","u_sampler_right",",","b_",")",";","}"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["if","(","u_enable_hmd_stereo","!=","0",")","{","if","(","abs","(","u_distortion_params","[","0","]",")",">","EPSILON","||","abs","(","u_distortion_params","[","1","]",")",">","EPSILON",")","if","(","A","[","0","]","<","0.5",")","{","vec2","b_","=","vec2","(","2.0","*","A","[","0","]",",","A","[","1","]",")",";","vec2","ao","=","vec2","(","0.5","-","(","u_distortion_params","[","3","]","-","0.5",")","/","2.0",",","u_distortion_params","[","2","]",")",";","float","df","=","2.0","*","u_distortion_params","[","3","]","*","DISTOR_SCALE",";","jX","(","b_",",","ao",",","df",",","u_sampler_left",")",";","}","else","{","vec2","b_","=","vec2","(","2.0","*","(","A","[","0","]","-","0.5",")",",","A","[","1","]",")",";","vec2","ao","=","vec2","(","0.5","+","(","u_distortion_params","[","3","]","-","0.5",")","/","2.0",",","u_distortion_params","[","2","]",")",";","float","df","=","2.0","*","u_distortion_params","[","3","]","*","DISTOR_SCALE",";","jX","(","b_",",","ao",",","df",",","u_sampler_right",")",";","}","else","if","(","A","[","0","]","<","0.5",")","{","vec2","b_","=","vec2","(","2.0","*","A","[","0","]",",","A","[","1","]",")",";","GLSL_OUT_FRAG_COLOR","=","GLSL_TEXTURE","(","u_sampler_left",",","b_",")",";","}","else","{","vec2","b_","=","vec2","(","2.0","*","(","A","[","0","]","-","0.5",")",",","A","[","1","]",")",";","GLSL_OUT_FRAG_COLOR","=","GLSL_TEXTURE","(","u_sampler_right",",","b_",")",";","}","}","else","{","GLSL_OUT_FRAG_COLOR","=","GLSL_TEXTURE","(","u_sampler_left",",","A",")",";","}"]}]}}]},{TYPE:"txt",TOKENS:["}"]}]},e["postprocessing/velocity.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",FILE:"pack.glslf"},{TYPE:"txt",TOKENS:["uniform","sampler2D","u_depth",";","uniform","mat4","u_view_proj_inverse",";","uniform","mat4","u_view_proj_prev",";","GLSL_IN","vec2","A",";","GLSL_OUT","vec4","GLSL_OUT_FRAG_COLOR",";","void","main","(",")","{","float","eq","=","GLSL_TEXTURE","(","u_depth",",","A",")",".","x",";","vec4","kc","=","vec4","(","A","*","2.0","-","1.0",",","2.0","*","eq","-","1.0",",","1.0",")",";","vec4","cy","=","u_view_proj_inverse","*","kc",";","vec4","kd","=","cy","/","cy",".","w",";","vec4","ke","=","u_view_proj_prev","*","kd",";","ke","/=","ke",".","w",";","vec2","dl","=","(","kc",".","xy","-","ke",".","xy",")","/","4.0","+","0.5",";","dl","=","clamp","(","dl",",","0.0",",","1.0",")",";","GLSL_OUT_FRAG_COLOR","=","er","(","dl",")",";","}"]}]},e["include/blending.glslf"]={TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"BLENDING_GLSLF",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"BLENDING_GLSLF",TOKENS:[""]},{TYPE:"txt",TOKENS:["vec3","kf","(","vec3","rgb",")","{","vec4","hI","=","vec4","(","_0_0",",","-","_1_0","/","3.0",",","2.0","/","3.0",",","-","_1_0",")",";","vec4","p","=","mix","(","vec4","(","rgb",".","bg",",","hI",".","wz",")",",","vec4","(","rgb",".","gb",",","hI",".","xy",")",",","step","(","rgb",".","b",",","rgb",".","g",")",")",";","vec4","q","=","mix","(","vec4","(","p",".","xyw",",","rgb",".","r",")",",","vec4","(","rgb",".","r",",","p",".","yzx",")",",","step","(","p",".","x",",","rgb",".","r",")",")",";","float","dz","=","q",".","x","-","min","(","q",".","w",",","q",".","y",")",";","float","iB","=","1.0e-10",";","return","vec3","(","abs","(","q",".","z","+","(","q",".","w","-","q",".","y",")","/","(","6.0","*","dz","+","iB",")",")",",","dz","/","(","q",".","x","+","iB",")",",","q",".","x",")",";","}","vec3","kh","(","vec3","kg",")","{","vec4","hI","=","vec4","(","_1_0",",","2.0","/","3.0",",","_1_0","/","3.0",",","3.0",")",";","vec3","p","=","abs","(","fract","(","vec3","(","kg",".","r",",","kg",".","r",",","kg",".","r",")","+","hI",".","xyz",")","*","6.0","-","hI",".","www",")",";","return","kg",".","b","*","mix","(","hI",".","xxx",",","clamp","(","p","-","hI",".","xxx",",","_0_0",",","_1_0",")",",","kg",".","g",")",";","}","vec3","kl","(","vec3","ki",",","vec3","kj",",","float","kk",")","{","return","mix","(","ki",",","kj",",","kk",")",";","}","vec3","km","(","vec3","ki",",","vec3","kj",",","float","kk",")","{","return","kk","*","ki","+","kj",";","}","vec3","kn","(","vec3","ki",",","vec3","kj",",","float","kk",")","{","return","kj","-","kk","*","ki",";","}","vec3","kp","(","vec3","ki",",","vec3","kj",",","float","kk",")","{","float","ko","=","_1_0","-","kk",";","return","(","vec3","(","ko",")","+","kk","*","ki",")","*","kj",";","}","vec3","kq","(","vec3","ki",",","vec3","kj",",","float","kk",")","{","vec3","ko","=","vec3","(","_1_0","-","kk",")",";","return","vec3","(","_1_0",")","-","(","ko","+","kk","*","(","vec3","(","_1_0",")","-","ki",")",")","*","(","vec3","(","_1_0",")","-","kj",")",";","}","vec3","kr","(","vec3","ki",",","vec3","kj",",","float","kk",")","{","vec3","ko","=","vec3","(","_1_0","-","kk",")",";","return","mix","(","kj","*","(","ko","+","2.0","*","kk","*","ki",")",",","vec3","(","_1_0",")","-","(","ko","+","2.0","*","kk","*","(","vec3","(","_1_0",")","-","ki",")",")","*","(","vec3","(","_1_0",")","-","kj",")",",","step","(","0.5",",","kj",")",")",";","}","vec3","ks","(","vec3","ki",",","vec3","kj",",","float","kk",")","{","return","mix","(","kj",",","abs","(","ki","-","kj",")",",","kk",")",";","}","vec3","kt","(","vec3","ki",",","vec3","kj",",","float","kk",")","{","return","mix","(","kj",",","kj","/","(","ki","+","step","(","ki",",","vec3","(","_0_0",")",")",")",",","kk",")",";","}","vec3","ku","(","vec3","ki",",","vec3","kj",",","float","kk",")","{","return","mix","(","kj",",","min","(","ki",",","kj",")",",","kk",")",";","}","vec3","kv","(","vec3","ki",",","vec3","kj",",","float","kk",")","{","return","max","(","kk","*","ki",",","kj",")",";","}","vec3","kz","(","vec3","ki",",","vec3","kj",",","float","kk",")","{","vec3","kw","=","kf","(","kj",")",";","if","(","kw",".","y","!=","_0_0",")","{","vec3","kx","=","kf","(","ki",")",";","vec3","ky","=","kh","(","vec3","(","kw",".","x",",","kx",".","yz",")",")",";","return","mix","(","ki",",","ky",",","kk",")",";","}","return","ki",";","}","vec3","kA","(","vec3","ki",",","vec3","kj",",","float","kk",")","{","vec3","kw","=","kf","(","ki",")",";","if","(","kw",".","y","!=","_0_0",")","{","vec3","kx","=","kf","(","kj",")",";","return","kh","(","vec3","(","kw",".","x",",","mix","(","kw",".","y",",","kx",".","y",",","kk",")",",","kw",".","z",")",")",";","}","return","ki",";","}","vec3","kB","(","vec3","ki",",","vec3","kj",",","float","kk",")","{","vec3","kw","=","kf","(","ki",")",";","vec3","kx","=","kf","(","kj",")",";","return","kh","(","vec3","(","kw",".","xy",",","mix","(","kw",".","z",",","kx",".","z",",","kk",")",")",")",";","}","vec3","kC","(","vec3","ki",",","vec3","kj",",","float","kk",")","{","vec3","kw","=","kf","(","kj",")",";","if","(","kw",".","y","!=","_0_0",")","{","vec3","kx","=","kf","(","ki",")",";","vec3","ky","=","kh","(","vec3","(","kw",".","xy",",","kx",".","z",")",")",";","return","mix","(","ki",",","ky",",","kk",")",";","}","return","ki",";","}","vec3","kE","(","vec3","ki",",","vec3","kj",",","float","kk",")","{","vec3","kD","=","vec3","(","_1_0",")","-","(","vec3","(","_1_0",")","-","kj",")","*","(","vec3","(","_1_0",")","-","ki",")",";","return","mix","(","ki",",","(","(","vec3","(","_1_0",")","-","ki",")","*","kj","*","ki",")","+","ki","*","kD",",","kk",")",";","}","vec3","kF","(","vec3","ki",",","vec3","kj",",","float","kk",")","{","return","ki","+","kk","*","(","2.0","*","kj","-","_1_0",")",";","}","float","kJ","(","float","kG",",","float","kH",",","float","kk",",","float","kI",")","{","float","ko","=","_1_0","-","kI",";","return","(","ko","+","kk","*","kG",")","*","kH",";","}","float","kK","(","float","kG",",","float","kH",",","float","kk",",","float","kI",")","{","float","ko","=","_1_0","-","kI",";","return","_1_0","-","(","ko","+","kk","*","(","_1_0","-","kG",")",")","*","(","_1_0","-","kH",")",";","}","float","kL","(","float","kG",",","float","kH",",","float","kk",",","float","kI",")","{","float","ko","=","_1_0","-","kI",";","return","mix","(","kH","*","(","ko","+","2.0","*","kk","*","kG",")",",","_1_0","-","(","ko","+","2.0","*","kk","*","(","_1_0","-","kG",")",")","*","(","_1_0","-","kH",")",",","step","(","0.5",",","kH",")",")",";","}"]}]}}]}]},e["include/caustics.glslf"]={TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"CAUSTICS_GLSLF",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"CAUSTICS_GLSLF",TOKENS:[""]},{TYPE:"var",NAME:"SUN_NUM",TOKENS:["0"]},{TYPE:"var",NAME:"CAUST_SCALE",TOKENS:["0.25"]},{TYPE:"var",NAME:"CAUST_SPEED",TOKENS:["vec2","(","0.0",")"]},{TYPE:"var",NAME:"CAUST_BRIGHT",TOKENS:["0.5"]},{TYPE:"include",FILE:"procedural.glslf"},{TYPE:"include",FILE:"math.glslv"},{TYPE:"define",NAME:"CAUSTICS_VIEW_DISTANCE",TOKENS:["100.0"]},{TYPE:"txt",TOKENS:["void","bQ","(","inout","vec3","aQ",",","float","kM",",","float","fu",",","vec4","bP",",","vec3","U",",","vec3","kN",",","vec3","kO",",","vec4","kP",",","vec3","bo",",","float","bN",")","{","if","(","bN",">","CAUSTICS_VIEW_DISTANCE",")","return",";","vec3","kQ","=","bo","+","U",";","kQ",".","xz","=","10.0","*","sin","(","0.1","*","kQ",".","xz",")",";","vec3","kS","=","T","(","kR","(","kP",")",",","kQ",")",";","vec2","b_","=","kS",".","xz",";","vec3","kT","=","kN",";","float","kU","=","max","(","dot","(","U",",","kT",")",",","0.0",")",";","float","kV","=","0.025",";","vec2","kW","=","CAUST_SPEED","*","fu",";","b_",".","s","+=","0.25","*","sin","(","dot","(","bo","+","fu",",","vec3","(","1.0",")",")",")",";","b_",".","t","+=","0.35","*","(","-","sin","(","dot","(","bo","-","fu",",","vec3","(","-","0.7",")",")",")",")",";","b_",".","st","+=","0.15","*","cos","(","4.0","*","kM","-","kW",".","x",")","+","1.5","*","sin","(","kM","-","0.3","*","kW",".","y",")",";","float","hG","=","CAUST_SCALE","*","(","1.0","+","max","(","0.1","*","kM",",","0.0",")",")",";","vec3","kY","=","kX","(","(","b_","/","hG",")",",","kV",")",";","kY","*=","CAUST_BRIGHT",";","kY","*=","kY",";","float","kZ","=","min","(","0.25","*","kM",",","-","kM",")","+","1.0",";","kZ","=","max","(","kZ",",","0.0",")",";","float","k_","=","bP","[","SUN_NUM","]","*","kU",";","float","la","=","max","(","sign","(","kM",")",",","0.0",")",";","k_","=","k_","+","max","(","0.5","*","sign","(","-","U",".","y",")","*","la",",","0.0",")",";","k_","=","min","(","k_",",","1.0",")",";","aQ","+=","kO","*","kY","*","kZ","*","k_",";","}"]}]}}]}]},e["include/color_util.glslf"]={TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"COLOR_UTIL_GLSLF",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"COLOR_UTIL_GLSLF",TOKENS:[""]},{TYPE:"define",NAME:"PREMULTIPLY_ALPHA",TOKENS:["1"]},{TYPE:"var",NAME:"SRGB",TOKENS:["SRGB_NONE"]},{TYPE:"include",FILE:"std.glsl"},{TYPE:"txt",TOKENS:["void","bC","(","inout","float","aQ",")","{"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SRGB","SRGB_SIMPLE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["aQ","=","pow","(","aQ",",","2.2",")",";"]}]}},{TYPE:"elif",EXPRESSION:["SRGB","SRGB_PROPER",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["if","(","aQ","<","0.04045",")","aQ","=","aQ","/","12.92",";","else","aQ","=","pow","(","aQ","*","(","1.0","/","1.055",")","+","0.0521327",",","2.4",")",";"]}]}}]},{TYPE:"txt",TOKENS:["}","void","aW","(","inout","float","aQ",")","{"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SRGB","SRGB_SIMPLE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["aQ","=","pow","(","aQ",",","1.0","/","2.2",")",";"]}]}},{TYPE:"elif",EXPRESSION:["SRGB","SRGB_PROPER",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["if","(","aQ","<","0.0031308",")","aQ","=","aQ","*","12.92",";","else","aQ","=","1.055","*","pow","(","aQ",",","1.0","/","2.4",")","-","0.055",";"]}]}}]},{TYPE:"txt",TOKENS:["}","void","bC","(","inout","vec3","aQ",")","{"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SRGB","SRGB_SIMPLE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["aQ","=","pow","(","aQ",",","vec3","(","2.2",")",")",";"]}]}},{TYPE:"elif",EXPRESSION:["SRGB","SRGB_PROPER",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["bC","(","aQ",".","r",")",";","bC","(","aQ",".","g",")",";","bC","(","aQ",".","b",")",";"]}]}}]},{TYPE:"txt",TOKENS:["}","void","aW","(","inout","vec3","aQ",")","{"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SRGB","SRGB_SIMPLE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["aQ","=","pow","(","aQ",",","vec3","(","1.0","/","2.2",")",")",";"]}]}},{TYPE:"elif",EXPRESSION:["SRGB","SRGB_PROPER",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["aW","(","aQ",".","r",")",";","aW","(","aQ",".","g",")",";","aW","(","aQ",".","b",")",";"]}]}}]},{TYPE:"txt",TOKENS:["}","void","aX","(","inout","vec3","aQ",",","in","float","L",")","{"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["PREMULTIPLY_ALPHA"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["aQ","=","aQ","*","L",";"]}]}}]},{TYPE:"txt",TOKENS:["}","float","ge","(","vec4","aQ",")","{","vec3","lb","=","vec3","(","0.299",",","0.587",",","0.114",")",";","float","lc","=","dot","(","aQ",".","rgb",",","lb",")",";","return","lc",";","}"]}]}}]}]},e["include/coverage.glslf"]={TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"COVERAGE_GLSLF",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"COVERAGE_GLSLF",TOKENS:[""]},{TYPE:"include",FILE:"procedural.glslf"},{TYPE:"txt",TOKENS:["const","float","ld","=","1000.0",";","bool","C","(","float","L",",","float","le",")","{","if","(","le","<","0.0",")","L","=","1.0","-","L",";","float","lf","=","floor","(","L","*","ld",")",";","float","lh","=","floor","(","lg","(","gl_FragCoord",".","xy",")","*","ld",")",";","if","(","le",">","0.0",")","return","lh","<","lf",";","else","return","lh",">=","lf",";","}"]}]}}]}]},e["include/depth_fetch.glslf"]={TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"DEPTH_FETCH_GLSLF",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"DEPTH_FETCH_GLSLF",TOKENS:[""]},{TYPE:"include",FILE:"std.glsl"},{TYPE:"var",NAME:"SHADOW_USAGE",TOKENS:["NO_SHADOWS"]},{TYPE:"var",NAME:"CAMERA_TYPE",TOKENS:["CAM_TYPE_PERSP"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADOW_USAGE","SHADOW_CASTING",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","ep","(","in","float","li",",","in","vec2","lj",")","{","float","dD","=","lj",".","x",";","float","lk","=","lj",".","y",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CAMERA_TYPE","CAM_TYPE_PERSP",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["return","lk","*","(","1.0","-","dD","/","li",")","/","(","lk","-","dD",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["return","(","li","-","dD",")","/","(","lk","-","dD",")",";"]}]}}]},{TYPE:"txt",TOKENS:["}"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","gy","(","in","sampler2D","ll",",","in","vec2","fW",",","in","vec2","lj",")","{","float","eq","=","GLSL_TEXTURE","(","ll",",","fW",")",".","r",";","float","dD","=","lj",".","x",";","float","lk","=","lj",".","y",";","float","li","=","2.0","*","dD","/","(","dD","+","lk","-","(","2.0","*","eq","-","1.0",")","*","(","lk","-","dD",")",")",";","return","li",";","}"]}]}}]}]}}]}]},e["include/dynamic_grass.glslv"]={TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"DYNAMIC_GRASS_GLSLV",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"DYNAMIC_GRASS_GLSLV",TOKENS:[""]},{TYPE:"var",NAME:"PRECISION",TOKENS:["highp"]},{TYPE:"var",NAME:"DYNAMIC_GRASS",TOKENS:["0"]},{TYPE:"var",NAME:"BILLBOARD",TOKENS:["0"]},{TYPE:"var",NAME:"GRASS_TEXTURE_SIZE",TOKENS:["1024.0"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC_GRASS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"math.glslv"},{TYPE:"include",FILE:"to_world.glslv"},{TYPE:"txt",TOKENS:["vec2","lp","(","vec3","O",",","float","lm",",","vec2","ln",")","{","vec2","lo","=","vec2","(","(","O",".","x","-","ln",".","x",")","/","lm",",","(","O",".","y","-","ln",".","y",")","/","lm",")",";","return","fract","(","lo",")",";","}","vec2","lq","(","vec2","gT",",","float","lm",",","vec2","ln",")","{","return","vec2","(","gT",".","x","*","lm",",","gT",".","y","*","lm",")","+","ln",";","}","au","lr","(",")","{","return","au","(","vec3","(","-","10000.0",")",",","vec3","(","0.0",")",",","vec3","(","0.0",")",",","vec3","(","0.0",")",",","vec3","(","0.0",")",",","vec3","(","0.0",")",",","vec3","(","0.0",")",")",";","}"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["GLSL3"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec4","lB","(","sampler2D","ls",",","vec2","lt",")","{","float","lu","=","1.0","/","GRASS_TEXTURE_SIZE",";","vec4","lv","=","GLSL_TEXTURE","(","ls",",","lt",")",";","vec4","lw","=","GLSL_TEXTURE","(","ls",",","lt","+","vec2","(","lu",",","0.0",")",")",";","vec4","lx","=","GLSL_TEXTURE","(","ls",",","lt","+","vec2","(","0.0",",","lu",")",")",";","vec4","ly","=","GLSL_TEXTURE","(","ls",",","lt","+","vec2","(","lu",",","lu",")",")",";","float","a","=","fract","(","lt",".","x","*","GRASS_TEXTURE_SIZE",")",";","vec4","lz","=","mix","(","lv",",","lw",",","a",")",";","vec4","lA","=","mix","(","lx",",","ly",",","a",")",";","float","b","=","fract","(","lt",".","y","*","GRASS_TEXTURE_SIZE",")",";","return","mix","(","lz",",","lA",",","b",")",";","}"]}]}}]},{TYPE:"txt",TOKENS:["au","aZ","(","vec3","O",",","vec3","V",",","vec3","lC",",","vec3","W",",","vec3","U",",","vec3","ao",",","PRECISION","sampler2D","lD",",","sampler2D","lE",",","vec3","lF",",","float","lG",",","vec3","lH",",","vec4","lI",",","mat3","N",",","mat3","Z",")","{","vec3","lJ","=","T","(","lI",",","vec3","(","0.0",",","0.0",",","-","1.0",")",")",";","float","lK","=","-","lJ",".","x",";","float","lL","=","lJ",".","y",";","vec2","ln","=","vec2","(","lH",".","x","-","lG","*","(","1.0","+","lK",")","/","2.0",",","lH",".","y","-","lG","*","(","1.0","-","lL",")","/","2.0",")",";","vec2","lM","=","lp","(","ao",",","lG",",","ln",")",";","float","lN","=","lG","/","2.0",";","vec2","lO","=","abs","(","lq","(","lM","-","vec2","(","0.5",")",",","lG",",","vec2","(","0.0",")",")",")",";","float","lP","=","lN","*","(","1.0","+","sqrt","(","2.0",")",")","/","2.0",";","if","(","length","(","lO",")",">","lP",")","return","lr","(",")",";","float","lQ","=","lG","/","lF",".","z",";","vec2","lR","=","(","lM","-","vec2","(","0.5",")",")","*","lQ","+","vec2","(","0.5",")",";","vec3","lS","=","lJ","*","(","lG","/","lF",".","z","-","1.0",")","/","2.0",";","lR",".","x","+=","lS",".","x",";","lR",".","y","+=","lS",".","y",";","vec4","lT","=","GLSL_TEXTURE","(","lE",",","lR",")",";","float","hG","=","lT",".","r",";","if","(","hG","<","u_scale_threshold",")","return","lr","(",")",";","float","lU","=","lF",".","y","-","lF",".","x",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["GLSL3"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","ci","=","lF",".","y","-","(","lB","(","lD",",","lR",")",")",".","r","*","lU",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","ci","=","lF",".","y","-","(","GLSL_TEXTURE","(","lD",",","lR",")",")",".","r","*","lU",";"]}]}}]},{TYPE:"txt",TOKENS:["vec2","lV","=","O",".","xy","-","ao",".","xy",";","ao",".","xy","=","lq","(","lM",",","lG",",","ln",")",";","ao",".","z","=","ci",";","O",".","xy","=","ao",".","xy","+","lV",";","O",".","z","*=","hG",";","O",".","z","+=","ci",";","vec3","aQ","=","lT",".","gba",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["BILLBOARD"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["O","-=","ao",";","mat3","lW","=","as","(","lH",",","ao",",","N",",","Z",")",";","au","aw","=","av","(","O",",","ao",",","V",",","lC",",","W",",","U",",","lW",")",";","aw",".","ao","=","ao",";","aw",".","aQ","=","aQ",";","return","lX","(","aw",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["return","lX","(","au","(","O",",","ao",",","V",",","lC",",","W",",","U",",","aQ",")",")",";"]}]}}]},{TYPE:"txt",TOKENS:["}"]}]}}]}]}}]}]},e["include/environment.glslf"]={TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"ENVIRONMENT_GLSLF",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"ENVIRONMENT_GLSLF",TOKENS:[""]},{TYPE:"var",NAME:"USE_ENVIRONMENT_LIGHT",TOKENS:["0"]},{TYPE:"var",NAME:"SKY_COLOR",TOKENS:["0"]},{TYPE:"var",NAME:"SKY_TEXTURE",TOKENS:["0"]},{TYPE:"txt",TOKENS:["vec3","cz","(","vec3","U",")","{"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_ENVIRONMENT_LIGHT"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SKY_TEXTURE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["return","GLSL_TEXTURE_CUBE","(","u_sky_texture",",","U",")",".","rgb",";"]}]}},{TYPE:"elif",EXPRESSION:["SKY_COLOR"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","lY","=","0.5","*","U",".","z","+","0.5",";","return","mix","(","u_horizon_color",",","u_zenith_color",",","lY",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["return","vec3","(","1.0",")",";"]}]}}]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["return","vec3","(","0.0",")",";"]}]}}]},{TYPE:"txt",TOKENS:["}"]}]}}]}]},e["include/fog.glslf"]={TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"FOG_GLSLF",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FOG_GLSLF",TOKENS:[""]},{TYPE:"var",NAME:"USE_FOG",TOKENS:["0"]},{TYPE:"var",NAME:"WATER_EFFECTS",TOKENS:["0"]},{TYPE:"var",NAME:"FOG_TYPE",TOKENS:["QUADRATIC"]},{TYPE:"var",NAME:"PROCEDURAL_FOG",TOKENS:["0"]},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",FILE:"color_util.glslf"},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_FOG"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["void","mc","(","inout","vec3","aQ",",","in","float","lZ",",","in","float","ci",",","in","vec4","l_",")","{","float","ma","=","clamp","(","(","lZ","-","u_fog_params",".","z",")","/","u_fog_params",".","y",",","0.0",",","1.0",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FOG_TYPE","QUADRATIC",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["ma","*=","ma",";"]}]}},{TYPE:"elif",EXPRESSION:["FOG_TYPE","LINEAR",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[]}},{TYPE:"elif",EXPRESSION:["FOG_TYPE","INVERSE_QUADRATIC",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["ma","=","sqrt","(","ma",")",";"]}]}}]},{TYPE:"txt",TOKENS:["if","(","u_fog_params",".","w",">","0.0",")","{","if","(","ci",">","u_fog_params",".","w",")","ma","=","0.0",";","else","{","float","mb","=","(","u_fog_params",".","w","-","max","(","ci",",","0.0",")",")","/","u_fog_params",".","w",";","ma","*=","mb","*","mb",";","}","}","l_",".","a","=","1.0","-","(","1.0","-","ma",")","*","(","1.0","-","u_fog_params",".","x",")",";","aQ","=","mix","(","aQ",",","l_",".","rgb",",","l_",".","a",")",";","}"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["PROCEDURAL_FOG"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","mh","(","in","mat4","md",",","in","vec3","D",")","{","vec3","me","=","mix","(","md","[","0","]",".","rgb",",","md","[","1","]",".","rgb",",","(","D",".","x","+","1.0",")","/","2.0",")",";","vec3","mf","=","mix","(","md","[","2","]",".","rgb",",","md","[","3","]",".","rgb",",","(","D",".","y","+","1.0",")","/","2.0",")",";","vec3","mg","=","vec3","(","md","[","0","]",".","a",",","md","[","1","]",".","a",",","md","[","2","]",".","a",")",";","vec3","aQ","=","mix","(","me",",","mf",",","abs","(","D",".","y",")",")",";","aQ","=","mix","(","aQ",",","mg",",","abs","(","D",".","z",")",")",";","bC","(","aQ",")",";","return","aQ",";","}"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WATER_EFFECTS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["void","mj","(","inout","float","mi",")","{","mi","-=","0.5",";","mi","=","4.0","*","(","mi","*","mi","*","mi",")","+","0.5",";","}","void","mp","(","inout","vec3","aQ",",","in","float","lZ",",","in","vec3","D",",","in","float","eC",",","in","vec4","mk",",","in","float","fl",")","{","float","ml","=","max","(","D",".","z",",","0.0",")",";","float","mm","=","max","(","lZ","-","max","(","eC","/","ml",",","0.0",")",",","0.0",")",";","float","mn","=","mk",".","w","*","mm",";","vec3","eD","=","vec3","(","0.0",",","0.02",",","0.05",")",";","vec3","mo","=","mk",".","rgb",";","mn","=","min","(","mn",",","1.0",")",";","mj","(","mn",")",";","mn","*=","clamp","(","2.0","-","fl",",","0.0",",","1.0",")",";","vec3","eE","=","mix","(","mo",",","eD",",","min","(","ml",",","1.0",")",")",";","eC","=","clamp","(","-","eC","*","0.03",",","0.0",",","0.8",")",";","eE","*=","1.0","-","eC",";","aQ","=","mix","(","aQ",",","eE",",","mn",")",";","}"]}]}}]},{TYPE:"txt",TOKENS:["void","bR","(","inout","vec3","aQ",",","float","lZ",",","vec3","D",",","float","bO",")","{"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_FOG"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["PROCEDURAL_FOG"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","md","=","mh","(","u_cube_fog",",","D",")",";","vec4","eE","=","vec4","(","md",",","u_fog_color_density",".","a",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec4","eE","=","u_fog_color_density",";"]}]}}]},{TYPE:"txt",TOKENS:["mc","(","aQ",",","lZ",",","h",".","z",",","eE",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WATER_EFFECTS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["mp","(","aQ",",","lZ",",","D",",","u_cam_water_depth",",","u_underwater_fog_color_density",",","bO",")",";"]}]}}]},{TYPE:"txt",TOKENS:["}"]}]}}]}]},e["include/fxaa.glslf"]={TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"FXAA_GLSLF",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_GLSLF",TOKENS:[""]},{TYPE:"var",NAME:"FXAA_BLEND4WEB",TOKENS:["1"]},{TYPE:"var",NAME:"FXAA_QUALITY_P12",TOKENS:["0.0"]},{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"FXAA_PS3",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_PS3",TOKENS:["0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"FXAA_360",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_360",TOKENS:["0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"FXAA_360_OPT",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_360_OPT",TOKENS:["0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"FXAA_PC",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_PC",TOKENS:["0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"FXAA_PC_CONSOLE",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_PC_CONSOLE",TOKENS:["0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"FXAA_GLSL_120",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_GLSL_120",TOKENS:["0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"FXAA_GLSL_130",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_GLSL_130",TOKENS:["0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"FXAA_HLSL_3",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_HLSL_3",TOKENS:["0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"FXAA_HLSL_4",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_HLSL_4",TOKENS:["0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"FXAA_HLSL_5",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_HLSL_5",TOKENS:["0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"FXAA_GREEN_AS_LUMA",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_GREEN_AS_LUMA",TOKENS:["0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"FXAA_EARLY_EXIT",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_EARLY_EXIT",TOKENS:["1"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"FXAA_DISCARD",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_DISCARD",TOKENS:["0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"FXAA_FAST_PIXEL_OFFSET",GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"ifdef",NAME:"GL_EXT_gpu_shader4",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_FAST_PIXEL_OFFSET",TOKENS:["1"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifdef",NAME:"GL_NV_gpu_shader5",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_FAST_PIXEL_OFFSET",TOKENS:["1"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifdef",NAME:"GL_ARB_gpu_shader5",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_FAST_PIXEL_OFFSET",TOKENS:["1"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"FXAA_FAST_PIXEL_OFFSET",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_FAST_PIXEL_OFFSET",TOKENS:["0"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"FXAA_GATHER4_ALPHA",GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FXAA_HLSL_5",1,{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_GATHER4_ALPHA",TOKENS:["1"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifdef",NAME:"GL_ARB_gpu_shader5",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_GATHER4_ALPHA",TOKENS:["1"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifdef",NAME:"GL_NV_gpu_shader5",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_GATHER4_ALPHA",TOKENS:["1"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"FXAA_GATHER4_ALPHA",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_GATHER4_ALPHA",TOKENS:["0"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"FXAA_CONSOLE_PS3_EDGE_SHARPNESS",GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:[1],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_CONSOLE_PS3_EDGE_SHARPNESS",TOKENS:["8.0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:[0],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_CONSOLE_PS3_EDGE_SHARPNESS",TOKENS:["4.0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:[0],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_CONSOLE_PS3_EDGE_SHARPNESS",TOKENS:["2.0"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"FXAA_CONSOLE_PS3_EDGE_THRESHOLD",GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:[1],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_CONSOLE_PS3_EDGE_THRESHOLD",TOKENS:["0.125"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_CONSOLE_PS3_EDGE_THRESHOLD",TOKENS:["0.25"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"FXAA_QUALITY_PRESET",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_QUALITY_PRESET",TOKENS:["12"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FXAA_QUALITY_PRESET",10,{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_QUALITY_PS",TOKENS:["3"]},{TYPE:"define",NAME:"FXAA_QUALITY_P0",TOKENS:["1.5"]},{TYPE:"define",NAME:"FXAA_QUALITY_P1",TOKENS:["3.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P2",TOKENS:["12.0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FXAA_QUALITY_PRESET",11,{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_QUALITY_PS",TOKENS:["4"]},{TYPE:"define",NAME:"FXAA_QUALITY_P0",TOKENS:["1.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P1",TOKENS:["1.5"]},{TYPE:"define",NAME:"FXAA_QUALITY_P2",TOKENS:["3.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P3",TOKENS:["12.0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FXAA_QUALITY_PRESET",12,{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_QUALITY_PS",TOKENS:["5"]},{TYPE:"define",NAME:"FXAA_QUALITY_P0",TOKENS:["1.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P1",TOKENS:["1.5"]},{TYPE:"define",NAME:"FXAA_QUALITY_P2",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P3",TOKENS:["4.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P4",TOKENS:["12.0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FXAA_QUALITY_PRESET",13,{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_QUALITY_PS",TOKENS:["6"]},{TYPE:"define",NAME:"FXAA_QUALITY_P0",TOKENS:["1.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P1",TOKENS:["1.5"]},{TYPE:"define",NAME:"FXAA_QUALITY_P2",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P3",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P4",TOKENS:["4.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P5",TOKENS:["12.0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FXAA_QUALITY_PRESET",14,{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_QUALITY_PS",TOKENS:["7"]},{TYPE:"define",NAME:"FXAA_QUALITY_P0",TOKENS:["1.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P1",TOKENS:["1.5"]},{TYPE:"define",NAME:"FXAA_QUALITY_P2",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P3",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P4",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P5",TOKENS:["4.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P6",TOKENS:["12.0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FXAA_QUALITY_PRESET",15,{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_QUALITY_PS",TOKENS:["8"]},{TYPE:"define",NAME:"FXAA_QUALITY_P0",TOKENS:["1.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P1",TOKENS:["1.5"]},{TYPE:"define",NAME:"FXAA_QUALITY_P2",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P3",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P4",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P5",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P6",TOKENS:["4.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P7",TOKENS:["12.0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FXAA_QUALITY_PRESET",20,{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_QUALITY_PS",TOKENS:["3"]},{TYPE:"define",NAME:"FXAA_QUALITY_P0",TOKENS:["1.5"]},{TYPE:"define",NAME:"FXAA_QUALITY_P1",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P2",TOKENS:["8.0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FXAA_QUALITY_PRESET",21,{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_QUALITY_PS",TOKENS:["4"]},{TYPE:"define",NAME:"FXAA_QUALITY_P0",TOKENS:["1.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P1",TOKENS:["1.5"]},{TYPE:"define",NAME:"FXAA_QUALITY_P2",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P3",TOKENS:["8.0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FXAA_QUALITY_PRESET",22,{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_QUALITY_PS",TOKENS:["5"]},{TYPE:"define",NAME:"FXAA_QUALITY_P0",TOKENS:["1.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P1",TOKENS:["1.5"]},{TYPE:"define",NAME:"FXAA_QUALITY_P2",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P3",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P4",TOKENS:["8.0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FXAA_QUALITY_PRESET",23,{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_QUALITY_PS",TOKENS:["6"]},{TYPE:"define",NAME:"FXAA_QUALITY_P0",TOKENS:["1.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P1",TOKENS:["1.5"]},{TYPE:"define",NAME:"FXAA_QUALITY_P2",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P3",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P4",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P5",TOKENS:["8.0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FXAA_QUALITY_PRESET",24,{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_QUALITY_PS",TOKENS:["7"]},{TYPE:"define",NAME:"FXAA_QUALITY_P0",TOKENS:["1.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P1",TOKENS:["1.5"]},{TYPE:"define",NAME:"FXAA_QUALITY_P2",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P3",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P4",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P5",TOKENS:["3.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P6",TOKENS:["8.0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FXAA_QUALITY_PRESET",25,{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_QUALITY_PS",TOKENS:["8"]},{TYPE:"define",NAME:"FXAA_QUALITY_P0",TOKENS:["1.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P1",TOKENS:["1.5"]},{TYPE:"define",NAME:"FXAA_QUALITY_P2",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P3",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P4",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P5",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P6",TOKENS:["4.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P7",TOKENS:["8.0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FXAA_QUALITY_PRESET",26,{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_QUALITY_PS",TOKENS:["9"]},{TYPE:"define",NAME:"FXAA_QUALITY_P0",TOKENS:["1.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P1",TOKENS:["1.5"]},{TYPE:"define",NAME:"FXAA_QUALITY_P2",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P3",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P4",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P5",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P6",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P7",TOKENS:["4.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P8",TOKENS:["8.0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FXAA_QUALITY_PRESET",27,{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_QUALITY_PS",TOKENS:["10"]},{TYPE:"define",NAME:"FXAA_QUALITY_P0",TOKENS:["1.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P1",TOKENS:["1.5"]},{TYPE:"define",NAME:"FXAA_QUALITY_P2",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P3",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P4",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P5",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P6",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P7",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P8",TOKENS:["4.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P9",TOKENS:["8.0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FXAA_QUALITY_PRESET",28,{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_QUALITY_PS",TOKENS:["11"]},{TYPE:"define",NAME:"FXAA_QUALITY_P0",TOKENS:["1.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P1",TOKENS:["1.5"]},{TYPE:"define",NAME:"FXAA_QUALITY_P2",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P3",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P4",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P5",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P6",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P7",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P8",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P9",TOKENS:["4.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P10",TOKENS:["8.0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FXAA_QUALITY_PRESET",29,{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_QUALITY_PS",TOKENS:["12"]},{TYPE:"define",NAME:"FXAA_QUALITY_P0",TOKENS:["1.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P1",TOKENS:["1.5"]},{TYPE:"define",NAME:"FXAA_QUALITY_P2",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P3",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P4",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P5",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P6",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P7",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P8",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P9",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P10",TOKENS:["4.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P11",TOKENS:["8.0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FXAA_QUALITY_PRESET",39,{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_QUALITY_PS",TOKENS:["12"]},{TYPE:"define",NAME:"FXAA_QUALITY_P0",TOKENS:["1.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P1",TOKENS:["1.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P2",TOKENS:["1.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P3",TOKENS:["1.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P4",TOKENS:["1.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P5",TOKENS:["1.5"]},{TYPE:"define",NAME:"FXAA_QUALITY_P6",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P7",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P8",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P9",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P10",TOKENS:["4.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P11",TOKENS:["8.0"]}]}}]},{TYPE:"include",FILE:"color_util.glslf"},{TYPE:"txt",TOKENS:["float","mq","(","float","x",")","{","return","clamp","(","x",",","0.0",",","1.0",")",";","}"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FXAA_BLEND4WEB",1,{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec4","mr","(","sampler2D","t",",","vec2","p",")","{","return","GLSL_TEXTURE","(","t",",","p",")",";","}","vec4","mt","(","sampler2D","t",",","vec2","p",",","vec2","ms",",","vec2","r",")","{","return","GLSL_TEXTURE","(","t",",","p","+","(","ms","*","r",")",")",";","}"]}]}}]},{TYPE:"txt",TOKENS:["vec4","gv","(","vec2","fn",",","sampler2D","ia",",","vec2","mu",",","float","mv",",","float","mw",",","float","mx",")","{","vec2","my",";","my",".","x","=","fn",".","x",";","my",".","y","=","fn",".","y",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FXAA_GATHER4_ALPHA",1,{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec4","mz","=","mr","(","ia",",","my",")",";","float","gf","=","ge","(","mz",")",";","float","mA","=","ge","(","mt","(","ia",",","my",",","vec2","(","0",",","1",")",",","mu",".","xy",")",")",";","float","mB","=","ge","(","mt","(","ia",",","my",",","vec2","(","1",",","0",")",",","mu",".","xy",")",")",";","float","mC","=","ge","(","mt","(","ia",",","my",",","vec2","(","0",",","-","1",")",",","mu",".","xy",")",")",";","float","mD","=","ge","(","mt","(","ia",",","my",",","vec2","(","-","1",",","0",")",",","mu",".","xy",")",")",";"]}]}}]},{TYPE:"txt",TOKENS:["float","mE","=","max","(","mA",",","gf",")",";","float","mF","=","min","(","mA",",","gf",")",";","float","mG","=","max","(","mB",",","mE",")",";","float","mH","=","min","(","mB",",","mF",")",";","float","mI","=","max","(","mC",",","mD",")",";","float","mJ","=","min","(","mC",",","mD",")",";","float","mK","=","max","(","mI",",","mG",")",";","float","mL","=","min","(","mJ",",","mH",")",";","float","mM","=","mK","*","mw",";","float","mN","=","mK","-","mL",";","float","mO","=","max","(","mx",",","mM",")",";","bool","mP","=","mN","<","mO",";","if","(","mP",")","return","mz",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FXAA_GATHER4_ALPHA",0,{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","gh","=","ge","(","mt","(","ia",",","my",",","vec2","(","-","1",",","-","1",")",",","mu",".","xy",")",")",";","float","gk","=","ge","(","mt","(","ia",",","my",",","vec2","(","1",",","1",")",",","mu",".","xy",")",")",";","float","gi","=","ge","(","mt","(","ia",",","my",",","vec2","(","1",",","-","1",")",",","mu",".","xy",")",")",";","float","gj","=","ge","(","mt","(","ia",",","my",",","vec2","(","-","1",",","1",")",",","mu",".","xy",")",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[]}}]},{TYPE:"txt",TOKENS:["float","mQ","=","mC","+","mA",";","float","mR","=","mD","+","mB",";","float","mS","=","1.0","/","mN",";","float","mT","=","mQ","+","mR",";","float","mU","=","(","-","2.0","*","gf",")","+","mQ",";","float","mV","=","(","-","2.0","*","gf",")","+","mR",";","float","mW","=","gi","+","gk",";","float","mX","=","gh","+","gi",";","float","mY","=","(","-","2.0","*","mB",")","+","mW",";","float","mZ","=","(","-","2.0","*","mC",")","+","mX",";","float","m_","=","gh","+","gj",";","float","na","=","gj","+","gk",";","float","nb","=","(","abs","(","mU",")","*","2.0",")","+","abs","(","mY",")",";","float","nc","=","(","abs","(","mV",")","*","2.0",")","+","abs","(","mZ",")",";","float","nd","=","(","-","2.0","*","mD",")","+","m_",";","float","ne","=","(","-","2.0","*","mA",")","+","na",";","float","nf","=","abs","(","nd",")","+","nb",";","float","ng","=","abs","(","ne",")","+","nc",";","float","nh","=","m_","+","mW",";","float","ni","=","mu",".","x",";","bool","nj","=","nf",">=","ng",";","float","nk","=","mT","*","2.0","+","nh",";","if","(","!","nj",")","mC","=","mD",";","if","(","!","nj",")","mA","=","mB",";","if","(","nj",")","ni","=","mu",".","y",";","float","nl","=","(","nk","*","(","1.0","/","12.0",")",")","-","gf",";","float","nm","=","mC","-","gf",";","float","nn","=","mA","-","gf",";","float","no","=","mC","+","gf",";","float","np","=","mA","+","gf",";","bool","nq","=","abs","(","nm",")",">=","abs","(","nn",")",";","float","nr","=","max","(","abs","(","nm",")",",","abs","(","nn",")",")",";","if","(","nq",")","ni","=","-","ni",";","float","ns","=","mq","(","abs","(","nl",")","*","mS",")",";","vec2","nt",";","nt",".","x","=","my",".","x",";","nt",".","y","=","my",".","y",";","vec2","nu",";","nu",".","x","=","(","!","nj",")","?","0.0",":","mu",".","x",";","nu",".","y","=","(","nj",")","?","0.0",":","mu",".","y",";","if","(","!","nj",")","nt",".","x","+=","ni","*","0.5",";","if","(","nj",")","nt",".","y","+=","ni","*","0.5",";","vec2","nv",";","nv",".","x","=","nt",".","x","-","nu",".","x","*","FXAA_QUALITY_P0",";","nv",".","y","=","nt",".","y","-","nu",".","y","*","FXAA_QUALITY_P0",";","vec2","nw",";","nw",".","x","=","nt",".","x","+","nu",".","x","*","FXAA_QUALITY_P0",";","nw",".","y","=","nt",".","y","+","nu",".","y","*","FXAA_QUALITY_P0",";","float","nx","=","(","(","-","2.0",")","*","ns",")","+","3.0",";","float","ny","=","ge","(","mr","(","ia",",","nv",")",")",";","float","nz","=","ns","*","ns",";","float","nA","=","ge","(","mr","(","ia",",","nw",")",")",";","if","(","!","nq",")","no","=","np",";","float","nB","=","nr","*","1.0","/","4.0",";","float","nC","=","gf","-","no","*","0.5",";","float","nD","=","nx","*","nz",";","bool","nE","=","nC","<","0.0",";","ny","-=","no","*","0.5",";","nA","-=","no","*","0.5",";","bool","nF","=","abs","(","ny",")",">=","nB",";","bool","nG","=","abs","(","nA",")",">=","nB",";","if","(","!","nF",")","nv",".","x","-=","nu",".","x","*","FXAA_QUALITY_P1",";","if","(","!","nF",")","nv",".","y","-=","nu",".","y","*","FXAA_QUALITY_P1",";","bool","nH","=","(","!","nF",")","||","(","!","nG",")",";","if","(","!","nG",")","nw",".","x","+=","nu",".","x","*","FXAA_QUALITY_P1",";","if","(","!","nG",")","nw",".","y","+=","nu",".","y","*","FXAA_QUALITY_P1",";","if","(","nH",")","{","if","(","!","nF",")","ny","=","ge","(","mr","(","ia",",","nv",".","xy",")",")",";","if","(","!","nG",")","nA","=","ge","(","mr","(","ia",",","nw",".","xy",")",")",";","if","(","!","nF",")","ny","=","ny","-","no","*","0.5",";","if","(","!","nG",")","nA","=","nA","-","no","*","0.5",";","nF","=","abs","(","ny",")",">=","nB",";","nG","=","abs","(","nA",")",">=","nB",";","if","(","!","nF",")","nv",".","x","-=","nu",".","x","*","FXAA_QUALITY_P2",";","if","(","!","nF",")","nv",".","y","-=","nu",".","y","*","FXAA_QUALITY_P2",";","nH","=","(","!","nF",")","||","(","!","nG",")",";","if","(","!","nG",")","nw",".","x","+=","nu",".","x","*","FXAA_QUALITY_P2",";","if","(","!","nG",")","nw",".","y","+=","nu",".","y","*","FXAA_QUALITY_P2",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FXAA_QUALITY_PS",3,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["if","(","nH",")","{","if","(","!","nF",")","ny","=","ge","(","mr","(","ia",",","nv",".","xy",")",")",";","if","(","!","nG",")","nA","=","ge","(","mr","(","ia",",","nw",".","xy",")",")",";","if","(","!","nF",")","ny","=","ny","-","no","*","0.5",";","if","(","!","nG",")","nA","=","nA","-","no","*","0.5",";","nF","=","abs","(","ny",")",">=","nB",";","nG","=","abs","(","nA",")",">=","nB",";","if","(","!","nF",")","nv",".","x","-=","nu",".","x","*","FXAA_QUALITY_P3",";","if","(","!","nF",")","nv",".","y","-=","nu",".","y","*","FXAA_QUALITY_P3",";","nH","=","(","!","nF",")","||","(","!","nG",")",";","if","(","!","nG",")","nw",".","x","+=","nu",".","x","*","FXAA_QUALITY_P3",";","if","(","!","nG",")","nw",".","y","+=","nu",".","y","*","FXAA_QUALITY_P3",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FXAA_QUALITY_PS",4,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["if","(","nH",")","{","if","(","!","nF",")","ny","=","ge","(","mr","(","ia",",","nv",".","xy",")",")",";","if","(","!","nG",")","nA","=","ge","(","mr","(","ia",",","nw",".","xy",")",")",";","if","(","!","nF",")","ny","=","ny","-","no","*","0.5",";","if","(","!","nG",")","nA","=","nA","-","no","*","0.5",";","nF","=","abs","(","ny",")",">=","nB",";","nG","=","abs","(","nA",")",">=","nB",";","if","(","!","nF",")","nv",".","x","-=","nu",".","x","*","FXAA_QUALITY_P4",";","if","(","!","nF",")","nv",".","y","-=","nu",".","y","*","FXAA_QUALITY_P4",";","nH","=","(","!","nF",")","||","(","!","nG",")",";","if","(","!","nG",")","nw",".","x","+=","nu",".","x","*","FXAA_QUALITY_P4",";","if","(","!","nG",")","nw",".","y","+=","nu",".","y","*","FXAA_QUALITY_P4",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FXAA_QUALITY_PS",5,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["if","(","nH",")","{","if","(","!","nF",")","ny","=","ge","(","mr","(","ia",",","nv",".","xy",")",")",";","if","(","!","nG",")","nA","=","ge","(","mr","(","ia",",","nw",".","xy",")",")",";","if","(","!","nF",")","ny","=","ny","-","no","*","0.5",";","if","(","!","nG",")","nA","=","nA","-","no","*","0.5",";","nF","=","abs","(","ny",")",">=","nB",";","nG","=","abs","(","nA",")",">=","nB",";","if","(","!","nF",")","nv",".","x","-=","nu",".","x","*","FXAA_QUALITY_P5",";","if","(","!","nF",")","nv",".","y","-=","nu",".","y","*","FXAA_QUALITY_P5",";","nH","=","(","!","nF",")","||","(","!","nG",")",";","if","(","!","nG",")","nw",".","x","+=","nu",".","x","*","FXAA_QUALITY_P5",";","if","(","!","nG",")","nw",".","y","+=","nu",".","y","*","FXAA_QUALITY_P5",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FXAA_QUALITY_PS",6,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["if","(","nH",")","{","if","(","!","nF",")","ny","=","ge","(","mr","(","ia",",","nv",".","xy",")",")",";","if","(","!","nG",")","nA","=","ge","(","mr","(","ia",",","nw",".","xy",")",")",";","if","(","!","nF",")","ny","=","ny","-","no","*","0.5",";","if","(","!","nG",")","nA","=","nA","-","no","*","0.5",";","nF","=","abs","(","ny",")",">=","nB",";","nG","=","abs","(","nA",")",">=","nB",";","if","(","!","nF",")","nv",".","x","-=","nu",".","x","*","FXAA_QUALITY_P6",";","if","(","!","nF",")","nv",".","y","-=","nu",".","y","*","FXAA_QUALITY_P6",";","nH","=","(","!","nF",")","||","(","!","nG",")",";","if","(","!","nG",")","nw",".","x","+=","nu",".","x","*","FXAA_QUALITY_P6",";","if","(","!","nG",")","nw",".","y","+=","nu",".","y","*","FXAA_QUALITY_P6",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FXAA_QUALITY_PS",7,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["if","(","nH",")","{","if","(","!","nF",")","ny","=","ge","(","mr","(","ia",",","nv",".","xy",")",")",";","if","(","!","nG",")","nA","=","ge","(","mr","(","ia",",","nw",".","xy",")",")",";","if","(","!","nF",")","ny","=","ny","-","no","*","0.5",";","if","(","!","nG",")","nA","=","nA","-","no","*","0.5",";","nF","=","abs","(","ny",")",">=","nB",";","nG","=","abs","(","nA",")",">=","nB",";","if","(","!","nF",")","nv",".","x","-=","nu",".","x","*","FXAA_QUALITY_P7",";","if","(","!","nF",")","nv",".","y","-=","nu",".","y","*","FXAA_QUALITY_P7",";","nH","=","(","!","nF",")","||","(","!","nG",")",";","if","(","!","nG",")","nw",".","x","+=","nu",".","x","*","FXAA_QUALITY_P7",";","if","(","!","nG",")","nw",".","y","+=","nu",".","y","*","FXAA_QUALITY_P7",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FXAA_QUALITY_PS",8,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["if","(","nH",")","{","if","(","!","nF",")","ny","=","ge","(","mr","(","ia",",","nv",".","xy",")",")",";","if","(","!","nG",")","nA","=","ge","(","mr","(","ia",",","nw",".","xy",")",")",";","if","(","!","nF",")","ny","=","ny","-","no","*","0.5",";","if","(","!","nG",")","nA","=","nA","-","no","*","0.5",";","nF","=","abs","(","ny",")",">=","nB",";","nG","=","abs","(","nA",")",">=","nB",";","if","(","!","nF",")","nv",".","x","-=","nu",".","x","*","FXAA_QUALITY_P8",";","if","(","!","nF",")","nv",".","y","-=","nu",".","y","*","FXAA_QUALITY_P8",";","nH","=","(","!","nF",")","||","(","!","nG",")",";","if","(","!","nG",")","nw",".","x","+=","nu",".","x","*","FXAA_QUALITY_P8",";","if","(","!","nG",")","nw",".","y","+=","nu",".","y","*","FXAA_QUALITY_P8",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FXAA_QUALITY_PS",9,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["if","(","nH",")","{","if","(","!","nF",")","ny","=","ge","(","mr","(","ia",",","nv",".","xy",")",")",";","if","(","!","nG",")","nA","=","ge","(","mr","(","ia",",","nw",".","xy",")",")",";","if","(","!","nF",")","ny","=","ny","-","no","*","0.5",";","if","(","!","nG",")","nA","=","nA","-","no","*","0.5",";","nF","=","abs","(","ny",")",">=","nB",";","nG","=","abs","(","nA",")",">=","nB",";","if","(","!","nF",")","nv",".","x","-=","nu",".","x","*","FXAA_QUALITY_P9",";","if","(","!","nF",")","nv",".","y","-=","nu",".","y","*","FXAA_QUALITY_P9",";","nH","=","(","!","nF",")","||","(","!","nG",")",";","if","(","!","nG",")","nw",".","x","+=","nu",".","x","*","FXAA_QUALITY_P9",";","if","(","!","nG",")","nw",".","y","+=","nu",".","y","*","FXAA_QUALITY_P9",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FXAA_QUALITY_PS",10,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["if","(","nH",")","{","if","(","!","nF",")","ny","=","ge","(","mr","(","ia",",","nv",".","xy",")",")",";","if","(","!","nG",")","nA","=","ge","(","mr","(","ia",",","nw",".","xy",")",")",";","if","(","!","nF",")","ny","=","ny","-","no","*","0.5",";","if","(","!","nG",")","nA","=","nA","-","no","*","0.5",";","nF","=","abs","(","ny",")",">=","nB",";","nG","=","abs","(","nA",")",">=","nB",";","if","(","!","nF",")","nv",".","x","-=","nu",".","x","*","FXAA_QUALITY_P10",";","if","(","!","nF",")","nv",".","y","-=","nu",".","y","*","FXAA_QUALITY_P10",";","nH","=","(","!","nF",")","||","(","!","nG",")",";","if","(","!","nG",")","nw",".","x","+=","nu",".","x","*","FXAA_QUALITY_P10",";","if","(","!","nG",")","nw",".","y","+=","nu",".","y","*","FXAA_QUALITY_P10",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FXAA_QUALITY_PS",11,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["if","(","nH",")","{","if","(","!","nF",")","ny","=","ge","(","mr","(","ia",",","nv",".","xy",")",")",";","if","(","!","nG",")","nA","=","ge","(","mr","(","ia",",","nw",".","xy",")",")",";","if","(","!","nF",")","ny","=","ny","-","no","*","0.5",";","if","(","!","nG",")","nA","=","nA","-","no","*","0.5",";","nF","=","abs","(","ny",")",">=","nB",";","nG","=","abs","(","nA",")",">=","nB",";","if","(","!","nF",")","nv",".","x","-=","nu",".","x","*","FXAA_QUALITY_P11",";","if","(","!","nF",")","nv",".","y","-=","nu",".","y","*","FXAA_QUALITY_P11",";","nH","=","(","!","nF",")","||","(","!","nG",")",";","if","(","!","nG",")","nw",".","x","+=","nu",".","x","*","FXAA_QUALITY_P11",";","if","(","!","nG",")","nw",".","y","+=","nu",".","y","*","FXAA_QUALITY_P11",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FXAA_QUALITY_PS",12,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["if","(","nH",")","{","if","(","!","nF",")","ny","=","ge","(","mr","(","ia",",","nv",".","xy",")",")",";","if","(","!","nG",")","nA","=","ge","(","mr","(","ia",",","nw",".","xy",")",")",";","if","(","!","nF",")","ny","=","ny","-","no","*","0.5",";","if","(","!","nG",")","nA","=","nA","-","no","*","0.5",";","nF","=","abs","(","ny",")",">=","nB",";","nG","=","abs","(","nA",")",">=","nB",";","if","(","!","nF",")","nv",".","x","-=","nu",".","x","*","FXAA_QUALITY_P12",";","if","(","!","nF",")","nv",".","y","-=","nu",".","y","*","FXAA_QUALITY_P12",";","nH","=","(","!","nF",")","||","(","!","nG",")",";","if","(","!","nG",")","nw",".","x","+=","nu",".","x","*","FXAA_QUALITY_P12",";","if","(","!","nG",")","nw",".","y","+=","nu",".","y","*","FXAA_QUALITY_P12",";","}"]}]}}]},{TYPE:"txt",TOKENS:["}"]}]}}]},{TYPE:"txt",TOKENS:["}"]}]}}]},{TYPE:"txt",TOKENS:["}"]}]}}]},{TYPE:"txt",TOKENS:["}"]}]}}]},{TYPE:"txt",TOKENS:["}"]}]}}]},{TYPE:"txt",TOKENS:["}"]}]}}]},{TYPE:"txt",TOKENS:["}"]}]}}]},{TYPE:"txt",TOKENS:["}"]}]}}]},{TYPE:"txt",TOKENS:["}"]}]}}]},{TYPE:"txt",TOKENS:["}","float","nI","=","my",".","x","-","nv",".","x",";","float","nJ","=","nw",".","x","-","my",".","x",";","if","(","!","nj",")","nI","=","my",".","y","-","nv",".","y",";","if","(","!","nj",")","nJ","=","nw",".","y","-","my",".","y",";","bool","nK","=","(","ny","<","0.0",")","!=","nE",";","float","nL","=","(","nJ","+","nI",")",";","bool","nM","=","(","nA","<","0.0",")","!=","nE",";","float","nN","=","1.0","/","nL",";","bool","nO","=","nI","<","nJ",";","float","nP","=","min","(","nI",",","nJ",")",";","bool","nQ","=","nO","?","nK",":","nM",";","float","nR","=","nD","*","nD",";","float","nS","=","(","nP","*","(","-","nN",")",")","+","0.5",";","float","nT","=","nR","*","mv",";","float","nU","=","nQ","?","nS",":","0.0",";","float","nV","=","max","(","nU",",","nT",")",";","if","(","!","nj",")","my",".","x","+=","nV","*","ni",";","if","(","nj",")","my",".","y","+=","nV","*","ni",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FXAA_DISCARD",1,{TYPE:"equal_expr",PLACES:2},"FXAA_BLEND4WEB",1,{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["return","mr","(","ia",",","my",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["return","vec4","(","mr","(","ia",",","my",")",".","xyz",",","gf",")",";"]}]}}]},{TYPE:"txt",TOKENS:["}"]}]}}]}]},e["include/halo_color.glslf"]={TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"HALO_COLOR_GLSLF",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"HALO_COLOR_GLSLF",TOKENS:[""]},{TYPE:"var",NAME:"NUM_RINGS",TOKENS:["0"]},{TYPE:"var",NAME:"NUM_LINES",TOKENS:["0"]},{TYPE:"var",NAME:"NUM_STARS",TOKENS:["0"]},{TYPE:"var",NAME:"SKY_STARS",TOKENS:["0"]},{TYPE:"var",NAME:"WAVES_HEIGHT",TOKENS:["1.0"]},{TYPE:"var",NAME:"WATER_EFFECTS",TOKENS:["0"]},{TYPE:"var",NAME:"DISABLE_FOG",TOKENS:["0"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_RINGS","NUM_LINES",{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["const","int","nW","=","NUM_RINGS",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["const","int","nW","=","NUM_LINES",";"]}]}}]},{TYPE:"txt",TOKENS:["float","nX","(","float","x",")","{","return","x","-","floor","(","x","*","(","1.0","/","0.01",")",")","*","0.01",";","}"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_RINGS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["void","od","(","inout","float","nY",",","in","float","nZ","[","nW","]",",","in","float","n_",")","{","for","(","int","a","=","0",";","a","<","NUM_RINGS",";","a","++",")","{","float","oa","=","40.0","*","nZ","[","a","]",";","float","ob","=","300.0","*","(","nX","(","oa",")","-","0.005",")",";","float","oc","=","oa",";","float","ma","=","abs","(","oc","*","(","u_halo_size","*","ob","-","n_",")",")",";","nY","+=","1.0","-","min","(","ma",",","1.0",")",";","}","}"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_LINES"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["void","oi","(","inout","float","oe",",","in","float","nZ","[","nW","]",",","in","float","aM",")","{","for","(","int","a","=","0",";","a","<","NUM_LINES",";","a","++",")","{","float","of","=","nZ","[","a","]",";","float","og","=","of",";","float","oh","=","1000.0","*","(","nX","(","of",")","-","0.005",")",";","float","ma","=","20.0","*","abs","(","og","*","A",".","x","+","oh","*","A",".","y",")",";","oe","+=","1.0","-","min","(","ma",",","1.0",")",";","}","oe","*=","aM",";","}"]}]}}]},{TYPE:"txt",TOKENS:["void","om","(","inout","float","aM",",","in","vec2","b_",")","{","float","oj",",","bK",";","bK","=","atan","(","b_",".","y",",","b_",".","x",")",";","bK","*=","(","1.0","+","0.25","*","float","(","NUM_STARS",")",")",";","float","ok","=","cos","(","bK",")",";","float","ol","=","sin","(","bK",")",";","bK","=","(","ok","*","b_",".","x","+","ol","*","b_",".","y",")","*","(","ok","*","b_",".","y","-","ol","*","b_",".","x",")",";","oj","=","abs","(","bK",")",";","if","(","oj","<","1.0",")","{","oj","=","(","0.01","*","u_halo_size",")","/","(","oj",")",";","aM","*=","sqrt","(","min","(","oj",",","1.0",")",")",";","}","}","vec4","bh","(",")","{","float","aM","=","(","A",".","x","*","A",".","x","+","A",".","y","*","A",".","y",")",";","float","n_","=","sqrt","(","aM",")",";","aM","=","max","(","1.0","-","aM",",","0.0",")",";","aM","=","pow","(","aM",",","u_halo_hardness",")",";","float","L","=","u_diffuse_color",".","a",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_RINGS","NUM_LINES",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","nZ","[","nW","]",";","for","(","int","cl","=","0",";","cl","<","nW",";","cl","++",")","{","nZ","[","cl","]","=","fract","(","bf","/","float","(","cl","+","1",")",")","-","1.0",";","}"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_RINGS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","nY","=","0.0",";","od","(","nY",",","nZ",",","n_",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_LINES"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","oe","=","0.0",";","oi","(","oe",",","nZ",",","aM",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_STARS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["om","(","aM",",","A",")",";"]}]}}]},{TYPE:"txt",TOKENS:["aM","*=","L",";","vec3","aQ","=","u_diffuse_color",".","rgb",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_RINGS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["nY","*=","aM",";","aQ","+=","u_halo_rings_color","*","nY",";","aM","+=","nY",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_LINES"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["oe","*=","L",";","aQ","+=","u_halo_lines_color","*","oe",";","aM","+=","oe",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SKY_STARS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["aM","*=","max","(","1.0","-","2.0","*","u_sun_intensity",".","x",",","0.0",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WATER_EFFECTS","DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","kZ","=","u_halo_stars_blend","*","(","be",".","y","-","u_halo_stars_height",")",";","aM","*=","clamp","(","kZ",",","0.0",",","1.0",")",";","aM","*=","min","(","u_cam_water_depth","+","2.0","*","WAVES_HEIGHT",",","1.0",")",";"]}]}}]}]}}]},{TYPE:"txt",TOKENS:["vec4","on","=","vec4","(","aQ",",","aM",")",";","return","on",";","}"]}]}}]}]},e["include/lighting_nodes.glslf"]={TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"LIGHTING_NODES_GLSLF",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"LIGHTING_NODES_GLSLF",TOKENS:[""]},{TYPE:"include",FILE:"std.glsl"},{TYPE:"node",NAME:"LIGHTING_BEGIN",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"oB",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"oC",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"oD",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"oE",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"oF",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"oG",QUALIFIER:["vec2"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"oH",QUALIFIER:["vec2"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"oI",QUALIFIER:["vec4"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"oJ",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"oK",QUALIFIER:["vec4"],IS_OPTIONAL:!0}],STATEMENTS:[{TYPE:"txt",TOKENS:["oB","=","oo",";","oC","=","op",";","oD","=","oq",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_oE"],STATEMENTS:[{TYPE:"txt",TOKENS:["oE","=","or",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_oF"],STATEMENTS:[{TYPE:"txt",TOKENS:["oF","=","ot",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_oH"],STATEMENTS:[{TYPE:"txt",TOKENS:["oH","=","ov",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_oG"],STATEMENTS:[{TYPE:"txt",TOKENS:["oG","=","ow",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_oI"],STATEMENTS:[{TYPE:"txt",TOKENS:["oI","=","ox",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_oJ"],STATEMENTS:[{TYPE:"txt",TOKENS:["oJ","=","oy",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_oK"],STATEMENTS:[{TYPE:"txt",TOKENS:["oK","=","oz",";"]}]}]}]},{TYPE:"node",NAME:"LIGHTING_AMBIENT",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"oL",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"oM",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"oN",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"oO",QUALIFIER:["vec4"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"oP",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["oO","=","vec4","(","oL","+","oN","*","oM",",","_0_0",")",";","oP","=","vec3","(","_0_0",")",";"]}]},{TYPE:"node",NAME:"LIGHTING_LAMP",NODE_VARS:[{TYPE:"node_var",NAME:"LAMP_TYPE",TOKENS:["HEMI"]},{TYPE:"node_var",NAME:"LAMP_IND",TOKENS:["0"]},{TYPE:"node_var",NAME:"LAMP_SPOT_SIZE",TOKENS:["0.8"]},{TYPE:"node_var",NAME:"LAMP_SPOT_BLEND",TOKENS:["0.03"]},{TYPE:"node_var",NAME:"LAMP_LIGHT_DIST",TOKENS:["30.0"]},{TYPE:"node_var",NAME:"LAMP_SHADOW_MAP_IND",TOKENS:["-","1"]},{TYPE:"node_var",NAME:"LAMP_USE_SPHERE",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"oQ",QUALIFIER:["vec4"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"oR",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"oS",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"oT",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"oU",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["oS","=","vec2","(","u_light_positions","[","LAMP_IND","]",".","w",",","u_light_color_intensities","[","LAMP_IND","]",".","w",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["LAMP_TYPE","HEMI",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:["oU","=","_0_5",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["oU","=","_0_0",";"]}]}]},{TYPE:"txt",TOKENS:["oT","=","u_light_color_intensities","[","LAMP_IND","]",".","xyz",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["LAMP_SHADOW_MAP_IND",1,{TYPE:"negative_expr",PLACES:1},{TYPE:"non_equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:["oT","*=","oQ","[","LAMP_SHADOW_MAP_IND","]",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["LAMP_TYPE","SPOT",{TYPE:"equal_expr",PLACES:2},"LAMP_TYPE","POINT",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:["vec3","oV","=","u_light_positions","[","LAMP_IND","]",".","xyz",";","oR","=","oV","-","os",";","float","aM","=","length","(","oR",")",";","float","oW","=","LAMP_LIGHT_DIST","/","(","LAMP_LIGHT_DIST","+","aM","*","aM",")",";","oR","=","normalize","(","oR",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["LAMP_TYPE","SPOT",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:["vec3","oX","=","u_light_directions","[","LAMP_IND","]",";","float","oY","=","dot","(","oR",",","oX",")",";","oY","*=","smoothstep","(","_0_0",",","_1_0",",","(","oY","-","LAMP_SPOT_SIZE",")","/","LAMP_SPOT_BLEND",")",";","oW","*=","oY",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["LAMP_USE_SPHERE"],STATEMENTS:[{TYPE:"txt",TOKENS:["oW","*=","max","(","LAMP_LIGHT_DIST","-","aM",",","_0_0",")","/","LAMP_LIGHT_DIST",";"]}]}]},{TYPE:"txt",TOKENS:["oT","*=","oW",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["oR","=","u_light_directions","[","LAMP_IND","]",";"]}]}]}]},{TYPE:"node",NAME:"DIFFUSE_FRESNEL",NODE_VARS:[{TYPE:"node_var",NAME:"MAT_USE_TBN_SHADING",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"oZ",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"o_",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pa",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pb",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pc",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"pd",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAT_USE_TBN_SHADING"],STATEMENTS:[{TYPE:"txt",TOKENS:["vec3","pe","=","cross","(","oZ",",","B",".","xyz",")",";","pa","=","cross","(","pe",",","B",".","xyz",")",";","pa","=","-","normalize","(","pa",")",";"]}]}]},{TYPE:"txt",TOKENS:["pd","=","_0_0",";","if","(","o_",".","r","!=","_0_0",")","{","float","pf","=","(","_1_0","-","pb",")","*","dot","(","pa",",","oZ",")","+","pb",";","if","(","pc","[","0","]","==","_0_0",")","{","pd","=","_1_0",";","}","else","{","float","t","=","_1_0","+","abs","(","pf",")",";","t","=","pc","[","1","]","+","(","_1_0","-","pc","[","1","]",")","*","pow","(","t",",","pc","[","0","]",")",";","pd","=","clamp","(","t",",","_0_0",",","_1_0",")",";","}","pd","=","max","(","pd",",","_0_0",")",";","}"]}]},{TYPE:"node",NAME:"DIFFUSE_LAMBERT",NODE_VARS:[{TYPE:"node_var",NAME:"MAT_USE_TBN_SHADING",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"pg",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"ph",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pi",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pj",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"pk",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAT_USE_TBN_SHADING"],STATEMENTS:[{TYPE:"txt",TOKENS:["vec3","pe","=","cross","(","pg",",","B",".","xyz",")",";","pi","=","cross","(","pe",",","B",".","xyz",")",";","pi","=","-","normalize","(","pi",")",";"]}]}]},{TYPE:"txt",TOKENS:["pk","=","_0_0",";","if","(","ph",".","r","!=","_0_0",")","{","float","pf","=","(","_1_0","-","pj",")","*","dot","(","pi",",","pg",")","+","pj",";","pk","=","max","(","pf",",","_0_0",")",";","}"]}]},{TYPE:"node",NAME:"DIFFUSE_OREN_NAYAR",NODE_VARS:[{TYPE:"node_var",NAME:"MAT_USE_TBN_SHADING",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"pl",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pm",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pn",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"po",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pr",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"pu",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAT_USE_TBN_SHADING"],STATEMENTS:[{TYPE:"txt",TOKENS:["vec3","pe","=","cross","(","pl",",","B",".","xyz",")",";","pn","=","cross","(","pe",",","B",".","xyz",")",";","pn","=","-","normalize","(","pn",")",";"]}]}]},{TYPE:"txt",TOKENS:["pu","=","_0_0",";","if","(","pm",".","r","!=","_0_0",")","{","float","pf","=","(","_1_0","-","po",")","*","dot","(","pn",",","pl",")","+","po",";","if","(","pr","[","0","]",">","_0_0",")","{","float","pv","=","max","(","dot","(","pn",",","ou",")",",","_0_0",")",";","float","pw","=","pr","[","0","]","*","pr","[","0","]",";","float","cB","=","_1_0","-","_0_5","*","(","pw","/","(","pw","+","0.33",")",")",";","vec3","px","=","pl","-","pf","*","pn",";","vec3","py","=","ou","-","pv","*","pn",";","if","(","length","(","px",")","==","_0_0","||","length","(","py",")","==","_0_0","||","abs","(","pf",")",">","_1_0","||","abs","(","pv",")",">","_1_0",")","pu","=","pf","*","cB",";","else","{","float","pz","=","acos","(","pf",")",";","float","pA","=","acos","(","pv",")",";","vec3","pB","=","normalize","(","px",")",";","vec3","pC","=","normalize","(","py",")",";","float","a",",","b",";","a","=","max","(","pz",",","pA",")",";","b","=","min","(","pz",",","pA",")",";","b","*=","0.95",";","float","t","=","max","(","dot","(","pB",",","pC",")",",","_0_0",")",";","float","hO","=","0.45","*","(","pw","/","(","pw","+","0.09",")",")",";","pu","=","pf","*","(","cB","+","(","hO","*","t","*","sin","(","a",")","*","tan","(","b",")",")",")",";","}","}","else","pu","=","pf",";","pu","=","max","(","pu",",","_0_0",")",";","}"]}]},{TYPE:"node",NAME:"DIFFUSE_MINNAERT",NODE_VARS:[{TYPE:"node_var",NAME:"MAT_USE_TBN_SHADING",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"pD",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pE",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pF",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pG",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pH",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"pI",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAT_USE_TBN_SHADING"],STATEMENTS:[{TYPE:"txt",TOKENS:["vec3","pe","=","cross","(","pD",",","B",".","xyz",")",";","pF","=","cross","(","pe",",","B",".","xyz",")",";","pF","=","-","normalize","(","pF",")",";"]}]}]},{TYPE:"txt",TOKENS:["pI","=","_0_0",";","if","(","pE",".","r","!=","_0_0",")","{","float","pf","=","(","_1_0","-","pG",")","*","dot","(","pF",",","pD",")","+","pG",";","float","pv","=","max","(","dot","(","pF",",","ou",")",",","_0_0",")",";","if","(","pH","[","0","]","<=","_1_0",")","pI","=","pf","*","pow","(","max","(","pv","*","pf",",","0.1",")",",","pH","[","0","]","-","_1_0",")",";","else","pI","=","pf","*","pow","(","1.0001","-","pv",",","pH","[","0","]","-","_1_0",")",";","pI","=","max","(","pI",",","_0_0",")",";","}"]}]},{TYPE:"node",NAME:"DIFFUSE_TOON",NODE_VARS:[{TYPE:"node_var",NAME:"MAT_USE_TBN_SHADING",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"pJ",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pK",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pL",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pM",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pN",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"pO",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAT_USE_TBN_SHADING"],STATEMENTS:[{TYPE:"txt",TOKENS:["vec3","pe","=","cross","(","pJ",",","B",".","xyz",")",";","pL","=","cross","(","pe",",","B",".","xyz",")",";","pL","=","-","normalize","(","pL",")",";"]}]}]},{TYPE:"txt",TOKENS:["pO","=","_0_0",";","if","(","pK",".","r","!=","_0_0",")","{","float","pf","=","(","_1_0","-","pM",")","*","dot","(","pL",",","pJ",")","+","pM",";","float","pP","=","acos","(","pf",")",";","if","(","pP","<","pN","[","0","]",")","pO","=","_1_0",";","else","if","(","pP",">","(","pN","[","0","]","+","pN","[","1","]",")","||","pN","[","1","]","==","_0_0",")","pO","=","_0_0",";","else","pO","=","_1_0","-","(","(","pP","-","pN","[","0","]",")","/","pN","[","1","]",")",";","pO","=","max","(","pO",",","_0_0",")",";","}"]}]},{TYPE:"node",NAME:"SPECULAR_PHONG",NODE_VARS:[{TYPE:"node_var",NAME:"MAT_USE_TBN_SHADING",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"pQ",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pR",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pS",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pT",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pU",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"pV",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["pV","=","_0_0",";","if","(","pR",".","g","!=","_0_0",")","{","vec3","pW","=","normalize","(","pQ","+","ou",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAT_USE_TBN_SHADING"],STATEMENTS:[{TYPE:"txt",TOKENS:["if","(","pT","==","_0_0",")","{","pV","=","dot","(","B",".","xyz",",","pW",")",";","pV","=","sqrt","(","_1_0","-","pV","*","pV",")",";","}"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["pV","=","(","_1_0","-","pT",")","*","max","(","dot","(","pS",",","pW",")",",","_0_0",")","+","pT",";"]}]}]},{TYPE:"txt",TOKENS:["pV","=","pow","(","pV",",","pU","[","0","]",")",";","}"]}]},{TYPE:"node",NAME:"SPECULAR_COOKTORR",NODE_VARS:[{TYPE:"node_var",NAME:"MAT_USE_TBN_SHADING",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"pX",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pY",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pZ",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"p_",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qa",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"qb",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["qb","=","_0_0",";","if","(","pY",".","g","!=","_0_0",")","{","vec3","pW","=","normalize","(","pX","+","ou",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAT_USE_TBN_SHADING"],STATEMENTS:[{TYPE:"txt",TOKENS:["if","(","p_","==","_0_0",")","{","qb","=","dot","(","B",".","xyz",",","pW",")",";","qb","=","sqrt","(","_1_0","-","qb","*","qb",")",";","}"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["qb","=","max","(","dot","(","pZ",",","pW",")",",","_0_0",")",";","qb","=","(","_1_0","-","p_",")","*","qb","+","p_",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAT_USE_TBN_SHADING"],STATEMENTS:[{TYPE:"txt",TOKENS:["float","pv","=","max","(","dot","(","B",".","xyz",",","ou",")",",","_0_0",")",";","pv","=","sqrt","(","_1_0","-","pv","*","pv",")",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["float","pv","=","max","(","dot","(","pZ",",","ou",")",",","_0_0",")",";"]}]}]},{TYPE:"txt",TOKENS:["qb","=","pow","(","qb",",","qa","[","0","]",")",";","qb","=","qb","/","(","0.1","+","pv",")",";","}"]}]},{TYPE:"node",NAME:"SPECULAR_WARDISO",NODE_VARS:[{TYPE:"node_var",NAME:"MAT_USE_TBN_SHADING",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"qc",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qd",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qe",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qf",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qg",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"qh",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["qh","=","_0_0",";","if","(","qd",".","g","!=","_0_0",")","{","vec3","pW","=","normalize","(","qc","+","ou",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAT_USE_TBN_SHADING"],STATEMENTS:[{TYPE:"txt",TOKENS:["float","qi","=","_0_0",";","float","pv","=","_0_0",";","float","qj","=","_0_0",";","if","(","qf","==","_0_0",")","{","qi","=","dot","(","B",".","xyz",",","pW",")",";","pv","=","dot","(","B",".","xyz",",","ou",")",";","qj","=","dot","(","B",".","xyz",",","qc",")",";","qi","=","sqrt","(","_1_0","-","qi","*","qi",")",";","pv","=","sqrt","(","_1_0","-","pv","*","pv",")",";","qj","=","sqrt","(","_1_0","-","qj","*","qj",")",";","}"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["float","qi","=","max","(","dot","(","qe",",","pW",")",",","0.01",")",";","float","pv","=","max","(","dot","(","qe",",","ou",")",",","0.01",")",";","float","qj","=","max","(","dot","(","qe",",","qc",")",",","0.01",")",";"]}]}]},{TYPE:"txt",TOKENS:["float","bK","=","tan","(","acos","(","qi",")",")",";","float","L","=","max","(","qg","[","0","]",",","0.01",")",";","qh","=","qj","*","(","_1_0","/","(","4.0","*","M_PI","*","L","*","L",")",")","*","(","exp","(","-","(","bK","*","bK",")","/","(","L","*","L",")",")","/","(","sqrt","(","pv","*","qj",")",")",")",";","}"]}]},{TYPE:"node",NAME:"SPECULAR_TOON",NODE_VARS:[{TYPE:"node_var",NAME:"MAT_USE_TBN_SHADING",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"qk",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"ql",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qm",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qn",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qo",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"qr",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["qr","=","_0_0",";","if","(","ql",".","g","!=","_0_0",")","{","vec3","cj","=","normalize","(","qk","+","ou",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAT_USE_TBN_SHADING"],STATEMENTS:[{TYPE:"txt",TOKENS:["float","qu","=","dot","(","cj",",","B",".","xyz",")",";","float","bK","=","qo","[","0","]","+","qo","[","1","]",";","if","(","qn","==","_0_0",")","bK","=","acos","(","sqrt","(","_1_0","-","qu","*","qu",")",")",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["float","bK","=","acos","(","dot","(","cj",",","qm",")",")",";"]}]}]},{TYPE:"txt",TOKENS:["if","(","bK","<","qo","[","0","]",")","qr","=","_1_0",";","else","if","(","bK",">=","qo","[","0","]","+","qo","[","1","]","||","qo","[","1","]","==","_0_0",")","qr","=","_0_0",";","else","qr","=","_1_0","-","(","bK","-","qo","[","0","]",")","/","qo","[","1","]",";","}"]}]},{TYPE:"node",NAME:"SPECULAR_BLINN",NODE_VARS:[{TYPE:"node_var",NAME:"MAT_USE_TBN_SHADING",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"qv",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qw",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qx",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qy",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qz",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"qA",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["float","qB","=","qz","[","0","]",";","float","qC","=","qz","[","1","]",";","qA","=","_0_0",";","if","(","qw",".","g","!=","_0_0",")","{","if","(","qB","<","1.0","||","qC","==","_0_0",")","qA","=","_0_0",";","else","{","if","(","qC","<","100.0",")","qC","=","sqrt","(","1.0","/","qC",")",";","else","qC","=","10.0","/","qC",";","vec3","pW","=","normalize","(","ou","+","qv",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAT_USE_TBN_SHADING"],STATEMENTS:[{TYPE:"txt",TOKENS:["float","qi","=","0.0",";","if","(","qy","==","_0_0",")","{","float","qD","=","dot","(","B",".","xyz",",","pW",")",";","qi","=","sqrt","(","_1_0","-","qD","*","qD",")",";","}"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["float","qi","=","(","_1_0","-","qy",")","*","max","(","dot","(","qx",",","pW",")",",","_0_0",")","+","qy",";"]}]}]},{TYPE:"txt",TOKENS:["if","(","qi","<","_0_0",")","qA","=","_0_0",";","else","{","float","pv","=","max","(","dot","(","qx",",","ou",")",",","0.01",")",";","float","qj","=","dot","(","qx",",","qv",")",";","if","(","qj","<=","0.01",")","qA","=","_0_0",";","else","{","float","qE","=","max","(","dot","(","ou",",","pW",")",",","0.01",")",";","float","a","=","_1_0",";","float","b","=","(","2.0","*","qi","*","pv",")","/","qE",";","float","du","=","(","2.0","*","qi","*","qj",")","/","qE",";","float","g","=","min","(","min","(","a",",","b",")",",","du",")",";","float","p","=","sqrt","(","pow","(","qB",",","2.0",")","+","pow","(","qE",",","2.0",")","-","_1_0",")",";","float","mi","=","pow","(","p","-","qE",",","2.0",")","/","pow","(","p","+","qE",",","2.0",")","*","(","_1_0","+","pow","(","qE","*","(","p","+","qE",")","-","_1_0",",","2.0",")","/","pow","(","qE","*","(","p","-","qE",")","+","_1_0",",","2.0",")",")",";","float","pP","=","acos","(","qi",")",";","qA","=","max","(","mi","*","g","*","exp","(","-","pow","(","pP",",","2.0",")","/","(","2.0","*","pow","(","qC",",","2.0",")",")",")",",","_0_0",")",";","}","}","}","}"]}]},{TYPE:"node",NAME:"LIGHTING_APPLY",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"qF",QUALIFIER:["vec4"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qG",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qH",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qI",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qJ",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qK",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qL",QUALIFIER:["vec4"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qM",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qN",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qO",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qP",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"qQ",QUALIFIER:["vec4"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"qR",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["qR","=","qG","+","qO","*","qN","*","qI",";","qQ","=","qF","+","vec4","(","qO","*","qM","*","qH",",","qI",")",";"]}]},{TYPE:"node",NAME:"LIGHTING_END",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"qS",QUALIFIER:["vec4"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qT",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["E","=","qS",".","rgb",";","oA","=","qT",";"]}]},{TYPE:"nodes_global"},{TYPE:"txt",TOKENS:["void","cK","(","vec3","oo",",","vec3","op",",","vec3","oq",",","vec3","or",",","vec3","os",",","vec3","ot",",","vec3","ou",",","vec2","ov",",","vec2","ow",",","vec4","ox",",","float","oy",",","vec4","oz",",","out","vec3","E",",","out","vec3","oA",")","{"]},{TYPE:"nodes_main"},{TYPE:"txt",TOKENS:["}"]}]}}]}]},e["include/math.glslv"]={TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"MATH_GLSLV",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"MATH_GLSLV",TOKENS:[""]},{TYPE:"var",NAME:"EPSILON",TOKENS:["0.000001"]},{TYPE:"var",NAME:"REFLECTION_TYPE",TOKENS:["REFL_NONE"]},{TYPE:"var",NAME:"REFRACTIVE",TOKENS:["0"]},{TYPE:"var",NAME:"SHADOW_USAGE",TOKENS:["NO_SHADOWS"]},{TYPE:"var",NAME:"USE_POSITION_CLIP",TOKENS:["0"]},{TYPE:"var",NAME:"SOFT_PARTICLES",TOKENS:["0"]},{TYPE:"include",FILE:"std.glsl"},{TYPE:"txt",TOKENS:["struct","au","{","vec3","O",";","vec3","ao",";","vec3","V",";","vec3","aB",";","vec3","W",";","vec3","U",";","vec3","aQ",";","}",";","bool","qU","(","vec3","a",",","vec3","b",")","{","return","any","(","lessThan","(","abs","(","a","-","b",")",",","vec3","(","EPSILON",")",")",")",";","}","vec3","T","(","in","vec4","q",",","in","vec3","kQ",")","{","return","kQ","+","2.0","*","cross","(","q",".","xyz",",","cross","(","q",".","xyz",",","kQ",")","+","q",".","w","*","kQ",")",";","}","vec4","kR","(","in","vec4","qV",")","{","return","vec4","(","-","qV",".","xyz",",","qV",".","w",")",";","}","vec4","qX","(","in","vec4","a",",","in","vec4","b",")","{","vec4","qW",";","qW",".","x","=","a",".","x","*","b",".","w","+","a",".","w","*","b",".","x","+","a",".","y","*","b",".","z","-","a",".","z","*","b",".","y",";","qW",".","y","=","a",".","y","*","b",".","w","+","a",".","w","*","b",".","y","+","a",".","z","*","b",".","x","-","a",".","x","*","b",".","z",";","qW",".","z","=","a",".","z","*","b",".","w","+","a",".","w","*","b",".","z","+","a",".","x","*","b",".","y","-","a",".","y","*","b",".","x",";","qW",".","w","=","a",".","w","*","b",".","w","-","a",".","x","*","b",".","x","-","a",".","y","*","b",".","y","-","a",".","z","*","b",".","z",";","return","qW",";","}","vec4","X","(","in","vec3","qY",",","in","float","qZ",")","{","vec4","qW",";","qZ","=","qZ","*","0.5",";","float","s","=","sin","(","qZ",")",";","qW",".","x","=","s","*","qY","[","0","]",";","qW",".","y","=","s","*","qY","[","1","]",";","qW",".","z","=","s","*","qY","[","2","]",";","qW",".","w","=","cos","(","qZ",")",";","return","qW",";","}","vec4","rd","(","in","vec3","bD",",","in","vec3","q_",")","{","vec4","qW",";","float","dz","=","dot","(","q_",",","bD",")",";","vec3","rc","=","cross","(","q_",",","bD",")",";","qW",".","xyz","=","rc",".","xyz",";","qW",".","w","=","1.0","+","dz",";","return","normalize","(","qW",")",";","}","vec3","rh","(","vec4","re",",","vec4","qV",",","vec3","rf",")","{","vec3","qW","=","rf","*","re",".","w",";","qW","=","T","(","qV",",","qW",")",";","qW","+=","re",".","xyz",";","return","qW",";","}","vec3","ap","(","mat3","ri",",","vec3","rf",")","{","vec3","qW","=","rf","*","ri","[","1","]","[","0","]",";","vec4","qV","=","vec4","(","ri","[","1","]","[","1","]",",","ri","[","1","]","[","2","]",",","ri","[","2","]","[","0","]",",","ri","[","2","]","[","1","]",")",";","qW","=","T","(","qV",",","qW",")",";","qW","+=","ri","[","0","]",";","return","qW",";","}","vec3","rj","(","vec4","re",",","vec4","qV",",","vec3","bD",")","{","vec3","qW","=","bD","*","re",".","w",";","qW","=","T","(","qV",",","qW",")",";","return","qW",";","}","vec3","_","(","mat3","ri",",","vec3","bD",")","{","vec3","qW","=","bD","*","ri","[","1","]","[","0","]",";","vec4","qV","=","vec4","(","ri","[","1","]","[","1","]",",","ri","[","1","]","[","2","]",",","ri","[","2","]","[","0","]",",","ri","[","2","]","[","1","]",")",";","qW","=","T","(","qV",",","qW",")",";","return","qW",";","}","vec3","rk","(","vec4","re",",","vec4","qV",",","vec3","rf",")","{","vec3","qW","=","rf","-","re",".","xyz",";","qW","=","T","(","kR","(","qV",")",",","qW",")",";","qW","/=","re",".","w",";","return","qW",";","}","vec3","rl","(","vec4","re",",","vec4","qV",",","vec3","bD",")","{","return","T","(","kR","(","qV",")",",","bD",")","/","re",".","w",";","}","mat4","rm","(",")","{","return","mat4","(","_1_0",",","_0_0",",","_0_0",",","_0_0",",","_0_0",",","_1_0",",","_0_0",",","_0_0",",","_0_0",",","_0_0",",","_1_0",",","_0_0",",","_0_0",",","_0_0",",","_0_0",",","_1_0",")",";","}","mat4","rn","(","float","bK",")","{","return","mat4","(","_1_0",",","_0_0",",","_0_0",",","_0_0",",","_0_0",",","cos","(","bK",")",",","sin","(","bK",")",",","_0_0",",","_0_0",",","-","sin","(","bK",")",",","cos","(","bK",")",",","_0_0",",","_0_0",",","_0_0",",","_0_0",",","_1_0",")",";","}","mat4","ro","(","float","bK",")","{","return","mat4","(","cos","(","bK",")",",","_0_0",",","-","sin","(","bK",")",",","_0_0",",","_0_0",",","_1_0",",","_0_0",",","_0_0",",","sin","(","bK",")",",","_0_0",",","cos","(","bK",")",",","_0_0",",","_0_0",",","_0_0",",","_0_0",",","_1_0",")",";","}","mat4","rp","(","float","bK",")","{","return","mat4","(","cos","(","bK",")",",","sin","(","bK",")",",","_0_0",",","_0_0",",","-","sin","(","bK",")",",","cos","(","bK",")",",","_0_0",",","_0_0",",","_0_0",",","_0_0",",","_1_0",",","_0_0",",","_0_0",",","_0_0",",","_0_0",",","_1_0",")",";","}","au","lX","(","in","au","kQ",")","{","return","au","(","kQ",".","O",",","kQ",".","ao",",","normalize","(","kQ",".","V",")",",","normalize","(","kQ",".","aB",")",",","normalize","(","kQ",".","W",")",",","normalize","(","kQ",".","U",")",",","kQ",".","aQ",")",";","}"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SOFT_PARTICLES","REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{TYPE:"equal_expr",PLACES:2},"REFRACTIVE","USE_POSITION_CLIP",{TYPE:"logical_or_expr",PLACES:5}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","aC","(","vec4","f",")","{","float","fT","=","f",".","x",";","float","fU","=","f",".","y",";","float","fV","=","f",".","w",";","vec3","rq",";","rq",".","x","=","(","fT","+","fV",")","/","2.0",";","rq",".","y","=","(","fU","+","fV",")","/","2.0",";","rq",".","z","=","fV",";","return","rq",";","}"]}]}}]},{TYPE:"txt",TOKENS:["mat3","da","(",")","{","return","mat3","(","_0_0",",","_0_0",",","_0_0",",","_1_0",",","_0_0",",","_0_0",",","_0_0",",","_1_0",",","_0_0",")",";","}","mat4","bc","(","mat3","t",")","{","mat4","rs",";","rs","[","0","]","[","0","]","=","(","_1_0","-","(","t","[","1","]","[","2","]","*","(","t","[","1","]","[","2","]","+","t","[","1","]","[","2","]",")","+","t","[","2","]","[","0","]","*","(","t","[","2","]","[","0","]","+","t","[","2","]","[","0","]",")",")",")","*","t","[","1","]","[","0","]",";","rs","[","0","]","[","1","]","=","(","t","[","1","]","[","1","]","*","(","t","[","1","]","[","2","]","+","t","[","1","]","[","2","]",")","+","t","[","2","]","[","1","]","*","(","t","[","2","]","[","0","]","+","t","[","2","]","[","0","]",")",")","*","t","[","1","]","[","0","]",";","rs","[","0","]","[","2","]","=","(","t","[","1","]","[","1","]","*","(","t","[","2","]","[","0","]","+","t","[","2","]","[","0","]",")","-","t","[","2","]","[","1","]","*","(","t","[","1","]","[","2","]","+","t","[","1","]","[","2","]",")",")","*","t","[","1","]","[","0","]",";","rs","[","0","]","[","3","]","=","_0_0",";","rs","[","1","]","[","0","]","=","(","t","[","1","]","[","1","]","*","(","t","[","1","]","[","2","]","+","t","[","1","]","[","2","]",")","-","t","[","2","]","[","1","]","*","(","t","[","2","]","[","0","]","+","t","[","2","]","[","0","]",")",")","*","t","[","1","]","[","0","]",";","rs","[","1","]","[","1","]","=","(","_1_0","-","(","t","[","1","]","[","1","]","*","(","t","[","1","]","[","1","]","+","t","[","1","]","[","1","]",")","+","t","[","2","]","[","0","]","*","(","t","[","2","]","[","0","]","+","t","[","2","]","[","0","]",")",")",")","*","t","[","1","]","[","0","]",";","rs","[","1","]","[","2","]","=","(","t","[","1","]","[","2","]","*","(","t","[","2","]","[","0","]","+","t","[","2","]","[","0","]",")","+","t","[","2","]","[","1","]","*","(","t","[","1","]","[","1","]","+","t","[","1","]","[","1","]",")",")","*","t","[","1","]","[","0","]",";","rs","[","1","]","[","3","]","=","_0_0",";","rs","[","2","]","[","0","]","=","(","t","[","1","]","[","1","]","*","(","t","[","2","]","[","0","]","+","t","[","2","]","[","0","]",")","+","t","[","2","]","[","1","]","*","(","t","[","1","]","[","2","]","+","t","[","1","]","[","2","]",")",")","*","t","[","1","]","[","0","]",";","rs","[","2","]","[","1","]","=","(","t","[","1","]","[","2","]","*","(","t","[","2","]","[","0","]","+","t","[","2","]","[","0","]",")","-","t","[","2","]","[","1","]","*","(","t","[","1","]","[","1","]","+","t","[","1","]","[","1","]",")",")","*","t","[","1","]","[","0","]",";","rs","[","2","]","[","2","]","=","(","_1_0","-","(","t","[","1","]","[","1","]","*","(","t","[","1","]","[","1","]","+","t","[","1","]","[","1","]",")","+","t","[","1","]","[","2","]","*","(","t","[","1","]","[","2","]","+","t","[","1","]","[","2","]",")",")",")","*","t","[","1","]","[","0","]",";","rs","[","2","]","[","3","]","=","_0_0",";","rs","[","3","]","[","0","]","=","t","[","0","]","[","0","]",";","rs","[","3","]","[","1","]","=","t","[","0","]","[","1","]",";","rs","[","3","]","[","2","]","=","t","[","0","]","[","2","]",";","rs","[","3","]","[","3","]","=","1.0",";","return","rs",";","}","mat3","aY","(","in","mat3","ri",",","in","mat3","rt",")","{","mat3","qW",";","vec3","rf","=","rt","[","0","]",";","vec4","re","=","vec4","(","ri","[","0","]",",","ri","[","1","]","[","0","]",")",";","vec4","qV","=","vec4","(","ri","[","1","]","[","1","]",",","ri","[","1","]","[","2","]",",","ri","[","2","]","[","0","]",",","ri","[","2","]","[","1","]",")",";","qW","[","0","]","=","rh","(","re",",","qV",",","rf",")",";","qW","[","1","]","[","0","]","=","ri","[","1","]","[","0","]","*","rt","[","1","]","[","0","]",";","qW","[","1","]","[","1","]","=","ri","[","1","]","[","1","]","*","rt","[","2","]","[","1","]","+","ri","[","2","]","[","1","]","*","rt","[","1","]","[","1","]","+","ri","[","1","]","[","2","]","*","rt","[","2","]","[","0","]","-","ri","[","2","]","[","0","]","*","rt","[","1","]","[","2","]",";","qW","[","1","]","[","2","]","=","ri","[","1","]","[","2","]","*","rt","[","2","]","[","1","]","+","ri","[","2","]","[","1","]","*","rt","[","1","]","[","2","]","+","ri","[","2","]","[","0","]","*","rt","[","1","]","[","1","]","-","ri","[","1","]","[","1","]","*","rt","[","2","]","[","0","]",";","qW","[","2","]","[","0","]","=","ri","[","2","]","[","0","]","*","rt","[","2","]","[","1","]","+","ri","[","2","]","[","1","]","*","rt","[","2","]","[","0","]","+","ri","[","1","]","[","1","]","*","rt","[","1","]","[","2","]","-","ri","[","1","]","[","2","]","*","rt","[","1","]","[","1","]",";","qW","[","2","]","[","1","]","=","ri","[","2","]","[","1","]","*","rt","[","2","]","[","1","]","-","ri","[","1","]","[","1","]","*","rt","[","1","]","[","1","]","-","ri","[","1","]","[","2","]","*","rt","[","1","]","[","2","]","-","ri","[","2","]","[","0","]","*","rt","[","2","]","[","0","]",";","return","qW",";","}","mat3","dd","(","in","vec4","qV",",","in","mat3","ri",")","{","mat3","qW",";","qW","[","0","]","=","ri","[","0","]",";","qW","[","1","]","[","0","]","=","ri","[","1","]","[","0","]",";","qW","[","1","]","[","1","]","=","qV","[","0","]",";","qW","[","1","]","[","2","]","=","qV","[","1","]",";","qW","[","2","]","[","0","]","=","qV","[","2","]",";","qW","[","2","]","[","1","]","=","qV","[","3","]",";","return","qW",";","}","vec4","R","(","in","vec4","ru",")","{","return","normalize","(","ru",")",";","}","vec4","R","(","in","vec4","ru",",","out","float","P",",","out","float","Q",")","{","vec4","qV","=","R","(","ru",")",";","P","=","length","(","ru",")","*","M_PI",";","Q","=","sign","(","ru","[","3","]",")",";","return","R","(","ru",")",";","}"]}]}}]}]},e["include/mirror.glslf"]={TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"MIRROR_GLSLF",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"MIRROR_GLSLF",TOKENS:[""]},{TYPE:"var",NAME:"REFLECTION_TYPE",TOKENS:["REFL_NONE"]},{TYPE:"var",NAME:"REFLECTION_PASS",TOKENS:["REFL_PASS_NONE"]},{TYPE:"var",NAME:"USE_BSDF_SKY_DIM",TOKENS:[""]},{TYPE:"include",FILE:"std.glsl"},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2},"REFLECTION_TYPE","REFL_CUBE",{TYPE:"equal_expr",PLACES:2},"REFLECTION_TYPE","REFL_MIRRORMAP",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"color_util.glslf"},{TYPE:"include",FILE:"math.glslv"},{TYPE:"define",NAME:"REFL_BUMP",TOKENS:["0.1"]},{TYPE:"txt",TOKENS:["float","rv","(","in","vec3","D",",","vec3","eJ",",","float","d_",",","float","fg",")","{","vec3","fe","=","normalize","(","eJ","+","D",")",";","float","ff","=","1.0","-","dot","(","D",",","fe",")",";","float","r","=","fg","+","(","1.0","-","fg",")","*","pow","(","ff",",","d_",")",";","return","r",";","}","void","cL","(","inout","vec3","rw",",","vec3","D",",","vec3","U",",","float","rx",",","mat3","N",")","{","vec3","eJ","=","reflect","(","-","D",",","U",")",";","float","d_","=","u_fresnel_params","[","0","]",";","float","fg","=","u_fresnel_params","[","1","]",";","float","r","=","1.0",";","if","(","d_","!=","0.0",")","r","=","rv","(","D",",","eJ",",","d_",",","fg",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_TYPE","REFL_CUBE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","eO","=","GLSL_TEXTURE_CUBE","(","u_cube_reflection",",","eJ",")",".","xyz",";"]}]}},{TYPE:"elif",EXPRESSION:["REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_PASS","REFL_PASS_NONE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","ry","=","u_refl_plane",".","xyz","*","dot","(","U",",","u_refl_plane",".","xyz",")",";","vec3","rz","=","U","-","ry",";","vec2","rA","=","_","(","N",",","rz",")",".","xy",";","vec2","rB","=","l",".","xy","/","l",".","z",";","rB","+=","rA","*","REFL_BUMP",";","vec3","eO","=","GLSL_TEXTURE","(","u_plane_reflection",",","rB",")",".","rgb",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","eO","=","vec3","(","1.0",")",";","rx","=","0.0",";"]}]}}]}]}},{TYPE:"elif",EXPRESSION:["REFLECTION_TYPE","REFL_MIRRORMAP",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","eO","=","GLSL_TEXTURE_CUBE","(","u_mirrormap",",","eJ",")",".","xyz",";"]}]}}]},{TYPE:"txt",TOKENS:["bC","(","eO",".","rgb",")",";","rw","=","mix","(","rw",",","eO",",","rx","*","r",")",";","}"]}]}},{TYPE:"elif",EXPRESSION:["REFLECTION_TYPE","REFL_PBR_STANDARD",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","rD","(","float","ed",",","vec3","rC",",","float","ec",")","{","return","rC","+","(","max","(","vec3","(","1.0","-","ec",")",",","rC",")","-","rC",")","*","pow","(","1.0","-","ed",",","5.0",")",";","}","vec3","rP","(","vec3","rw",",","vec3","rE",",","vec3","D",",","vec3","U",",","float","rF",",","float","rG",",","mat3","N",")","{","float","rH","=","max","(","dot","(","normalize","(","U",")",",","D",")",",","_0_0",")",";","vec3","eJ","=","reflect","(","-","D",",","U",")",";","float","ec","=","sqrt","(","rG",")",";","vec3","rC","=","vec3","(","0.04",")",";","rC","=","mix","(","rC",",","rE",",","rF",")",";","vec3","rI","=","rD","(","rH",",","rC",",","ec",")",";","vec3","rJ","=","rI",";","vec3","rK","=","vec3","(","_1_0",")","-","rJ",";","rK","*=","vec3","(","1.0","-","rF",")",";","vec3","bt","=","GLSL_TEXTURE_CUBE","(","u_cube_irradiance",",","U",")",".","xyz",";","vec3","rL","=","bt","*","rw",";","const","float","rM","=","5.0",";","vec3","ei","=","GLSL_TEXTURE_CUBE_LOD","(","u_cube_r_convolution",",","eJ",",","ec","*","rM",")",".","rgb",";","vec2","rN","=","GLSL_TEXTURE","(","u_brdf",",","vec2","(","rH",",","ec",")",")",".","rg",";","vec3","cJ","=","ei","*","(","rI","*","rN",".","x","+","rN",".","y",")",";","vec3","rO","=","(","rK","*","rL","+","cJ",")",";","return","rO",";","}"]}]}},{TYPE:"elif",EXPRESSION:["REFLECTION_TYPE","REFL_PBR_SIMPLE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","rD","(","float","ed",",","vec3","rC",",","float","ec",")","{","return","rC","+","(","max","(","vec3","(","1.0","-","ec",")",",","rC",")","-","rC",")","*","pow","(","1.0","-","ed",",","5.0",")",";","}","vec3","rP","(","vec3","rw",",","vec3","rE",",","vec3","D",",","vec3","U",",","float","rF",",","float","rG",",","mat3","N",")","{"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_BSDF_SKY_DIM"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","rH","=","max","(","dot","(","normalize","(","U",")",",","D",")",",","_0_0",")",";","vec3","eJ","=","reflect","(","-","D",",","U",")",";","float","rQ","=","max","(","2.0","/","(","rG","*","rG",")","-","2.0",",","_0_0",")",";","vec3","rC","=","vec3","(","0.04",")",";","rC","=","mix","(","rC",",","rE",",","rF",")",";","vec3","rI","=","rD","(","rH",",","rC",",","sqrt","(","rG",")",")",";","vec3","rJ","=","rI",";","vec3","rK","=","vec3","(","_1_0",")","-","rJ",";","rK","*=","1.0","-","rF",";","vec3","rL","=","GLSL_TEXTURE_CUBE_LOD","(","u_sky_reflection",",","normalize","(","U",")",",","100.0",")",".","xyz",";","bC","(","rL",")",";","rL","*=","rw",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["GLSL1"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","rR","=","u_bsdf_cube_sky_dim",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","rR","=","float","(","textureSize","(","u_sky_reflection",",","0",")",".","x",")",";"]}]}}]},{TYPE:"txt",TOKENS:["float","rS","=","log2","(","rR","*","sqrt","(","3.0",")",")","-","_0_5","*","log2","(","rQ","+","_1_0",")",";","vec3","cJ","=","GLSL_TEXTURE_CUBE_LOD","(","u_sky_reflection",",","eJ",",","rS",")",".","xyz",";","bC","(","cJ",")",";","vec3","rO","=","rK","*","rL","+","rJ","*","cJ",";","return","rO",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["return","rw",";"]}]}}]},{TYPE:"txt",TOKENS:["}"]}]}}]}]}}]}]},e["include/nodes.glslf"]={TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"NODES_GLSLF",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"NODES_GLSLF",TOKENS:[""]},{TYPE:"var",NAME:"CAUSTICS",TOKENS:["0"]},{TYPE:"var",NAME:"CALC_TBN_SPACE",TOKENS:["0"]},{TYPE:"var",NAME:"DOUBLE_SIDED_LIGHTING",TOKENS:["0"]},{TYPE:"var",NAME:"REFLECTION_PASS",TOKENS:["REFL_PASS_NONE"]},{TYPE:"var",NAME:"USE_REFRACTION",TOKENS:["0"]},{TYPE:"var",NAME:"HAS_REFRACT_TEXTURE",TOKENS:["0"]},{TYPE:"var",NAME:"NUM_LIGHTS",TOKENS:["0"]},{TYPE:"var",NAME:"REFLECTION_TYPE",TOKENS:["REFL_NONE"]},{TYPE:"var",NAME:"USE_DERIVATIVES_EXT",TOKENS:["0"]},{TYPE:"var",NAME:"CAMERA_TYPE",TOKENS:["CAM_TYPE_PERSP"]},{TYPE:"var",NAME:"IS_WORLD",TOKENS:["0"]},{TYPE:"var",NAME:"USE_BSDF_TRANSPARENT_REFRACT",TOKENS:["0"]},{TYPE:"var",NAME:"USE_BSDF_TRANSPARENT_ALPHA",TOKENS:["0"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_MATERIAL_BEGIN","USE_NODE_BSDF_BEGIN",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"mirror.glslf"},{TYPE:"include",FILE:"shadow.glslf"},{TYPE:"include",FILE:"environment.glslf"}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_B4W_REFRACTION","USE_REFRACTION",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"refraction.glslf"}]}}]},{TYPE:"include",FILE:"color_util.glslf"},{TYPE:"include",FILE:"math.glslv"},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_GEOMETRY_OR","USE_NODE_TEX_COORD_GE",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","rT",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_B4W_REFRACTION"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","rW","(","in","vec3","rU",",","in","float","rV",")","{","vec3","eX","=","vec3","(","_0_0",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_REFRACTION"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["eX","=","cN","(","l",",","rU",".","xy","*","rV",")",";"]}]}},{TYPE:"elif",EXPRESSION:["HAS_REFRACT_TEXTURE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["eX","=","GLSL_TEXTURE","(","u_refractmap",",","l",".","xy","/","l",".","z",")",".","rgb",";","bC","(","eX",")",";"]}]}}]},{TYPE:"txt",TOKENS:["return","eX",";","}"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_HUE_SAT","USE_NODE_MIX_RGB_HUE","USE_NODE_MIX_RGB_SATURATION","USE_NODE_MIX_RGB_VALUE","USE_NODE_MIX_RGB_COLOR","USE_NODE_SEPHSV",{TYPE:"logical_or_expr",PLACES:6}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","kf","(","vec3","rgb",")","{","vec4","hI","=","vec4","(","_0_0",",","-","_1_0","/","3.0",",","2.0","/","3.0",",","-","_1_0",")",";","vec4","p","=","mix","(","vec4","(","rgb",".","bg",",","hI",".","wz",")",",","vec4","(","rgb",".","gb",",","hI",".","xy",")",",","step","(","rgb",".","b",",","rgb",".","g",")",")",";","vec4","q","=","mix","(","vec4","(","p",".","xyw",",","rgb",".","r",")",",","vec4","(","rgb",".","r",",","p",".","yzx",")",",","step","(","p",".","x",",","rgb",".","r",")",")",";","float","dz","=","q",".","x","-","min","(","q",".","w",",","q",".","y",")",";","float","iB","=","1.0e-10",";","return","vec3","(","abs","(","q",".","z","+","(","q",".","w","-","q",".","y",")","/","(","6.0","*","dz","+","iB",")",")",",","dz","/","(","q",".","x","+","iB",")",",","q",".","x",")",";","}"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_HUE_SAT","USE_NODE_MIX_RGB_HUE","USE_NODE_MIX_RGB_SATURATION","USE_NODE_MIX_RGB_VALUE","USE_NODE_MIX_RGB_COLOR","USE_NODE_COMBHSV",{TYPE:"logical_or_expr",PLACES:6}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","kh","(","vec3","kg",")","{","vec4","hI","=","vec4","(","_1_0",",","2.0","/","3.0",",","_1_0","/","3.0",",","3.0",")",";","vec3","p","=","abs","(","fract","(","vec3","(","kg",".","r",",","kg",".","r",",","kg",".","r",")","+","hI",".","xyz",")","*","6.0","-","hI",".","www",")",";","return","kg",".","b","*","mix","(","hI",".","xxx",",","clamp","(","p","-","hI",".","xxx",",","_0_0",",","_1_0",")",",","kg",".","g",")",";","}"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_GEOMETRY_UV","USE_NODE_B4W_PARALLAX","USE_NODE_UV_MERGED","USE_NODE_TEX_COORD_UV","USE_NODE_UVMAP",{TYPE:"logical_or_expr",PLACES:5}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","rX","(","vec2","gT",")","{","return","vec3","(","gT","*","2.0","-","vec2","(","_1_0",",","_1_0",")",",","_0_0",")",";","}"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_TEXTURE_COLOR","USE_NODE_TEXTURE_NORMAL","USE_NODE_B4W_PARALLAX",{TYPE:"logical_or_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec2","rY","(","vec3","rf",")","{","return","vec2","(","rf",".","xy","*","_0_5","+","vec2","(","_0_5",",","_0_5",")",")",";","}"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_FRESNEL","USE_NODE_LAYER_WEIGHT",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","sb","(","vec3","rZ",",","vec3","r_",",","float","sa",")","{","float","du","=","abs","(","dot","(","rZ",",","r_",")",")",";","float","g","=","sa","*","sa","-","_1_0","+","du","*","du",";","float","dY",";","if","(","g",">","_0_0",")","{","g","=","sqrt","(","g",")",";","float","cB","=","(","g","-","du",")","/","(","g","+","du",")",";","float","hO","=","(","du","*","(","g","+","du",")","-","_1_0",")","/","(","du","*","(","g","-","du",")","+","_1_0",")",";","dY","=","_0_5","*","cB","*","cB","*","(","_1_0","+","hO","*","hO",")",";","}","else","{","dY","=","_1_0",";","}","return","dY",";","}"]}]}}]},{TYPE:"node",NAME:"CAMERA",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"sE",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"sF",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"sG",QUALIFIER:["float"],IS_OPTIONAL:!0}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_sE"],STATEMENTS:[{TYPE:"txt",TOKENS:["sE","=","normalize","(","sB",".","xyz",")",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_sF"],STATEMENTS:[{TYPE:"txt",TOKENS:["sF","=","abs","(","sB",".","z",")",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_sG"],STATEMENTS:[{TYPE:"txt",TOKENS:["sG","=","length","(","sB",".","xyz",")",";"]}]}]}]},{TYPE:"node",NAME:"COMBRGB",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"sH",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"sI",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"sJ",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"sK",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["sK","=","vec3","(","sH",",","sI",",","sJ",")",";"]}]},{TYPE:"node",NAME:"COMBHSV",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"sL",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"sM",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"sN",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"sO",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["sO","=","kh","(","vec3","(","sL",",","sM",",","sN",")",")",";"]}]},{TYPE:"node",NAME:"EMPTY_UV",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"sP",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["sP","=","vec3","(","-","_1_0",",","-","_1_0",",","_0_0",")",";"]}]},{TYPE:"node",NAME:"EMPTY_VC",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"sQ",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["sQ","=","vec3","(","_0_0",")",";"]}]},{TYPE:"node",NAME:"GEOMETRY_UV",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"sR",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_param",NAME:"sc",QUALIFIER:["GLSL_IN","vec2"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["sR","=","rX","(","sc",")",";"]}]},{TYPE:"node",NAME:"GEOMETRY_OR",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"sS",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["sS","=","2.0","*","rT","-","vec3","(","_1_0",")",";"]}]},{TYPE:"node",NAME:"GEOMETRY_VC",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"sT",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_param",NAME:"sd",QUALIFIER:["GLSL_IN","vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["sT","=","max","(","vec3","(","_0_0",")",",","sd",")",";","bC","(","sT",")",";"]}]},{TYPE:"node",NAME:"GEOMETRY_VC1",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"sU",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_param",NAME:"se",QUALIFIER:["GLSL_IN","float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["sU","=","max","(","_0_0",",","se",")",";","bC","(","sU",")",";"]}]},{TYPE:"node",NAME:"GEOMETRY_VC2",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"sV",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"sW",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_param",NAME:"sf",QUALIFIER:["GLSL_IN","vec2"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["sV","=","max","(","_0_0",",","sf","[","0","]",")",";","sW","=","max","(","_0_0",",","sf","[","1","]",")",";","bC","(","sV",")",";","bC","(","sW",")",";"]}]},{TYPE:"node",NAME:"GEOMETRY_VC3",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"sX",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"sY",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"sZ",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_param",NAME:"sg",QUALIFIER:["GLSL_IN","vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["sX","=","max","(","_0_0",",","sg","[","0","]",")",";","sY","=","max","(","_0_0",",","sg","[","1","]",")",";","sZ","=","max","(","_0_0",",","sg","[","2","]",")",";","bC","(","sX",")",";","bC","(","sY",")",";","bC","(","sZ",")",";"]}]},{TYPE:"node",NAME:"GEOMETRY_NO",NODE_VARS:[{TYPE:"node_var",NAME:"USE_NORMAL_IN",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"s_",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"ta",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_NORMAL_IN"],STATEMENTS:[{TYPE:"txt",TOKENS:["ta","=","s_",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["ta","=","su",".","xyz",";"]}]}]}]},{TYPE:"node",NAME:"GEOMETRY_FB",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"tb",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["REFLECTION_PASS","REFL_PASS_PLANE",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:["tb","=","(","gl_FrontFacing",")","?","_0_0",":","_1_0",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["tb","=","(","gl_FrontFacing",")","?","_1_0",":","_0_0",";"]}]}]}]},{TYPE:"node",NAME:"GEOMETRY_BF",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"tc",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["REFLECTION_PASS","REFL_PASS_PLANE",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:["tc","=","(","gl_FrontFacing",")","?","_1_0",":","_0_0",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["tc","=","(","gl_FrontFacing",")","?","_0_0",":","_1_0",";"]}]}]}]},{TYPE:"node",NAME:"GEOMETRY_VW",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"td",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["td","=","-","_","(","u_view_tsr_frag",",","ou",")",";"]}]},{TYPE:"node",NAME:"GEOMETRY_LO",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"te",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["te","=","sB",".","xyz",";"]}]},{TYPE:"node",NAME:"GEOMETRY_GL",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"tf",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["tf","=","os",";"]}]},{TYPE:"node",NAME:"GEOMETRY_IN",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"tg",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["tg","=","ou",";"]}]},{TYPE:"node",NAME:"NEW_GEOMETRY",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"th",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"ti",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"tj",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"tk",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"tl",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"tm",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"tn",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"to",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["th","=","vec3","(","_0_0",")",";","ti","=","vec3","(","_0_0",")",";","tj","=","vec3","(","_0_0",")",";","tk","=","vec3","(","_0_0",")",";","tl","=","vec3","(","_0_0",")",";","tm","=","vec3","(","_0_0",")",";","tn","=","_0_0",";","to","=","_0_0",";"]}]},{TYPE:"node",NAME:"HUE_SAT",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"tr",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"tu",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"tv",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"tw",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"tx",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"ty",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["vec3","kg","=","kf","(","tx",")",";","kg","[","0","]","+=","(","tr","-","_0_5",")",";","if","(","kg","[","0","]",">","_1_0",")","kg","[","0","]","-=","_1_0",";","else","if","(","kg","[","0","]","<","_0_0",")","kg","[","0","]","+=","_1_0",";","kg","*=","vec3","(","_1_0",",","tu",",","tv",")",";","kg","=","mix","(","vec3","(","_1_0",")",",","mix","(","vec3","(","_0_0",")",",","kg",",","step","(","vec3","(","_0_0",")",",","kg",")",")",",","step","(","kg",",","vec3","(","_1_0",")",")",")",";","ty","=","mix","(","tx",",","kh","(","kg",")",",","tw",")",";"]}]},{TYPE:"node",NAME:"INVERT",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"tz",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"tA",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"tB",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["tB","=","mix","(","tA",",","vec3","(","_1_0",")","-","tA",",","tz",")",";"]}]},{TYPE:"node",NAME:"LAMP",NODE_VARS:[{TYPE:"node_var",NAME:"LAMP_TYPE",TOKENS:["HEMI"]},{TYPE:"node_var",NAME:"LAMP_INDEX",TOKENS:["0"]},{TYPE:"node_var",NAME:"LAMP_USE_SPHERE",TOKENS:["0"]},{TYPE:"node_var",NAME:"LAMP_SPOT_SIZE",TOKENS:["0.8"]},{TYPE:"node_var",NAME:"LAMP_SPOT_BLEND",TOKENS:["0.03"]},{TYPE:"node_var",NAME:"LAMP_LIGHT_DIST",TOKENS:["30.0"]}],DECLARATIONS:[{TYPE:"node_out",NAME:"tC",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"tD",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"tE",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"tF",QUALIFIER:["float"],IS_OPTIONAL:!0}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["LAMP_INDEX",1,{TYPE:"negative_expr",PLACES:1},{TYPE:"non_equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_tC"],STATEMENTS:[{TYPE:"txt",TOKENS:["tC","=","u_lamp_light_color_intensities","[","LAMP_INDEX","]",";"]}]}]},{TYPE:"txt",TOKENS:["vec3","tG","=","u_lamp_light_directions","[","LAMP_INDEX","]",";","vec3","tH","=","u_lamp_light_positions","[","LAMP_INDEX","]",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["LAMP_TYPE","SPOT",{TYPE:"equal_expr",PLACES:2},"LAMP_TYPE","POINT",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:["tD","=","h","-","tH",";","tE","=","length","(","tD",")",";","tD","=","normalize","(","tD",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_tF"],STATEMENTS:[{TYPE:"txt",TOKENS:["tF","=","LAMP_LIGHT_DIST","/","(","LAMP_LIGHT_DIST","+","tE","*","tE",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["LAMP_TYPE","SPOT",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:["float","oY","=","dot","(","-","tD",",","tG",")",";","oY","*=","smoothstep","(","_0_0",",","_1_0",",","(","oY","-","LAMP_SPOT_SIZE",")","/","LAMP_SPOT_BLEND",")",";","tF","*=","oY",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["LAMP_USE_SPHERE"],STATEMENTS:[{TYPE:"txt",TOKENS:["tF","*=","max","(","LAMP_LIGHT_DIST","-","tE",",","_0_0",")","/","LAMP_LIGHT_DIST",";"]}]}]}]}]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_tD"],STATEMENTS:[{TYPE:"txt",TOKENS:["tD","=","tG",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_tE"],STATEMENTS:[{TYPE:"txt",TOKENS:["tE","=","length","(","tH","-","h",")",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_tF"],STATEMENTS:[{TYPE:"txt",TOKENS:["tF","=","_1_0",";"]}]}]}]}]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_tC"],STATEMENTS:[{TYPE:"txt",TOKENS:["tC","=","vec3","(","_0_0",")",";"]}]}]},{TYPE:"txt",TOKENS:["tD","=","vec3","(","_0_0",")",";","tE","=","0.0",";"]}]}]}]},{TYPE:"node",NAME:"NORMAL",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"tI",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"tJ",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"tK",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_param",NAME:"sh",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_tJ"],STATEMENTS:[{TYPE:"txt",TOKENS:["tJ","=","sh",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_tK"],STATEMENTS:[{TYPE:"txt",TOKENS:["tK","=","-","dot","(","tI",",","sh",")",";"]}]}]}]},{TYPE:"node",NAME:"B4W_VECTOR_VIEW",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"tL",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"tM",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["tM","=","-","_","(","u_view_tsr_frag",",","tL",")",";"]}]},{TYPE:"node",NAME:"BSDF_BEGIN",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"tN",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"tO",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"tP",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"tQ",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"tR",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"tS",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"tT",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"tU",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"tV",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"tW",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"tX",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"tY",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"tZ",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"t_",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"ua",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"ub",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"uc",QUALIFIER:["vec4"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"ud",QUALIFIER:["vec4"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"ue",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"uf",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"ug",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"uh",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"ui",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"uj",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["t_","=","tO",";","ua","=","tQ",";","ub","=","tT",";","ue","=","tO",";","uf","=","tQ",";","ug","=","tU",";","uh","=","tV",";","ui","=","tW",";","uj","=","tX",";","tY","=","sC","*","t_",";","tZ","=","sD","*","u_environment_energy","*","cz","(","ub",")",";","ud","=","cC","(","t_",")",";","H","=","ud",";","uc","[","0","]","=","tP",";","uc","[","1","]","=","tR",";","uc","[","2","]","=","tS",";"]}]},{TYPE:"node",NAME:"BSDF_END",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"uk",QUALIFIER:["vec4"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"ul",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"um",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"un",QUALIFIER:["vec4"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"uo",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"up",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"uq",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"ur",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"us",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"ut",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"uu",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"uv",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["float","uw","=","clamp","(","un","[","1","]",",","_0_0",",","_1_0",")",";","float","rF","=","un","[","2","]",";","uu","=","uk",".","rgb",";","uv","=","_1_0",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["REFLECTION_TYPE","REFL_PBR_STANDARD",{TYPE:"equal_expr",PLACES:2},"REFLECTION_TYPE","REFL_PBR_SIMPLE",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:["uu","+=","rP","(","uo",",","up",",","ou",",","um",",","rF",",","uw",",","mat3","(","_0_0",")",")",";"]}]},{TYPE:"node_elif",EXPRESSION:["REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:["uu","+=","rP","(","uo",",","up",",","ou",",","um",",","rF",",","u_view_tsr_frag",")",";"]}]}]},{TYPE:"txt",TOKENS:["uu","+=","ul",";","uu","=","mix","(","uu",",","uq",",","ur",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_NODE_BSDF_TRANSPARENT"],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_BSDF_TRANSPARENT_REFRACT"],STATEMENTS:[{TYPE:"txt",TOKENS:["vec3","ux","=","GLSL_TEXTURE","(","u_refractmap",",","l",".","xy","/","l",".","z",")",".","rgb",";","bC","(","ux",")",";","us","=","us","*","ux",";","uu","+=","us",";","uv","=","_1_0",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_BSDF_TRANSPARENT_ALPHA"],STATEMENTS:[{TYPE:"txt",TOKENS:["uu","=","mix","(","us",",","uu",",","ut",")",";","uv","=","ut",";"]}]}]}]}]},{TYPE:"txt",TOKENS:["um",";"]}]},{TYPE:"node",NAME:"BSDF_COMPUTE",NODE_VARS:[{TYPE:"node_var",NAME:"MAT_USE_TBN_SHADING",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"uy",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"uz",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"uA",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"uB",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"uC",QUALIFIER:["vec4"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"uD",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"uE",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["vec3","r_","=","uA",";","float","uF","=","clamp","(","uC","[","0","]",",","_0_0",",","_1_0",")",";","float","uw","=","clamp","(","uC","[","1","]",",","_0_0",",","_1_0",")",";","float","rF","=","uC","[","2","]",";","vec3","pW","=","normalize","(","ou","+","uy",")",";","float","pf","=","(","_1_0","-","uB",")","*","dot","(","r_",",","uy",")","+","uB",";","float","uG","=","(","_1_0","-","uB",")","*","max","(","dot","(","uy",",","pW",")",",","_0_0",")","+","uB",";","float","uH","=","(","_1_0","-","uB",")","*","max","(","dot","(","uA",",","pW",")",",","_0_0",")","+","uB",";","uD","=","_0_0",";","if","(","uz",".","r","!=","_0_0",")","{","if","(","uF",">","_0_0",")","{","float","pv","=","max","(","dot","(","r_",",","ou",")",",","_0_0",")",";","float","pw","=","uF","*","uF",";","float","cB","=","_1_0","-","_0_5","*","(","pw","/","(","pw","+","0.33",")",")",";","vec3","px","=","uy","-","pf","*","r_",";","vec3","py","=","ou","-","pv","*","r_",";","if","(","length","(","px",")","==","_0_0","||","length","(","py",")","==","_0_0","||","abs","(","pf",")",">","_1_0","||","abs","(","pv",")",">","_1_0",")","uD","=","pf","*","cB",";","else","{","float","pz","=","acos","(","pf",")",";","float","pA","=","acos","(","pv",")",";","vec3","pB","=","normalize","(","px",")",";","vec3","pC","=","normalize","(","py",")",";","float","a",",","b",";","a","=","max","(","pz",",","pA",")",";","b","=","min","(","pz",",","pA",")",";","b","*=","0.95",";","float","t","=","max","(","dot","(","pB",",","pC",")",",","_0_0",")",";","float","hO","=","0.45","*","(","pw","/","(","pw","+","0.09",")",")",";","uD","=","pf","*","(","cB","+","(","hO","*","t","*","sin","(","a",")","*","tan","(","b",")",")",")",";","}","}","else","uD","=","pf",";","uD","=","max","(","uD",",","_0_0",")","/","M_PI",";","}","float","L","=","uw",";","float","uI","=","L","*","L",";","float","dX","=","(","uH","*","uI","-","uH",")","*","uH","+","_1_0",";","float","cy","=","uI","/","(","M_PI","*","dX","*","dX",")",";","float","uJ",";","float","uK",";","float","uL","=","pow","(","_1_0","-","uG",",","5.0",")",";","uJ","=","_1_0",";","uK","=","uL",";","float","hI","=","L","/","2.0",";","float","uM","=","hI","*","hI",";","float","uN","=","_1_0","-","uM",";","float","uO","=","_1_0","/","(","uG","*","uG","*","uN","+","uM",")",";","uJ","*=","uO",";","uK","*=","uO",";","float","rC","=","mix","(","0.04",",","_1_0",",","rF",")",";","float","uP","=","mix","(","uK",",","uJ",",","rC",")",";","uE","=","max","(","pf","*","cy","*","uP",",","_0_0",")",";"]}]},{TYPE:"node",NAME:"BSDF_PRINCIPLED",NODE_VARS:[{TYPE:"node_var",NAME:"USE_NORMAL_IN",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"uQ",QUALIFIER:["vec4"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"uR",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"uS",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"uT",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"uU",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"uV",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"uW",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"uX",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"uY",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"uZ",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"u_",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"va",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vb",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vc",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vd",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["uX","=","uQ",".","rgb",";","uY","=","uS","*","uS",";","uV","=","uQ",".","rgb",";","uW","=","uS",";","uZ","=","uR",";","vb","=","_0_0",";","vd","=","_1_0",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_NORMAL_IN"],STATEMENTS:[{TYPE:"txt",TOKENS:["u_","=","uT",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["u_","=","ot",";"]}]}]},{TYPE:"txt",TOKENS:["uU",";","va","=","vec3","(","_0_0",")",";","vc","=","vec3","(","_0_0",")",";"]}]},{TYPE:"node",NAME:"BSDF_ANISOTROPIC",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"ve",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"vf",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"vg",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"vh",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"vi",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"vj",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vk",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["vk","=","ve",";","vf",";","vg",";","vh",";","vi",";","vj",";"]}]},{TYPE:"node",NAME:"BSDF_DIFFUSE",NODE_VARS:[{TYPE:"node_var",NAME:"USE_NORMAL_IN",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"vl",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"vm",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"vn",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vo",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vp",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vq",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vr",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vs",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vt",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vu",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vv",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vw",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vx",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vy",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["vp","=","vl",";","vq","=","vm",";","vs","=","_1_0",";","vt","=","_0_0",";","vw","=","_0_0",";","vy","=","_1_0",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_NORMAL_IN"],STATEMENTS:[{TYPE:"txt",TOKENS:["vu","=","vn",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["vu","=","ot",";"]}]}]},{TYPE:"txt",TOKENS:["vo",";","vr","=","vec3","(","_0_0",")",";","vv","=","vec3","(","_0_0",")",";","vx","=","vec3","(","_0_0",")",";"]}]},{TYPE:"node",NAME:"BSDF_GLASS",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"vz",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"vA",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"vB",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"vC",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vD",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["vD","=","vz",";","vA",";","vB",";","vC",";"]}]},{TYPE:"node",NAME:"BSDF_GLOSSY",NODE_VARS:[{TYPE:"node_var",NAME:"USE_NORMAL_IN",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"vE",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"vF",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"vG",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vH",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vI",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vJ",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vK",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vL",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vM",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vN",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vO",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vP",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vQ",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vR",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["vK","=","vE",";","vL","=","vF",";","vM","=","_1_0",";","vP","=","_0_0",";","vR","=","_1_0",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_NORMAL_IN"],STATEMENTS:[{TYPE:"txt",TOKENS:["vN","=","vG",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["vN","=","ot",";"]}]}]},{TYPE:"txt",TOKENS:["vH",";","vI","=","vec3","(","_0_0",")",";","vJ","=","_0_0",";","vO","=","vec3","(","_0_0",")",";","vQ","=","vec3","(","_0_0",")",";"]}]},{TYPE:"node",NAME:"BSDF_HAIR",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"vS",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"vT",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"vU",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"vV",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vW",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["vW","=","vS",";","vT",";","vU",";","vV",";"]}]},{TYPE:"node",NAME:"BSDF_TRANSPARENT",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"vX",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vY",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vZ",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"v_",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wa",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wb",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wc",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wd",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"we",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wf",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wg",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wh",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["wg","=","vX",";","wc","=","_0_0",";","wf","=","_0_0",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_BSDF_TRANSPARENT_ALPHA"],STATEMENTS:[{TYPE:"txt",TOKENS:["wh","=","_0_0",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["wh","=","_1_0",";"]}]}]},{TYPE:"txt",TOKENS:["wd","=","ot",";","vY",";","vZ","=","vec3","(","_0_0",")",";","v_","=","_0_0",";","wa","=","vec3","(","_0_0",")",";","wb","=","_0_0",";","we","=","vec3","(","_0_0",")",";"]}]},{TYPE:"node",NAME:"BSDF_TRANSLUCENT",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"wi",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"wj",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wk",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["wk","=","wi",";","wj",";"]}]},{TYPE:"node",NAME:"BSDF_REFRACTION",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"wl",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"wm",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"wn",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"wo",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wp",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["wp","[","0","]","=","wp","[","1","]","=","wp","[","2","]","=","_0_0",";","wl",";","wm",";","wn",";","wo",";"]}]},{TYPE:"node",NAME:"BSDF_TOON",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"wq",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"wr",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"ws",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"wt",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wu",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["wu","=","wq",";","wr",";","ws",";","wt",";"]}]},{TYPE:"node",NAME:"BSDF_VELVET",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"wv",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"wA",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"wB",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wC",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["wC","=","wv",";","wA",";","wB",";"]}]},{TYPE:"node",NAME:"SUBSURFACE_SCATTERING",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"wD",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"wE",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"wF",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"wG",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"wH",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"wI",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wJ",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["wJ","[","0","]","=","wJ","[","1","]","=","wJ","[","2","]","=","_0_0",";","wD",";","wF",";","wG",";","wH",";","wI",";","wE",";"]}]},{TYPE:"node",NAME:"EMISSION",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"wK",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"wL",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wM",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wN",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wO",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wP",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wQ",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wR",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wS",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wT",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wU",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wV",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wW",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["wT","=","wL","*","wK",";","wR","=","_0_0",";","wU","=","_1_0",";","wW","=","_1_0",";","wS","=","ot",";","wM",";","wN","=","vec3","(","_0_0",")",";","wO","=","_0_0",";","wP","=","vec3","(","_0_0",")",";","wQ","=","_0_0",";"]}]},{TYPE:"node",NAME:"AMBIENT_OCCLUSION",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"wX",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wY",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["wY","[","0","]","=","wY","[","1","]","=","wY","[","2","]","=","_0_0",";","wX",";"]}]},{TYPE:"node",NAME:"HOLDOUT",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"wZ",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["wZ","[","0","]","=","wZ","[","1","]","=","wZ","[","2","]","=","_0_0",";"]}]},{TYPE:"node",NAME:"VOLUME_ABSORPTION",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"w_",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"xa",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"xb",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["xb","[","0","]","=","xb","[","1","]","=","xb","[","2","]","=","_0_0",";","w_",";","xa",";"]}]},{TYPE:"node",NAME:"VOLUME_SCATTER",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"xc",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"xd",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"xe",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"xf",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["xf","[","0","]","=","xf","[","1","]","=","xf","[","2","]","=","_0_0",";","xc",";","xd",";","xe",";"]}]},{TYPE:"node",NAME:"BUMP",NODE_VARS:[{TYPE:"node_var",NAME:"INVERT",TOKENS:["0"]},{TYPE:"node_var",NAME:"USE_NORMAL_IN",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"xg",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"xh",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"xi",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"xj",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"xk",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["float","aM","=","xh",";","float","gH","=","xg",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["INVERT"],STATEMENTS:[{TYPE:"txt",TOKENS:["aM","=","-","_1_0",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_NORMAL_IN"],STATEMENTS:[{TYPE:"txt",TOKENS:["vec3","U","=","xj",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["vec3","U","=","ot",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_DERIVATIVES_EXT"],STATEMENTS:[{TYPE:"txt",TOKENS:["vec3","xl","=","dFdx","(","os",")",";","vec3","xm","=","dFdy","(","os",")",";","vec3","xn","=","cross","(","xm",",","U",")",";","vec3","xo","=","cross","(","U",",","xl",")",";","float","dv","=","dot","(","xl",",","xn",")",";","float","xp","=","abs","(","dv",")",";","vec3","xq","=","dFdx","(","xi",")","*","xn","+","dFdy","(","xi",")","*","xo",";","gH","=","max","(","gH",",","_0_0",")",";","xk","=","normalize","(","xp","*","U","-","aM","*","sign","(","dv",")","*","xq",")",";","xk","=","normalize","(","gH","*","xk","+","(","_1_0","-","gH",")","*","U",")",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["xk","=","U",";"]}]}]}]},{TYPE:"node",NAME:"DISPLACEMENT_BUMP",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"xr",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"xs",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["float","aM","=","0.1",";","vec3","U","=","ot",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_DERIVATIVES_EXT"],STATEMENTS:[{TYPE:"txt",TOKENS:["vec3","xl","=","dFdx","(","os",")",";","vec3","xm","=","dFdy","(","os",")",";","vec3","xn","=","cross","(","xm",",","U",")",";","vec3","xo","=","cross","(","U",",","xl",")",";","float","dv","=","dot","(","xl",",","xn",")",";","float","xp","=","abs","(","dv",")",";","vec3","xq","=","dFdx","(","xr",")","*","xn","+","dFdy","(","xr",")","*","xo",";","xs","=","normalize","(","xp","*","U","-","aM","*","sign","(","dv",")","*","xq",")",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["xs","=","U",";"]}]}]}]},{TYPE:"node",NAME:"NORMAL_MAP",NODE_VARS:[{TYPE:"node_var",NAME:"SPACE",TOKENS:["NM_TANGENT"]},{TYPE:"node_var",NAME:"USE_NORMAL_IN",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"xt",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"xu",QUALIFIER:["vec4"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"xv",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"xA",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_NORMAL_IN"],STATEMENTS:[{TYPE:"txt",TOKENS:["vec3","xB","=","xv",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["vec3","xB","=","sw",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["SPACE","NM_TANGENT",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:["xA","=","2.0","*","xu",".","xyz","-","_1_0",";","xA","=","sA","*","xA",";"]}]},{TYPE:"node_elif",EXPRESSION:["SPACE","NM_OBJECT",{TYPE:"equal_expr",PLACES:2},"SPACE","NM_BLENDER_OBJECT",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:["xA","=","2.0","*","xu",".","xyz","-","_1_0",";","xA",".","yz","*=","-","_1_0",";","xA","=","_","(","u_model_tsr",",","xA",")",";"]}]},{TYPE:"node_elif",EXPRESSION:["SPACE","NM_WORLD",{TYPE:"equal_expr",PLACES:2},"SPACE","NM_BLENDER_WORLD",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:["xA","=","2.0","*","xu",".","xyz","-","_1_0",";","xA",".","yz","*=","-","_1_0",";"]}]}]},{TYPE:"txt",TOKENS:["float","ma","=","max","(","xt",",","_0_0",")",";","xA","=","normalize","(","mix","(","xB",",","xA",",","ma",")",")",";"]}]},{TYPE:"node",NAME:"VECT_TRANSFORM",NODE_VARS:[{TYPE:"node_var",NAME:"CONVERT_TYPE",TOKENS:["VT_WORLD_TO_OBJECT"]},{TYPE:"node_var",NAME:"VECTOR_TYPE",TOKENS:["VT_VECTOR"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"xC",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"xD",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["CONVERT_TYPE","VT_WORLD_TO_WORLD",{TYPE:"equal_expr",PLACES:2},"CONVERT_TYPE","VT_OBJECT_TO_OBJECT",{TYPE:"equal_expr",PLACES:2},"CONVERT_TYPE","VT_CAMERA_TO_CAMERA",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:3}],STATEMENTS:[{TYPE:"txt",TOKENS:["xD","=","xC",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["VECTOR_TYPE","VT_POINT",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["CONVERT_TYPE","VT_WORLD_TO_CAMERA",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:["xD","=","ap","(","u_view_tsr_frag",",","xC",")",";"]}]},{TYPE:"node_elif",EXPRESSION:["CONVERT_TYPE","VT_WORLD_TO_OBJECT",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:["xD","=","ap","(","u_model_tsr_inverse",",","xC",")",";"]}]},{TYPE:"node_elif",EXPRESSION:["CONVERT_TYPE","VT_OBJECT_TO_WORLD",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:["xD","=","ap","(","u_model_tsr",",","xC",")",";"]}]},{TYPE:"node_elif",EXPRESSION:["CONVERT_TYPE","VT_OBJECT_TO_CAMERA",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:["xD","=","ap","(","u_model_tsr",",","xC",")",";","xD","=","ap","(","u_view_tsr_frag",",","xD",")",";"]}]},{TYPE:"node_elif",EXPRESSION:["CONVERT_TYPE","VT_CAMERA_TO_WORLD",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:["xD","=","ap","(","u_view_tsr_inverse",",","xC",")",";"]}]},{TYPE:"node_elif",EXPRESSION:["CONVERT_TYPE","VT_CAMERA_TO_OBJECT",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:["xD","=","ap","(","u_view_tsr_inverse",",","xC",")",";","xD","=","ap","(","u_model_tsr_inverse",",","xD",")",";"]}]}]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["CONVERT_TYPE","VT_WORLD_TO_CAMERA",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:["xD","=","_","(","u_view_tsr_frag",",","xC",")",";"]}]},{TYPE:"node_elif",EXPRESSION:["CONVERT_TYPE","VT_WORLD_TO_OBJECT",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:["xD","=","_","(","u_model_tsr_inverse",",","xC",")",";"]}]},{TYPE:"node_elif",EXPRESSION:["CONVERT_TYPE","VT_OBJECT_TO_WORLD",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:["xD","=","_","(","u_model_tsr",",","xC",")",";"]}]},{TYPE:"node_elif",EXPRESSION:["CONVERT_TYPE","VT_OBJECT_TO_CAMERA",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:["xD","=","_","(","u_model_tsr",",","xC",")",";","xD","=","_","(","u_view_tsr_frag",",","xD",")",";"]}]},{TYPE:"node_elif",EXPRESSION:["CONVERT_TYPE","VT_CAMERA_TO_WORLD",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:["xD","=","_","(","u_view_tsr_inverse",",","xC",")",";"]}]},{TYPE:"node_elif",EXPRESSION:["CONVERT_TYPE","VT_CAMERA_TO_OBJECT",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:["xD","=","_","(","u_view_tsr_inverse",",","xC",")",";","xD","=","_","(","u_model_tsr_inverse",",","xD",")",";"]}]}]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["VECTOR_TYPE","VT_NORMAL",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:["xD","=","normalize","(","xD",")",";"]}]}]}]}]}]},{TYPE:"node",NAME:"BLACKBODY",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"xE",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"xF",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["xF","[","0","]","=","xF","[","1","]","=","xF","[","2","]","=","_0_0",";","xE",";"]}]},{TYPE:"node",NAME:"WAVELENGTH",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"xG",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"xH",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["xH","[","0","]","=","xH","[","1","]","=","xH","[","2","]","=","_0_0",";","xG",";"]}]},{TYPE:"node",NAME:"SEPXYZ",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"xI",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"xJ",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"xK",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"xL",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["xJ","=","xI","[","0","]",";","xK","=","xI","[","1","]",";","xL","=","xI","[","2","]",";"]}]},{TYPE:"node",NAME:"COMBXYZ",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"xM",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"xN",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"xO",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"xP",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["xP","[","0","]","=","xM",";","xP","[","1","]","=","xN",";","xP","[","2","]","=","xO",";"]}]},{TYPE:"node",NAME:"BRIGHTCONTRAST",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"xQ",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"xR",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"xS",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"xT",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["float","b","=","xR","-","xS","*","_0_5",";","xT","=","max","(","(","_1_0","+","xS",")","*","xQ","+","b",",","vec3","(","_0_0",")",")",";"]}]},{TYPE:"node",NAME:"LIGHT_FALLOFF",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"xU",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"xV",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"xW",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"xX",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"xY",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["xW","=","xX","=","xY","=","_0_0",";","xU",";","xV",";"]}]},{TYPE:"node",NAME:"TEX_SKY",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"xZ",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"x_",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["x_","[","0","]","=","x_","[","1","]","=","x_","[","2","]","=","_0_0",";","xZ",";"]}]},{TYPE:"node",NAME:"TEX_NOISE",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"ya",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yb",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yc",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yd",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"ye",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"yf",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["ye","[","0","]","=","ye","[","1","]","=","ye","[","2","]","=","_0_0",";","yf","=","_1_0",";","ya",";","yb",";","yc",";","yd",";"]}]},{TYPE:"node",NAME:"TEX_WAVE",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"yg",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yh",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yi",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yj",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yk",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"yl",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"ym",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["yl","[","0","]","=","yl","[","1","]","=","yl","[","2","]","=","_0_0",";","ym","=","_1_0",";","yg",";","yh",";","yi",";","yj",";","yk",";"]}]},{TYPE:"node",NAME:"TEX_VORONOI",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"yn",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yo",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"yp",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"yq",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["yp","[","0","]","=","yp","[","1","]","=","yp","[","2","]","=","_0_0",";","yq","=","_1_0",";","yn",";","yo",";"]}]},{TYPE:"node",NAME:"TEX_MUSGRAVE",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"yr",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"ys",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yt",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yu",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yv",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yA",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yB",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"yC",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"yD",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["yC","[","0","]","=","yC","[","1","]","=","yC","[","2","]","=","_0_0",";","yD","=","_1_0",";","yr",";","ys",";","yt",";","yu",";","yv",";","yA",";","yB",";"]}]},{TYPE:"node",NAME:"TEX_GRADIENT",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"yE",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"yF",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"yG",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["yF","[","0","]","=","yF","[","1","]","=","yF","[","2","]","=","_0_0",";","yG","=","_1_0",";","yE",";"]}]},{TYPE:"node",NAME:"TEX_MAGIC",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"yH",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yI",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yJ",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"yK",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"yL",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["yK","[","0","]","=","yK","[","1","]","=","yK","[","2","]","=","_0_0",";","yL","=","_1_0",";","yH",";","yI",";","yJ",";"]}]},{TYPE:"node",NAME:"TEX_CHECKER",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"yM",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yN",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yO",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yP",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"yQ",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"yR",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["yQ","[","0","]","=","yQ","[","1","]","=","yQ","[","2","]","=","_0_0",";","yR","=","_1_0",";","yM",";","yN",";","yO",";","yP",";"]}]},{TYPE:"node",NAME:"TEX_BRICK",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"yS",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yT",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yU",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yV",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yW",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yX",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yY",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yZ",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"y_",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"za",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"zb",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["za","[","0","]","=","za","[","1","]","=","za","[","2","]","=","_0_0",";","zb","=","_1_0",";","yS",";","yT",";","yU",";","yV",";","yW",";","yX",";","yY",";","yZ",";","y_",";"]}]},{TYPE:"node",NAME:"ADD_SHADER",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"zc",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"zd",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"ze",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["ze","=","clamp","(","zc","+","zd",",","vec3","(","_0_0",")",",","vec3","(","_1_0",")",")",";"]}]},{TYPE:"node",NAME:"MIX_SHADER",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"zf",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"zg",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"zh",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"zi",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"zj",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"zk",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"zl",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"zm",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"zn",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"zo",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"zp",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"zq",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"zr",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"zs",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"zt",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"zu",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"zv",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"zA",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"zB",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"zC",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"zD",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"zE",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"zF",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"zG",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"zH",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"zI",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"zJ",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"zK",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"zL",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"zM",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"zN",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"zO",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"zP",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"zQ",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["float","zR","=","sqrt","(","clamp","(","zf",",","_0_0",",","_1_0",")",")",";","zH","=","mix","(","zi",",","zs",",","zR",")",";","zI","=","mix","(","zj",",","zt",",","zR",")",";","if","(","zm",">","_0_0",")","{","if","(","zA",">","_0_0",")","{","zJ","=","mix","(","zk",",","zu",",","zR",")",";","zK","=","mix","(","zl",",","zv",",","zR",")",";","}","else","{","zJ","=","zk",";","zK","=","zl",";","}","}","else","{","zJ","=","zu",";","zK","=","zv",";","}","if","(","zp",">","_0_0",")","{","if","(","zD",">","_0_0",")","{","zN","=","mix","(","zo",",","zC",",","zR",")",";","}","else","{","zN","=","zo",";","}","}","else","{","zN","=","zC",";","}","zL","=","mix","(","zm",",","zA",",","zR",")",";","zM","=","mix","(","zn",",","zB",",","zR",")",";","zO","=","mix","(","zp",",","zD",",","zR",")",";","zP","=","mix","(","zq",",","zE",",","zR",")",";","zQ","=","mix","(","zr",",","zF",",","zR",")",";"]}]},{TYPE:"node",NAME:"UV_MERGED",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"zS",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"zT",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_param",NAME:"si",QUALIFIER:["GLSL_IN","vec2"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_zS"],STATEMENTS:[{TYPE:"txt",TOKENS:["zS","=","rX","(","si",")",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_zT"],STATEMENTS:[{TYPE:"txt",TOKENS:["zT","=","vec3","(","si",",","_0_0",")",";"]}]}]}]},{TYPE:"node",NAME:"TEX_COORD_UV",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"zU",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_param",NAME:"sj",QUALIFIER:["GLSL_IN","vec2"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["zU","=","vec3","(","sj",",","_0_0",")",";"]}]},{TYPE:"node",NAME:"TEX_COORD_NO",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"zV",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["zV","=","ot",";"]}]},{TYPE:"node",NAME:"TEX_COORD_GE",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"zW",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["IS_WORLD",{TYPE:"logic_negative_expr",PLACES:1}],STATEMENTS:[{TYPE:"txt",TOKENS:["zW","=","rT",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["zW","=","sr",";"]}]}]}]},{TYPE:"node",NAME:"TEX_COORD_OB",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"zX",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["IS_WORLD",{TYPE:"logic_negative_expr",PLACES:1}],STATEMENTS:[{TYPE:"txt",TOKENS:["zX","=","ap","(","u_model_tsr_inverse",",","os",")",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["zX","=","sr",";"]}]}]}]},{TYPE:"node",NAME:"TEX_COORD_CA",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"zY",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["zY",".","xy","=","sB",".","xy",";","zY",".","z","=","_1_0",";"]}]},{TYPE:"node",NAME:"TEX_COORD_WI",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"zZ",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["zZ",".","xy","=","l",".","xy","/","l",".","z",";","zZ",".","z","=","_0_0",";"]}]},{TYPE:"node",NAME:"TEX_COORD_RE",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"z_",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["z_","=","reflect","(","-","ou",",","ot",")",";"]}]},{TYPE:"node",NAME:"UVMAP",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"Aa",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_param",NAME:"sk",QUALIFIER:["GLSL_IN","vec2"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["Aa","=","vec3","(","sk",",","_0_0",")",";"]}]},{TYPE:"node",NAME:"PARTICLE_INFO",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"Ab",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Ac",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Ad",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Ae",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Af",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Ag",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Ah",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["Ab","=","_0_0",";","Ac","=","_0_0",";","Ad","=","_0_0",";","Ae","=","vec3","(","_0_0",")",";","Af","=","_0_0",";","Ag","=","Ae",";","Ah","=","Ae",";"]}]},{TYPE:"node",NAME:"HAIR_INFO",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"Ai",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Aj",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Ak",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Al",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["Ai","=","_0_0",";","Aj","=","_0_0",";","Ak","=","_0_0",";","Al","=","vec3","(","_0_0",")",";"]}]},{TYPE:"node",NAME:"OBJECT_INFO",NODE_VARS:[{TYPE:"node_var",NAME:"USE_LOCATION_OUT",TOKENS:["0"]},{TYPE:"node_var",NAME:"USE_OBJ_IND_OUT",TOKENS:["0"]},{TYPE:"node_var",NAME:"USE_MAT_IND_OUT",TOKENS:["0"]},{TYPE:"node_var",NAME:"USE_RANDOM_OUT",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_out",NAME:"Am",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"An",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Ao",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Ap",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_LOCATION_OUT"],STATEMENTS:[{TYPE:"txt",TOKENS:["Am","=","u_model_tsr","[","0","]",".","xyz",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OBJ_IND_OUT"],STATEMENTS:[{TYPE:"txt",TOKENS:["An","=","u_obj_info",".","r",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_MAT_IND_OUT"],STATEMENTS:[{TYPE:"txt",TOKENS:["Ao","=","u_obj_info",".","g",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_RANDOM_OUT"],STATEMENTS:[{TYPE:"txt",TOKENS:["Ap","=","u_obj_info",".","b",";"]}]}]}]},{TYPE:"node",NAME:"WIREFRAME",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"Aq",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Ar",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["Ar","=","Aq",";"]}]},{TYPE:"node",NAME:"TANGENT",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"As",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["As","=","vec3","(","_0_0",")",";"]}]},{TYPE:"node",NAME:"LAYER_WEIGHT",NODE_VARS:[{TYPE:"node_var",NAME:"USE_NORMAL_IN",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"At",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Au",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Av",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Aw",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_NORMAL_IN"],STATEMENTS:[{TYPE:"txt",TOKENS:["vec3","cr","=","normalize","(","Au",")",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["vec3","cr","=","ot",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["CAMERA_TYPE","CAM_TYPE_PERSP",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:["vec3","Ax","=","normalize","(","ou",")",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["vec3","Ax","=","u_camera_direction",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Av"],STATEMENTS:[{TYPE:"txt",TOKENS:["float","sa","=","max","(","_1_0","-","At",",","0.00001",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["REFLECTION_PASS","REFL_PASS_PLANE",{TYPE:"non_equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:["sa","=","gl_FrontFacing","==","false","?","sa",":","_1_0","/","sa",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["sa","=","gl_FrontFacing","?","sa",":","_1_0","/","sa",";"]}]}]},{TYPE:"txt",TOKENS:["Av","=","sb","(","Ax",",","cr",",","sa",")",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["Av","=","_0_0",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Aw"],STATEMENTS:[{TYPE:"txt",TOKENS:["Aw","=","abs","(","dot","(","Ax",",","cr",")",")",";","float","ew","=","At",";","if","(","ew","!=","_0_5",")","{","ew","=","clamp","(","ew",",","_0_0",",","0.99999",")",";","ew","=","(","ew","<","_0_5",")","?","2.0","*","ew",":","_0_5","/","(","_1_0","-","ew",")",";","Aw","=","pow","(","Aw",",","ew",")",";","}","Aw","=","_1_0","-","Aw",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["Aw","=","_0_0",";"]}]}]}]},{TYPE:"node",NAME:"LIGHT_PATH",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"Ay",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Az",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"AA",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"AB",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"AC",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"AD",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"AE",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"AF",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"AG",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"AH",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"AI",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["Ay","=","Az","=","AA","=","_0_0",";","AB","=","AC","=","AD","=","_0_0",";","AE","=","AI","=","AG","=","AH","=","_0_0",";","AF","=","_0_0",";"]}]},{TYPE:"node",NAME:"ATTRIBUTE",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"AJ",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"AK",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"AL",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["AJ","=","AK","=","vec3","(","_0_0",")",";","AL","=","_0_0",";"]}]},{TYPE:"node",NAME:"SCRIPT",NODE_VARS:[],DECLARATIONS:[],STATEMENTS:[]},{TYPE:"node",NAME:"CURVE_VEC",NODE_VARS:[{TYPE:"node_var",NAME:"READ_R",TOKENS:["0"]},{TYPE:"node_var",NAME:"READ_G",TOKENS:["0"]},{TYPE:"node_var",NAME:"READ_B",TOKENS:["0"]},{TYPE:"node_var",NAME:"NODE_TEX_ROW",TOKENS:["_0_0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"AM",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"AN",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"AO",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["AO","=","AN",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["READ_R"],STATEMENTS:[{TYPE:"txt",TOKENS:["AO",".","r","=","(","GLSL_TEXTURE","(","u_nodes_texture",",","vec2","(","_0_5","*","AN",".","r","+","_0_5",",","NODE_TEX_ROW",")",")",".","r","-","_0_5",")","*","2.0",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["READ_G"],STATEMENTS:[{TYPE:"txt",TOKENS:["AO",".","g","=","(","GLSL_TEXTURE","(","u_nodes_texture",",","vec2","(","_0_5","*","AN",".","g","+","_0_5",",","NODE_TEX_ROW",")",")",".","g","-","_0_5",")","*","2.0",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["READ_B"],STATEMENTS:[{TYPE:"txt",TOKENS:["AO",".","b","=","(","GLSL_TEXTURE","(","u_nodes_texture",",","vec2","(","_0_5","*","AN",".","b","+","_0_5",",","NODE_TEX_ROW",")",")",".","b","-","_0_5",")","*","2.0",";"]}]}]},{TYPE:"txt",TOKENS:["AO","=","mix","(","AN",",","AO",",","AM",")",";"]}]},{TYPE:"node",NAME:"CURVE_RGB",NODE_VARS:[{TYPE:"node_var",NAME:"READ_A",TOKENS:["0"]},{TYPE:"node_var",NAME:"READ_R",TOKENS:["0"]},{TYPE:"node_var",NAME:"READ_G",TOKENS:["0"]},{TYPE:"node_var",NAME:"READ_B",TOKENS:["0"]},{TYPE:"node_var",NAME:"NODE_TEX_ROW",TOKENS:["_0_0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"AP",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"AQ",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"AR",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["READ_A"],STATEMENTS:[{TYPE:"txt",TOKENS:["float","r","=","GLSL_TEXTURE","(","u_nodes_texture",",","vec2","(","AQ",".","r",",","NODE_TEX_ROW",")",")",".","a",";","float","g","=","GLSL_TEXTURE","(","u_nodes_texture",",","vec2","(","AQ",".","g",",","NODE_TEX_ROW",")",")",".","a",";","float","b","=","GLSL_TEXTURE","(","u_nodes_texture",",","vec2","(","AQ",".","b",",","NODE_TEX_ROW",")",")",".","a",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["float","r","=","AQ",".","r",";","float","g","=","AQ",".","g",";","float","b","=","AQ",".","b",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["READ_R"],STATEMENTS:[{TYPE:"txt",TOKENS:["AR",".","r","=","GLSL_TEXTURE","(","u_nodes_texture",",","vec2","(","r",",","NODE_TEX_ROW",")",")",".","r",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["AR",".","r","=","r",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["READ_G"],STATEMENTS:[{TYPE:"txt",TOKENS:["AR",".","g","=","GLSL_TEXTURE","(","u_nodes_texture",",","vec2","(","g",",","NODE_TEX_ROW",")",")",".","g",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["AR",".","g","=","g",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["READ_B"],STATEMENTS:[{TYPE:"txt",TOKENS:["AR",".","b","=","GLSL_TEXTURE","(","u_nodes_texture",",","vec2","(","b",",","NODE_TEX_ROW",")",")",".","b",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["AR",".","b","=","b",";"]}]}]},{TYPE:"txt",TOKENS:["AR","=","mix","(","AQ",",","AR",",","AP",")",";"]}]},{TYPE:"node",NAME:"VALTORGB",NODE_VARS:[{TYPE:"node_var",NAME:"NODE_TEX_ROW",TOKENS:["_0_0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"AS",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"AT",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"AU",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["vec4","AV","=","GLSL_TEXTURE","(","u_nodes_texture",",","vec2","(","AS",",","NODE_TEX_ROW",")",")",";","AT","=","AV",".","rgb",";","AU","=","AV",".","a",";"]}]},{TYPE:"node",NAME:"MAPPING",NODE_VARS:[{TYPE:"node_var",NAME:"MAPPING_SCALE_DEF",TOKENS:["0"]},{TYPE:"node_var",NAME:"MAPPING_SCALE",TOKENS:["vec3","(","_1_0",")"]},{TYPE:"node_var",NAME:"MAPPING_TRANS_DEF",TOKENS:["0"]},{TYPE:"node_var",NAME:"MAPPING_TRANS",TOKENS:["vec3","(","_0_0",")"]},{TYPE:"node_var",NAME:"MAPPING_TRS_MATRIX_DEF",TOKENS:["0"]},{TYPE:"node_var",NAME:"MAPPING_TRS_MATRIX",TOKENS:["mat4","(","_1_0",")"]},{TYPE:"node_var",NAME:"MAPPING_MIN_CLIP_DEF",TOKENS:["0"]},{TYPE:"node_var",NAME:"MAPPING_MIN_CLIP",TOKENS:["vec3","(","_0_0",")"]},{TYPE:"node_var",NAME:"MAPPING_MAX_CLIP_DEF",TOKENS:["0"]},{TYPE:"node_var",NAME:"MAPPING_MAX_CLIP",TOKENS:["vec3","(","_1_0",")"]},{TYPE:"node_var",NAME:"MAPPING_IS_NORMAL",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"AW",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"AX",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["AX","=","AW",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAPPING_SCALE_DEF"],STATEMENTS:[{TYPE:"txt",TOKENS:["AX","=","AX","*","MAPPING_SCALE",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAPPING_TRANS_DEF"],STATEMENTS:[{TYPE:"txt",TOKENS:["AX","=","AX","+","MAPPING_TRANS",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAPPING_TRS_MATRIX_DEF"],STATEMENTS:[{TYPE:"txt",TOKENS:["AX","=","(","MAPPING_TRS_MATRIX","*","vec4","(","AX",",","_1_0",")",")",".","xyz",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAPPING_MIN_CLIP_DEF"],STATEMENTS:[{TYPE:"txt",TOKENS:["AX","=","max","(","AX",",","MAPPING_MIN_CLIP",")",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAPPING_MAX_CLIP_DEF"],STATEMENTS:[{TYPE:"txt",TOKENS:["AX","=","min","(","AX",",","MAPPING_MAX_CLIP",")",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAPPING_IS_NORMAL"],STATEMENTS:[{TYPE:"txt",TOKENS:["AX","=","normalize","(","AX",")",";"]}]}]}]},{TYPE:"node",NAME:"MATH_ADD",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"AY",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"AZ",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"A_",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["A_","=","AY","+","AZ",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["A_","=","clamp","(","A_",",","_0_0",",","_1_0",")",";"]}]}]}]},{TYPE:"node",NAME:"MATH_SUBTRACT",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"Ba",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Bb",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Bc",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["Bc","=","Ba","-","Bb",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["Bc","=","clamp","(","Bc",",","_0_0",",","_1_0",")",";"]}]}]}]},{TYPE:"node",NAME:"MATH_MULTIPLY",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"Bd",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Be",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Bf",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["Bf","=","Bd","*","Be",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["Bf","=","clamp","(","Bf",",","_0_0",",","_1_0",")",";"]}]}]}]},{TYPE:"node",NAME:"MATH_DIVIDE",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"Bg",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Bh",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Bi",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["Bi","=","(","Bh","!=","_0_0",")","?","Bg","/","Bh",":","_0_0",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["Bi","=","clamp","(","Bi",",","_0_0",",","_1_0",")",";"]}]}]}]},{TYPE:"node",NAME:"MATH_SINE",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"Bj",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Bk",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Bl",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["Bl","=","sin","(","Bj",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["Bl","=","clamp","(","Bl",",","_0_0",",","_1_0",")",";"]}]}]},{TYPE:"txt",TOKENS:["Bk",";"]}]},{TYPE:"node",NAME:"MATH_COSINE",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"Bm",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Bn",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Bo",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["Bo","=","cos","(","Bm",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["Bo","=","clamp","(","Bo",",","_0_0",",","_1_0",")",";"]}]}]},{TYPE:"txt",TOKENS:["Bn",";"]}]},{TYPE:"node",NAME:"MATH_TANGENT",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"Bp",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Bq",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Br",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["Br","=","tan","(","Bp",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["Br","=","clamp","(","Br",",","_0_0",",","_1_0",")",";"]}]}]},{TYPE:"txt",TOKENS:["Bq",";"]}]},{TYPE:"node",NAME:"MATH_ARCSINE",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"Bs",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Bt",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Bu",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["Bu","=","(","Bs","<=","_1_0","&&","Bs",">=","-","_1_0",")","?","asin","(","Bs",")",":","_0_0",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["Bu","=","clamp","(","Bu",",","_0_0",",","_1_0",")",";"]}]}]},{TYPE:"txt",TOKENS:["Bt",";"]}]},{TYPE:"node",NAME:"MATH_ARCCOSINE",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"Bv",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Bw",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Bx",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["Bx","=","(","Bv","<=","_1_0","&&","Bv",">=","-","_1_0",")","?","acos","(","Bv",")",":","_0_0",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["Bx","=","clamp","(","Bx",",","_0_0",",","_1_0",")",";"]}]}]},{TYPE:"txt",TOKENS:["Bw",";"]}]},{TYPE:"node",NAME:"MATH_ARCTANGENT",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"By",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Bz",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"BA",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["BA","=","atan","(","By",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["BA","=","clamp","(","BA",",","_0_0",",","_1_0",")",";"]}]}]},{TYPE:"txt",TOKENS:["Bz",";"]}]},{TYPE:"node",NAME:"MATH_POWER",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"BB",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"BC",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"BD",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["if","(","BB","<","_0_0","&&","BC","!=","floor","(","BC",")",")","BD","=","_0_0",";","else","if","(","BC","==","_0_0",")","BD","=","_1_0",";","else","if","(","BB","<","_0_0",")","BD","=","mix","(","_1_0",",","-","_1_0",",","sign","(","mod","(","-","BC",",","2.0",")",")",")","*","pow","(","-","BB",",","BC",")",";","else","if","(","BB","==","_0_0",")","BD","=","_0_0",";","else","BD","=","pow","(","BB",",","BC",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["BD","=","clamp","(","BD",",","_0_0",",","_1_0",")",";"]}]}]}]},{TYPE:"node",NAME:"MATH_LOGARITHM",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"BE",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"BF",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"BG",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["BG","=","(","BE",">","_0_0","&&","BF",">","_0_0",")","?","log2","(","BE",")","/","log2","(","BF",")",":","_0_0",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["BG","=","clamp","(","BG",",","_0_0",",","_1_0",")",";"]}]}]}]},{TYPE:"node",NAME:"MATH_MINIMUM",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"BH",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"BI",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"BJ",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["BJ","=","min","(","BH",",","BI",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["BJ","=","clamp","(","BJ",",","_0_0",",","_1_0",")",";"]}]}]}]},{TYPE:"node",NAME:"MATH_MAXIMUM",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"BK",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"BL",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"BM",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["BM","=","max","(","BK",",","BL",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["BM","=","clamp","(","BM",",","_0_0",",","_1_0",")",";"]}]}]}]},{TYPE:"node",NAME:"MATH_ROUND",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"BN",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"BO",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"BP",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["BP","=","floor","(","BN","+","_0_5",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["BP","=","clamp","(","BP",",","_0_0",",","_1_0",")",";"]}]}]},{TYPE:"txt",TOKENS:["BO",";"]}]},{TYPE:"node",NAME:"MATH_LESS_THAN",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"BQ",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"BR",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"BS",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["BS","=","(","BQ","<","BR",")","?","_1_0",":","_0_0",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["BS","=","clamp","(","BS",",","_0_0",",","_1_0",")",";"]}]}]}]},{TYPE:"node",NAME:"MATH_GREATER_THAN",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"BT",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"BU",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"BV",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["BV","=","(","BT",">","BU",")","?","_1_0",":","_0_0",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["BV","=","clamp","(","BV",",","_0_0",",","_1_0",")",";"]}]}]}]},{TYPE:"node",NAME:"MATH_MODULO",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"BW",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"BX",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"BY",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["BY","=","abs","(","BX",")",">","0.000001","?","mod","(","BW",",","BX",")",":","_0_0",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["BY","=","clamp","(","BY",",","_0_0",",","_1_0",")",";"]}]}]}]},{TYPE:"node",NAME:"MATH_ABSOLUTE",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"BZ",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"B_",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Ca",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["Ca","=","abs","(","BZ",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["Ca","=","clamp","(","Ca",",","_0_0",",","_1_0",")",";"]}]}]},{TYPE:"txt",TOKENS:["B_",";"]}]},{TYPE:"node",NAME:"MIX_RGB_MIX",NODE_VARS:[{TYPE:"node_var",NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"Cb",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Cc",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Cd",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Ce",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["float","zR","=","clamp","(","Cb",",","_0_0",",","_1_0",")",";","Ce","=","mix","(","Cc",",","Cd",",","zR",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["Ce","=","clamp","(","Ce",",","_0_0",",","_1_0",")",";"]}]}]}]},{TYPE:"node",NAME:"MIX_RGB_ADD",NODE_VARS:[{TYPE:"node_var",NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"Cf",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Cg",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Ch",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Ci",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["float","zR","=","clamp","(","Cf",",","_0_0",",","_1_0",")",";","Ci","=","mix","(","Cg",",","Cg","+","Ch",",","zR",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["Ci","=","clamp","(","Ci",",","_0_0",",","_1_0",")",";"]}]}]}]},{TYPE:"node",NAME:"MIX_RGB_MULTIPLY",NODE_VARS:[{TYPE:"node_var",NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"Cj",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Ck",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Cl",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Cm",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["float","zR","=","clamp","(","Cj",",","_0_0",",","_1_0",")",";","Cm","=","mix","(","Ck",",","Ck","*","Cl",",","zR",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["Cm","=","clamp","(","Cm",",","_0_0",",","_1_0",")",";"]}]}]}]},{TYPE:"node",NAME:"MIX_RGB_SUBTRACT",NODE_VARS:[{TYPE:"node_var",NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"Cn",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Co",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Cp",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Cq",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["float","zR","=","clamp","(","Cn",",","_0_0",",","_1_0",")",";","Cq","=","mix","(","Co",",","Co","-","Cp",",","zR",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["Cq","=","clamp","(","Cq",",","_0_0",",","_1_0",")",";"]}]}]}]},{TYPE:"node",NAME:"MIX_RGB_SCREEN",NODE_VARS:[{TYPE:"node_var",NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"Cr",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Cs",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Ct",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Cu",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["float","zR","=","clamp","(","Cr",",","_0_0",",","_1_0",")",";","float","Cv","=","_1_0","-","zR",";","Cu","=","vec3","(","_1_0",")","-","(","vec3","(","Cv",")","+","zR","*","(","vec3","(","_1_0",")","-","Ct",")",")","*","(","vec3","(","_1_0",")","-","Cs",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["Cu","=","clamp","(","Cu",",","_0_0",",","_1_0",")",";"]}]}]}]},{TYPE:"node",NAME:"MIX_RGB_DIVIDE",NODE_VARS:[{TYPE:"node_var",NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"Cw",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Cx",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Cy",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Cz",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["float","zR","=","clamp","(","Cw",",","_0_0",",","_1_0",")",";","float","Cv","=","_1_0","-","zR",";","Cy","+=","step","(","Cy",",","vec3","(","_0_0",")",")",";","Cz","=","Cv","*","Cx","+","zR","*","Cx","/","Cy",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["Cz","=","clamp","(","Cz",",","_0_0",",","_1_0",")",";"]}]}]}]},{TYPE:"node",NAME:"MIX_RGB_DIFFERENCE",NODE_VARS:[{TYPE:"node_var",NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"CA",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"CB",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"CC",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"CD",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["float","zR","=","clamp","(","CA",",","_0_0",",","_1_0",")",";","CD","=","mix","(","CB",",","abs","(","CB","-","CC",")",",","zR",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["CD","=","clamp","(","CD",",","_0_0",",","_1_0",")",";"]}]}]}]},{TYPE:"node",NAME:"MIX_RGB_DARKEN",NODE_VARS:[{TYPE:"node_var",NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"CE",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"CF",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"CG",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"CH",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["float","zR","=","clamp","(","CE",",","_0_0",",","_1_0",")",";","CH","=","min","(","CF",".","rgb",",","CG",".","rgb","*","zR",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["CH","=","clamp","(","CH",",","_0_0",",","_1_0",")",";"]}]}]}]},{TYPE:"node",NAME:"MIX_RGB_LIGHTEN",NODE_VARS:[{TYPE:"node_var",NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"CI",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"CJ",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"CK",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"CL",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["float","zR","=","clamp","(","CI",",","_0_0",",","_1_0",")",";","CL","=","max","(","CJ",".","rgb",",","CK",".","rgb","*","zR",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["CL","=","clamp","(","CL",",","_0_0",",","_1_0",")",";"]}]}]}]},{TYPE:"node",NAME:"MIX_RGB_OVERLAY",NODE_VARS:[{TYPE:"node_var",NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"CM",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"CN",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"CO",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"CP",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["float","zR","=","clamp","(","CM",",","_0_0",",","_1_0",")",";","vec3","CQ","=","vec3","(","_1_0","-","zR",")",";","CP","=","mix","(","CN","*","(","CQ","+","2.0","*","zR","*","CO",")",",","vec3","(","_1_0",")","-","(","CQ","+","2.0","*","zR","*","(","vec3","(","_1_0",")","-","CO",")",")","*","(","vec3","(","_1_0",")","-","CN",")",",","step","(","_0_5",",","CN",")",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["CP","=","clamp","(","CP",",","_0_0",",","_1_0",")",";"]}]}]}]},{TYPE:"node",NAME:"MIX_RGB_DODGE",NODE_VARS:[{TYPE:"node_var",NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"CR",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"CS",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"CT",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"CU",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["float","zR","=","clamp","(","CR",",","_0_0",",","_1_0",")",";","vec3","CV","=","vec3","(","_1_0",")","-","zR","*","CT",";","vec3","CW","=","clamp","(","CS","/","CV",",","_0_0",",","_1_0",")",";","CU","=","mix","(","mix","(","CW",",","vec3","(","_1_0",")",",","step","(","CV",",","vec3","(","_0_0",")",")",")",",","CS",",","step","(","CS",",","vec3","(","_0_0",")",")",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["CU","=","clamp","(","CU",",","_0_0",",","_1_0",")",";"]}]}]}]},{TYPE:"node",NAME:"MIX_RGB_BURN",NODE_VARS:[{TYPE:"node_var",NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"CX",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"CY",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"CZ",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"C_",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["float","zR","=","clamp","(","CX",",","_0_0",",","_1_0",")",";","vec3","ko","=","vec3","(","_1_0","-","zR",")",";","vec3","CV","=","ko","+","zR","*","CZ",";","vec3","CW","=","clamp","(","vec3","(","_1_0",")","-","(","vec3","(","_1_0",")","-","CY",")","/","CV",",","_0_0",",","_1_0",")",";","C_","=","mix","(","CW",",","vec3","(","_0_0",")",",","step","(","CV",",","vec3","(","_0_0",")",")",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["C_","=","clamp","(","C_",",","_0_0",",","_1_0",")",";"]}]}]}]},{TYPE:"node",NAME:"MIX_RGB_HUE",NODE_VARS:[{TYPE:"node_var",NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"Da",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Db",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Dc",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Dd",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["float","zR","=","clamp","(","Da",",","_0_0",",","_1_0",")",";","vec3","kg",",","De",",","CV",";","Dd","=","Db",";","De","=","kf","(","Dc",")",";","if","(","De",".","y","!=","_0_0",")","{","kg","=","kf","(","Dd",")",";","kg",".","x","=","De",".","x",";","CV","=","kh","(","kg",")",";","Dd","=","mix","(","Dd",",","CV",",","zR",")",";","}"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["Dd","=","clamp","(","Dd",",","_0_0",",","_1_0",")",";"]}]}]}]},{TYPE:"node",NAME:"MIX_RGB_SATURATION",NODE_VARS:[{TYPE:"node_var",NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"Df",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Dg",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Dh",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Di",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["float","zR","=","clamp","(","Df",",","_0_0",",","_1_0",")",";","float","Cv","=","_1_0","-","zR",";","Di","=","Dg",";","vec3","kg",",","De",";","kg","=","kf","(","Di",")",";","if","(","kg",".","y","!=","_0_0",")","{","De","=","kf","(","Dh",")",";","kg",".","y","=","Cv","*","kg",".","y","+","zR","*","De",".","y",";","Di","=","kh","(","kg",")",";","}"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["Di","=","clamp","(","Di",",","_0_0",",","_1_0",")",";"]}]}]}]},{TYPE:"node",NAME:"MIX_RGB_VALUE",NODE_VARS:[{TYPE:"node_var",NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"Dj",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Dk",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Dl",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Dm",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["float","zR","=","clamp","(","Dj",",","_0_0",",","_1_0",")",";","float","Cv","=","_1_0","-","zR",";","vec3","kg",",","De",";","kg","=","kf","(","Dk",")",";","De","=","kf","(","Dl",")",";","kg",".","z","=","Cv","*","kg",".","z","+","zR","*","De",".","z",";","Dm","=","kh","(","kg",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["Dm","=","clamp","(","Dm",",","_0_0",",","_1_0",")",";"]}]}]}]},{TYPE:"node",NAME:"MIX_RGB_COLOR",NODE_VARS:[{TYPE:"node_var",NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"Dn",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Do",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Dp",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Dq",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["float","zR","=","clamp","(","Dn",",","_0_0",",","_1_0",")",";","vec3","kg",",","De",",","CV",";","Dq","=","Do",";","De","=","kf","(","Dp",")",";","if","(","De",".","y","!=","_0_0",")","{","kg","=","kf","(","Dq",")",";","kg",".","x","=","De",".","x",";","kg",".","y","=","De",".","y",";","CV","=","kh","(","kg",")",";","Dq","=","mix","(","Dq",",","CV",",","zR",")",";","}"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["Dq","=","clamp","(","Dq",",","_0_0",",","_1_0",")",";"]}]}]}]},{TYPE:"node",NAME:"MIX_RGB_SOFT_LIGHT",NODE_VARS:[{TYPE:"node_var",NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"Dr",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Ds",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Dt",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Du",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["float","zR","=","clamp","(","Dr",",","_0_0",",","_1_0",")",";","float","Cv","=","_1_0","-","zR",";","vec3","Dv","=","Dt","+","Ds","-","Dt","*","Ds",";","Du","=","Ds","*","(","vec3","(","Cv",")","+","vec3","(","zR",")","*","(","(","vec3","(","_1_0",")","-","Ds",")","*","Dt","+","Dv",")",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["Du","=","clamp","(","Du",",","_0_0",",","_1_0",")",";"]}]}]}]},{TYPE:"node",NAME:"MIX_RGB_LINEAR_LIGHT",NODE_VARS:[{TYPE:"node_var",NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"Dw",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Dx",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Dy",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Dz",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["float","zR","=","clamp","(","Dw",",","_0_0",",","_1_0",")",";","Dz","=","Dx","+","zR","*","(","2.0","*","Dy","-","vec3","(","_1_0",")",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["Dz","=","clamp","(","Dz",",","_0_0",",","_1_0",")",";"]}]}]}]},{TYPE:"node",NAME:"MIX_WORLD_RGB",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"DA",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"DB",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"DC",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"DD",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["float","zR","=","clamp","(","DA",",","_0_0",",","_1_0",")",";","DD","=","mix","(","DB",",","DC",",","zR",")",";"]}]},{TYPE:"node",NAME:"ADD_WORLD_RGB",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"DE",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"DF",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"DG",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"DH",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["float","zR","=","clamp","(","DE",",","_0_0",",","_1_0",")",";","DH","=","mix","(","DF",",","DF","+","DG",",","zR",")",";"]}]},{TYPE:"node",NAME:"OUTPUT",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"DI",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"DJ",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["E","=","DI",";","I","=","DJ",";"]}]},{TYPE:"node",NAME:"OUTPUT_SURFACE",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"DK",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"DL",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["E","=","DK",";","I","=","DL",";"]}]},{TYPE:"node",NAME:"OUTPUT_WORLD_SURFACE",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"DM",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["E","=","DM",";","I","=","_1_0",";"]}]},{TYPE:"node",NAME:"MATERIAL_BEGIN",NODE_VARS:[{TYPE:"node_var",NAME:"MATERIAL_EXT",TOKENS:["0"]},{TYPE:"node_var",NAME:"USE_MATERIAL_NORMAL",TOKENS:["0"]},{TYPE:"node_var",NAME:"USE_MATERIAL_DIFFUSE",TOKENS:["0"]},{TYPE:"node_var",NAME:"SHADELESS_MAT",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"DN",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"DO",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"DP",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"DQ",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_in",NAME:"DR",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"DS",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"DT",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"DU",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"DV",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"DW",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"DX",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"DY",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"DZ",QUALIFIER:["vec4"],IS_OPTIONAL:!1},{TYPE:"node_param",NAME:"sl",QUALIFIER:["const","vec2"],IS_OPTIONAL:!1},{TYPE:"node_param",NAME:"sm",QUALIFIER:["const","vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["DU","=","DN",";","DV","=","sm","[","0","]","*","DO",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_MATERIAL_NORMAL"],STATEMENTS:[{TYPE:"txt",TOKENS:["DW","=","normalize","(","DQ",")",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["DW","=","ot",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["SHADELESS_MAT",{TYPE:"logic_negative_expr",PLACES:1}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATERIAL_EXT"],STATEMENTS:[{TYPE:"txt",TOKENS:["DS","=","DR","*","DU",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["DS","=","sC","*","DU",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_MATERIAL_DIFFUSE"],STATEMENTS:[{TYPE:"txt",TOKENS:["DU","*=","DP",";"]}]}]},{TYPE:"txt",TOKENS:["DT","=","sD","*","u_environment_energy","*","cz","(","DW",")",";","DZ","=","cC","(","DU",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["NUM_LIGHTS",0,{TYPE:"g_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:["DX","=","vec2","(","sl","[","0","]",",","sl","[","1","]",")",";","DY","=","vec2","(","sm","[","1","]",",","sm","[","2","]",")",";"]}]}]},{TYPE:"txt",TOKENS:["H","=","DZ",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["DS","=","vec3","(","_0_0",")",";","DT","=","vec3","(","_1_0",")",";"]}]}]}]},{TYPE:"node",NAME:"MATERIAL_END",NODE_VARS:[{TYPE:"node_var",NAME:"MATERIAL_EXT",TOKENS:["0"]},{TYPE:"node_var",NAME:"USE_MATERIAL_DIFFUSE",TOKENS:["0"]},{TYPE:"node_var",NAME:"USE_MATERIAL_SPECULAR",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"D_",QUALIFIER:["vec4"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Ea",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Eb",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Ec",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_in",NAME:"Ed",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_in",NAME:"Ee",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"Ef",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"Eg",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"Eh",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"Ei",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"Ej",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_param",NAME:"sn",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_param",NAME:"so",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Ef"],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_MATERIAL_DIFFUSE"],STATEMENTS:[{TYPE:"txt",TOKENS:["Ef","=","D_",".","rgb",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["Ef","=","vec3","(","_0_0",")",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATERIAL_EXT","REFLECTION_TYPE","REFL_NONE",{TYPE:"non_equal_expr",PLACES:2},{TYPE:"logical_and_expr",PLACES:2}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:["cL","(","Ef",",","ou",",","Eb",",","Ec",",","u_view_tsr_frag",")",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["cL","(","Ef",",","ou",",","Eb",",","Ec",",","mat3","(","_0_0",")",")",";"]}]}]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_MATERIAL_SPECULAR"],STATEMENTS:[{TYPE:"txt",TOKENS:["Ef","+=","Ea",";"]}]}]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Eh"],STATEMENTS:[{TYPE:"txt",TOKENS:["Eh","=","Eb",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATERIAL_EXT"],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Ei"],STATEMENTS:[{TYPE:"txt",TOKENS:["Ei","=","D_",".","rgb",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Ej"],STATEMENTS:[{TYPE:"txt",TOKENS:["Ej","=","Ea",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Eg"],STATEMENTS:[{TYPE:"txt",TOKENS:["Eg","=","clamp","(","Ee",",","_0_0",",","_1_0",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_MATERIAL_SPECULAR"],STATEMENTS:[{TYPE:"txt",TOKENS:["float","t","=","max","(","max","(","Ea",".","r",",","Ea",".","g",")",",","Ea",".","b",")","*","Ed",";","Eg","=","clamp","(","Ee","*","(","_1_0","-","t",")","+","t",",","_0_0",",","_1_0",")",";"]}]}]}]}]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Eg"],STATEMENTS:[{TYPE:"txt",TOKENS:["Eg","=","clamp","(","sn",",","_0_0",",","_1_0",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_MATERIAL_SPECULAR"],STATEMENTS:[{TYPE:"txt",TOKENS:["float","t","=","max","(","max","(","Ea",".","r",",","Ea",".","g",")",",","Ea",".","b",")","*","so",";","Eg","=","sn","*","(","_1_0","-","t",")","+","t",";"]}]}]}]}]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_MATERIAL_SPECULAR"],STATEMENTS:[{TYPE:"txt",TOKENS:["F","=","Ea",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["F","=","vec3","(","_0_0",")",";"]}]}]},{TYPE:"txt",TOKENS:["G","=","Eb",";"]}]},{TYPE:"node",NAME:"LIGHTING_AMBIENT",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"oL",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"oM",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"oN",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"oO",QUALIFIER:["vec4"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"oP",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["oO","=","vec4","(","oL","+","oN","*","oM",",","_0_0",")",";","oP","=","vec3","(","_0_0",")",";"]}]},{TYPE:"node",NAME:"LIGHTING_LAMP",NODE_VARS:[{TYPE:"node_var",NAME:"LAMP_TYPE",TOKENS:["HEMI"]},{TYPE:"node_var",NAME:"LAMP_IND",TOKENS:["0"]},{TYPE:"node_var",NAME:"LAMP_SPOT_SIZE",TOKENS:["0.8"]},{TYPE:"node_var",NAME:"LAMP_SPOT_BLEND",TOKENS:["0.03"]},{TYPE:"node_var",NAME:"LAMP_LIGHT_DIST",TOKENS:["30.0"]},{TYPE:"node_var",NAME:"LAMP_SHADOW_MAP_IND",TOKENS:["-","1"]},{TYPE:"node_var",NAME:"LAMP_USE_SPHERE",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"oQ",QUALIFIER:["vec4"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"oR",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"oS",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"oT",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"oU",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["oS","=","vec2","(","u_light_positions","[","LAMP_IND","]",".","w",",","u_light_color_intensities","[","LAMP_IND","]",".","w",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["LAMP_TYPE","HEMI",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:["oU","=","_0_5",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["oU","=","_0_0",";"]}]}]},{TYPE:"txt",TOKENS:["oT","=","u_light_color_intensities","[","LAMP_IND","]",".","xyz",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["LAMP_SHADOW_MAP_IND",1,{TYPE:"negative_expr",PLACES:1},{TYPE:"non_equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:["oT","*=","oQ","[","LAMP_SHADOW_MAP_IND","]",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["LAMP_TYPE","SPOT",{TYPE:"equal_expr",PLACES:2},"LAMP_TYPE","POINT",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:["vec3","oV","=","u_light_positions","[","LAMP_IND","]",".","xyz",";","oR","=","oV","-","os",";","float","aM","=","length","(","oR",")",";","oT","*=","LAMP_LIGHT_DIST","/","(","LAMP_LIGHT_DIST","+","aM","*","aM",")",";","oR","=","normalize","(","oR",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["LAMP_TYPE","SPOT",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:["vec3","oX","=","u_light_directions","[","LAMP_IND","]",";","float","oY","=","dot","(","oR",",","oX",")",";","oY","*=","smoothstep","(","_0_0",",","_1_0",",","(","oY","-","LAMP_SPOT_SIZE",")","/","LAMP_SPOT_BLEND",")",";","oT","*=","oY",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["LAMP_USE_SPHERE"],STATEMENTS:[{TYPE:"txt",TOKENS:["oT","*=","max","(","LAMP_LIGHT_DIST","-","aM",",","_0_0",")","/","LAMP_LIGHT_DIST",";"]}]}]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["oR","=","u_light_directions","[","LAMP_IND","]",";"]}]}]}]},{TYPE:"node",NAME:"DIFFUSE_FRESNEL",NODE_VARS:[{TYPE:"node_var",NAME:"MAT_USE_TBN_SHADING",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"oZ",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"o_",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pa",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pb",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pc",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"pd",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["vec3","r_","=","pa",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAT_USE_TBN_SHADING"],STATEMENTS:[{TYPE:"txt",TOKENS:["vec3","pe","=","cross","(","oZ",",","B",".","xyz",")",";","r_","=","cross","(","pe",",","B",".","xyz",")",";","r_","=","-","normalize","(","r_",")",";"]}]}]},{TYPE:"txt",TOKENS:["pd","=","_0_0",";","if","(","o_",".","r","!=","_0_0",")","{","float","pf","=","(","_1_0","-","pb",")","*","dot","(","r_",",","oZ",")","+","pb",";","if","(","pc","[","0","]","==","_0_0",")","{","pd","=","_1_0",";","}","else","{","float","t","=","_1_0","+","abs","(","pf",")",";","t","=","pc","[","1","]","+","(","_1_0","-","pc","[","1","]",")","*","pow","(","t",",","pc","[","0","]",")",";","pd","=","clamp","(","t",",","_0_0",",","_1_0",")",";","}","pd","=","max","(","pd",",","_0_0",")",";","}"]}]},{TYPE:"node",NAME:"DIFFUSE_LAMBERT",NODE_VARS:[{TYPE:"node_var",NAME:"MAT_USE_TBN_SHADING",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"pg",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"ph",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pi",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pj",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"pk",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["vec3","r_","=","pi",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAT_USE_TBN_SHADING"],STATEMENTS:[{TYPE:"txt",TOKENS:["vec3","pe","=","cross","(","pg",",","B",".","xyz",")",";","r_","=","cross","(","pe",",","B",".","xyz",")",";","r_","=","-","normalize","(","r_",")",";"]}]}]},{TYPE:"txt",TOKENS:["pk","=","_0_0",";","if","(","ph",".","r","!=","_0_0",")","{","float","pf","=","(","_1_0","-","pj",")","*","dot","(","r_",",","pg",")","+","pj",";","pk","=","max","(","pf",",","_0_0",")",";","}"]}]},{TYPE:"node",NAME:"DIFFUSE_OREN_NAYAR",NODE_VARS:[{TYPE:"node_var",NAME:"MAT_USE_TBN_SHADING",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"pl",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pm",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pn",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"po",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pr",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"pu",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["vec3","r_","=","pn",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAT_USE_TBN_SHADING"],STATEMENTS:[{TYPE:"txt",TOKENS:["vec3","pe","=","cross","(","pl",",","B",".","xyz",")",";","r_","=","cross","(","pe",",","B",".","xyz",")",";","r_","=","-","normalize","(","r_",")",";"]}]}]},{TYPE:"txt",TOKENS:["pu","=","_0_0",";","if","(","pm",".","r","!=","_0_0",")","{","float","pf","=","(","_1_0","-","po",")","*","dot","(","r_",",","pl",")","+","po",";","if","(","pr","[","0","]",">","_0_0",")","{","float","pv","=","max","(","dot","(","r_",",","ou",")",",","_0_0",")",";","float","pw","=","pr","[","0","]","*","pr","[","0","]",";","float","cB","=","_1_0","-","_0_5","*","(","pw","/","(","pw","+","0.33",")",")",";","vec3","px","=","pl","-","pf","*","r_",";","vec3","py","=","ou","-","pv","*","r_",";","if","(","length","(","px",")","==","_0_0","||","length","(","py",")","==","_0_0","||","abs","(","pf",")",">","_1_0","||","abs","(","pv",")",">","_1_0",")","pu","=","pf","*","cB",";","else","{","float","pz","=","acos","(","pf",")",";","float","pA","=","acos","(","pv",")",";","vec3","pB","=","normalize","(","px",")",";","vec3","pC","=","normalize","(","py",")",";","float","a",",","b",";","a","=","max","(","pz",",","pA",")",";","b","=","min","(","pz",",","pA",")",";","b","*=","0.95",";","float","t","=","max","(","dot","(","pB",",","pC",")",",","_0_0",")",";","float","hO","=","0.45","*","(","pw","/","(","pw","+","0.09",")",")",";","pu","=","pf","*","(","cB","+","(","hO","*","t","*","sin","(","a",")","*","tan","(","b",")",")",")",";","}","}","else","pu","=","pf",";","pu","=","max","(","pu",",","_0_0",")",";","}"]}]},{TYPE:"node",NAME:"DIFFUSE_MINNAERT",NODE_VARS:[{TYPE:"node_var",NAME:"MAT_USE_TBN_SHADING",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"pD",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pE",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pF",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pG",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pH",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"pI",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["vec3","r_","=","pF",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAT_USE_TBN_SHADING"],STATEMENTS:[{TYPE:"txt",TOKENS:["vec3","pe","=","cross","(","pD",",","B",".","xyz",")",";","r_","=","cross","(","pe",",","B",".","xyz",")",";","r_","=","-","normalize","(","r_",")",";"]}]}]},{TYPE:"txt",TOKENS:["pI","=","_0_0",";","if","(","pE",".","r","!=","_0_0",")","{","float","pf","=","(","_1_0","-","pG",")","*","dot","(","r_",",","pD",")","+","pG",";","float","pv","=","max","(","dot","(","r_",",","ou",")",",","_0_0",")",";","if","(","pH","[","0","]","<=","_1_0",")","pI","=","pf","*","pow","(","max","(","pv","*","pf",",","0.1",")",",","pH","[","0","]","-","_1_0",")",";","else","pI","=","pf","*","pow","(","1.0001","-","pv",",","pH","[","0","]","-","_1_0",")",";","pI","=","max","(","pI",",","_0_0",")",";","}"]}]},{TYPE:"node",NAME:"DIFFUSE_TOON",NODE_VARS:[{TYPE:"node_var",NAME:"MAT_USE_TBN_SHADING",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"pJ",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pK",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pL",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pM",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pN",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"pO",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["vec3","r_","=","pL",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAT_USE_TBN_SHADING"],STATEMENTS:[{TYPE:"txt",TOKENS:["vec3","pe","=","cross","(","pJ",",","B",".","xyz",")",";","r_","=","cross","(","pe",",","B",".","xyz",")",";","r_","=","-","normalize","(","r_",")",";"]}]}]},{TYPE:"txt",TOKENS:["pO","=","_0_0",";","if","(","pK",".","r","!=","_0_0",")","{","float","pf","=","(","_1_0","-","pM",")","*","dot","(","r_",",","pJ",")","+","pM",";","float","pP","=","acos","(","pf",")",";","if","(","pP","<","pN","[","0","]",")","pO","=","_1_0",";","else","if","(","pP",">","(","pN","[","0","]","+","pN","[","1","]",")","||","pN","[","1","]","==","_0_0",")","pO","=","_0_0",";","else","pO","=","_1_0","-","(","(","pP","-","pN","[","0","]",")","/","pN","[","1","]",")",";","pO","=","max","(","pO",",","_0_0",")",";","}"]}]},{TYPE:"node",NAME:"SPECULAR_PHONG",NODE_VARS:[{TYPE:"node_var",NAME:"MAT_USE_TBN_SHADING",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"pQ",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pR",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pS",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pT",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pU",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"pV",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["pV","=","_0_0",";","if","(","pR",".","g","==","_1_0",")","{","vec3","pW","=","normalize","(","pQ","+","ou",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAT_USE_TBN_SHADING"],STATEMENTS:[{TYPE:"txt",TOKENS:["if","(","pT","==","_0_0",")","{","pV","=","dot","(","B",".","xyz",",","pW",")",";","pV","=","sqrt","(","_1_0","-","pV","*","pV",")",";","}"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["pV","=","(","_1_0","-","pT",")","*","max","(","dot","(","pS",",","pW",")",",","_0_0",")","+","pT",";"]}]}]},{TYPE:"txt",TOKENS:["pV","=","pow","(","pV",",","pU","[","0","]",")",";","}"]}]},{TYPE:"node",NAME:"SPECULAR_COOKTORR",NODE_VARS:[{TYPE:"node_var",NAME:"MAT_USE_TBN_SHADING",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"pX",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pY",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pZ",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"p_",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qa",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"qb",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["qb","=","_0_0",";","if","(","pY",".","g","!=","_0_0",")","{","vec3","pW","=","normalize","(","pX","+","ou",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAT_USE_TBN_SHADING"],STATEMENTS:[{TYPE:"txt",TOKENS:["if","(","p_","==","_0_0",")","{","qb","=","dot","(","B",".","xyz",",","pW",")",";","qb","=","sqrt","(","_1_0","-","qb","*","qb",")",";","}"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["qb","=","max","(","dot","(","pZ",",","pW",")",",","_0_0",")",";","qb","=","(","_1_0","-","p_",")","*","qb","+","p_",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAT_USE_TBN_SHADING"],STATEMENTS:[{TYPE:"txt",TOKENS:["float","pv","=","max","(","dot","(","B",".","xyz",",","ou",")",",","_0_0",")",";","pv","=","sqrt","(","_1_0","-","pv","*","pv",")",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["float","pv","=","max","(","dot","(","pZ",",","ou",")",",","_0_0",")",";"]}]}]},{TYPE:"txt",TOKENS:["qb","=","pow","(","qb",",","qa","[","0","]",")",";","qb","=","qb","/","(","0.1","+","pv",")",";","}"]}]},{TYPE:"node",NAME:"SPECULAR_WARDISO",NODE_VARS:[{TYPE:"node_var",NAME:"MAT_USE_TBN_SHADING",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"qc",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qd",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qe",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qf",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qg",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"qh",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["qh","=","_0_0",";","if","(","qd",".","g","==","_1_0",")","{","vec3","pW","=","normalize","(","qc","+","ou",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAT_USE_TBN_SHADING"],STATEMENTS:[{TYPE:"txt",TOKENS:["float","qi","=","_0_0",";","float","pv","=","_0_0",";","float","qj","=","_0_0",";","if","(","qf","==","_0_0",")","{","qi","=","dot","(","B",".","xyz",",","pW",")",";","pv","=","dot","(","B",".","xyz",",","ou",")",";","qj","=","dot","(","B",".","xyz",",","qc",")",";","qi","=","sqrt","(","_1_0","-","qi","*","qi",")",";","pv","=","sqrt","(","_1_0","-","pv","*","pv",")",";","qj","=","sqrt","(","_1_0","-","qj","*","qj",")",";","}"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["float","qi","=","max","(","dot","(","qe",",","pW",")",",","0.01",")",";","float","pv","=","max","(","dot","(","qe",",","ou",")",",","0.01",")",";","float","qj","=","max","(","dot","(","qe",",","qc",")",",","0.01",")",";"]}]}]},{TYPE:"txt",TOKENS:["float","bK","=","tan","(","acos","(","qi",")",")",";","float","L","=","max","(","qg","[","0","]",",","0.01",")",";","qh","=","qj","*","(","_1_0","/","(","4.0","*","M_PI","*","L","*","L",")",")","*","(","exp","(","-","(","bK","*","bK",")","/","(","L","*","L",")",")","/","(","sqrt","(","pv","*","qj",")",")",")",";","}"]}]},{TYPE:"node",NAME:"SPECULAR_TOON",NODE_VARS:[{TYPE:"node_var",NAME:"MAT_USE_TBN_SHADING",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"qk",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"ql",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qm",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qn",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qo",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"qr",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["qr","=","_0_0",";","if","(","ql",".","g","==","_1_0",")","{","vec3","cj","=","normalize","(","qk","+","ou",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAT_USE_TBN_SHADING"],STATEMENTS:[{TYPE:"txt",TOKENS:["float","qu","=","dot","(","cj",",","B",".","xyz",")",";","float","bK","=","qo","[","0","]","+","qo","[","1","]",";","if","(","qn","==","_0_0",")","bK","=","acos","(","sqrt","(","_1_0","-","qu","*","qu",")",")",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["float","bK","=","acos","(","dot","(","cj",",","qm",")",")",";"]}]}]},{TYPE:"txt",TOKENS:["if","(","bK","<","qo","[","0","]",")","qr","=","_1_0",";","else","if","(","bK",">=","qo","[","0","]","+","qo","[","1","]","||","qo","[","1","]","==","_0_0",")","qr","=","_0_0",";","else","qr","=","_1_0","-","(","bK","-","qo","[","0","]",")","/","qo","[","1","]",";","}"]}]},{TYPE:"node",NAME:"SPECULAR_BLINN",NODE_VARS:[{TYPE:"node_var",NAME:"MAT_USE_TBN_SHADING",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"qv",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qw",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qx",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qy",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qz",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"qA",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["float","qB","=","qz","[","0","]",";","float","qC","=","qz","[","1","]",";","qA","=","_0_0",";","if","(","qw",".","g","==","_1_0",")","{","if","(","qB","<","_1_0","||","qC","==","_0_0",")","qA","=","_0_0",";","else","{","if","(","qC","<","100.0",")","qC","=","sqrt","(","_1_0","/","qC",")",";","else","qC","=","10.0","/","qC",";","vec3","pW","=","normalize","(","ou","+","qv",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAT_USE_TBN_SHADING"],STATEMENTS:[{TYPE:"txt",TOKENS:["float","qi","=","_0_0",";","if","(","qy","==","_0_0",")","{","float","qD","=","dot","(","B",".","xyz",",","pW",")",";","qi","=","sqrt","(","_1_0","-","qD","*","qD",")",";","}"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["float","qi","=","(","_1_0","-","qy",")","*","max","(","dot","(","qx",",","pW",")",",","_0_0",")","+","qy",";"]}]}]},{TYPE:"txt",TOKENS:["if","(","qi","<","_0_0",")","qA","=","_0_0",";","else","{","float","pv","=","max","(","dot","(","qx",",","ou",")",",","0.01",")",";","float","qj","=","dot","(","qx",",","qv",")",";","if","(","qj","<=","0.01",")","qA","=","_0_0",";","else","{","float","qE","=","max","(","dot","(","ou",",","pW",")",",","0.01",")",";","float","a","=","_1_0",";","float","b","=","(","2.0","*","qi","*","pv",")","/","qE",";","float","du","=","(","2.0","*","qi","*","qj",")","/","qE",";","float","g","=","min","(","min","(","a",",","b",")",",","du",")",";","float","p","=","sqrt","(","pow","(","qB",",","2.0",")","+","pow","(","qE",",","2.0",")","-","_1_0",")",";","float","mi","=","pow","(","p","-","qE",",","2.0",")","/","pow","(","p","+","qE",",","2.0",")","*","(","_1_0","+","pow","(","qE","*","(","p","+","qE",")","-","_1_0",",","2.0",")","/","pow","(","qE","*","(","p","-","qE",")","+","_1_0",",","2.0",")",")",";","float","pP","=","acos","(","qi",")",";","qA","=","max","(","mi","*","g","*","exp","(","-","pow","(","pP",",","2.0",")","/","(","2.0","*","pow","(","qC",",","2.0",")",")",")",",","_0_0",")",";","}","}","}","}"]}]},{TYPE:"node",NAME:"LIGHTING_APPLY",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"qF",QUALIFIER:["vec4"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qG",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qH",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qI",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qJ",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qK",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qL",QUALIFIER:["vec4"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qM",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qN",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qO",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qP",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"qQ",QUALIFIER:["vec4"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"qR",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_NODE_B4W_TRANSLUCENCY"],STATEMENTS:[{TYPE:"txt",TOKENS:["if","(","dot","(","qJ",",","qK",")","*","dot","(","ou",",","qK",")","<","_0_0",")","{","float","Ek","=","qL",".","x",";","float","El","=","qL",".","y",";","float","Em","=","qL",".","z",";","float","En","=","qL",".","w",";","float","Eo","=","clamp","(","abs","(","dot","(","qJ",",","qK",")",")",",","_0_0",",","_1_0",")",";","float","Ep","=","clamp","(","dot","(","ou",",","-","qJ",")",",","_0_0",",","_1_0",")",";","float","Eq","=","pow","(","Ep",",","El",")",";","qQ","=","qF","+","qP","*","vec4","(","qO","*","Eo","*","pow","(","qM",",","vec3","(","Ek",")",")",",","_1_0",")",";","qQ","+=","Em","*","mix","(","vec4","(","qM",",","_1_0",")",",","vec4","(","_1_0",")",",","En",")","*","qP","*","vec4","(","qO","*","Eo","*","vec3","(","Eq",")",",","_1_0",")",";","}","else","{","qQ","=","qF","+","vec4","(","qO","*","qM","*","qH",",","qI",")",";","}"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["qQ","=","qF","+","vec4","(","qO","*","qM","*","qH",",","qI",")",";"]}]}]},{TYPE:"txt",TOKENS:["qR","=","qG","+","qO","*","qN","*","qI",";"]}]},{TYPE:"node",NAME:"RGB",NODE_VARS:[{TYPE:"node_var",NAME:"RGB_IND",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_out",NAME:"Er",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["Er","=","u_node_rgbs","[","RGB_IND","]",";"]}]},{TYPE:"node",NAME:"RGBTOBW",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"Es",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Et",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["Et","=","dot","(","Es",",","vec3","(","0.35",",","0.45",",","0.2",")",")",";"]}]},{TYPE:"node",NAME:"SEPRGB",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"Eu",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Ev",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"Ew",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"Ex",QUALIFIER:["float"],IS_OPTIONAL:!0}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Ev"],STATEMENTS:[{TYPE:"txt",TOKENS:["Ev","=","Eu",".","r",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Ew"],STATEMENTS:[{TYPE:"txt",TOKENS:["Ew","=","Eu",".","g",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Ex"],STATEMENTS:[{TYPE:"txt",TOKENS:["Ex","=","Eu",".","b",";"]}]}]}]},{TYPE:"node",NAME:"SEPHSV",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"Ey",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Ez",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"EA",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"EB",QUALIFIER:["float"],IS_OPTIONAL:!0}],STATEMENTS:[{TYPE:"txt",TOKENS:["vec3","EC","=","kf","(","Ey",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Ez"],STATEMENTS:[{TYPE:"txt",TOKENS:["Ez","=","EC",".","r",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_EA"],STATEMENTS:[{TYPE:"txt",TOKENS:["EA","=","EC",".","g",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_EB"],STATEMENTS:[{TYPE:"txt",TOKENS:["EB","=","EC",".","b",";"]}]}]}]},{TYPE:"node",NAME:"SQUEEZE",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"ED",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"EE",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"EF",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"EG",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["EG","=","_1_0","/","(","_1_0","+","pow","(","2.71828183",",","-","(","ED","-","EF",")","*","EE",")",")",";"]}]},{TYPE:"node",NAME:"GAMMA",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"EH",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"EI",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"EJ",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["EJ","=","EH",";","if","(","EJ",".","x",">","_0_0",")","EJ",".","x","=","pow","(","EH",".","x",",","EI",")",";","if","(","EJ",".","y",">","_0_0",")","EJ",".","y","=","pow","(","EH",".","y",",","EI",")",";","if","(","EJ",".","z",">","_0_0",")","EJ",".","z","=","pow","(","EH",".","z",",","EI",")",";"]}]},{TYPE:"node",NAME:"B4W_SRGB_TO_LINEAR",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"EK",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"EL",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["EL","=","max","(","vec3","(","_0_0",")",",","EK",")",";","EL","=","pow","(","EL",",","vec3","(","2.2",")",")",";"]}]},{TYPE:"node",NAME:"B4W_LINEAR_TO_SRGB",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"EM",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"EN",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["EN","=","max","(","vec3","(","_0_0",")",",","EM",")",";","EN","=","pow","(","EN",",","vec3","(","_1_0","/","2.2",")",")",";"]}]},{TYPE:"node",NAME:"TEXTURE_EMPTY",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"EO",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"EP",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"EQ",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_EO"],STATEMENTS:[{TYPE:"txt",TOKENS:["EO","=","vec3","(","_0_0",")",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_EP"],STATEMENTS:[{TYPE:"txt",TOKENS:["EP","=","vec3","(","_0_0",")",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_EQ"],STATEMENTS:[{TYPE:"txt",TOKENS:["EQ","=","_0_0",";"]}]}]}]},{TYPE:"node",NAME:"TEXTURE_ENVIRONMENT_CUBE",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"ER",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"ES",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"ET",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_param",NAME:"node_TEXTURE_ENVIRONMENT_CUBE_var_texture",QUALIFIER:["uniform","samplerCube"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["vec3","EU","=","vec3","(","ER",".","x",",","ER",".","y",",","ER",".","z",")",";","vec4","AV","=","GLSL_TEXTURE_CUBE","(","node_TEXTURE_ENVIRONMENT_CUBE_var_texture",",","EU",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_ES"],STATEMENTS:[{TYPE:"txt",TOKENS:["ES","=","AV",".","xyz",";","bC","(","ES",")",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_ET"],STATEMENTS:[{TYPE:"txt",TOKENS:["ET","=","AV",".","w",";"]}]}]}]},{TYPE:"node",NAME:"TEXTURE_ENVIRONMENT_EQUIRECTANGULAR",NODE_VARS:[{TYPE:"node_var",NAME:"USE_VECTOR_IN",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"EV",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"EW",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_param",NAME:"node_TEXTURE_ENVIRONMENT_EQUIRECTANGULAR_var_texture",QUALIFIER:["uniform","sampler2D"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_VECTOR_IN"],STATEMENTS:[{TYPE:"txt",TOKENS:["vec3","EX","=","normalize","(","EV",")",";"]}]},{TYPE:"node_elif",EXPRESSION:["IS_WORLD"],STATEMENTS:[{TYPE:"txt",TOKENS:["vec3","EX","=","sr",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["vec3","EX","=","ot",";"]}]}]},{TYPE:"txt",TOKENS:["float","dC","=","-","atan","(","EX",".","y",",","EX",".","x",")","/","(","2.0","*","M_PI",")","+","_0_5",";","float","kQ","=","atan","(","EX",".","z",",","sqrt","(","EX",".","x","*","EX",".","x","+","EX",".","y","*","EX",".","y",")",")","/","M_PI","+","_0_5",";","vec4","AV","=","GLSL_TEXTURE","(","node_TEXTURE_ENVIRONMENT_EQUIRECTANGULAR_var_texture",",","vec2","(","dC",",","kQ",")",")",";","EW","=","AV",".","xyz",";","bC","(","EW",")",";"]}]},{TYPE:"node",NAME:"TEXTURE_ENVIRONMENT_MIRROR_BALL",NODE_VARS:[{TYPE:"node_var",NAME:"USE_VECTOR_IN",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"EY",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"EZ",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_param",NAME:"node_TEXTURE_ENVIRONMENT_MIRROR_BALL_var_texture",QUALIFIER:["uniform","sampler2D"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_VECTOR_IN"],STATEMENTS:[{TYPE:"txt",TOKENS:["vec3","EX","=","normalize","(","EY",")",";"]}]},{TYPE:"node_elif",EXPRESSION:["IS_WORLD"],STATEMENTS:[{TYPE:"txt",TOKENS:["vec3","EX","=","sr",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["vec3","EX","=","ot",";"]}]}]},{TYPE:"txt",TOKENS:["EX",".","y","-=","_1_0",";","float","E_","=","2.0","*","sqrt","(","max","(","-","_0_5","*","EX",".","y",",","_0_0",")",")",";","if","(","E_",">","_0_0",")","EX","/=","E_",";","float","dC","=","_0_5","*","(","EX",".","x","+","_1_0",")",";","float","kQ","=","_0_5","*","(","EX",".","z","+","_1_0",")",";","vec4","AV","=","GLSL_TEXTURE","(","node_TEXTURE_ENVIRONMENT_MIRROR_BALL_var_texture",",","vec2","(","dC",",","kQ",")",")",";","EZ","=","AV",".","xyz",";","bC","(","EZ",")",";"]}]},{TYPE:"node",NAME:"TEXTURE_COLOR",NODE_VARS:[{TYPE:"node_var",NAME:"NON_COLOR",TOKENS:["0"]},{TYPE:"node_var",NAME:"CONVERT_UV",TOKENS:["0"]},{TYPE:"node_var",NAME:"USE_uv2",TOKENS:["0"]},{TYPE:"node_var",NAME:"USE_uv3",TOKENS:["0"]},{TYPE:"node_var",NAME:"USE_uv4",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"Fa",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_in",NAME:"Fb",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_in",NAME:"Fc",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_in",NAME:"Fd",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"Fe",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"Ff",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"Fg",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"Fh",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"Fi",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"Fj",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"Fk",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"Fl",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_param",NAME:"node_TEXTURE_COLOR_var_texture",QUALIFIER:["uniform","sampler2D"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["CONVERT_UV"],STATEMENTS:[{TYPE:"txt",TOKENS:["vec4","AV","=","GLSL_TEXTURE","(","node_TEXTURE_COLOR_var_texture",",","rY","(","Fa",")",")",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["vec4","AV","=","GLSL_TEXTURE","(","node_TEXTURE_COLOR_var_texture",",","Fa",".","xy",")",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Fe"],STATEMENTS:[{TYPE:"txt",TOKENS:["Fe","=","AV",".","xyz",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["NON_COLOR",{TYPE:"logic_negative_expr",PLACES:1}],STATEMENTS:[{TYPE:"txt",TOKENS:["bC","(","Fe",")",";"]}]}]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Ff"],STATEMENTS:[{TYPE:"txt",TOKENS:["Ff","=","AV",".","w",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_uv2"],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["CONVERT_UV"],STATEMENTS:[{TYPE:"txt",TOKENS:["AV","=","GLSL_TEXTURE","(","node_TEXTURE_COLOR_var_texture",",","rY","(","Fb",")",")",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["AV","=","GLSL_TEXTURE","(","node_TEXTURE_COLOR_var_texture",",","Fb",".","xy",")",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Fg"],STATEMENTS:[{TYPE:"txt",TOKENS:["Fg","=","AV",".","xyz",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["NON_COLOR",{TYPE:"logic_negative_expr",PLACES:1}],STATEMENTS:[{TYPE:"txt",TOKENS:["bC","(","Fg",")",";"]}]}]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Fh"],STATEMENTS:[{TYPE:"txt",TOKENS:["Fh","=","AV",".","w",";"]}]}]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_uv3"],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["CONVERT_UV"],STATEMENTS:[{TYPE:"txt",TOKENS:["AV","=","GLSL_TEXTURE","(","node_TEXTURE_COLOR_var_texture",",","rY","(","Fc",")",")",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["AV","=","GLSL_TEXTURE","(","node_TEXTURE_COLOR_var_texture",",","Fc",".","xy",")",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Fi"],STATEMENTS:[{TYPE:"txt",TOKENS:["Fi","=","AV",".","xyz",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["NON_COLOR",{TYPE:"logic_negative_expr",PLACES:1}],STATEMENTS:[{TYPE:"txt",TOKENS:["bC","(","Fi",")",";"]}]}]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Fj"],STATEMENTS:[{TYPE:"txt",TOKENS:["Fj","=","AV",".","w",";"]}]}]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_uv4"],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["CONVERT_UV"],STATEMENTS:[{TYPE:"txt",TOKENS:["AV","=","GLSL_TEXTURE","(","node_TEXTURE_COLOR_var_texture",",","rY","(","Fd",")",")",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["AV","=","GLSL_TEXTURE","(","node_TEXTURE_COLOR_var_texture",",","Fd",".","xy",")",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Fk"],STATEMENTS:[{TYPE:"txt",TOKENS:["Fk","=","AV",".","xyz",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["NON_COLOR",{TYPE:"logic_negative_expr",PLACES:1}],STATEMENTS:[{TYPE:"txt",TOKENS:["bC","(","Fk",")",";"]}]}]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Fl"],STATEMENTS:[{TYPE:"txt",TOKENS:["Fl","=","AV",".","w",";"]}]}]}]}]}]},{TYPE:"node",NAME:"TEXTURE_NORMAL",NODE_VARS:[{TYPE:"node_var",NAME:"USE_uv2",TOKENS:["0"]},{TYPE:"node_var",NAME:"USE_uv3",TOKENS:["0"]},{TYPE:"node_var",NAME:"USE_uv4",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"Fm",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_in",NAME:"Fn",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_in",NAME:"Fo",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_in",NAME:"Fp",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"Fq",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"Fr",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"Fs",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"Ft",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"Fu",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"Fv",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"Fw",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"Fx",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_param",NAME:"node_TEXTURE_NORMAL_var_texture",QUALIFIER:["uniform","sampler2D"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["vec4","AV","=","GLSL_TEXTURE","(","node_TEXTURE_NORMAL_var_texture",",","rY","(","Fm",")",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Fq"],STATEMENTS:[{TYPE:"txt",TOKENS:["Fq","=","normalize","(","sy","*","(","AV",".","xyz","-","_0_5",")",")",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Fr"],STATEMENTS:[{TYPE:"txt",TOKENS:["Fr","=","AV",".","w",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_uv2"],STATEMENTS:[{TYPE:"txt",TOKENS:["AV","=","GLSL_TEXTURE","(","node_TEXTURE_NORMAL_var_texture",",","rY","(","Fn",")",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Fs"],STATEMENTS:[{TYPE:"txt",TOKENS:["Fs","=","normalize","(","sy","*","(","AV",".","xyz","-","_0_5",")",")",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Ft"],STATEMENTS:[{TYPE:"txt",TOKENS:["Ft","=","AV",".","w",";"]}]}]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_uv3"],STATEMENTS:[{TYPE:"txt",TOKENS:["AV","=","GLSL_TEXTURE","(","node_TEXTURE_NORMAL_var_texture",",","rY","(","Fo",")",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Fu"],STATEMENTS:[{TYPE:"txt",TOKENS:["Fu","=","normalize","(","sy","*","(","AV",".","xyz","-","_0_5",")",")",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Fv"],STATEMENTS:[{TYPE:"txt",TOKENS:["Fv","=","AV",".","w",";"]}]}]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_uv4"],STATEMENTS:[{TYPE:"txt",TOKENS:["AV","=","GLSL_TEXTURE","(","node_TEXTURE_NORMAL_var_texture",",","rY","(","Fp",")",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Fw"],STATEMENTS:[{TYPE:"txt",TOKENS:["Fw","=","normalize","(","sy","*","(","AV",".","xyz","-","_0_5",")",")",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Fx"],STATEMENTS:[{TYPE:"txt",TOKENS:["Fx","=","AV",".","w",";"]}]}]}]}]}]},{TYPE:"node",NAME:"VALUE",NODE_VARS:[{TYPE:"node_var",NAME:"VALUE_ROW_IND",TOKENS:["0"]},{TYPE:"node_var",NAME:"VALUE_COL_IND",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_out",NAME:"Fy",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["Fy","=","u_node_values","[","VALUE_ROW_IND","]","[","VALUE_COL_IND","]",";"]}]},{TYPE:"node",NAME:"VECT_MATH_ADD",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"Fz",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"FA",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"FB",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"FC",QUALIFIER:["float"],IS_OPTIONAL:!0}],STATEMENTS:[{TYPE:"txt",TOKENS:["FB","=","Fz","+","FA",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_FC"],STATEMENTS:[{TYPE:"txt",TOKENS:["FC","=","(","abs","(","FB","[","0","]",")","+","abs","(","FB","[","1","]",")","+","abs","(","FB","[","2","]",")",")","/","3.0",";"]}]}]}]},{TYPE:"node",NAME:"VECT_MATH_SUBTRACT",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"FD",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"FE",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"FF",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"FG",QUALIFIER:["float"],IS_OPTIONAL:!0}],STATEMENTS:[{TYPE:"txt",TOKENS:["FF","=","FD","-","FE",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_FG"],STATEMENTS:[{TYPE:"txt",TOKENS:["FG","=","(","abs","(","FF","[","0","]",")","+","abs","(","FF","[","1","]",")","+","abs","(","FF","[","2","]",")",")","/","3.0",";"]}]}]}]},{TYPE:"node",NAME:"VECT_MATH_AVERAGE",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"FH",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"FI",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"FJ",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"FK",QUALIFIER:["float"],IS_OPTIONAL:!0}],STATEMENTS:[{TYPE:"txt",TOKENS:["FJ","=","FH","+","FI",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_FK"],STATEMENTS:[{TYPE:"txt",TOKENS:["FK","=","length","(","FJ",")",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_FJ"],STATEMENTS:[{TYPE:"txt",TOKENS:["FJ","=","normalize","(","FJ",")",";"]}]}]}]},{TYPE:"node",NAME:"VECT_MATH_DOT_PRODUCT",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"FL",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"FM",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"FN",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"FO",QUALIFIER:["float"],IS_OPTIONAL:!0}],STATEMENTS:[{TYPE:"txt",TOKENS:["FN","=","vec3","(","_0_0",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_FO"],STATEMENTS:[{TYPE:"txt",TOKENS:["FO","=","dot","(","FL",",","FM",")",";"]}]}]}]},{TYPE:"node",NAME:"VECT_MATH_CROSS_PRODUCT",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"FP",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"FQ",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"FR",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"FS",QUALIFIER:["float"],IS_OPTIONAL:!0}],STATEMENTS:[{TYPE:"txt",TOKENS:["FR","=","cross","(","FP",",","FQ",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_FS"],STATEMENTS:[{TYPE:"txt",TOKENS:["FS","=","length","(","FR",")",";","FR","/=","FS",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["FR","=","normalize","(","FR",")",";"]}]}]}]},{TYPE:"node",NAME:"VECT_MATH_NORMALIZE",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"FT",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"FU",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"FV",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"FW",QUALIFIER:["float"],IS_OPTIONAL:!0}],STATEMENTS:[{TYPE:"txt",TOKENS:["FV","=","normalize","(","FT",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_FW"],STATEMENTS:[{TYPE:"txt",TOKENS:["FW","=","length","(","FT",")",";"]}]}]},{TYPE:"txt",TOKENS:["FU",";"]}]},{TYPE:"node",NAME:"FRESNEL",NODE_VARS:[{TYPE:"node_var",NAME:"USE_FRESNEL_NORMAL",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"FX",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"FY",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"FZ",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_FRESNEL_NORMAL"],STATEMENTS:[{TYPE:"txt",TOKENS:["vec3","cr","=","normalize","(","FY",")",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["vec3","cr","=","ot",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["CAMERA_TYPE","CAM_TYPE_PERSP",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:["vec3","Ax","=","normalize","(","ou",")",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["vec3","Ax","=","u_camera_direction",";"]}]}]},{TYPE:"txt",TOKENS:["float","sa","=","max","(","FX",",","0.00001",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["REFLECTION_PASS","REFL_PASS_PLANE",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:["sa","=","gl_FrontFacing","==","false","?","sa",":","_1_0","/","sa",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["sa","=","gl_FrontFacing","?","sa",":","_1_0","/","sa",";"]}]}]},{TYPE:"txt",TOKENS:["FZ","=","sb","(","Ax",",","cr",",","sa",")",";"]}]},{TYPE:"node",NAME:"BACKGROUND",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"F_",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Ga",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Gb",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["Gb","=","F_","*","Ga",";"]}]},{TYPE:"node",NAME:"B4W_REFLECT",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"Gc",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Gd",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Ge",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["Ge","=","reflect","(","_","(","u_view_tsr_inverse",",","Gc",")",",","Gd",")",";"]}]},{TYPE:"node",NAME:"B4W_REFLECT_WORLD",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"Gf",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Gg",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["Gg","=","reflect","(","-","ou",".","xyz",",","Gf",")",";"]}]},{TYPE:"node",NAME:"B4W_PARALLAX",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"Gh",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Gi",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Gj",QUALIFIER:["const","float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Gk",QUALIFIER:["const","float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Gl",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_param",NAME:"node_B4W_PARALLAX_var_texture",QUALIFIER:["uniform","sampler2D"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["float","bN","=","length","(","sB",")",";","if","(","bN","<","Gk",")","{","vec2","b_","=","rY","(","Gh",")",";","float","cd","=","clamp","(","_0_5","*","(","Gk","-","bN",")",",","_0_0",",","_1_0",")",";","float","hG","=","Gi","*","cd",";","vec3","cf","=","normalize","(","ou","*","sy",")",";","float","cg","=","_1_0","/","Gj",";","vec2","ch","=","cf",".","xy","*","hG","/","(","Gj","*","cf",".","z",")",";","float","ci","=","_1_0",";","float","cj","=","GLSL_TEXTURE","(","node_B4W_PARALLAX_var_texture",",","b_",")",".","a",";","for","(","float","cl","=","1.0",";","cl","<=","Gj",";","cl","++",")","{","if","(","cj","<","ci",")","{","ci","-=","cg",";","b_","-=","ch",";","cj","=","GLSL_TEXTURE","(","node_B4W_PARALLAX_var_texture",",","b_",")",".","a",";","}","}","vec2","cm","=","b_","+","ch",";","float","cn","=","GLSL_TEXTURE","(","node_B4W_PARALLAX_var_texture",",","cm",")",".","a","-","(","ci","+","cg",")",";","float","co","=","cj","-","ci",";","float","cp","=","co","/","(","co","-","cn",")",";","b_","=","cp","*","cm","+","(","_1_0","-","cp",")","*","b_",";","Gl","=","rX","(","b_",")",";","}","else","Gl","=","Gh",";"]}]},{TYPE:"node",NAME:"B4W_CLAMP",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"Gm",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Gn",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["Gn","=","clamp","(","Gm",",","_0_0",",","_1_0",")",";"]}]},{TYPE:"node",NAME:"B4W_REFRACTION",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"Go",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Gp",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Gq",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["Gq","=","rW","(","Go",",","Gp",")",";"]}]},{TYPE:"node",NAME:"B4W_TRANSLUCENCY",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"Gr",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Gs",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Gt",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Gu",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Gv",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Gw",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"Gx",QUALIFIER:["vec4"],IS_OPTIONAL:!0}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Gw"],STATEMENTS:[{TYPE:"txt",TOKENS:["Gw","=","Gr",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Gx"],STATEMENTS:[{TYPE:"txt",TOKENS:["Gx","=","vec4","(","Gs",",","Gt",",","Gu",",","Gv",")",";"]}]}]}]},{TYPE:"node",NAME:"B4W_TIME",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"Gy",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["Gy","=","u_time",";"]}]},{TYPE:"node",NAME:"B4W_SMOOTHSTEP",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"Gz",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"GA",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"GB",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"GC",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["GC","=","smoothstep","(","GA",",","GB",",","Gz",")",";"]}]},{TYPE:"node",NAME:"B4W_GLOW_OUTPUT",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"GD",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"GE",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["E","=","GD",";","I","=","GE",";"]}]},{TYPE:"node",NAME:"B4W_VECTOSCAL",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"GF",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"GG",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["GG","=","(","GF",".","r","+","GF",".","g","+","GF",".","b",")","/","3.0",";"]}]},{TYPE:"node",NAME:"B4W_SCALTOVEC",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"GH",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"GI",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["GI","[","0","]","=","GH",";","GI","[","1","]","=","GH",";","GI","[","2","]","=","GH",";"]}]},{TYPE:"nodes_global"},{TYPE:"txt",TOKENS:["void","J","(","in","vec3","ou",",","out","vec3","E",",","out","vec3","F",",","out","vec3","G",",","out","vec4","H",",","out","float","I",")","{","E","=","vec3","(","_0_0",")",";","F","=","vec3","(","_0_0",")",";","G","=","vec3","(","_0_0",")",";","H","=","vec4","(","_0_0",")",";","I","=","_0_0",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["IS_WORLD"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_TEXTURE_ENVIRONMENT_EQUIRECTANGULAR","USE_NODE_TEXTURE_ENVIRONMENT_MIRROR_BALL","USE_NODE_TEX_COORD_GE","USE_NODE_TEX_COORD_OB",{TYPE:"logical_or_expr",PLACES:4}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","sr","=","-","ou",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_GEOMETRY_GL"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","os","=","-","ou",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_TEX_COORD_NO"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","ot","=","ou",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_GEOMETRY_NO"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","su","=","ou",";"]}]}}]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","USE_NODE_TEX_COORD_NO","USE_NODE_NORMAL_MAP","USE_NODE_BSDF_BEGIN","USE_NODE_FRESNEL","USE_NODE_TEX_COORD_RE","USE_NODE_LAYER_WEIGHT","USE_NODE_BUMP",{TYPE:"logical_or_expr",PLACES:11}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","sv","=","j",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DOUBLE_SIDED_LIGHTING","USE_NODE_GEOMETRY_NO",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_PASS","REFL_PASS_PLANE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["if","(","gl_FrontFacing","==","false",")"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["if","(","gl_FrontFacing",")"]}]}}]},{TYPE:"txt",TOKENS:["sv","=","sv",";","else","sv","=","-","sv",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_NORMAL_MAP"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","sw","=","sv",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DOUBLE_SIDED_LIGHTING","USE_NODE_GEOMETRY_NO","USE_NODE_TEXTURE_NORMAL","USE_NODE_B4W_PARALLAX",{TYPE:"logical_or_expr",PLACES:4}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","sx","=","normalize","(","sv",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DOUBLE_SIDED_LIGHTING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","ot","=","sx",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","ot","=","normalize","(","j",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_GEOMETRY_NO"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","su","=","sx",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CALC_TBN_SPACE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_TEXTURE_NORMAL","USE_NODE_B4W_PARALLAX",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","W","=","cross","(","sx",",","k",".","xyz",")","*","k",".","w",";","mat3","sy","=","mat3","(","k",".","xyz",",","W",",","sx",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_NORMAL_MAP"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","sz","=","cross","(","sv",",","k",".","xyz",")","*","k",".","w",";","mat3","sA","=","mat3","(","k",".","xyz",",","sz",",","sv",")",";"]}]}}]}]}}]},{TYPE:"txt",TOKENS:["vec3","os","=","h",";","vec4","sB","=","i",";","float","sC","=","u_emit",";","float","sD","=","u_ambient",";"]}]}}]},{TYPE:"nodes_main"},{TYPE:"txt",TOKENS:["}"]}]}}]}]},e["include/nodes.glslv"]={TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"NODES_GLSLV",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"NODES_GLSLV",TOKENS:[""]},{TYPE:"var",NAME:"PARTICLE_BATCH",TOKENS:["0"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_GEOMETRY_OR","USE_NODE_TEX_COORD_GE",{TYPE:"logical_or_expr",PLACES:2},"PARTICLE_BATCH",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","a_orco_tex_coord",";","GLSL_OUT","vec3","rT",";"]}]}}]},{TYPE:"node",NAME:"TEX_COORD_UV",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_param",NAME:"node_TEX_COORD_UV_var_a_uv",QUALIFIER:["GLSL_IN","vec2"],IS_OPTIONAL:!1},{TYPE:"node_param",NAME:"sj",QUALIFIER:["GLSL_OUT","vec2"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["sj","=","node_TEX_COORD_UV_var_a_uv",";"]}]},{TYPE:"node",NAME:"UV_MERGED",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_param",NAME:"node_UV_MERGED_var_a_uv",QUALIFIER:["GLSL_IN","vec2"],IS_OPTIONAL:!1},{TYPE:"node_param",NAME:"si",QUALIFIER:["GLSL_OUT","vec2"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["si","=","node_UV_MERGED_var_a_uv",";"]}]},{TYPE:"node",NAME:"UVMAP",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_param",NAME:"node_UVMAP_var_a_uv",QUALIFIER:["GLSL_IN","vec2"],IS_OPTIONAL:!1},{TYPE:"node_param",NAME:"sk",QUALIFIER:["GLSL_OUT","vec2"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["sk","=","node_UVMAP_var_a_uv",";"]}]},{TYPE:"node",NAME:"GEOMETRY_UV",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_param",NAME:"node_GEOMETRY_UV_var_a_uv",QUALIFIER:["GLSL_IN","vec2"],IS_OPTIONAL:!1},{TYPE:"node_param",NAME:"sc",QUALIFIER:["GLSL_OUT","vec2"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["sc","=","node_GEOMETRY_UV_var_a_uv",";"]}]},{TYPE:"node",NAME:"GEOMETRY_VC",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_param",NAME:"node_GEOMETRY_VC_var_a_vertex_color",QUALIFIER:["GLSL_IN","vec3"],IS_OPTIONAL:!1},{TYPE:"node_param",NAME:"GJ",QUALIFIER:["GLSL_OUT","vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["GJ","=","node_GEOMETRY_VC_var_a_vertex_color",";"]}]},{TYPE:"node",NAME:"GEOMETRY_VC1",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_param",NAME:"node_GEOMETRY_VC1_var_a_vertex_color",QUALIFIER:["GLSL_IN","float"],IS_OPTIONAL:!1},{TYPE:"node_param",NAME:"GK",QUALIFIER:["GLSL_OUT","float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["GK","=","node_GEOMETRY_VC1_var_a_vertex_color",";"]}]},{TYPE:"node",NAME:"GEOMETRY_VC2",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_param",NAME:"node_GEOMETRY_VC2_var_a_vertex_color",QUALIFIER:["GLSL_IN","vec2"],IS_OPTIONAL:!1},{TYPE:"node_param",NAME:"GL",QUALIFIER:["GLSL_OUT","vec2"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["GL","=","node_GEOMETRY_VC2_var_a_vertex_color",";"]}]},{TYPE:"node",NAME:"GEOMETRY_VC3",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_param",NAME:"node_GEOMETRY_VC3_var_a_vertex_color",QUALIFIER:["GLSL_IN","vec3"],IS_OPTIONAL:!1},{TYPE:"node_param",NAME:"GM",QUALIFIER:["GLSL_OUT","vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["GM","=","node_GEOMETRY_VC3_var_a_vertex_color",";"]}]},{TYPE:"nodes_global"},{TYPE:"txt",TOKENS:["void","J","(",")","{"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_GEOMETRY_OR","USE_NODE_TEX_COORD_GE",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["rT","=","a_orco_tex_coord",";"]}]}}]},{TYPE:"nodes_main"},{TYPE:"txt",TOKENS:["}"]}]}}]}]},e["include/pack.glslf"]={TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"PACK_GLSLF",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"PACK_GLSLF",TOKENS:[""]},{TYPE:"txt",TOKENS:["vec4","er","(","const","in","float","il",")","{","vec4","fq","=","vec4","(","_255_0","*","_255_0","*","_255_0",",","_255_0","*","_255_0",",","_255_0",",","_1_0",")",";","vec4","GN","=","vec4","(","_0_0",",","_1_0","/","_255_0",",","_1_0","/","_255_0",",","_1_0","/","_255_0",")",";","vec4","jB","=","fract","(","il","*","fq",")",";","jB","-=","jB",".","xxyz","*","GN",";","return","jB",";","}","float","cQ","(","const","in","vec4","GO",")","{","float","eq",";","vec4","fq","=","vec4","(","_1_0","/","(","_255_0","*","_255_0","*","_255_0",")",",","_1_0","/","(","_255_0","*","_255_0",")",",","_1_0","/","_255_0",",","_1_0",")",";","eq","=","dot","(","GO",",","fq",")",";","return","eq",";","}","vec4","er","(","const","in","vec2","rf",")","{","vec2","fq","=","vec2","(","_255_0",",","_1_0",")",";","vec2","GN","=","vec2","(","_0_0",",","_1_0","/","_255_0",")",";","vec4","jB","=","fract","(","rf",".","xxyy","*","fq",".","xyxy",")",";","jB","-=","jB",".","xxzz","*","GN",".","xyxy",";","if","(","rf",".","r","==","_1_0",")","jB",".","rg","=","vec2","(","_0_0",",","_1_0",")",";","if","(","rf",".","g","==","_1_0",")","jB",".","ba","=","vec2","(","_0_0",",","_1_0",")",";","return","jB",";","}","vec2","jg","(","const","in","vec4","GP",")","{","vec2","rf",";","vec2","fq","=","vec2","(","_1_0","/","_255_0",",","_1_0",")",";","rf",".","r","=","dot","(","GP",".","rg",",","fq",")",";","rf",".","g","=","dot","(","GP",".","ba",",","fq",")",";","return","rf",";","}"]}]}}]}]},e["include/particles.glslv"]={TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"PARTICLES_GLSLV",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"PARTICLES_GLSLV",TOKENS:[""]},{TYPE:"var",NAME:"EPSILON",TOKENS:["0.000001"]},{TYPE:"var",NAME:"COLOR_RAMP_LENGTH",TOKENS:["0"]},{TYPE:"var",NAME:"WORLD_SPACE",TOKENS:["0"]},{TYPE:"var",NAME:"USE_COLOR_RAMP",TOKENS:["0"]},{TYPE:"include",FILE:"math.glslv"},{TYPE:"txt",TOKENS:["struct","cY","{","float","df",";","vec3","O",";","float","L",";","vec3","aQ",";","float","bK",";","vec3","dl",";","vec3","dm",";","float","dn",";","}",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["COLOR_RAMP_LENGTH",0,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["void","GT","(","inout","vec3","aQ",",","float","GQ",",","vec4","kb",",","vec4","bv",")","{","float","GR","=","bv",".","x","-","kb",".","x",";","float","GS","=","(","GQ","-","kb",".","x",")","/","GR",";","aQ","=","mix","(","aQ",",","bv",".","yzw",",","clamp","(","GS",",","0.0",",","1.0",")",")",";","}"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["COLOR_RAMP_LENGTH",0,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","GW","(","float","t",",","float","GU",",","vec4","GV","[","COLOR_RAMP_LENGTH","]",")","{","float","GQ","=","t","/","GU",";","vec3","aQ","=","GV","[","0","]",".","yzw",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["COLOR_RAMP_LENGTH",1,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GT","(","aQ",",","GQ",",","GV","[","0","]",",","GV","[","1","]",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["COLOR_RAMP_LENGTH",2,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GT","(","aQ",",","GQ",",","GV","[","1","]",",","GV","[","2","]",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["COLOR_RAMP_LENGTH",3,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GT","(","aQ",",","GQ",",","GV","[","2","]",",","GV","[","3","]",")",";"]}]}}]},{TYPE:"txt",TOKENS:["return","aQ",";","}"]}]}}]},{TYPE:"txt",TOKENS:["float","Hb","(","float","t",",","float","GU",",","float","GX",",","float","GY",")","{","float","GZ","=","max","(","0.01",",","min","(","GU",",","GX",")",")",";","float","G_","=","max","(","0.01",",","min","(","GU",",","GY",")",")",";","float","Ha","=","GU","-","G_",";","float","L","=","clamp","(","t","/","GZ",",","0.0",",","1.0",")","-","step","(","Ha",",","t",")","*","(","t","-","Ha",")","/","G_",";","return","L",";","}","cY","cZ","(",")","{","cY","sp",";","float","t",";","float","GU","=","a_p_data","[","0","]",";","float","Hc","=","a_p_data","[","1","]",";","if","(","u_p_cyclic","==","1",")","{","t","=","mod","(","u_p_time",",","u_p_length",")","-","Hc",";","if","(","t","<","0.0",")","t","+=","u_p_length",";","}","if","(","u_p_cyclic","!=","1",")","{","t","=","u_p_time","-","Hc",";","}","if","(","t","<","0.0","||","t",">=","GU",")","{","sp",".","df","=","0.0001",";","sp",".","O","=","vec3","(","99999.0",",","0.0",",","0.0",")",";","}","if","(","!","(","t","<","0.0","||","t",">=","GU",")",")","{","vec4","S","=","R","(","a_tbn",")",";","vec3","bW","=","T","(","S",",","vec3","(","0.0",",","1.0",",","0.0",")",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WORLD_SPACE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","fn","=","a_position",";","vec3","r_","=","bW",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","fn","=","ap","(","u_model_tsr",",","a_position",")",";","vec3","r_","=","_","(","u_model_tsr",",","bW",")",";"]}]}}]},{TYPE:"txt",TOKENS:["vec3","Hd","=","u_p_nfactor","*","r_",";","Hd","+=","a_p_vels",".","xyz",";","Hd",".","z","-=","u_p_gravity","*","t","/","2.0",";","float","He","=","max","(","u_p_mass",",","EPSILON",")",";","Hd","+=","(","u_p_wind_fac","*","u_wind","/","He",")","*","t","/","2.0",";","sp",".","dn","=","t",";","sp",".","dl","=","Hd",";","sp",".","dm","=","bW","*","a_p_vels",".","w",";","sp",".","O","=","fn","+","Hd","*","t",";","sp",".","bK","=","a_p_vels",".","w","*","t",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_COLOR_RAMP"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["sp",".","df","=","GLSL_TEXTURE","(","u_color_ramp_tex",",","vec2","(","t","/","u_p_max_lifetime",",","0.5",")",")",".","g",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["sp",".","df","=","1.0",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["COLOR_RAMP_LENGTH",0,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["sp",".","aQ","=","GW","(","t",",","u_p_max_lifetime",",","u_p_color_ramp",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["sp",".","aQ","=","vec3","(","1.0",")",";"]}]}}]},{TYPE:"txt",TOKENS:["sp",".","L","=","Hb","(","t",",","a_p_data","[","0","]",",","u_p_fade_in",",","u_p_fade_out",")",";","}","return","sp",";","}"]}]}}]}]},e["include/particles_nodes.glslf"]={TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"PARTICLES_NODES_GLSLF",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"PARTICLES_NODES_GLSLF",TOKENS:[""]},{TYPE:"var",NAME:"CAUSTICS",TOKENS:["0"]},{TYPE:"var",NAME:"DOUBLE_SIDED_LIGHTING",TOKENS:["0"]},{TYPE:"var",NAME:"REFLECTION_PASS",TOKENS:["REFL_PASS_NONE"]},{TYPE:"var",NAME:"PARTICLE_BATCH",TOKENS:["0"]},{TYPE:"var",NAME:"NUM_LIGHTS",TOKENS:["0"]},{TYPE:"var",NAME:"CALC_TBN_SPACE",TOKENS:["0"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_MATERIAL_BEGIN","USE_NODE_BSDF_BEGIN",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"environment.glslf"}]}}]},{TYPE:"include",FILE:"color_util.glslf"},{TYPE:"include",FILE:"math.glslv"},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_HUE_SAT","USE_NODE_MIX_RGB_HUE","USE_NODE_MIX_RGB_SATURATION","USE_NODE_MIX_RGB_VALUE","USE_NODE_MIX_RGB_COLOR","USE_NODE_SEPHSV",{TYPE:"logical_or_expr",PLACES:6}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","kf","(","vec3","rgb",")","{","vec4","hI","=","vec4","(","_0_0",",","-","_1_0","/","3.0",",","2.0","/","3.0",",","-","_1_0",")",";","vec4","p","=","mix","(","vec4","(","rgb",".","bg",",","hI",".","wz",")",",","vec4","(","rgb",".","gb",",","hI",".","xy",")",",","step","(","rgb",".","b",",","rgb",".","g",")",")",";","vec4","q","=","mix","(","vec4","(","p",".","xyw",",","rgb",".","r",")",",","vec4","(","rgb",".","r",",","p",".","yzx",")",",","step","(","p",".","x",",","rgb",".","r",")",")",";","float","dz","=","q",".","x","-","min","(","q",".","w",",","q",".","y",")",";","float","iB","=","1.0e-10",";","return","vec3","(","abs","(","q",".","z","+","(","q",".","w","-","q",".","y",")","/","(","6.0","*","dz","+","iB",")",")",",","dz","/","(","q",".","x","+","iB",")",",","q",".","x",")",";","}"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_HUE_SAT","USE_NODE_MIX_RGB_HUE","USE_NODE_MIX_RGB_SATURATION","USE_NODE_MIX_RGB_VALUE","USE_NODE_MIX_RGB_COLOR","USE_NODE_COMBHSV",{TYPE:"logical_or_expr",PLACES:6}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","kh","(","vec3","kg",")","{","vec4","hI","=","vec4","(","_1_0",",","2.0","/","3.0",",","_1_0","/","3.0",",","3.0",")",";","vec3","p","=","abs","(","fract","(","vec3","(","kg",".","r",",","kg",".","r",",","kg",".","r",")","+","hI",".","xyz",")","*","6.0","-","hI",".","www",")",";","return","kg",".","b","*","mix","(","hI",".","xxx",",","clamp","(","p","-","hI",".","xxx",",","_0_0",",","_1_0",")",",","kg",".","g",")",";","}"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_GEOMETRY_UV","USE_NODE_B4W_PARALLAX","USE_NODE_UV_MERGED",{TYPE:"logical_or_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","rX","(","vec2","gT",")","{","return","vec3","(","gT","*","2.0","-","vec2","(","_1_0",",","_1_0",")",",","_0_0",")",";","}"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_TEXTURE_COLOR","USE_NODE_TEXTURE_NORMAL","USE_NODE_B4W_PARALLAX",{TYPE:"logical_or_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec2","rY","(","vec3","rf",")","{","return","vec2","(","rf",".","xy","*","_0_5","+","vec2","(","_0_5",",","_0_5",")",")",";","}"]}]}}]},{TYPE:"node",NAME:"CAMERA",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"sE",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"sF",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"sG",QUALIFIER:["float"],IS_OPTIONAL:!0}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_sE"],STATEMENTS:[{TYPE:"txt",TOKENS:["sE","=","normalize","(","sB",".","xyz",")",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_sF"],STATEMENTS:[{TYPE:"txt",TOKENS:["sF","=","abs","(","sB",".","z",")",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_sG"],STATEMENTS:[{TYPE:"txt",TOKENS:["sG","=","length","(","sB",".","xyz",")",";"]}]}]}]},{TYPE:"node",NAME:"COMBRGB",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"sH",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"sI",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"sJ",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"sK",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["sK","=","vec3","(","sH",",","sI",",","sJ",")",";"]}]},{TYPE:"node",NAME:"COMBHSV",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"sL",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"sM",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"sN",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"sO",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["sO","=","kh","(","vec3","(","sL",",","sM",",","sN",")",")",";"]}]},{TYPE:"node",NAME:"EMPTY_UV",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"sP",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["sP","=","vec3","(","-","_1_0",",","-","_1_0",",","_0_0",")",";"]}]},{TYPE:"node",NAME:"EMPTY_VC",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"sQ",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["sQ","=","vec3","(","_0_0",")",";"]}]},{TYPE:"node",NAME:"GEOMETRY_UV",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"sR",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["sR","=","rX","(","A",")",";"]}]},{TYPE:"node",NAME:"GEOMETRY_OR",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"sS",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["sS","=","2.0","*","vec3","(","A",",","_0_0",")","-","vec3","(","_1_0",")",";"]}]},{TYPE:"node",NAME:"GEOMETRY_VC",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"sT",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["sT","=","vec3","(","_1_0",")",";"]}]},{TYPE:"node",NAME:"GEOMETRY_VC1",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"sU",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["sU","=","_1_0",";"]}]},{TYPE:"node",NAME:"GEOMETRY_VC2",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"sV",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"sW",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["sV","=","_1_0",";","sW","=","_1_0",";"]}]},{TYPE:"node",NAME:"GEOMETRY_VC3",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"sX",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"sY",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"sZ",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["sX","=","_1_0",";","sY","=","_1_0",";","sZ","=","_1_0",";"]}]},{TYPE:"node",NAME:"GEOMETRY_NO",NODE_VARS:[{TYPE:"node_var",NAME:"USE_NORMAL_IN",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"s_",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"ta",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_NORMAL_IN"],STATEMENTS:[{TYPE:"txt",TOKENS:["ta","=","s_",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["ta","=","su",".","xyz",";"]}]}]}]},{TYPE:"node",NAME:"GEOMETRY_FB",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"tb",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["REFLECTION_PASS","REFL_PASS_PLANE",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:["tb","=","(","gl_FrontFacing",")","?","_0_0",":","_1_0",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["tb","=","(","gl_FrontFacing",")","?","_1_0",":","_0_0",";"]}]}]}]},{TYPE:"node",NAME:"GEOMETRY_VW",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"td",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["td","=","-","_","(","u_view_tsr_frag",",","ou",")",";"]}]},{TYPE:"node",NAME:"GEOMETRY_LO",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"te",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["te","[","0","]","=","sB","[","0","]",";","te","[","1","]","=","sB","[","1","]",";","te","[","2","]","=","sB","[","2","]",";"]}]},{TYPE:"node",NAME:"GEOMETRY_GL",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"tf",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["tf","=","vec3","(","os",".","r",",","os",".","g",",","os",".","b",")",";"]}]},{TYPE:"node",NAME:"NEW_GEOMETRY",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"th",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"ti",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"tj",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"tk",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"tl",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"tm",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"tn",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"to",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["th","=","vec3","(","_0_0",")",";","ti","=","vec3","(","_0_0",")",";","tj","=","vec3","(","_0_0",")",";","tk","=","vec3","(","_0_0",")",";","tl","=","vec3","(","_0_0",")",";","tm","=","vec3","(","_0_0",")",";","tn","=","_0_0",";","to","=","_0_0",";"]}]},{TYPE:"node",NAME:"HUE_SAT",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"tr",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"tu",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"tv",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"tw",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"tx",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"ty",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["vec3","kg","=","kf","(","tx",")",";","kg","[","0","]","+=","(","tr","-","_0_5",")",";","if","(","kg","[","0","]",">","_1_0",")","kg","[","0","]","-=","_1_0",";","else","if","(","kg","[","0","]","<","_0_0",")","kg","[","0","]","+=","_1_0",";","kg","*=","vec3","(","_1_0",",","tu",",","tv",")",";","kg","=","mix","(","vec3","(","_1_0",")",",","mix","(","vec3","(","_0_0",")",",","kg",",","step","(","vec3","(","_0_0",")",",","kg",")",")",",","step","(","kg",",","vec3","(","_1_0",")",")",")",";","ty","=","mix","(","tx",",","kh","(","kg",")",",","tw",")",";"]}]},{TYPE:"node",NAME:"INVERT",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"tz",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"tA",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"tB",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["tB","=","mix","(","tA",",","vec3","(","_1_0",")","-","tA",",","tz",")",";"]}]},{TYPE:"node",NAME:"LAMP",NODE_VARS:[{TYPE:"node_var",NAME:"LAMP_TYPE",TOKENS:["HEMI"]},{TYPE:"node_var",NAME:"LAMP_INDEX",TOKENS:["0"]},{TYPE:"node_var",NAME:"LAMP_USE_SPHERE",TOKENS:["0"]},{TYPE:"node_var",NAME:"LAMP_SPOT_SIZE",TOKENS:["0.8"]},{TYPE:"node_var",NAME:"LAMP_SPOT_BLEND",TOKENS:["0.03"]},{TYPE:"node_var",NAME:"LAMP_LIGHT_DIST",TOKENS:["30.0"]}],DECLARATIONS:[{TYPE:"node_out",NAME:"tC",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"tD",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"tE",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"tF",QUALIFIER:["float"],IS_OPTIONAL:!0}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_tC"],STATEMENTS:[{TYPE:"txt",TOKENS:["tC","=","u_lamp_light_color_intensities","[","LAMP_INDEX","]",";"]}]}]},{TYPE:"txt",TOKENS:["vec3","tG","=","u_lamp_light_directions","[","LAMP_INDEX","]",";","vec3","tH","=","u_lamp_light_positions","[","LAMP_INDEX","]",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["LAMP_TYPE","SPOT",{TYPE:"equal_expr",PLACES:2},"LAMP_TYPE","POINT",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:["tD","=","-","h","+","tH",";","tE","=","length","(","tD",")",";","tD","=","normalize","(","tD",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_tF"],STATEMENTS:[{TYPE:"txt",TOKENS:["tF","=","LAMP_LIGHT_DIST","/","(","LAMP_LIGHT_DIST","+","tE","*","tE",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["LAMP_TYPE","SPOT",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:["float","oY","=","dot","(","tD",",","tG",")",";","oY","*=","smoothstep","(","_0_0",",","_1_0",",","(","oY","-","LAMP_SPOT_SIZE",")","/","LAMP_SPOT_BLEND",")",";","tF","*=","oY",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["LAMP_USE_SPHERE"],STATEMENTS:[{TYPE:"txt",TOKENS:["tF","*=","max","(","LAMP_LIGHT_DIST","-","tE",",","_0_0",")","/","LAMP_LIGHT_DIST",";"]}]}]}]}]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_tD"],STATEMENTS:[{TYPE:"txt",TOKENS:["tD","=","tG",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_tE"],STATEMENTS:[{TYPE:"txt",TOKENS:["tE","=","length","(","tH","-","h",")",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_tF"],STATEMENTS:[{TYPE:"txt",TOKENS:["tF","=","_1_0",";"]}]}]}]}]}]},{TYPE:"node",NAME:"NORMAL",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"tI",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"tJ",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"tK",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_param",NAME:"sh",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_tJ"],STATEMENTS:[{TYPE:"txt",TOKENS:["tJ","=","sh",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_tK"],STATEMENTS:[{TYPE:"txt",TOKENS:["tK","=","-","dot","(","tI",",","sh",")",";"]}]}]}]},{TYPE:"node",NAME:"B4W_VECTOR_VIEW",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"tL",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"tM",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["tM","=","-","_","(","u_view_tsr_frag",",","tL",")",";"]}]},{TYPE:"node",NAME:"BSDF_BEGIN",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"tN",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"tO",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"tP",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"tQ",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"tR",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"tS",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"tT",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"tU",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"tV",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"tW",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"tX",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"tY",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"tZ",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"t_",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"ua",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"ub",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"uc",QUALIFIER:["vec4"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"ud",QUALIFIER:["vec4"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"ue",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"uf",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"ug",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"uh",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"ui",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"uj",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["t_","=","tO",";","ua","=","tQ",";","ub","=","tT",";","ue","=","tO",";","uf","=","tQ",";","metalness_out","=","tS",";","ug","=","tU",";","uh","=","tV",";","ui","=","tW",";","uj","=","tX",";","tY","=","sC","*","t_",";","tZ","=","sD","*","u_environment_energy","*","cz","(","ub",")",";","ud","=","cC","(","t_",")",";","H","=","ud",";","uc","[","0","]","=","tP",";","uc","[","1","]","=","tR",";","uc","[","2","]","=","tS",";"]}]},{TYPE:"node",NAME:"BSDF_END",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"uk",QUALIFIER:["vec4"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"ul",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"um",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"un",QUALIFIER:["vec4"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"uo",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"up",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"uq",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"ur",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"us",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"ur",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"ut",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"uu",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["uu","=","uk",".","rgb","+","ul",";","uu","=","mix","(","uu",",","uq",",","ur",")",";","I","=","_1_0",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_NODE_BSDF_TRANSPARENT"],STATEMENTS:[{TYPE:"txt",TOKENS:["vec3","ux","=","GLSL_TEXTURE","(","u_refractmap",",","l",".","xy","/","l",".","z",")",".","rgb",";","bC","(","ux",")",";","us","=","us","*","ux",";","uu","+=","us",";"]}]}]},{TYPE:"txt",TOKENS:["um",";"]}]},{TYPE:"node",NAME:"BSDF_COMPUTE",NODE_VARS:[{TYPE:"node_var",NAME:"MAT_USE_TBN_SHADING",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"uy",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"uz",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"uA",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"uB",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"uC",QUALIFIER:["vec4"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"uD",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"uE",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["vec3","r_","=","uA",";","float","uF","=","clamp","(","uC","[","0","]",",","_0_0",",","_1_0",")",";","float","uw","=","clamp","(","uC","[","1","]",",","_0_0",",","_1_0",")",";","float","rF","=","uC","[","2","]",";","vec3","pW","=","normalize","(","ou","+","uy",")",";","float","pf","=","(","_1_0","-","uB",")","*","dot","(","r_",",","uy",")","+","uB",";","float","uG","=","(","_1_0","-","uB",")","*","max","(","dot","(","uy",",","pW",")",",","_0_0",")","+","uB",";","float","uH","=","(","_1_0","-","uB",")","*","max","(","dot","(","uA",",","pW",")",",","_0_0",")","+","uB",";","uD","=","_0_0",";","if","(","uz",".","r","!=","_0_0",")","{","if","(","uF",">","_0_0",")","{","float","pv","=","max","(","dot","(","r_",",","ou",")",",","_0_0",")",";","float","pw","=","uF","*","uF",";","float","cB","=","_1_0","-","_0_5","*","(","pw","/","(","pw","+","0.33",")",")",";","vec3","px","=","uy","-","pf","*","r_",";","vec3","py","=","ou","-","pv","*","r_",";","if","(","length","(","px",")","==","_0_0","||","length","(","py",")","==","_0_0","||","abs","(","pf",")",">","_1_0","||","abs","(","pv",")",">","_1_0",")","uD","=","pf","*","cB",";","else","{","float","pz","=","acos","(","pf",")",";","float","pA","=","acos","(","pv",")",";","vec3","pB","=","normalize","(","px",")",";","vec3","pC","=","normalize","(","py",")",";","float","a",",","b",";","a","=","max","(","pz",",","pA",")",";","b","=","min","(","pz",",","pA",")",";","b","*=","0.95",";","float","t","=","max","(","dot","(","pB",",","pC",")",",","_0_0",")",";","float","hO","=","0.45","*","(","pw","/","(","pw","+","0.09",")",")",";","uD","=","pf","*","(","cB","+","(","hO","*","t","*","sin","(","a",")","*","tan","(","b",")",")",")",";","}","}","else","uD","=","pf",";","uD","=","max","(","uD",",","_0_0",")",";","}","float","L","=","uw",";","float","uI","=","L","*","L",";","float","dX","=","(","uH","*","uI","-","uH",")","*","uH","+","_1_0",";","float","cy","=","uI","/","(","M_PI","*","dX","*","dX",")",";","float","uJ",";","float","uK",";","float","uL","=","pow","(","_1_0","-","uG",",","5.0",")",";","uJ","=","_1_0",";","uK","=","uL",";","float","hI","=","L","/","2.0",";","float","uM","=","hI","*","hI",";","float","uN","=","_1_0","-","uM",";","float","uO","=","_1_0","/","(","uG","*","uG","*","uN","+","uM",")",";","uJ","*=","uO",";","uK","*=","uO",";","float","rC","=","mix","(","0.04",",","_1_0",",","rF",")",";","float","uP","=","mix","(","uK",",","uJ",",","rC",")",";","uE","=","max","(","pf","*","cy","*","uP",",","_0_0",")",";"]}]},{TYPE:"node",NAME:"BSDF_ANISOTROPIC",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"ve",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"vf",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"vg",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"vh",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"vi",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"vj",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vk",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["vk","=","ve",";","vf",";","vg",";","vh",";","vi",";","vj",";"]}]},{TYPE:"node",NAME:"BSDF_DIFFUSE",NODE_VARS:[{TYPE:"node_var",NAME:"USE_NORMAL_IN",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"vl",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"vm",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"vn",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vo",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vp",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vq",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vr",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vs",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vt",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vu",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vv",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vw",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vx",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vy",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["vp","=","vl",";","vq","=","vm",";","vt","=","_0_0",";","vw","=","_0_0",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_NORMAL_IN"],STATEMENTS:[{TYPE:"txt",TOKENS:["vu","=","vn",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["vu","=","ot",";"]}]}]},{TYPE:"txt",TOKENS:["vo",";","vr",";","vs",";","vv",";","vx",";","vy",";"]}]},{TYPE:"node",NAME:"BSDF_GLASS",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"vz",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"vA",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"vB",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"vC",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vD",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["vD","=","vz",";","vA",";","vB",";","vC",";"]}]},{TYPE:"node",NAME:"BSDF_GLOSSY",NODE_VARS:[{TYPE:"node_var",NAME:"USE_NORMAL_IN",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"vE",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"vF",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"vG",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vH",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vI",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vJ",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vK",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vL",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vM",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vN",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vO",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vP",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vQ",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vR",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["vK","=","vE",";","vL","=","vF",";","vM","=","_1_0",";","vP","=","_0_0",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_NORMAL_IN"],STATEMENTS:[{TYPE:"txt",TOKENS:["vN","=","vG",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["vN","=","ot",";"]}]}]},{TYPE:"txt",TOKENS:["vH",";","vI",";","vJ",";","vO",";","vQ",";","vR",";"]}]},{TYPE:"node",NAME:"BSDF_HAIR",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"vS",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"vT",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"vU",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"vV",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vW",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["vW","=","vS",";","vT",";","vU",";","vV",";"]}]},{TYPE:"node",NAME:"BSDF_TRANSPARENT",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"vX",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vY",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vZ",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"v_",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wa",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wb",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wc",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wd",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"we",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wf",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wg",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wh",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["wg","=","vX",";","wc","=","_0_0",";","wf","=","_0_0",";","wh","=","_0_0",";","wd","=","ot",";","vY",";","vZ",";","v_",";","wa",";","wb",";","we",";"]}]},{TYPE:"node",NAME:"BSDF_TRANSLUCENT",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"wi",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"wj",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wk",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["wk","=","wi",";","wj",";"]}]},{TYPE:"node",NAME:"BSDF_REFRACTION",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"wl",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"wm",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"wn",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"wo",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wp",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["wp","[","0","]","=","wp","[","1","]","=","wp","[","2","]","=","_0_0",";","wl",";","wm",";","wn",";","wo",";"]}]},{TYPE:"node",NAME:"BSDF_TOON",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"wq",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"wr",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"ws",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"wt",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wu",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["wu","=","wq",";","wr",";","ws",";","wt",";"]}]},{TYPE:"node",NAME:"BSDF_VELVET",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"wv",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"wA",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"wB",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wC",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["wC","=","wv",";","wA",";","wB",";"]}]},{TYPE:"node",NAME:"SUBSURFACE_SCATTERING",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"wD",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"wE",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"wF",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"wG",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"wH",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"wI",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wJ",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["wJ","[","0","]","=","wJ","[","1","]","=","wJ","[","2","]","=","_0_0",";","wD",";","wF",";","wG",";","wH",";","wI",";","wE",";"]}]},{TYPE:"node",NAME:"EMISSION",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"wK",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"wL",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wM",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wN",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wO",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wP",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wQ",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wR",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wS",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wT",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wU",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wV",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wW",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["wT","=","wL","*","wK",";","wR","=","_0_0",";","wU","=","_1_0",";","wS","=","ot",";","wM",";","wN",";","wO",";","wP",";","wQ",";","wV",";","wW",";"]}]},{TYPE:"node",NAME:"AMBIENT_OCCLUSION",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"wX",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wY",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["wY","[","0","]","=","wY","[","1","]","=","wY","[","2","]","=","_0_0",";","wX",";"]}]},{TYPE:"node",NAME:"HOLDOUT",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"wZ",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["wZ","[","0","]","=","wZ","[","1","]","=","wZ","[","2","]","=","_0_0",";"]}]},{TYPE:"node",NAME:"VOLUME_ABSORPTION",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"w_",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"xa",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"xb",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["xb","[","0","]","=","xb","[","1","]","=","xb","[","2","]","=","_0_0",";","w_",";","xa",";"]}]},{TYPE:"node",NAME:"VOLUME_SCATTER",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"xc",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"xd",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"xe",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"xf",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["xf","[","0","]","=","xf","[","1","]","=","xf","[","2","]","=","_0_0",";","xc",";","xd",";","xe",";"]}]},{TYPE:"node",NAME:"BUMP",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"Hj",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Hk",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"xi",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Hl",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"xk",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["xk","=","Hl",";","Hj",";","Hk",";","xi",";"]}]},{TYPE:"node",NAME:"DISPLACEMENT_BUMP",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"xr",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"xs",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["xs","=","ot",";","xr",";"]}]},{TYPE:"node",NAME:"NORMAL_MAP",NODE_VARS:[{TYPE:"node_var",NAME:"SPACE",TOKENS:["NM_TANGENT"]},{TYPE:"node_var",NAME:"USE_NORMAL_IN",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"xt",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"xu",QUALIFIER:["vec4"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"xv",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"xA",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_NORMAL_IN"],STATEMENTS:[{TYPE:"txt",TOKENS:["vec3","xB","=","xv",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["vec3","xB","=","sw",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["SPACE","NM_TANGENT",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:["xA","=","2.0","*","xu",".","xyz","-","_1_0",";","xA","=","sA","*","xA",";"]}]},{TYPE:"node_elif",EXPRESSION:["SPACE","NM_OBJECT",{TYPE:"equal_expr",PLACES:2},"SPACE","NM_BLENDER_OBJECT",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:["xA","=","2.0","*","xu",".","xyz","-","_1_0",";","xA",".","yz","*=","-","_1_0",";","xA","=","_","(","u_model_tsr",",","xA",")",";"]}]},{TYPE:"node_elif",EXPRESSION:["SPACE","NM_WORLD",{TYPE:"equal_expr",PLACES:2},"SPACE","NM_BLENDER_WORLD",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:["xA","=","2.0","*","xu",".","xyz","-","_1_0",";","xA",".","yz","*=","-","_1_0",";"]}]}]},{TYPE:"txt",TOKENS:["float","ma","=","max","(","xt",",","_0_0",")",";","xA","=","normalize","(","mix","(","xB",",","xA",",","ma",")",")",";"]}]},{TYPE:"node",NAME:"VECT_TRANSFORM",NODE_VARS:[{TYPE:"node_var",NAME:"CONVERT_TYPE",TOKENS:["VT_WORLD_TO_OBJECT"]},{TYPE:"node_var",NAME:"VECTOR_TYPE",TOKENS:["VT_VECTOR"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"xC",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"xD",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["CONVERT_TYPE","VT_WORLD_TO_WORLD",{TYPE:"equal_expr",PLACES:2},"CONVERT_TYPE","VT_OBJECT_TO_OBJECT",{TYPE:"equal_expr",PLACES:2},"CONVERT_TYPE","VT_CAMERA_TO_CAMERA",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:3}],STATEMENTS:[{TYPE:"txt",TOKENS:["xD","=","xC",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["VECTOR_TYPE","VT_POINT",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["CONVERT_TYPE","VT_WORLD_TO_CAMERA",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:["xD","=","ap","(","u_view_tsr_frag",",","xC",")",";"]}]},{TYPE:"node_elif",EXPRESSION:["CONVERT_TYPE","VT_WORLD_TO_OBJECT",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:["xD","=","ap","(","u_model_tsr_inverse",",","xC",")",";"]}]},{TYPE:"node_elif",EXPRESSION:["CONVERT_TYPE","VT_OBJECT_TO_WORLD",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:["xD","=","ap","(","u_model_tsr",",","xC",")",";"]}]},{TYPE:"node_elif",EXPRESSION:["CONVERT_TYPE","VT_OBJECT_TO_CAMERA",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:["xD","=","ap","(","u_model_tsr",",","xC",")",";","xD","=","ap","(","u_view_tsr_frag",",","xD",")",";"]}]},{TYPE:"node_elif",EXPRESSION:["CONVERT_TYPE","VT_CAMERA_TO_WORLD",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:["xD","=","ap","(","u_view_tsr_inverse",",","xC",")",";"]}]},{TYPE:"node_elif",EXPRESSION:["CONVERT_TYPE","VT_CAMERA_TO_OBJECT",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:["xD","=","ap","(","u_view_tsr_inverse",",","xC",")",";","xD","=","ap","(","u_model_tsr_inverse",",","xD",")",";"]}]}]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["CONVERT_TYPE","VT_WORLD_TO_CAMERA",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:["xD","=","_","(","u_view_tsr_frag",",","xC",")",";"]}]},{TYPE:"node_elif",EXPRESSION:["CONVERT_TYPE","VT_WORLD_TO_OBJECT",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:["xD","=","_","(","u_model_tsr_inverse",",","xC",")",";"]}]},{TYPE:"node_elif",EXPRESSION:["CONVERT_TYPE","VT_OBJECT_TO_WORLD",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:["xD","=","_","(","u_model_tsr",",","xC",")",";"]}]},{TYPE:"node_elif",EXPRESSION:["CONVERT_TYPE","VT_OBJECT_TO_CAMERA",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:["xD","=","_","(","u_model_tsr",",","xC",")",";","xD","=","_","(","u_view_tsr_frag",",","xD",")",";"]}]},{TYPE:"node_elif",EXPRESSION:["CONVERT_TYPE","VT_CAMERA_TO_WORLD",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:["xD","=","_","(","u_view_tsr_inverse",",","xC",")",";"]}]},{TYPE:"node_elif",EXPRESSION:["CONVERT_TYPE","VT_CAMERA_TO_OBJECT",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:["xD","=","_","(","u_view_tsr_inverse",",","xC",")",";","xD","=","_","(","u_model_tsr_inverse",",","xD",")",";"]}]}]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["VECTOR_TYPE","VT_NORMAL",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:["xD","=","normalize","(","xD",")",";"]}]}]}]}]}]},{TYPE:"node",NAME:"BLACKBODY",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"xE",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"xF",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["xF","[","0","]","=","xF","[","1","]","=","xF","[","2","]","=","_0_0",";","xE",";"]}]},{TYPE:"node",NAME:"WAVELENGTH",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"xG",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"xH",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["xH","[","0","]","=","xH","[","1","]","=","xH","[","2","]","=","_0_0",";","xG",";"]}]},{TYPE:"node",NAME:"SEPXYZ",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"xI",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"xJ",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"xK",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"xL",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["xJ","=","xI","[","0","]",";","xK","=","xI","[","1","]",";","xL","=","xI","[","2","]",";"]}]},{TYPE:"node",NAME:"COMBXYZ",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"xM",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"xN",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"xO",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"xP",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["xP","[","0","]","=","xM",";","xP","[","1","]","=","xN",";","xP","[","2","]","=","xO",";"]}]},{TYPE:"node",NAME:"BRIGHTCONTRAST",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"xQ",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"xR",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"xS",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"xT",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["float","b","=","xR","-","xS","*","_0_5",";","xT","=","max","(","(","_1_0","+","xS",")","*","xQ","+","b",",","vec3","(","_0_0",")",")",";"]}]},{TYPE:"node",NAME:"LIGHT_FALLOFF",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"xU",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"xV",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"xW",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"xX",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"xY",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["xW","=","xX","=","xY","=","_0_0",";","xU",";","xV",";"]}]},{TYPE:"node",NAME:"TEX_IMAGE",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"Hm",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Hn",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Ho",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["Hn","[","0","]","=","Hn","[","1","]","=","Hn","[","2","]","=","_0_0",";","Ho","=","_1_0",";","Hm",";"]}]},{TYPE:"node",NAME:"TEX_ENVIRONMENT",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"Hp",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Hq",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["Hq","[","0","]","=","Hq","[","1","]","=","Hq","[","2","]","=","_0_0",";","Hp",";"]}]},{TYPE:"node",NAME:"TEX_SKY",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"xZ",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"x_",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["x_","[","0","]","=","x_","[","1","]","=","x_","[","2","]","=","_0_0",";","xZ",";"]}]},{TYPE:"node",NAME:"TEX_NOISE",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"ya",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yb",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yc",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yd",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"ye",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"yf",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["ye","[","0","]","=","ye","[","1","]","=","ye","[","2","]","=","_0_0",";","yf","=","_1_0",";","ya",";","yb",";","yc",";","yd",";"]}]},{TYPE:"node",NAME:"TEX_WAVE",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"yg",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yh",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yi",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yj",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yk",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"yl",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"ym",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["yl","[","0","]","=","yl","[","1","]","=","yl","[","2","]","=","_0_0",";","ym","=","_1_0",";","yg",";","yh",";","yi",";","yj",";","yk",";"]}]},{TYPE:"node",NAME:"TEX_VORONOI",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"yn",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yo",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"yp",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"yq",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["yp","[","0","]","=","yp","[","1","]","=","yp","[","2","]","=","_0_0",";","yq","=","_1_0",";","yn",";","yo",";"]}]},{TYPE:"node",NAME:"TEX_MUSGRAVE",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"yr",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"ys",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yt",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yu",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yv",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yA",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yB",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"yC",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"yD",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["yC","[","0","]","=","yC","[","1","]","=","yC","[","2","]","=","_0_0",";","yD","=","_1_0",";","yr",";","ys",";","yt",";","yu",";","yv",";","yA",";","yB",";"]}]},{TYPE:"node",NAME:"TEX_GRADIENT",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"yE",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"yF",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"yG",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["yF","[","0","]","=","yF","[","1","]","=","yF","[","2","]","=","_0_0",";","yG","=","_1_0",";","yE",";"]}]},{TYPE:"node",NAME:"TEX_MAGIC",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"yH",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yI",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yJ",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"yK",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"yL",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["yK","[","0","]","=","yK","[","1","]","=","yK","[","2","]","=","_0_0",";","yL","=","_1_0",";","yH",";","yI",";","yJ",";"]}]},{TYPE:"node",NAME:"TEX_CHECKER",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"yM",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yN",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yO",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yP",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"yQ",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"yR",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["yQ","[","0","]","=","yQ","[","1","]","=","yQ","[","2","]","=","_0_0",";","yR","=","_1_0",";","yM",";","yN",";","yO",";","yP",";"]}]},{TYPE:"node",NAME:"TEX_BRICK",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"yS",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yT",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yU",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yV",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yW",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yX",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yY",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yZ",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"y_",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"za",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"zb",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["za","[","0","]","=","za","[","1","]","=","za","[","2","]","=","_0_0",";","zb","=","_1_0",";","yS",";","yT",";","yU",";","yV",";","yW",";","yX",";","yY",";","yZ",";","y_",";"]}]},{TYPE:"node",NAME:"ADD_SHADER",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"zc",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"zd",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"ze",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["ze","=","clamp","(","zc","+","zd",",","vec3","(","_0_0",")",",","vec3","(","_1_0",")",")",";"]}]},{TYPE:"node",NAME:"MIX_SHADER",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"zf",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"zg",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"zh",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"zi",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"zj",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"zk",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"zl",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"zm",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"zn",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"zo",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"zp",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"zq",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"zr",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"zs",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"zt",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"zu",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"zv",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"zA",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"zB",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"zC",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"zD",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"zE",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"zF",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"zG",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"zH",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"zI",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"zJ",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"zK",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"zL",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"zM",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"zN",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"zO",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"zP",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"zQ",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["float","zR","=","clamp","(","zf",",","_0_0",",","_1_0",")",";","zH","=","mix","(","zi",",","zs",",","zR",")",";","zI","=","mix","(","zj",",","zt",",","zR",")",";","if","(","zm",">","_0_0",")","{","if","(","zA",">","_0_0",")","{","zJ","=","mix","(","zk",",","zu",",","zR",")",";","zK","=","mix","(","zl",",","zv",",","zR",")",";","}","else","{","zJ","=","zk",";","zK","=","zl",";","}","}","else","{","zJ","=","zu",";","zK","=","zv",";","}","if","(","zp",">","_0_0",")","{","if","(","zD",">","_0_0",")","{","zN","=","mix","(","zo",",","zC",",","zR",")",";","}","else","{","zN","=","zo",";","}","}","else","{","zN","=","zC",";","}","zL","=","mix","(","zm",",","zA",",","zR",")",";","zM","=","mix","(","zn",",","zB",",","zR",")",";","zO","=","mix","(","zp",",","zD",",","zR",")",";","zP","=","mix","(","zq",",","zE",",","zR",")",";","zQ","=","mix","(","zr",",","zF",",","zR",")",";"]}]},{TYPE:"node",NAME:"UV_MERGED",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"zS",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"zT",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_zS"],STATEMENTS:[{TYPE:"txt",TOKENS:["zS","=","rX","(","A",")",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_zT"],STATEMENTS:[{TYPE:"txt",TOKENS:["zT","=","vec3","(","A",",","_0_0",")",";"]}]}]}]},{TYPE:"node",NAME:"TEX_COORD_UV",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"zU",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["zU","=","vec3","(","A",",","_0_0",")",";"]}]},{TYPE:"node",NAME:"TEX_COORD_NO",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"zV",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["zV","=","ot",";"]}]},{TYPE:"node",NAME:"TEX_COORD_GE",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"zW",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["zW","=","vec3","(","A",",","_0_0",")",";"]}]},{TYPE:"node",NAME:"TEX_COORD_OB",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"zX",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["zX","[","0","]","=","zX","[","1","]","=","zX","[","2","]","=","_1_0",";"]}]},{TYPE:"node",NAME:"TEX_COORD_CA",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"zY",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["zY","[","0","]","=","sB","[","0","]",";","zY","[","1","]","=","sB","[","1","]",";","zY","[","2","]","=","_1_0",";"]}]},{TYPE:"node",NAME:"TEX_COORD_WI",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"zZ",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["zZ","[","0","]","=","zZ","[","1","]","=","zZ","[","2","]","=","_1_0",";"]}]},{TYPE:"node",NAME:"TEX_COORD_RE",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"z_",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["z_","[","0","]","=","z_","[","1","]","=","z_","[","2","]","=","_1_0",";"]}]},{TYPE:"node",NAME:"UVMAP",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"Aa",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["Aa","=","vec3","(","A",",","_0_0",")",";"]}]},{TYPE:"node",NAME:"PARTICLE_INFO",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"Ab",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Ac",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Ad",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Ae",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Af",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Ag",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Ah",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_param",NAME:"Hf",QUALIFIER:["GLSL_IN","vec4"],IS_OPTIONAL:!0},{TYPE:"node_param",NAME:"Hg",QUALIFIER:["GLSL_IN","vec3"],IS_OPTIONAL:!0},{TYPE:"node_param",NAME:"Hh",QUALIFIER:["GLSL_IN","vec3"],IS_OPTIONAL:!0},{TYPE:"node_param",NAME:"Hi",QUALIFIER:["GLSL_IN","vec3"],IS_OPTIONAL:!0}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["PARTICLE_BATCH"],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Ab"],STATEMENTS:[{TYPE:"txt",TOKENS:["Ab","=","Hf","[","0","]",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Ac"],STATEMENTS:[{TYPE:"txt",TOKENS:["Ac","=","Hf","[","1","]",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Ad"],STATEMENTS:[{TYPE:"txt",TOKENS:["Ad","=","Hf","[","2","]",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Ae"],STATEMENTS:[{TYPE:"txt",TOKENS:["Ae","=","Hg",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Af"],STATEMENTS:[{TYPE:"txt",TOKENS:["Af","=","Hf","[","3","]",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Ag"],STATEMENTS:[{TYPE:"txt",TOKENS:["Ag","=","Hh",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Ah"],STATEMENTS:[{TYPE:"txt",TOKENS:["Ah","=","Hi",";"]}]}]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["Ab","=","_0_0",";","Ac","=","_0_0",";","Ad","=","_0_0",";","Ae","=","vec3","(","_0_0",")",";","Af","=","_0_0",";","Ag","=","Ae",";","Ah","=","Ae",";"]}]}]}]},{TYPE:"node",NAME:"HAIR_INFO",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"Ai",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Aj",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Ak",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Al",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["Ai","=","_0_0",";","Aj","=","_0_0",";","Ak","=","_0_0",";","Al","=","vec3","(","_0_0",")",";"]}]},{TYPE:"node",NAME:"OBJECT_INFO",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"Am",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"An",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Ao",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Ap",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["An","=","_0_0",";","Ao","=","_0_0",";","Ap","=","_0_0",";","Am","=","vec3","(","_0_0",")",";"]}]},{TYPE:"node",NAME:"WIREFRAME",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"Aq",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Ar",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["Ar","=","Aq",";"]}]},{TYPE:"node",NAME:"TANGENT",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"As",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["As","=","vec3","(","_0_0",")",";"]}]},{TYPE:"node",NAME:"LAYER_WEIGHT",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"Hr",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Hs",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Av",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Aw",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["Av","=","Aw","=","_0_0",";","Hs",";","Hr",";"]}]},{TYPE:"node",NAME:"LIGHT_PATH",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"Ay",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Az",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"AA",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"AB",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"AC",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"AD",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"AE",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"AF",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"AG",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"AH",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["Ay","=","Az","=","AA","=","_0_0",";","AB","=","AC","=","AD","=","_0_0",";","AE","=","AE","=","AG","=","AH","=","_0_0",";","AF","=","_0_0",";"]}]},{TYPE:"node",NAME:"ATTRIBUTE",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"AJ",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"AK",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"AL",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["AJ","=","AK","=","vec3","(","_0_0",")",";","AL","=","_0_0",";"]}]},{TYPE:"node",NAME:"SCRIPT",NODE_VARS:[],DECLARATIONS:[],STATEMENTS:[]},{TYPE:"node",NAME:"CURVE_VEC",NODE_VARS:[{TYPE:"node_var",NAME:"READ_R",TOKENS:["0"]},{TYPE:"node_var",NAME:"READ_G",TOKENS:["0"]},{TYPE:"node_var",NAME:"READ_B",TOKENS:["0"]},{TYPE:"node_var",NAME:"NODE_TEX_ROW",TOKENS:["0.0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"AM",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"AN",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"AO",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["AO","=","AN",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["READ_R"],STATEMENTS:[{TYPE:"txt",TOKENS:["AO",".","r","=","(","GLSL_TEXTURE","(","u_nodes_texture",",","vec2","(","_0_5","*","AN",".","r","+","_0_5",",","NODE_TEX_ROW",")",")",".","r","-","_0_5",")","*","2.0",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["READ_G"],STATEMENTS:[{TYPE:"txt",TOKENS:["AO",".","g","=","(","GLSL_TEXTURE","(","u_nodes_texture",",","vec2","(","_0_5","*","AN",".","g","+","_0_5",",","NODE_TEX_ROW",")",")",".","g","-","_0_5",")","*","2.0",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["READ_B"],STATEMENTS:[{TYPE:"txt",TOKENS:["AO",".","b","=","(","GLSL_TEXTURE","(","u_nodes_texture",",","vec2","(","_0_5","*","AN",".","b","+","_0_5",",","NODE_TEX_ROW",")",")",".","b","-","_0_5",")","*","2.0",";"]}]}]},{TYPE:"txt",TOKENS:["AO","=","mix","(","AN",",","AO",",","AM",")",";"]}]},{TYPE:"node",NAME:"CURVE_RGB",NODE_VARS:[{TYPE:"node_var",NAME:"READ_A",TOKENS:["0"]},{TYPE:"node_var",NAME:"READ_R",TOKENS:["0"]},{TYPE:"node_var",NAME:"READ_G",TOKENS:["0"]},{TYPE:"node_var",NAME:"READ_B",TOKENS:["0"]},{TYPE:"node_var",NAME:"NODE_TEX_ROW",TOKENS:["_0_0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"AP",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"AQ",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"AR",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["READ_A"],STATEMENTS:[{TYPE:"txt",TOKENS:["float","r","=","GLSL_TEXTURE","(","u_nodes_texture",",","vec2","(","AQ",".","r",",","NODE_TEX_ROW",")",")",".","a",";","float","g","=","GLSL_TEXTURE","(","u_nodes_texture",",","vec2","(","AQ",".","g",",","NODE_TEX_ROW",")",")",".","a",";","float","b","=","GLSL_TEXTURE","(","u_nodes_texture",",","vec2","(","AQ",".","b",",","NODE_TEX_ROW",")",")",".","a",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["float","r","=","AQ",".","r",";","float","g","=","AQ",".","g",";","float","b","=","AQ",".","b",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["READ_R"],STATEMENTS:[{TYPE:"txt",TOKENS:["AR",".","r","=","GLSL_TEXTURE","(","u_nodes_texture",",","vec2","(","r",",","NODE_TEX_ROW",")",")",".","r",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["AR",".","r","=","r",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["READ_G"],STATEMENTS:[{TYPE:"txt",TOKENS:["AR",".","g","=","GLSL_TEXTURE","(","u_nodes_texture",",","vec2","(","g",",","NODE_TEX_ROW",")",")",".","g",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["AR",".","g","=","g",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["READ_B"],STATEMENTS:[{TYPE:"txt",TOKENS:["AR",".","b","=","GLSL_TEXTURE","(","u_nodes_texture",",","vec2","(","b",",","NODE_TEX_ROW",")",")",".","b",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["AR",".","b","=","b",";"]}]}]},{TYPE:"txt",TOKENS:["AR","=","mix","(","AQ",",","AR",",","AP",")",";"]}]},{TYPE:"node",NAME:"VALTORGB",NODE_VARS:[{TYPE:"node_var",NAME:"NODE_TEX_ROW",TOKENS:["_0_0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"AS",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"AT",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"AU",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["vec4","AV","=","GLSL_TEXTURE","(","u_nodes_texture",",","vec2","(","AS",",","NODE_TEX_ROW",")",")",";","AT","=","AV",".","rgb",";","AU","=","AV",".","a",";"]}]},{TYPE:"node",NAME:"MAPPING",NODE_VARS:[{TYPE:"node_var",NAME:"MAPPING_SCALE_DEF",TOKENS:["0"]},{TYPE:"node_var",NAME:"MAPPING_SCALE",TOKENS:["vec3","(","_1_0",")"]},{TYPE:"node_var",NAME:"MAPPING_TRANS_DEF",TOKENS:["0"]},{TYPE:"node_var",NAME:"MAPPING_TRANS",TOKENS:["vec3","(","_0_0",")"]},{TYPE:"node_var",NAME:"MAPPING_TRS_MATRIX_DEF",TOKENS:["0"]},{TYPE:"node_var",NAME:"MAPPING_TRS_MATRIX",TOKENS:["mat4","(","_1_0",")"]},{TYPE:"node_var",NAME:"MAPPING_MIN_CLIP_DEF",TOKENS:["0"]},{TYPE:"node_var",NAME:"MAPPING_MIN_CLIP",TOKENS:["vec3","(","_0_0",")"]},{TYPE:"node_var",NAME:"MAPPING_MAX_CLIP_DEF",TOKENS:["0"]},{TYPE:"node_var",NAME:"MAPPING_MAX_CLIP",TOKENS:["vec3","(","_1_0",")"]},{TYPE:"node_var",NAME:"MAPPING_IS_NORMAL",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"AW",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"AX",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["AX","=","AW",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAPPING_SCALE_DEF"],STATEMENTS:[{TYPE:"txt",TOKENS:["AX","=","AX","*","MAPPING_SCALE",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAPPING_TRANS_DEF"],STATEMENTS:[{TYPE:"txt",TOKENS:["AX","=","AX","+","MAPPING_TRANS",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAPPING_TRS_MATRIX_DEF"],STATEMENTS:[{TYPE:"txt",TOKENS:["AX","=","(","MAPPING_TRS_MATRIX","*","vec4","(","AX",",","_1_0",")",")",".","xyz",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAPPING_MIN_CLIP_DEF"],STATEMENTS:[{TYPE:"txt",TOKENS:["AX","=","max","(","AX",",","MAPPING_MIN_CLIP",")",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAPPING_MAX_CLIP_DEF"],STATEMENTS:[{TYPE:"txt",TOKENS:["AX","=","min","(","AX",",","MAPPING_MAX_CLIP",")",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAPPING_IS_NORMAL"],STATEMENTS:[{TYPE:"txt",TOKENS:["AX","=","normalize","(","AX",")",";"]}]}]}]},{TYPE:"node",NAME:"MATH_ADD",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"AY",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"AZ",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"A_",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["A_","=","AY","+","AZ",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["A_","=","clamp","(","A_",",","_0_0",",","_1_0",")",";"]}]}]}]},{TYPE:"node",NAME:"MATH_SUBTRACT",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"Ba",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Bb",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Bc",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["Bc","=","Ba","-","Bb",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["Bc","=","clamp","(","Bc",",","_0_0",",","_1_0",")",";"]}]}]}]},{TYPE:"node",NAME:"MATH_MULTIPLY",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"Bd",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Be",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Bf",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["Bf","=","Bd","*","Be",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["Bf","=","clamp","(","Bf",",","_0_0",",","_1_0",")",";"]}]}]}]},{TYPE:"node",NAME:"MATH_DIVIDE",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"Bg",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Bh",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Bi",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["Bi","=","(","Bh","!=","_0_0",")","?","Bg","/","Bh",":","_0_0",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["Bi","=","clamp","(","Bi",",","_0_0",",","_1_0",")",";"]}]}]}]},{TYPE:"node",NAME:"MATH_SINE",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"Bj",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Bk",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Bl",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["Bl","=","sin","(","Bj",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["Bl","=","clamp","(","Bl",",","_0_0",",","_1_0",")",";"]}]}]},{TYPE:"txt",TOKENS:["Bk",";"]}]},{TYPE:"node",NAME:"MATH_COSINE",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"Bm",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Bn",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Bo",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["Bo","=","cos","(","Bm",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["Bo","=","clamp","(","Bo",",","_0_0",",","_1_0",")",";"]}]}]},{TYPE:"txt",TOKENS:["Bn",";"]}]},{TYPE:"node",NAME:"MATH_TANGENT",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"Bp",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Bq",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Br",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["Br","=","tan","(","Bp",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["Br","=","clamp","(","Br",",","_0_0",",","_1_0",")",";"]}]}]},{TYPE:"txt",TOKENS:["Bq",";"]}]},{TYPE:"node",NAME:"MATH_ARCSINE",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"Bs",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Bt",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Bu",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["Bu","=","(","Bs","<=","_1_0","&&","Bs",">=","-","_1_0",")","?","asin","(","Bs",")",":","_0_0",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["Bu","=","clamp","(","Bu",",","_0_0",",","_1_0",")",";"]}]}]},{TYPE:"txt",TOKENS:["Bt",";"]}]},{TYPE:"node",NAME:"MATH_ARCCOSINE",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"Bv",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Bw",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Bx",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["Bx","=","(","Bv","<=","_1_0","&&","Bv",">=","-","_1_0",")","?","acos","(","Bv",")",":","_0_0",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["Bx","=","clamp","(","Bx",",","_0_0",",","_1_0",")",";"]}]}]},{TYPE:"txt",TOKENS:["Bw",";"]}]},{TYPE:"node",NAME:"MATH_ARCTANGENT",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"By",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Bz",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"BA",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["BA","=","atan","(","By",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["BA","=","clamp","(","BA",",","_0_0",",","_1_0",")",";"]}]}]},{TYPE:"txt",TOKENS:["Bz",";"]}]},{TYPE:"node",NAME:"MATH_POWER",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"BB",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"BC",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"BD",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["if","(","BB","<","_0_0","&&","BC","!=","floor","(","BC",")",")","BD","=","_0_0",";","else","if","(","BC","==","_0_0",")","BD","=","_1_0",";","else","if","(","BB","<","_0_0",")","BD","=","mix","(","_1_0",",","-","_1_0",",","sign","(","mod","(","-","BC",",","2.0",")",")",")","*","pow","(","-","BB",",","BC",")",";","else","if","(","BB","==","_0_0",")","BD","=","_0_0",";","else","BD","=","pow","(","BB",",","BC",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["BD","=","clamp","(","BD",",","_0_0",",","_1_0",")",";"]}]}]}]},{TYPE:"node",NAME:"MATH_LOGARITHM",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"BE",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"BF",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"BG",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["BG","=","(","BE",">","_0_0","&&","BF",">","_0_0",")","?","log2","(","BE",")","/","log2","(","BF",")",":","_0_0",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["BG","=","clamp","(","BG",",","_0_0",",","_1_0",")",";"]}]}]}]},{TYPE:"node",NAME:"MATH_MINIMUM",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"BH",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"BI",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"BJ",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["BJ","=","min","(","BH",",","BI",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["BJ","=","clamp","(","BJ",",","_0_0",",","_1_0",")",";"]}]}]}]},{TYPE:"node",NAME:"MATH_MAXIMUM",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"BK",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"BL",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"BM",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["BM","=","max","(","BK",",","BL",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["BM","=","clamp","(","BM",",","_0_0",",","_1_0",")",";"]}]}]}]},{TYPE:"node",NAME:"MATH_ROUND",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"BN",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"BO",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"BP",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["BP","=","floor","(","BN","+","_0_5",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["BP","=","clamp","(","BP",",","_0_0",",","_1_0",")",";"]}]}]},{TYPE:"txt",TOKENS:["BO",";"]}]},{TYPE:"node",NAME:"MATH_LESS_THAN",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"BQ",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"BR",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"BS",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["BS","=","(","BQ","<","BR",")","?","_1_0",":","_0_0",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["BS","=","clamp","(","BS",",","_0_0",",","_1_0",")",";"]}]}]}]},{TYPE:"node",NAME:"MATH_GREATER_THAN",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"BT",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"BU",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"BV",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["BV","=","(","BT",">","BU",")","?","_1_0",":","_0_0",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["BV","=","clamp","(","BV",",","_0_0",",","_1_0",")",";"]}]}]}]},{TYPE:"node",NAME:"MATH_MODULO",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"BW",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"BX",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"BY",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["BY","=","abs","(","BX",")",">","0.000001","?","mod","(","BW",",","BX",")",":","_0_0",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["BY","=","clamp","(","BY",",","_0_0",",","_1_0",")",";"]}]}]}]},{TYPE:"node",NAME:"MATH_ABSOLUTE",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"BZ",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"B_",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Ca",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["Ca","=","abs","(","BZ",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["Ca","=","clamp","(","Ca",",","_0_0",",","_1_0",")",";"]}]}]},{TYPE:"txt",TOKENS:["B_",";"]}]},{TYPE:"node",NAME:"MIX_RGB_MIX",NODE_VARS:[{TYPE:"node_var",NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"Cb",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Cc",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Cd",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Ce",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["float","zR","=","clamp","(","Cb",",","_0_0",",","_1_0",")",";","Ce","=","mix","(","Cc",",","Cd",",","zR",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["Ce","=","clamp","(","Ce",",","_0_0",",","_1_0",")",";"]}]}]}]},{TYPE:"node",NAME:"MIX_RGB_ADD",NODE_VARS:[{TYPE:"node_var",NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"Cf",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Cg",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Ch",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Ci",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["float","zR","=","clamp","(","Cf",",","_0_0",",","_1_0",")",";","Ci","=","mix","(","Cg",",","Cg","+","Ch",",","zR",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["Ci","=","clamp","(","Ci",",","_0_0",",","_1_0",")",";"]}]}]}]},{TYPE:"node",NAME:"MIX_RGB_MULTIPLY",NODE_VARS:[{TYPE:"node_var",NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"Cj",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Ck",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Cl",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Cm",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["float","zR","=","clamp","(","Cj",",","_0_0",",","_1_0",")",";","Cm","=","mix","(","Ck",",","Ck","*","Cl",",","zR",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["Cm","=","clamp","(","Cm",",","_0_0",",","_1_0",")",";"]}]}]}]},{TYPE:"node",NAME:"MIX_RGB_SUBTRACT",NODE_VARS:[{TYPE:"node_var",NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"Cn",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Co",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Cp",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Cq",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["float","zR","=","clamp","(","Cn",",","_0_0",",","_1_0",")",";","Cq","=","mix","(","Co",",","Co","-","Cp",",","zR",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["Cq","=","clamp","(","Cq",",","_0_0",",","_1_0",")",";"]}]}]}]},{TYPE:"node",NAME:"MIX_RGB_SCREEN",NODE_VARS:[{TYPE:"node_var",NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"Cr",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Cs",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Ct",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Cu",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["float","zR","=","clamp","(","Cr",",","_0_0",",","_1_0",")",";","float","Cv","=","_1_0","-","zR",";","Cu","=","vec3","(","_1_0",")","-","(","vec3","(","Cv",")","+","zR","*","(","vec3","(","_1_0",")","-","Ct",")",")","*","(","vec3","(","_1_0",")","-","Cs",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["Cu","=","clamp","(","Cu",",","_0_0",",","_1_0",")",";"]}]}]}]},{TYPE:"node",NAME:"MIX_RGB_DIVIDE",NODE_VARS:[{TYPE:"node_var",NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"Cw",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Cx",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Cy",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Cz",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["float","zR","=","clamp","(","Cw",",","_0_0",",","_1_0",")",";","float","Cv","=","_1_0","-","zR",";","Cy","+=","step","(","Cy",",","vec3","(","_0_0",")",")",";","Cz","=","Cv","*","Cx","+","zR","*","Cx","/","Cy",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["Cz","=","clamp","(","Cz",",","_0_0",",","_1_0",")",";"]}]}]}]},{TYPE:"node",NAME:"MIX_RGB_DIFFERENCE",NODE_VARS:[{TYPE:"node_var",NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"CA",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"CB",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"CC",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"CD",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["float","zR","=","clamp","(","CA",",","_0_0",",","_1_0",")",";","CD","=","mix","(","CB",",","abs","(","CB","-","CC",")",",","zR",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["CD","=","clamp","(","CD",",","_0_0",",","_1_0",")",";"]}]}]}]},{TYPE:"node",NAME:"MIX_RGB_DARKEN",NODE_VARS:[{TYPE:"node_var",NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"CE",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"CF",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"CG",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"CH",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["float","zR","=","clamp","(","CE",",","_0_0",",","_1_0",")",";","CH","=","min","(","CF",".","rgb",",","CG",".","rgb","*","zR",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["CH","=","clamp","(","CH",",","_0_0",",","_1_0",")",";"]}]}]}]},{TYPE:"node",NAME:"MIX_RGB_LIGHTEN",NODE_VARS:[{TYPE:"node_var",NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"CI",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"CJ",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"CK",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"CL",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["float","zR","=","clamp","(","CI",",","_0_0",",","_1_0",")",";","CL","=","max","(","CJ",".","rgb",",","CK",".","rgb","*","zR",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["CL","=","clamp","(","CL",",","_0_0",",","_1_0",")",";"]}]}]}]},{TYPE:"node",NAME:"MIX_RGB_OVERLAY",NODE_VARS:[{TYPE:"node_var",NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"CM",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"CN",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"CO",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"CP",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["float","zR","=","clamp","(","CM",",","_0_0",",","_1_0",")",";","vec3","CQ","=","vec3","(","_1_0","-","zR",")",";","CP","=","mix","(","CN","*","(","CQ","+","2.0","*","zR","*","CO",")",",","vec3","(","_1_0",")","-","(","CQ","+","2.0","*","zR","*","(","vec3","(","_1_0",")","-","CO",")",")","*","(","vec3","(","_1_0",")","-","CN",")",",","step","(","_0_5",",","CN",")",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["CP","=","clamp","(","CP",",","_0_0",",","_1_0",")",";"]}]}]}]},{TYPE:"node",NAME:"MIX_RGB_DODGE",NODE_VARS:[{TYPE:"node_var",NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"CR",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"CS",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"CT",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"CU",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["float","zR","=","clamp","(","CR",",","_0_0",",","_1_0",")",";","vec3","CV","=","vec3","(","_1_0",")","-","zR","*","CT",";","vec3","CW","=","clamp","(","CS","/","CV",",","_0_0",",","_1_0",")",";","CU","=","mix","(","mix","(","CW",",","vec3","(","_1_0",")",",","step","(","CV",",","vec3","(","_0_0",")",")",")",",","CS",",","step","(","CS",",","vec3","(","_0_0",")",")",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["CU","=","clamp","(","CU",",","_0_0",",","_1_0",")",";"]}]}]}]},{TYPE:"node",NAME:"MIX_RGB_BURN",NODE_VARS:[{TYPE:"node_var",NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"CX",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"CY",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"CZ",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"C_",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["float","zR","=","clamp","(","CX",",","_0_0",",","_1_0",")",";","vec3","ko","=","vec3","(","_1_0","-","zR",")",";","vec3","CV","=","ko","+","zR","*","CZ",";","vec3","CW","=","clamp","(","vec3","(","_1_0",")","-","(","vec3","(","_1_0",")","-","CY",")","/","CV",",","_0_0",",","_1_0",")",";","C_","=","mix","(","CW",",","vec3","(","_0_0",")",",","step","(","CV",",","vec3","(","_0_0",")",")",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["C_","=","clamp","(","C_",",","_0_0",",","_1_0",")",";"]}]}]}]},{TYPE:"node",NAME:"MIX_RGB_HUE",NODE_VARS:[{TYPE:"node_var",NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"Da",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Db",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Dc",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Dd",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["float","zR","=","clamp","(","Da",",","_0_0",",","_1_0",")",";","vec3","kg",",","De",",","CV",";","Dd","=","Db",";","De","=","kf","(","Dc",")",";","if","(","De",".","y","!=","_0_0",")","{","kg","=","kf","(","Dd",")",";","kg",".","x","=","De",".","x",";","CV","=","kh","(","kg",")",";","Dd","=","mix","(","Dd",",","CV",",","zR",")",";","}"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["Dd","=","clamp","(","Dd",",","_0_0",",","_1_0",")",";"]}]}]}]},{TYPE:"node",NAME:"MIX_RGB_SATURATION",NODE_VARS:[{TYPE:"node_var",NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"Df",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Dg",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Dh",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Di",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["float","zR","=","clamp","(","Df",",","_0_0",",","_1_0",")",";","float","Cv","=","_1_0","-","zR",";","Di","=","Dg",";","vec3","kg",",","De",";","kg","=","kf","(","Di",")",";","if","(","kg",".","y","!=","_0_0",")","{","De","=","kf","(","Dh",")",";","kg",".","y","=","Cv","*","kg",".","y","+","zR","*","De",".","y",";","Di","=","kh","(","kg",")",";","}"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["Di","=","clamp","(","Di",",","_0_0",",","_1_0",")",";"]}]}]}]},{TYPE:"node",NAME:"MIX_RGB_VALUE",NODE_VARS:[{TYPE:"node_var",NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"Dj",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Dk",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Dl",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Dm",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["float","zR","=","clamp","(","Dj",",","_0_0",",","_1_0",")",";","float","Cv","=","_1_0","-","zR",";","vec3","kg",",","De",";","kg","=","kf","(","Dk",")",";","De","=","kf","(","Dl",")",";","kg",".","z","=","Cv","*","kg",".","z","+","zR","*","De",".","z",";","Dm","=","kh","(","kg",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["Dm","=","clamp","(","Dm",",","_0_0",",","_1_0",")",";"]}]}]}]},{TYPE:"node",NAME:"MIX_RGB_COLOR",NODE_VARS:[{TYPE:"node_var",NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"Dn",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Do",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Dp",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Dq",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["float","zR","=","clamp","(","Dn",",","_0_0",",","_1_0",")",";","vec3","kg",",","De",",","CV",";","Dq","=","Do",";","De","=","kf","(","Dp",")",";","if","(","De",".","y","!=","_0_0",")","{","kg","=","kf","(","Dq",")",";","kg",".","x","=","De",".","x",";","kg",".","y","=","De",".","y",";","CV","=","kh","(","kg",")",";","Dq","=","mix","(","Dq",",","CV",",","zR",")",";","}"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["Dq","=","clamp","(","Dq",",","_0_0",",","_1_0",")",";"]}]}]}]},{TYPE:"node",NAME:"MIX_RGB_SOFT_LIGHT",NODE_VARS:[{TYPE:"node_var",NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"Dr",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Ds",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Dt",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Du",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["float","zR","=","clamp","(","Dr",",","_0_0",",","_1_0",")",";","float","Cv","=","_1_0","-","zR",";","vec3","Dv","=","Dt","+","Ds","-","Dt","*","Ds",";","Du","=","Ds","*","(","vec3","(","Cv",")","+","vec3","(","zR",")","*","(","(","vec3","(","_1_0",")","-","Ds",")","*","Dt","+","Dv",")",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["Du","=","clamp","(","Du",",","_0_0",",","_1_0",")",";"]}]}]}]},{TYPE:"node",NAME:"MIX_RGB_LINEAR_LIGHT",NODE_VARS:[{TYPE:"node_var",NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"Dw",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Dx",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Dy",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Dz",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["float","zR","=","clamp","(","Dw",",","_0_0",",","_1_0",")",";","Dz","=","Dx","+","zR","*","(","2.0","*","Dy","-","vec3","(","_1_0",")",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:["Dz","=","clamp","(","Dz",",","_0_0",",","_1_0",")",";"]}]}]}]},{TYPE:"node",NAME:"OUTPUT",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"DI",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"DJ",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["E","=","DI",";","I","=","DJ",";"]}]},{TYPE:"node",NAME:"OUTPUT_SURFACE",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"DK",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["E","=","DK",";","I","=","_1_0",";"]}]},{TYPE:"node",NAME:"MATERIAL_BEGIN",NODE_VARS:[{TYPE:"node_var",NAME:"MATERIAL_EXT",TOKENS:["0"]},{TYPE:"node_var",NAME:"USE_MATERIAL_NORMAL",TOKENS:["0"]},{TYPE:"node_var",NAME:"USE_MATERIAL_DIFFUSE",TOKENS:["0"]},{TYPE:"node_var",NAME:"SHADELESS_MAT",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"DN",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"DO",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"DP",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"DQ",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_in",NAME:"DR",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"DS",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"DT",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"DU",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"DV",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"DW",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"DX",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"DY",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"DZ",QUALIFIER:["vec4"],IS_OPTIONAL:!1},{TYPE:"node_param",NAME:"sl",QUALIFIER:["const","vec2"],IS_OPTIONAL:!0},{TYPE:"node_param",NAME:"sm",QUALIFIER:["const","vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["DU","=","clamp","(","DN",",","_0_0",",","_1_0",")",";","DV","=","sm","[","0","]","*","clamp","(","DO",",","_0_0",",","_1_0",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_MATERIAL_NORMAL"],STATEMENTS:[{TYPE:"txt",TOKENS:["DW","=","normalize","(","DQ",")",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["DW","=","ot",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["SHADELESS_MAT",{TYPE:"logic_negative_expr",PLACES:1}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATERIAL_EXT"],STATEMENTS:[{TYPE:"txt",TOKENS:["DS","=","DR","*","DU",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["DS","=","sC","*","DU",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_MATERIAL_DIFFUSE"],STATEMENTS:[{TYPE:"txt",TOKENS:["DU","*=","DP",";"]}]}]},{TYPE:"txt",TOKENS:["DT","=","sD","*","u_environment_energy","*","cz","(","DW",")",";","DZ","=","vec4","(","_1_0",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["NUM_LIGHTS",0,{TYPE:"g_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:["DX","=","vec2","(","sl","[","0","]",",","sl","[","1","]",")",";","DY","=","vec2","(","sm","[","1","]",",","sm","[","2","]",")",";"]}]}]},{TYPE:"txt",TOKENS:["H","=","DZ",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["DS","=","vec3","(","_0_0",")",";","DT","=","vec3","(","_1_0",")",";"]}]}]}]},{TYPE:"node",NAME:"MATERIAL_END",NODE_VARS:[{TYPE:"node_var",NAME:"MATERIAL_EXT",TOKENS:["0"]},{TYPE:"node_var",NAME:"USE_MATERIAL_DIFFUSE",TOKENS:["0"]},{TYPE:"node_var",NAME:"USE_MATERIAL_SPECULAR",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"D_",QUALIFIER:["vec4"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Ea",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Eb",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Ec",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_in",NAME:"Ed",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_in",NAME:"Ee",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"Ef",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"Eg",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"Eh",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"Ei",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"Ej",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_param",NAME:"sn",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_param",NAME:"so",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["Ec",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Ef"],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_MATERIAL_DIFFUSE"],STATEMENTS:[{TYPE:"txt",TOKENS:["Ef","=","D_",".","rgb",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["Ef","=","vec3","(","_0_0",")",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_MATERIAL_SPECULAR"],STATEMENTS:[{TYPE:"txt",TOKENS:["Ef","+=","Ea",";"]}]}]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Eh"],STATEMENTS:[{TYPE:"txt",TOKENS:["Eh","=","Eb",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATERIAL_EXT"],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Ei"],STATEMENTS:[{TYPE:"txt",TOKENS:["Ei","=","D_",".","rgb",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Ej"],STATEMENTS:[{TYPE:"txt",TOKENS:["Ej","=","Ea",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Eg"],STATEMENTS:[{TYPE:"txt",TOKENS:["Eg","=","clamp","(","Ee",",","_0_0",",","_1_0",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_MATERIAL_SPECULAR"],STATEMENTS:[{TYPE:"txt",TOKENS:["float","t","=","max","(","max","(","Ea",".","r",",","Ea",".","g",")",",","Ea",".","b",")","*","Ed",";","Eg","=","clamp","(","Ee","*","(","_1_0","-","t",")","+","t",",","_0_0",",","_1_0",")",";"]}]}]}]}]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Eg"],STATEMENTS:[{TYPE:"txt",TOKENS:["Eg","=","clamp","(","sn",",","_0_0",",","_1_0",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_MATERIAL_SPECULAR"],STATEMENTS:[{TYPE:"txt",TOKENS:["float","t","=","max","(","max","(","Ea",".","r",",","Ea",".","g",")",",","Ea",".","b",")","*","so",";","Eg","=","sn","*","(","_1_0","-","t",")","+","t",";"]}]}]}]}]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_MATERIAL_SPECULAR"],STATEMENTS:[{TYPE:"txt",TOKENS:["F","=","Ea",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["F","=","vec3","(","_0_0",")",";"]}]}]},{TYPE:"txt",TOKENS:["G","=","Eb",";"]}]},{TYPE:"node",NAME:"LIGHTING_AMBIENT",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"oL",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"oM",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"oN",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"oO",QUALIFIER:["vec4"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"oP",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["oO","=","vec4","(","oL","+","oN","*","oM",",","_0_0",")",";","oP","=","vec3","(","_0_0",")",";"]}]},{TYPE:"node",NAME:"LIGHTING_LAMP",NODE_VARS:[{TYPE:"node_var",NAME:"LAMP_TYPE",TOKENS:["HEMI"]},{TYPE:"node_var",NAME:"LAMP_IND",TOKENS:["0"]},{TYPE:"node_var",NAME:"LAMP_SPOT_SIZE",TOKENS:["0.8"]},{TYPE:"node_var",NAME:"LAMP_SPOT_BLEND",TOKENS:["0.03"]},{TYPE:"node_var",NAME:"LAMP_LIGHT_DIST",TOKENS:["30.0"]},{TYPE:"node_var",NAME:"LAMP_SHADOW_MAP_IND",TOKENS:["-","1"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"oQ",QUALIFIER:["vec4"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"oR",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"oS",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"oT",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"oU",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["oS","=","vec2","(","u_light_positions","[","LAMP_IND","]",".","w",",","u_light_color_intensities","[","LAMP_IND","]",".","w",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["LAMP_TYPE","HEMI",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:["oU","=","_0_5",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["oU","=","_0_0",";"]}]}]},{TYPE:"txt",TOKENS:["oT","=","u_light_color_intensities","[","LAMP_IND","]",".","xyz",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["LAMP_SHADOW_MAP_IND",1,{TYPE:"negative_expr",PLACES:1},{TYPE:"non_equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:["oT","*=","oQ","[","LAMP_SHADOW_MAP_IND","]",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["LAMP_TYPE","SPOT",{TYPE:"equal_expr",PLACES:2},"LAMP_TYPE","POINT",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:["vec3","oV","=","u_light_positions","[","LAMP_IND","]",".","xyz",";","oR","=","oV","-","os",";","float","aM","=","length","(","oR",")",";","oT","*=","LAMP_LIGHT_DIST","/","(","LAMP_LIGHT_DIST","+","aM","*","aM",")",";","oR","=","normalize","(","oR",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["LAMP_TYPE","SPOT",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:["vec3","oX","=","u_light_directions","[","LAMP_IND","]",";","float","oY","=","dot","(","oR",",","oX",")",";","oY","*=","smoothstep","(","_0_0",",","_1_0",",","(","oY","-","LAMP_SPOT_SIZE",")","/","LAMP_SPOT_BLEND",")",";","oT","*=","oY",";"]}]}]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["oR","=","u_light_directions","[","LAMP_IND","]",";"]}]}]}]},{TYPE:"node",NAME:"DIFFUSE_FRESNEL",NODE_VARS:[{TYPE:"node_var",NAME:"MAT_USE_TBN_SHADING",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"oZ",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"o_",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pa",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pb",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pc",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"pd",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAT_USE_TBN_SHADING"],STATEMENTS:[{TYPE:"txt",TOKENS:["vec3","pe","=","cross","(","oZ",",","k",".","xyz",")",";","pa","=","cross","(","pe",",","k",".","xyz",")",";","pa","=","-","normalize","(","pa",")",";"]}]}]},{TYPE:"txt",TOKENS:["pd","=","_0_0",";","if","(","o_",".","r","!=","_0_0",")","{","float","pf","=","(","_1_0","-","pb",")","*","dot","(","pa",",","oZ",")","+","pb",";","if","(","pc","[","0","]","==","_0_0",")","{","pd","=","_1_0",";","}","else","{","float","t","=","_1_0","+","abs","(","pf",")",";","t","=","pc","[","1","]","+","(","_1_0","-","pc","[","1","]",")","*","pow","(","t",",","pc","[","0","]",")",";","pd","=","clamp","(","t",",","_0_0",",","_1_0",")",";","}","pd","=","max","(","pd",",","_0_0",")",";","}"]}]},{TYPE:"node",NAME:"DIFFUSE_LAMBERT",NODE_VARS:[{TYPE:"node_var",NAME:"MAT_USE_TBN_SHADING",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"pg",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"ph",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pi",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pj",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"pk",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAT_USE_TBN_SHADING"],STATEMENTS:[{TYPE:"txt",TOKENS:["vec3","pe","=","cross","(","pg",",","k",".","xyz",")",";","pi","=","cross","(","pe",",","k",".","xyz",")",";","pi","=","-","normalize","(","pi",")",";"]}]}]},{TYPE:"txt",TOKENS:["pk","=","_0_0",";","if","(","ph",".","r","!=","_0_0",")","{","float","pf","=","(","_1_0","-","pj",")","*","dot","(","pi",",","pg",")","+","pj",";","pk","=","max","(","pf",",","_0_0",")",";","}"]}]},{TYPE:"node",NAME:"DIFFUSE_OREN_NAYAR",NODE_VARS:[{TYPE:"node_var",NAME:"MAT_USE_TBN_SHADING",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"pl",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pm",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pn",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"po",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pr",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"pu",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAT_USE_TBN_SHADING"],STATEMENTS:[{TYPE:"txt",TOKENS:["vec3","pe","=","cross","(","pl",",","k",".","xyz",")",";","pn","=","cross","(","pe",",","k",".","xyz",")",";","pn","=","-","normalize","(","pn",")",";"]}]}]},{TYPE:"txt",TOKENS:["pu","=","_0_0",";","if","(","pm",".","r","!=","_0_0",")","{","float","pf","=","(","_1_0","-","po",")","*","dot","(","pn",",","pl",")","+","po",";","if","(","pr","[","0","]",">","_0_0",")","{","float","pv","=","max","(","dot","(","pn",",","ou",")",",","_0_0",")",";","float","pw","=","pr","[","0","]","*","pr","[","0","]",";","float","cB","=","_1_0","-","_0_5","*","(","pw","/","(","pw","+","0.33",")",")",";","vec3","px","=","pl","-","pf","*","pn",";","vec3","py","=","ou","-","pv","*","pn",";","if","(","length","(","px",")","==","_0_0","||","length","(","py",")","==","_0_0","||","abs","(","pf",")",">","_1_0","||","abs","(","pv",")",">","_1_0",")","pu","=","pf","*","cB",";","else","{","float","pz","=","acos","(","pf",")",";","float","pA","=","acos","(","pv",")",";","vec3","pB","=","normalize","(","px",")",";","vec3","pC","=","normalize","(","py",")",";","float","a",",","b",";","a","=","max","(","pz",",","pA",")",";","b","=","min","(","pz",",","pA",")",";","b","*=","0.95",";","float","t","=","max","(","dot","(","pB",",","pC",")",",","_0_0",")",";","float","hO","=","0.45","*","(","pw","/","(","pw","+","0.09",")",")",";","pu","=","pf","*","(","cB","+","(","hO","*","t","*","sin","(","a",")","*","tan","(","b",")",")",")",";","}","}","else","pu","=","pf",";","pu","=","max","(","pu",",","_0_0",")",";","}"]}]},{TYPE:"node",NAME:"DIFFUSE_MINNAERT",NODE_VARS:[{TYPE:"node_var",NAME:"MAT_USE_TBN_SHADING",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"pD",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pE",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pF",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pG",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pH",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"pI",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAT_USE_TBN_SHADING"],STATEMENTS:[{TYPE:"txt",TOKENS:["vec3","pe","=","cross","(","pD",",","k",".","xyz",")",";","pF","=","cross","(","pe",",","k",".","xyz",")",";","pF","=","-","normalize","(","pF",")",";"]}]}]},{TYPE:"txt",TOKENS:["pI","=","_0_0",";","if","(","pE",".","r","!=","_0_0",")","{","float","pf","=","(","_1_0","-","pG",")","*","dot","(","pF",",","pD",")","+","pG",";","float","pv","=","max","(","dot","(","pF",",","ou",")",",","_0_0",")",";","if","(","pH","[","0","]","<=","_1_0",")","pI","=","pf","*","pow","(","max","(","pv","*","pf",",","0.1",")",",","pH","[","0","]","-","_1_0",")",";","else","pI","=","pf","*","pow","(","1.0001","-","pv",",","pH","[","0","]","-","_1_0",")",";","pI","=","max","(","pI",",","_0_0",")",";","}"]}]},{TYPE:"node",NAME:"DIFFUSE_TOON",NODE_VARS:[{TYPE:"node_var",NAME:"MAT_USE_TBN_SHADING",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"pJ",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pK",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pL",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pM",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pN",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"pO",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAT_USE_TBN_SHADING"],STATEMENTS:[{TYPE:"txt",TOKENS:["vec3","pe","=","cross","(","pJ",",","k",".","xyz",")",";","pL","=","cross","(","pe",",","k",".","xyz",")",";","pL","=","-","normalize","(","pL",")",";"]}]}]},{TYPE:"txt",TOKENS:["pO","=","_0_0",";","if","(","pK",".","r","!=","_0_0",")","{","float","pf","=","(","_1_0","-","pM",")","*","dot","(","pL",",","pJ",")","+","pM",";","float","pP","=","acos","(","pf",")",";","if","(","pP","<","pN","[","0","]",")","pO","=","_1_0",";","else","if","(","pP",">","(","pN","[","0","]","+","pN","[","1","]",")","||","pN","[","1","]","==","_0_0",")","pO","=","_0_0",";","else","pO","=","_1_0","-","(","(","pP","-","pN","[","0","]",")","/","pN","[","1","]",")",";","pO","=","max","(","pO",",","_0_0",")",";","}"]}]},{TYPE:"node",NAME:"SPECULAR_PHONG",NODE_VARS:[{TYPE:"node_var",NAME:"MAT_USE_TBN_SHADING",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"pQ",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pR",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pS",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pT",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pU",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"pV",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["pV","=","_0_0",";","if","(","pR",".","g","==","_1_0",")","{","vec3","pW","=","normalize","(","pQ","+","ou",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAT_USE_TBN_SHADING"],STATEMENTS:[{TYPE:"txt",TOKENS:["if","(","pT","==","_0_0",")","{","pV","=","dot","(","k",".","xyz",",","pW",")",";","pV","=","sqrt","(","_1_0","-","pV","*","pV",")",";","}"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["pV","=","(","_1_0","-","pT",")","*","max","(","dot","(","pS",",","pW",")",",","_0_0",")","+","pT",";"]}]}]},{TYPE:"txt",TOKENS:["pV","=","pow","(","pV",",","pU","[","0","]",")",";","}"]}]},{TYPE:"node",NAME:"SPECULAR_COOKTORR",NODE_VARS:[{TYPE:"node_var",NAME:"MAT_USE_TBN_SHADING",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"pX",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pY",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pZ",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"p_",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qa",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"qb",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["qb","=","_0_0",";","if","(","pY",".","g","!=","_0_0",")","{","vec3","pW","=","normalize","(","pX","+","ou",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAT_USE_TBN_SHADING"],STATEMENTS:[{TYPE:"txt",TOKENS:["if","(","p_","==","_0_0",")","{","qb","=","dot","(","B",".","xyz",",","pW",")",";","qb","=","sqrt","(","_1_0","-","qb","*","qb",")",";","}"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["qb","=","max","(","dot","(","pZ",",","pW",")",",","_0_0",")",";","qb","=","(","_1_0","-","p_",")","*","qb","+","p_",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAT_USE_TBN_SHADING"],STATEMENTS:[{TYPE:"txt",TOKENS:["float","pv","=","max","(","dot","(","B",".","xyz",",","ou",")",",","_0_0",")",";","pv","=","sqrt","(","_1_0","-","pv","*","pv",")",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["float","pv","=","max","(","dot","(","pZ",",","ou",")",",","_0_0",")",";"]}]}]},{TYPE:"txt",TOKENS:["qb","=","pow","(","qb",",","qa","[","0","]",")",";","qb","=","qb","/","(","0.1","+","pv",")",";","}"]}]},{TYPE:"node",NAME:"SPECULAR_WARDISO",NODE_VARS:[{TYPE:"node_var",NAME:"MAT_USE_TBN_SHADING",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"qc",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qd",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qe",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qf",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qg",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"qh",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["qh","=","_0_0",";","if","(","qd",".","g","==","_1_0",")","{","vec3","pW","=","normalize","(","qc","+","ou",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAT_USE_TBN_SHADING"],STATEMENTS:[{TYPE:"txt",TOKENS:["float","qi","=","_0_0",";","float","pv","=","_0_0",";","float","qj","=","_0_0",";","if","(","qf","==","_0_0",")","{","qi","=","dot","(","k",".","xyz",",","pW",")",";","pv","=","dot","(","k",".","xyz",",","ou",")",";","qj","=","dot","(","k",".","xyz",",","qc",")",";","qi","=","sqrt","(","_1_0","-","qi","*","qi",")",";","pv","=","sqrt","(","_1_0","-","pv","*","pv",")",";","qj","=","sqrt","(","_1_0","-","qj","*","qj",")",";","}"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["float","qi","=","max","(","dot","(","qe",",","pW",")",",","0.01",")",";","float","pv","=","max","(","dot","(","qe",",","ou",")",",","0.01",")",";","float","qj","=","max","(","dot","(","qe",",","qc",")",",","0.01",")",";"]}]}]},{TYPE:"txt",TOKENS:["float","bK","=","tan","(","acos","(","qi",")",")",";","float","L","=","max","(","qg","[","0","]",",","0.01",")",";","qh","=","qj","*","(","_1_0","/","(","4.0","*","M_PI","*","L","*","L",")",")","*","(","exp","(","-","(","bK","*","bK",")","/","(","L","*","L",")",")","/","(","sqrt","(","pv","*","qj",")",")",")",";","}"]}]},{TYPE:"node",NAME:"SPECULAR_TOON",NODE_VARS:[{TYPE:"node_var",NAME:"MAT_USE_TBN_SHADING",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"qk",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"ql",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qm",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qn",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qo",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"qr",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["qr","=","_0_0",";","if","(","ql",".","g","==","_1_0",")","{","vec3","cj","=","normalize","(","qk","+","ou",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAT_USE_TBN_SHADING"],STATEMENTS:[{TYPE:"txt",TOKENS:["float","qu","=","dot","(","cj",",","k",".","xyz",")",";","float","bK","=","qo","[","0","]","+","qo","[","1","]",";","if","(","qn","==","_0_0",")","bK","=","acos","(","sqrt","(","_1_0","-","qu","*","qu",")",")",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["float","bK","=","acos","(","dot","(","cj",",","qm",")",")",";"]}]}]},{TYPE:"txt",TOKENS:["if","(","bK","<","qo","[","0","]",")","qr","=","_1_0",";","else","if","(","bK",">=","qo","[","0","]","+","qo","[","1","]","||","qo","[","1","]","==","_0_0",")","qr","=","_0_0",";","else","qr","=","_1_0","-","(","bK","-","qo","[","0","]",")","/","qo","[","1","]",";","}"]}]},{TYPE:"node",NAME:"SPECULAR_BLINN",NODE_VARS:[{TYPE:"node_var",NAME:"MAT_USE_TBN_SHADING",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"qv",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qw",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qx",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qy",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qz",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"qA",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["qA","=","_0_0",";","if","(","qw",".","g","==","_1_0",")","{","if","(","qz","[","0","]","<","_1_0","||","qz","[","1","]","==","_0_0",")","qA","=","_0_0",";","else","{","if","(","qz","[","1","]","<","100.0",")","qz","[","1","]","=","sqrt","(","_1_0","/","qz","[","1","]",")",";","else","qz","[","1","]","=","10.0","/","qz","[","1","]",";","vec3","pW","=","normalize","(","ou","+","qv",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAT_USE_TBN_SHADING"],STATEMENTS:[{TYPE:"txt",TOKENS:["float","qi","=","_0_0",";","if","(","qy","==","_0_0",")","{","float","qD","=","dot","(","k",".","xyz",",","pW",")",";","qi","=","sqrt","(","_1_0","-","qD","*","qD",")",";","}"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["float","qi","=","(","_1_0","-","qy",")","*","max","(","dot","(","qx",",","pW",")",",","_0_0",")","+","qy",";"]}]}]},{TYPE:"txt",TOKENS:["if","(","qi","<","_0_0",")","qA","=","_0_0",";","else","{","float","pv","=","max","(","dot","(","qx",",","ou",")",",","0.01",")",";","float","qj","=","dot","(","qx",",","qv",")",";","if","(","qj","<=","0.01",")","qA","=","_0_0",";","else","{","float","qE","=","max","(","dot","(","ou",",","pW",")",",","0.01",")",";","float","a","=","_1_0",";","float","b","=","(","2.0","*","qi","*","pv",")","/","qE",";","float","du","=","(","2.0","*","qi","*","qj",")","/","qE",";","float","g","=","min","(","min","(","a",",","b",")",",","du",")",";","float","p","=","sqrt","(","pow","(","qz","[","0","]",",","2.0",")","+","pow","(","qE",",","2.0",")","-","_1_0",")",";","float","mi","=","pow","(","p","-","qE",",","2.0",")","/","pow","(","p","+","qE",",","2.0",")","*","(","_1_0","+","pow","(","qE","*","(","p","+","qE",")","-","_1_0",",","2.0",")","/","pow","(","qE","*","(","p","-","qE",")","+","_1_0",",","2.0",")",")",";","float","pP","=","acos","(","qi",")",";","qA","=","max","(","mi","*","g","*","exp","(","-","pow","(","pP",",","2.0",")","/","(","2.0","*","pow","(","qz","[","1","]",",","2.0",")",")",")",",","_0_0",")",";","}","}","}","}"]}]},{TYPE:"node",NAME:"LIGHTING_APPLY",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"qF",QUALIFIER:["vec4"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qG",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qH",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qI",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qJ",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qK",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qL",QUALIFIER:["vec4"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qM",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qN",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qO",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qP",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"qQ",QUALIFIER:["vec4"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"qR",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_NODE_B4W_TRANSLUCENCY"],STATEMENTS:[{TYPE:"txt",TOKENS:["if","(","dot","(","qJ",",","qK",")","*","dot","(","ou",",","qK",")","<","_0_0",")","{","float","Ek","=","qL",".","x",";","float","El","=","qL",".","y",";","float","Em","=","qL",".","z",";","float","En","=","qL",".","w",";","float","Eo","=","clamp","(","abs","(","dot","(","qJ",",","qK",")",")",",","_0_0",",","_1_0",")",";","float","Ep","=","clamp","(","dot","(","ou",",","-","qJ",")",",","_0_0",",","_1_0",")",";","float","Eq","=","pow","(","Ep",",","El",")",";","qQ","=","qF","+","qP","*","vec4","(","qO","*","Eo","*","pow","(","qM",",","vec3","(","Ek",")",")",",","_1_0",")",";","qQ","+=","Em","*","mix","(","vec4","(","qM",",","_1_0",")",",","vec4","(","_1_0",")",",","En",")","*","qP","*","vec4","(","qO","*","Eo","*","vec3","(","Eq",")",",","_1_0",")",";","}","else","{","qQ","=","qF","+","vec4","(","qO","*","qM","*","qH",",","qI",")",";","}"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["qQ","=","qF","+","vec4","(","qO","*","qM","*","qH",",","qI",")",";"]}]}]},{TYPE:"txt",TOKENS:["qR","=","qG","+","qO","*","qN","*","qI",";"]}]},{TYPE:"node",NAME:"RGB",NODE_VARS:[{TYPE:"node_var",NAME:"RGB_IND",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_out",NAME:"Er",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["Er","=","u_node_rgbs","[","RGB_IND","]",";"]}]},{TYPE:"node",NAME:"RGBTOBW",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"Es",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Et",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["Et","=","dot","(","Es",",","vec3","(","0.35",",","0.45",",","0.2",")",")",";"]}]},{TYPE:"node",NAME:"SEPRGB",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"Eu",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Ev",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"Ew",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"Ex",QUALIFIER:["float"],IS_OPTIONAL:!0}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Ev"],STATEMENTS:[{TYPE:"txt",TOKENS:["Ev","=","Eu",".","r",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Ew"],STATEMENTS:[{TYPE:"txt",TOKENS:["Ew","=","Eu",".","g",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Ex"],STATEMENTS:[{TYPE:"txt",TOKENS:["Ex","=","Eu",".","b",";"]}]}]}]},{TYPE:"node",NAME:"SEPHSV",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"Ey",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Ez",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"EA",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"EB",QUALIFIER:["float"],IS_OPTIONAL:!0}],STATEMENTS:[{TYPE:"txt",TOKENS:["vec3","EC","=","kf","(","Ey",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Ez"],STATEMENTS:[{TYPE:"txt",TOKENS:["Ez","=","EC",".","r",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_EA"],STATEMENTS:[{TYPE:"txt",TOKENS:["EA","=","EC",".","g",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_EB"],STATEMENTS:[{TYPE:"txt",TOKENS:["EB","=","EC",".","b",";"]}]}]}]},{TYPE:"node",NAME:"SQUEEZE",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"ED",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"EE",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"EF",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"EG",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["EG","=","_1_0","/","(","_1_0","+","pow","(","2.71828183",",","-","(","ED","-","EF",")","*","EE",")",")",";"]}]},{TYPE:"node",NAME:"GAMMA",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"EH",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"EI",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"EJ",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["EJ","=","EH",";","if","(","EJ",".","x",">","_0_0",")","EJ",".","x","=","pow","(","EH",".","x",",","EI",")",";","if","(","EJ",".","y",">","_0_0",")","EJ",".","y","=","pow","(","EH",".","y",",","EI",")",";","if","(","EJ",".","z",">","_0_0",")","EJ",".","z","=","pow","(","EH",".","z",",","EI",")",";"]}]},{TYPE:"node",NAME:"B4W_SRGB_TO_LINEAR",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"EK",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"EL",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["EL","=","max","(","vec3","(","_0_0",")",",","EK",")",";","EL","=","pow","(","EL",",","vec3","(","2.2",")",")",";"]}]},{TYPE:"node",NAME:"B4W_LINEAR_TO_SRGB",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"EM",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"EN",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["EN","=","max","(","vec3","(","_0_0",")",",","EM",")",";","EN","=","pow","(","EN",",","vec3","(","_1_0","/","2.2",")",")",";"]}]},{TYPE:"node",NAME:"TEXTURE_EMPTY",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"EO",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"EP",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"EQ",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_EO"],STATEMENTS:[{TYPE:"txt",TOKENS:["EO","[","2","]","=","EO","[","1","]","=","EO","[","0","]","=","_0_0",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_EP"],STATEMENTS:[{TYPE:"txt",TOKENS:["EP","[","2","]","=","EP","[","1","]","=","EP","[","0","]","=","_0_0",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_EQ"],STATEMENTS:[{TYPE:"txt",TOKENS:["EQ","=","_0_0",";"]}]}]}]},{TYPE:"node",NAME:"TEXTURE_ENVIRONMENT",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"Ht",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Hu",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"Hv",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_param",NAME:"node_TEXTURE_ENVIRONMENT_var_texture",QUALIFIER:["uniform","samplerCube"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["vec4","AV","=","GLSL_TEXTURE_CUBE","(","node_TEXTURE_ENVIRONMENT_var_texture",",","Ht",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Hu"],STATEMENTS:[{TYPE:"txt",TOKENS:["Hu","=","AV",".","xyz",";","bC","(","Hu",")",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Hv"],STATEMENTS:[{TYPE:"txt",TOKENS:["Hv","=","AV",".","w",";"]}]}]}]},{TYPE:"node",NAME:"TEXTURE_COLOR",NODE_VARS:[{TYPE:"node_var",NAME:"NON_COLOR",TOKENS:["0"]},{TYPE:"node_var",NAME:"USE_uv2",TOKENS:["0"]},{TYPE:"node_var",NAME:"USE_uv3",TOKENS:["0"]},{TYPE:"node_var",NAME:"USE_uv4",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"Fa",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_in",NAME:"Fb",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_in",NAME:"Fc",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_in",NAME:"Fd",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"Fe",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"Ff",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"Fg",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"Fh",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"Fi",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"Fj",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"Fk",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"Fl",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_param",NAME:"node_TEXTURE_COLOR_var_texture",QUALIFIER:["uniform","sampler2D"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["vec4","AV","=","GLSL_TEXTURE","(","node_TEXTURE_COLOR_var_texture",",","rY","(","Fa",")",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Fe"],STATEMENTS:[{TYPE:"txt",TOKENS:["Fe","=","AV",".","xyz",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["NON_COLOR",{TYPE:"logic_negative_expr",PLACES:1}],STATEMENTS:[{TYPE:"txt",TOKENS:["bC","(","Fe",")",";"]}]}]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Ff"],STATEMENTS:[{TYPE:"txt",TOKENS:["Ff","=","AV",".","w",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_uv2"],STATEMENTS:[{TYPE:"txt",TOKENS:["AV","=","GLSL_TEXTURE","(","node_TEXTURE_COLOR_var_texture",",","rY","(","Fb",")",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Fg"],STATEMENTS:[{TYPE:"txt",TOKENS:["Fg","=","AV",".","xyz",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["NON_COLOR",{TYPE:"logic_negative_expr",PLACES:1}],STATEMENTS:[{TYPE:"txt",TOKENS:["bC","(","Fg",")",";"]}]}]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Fh"],STATEMENTS:[{TYPE:"txt",TOKENS:["Fh","=","AV",".","w",";"]}]}]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_uv3"],STATEMENTS:[{TYPE:"txt",TOKENS:["AV","=","GLSL_TEXTURE","(","node_TEXTURE_COLOR_var_texture",",","rY","(","Fc",")",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Fi"],STATEMENTS:[{TYPE:"txt",TOKENS:["Fi","=","AV",".","xyz",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["NON_COLOR",{TYPE:"logic_negative_expr",PLACES:1}],STATEMENTS:[{TYPE:"txt",TOKENS:["bC","(","Fi",")",";"]}]}]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Fj"],STATEMENTS:[{TYPE:"txt",TOKENS:["Fj","=","AV",".","w",";"]}]}]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_uv4"],STATEMENTS:[{TYPE:"txt",TOKENS:["AV","=","GLSL_TEXTURE","(","node_TEXTURE_COLOR_var_texture",",","rY","(","Fd",")",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Fk"],STATEMENTS:[{TYPE:"txt",TOKENS:["Fk","=","AV",".","xyz",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["NON_COLOR",{TYPE:"logic_negative_expr",PLACES:1}],STATEMENTS:[{TYPE:"txt",TOKENS:["bC","(","Fk",")",";"]}]}]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Fl"],STATEMENTS:[{TYPE:"txt",TOKENS:["Fl","=","AV",".","w",";"]}]}]}]}]}]},{TYPE:"node",NAME:"TEXTURE_NORMAL",NODE_VARS:[{TYPE:"node_var",NAME:"USE_uv2",TOKENS:["0"]},{TYPE:"node_var",NAME:"USE_uv3",TOKENS:["0"]},{TYPE:"node_var",NAME:"USE_uv4",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"Fm",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_in",NAME:"Fn",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_in",NAME:"Fo",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_in",NAME:"Fp",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"Fq",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"Fr",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"Fs",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"Ft",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"Fu",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"Fv",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"Fw",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"Fx",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_param",NAME:"node_TEXTURE_NORMAL_var_texture",QUALIFIER:["uniform","sampler2D"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["vec4","AV","=","GLSL_TEXTURE","(","node_TEXTURE_NORMAL_var_texture",",","rY","(","Fm",")",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Fq"],STATEMENTS:[{TYPE:"txt",TOKENS:["Fq","=","normalize","(","sy","*","(","AV",".","xyz","-","_0_5",")",")",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Fr"],STATEMENTS:[{TYPE:"txt",TOKENS:["Fr","=","AV",".","w",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_uv2"],STATEMENTS:[{TYPE:"txt",TOKENS:["AV","=","GLSL_TEXTURE","(","node_TEXTURE_NORMAL_var_texture",",","rY","(","Fn",")",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Fs"],STATEMENTS:[{TYPE:"txt",TOKENS:["Fs","=","normalize","(","sy","*","(","AV",".","xyz","-","_0_5",")",")",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Ft"],STATEMENTS:[{TYPE:"txt",TOKENS:["Ft","=","AV",".","w",";"]}]}]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_uv3"],STATEMENTS:[{TYPE:"txt",TOKENS:["AV","=","GLSL_TEXTURE","(","node_TEXTURE_NORMAL_var_texture",",","rY","(","Fo",")",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Fu"],STATEMENTS:[{TYPE:"txt",TOKENS:["Fu","=","normalize","(","sy","*","(","AV",".","xyz","-","_0_5",")",")",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Fv"],STATEMENTS:[{TYPE:"txt",TOKENS:["Fv","=","AV",".","w",";"]}]}]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_uv4"],STATEMENTS:[{TYPE:"txt",TOKENS:["AV","=","GLSL_TEXTURE","(","node_TEXTURE_NORMAL_var_texture",",","rY","(","Fp",")",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Fw"],STATEMENTS:[{TYPE:"txt",TOKENS:["Fw","=","normalize","(","sy","*","(","AV",".","xyz","-","_0_5",")",")",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Fx"],STATEMENTS:[{TYPE:"txt",TOKENS:["Fx","=","AV",".","w",";"]}]}]}]}]}]},{TYPE:"node",NAME:"VALUE",NODE_VARS:[{TYPE:"node_var",NAME:"VALUE_ROW_IND",TOKENS:["0"]},{TYPE:"node_var",NAME:"VALUE_COL_IND",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_out",NAME:"Fy",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["Fy","=","u_node_values","[","VALUE_ROW_IND","]","[","VALUE_COL_IND","]",";"]}]},{TYPE:"node",NAME:"VECT_MATH_ADD",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"Fz",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"FA",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"FB",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"FC",QUALIFIER:["float"],IS_OPTIONAL:!0}],STATEMENTS:[{TYPE:"txt",TOKENS:["FB","=","Fz","+","FA",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_FC"],STATEMENTS:[{TYPE:"txt",TOKENS:["FC","=","(","abs","(","FB","[","0","]",")","+","abs","(","FB","[","1","]",")","+","abs","(","FB","[","2","]",")",")","/","3.0",";"]}]}]}]},{TYPE:"node",NAME:"VECT_MATH_SUBTRACT",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"FD",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"FE",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"FF",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"FG",QUALIFIER:["float"],IS_OPTIONAL:!0}],STATEMENTS:[{TYPE:"txt",TOKENS:["FF","=","FD","-","FE",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_FG"],STATEMENTS:[{TYPE:"txt",TOKENS:["FG","=","(","abs","(","FF","[","0","]",")","+","abs","(","FF","[","1","]",")","+","abs","(","FF","[","2","]",")",")","/","3.0",";"]}]}]}]},{TYPE:"node",NAME:"VECT_MATH_AVERAGE",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"FH",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"FI",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"FJ",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"FK",QUALIFIER:["float"],IS_OPTIONAL:!0}],STATEMENTS:[{TYPE:"txt",TOKENS:["FJ","=","FH","+","FI",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_FK"],STATEMENTS:[{TYPE:"txt",TOKENS:["FK","=","length","(","FJ",")",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_FJ"],STATEMENTS:[{TYPE:"txt",TOKENS:["FJ","=","normalize","(","FJ",")",";"]}]}]}]},{TYPE:"node",NAME:"VECT_MATH_DOT_PRODUCT",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"FL",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"FM",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"FN",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"FO",QUALIFIER:["float"],IS_OPTIONAL:!0}],STATEMENTS:[{TYPE:"txt",TOKENS:["FN","=","vec3","(","_0_0",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_FO"],STATEMENTS:[{TYPE:"txt",TOKENS:["FO","=","dot","(","FL",",","FM",")",";"]}]}]}]},{TYPE:"node",NAME:"VECT_MATH_CROSS_PRODUCT",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"FP",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"FQ",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"FR",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"FS",QUALIFIER:["float"],IS_OPTIONAL:!0}],STATEMENTS:[{TYPE:"txt",TOKENS:["FR","=","cross","(","FP",",","FQ",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_FS"],STATEMENTS:[{TYPE:"txt",TOKENS:["FS","=","length","(","FR",")",";"]}]}]}]},{TYPE:"node",NAME:"VECT_MATH_NORMALIZE",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"FT",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"FU",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"FV",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"FW",QUALIFIER:["float"],IS_OPTIONAL:!0}],STATEMENTS:[{TYPE:"txt",TOKENS:["FV","=","normalize","(","FT",")",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_FW"],STATEMENTS:[{TYPE:"txt",TOKENS:["FW","=","length","(","FT",")",";"]}]}]},{TYPE:"txt",TOKENS:["FU",";"]}]},{TYPE:"node",NAME:"B4W_REFLECT",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"Gc",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Gd",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Ge",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["Ge","=","reflect","(","_","(","u_view_tsr_inverse",",","Gc",")",",","Gd",")",";"]}]},{TYPE:"node",NAME:"B4W_REFLECT_WORLD",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"Gf",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Gg",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["vec3","Hw","=","-","ou",".","xyz",";","Gg","=","reflect","(","Hw",",","Gf",")",";"]}]},{TYPE:"node",NAME:"B4W_PARALLAX",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"Gh",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Gi",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Gj",QUALIFIER:["const","float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Gk",QUALIFIER:["const","float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Gl",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_param",NAME:"node_B4W_PARALLAX_var_texture",QUALIFIER:["uniform","sampler2D"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["float","bN","=","length","(","sB",")",";","if","(","bN","<","Gk",")","{","vec2","b_","=","rY","(","Gh",")",";","float","cd","=","clamp","(","_0_5","*","(","Gk","-","bN",")",",","_0_0",",","_1_0",")",";","float","hG","=","Gi","*","cd",";","vec3","cf","=","normalize","(","ou","*","sy",")",";","float","cg","=","_1_0","/","Gj",";","vec2","ch","=","cf",".","xy","*","hG","/","(","Gj","*","cf",".","z",")",";","float","ci","=","_1_0",";","float","cj","=","GLSL_TEXTURE","(","node_B4W_PARALLAX_var_texture",",","b_",")",".","a",";","for","(","float","cl","=","1.0",";","cl","<=","Gj",";","cl","++",")","{","if","(","cj","<","ci",")","{","ci","-=","cg",";","b_","-=","ch",";","cj","=","GLSL_TEXTURE","(","node_B4W_PARALLAX_var_texture",",","b_",")",".","a",";","}","}","vec2","cm","=","b_","+","ch",";","float","cn","=","GLSL_TEXTURE","(","node_B4W_PARALLAX_var_texture",",","cm",")",".","a","-","(","ci","+","cg",")",";","float","co","=","cj","-","ci",";","float","cp","=","co","/","(","co","-","cn",")",";","b_","=","cp","*","cm","+","(","_1_0","-","cp",")","*","b_",";","Gl","=","rX","(","b_",")",";","}","else","Gl","=","Gh",";"]}]},{TYPE:"node",NAME:"B4W_CLAMP",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"Gm",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Gn",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["Gn","=","clamp","(","Gm",",","_0_0",",","_1_0",")",";"]}]},{TYPE:"node",NAME:"B4W_REFRACTION",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"Go",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Gp",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Gq",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["Gq","=","Go",";"]}]},{TYPE:"node",NAME:"B4W_TRANSLUCENCY",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"Gr",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Gs",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Gt",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Gu",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Gv",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Gw",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"Gx",QUALIFIER:["vec4"],IS_OPTIONAL:!0}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Gw"],STATEMENTS:[{TYPE:"txt",TOKENS:["Gw","=","Gr",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Gx"],STATEMENTS:[{TYPE:"txt",TOKENS:["Gx","=","vec4","(","Gs",",","Gt",",","Gu",",","Gv",")",";"]}]}]}]},{TYPE:"node",NAME:"B4W_TIME",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"Gy",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["Gy","=","u_time",";"]}]},{TYPE:"node",NAME:"B4W_SMOOTHSTEP",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"Gz",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"GA",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"GB",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"GC",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["GC","=","smoothstep","(","GA",",","GB",",","Gz",")",";"]}]},{TYPE:"node",NAME:"B4W_GLOW_OUTPUT",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"GD",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"GE",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["E","=","GD",";","I","=","GE",";"]}]},{TYPE:"node",NAME:"B4W_VECTOSCAL",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"GF",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"GG",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["GG","=","(","GF",".","r","+","GF",".","g","+","GF",".","b",")","/","3.0",";"]}]},{TYPE:"node",NAME:"B4W_SCALTOVEC",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"GH",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"GI",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["GI","[","0","]","=","GH",";","GI","[","1","]","=","GH",";","GI","[","2","]","=","GH",";"]}]},{TYPE:"nodes_global"},{TYPE:"txt",TOKENS:["void","J","(","in","vec3","ou",",","out","vec3","E",",","out","vec3","F",",","out","vec3","G",",","out","vec4","H",",","out","float","I",")","{","E","=","vec3","(","_0_0",")",";","F","=","vec3","(","_0_0",")",";","G","=","vec3","(","_0_0",")",";","H","=","vec4","(","_0_0",")",";","I","=","_0_0",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","USE_NODE_TEX_COORD_NO","USE_NODE_NORMAL_MAP","USE_NODE_BSDF_BEGIN","USE_NODE_FRESNEL","USE_NODE_TEX_COORD_RE","USE_NODE_LAYER_WEIGHT","USE_NODE_BUMP",{TYPE:"logical_or_expr",PLACES:11}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","sv","=","j",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DOUBLE_SIDED_LIGHTING","USE_NODE_GEOMETRY_NO",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_PASS","REFL_PASS_PLANE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["if","(","gl_FrontFacing","==","false",")"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["if","(","gl_FrontFacing",")"]}]}}]},{TYPE:"txt",TOKENS:["sv","=","sv",";","else","sv","=","-","sv",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_NORMAL_MAP"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","sw","=","sv",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DOUBLE_SIDED_LIGHTING","USE_NODE_GEOMETRY_NO","USE_NODE_TEXTURE_NORMAL","USE_NODE_B4W_PARALLAX",{TYPE:"logical_or_expr",PLACES:4}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","sx","=","normalize","(","sv",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DOUBLE_SIDED_LIGHTING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","ot","=","sx",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","ot","=","normalize","(","j",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_GEOMETRY_NO"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","su","=","sx",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CALC_TBN_SPACE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_TEXTURE_NORMAL","USE_NODE_B4W_PARALLAX",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","W","=","cross","(","sx",",","k",".","xyz",")","*","k",".","w",";","mat3","sy","=","mat3","(","k",".","xyz",",","W",",","sx",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_NORMAL_MAP"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","W","=","cross","(","sv",",","k",".","xyz",")","*","k",".","w",";","mat3","sA","=","mat3","(","k",".","xyz",",","W",",","sv",")",";"]}]}}]}]}}]},{TYPE:"txt",TOKENS:["vec3","os","=","h",";","vec4","sB","=","i",";","float","sC","=","u_emit",";","float","sD","=","u_ambient",";"]},{TYPE:"nodes_main"},{TYPE:"txt",TOKENS:["}"]}]}}]}]},e["include/particles_nodes.glslv"]={TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"PARTICLES_NODES_GLSLV",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"PARTICLES_NODES_GLSLV",TOKENS:[""]},{TYPE:"node",NAME:"TEX_COORD_UV",NODE_VARS:[],DECLARATIONS:[],STATEMENTS:[{TYPE:"txt",TOKENS:["A","=","HC",";"]}]},{TYPE:"node",NAME:"UV_MERGED",NODE_VARS:[],DECLARATIONS:[],STATEMENTS:[{TYPE:"txt",TOKENS:["A","=","HC",";"]}]},{TYPE:"node",NAME:"UVMAP",NODE_VARS:[],DECLARATIONS:[],STATEMENTS:[{TYPE:"txt",TOKENS:["A","=","HC",";"]}]},{TYPE:"node",NAME:"GEOMETRY_UV",NODE_VARS:[],DECLARATIONS:[],STATEMENTS:[{TYPE:"txt",TOKENS:["A","=","HC",";"]}]},{TYPE:"node",NAME:"PARTICLE_INFO",NODE_VARS:[{TYPE:"node_var",NAME:"PART_INFO_SIZE",TOKENS:["0"]},{TYPE:"node_var",NAME:"PART_INFO_AGE",TOKENS:["0"]},{TYPE:"node_var",NAME:"PART_INFO_LT",TOKENS:["0"]},{TYPE:"node_var",NAME:"PART_INFO_LOC",TOKENS:["0"]},{TYPE:"node_var",NAME:"PART_INFO_IND",TOKENS:["0"]},{TYPE:"node_var",NAME:"PART_INFO_VEL",TOKENS:["0"]},{TYPE:"node_var",NAME:"PART_INFO_A_VEL",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_param",NAME:"Hf",QUALIFIER:["GLSL_OUT","vec4"],IS_OPTIONAL:!0},{TYPE:"node_param",NAME:"Hg",QUALIFIER:["GLSL_OUT","vec3"],IS_OPTIONAL:!0},{TYPE:"node_param",NAME:"Hh",QUALIFIER:["GLSL_OUT","vec3"],IS_OPTIONAL:!0},{TYPE:"node_param",NAME:"Hi",QUALIFIER:["GLSL_OUT","vec3"],IS_OPTIONAL:!0},{TYPE:"node_param",NAME:"node_PARTICLE_INFO_var_a_p_indices",QUALIFIER:["GLSL_IN","float"],IS_OPTIONAL:!0}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["PART_INFO_SIZE"],STATEMENTS:[{TYPE:"txt",TOKENS:["Hf","[","3","]","=","HB",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["PART_INFO_AGE"],STATEMENTS:[{TYPE:"txt",TOKENS:["Hf","[","1","]","=","HA",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["PART_INFO_LT"],STATEMENTS:[{TYPE:"txt",TOKENS:["Hf","[","2","]","=","HD",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["PART_INFO_LOC"],STATEMENTS:[{TYPE:"txt",TOKENS:["Hg","=","Hx",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["PART_INFO_IND"],STATEMENTS:[{TYPE:"txt",TOKENS:["Hf","[","0","]","=","node_PARTICLE_INFO_var_a_p_indices",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["PART_INFO_VEL"],STATEMENTS:[{TYPE:"txt",TOKENS:["Hh","=","Hy",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["PART_INFO_A_VEL"],STATEMENTS:[{TYPE:"txt",TOKENS:["Hi","=","Hz",";"]}]}]}]},{TYPE:"nodes_global"},{TYPE:"txt",TOKENS:["void","J","(","in","vec3","Hx",",","in","vec3","Hy",",","in","vec3","Hz",",","in","float","HA",",","in","float","HB",",","in","vec2","HC",",","in","float","HD",")","{"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_GEOMETRY_OR","USE_NODE_TEX_COORD_GE",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["A","=","HC",";"]}]}}]},{TYPE:"nodes_main"},{TYPE:"txt",TOKENS:["}"]}]}}]}]},e["include/precision_statement.glslf"]={TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"PRECISION_STATEMENT_GLSLF",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"PRECISION_STATEMENT_GLSLF",TOKENS:[""]},{TYPE:"var",NAME:"PRECISION",TOKENS:["highp"]},{TYPE:"txt",TOKENS:["precision","PRECISION","float",";"]}]}}]}]},e["include/procedural.glslf"]={TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"PROCEDURAL_GLSLF",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"PROCEDURAL_GLSLF",TOKENS:[""]},{TYPE:"txt",TOKENS:["vec4","HE","(","vec4","x",")","{","return","x","-","floor","(","x","*","(","_1_0","/","289.0",")",")","*","289.0",";","}","vec3","HE","(","vec3","x",")","{","return","x","-","floor","(","x","*","(","_1_0","/","289.0",")",")","*","289.0",";","}","vec2","HE","(","vec2","x",")","{","return","x","-","floor","(","x","*","(","_1_0","/","289.0",")",")","*","289.0",";","}","vec4","HF","(","vec4","x",")","{","return","x","-","floor","(","x","*","(","_1_0","/","7.0",")",")","*","7.0",";","}","vec4","HG","(","vec4","x",")","{","return","HE","(","(","34.0","*","x","+","5.0",")","*","x",")",";","}"]},{TYPE:"define",NAME:"K",TOKENS:["0.142857142857"]},{TYPE:"define",NAME:"K2",TOKENS:["0.0714285714285"]},{TYPE:"define",NAME:"JITTER",TOKENS:["0.7"]},{TYPE:"txt",TOKENS:["vec2","fG","(","vec2","HH",")","{","vec2","HI","=","HE","(","floor","(","HH",")",")",";","vec2","HJ","=","fract","(","HH",")",";","vec4","HK","=","HJ",".","x","+","vec4","(","-","0.5",",","-","1.5",",","-","0.5",",","-","1.5",")",";","vec4","HL","=","HJ",".","y","+","vec4","(","-","0.5",",","-","0.5",",","-","1.5",",","-","1.5",")",";","vec4","p","=","HG","(","HI",".","x","+","vec4","(","_0_0",",","_1_0",",","_0_0",",","_1_0",")",")",";","p","=","HG","(","p","+","HI",".","y","+","vec4","(","_0_0",",","_0_0",",","_1_0",",","_1_0",")",")",";","vec4","HM","=","HF","(","p",")","*","K","+","K2",";","vec4","HN","=","HF","(","floor","(","p","*","K",")",")","*","K","+","K2",";","vec4","HO","=","HK","+","JITTER","*","HM",";","vec4","HP","=","HL","+","JITTER","*","HN",";","vec4","dz","=","HO","*","HO","+","HP","*","HP",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:[1],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["dz",".","xy","=","min","(","dz",".","xy",",","dz",".","zw",")",";","dz",".","x","=","min","(","dz",".","x",",","dz",".","y",")",";","return","dz",".","xx",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["dz",".","xy","=","(","dz",".","x","<","dz",".","y",")","?","dz",".","xy",":","dz",".","yx",";","dz",".","xz","=","(","dz",".","x","<","dz",".","z",")","?","dz",".","xz",":","dz",".","zx",";","dz",".","xw","=","(","dz",".","x","<","dz",".","w",")","?","dz",".","xw",":","dz",".","wx",";","dz",".","y","=","min","(","dz",".","y",",","dz",".","z",")",";","dz",".","y","=","min","(","dz",".","y",",","dz",".","w",")",";","return","sqrt","(","dz",".","xy",")",";"]}]}}]},{TYPE:"txt",TOKENS:["}","vec3","kX","(","vec2","HH",",","float","HQ",")","{","vec2","HI","=","HE","(","floor","(","HH",")",")",";","vec2","HJ","=","fract","(","HH",")",";","vec4","HK","=","HJ",".","x","+","vec4","(","-","0.5",",","-","1.5",",","-","0.5",",","-","1.5",")",";","vec4","HL","=","HJ",".","y","+","vec4","(","-","0.5",",","-","0.5",",","-","1.5",",","-","1.5",")",";","vec4","p","=","HG","(","HI",".","x","+","vec4","(","_0_0",",","_1_0",",","_0_0",",","_1_0",")",")",";","p","=","HG","(","p","+","HI",".","y","+","vec4","(","_0_0",",","_0_0",",","_1_0",",","_1_0",")",")",";","vec4","HM","=","HF","(","p",")","*","K","+","K2",";","vec4","HN","=","HF","(","floor","(","p","*","K",")",")","*","K","+","K2",";","vec4","HO","=","HK","+","JITTER","*","HM",";","vec4","HP","=","HL","+","JITTER","*","HN",";","vec4","HR","=","HO","*","HO","+","HP","*","HP",";","HO","+=","HQ",";","HP","+=","HQ",";","vec4","HS","=","HO","*","HO","+","HP","*","HP",";","HO","+=","HQ",";","HP","+=","HQ",";","vec4","HT","=","HO","*","HO","+","HP","*","HP",";","HR",".","xy","=","min","(","HR",".","xy",",","HR",".","zw",")",";","HR",".","x","=","min","(","HR",".","x",",","HR",".","y",")",";","HS",".","xy","=","min","(","HS",".","xy",",","HS",".","zw",")",";","HS",".","x","=","min","(","HS",".","x",",","HS",".","y",")",";","HT",".","xy","=","min","(","HT",".","xy",",","HT",".","zw",")",";","HT",".","x","=","min","(","HT",".","x",",","HT",".","y",")",";","return","vec3","(","HR",".","x",",","HS",".","x",",","HT",".","x",")",";","}","vec3","HU","(","vec3","x",")","{","return","HE","(","(","(","x","*","34.0",")","+","_1_0",")","*","x",")",";","}","float","fv","(","vec2","kQ",")","{","const","vec4","HV","=","vec4","(","0.211324865405187",",","0.366025403784439",",","-","0.577350269189626",",","0.024390243902439",")",";","vec2","cl","=","floor","(","kQ","+","dot","(","kQ",",","HV",".","yy",")",")",";","vec2","HW","=","kQ","-","cl","+","dot","(","cl",",","HV",".","xx",")",";","vec2","HX",";","HX","=","(","HW",".","x",">","HW",".","y",")","?","vec2","(","_1_0",",","_0_0",")",":","vec2","(","_0_0",",","_1_0",")",";","vec4","HY","=","HW",".","xyxy","+","HV",".","xxzz",";","HY",".","xy","-=","HX",";","cl","=","HE","(","cl",")",";","vec3","p","=","HU","(","HU","(","cl",".","y","+","vec3","(","_0_0",",","HX",".","y",",","_1_0",")",")","+","cl",".","x","+","vec3","(","_0_0",",","HX",".","x",",","_1_0",")",")",";","vec3","aA","=","max","(","0.5","-","vec3","(","dot","(","HW",",","HW",")",",","dot","(","HY",".","xy",",","HY",".","xy",")",",","dot","(","HY",".","zw",",","HY",".","zw",")",")",",","_0_0",")",";","aA","=","aA","*","aA",";","aA","=","aA","*","aA",";","vec3","x","=","2.0","*","fract","(","p","*","HV",".","www",")","-","_1_0",";","vec3","cj","=","abs","(","x",")","-","0.5",";","vec3","HM","=","floor","(","x","+","0.5",")",";","vec3","HZ","=","x","-","HM",";","aA","*=","1.79284291400159","-","0.85373472095314","*","(","HZ","*","HZ","+","cj","*","cj",")",";","vec3","g",";","g",".","x","=","HZ",".","x","*","HW",".","x","+","cj",".","x","*","HW",".","y",";","g",".","yz","=","HZ",".","yz","*","HY",".","xz","+","cj",".","yz","*","HY",".","yw",";","return","130.0","*","dot","(","aA",",","g",")",";","}","vec2","Ib","(","vec2","fW",")","{","float","HR","=","dot","(","fW",",","vec2","(","12.9898",",","78.233",")",")",";","float","HS","=","dot","(","fW",",","vec2","(","12.9898",",","78.233",")","*","2.0",")",";","float","H_","=","fract","(","sin","(","HR",")","*","43758.5453",")","*","2.0","-","_1_0",";","float","Ia","=","fract","(","sin","(","HS",")","*","43758.5453",")","*","2.0","-","_1_0",";","return","vec2","(","H_",",","Ia",")",";","}","float","lg","(","vec2","Ic",")","{","return","fract","(","sin","(","dot","(","Ic",",","vec2","(","12.9898",",","78.233",")",")",")","*","43758.5453",")",";","}"]}]}}]}]},e["include/refraction.glslf"]={TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"REFRACTION_GLSLF",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"REFRACTION_GLSLF",TOKENS:[""]},{TYPE:"var",NAME:"REFRACTIVE",TOKENS:["0"]},{TYPE:"var",NAME:"USE_REFRACTION_CORRECTION",TOKENS:["0"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFRACTIVE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_REFRACTION_CORRECTION"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"pack.glslf"}]}}]},{TYPE:"include",FILE:"color_util.glslf"},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_REFRACTION_CORRECTION"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","eS","(","in","float","cR",",","inout","vec2","eR",",","in","vec2","eI",")","{","vec4","Id","=","GLSL_TEXTURE","(","u_scene_depth",",","eR",")",";","float","eT","=","cQ","(","Id",")",";","if","(","eT","<","m",")","{","eR","=","eI",";","return","cR",";","}","else","{","return","eT",";","}","return","cR",";","}"]}]}}]},{TYPE:"txt",TOKENS:["vec3","cN","(","in","vec3","rq",",","in","vec2","Ie",")","{","vec2","eI","=","rq",".","xy","/","rq",".","z",";","vec2","eR","=","eI","+","Ie",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_REFRACTION_CORRECTION"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec4","cP","=","GLSL_TEXTURE_PROJ","(","u_scene_depth",",","rq",")",";","float","cR","=","cQ","(","cP",")",";","eS","(","cR",",","eR",",","eI",")",";"]}]}}]},{TYPE:"txt",TOKENS:["vec3","eX","=","GLSL_TEXTURE","(","u_refractmap",",","eR",")",".","rgb",";","bC","(","eX",")",";","return","eX",";","}"]}]}}]}]}}]}]},e["include/scale_texcoord.glslv"]={TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"SCALE_TEXCOORD_GLSLV",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"SCALE_TEXCOORD_GLSLV",TOKENS:[""]},{TYPE:"txt",TOKENS:["vec2","az","(","vec2","b_",",","vec3","If",")","{","return","(","b_","+","0.5",")","*","If",".","xy","-","0.5",";","}"]}]}}]}]},e["include/shadow.glslf"]={TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"SHADOW_GLSLF",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"SHADOW_GLSLF",TOKENS:[""]},{TYPE:"var",NAME:"PRECISION",TOKENS:["highp"]},{TYPE:"var",NAME:"SHADOW_TEX_RES",TOKENS:["2048.0"]},{TYPE:"var",NAME:"CSM_FADE_LAST_CASCADE",TOKENS:["0"]},{TYPE:"var",NAME:"CSM_BLEND_BETWEEN_CASCADES",TOKENS:["0"]},{TYPE:"var",NAME:"RGBA_SHADOWS",TOKENS:["0"]},{TYPE:"var",NAME:"SHADOW_USAGE",TOKENS:["NO_SHADOWS"]},{TYPE:"var",NAME:"NUM_CAST_LAMPS",TOKENS:["0"]},{TYPE:"var",NAME:"CSM_SECTION1",TOKENS:["0"]},{TYPE:"var",NAME:"CSM_SECTION2",TOKENS:["0"]},{TYPE:"var",NAME:"CSM_SECTION3",TOKENS:["0"]},{TYPE:"var",NAME:"COMPARED_MODE",TOKENS:["0"]},{TYPE:"var",NAME:"POISSON_DISK_NUM",TOKENS:["NO_SOFT_SHADOWS"]},{TYPE:"include",FILE:"std.glsl"},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{TYPE:"equal_expr",PLACES:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"procedural.glslf"}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{TYPE:"equal_expr",PLACES:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["const","float","Ig","=","0.1",";","const","float","Ih","=","0.1",";","const","float","Ii","=","-","0.01",";","const","float","Ij","=","0.05",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["POISSON_DISK_NUM","POISSON_X_16",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec4","Ik","=","vec4","(","0.14383161",",","0.34495938",",","-","0.38277543",",","-","0.26496911",")",";","vec4","Il","=","vec4","(","0.53742981",",","0.19984126",",","0.79197514",",","-","0.094184101",")",";","vec4","Im","=","vec4","(","-","0.94201624",",","-","0.91588581",",","-","0.2418884",",","0.44323325",")",";","vec4","In","=","vec4","(","-","0.81544232",",","0.94558609",",","-","0.81409955",",","0.97484398",")",";","vec4","Io","=","vec4","(","-","0.1410079",",","0.2938776",",","0.27676845",",","-","0.41893023",")",";","vec4","Ip","=","vec4","(","-","0.4737342",",","0.78641367",",","0.19090188",",","-","0.9293887",")",";","vec4","Iq","=","vec4","(","-","0.39906216",",","0.45771432",",","0.99706507",",","-","0.97511554",")",";","vec4","Ir","=","vec4","(","-","0.87912464",",","-","0.76890725",",","0.9143759",",","0.7564837",")",";"]}]}},{TYPE:"elif",EXPRESSION:["POISSON_DISK_NUM","POISSON_X_8",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec2","Ik","=","vec2","(","-","0.37192261",",","0.47109537",")",";","vec2","Il","=","vec2","(","-","0.6807477",",","0.69048062",")",";","vec2","Im","=","vec2","(","0.11615683",",","-","0.91318524",")",";","vec2","In","=","vec2","(","0.93688596",",","-","0.16948928",")",";","vec2","Io","=","vec2","(","-","0.89699117",",","0.74092316",")",";","vec2","Ip","=","vec2","(","0.38263656",",","-","0.66119884",")",";","vec2","Iq","=","vec2","(","-","0.08193062",",","-","0.21275223",")",";","vec2","Ir","=","vec2","(","0.05578877",",","0.84225623",")",";"]}]}},{TYPE:"elif",EXPRESSION:["POISSON_DISK_NUM","POISSON_X_4",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec2","Ik","=","vec2","(","-","0.51808083",",","0.0",")",";","vec2","Il","=","vec2","(","0.5741194",",","0.0",")",";","vec2","Im","=","vec2","(","-","0.68048857",",","0.0",")",";","vec2","In","=","vec2","(","0.82934988",",","0.0",")",";","vec2","Io","=","vec2","(","0.70009436",",","0.0",")",";","vec2","Ip","=","vec2","(","-","0.78790467",",","0.0",")",";","vec2","Iq","=","vec2","(","-","0.58619489",",","0.0",")",";","vec2","Ir","=","vec2","(","0.41902178",",","0.0",")",";"]}]}}]},{TYPE:"txt",TOKENS:["bool","It","(","vec2","iK",",","float","Is",")","{","return","all","(","lessThanEqual","(","iK",",","vec2","(","1.0","+","Is",")",")",")","&&","all","(","greaterThanEqual","(","iK",",","vec2","(","0.0","-","Is",")",")",")",";","}","float","IA","(","float","Iu",",","float","Iv",",","mat2","Iw",",","vec3","Ix",",","float","Iy",",","PRECISION","GLSL_SMPLR2D_SHDW","Iz",")","{"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["POISSON_DISK_NUM","NO_SOFT_SHADOWS",{TYPE:"non_equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec2","iK",",","fI",";","fI",".","x","=","Iu",";","fI",".","y","=","Iv",";","fI","=","Iw","*","fI",";","iK","=","Ix",".","xy","+","fI","*","Iy","/","SHADOW_TEX_RES",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec2","iK","=","Ix",".","xy",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION1",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["if","(","!","It","(","iK",",","Ii",")",")","return","1.0",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["RGBA_SHADOWS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","eq","=","cQ","(","GLSL_TEXTURE","(","Iz",",","iK",")",")",";","return","step","(","Ix",".","z",",","eq",")",";"]}]}},{TYPE:"elif",EXPRESSION:["COMPARED_MODE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["return","GLSL_TEXTURE","(","Iz",",","vec3","(","iK",",","Ix",".","z",")",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["return","step","(","Ix",".","z",",","GLSL_TEXTURE","(","Iz",",","iK",")",".","r",")",";"]}]}}]},{TYPE:"txt",TOKENS:["}","float","IF","(","vec3","Ix",",","PRECISION","GLSL_SMPLR2D_SHDW","Iz",",","float","Iy",")","{","float","IB","=","0.0",";","Ix",".","z","=","clamp","(","Ix",".","z",",","0.0",",","1.0",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["POISSON_DISK_NUM","NO_SOFT_SHADOWS",{TYPE:"non_equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","IC","=","Ib","(","Ix",".","xy",")",".","x","*","M_PI",";","float","ID","=","cos","(","IC",")",";","float","IE","=","sin","(","IC",")",";","mat2","Iw","=","mat2","(","ID",",","IE",",","-","IE",",","ID",")",";","for","(","int","cl","=","0",";","cl","<","POISSON_DISK_NUM",";","cl","++",")","{","IB","+=","IA","(","Ik","[","cl","]",",","Io","[","cl","]",",","Iw",",","Ix",",","Iy",",","Iz",")",";","IB","+=","IA","(","Il","[","cl","]",",","Ip","[","cl","]",",","Iw",",","Ix",",","Iy",",","Iz",")",";","IB","+=","IA","(","Im","[","cl","]",",","Iq","[","cl","]",",","Iw",",","Ix",",","Iy",",","Iz",")",";","IB","+=","IA","(","In","[","cl","]",",","Ir","[","cl","]",",","Iw",",","Ix",",","Iy",",","Iz",")",";","}","return","clamp","(","IB","/","(","float","(","POISSON_DISK_NUM",")","*","4.0",")",",","0.0",",","1.0",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["return","IA","(","0.0",",","0.0",",","mat2","(","0.0",")",",","Ix",",","Iy",",","Iz",")",";"]}]}}]},{TYPE:"txt",TOKENS:["}","float","IO","(","vec3","IG",",","PRECISION","GLSL_SMPLR2D_SHDW","IH",",","vec3","II",",","PRECISION","GLSL_SMPLR2D_SHDW","IJ",",","float","IK",",","float","IL",",","float","aL",")","{","float","IM",",","IN",";","IG",".","z","=","clamp","(","IG",".","z",",","0.0",",","1.0",")",";","II",".","z","=","clamp","(","II",".","z",",","0.0",",","1.0",")",";","IM","=","0.0",";","IN","=","0.0",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["POISSON_DISK_NUM","NO_SOFT_SHADOWS",{TYPE:"non_equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","IC","=","Ib","(","IG",".","xy",")",".","x","*","M_PI",";","float","ID","=","cos","(","IC",")",";","float","IE","=","sin","(","IC",")",";","mat2","Iw","=","mat2","(","ID",",","IE",",","-","IE",",","ID",")",";","for","(","int","cl","=","0",";","cl","<","POISSON_DISK_NUM",";","cl","++",")","{","IM","+=","IA","(","Ik","[","cl","]",",","Io","[","cl","]",",","Iw",",","IG",",","IK",",","IH",")",";","IM","+=","IA","(","Il","[","cl","]",",","Ip","[","cl","]",",","Iw",",","IG",",","IK",",","IH",")",";","IM","+=","IA","(","Im","[","cl","]",",","Iq","[","cl","]",",","Iw",",","IG",",","IK",",","IH",")",";","IM","+=","IA","(","In","[","cl","]",",","Ir","[","cl","]",",","Iw",",","IG",",","IK",",","IH",")",";","}","for","(","int","cl","=","0",";","cl","<","POISSON_DISK_NUM",";","cl","++",")","{","IN","+=","IA","(","Ik","[","cl","]",",","Io","[","cl","]",",","Iw",",","II",",","IL",",","IJ",")",";","IN","+=","IA","(","Il","[","cl","]",",","Ip","[","cl","]",",","Iw",",","II",",","IL",",","IJ",")",";","IN","+=","IA","(","Im","[","cl","]",",","Iq","[","cl","]",",","Iw",",","II",",","IL",",","IJ",")",";","IN","+=","IA","(","In","[","cl","]",",","Ir","[","cl","]",",","Iw",",","II",",","IL",",","IJ",")",";","}","IM","=","mix","(","IM",",","IN",",","aL",")",";","IM","/=","(","float","(","POISSON_DISK_NUM",")","*","4.0",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["IM","+=","IA","(","0.0",",","0.0",",","mat2","(","0.0",")",",","IG",",","IK",",","IH",")",";","IN","+=","IA","(","0.0",",","0.0",",","mat2","(","0.0",")",",","II",",","IL",",","IJ",")",";","IM","=","mix","(","IM",",","IN",",","aL",")",";"]}]}}]},{TYPE:"txt",TOKENS:["return","clamp","(","IM",",","0.0",",","1.0",")",";","}","float","IP","(","vec2","iK",")","{","float","a","=","min","(","iK",".","x",",","iK",".","y",")",";","float","b","=","min","(","1.0","-","iK",".","x",",","1.0","-","iK",".","y",")",";","return","min","(","a",",","b",")",";","}","float","IR","(","float","uO",",","float","IQ",")","{","if","(","IQ",">=","0.0","&&","IQ","<=","Ih",")","uO","=","(","uO","-","1.0",")","/","Ih","*","IQ","+","1.0",";","return","uO",";","}","float","IW","(","vec3","IS",",","vec3","IT",",","PRECISION","GLSL_SMPLR2D_SHDW","IH",",","PRECISION","GLSL_SMPLR2D_SHDW","IJ",",","float","IK",",","float","IL",",","float","IU",",","float","eq",")","{","float","uO",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_BLEND_BETWEEN_CASCADES"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","IQ","=","IP","(","IS",".","xy",")",";","if","(","-","eq",">","IU","&&","IQ",">=","0.0","&&","IQ","<=","Ig","&&","It","(","IT",".","xy",",","0.0",")",")","{","float","IV","=","1.0","-","IQ","/","Ig",";","uO","=","IO","(","IS",",","IH",",","IT",",","IJ",",","IK",",","IL",",","IV",")",";","}","else"]}]}}]},{TYPE:"txt",TOKENS:["uO","=","IF","(","IS",",","IH",",","IK",")",";","return","uO",";","}","float","IY","(","vec3","IX",",","PRECISION","GLSL_SMPLR2D_SHDW","Iz",",","float","Iy",",","float","IU",",","float","eq",")","{","float","uO","=","IF","(","IX",",","Iz",",","Iy",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_FADE_LAST_CASCADE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["if","(","-","eq",">","IU",")","{","float","IQ","=","IP","(","IX",".","xy",")",";","uO","=","IR","(","uO",",","IQ",")",";","}"]}]}}]},{TYPE:"txt",TOKENS:["return","uO",";","}","vec4","es","(","float","eq",")","{","float","uO","=","1.0",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["POISSON_DISK_NUM","NO_SOFT_SHADOWS",{TYPE:"non_equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec4","IZ","=","u_pcf_blur_radii",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec4","IZ","=","vec4","(","0.0",")",";"]}]}}]},{TYPE:"txt",TOKENS:["vec3","IG","=","n",".","xyz","/","n",".","w",";","if","(","n",".","w","<","0.0",")","IG",".","z","=","0.0",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION1","NUM_CAST_LAMPS",1,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","II","=","o",".","xyz","/","o",".","w",";","if","(","o",".","w","<","0.0",")","II",".","z","=","0.0",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION2","NUM_CAST_LAMPS",2,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","I_","=","u",".","xyz","/","u",".","w",";","if","(","u",".","w","<","0.0",")","I_",".","z","=","0.0",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION3","NUM_CAST_LAMPS",3,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","Ja","=","v",".","xyz","/","v",".","w",";","if","(","v",".","w","<","0.0",")","Ja",".","z","=","0.0",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION1"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["if","(","It","(","IG",".","xy",",","0.0",")",")","{","uO","=","IW","(","IG",",","II",",","u_shadow_map0",",","u_shadow_map1",",","IZ","[","0","]",",","IZ","[","1","]",",","u_csm_center_dists","[","0","]",",","eq",")",";","}"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["if","(","It","(","IG",".","xy",",","Ij",")",")","{","uO","=","IY","(","IG",",","u_shadow_map0",",","IZ","[","0","]",",","u_csm_center_dists","[","0","]",",","eq",")",";","}"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION1"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["else","{","if","(","It","(","II",".","xy",",","0.0",")",")","{"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION2"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uO","=","IW","(","II",",","I_",",","u_shadow_map1",",","u_shadow_map2",",","IZ","[","1","]",",","IZ","[","2","]",",","u_csm_center_dists","[","1","]",",","eq",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uO","=","IY","(","II",",","u_shadow_map1",",","IZ","[","1","]",",","u_csm_center_dists","[","1","]",",","eq",")",";"]}]}}]},{TYPE:"txt",TOKENS:["}"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION2"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["else","{","if","(","It","(","I_",".","xy",",","0.0",")",")","{"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION3"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uO","=","IW","(","I_",",","Ja",",","u_shadow_map2",",","u_shadow_map3",",","IZ","[","2","]",",","IZ","[","3","]",",","u_csm_center_dists","[","2","]",",","eq",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uO","=","IY","(","I_",",","u_shadow_map2",",","IZ","[","2","]",",","u_csm_center_dists","[","2","]",",","eq",")",";"]}]}}]},{TYPE:"txt",TOKENS:["}"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION3"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["else","{","if","(","It","(","Ja",".","xy",",","0.0",")",")","uO","=","IY","(","Ja",",","u_shadow_map3",",","IZ","[","3","]",",","u_csm_center_dists","[","3","]",",","eq",")",";","}"]}]}}]},{TYPE:"txt",TOKENS:["}"]}]}}]},{TYPE:"txt",TOKENS:["}"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_CAST_LAMPS",1,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","Jb","=","IF","(","II",",","u_shadow_map1",",","IZ","[","0","]",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","Jb","=","0.0",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_CAST_LAMPS",2,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","Jc","=","IF","(","I_",",","u_shadow_map2",",","IZ","[","0","]",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","Jc","=","0.0",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_CAST_LAMPS",3,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","Jd","=","IF","(","Ja",",","u_shadow_map3",",","IZ","[","0","]",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","Jd","=","1.0",";"]}]}}]},{TYPE:"txt",TOKENS:["return","vec4","(","uO",",","Jb",",","Jc",",","Jd",")",";","}"]}]}}]},{TYPE:"txt",TOKENS:["vec4","cC","(","inout","vec3","cy",")","{"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec4","IB","=","GLSL_TEXTURE","(","u_shadow_mask",",","l",".","xy","/","l",".","z",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_CAST_LAMPS",3,{TYPE:"l_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["cy","*=","IB",".","a",";"]}]}}]},{TYPE:"txt",TOKENS:["return","IB",";"]}]}},{TYPE:"elif",EXPRESSION:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{TYPE:"equal_expr",PLACES:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec4","IB","=","es","(","i",".","z",")",";","return","IB",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["return","vec4","(","1.0",")",";"]}]}}]},{TYPE:"txt",TOKENS:["}"]}]}}]}]},e["include/shadow.glslv"]={TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"SHADOW_GLSLV",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"SHADOW_GLSLV",TOKENS:[""]},{TYPE:"var",NAME:"MAC_OS_SHADOW_HACK",TOKENS:["0"]},{TYPE:"var",NAME:"SHADOW_TEX_RES",TOKENS:["2048.0"]},{TYPE:"var",NAME:"SHADOW_USAGE",TOKENS:["NO_SHADOWS"]},{TYPE:"var",NAME:"NUM_CAST_LAMPS",TOKENS:["0"]},{TYPE:"var",NAME:"CSM_SECTION1",TOKENS:["0"]},{TYPE:"var",NAME:"CSM_SECTION2",TOKENS:["0"]},{TYPE:"var",NAME:"CSM_SECTION3",TOKENS:["0"]},{TYPE:"include",FILE:"std.glsl"},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{TYPE:"equal_expr",PLACES:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"math.glslv"},{TYPE:"txt",TOKENS:["vec4","Jh","(","mat4","Je",",","vec4","Jf",",","mat4","Jg",")","{","vec2","eu","=","(","Je","*","Jg","[","3","]",")",".","xy",";","float","ev","=","SHADOW_TEX_RES","/","2.0",";","eu","=","floor","(","eu","*","ev","+","0.5",")","/","ev","-","eu",";","vec4","Ix","=","Je","*","Jf",";","Ix",".","xy","+=","eu",";","Ix",".","xyz","=","0.5","*","(","Ix",".","xyz","+","Ix",".","w",")",";","return","Ix",";","}","void","bZ","(","vec3","fn",",","vec3","Ji",")","{"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["MAC_OS_SHADOW_HACK"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["mat4","Jg","=","bc","(","u_v_light_tsr","[","0","]",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["mat4","Jg","=","bc","(","mat3","(","u_v_light_ts","[","0","]",",","u_v_light_r","[","0","]",",","0.0",")",")",";"]}]}}]},{TYPE:"txt",TOKENS:["vec4","Jj","=","Jg","*","vec4","(","fn","+","u_normal_offset","*","Ji",",","1.0",")",";","n","=","Jh","(","u_p_light_matrix0",",","Jj",",","Jg",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_CAST_LAMPS",1,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["MAC_OS_SHADOW_HACK"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["Jg","=","bc","(","u_v_light_tsr","[","1","]",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["Jg","=","bc","(","mat3","(","u_v_light_ts","[","1","]",",","u_v_light_r","[","1","]",",","0.0",")",")",";"]}]}}]},{TYPE:"txt",TOKENS:["Jj","=","Jg","*","vec4","(","fn","+","u_normal_offset","*","Ji",",","1.0",")",";","o","=","Jh","(","u_p_light_matrix1",",","Jj",",","Jg",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_CAST_LAMPS",2,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["MAC_OS_SHADOW_HACK"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["Jg","=","bc","(","u_v_light_tsr","[","2","]",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["Jg","=","bc","(","mat3","(","u_v_light_ts","[","2","]",",","u_v_light_r","[","2","]",",","0.0",")",")",";"]}]}}]},{TYPE:"txt",TOKENS:["Jj","=","Jg","*","vec4","(","fn","+","u_normal_offset","*","Ji",",","1.0",")",";","u","=","Jh","(","u_p_light_matrix2",",","Jj",",","Jg",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_CAST_LAMPS",3,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["MAC_OS_SHADOW_HACK"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["Jg","=","bc","(","u_v_light_tsr","[","3","]",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["Jg","=","bc","(","mat3","(","u_v_light_ts","[","3","]",",","u_v_light_r","[","3","]",",","0.0",")",")",";"]}]}}]},{TYPE:"txt",TOKENS:["Jj","=","Jg","*","vec4","(","fn","+","u_normal_offset","*","Ji",",","1.0",")",";","v","=","Jh","(","u_p_light_matrix3",",","Jj",",","Jg",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION1"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["o","=","Jh","(","u_p_light_matrix1",",","Jj",",","Jg",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION2"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["u","=","Jh","(","u_p_light_matrix2",",","Jj",",","Jg",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION3"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["v","=","Jh","(","u_p_light_matrix3",",","Jj",",","Jg",")",";"]}]}}]},{TYPE:"txt",TOKENS:["}"]}]}}]}]}}]}]},e["include/skin.glslv"]={TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"SKIN_GLSLV",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"SKIN_GLSLV",TOKENS:[""]},{TYPE:"var",NAME:"DISABLE_TANGENT_SKINNING",TOKENS:["0"]},{TYPE:"var",NAME:"SKINNED",TOKENS:["0"]},{TYPE:"var",NAME:"FRAMES_BLENDING",TOKENS:["0"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SKINNED"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"math.glslv"},{TYPE:"define",NAME:"SKIN_SLERP",TOKENS:["0"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SKIN_SLERP"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec4","Jr","(","in","vec4","qV",",","in","vec4","Jk",",","in","float","Jl",")","{","float","Jm","=","qV","[","0","]","*","Jk","[","0","]","+","qV","[","1","]","*","Jk","[","1","]","+","qV","[","2","]","*","Jk","[","2","]","+","qV","[","3","]","*","Jk","[","3","]",";","if","(","Jm","<","0.0",")","{","Jk","*=","-","1.0",";","Jm","=","-","Jm",";","}","if","(","abs","(","Jm",")",">=","1.0",")","return","qV",";","float","Jn","=","acos","(","Jm",")",";","float","Jo","=","sqrt","(","1.0","-","Jm","*","Jm",")",";","if","(","abs","(","Jo",")","<","0.001",")","return","vec4","(","qV","*","0.5","+","Jk","*","0.5",")",";","float","Jp","=","sin","(","(","1.0","-","Jl",")","*","Jn",")","/","Jo",";","float","Jq","=","sin","(","Jl","*","Jn",")","/","Jo",";","return","qV","*","Jp","+","Jk","*","Jq",";","}"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FRAMES_BLENDING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","JF","(","in","vec3","O",",","in","vec4","Js",",","in","vec4","Jt",",","in","vec4","Ju",",","in","vec4","Jv",",","in","float","Jw",")","{","vec3","Jx","=","rh","(","u_arm_rel_trans",",","u_arm_rel_quat",",","O",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SKIN_SLERP"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec4","qV","=","Jr","(","Js",",","Jt",",","Jw",")",";","vec4","Jy","=","mix","(","Ju",",","Jv",",","Jw",")",";","vec3","Jz","=","T","(","qV",",","Jx",")",";","vec3","JA","=","Jz","*","Jy",".","w","+","Jy",".","xyz",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","JB","=","T","(","Js",",","Jx",")",";","vec3","JC","=","T","(","Jt",",","Jx",")",";","vec3","JD","=","JB","*","Ju",".","w","+","Ju",".","xyz",";","vec3","JE","=","JC","*","Jv",".","w","+","Jv",".","xyz",";","vec3","JA","=","mix","(","JD",",","JE",",","Jw",")",";"]}]}}]},{TYPE:"txt",TOKENS:["return","rk","(","u_arm_rel_trans",",","u_arm_rel_quat",",","JA",")",";","}","vec3","JL","(","in","vec3","JG",",","in","vec4","Js",",","in","vec4","Jt",",","in","float","Jw",")","{","vec3","JH","=","rj","(","u_arm_rel_trans",",","u_arm_rel_quat",",","JG",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SKIN_SLERP"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec4","qV","=","Jr","(","Js",",","Jt",",","Jw",")",";","vec3","JI","=","T","(","qV",",","JH",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","JJ","=","T","(","Js",",","JH",")",";","vec3","JK","=","T","(","Jt",",","JH",")",";","vec3","JI","=","mix","(","JJ",",","JK",",","Jw",")",";"]}]}}]},{TYPE:"txt",TOKENS:["return","rl","(","u_arm_rel_trans",",","u_arm_rel_quat",",","JI",")",";","}"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","JF","(","in","vec3","O",",","in","vec4","Js",",","in","vec4","Ju",")","{","vec3","Jx","=","rh","(","u_arm_rel_trans",",","u_arm_rel_quat",",","O",")",";","vec3","Jz","=","T","(","Js",",","Jx",")",";","vec3","JA","=","Jz","*","Ju",".","w","+","Ju",".","xyz",";","return","rk","(","u_arm_rel_trans",",","u_arm_rel_quat",",","JA",")",";","}","vec3","JL","(","in","vec3","JG",",","in","vec4","Js",")","{","vec3","JH","=","rj","(","u_arm_rel_trans",",","u_arm_rel_quat",",","JG",")",";","vec3","JI","=","T","(","Js",",","JH",")",";","return","rl","(","u_arm_rel_trans",",","u_arm_rel_quat",",","JI",")",";","}"]}]}}]},{TYPE:"txt",TOKENS:["void","an","(","inout","vec3","O",",","inout","vec3","V",",","inout","vec3","W",",","inout","vec3","U",")","{"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FRAMES_BLENDING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","JM","=","u_frame_factor",";"]}]}}]},{TYPE:"txt",TOKENS:["if","(","a_influence",".","y",">","0.0",")","{","vec3","jD","=","vec3","(","0.0",",","0.0",",","0.0",")",";","vec3","JN","=","vec3","(","0.0",",","0.0",",","0.0",")",";","vec3","JO","=","vec3","(","0.0",",","0.0",",","0.0",")",";","vec3","JP","=","vec3","(","0.0",",","0.0",",","0.0",")",";","vec4","JQ","=","a_influence",";","for","(","int","cl","=","0",";","cl","<","4",";","cl","++",")","{","int","JR","=","int","(","JQ","[","cl","]",")",";","float","JS","=","fract","(","JQ","[","cl","]",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FRAMES_BLENDING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["JN","+=","JS","*","JL","(","V",",","u_quatsb","[","JR","]",",","u_quatsa","[","JR","]",",","JM",")",";","JO","+=","JS","*","JL","(","W",",","u_quatsb","[","JR","]",",","u_quatsa","[","JR","]",",","JM",")",";","JP","+=","JS","*","JL","(","U",",","u_quatsb","[","JR","]",",","u_quatsa","[","JR","]",",","JM",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["jD","+=","JS","*","JF","(","O",",","u_quatsb","[","JR","]",",","u_transb","[","JR","]",")",";","JP","+=","JS","*","JL","(","U",",","u_quatsb","[","JR","]",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DISABLE_TANGENT_SKINNING",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["JN","+=","JS","*","JL","(","V",",","u_quatsb","[","JR","]",")",";","JO","+=","JS","*","JL","(","W",",","u_quatsb","[","JR","]",")",";"]}]}}]}]}}]},{TYPE:"txt",TOKENS:["}"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FRAMES_BLENDING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["int","JR","=","int","(","JQ","[","0","]",")",";","float","JS","=","fract","(","JQ","[","0","]",")",";","jD","+=","JS","*","JF","(","O",",","u_quatsb","[","JR","]",",","u_quatsa","[","JR","]",",","u_transb","[","JR","]",",","u_transa","[","JR","]",",","JM",")",";","JR","=","int","(","JQ","[","1","]",")",";","JS","=","fract","(","JQ","[","1","]",")",";","jD","+=","JS","*","JF","(","O",",","u_quatsb","[","JR","]",",","u_quatsa","[","JR","]",",","u_transb","[","JR","]",",","u_transa","[","JR","]",",","JM",")",";","JR","=","int","(","JQ","[","2","]",")",";","JS","=","fract","(","JQ","[","2","]",")",";","jD","+=","JS","*","JF","(","O",",","u_quatsb","[","JR","]",",","u_quatsa","[","JR","]",",","u_transb","[","JR","]",",","u_transa","[","JR","]",",","JM",")",";","JR","=","int","(","JQ","[","3","]",")",";","JS","=","fract","(","JQ","[","3","]",")",";","jD","+=","JS","*","JF","(","O",",","u_quatsb","[","JR","]",",","u_quatsa","[","JR","]",",","u_transb","[","JR","]",",","u_transa","[","JR","]",",","JM",")",";"]}]}}]},{TYPE:"txt",TOKENS:["O","=","jD",";","U","=","JP",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DISABLE_TANGENT_SKINNING",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["V","=","JN",";","W","=","JO",";"]}]}}]},{TYPE:"txt",TOKENS:["}","if","(","!","(","a_influence",".","y",">","0.0",")",")","{","int","JT","=","int","(","a_influence","[","0","]","-","1.0",")",";","if","(","JT",">","-","1",")","{"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FRAMES_BLENDING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["O","=","JF","(","O",",","u_quatsb","[","JT","]",",","u_quatsa","[","JT","]",",","u_transb","[","JT","]",",","u_transa","[","JT","]",",","JM",")",";","V","=","JL","(","V",",","u_quatsb","[","JT","]",",","u_quatsa","[","JT","]",",","JM",")",";","W","=","JL","(","W",",","u_quatsb","[","JT","]",",","u_quatsa","[","JT","]",",","JM",")",";","U","=","JL","(","U",",","u_quatsb","[","JT","]",",","u_quatsa","[","JT","]",",","JM",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["O","=","JF","(","O",",","u_quatsb","[","JT","]",",","u_transb","[","JT","]",")",";","U","=","JL","(","U",",","u_quatsb","[","JT","]",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DISABLE_TANGENT_SKINNING",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["V","=","JL","(","V",",","u_quatsb","[","JT","]",")",";","W","=","JL","(","W",",","u_quatsb","[","JT","]",")",";"]}]}}]}]}}]},{TYPE:"txt",TOKENS:["}","}","}"]}]}}]}]}}]}]},e["include/sky_blending.glslf"]={TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"SKY_BLENDING_GLSLF",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"SKY_BLENDING_GLSLF",TOKENS:[""]},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",FILE:"blending.glslf"},{TYPE:"var",NAME:"WO_SKYREAL",TOKENS:["0"]},{TYPE:"var",NAME:"WO_SKYBLEND",TOKENS:["0"]},{TYPE:"var",NAME:"BLENDTYPE",TOKENS:["MIX"]},{TYPE:"var",NAME:"MTEX_RGBTOINT",TOKENS:["0"]},{TYPE:"var",NAME:"WOMAP_HORIZ",TOKENS:["0"]},{TYPE:"var",NAME:"WOMAP_ZENUP",TOKENS:["0"]},{TYPE:"var",NAME:"WOMAP_ZENDOWN",TOKENS:["0"]},{TYPE:"var",NAME:"WOMAP_BLEND",TOKENS:["0"]},{TYPE:"var",NAME:"MTEX_NEGATIVE",TOKENS:["0"]},{TYPE:"txt",TOKENS:["vec3","JU","(","vec3","ki",",","vec3","kj",",","float","aL",",","float","kI",")","{","float","kk","=","aL","*","kI",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["BLENDTYPE","MIX",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["return","kl","(","kj",",","ki",",","kk",")",";"]}]}},{TYPE:"elif",EXPRESSION:["BLENDTYPE","ADD",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["return","km","(","ki",",","kj",",","kk",")",";"]}]}},{TYPE:"elif",EXPRESSION:["BLENDTYPE","SUBTRACT",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["return","kn","(","ki",",","kj",",","kk",")",";"]}]}},{TYPE:"elif",EXPRESSION:["BLENDTYPE","MULTIPLY",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["return","kp","(","ki",",","kj",",","kk",")",";"]}]}},{TYPE:"elif",EXPRESSION:["BLENDTYPE","SCREEN",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["return","kq","(","ki",",","kj",",","kk",")",";"]}]}},{TYPE:"elif",EXPRESSION:["BLENDTYPE","OVERLAY",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["return","kr","(","ki",",","kj",",","kk",")",";"]}]}},{TYPE:"elif",EXPRESSION:["BLENDTYPE","DIFFERENCE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["return","ks","(","ki",",","kj",",","kk",")",";"]}]}},{TYPE:"elif",EXPRESSION:["BLENDTYPE","DIVIDE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["return","kt","(","ki",",","kj",",","kk",")",";"]}]}},{TYPE:"elif",EXPRESSION:["BLENDTYPE","DARKEN",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["return","ku","(","ki",",","kj",",","kk",")",";"]}]}},{TYPE:"elif",EXPRESSION:["BLENDTYPE","LIGHTEN",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["return","kv","(","ki",",","kj",",","kk",")",";"]}]}},{TYPE:"elif",EXPRESSION:["BLENDTYPE","HUE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["return","kz","(","kj",",","ki",",","kk",")",";"]}]}},{TYPE:"elif",EXPRESSION:["BLENDTYPE","SATURATION",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["return","kA","(","kj",",","ki",",","kk",")",";"]}]}},{TYPE:"elif",EXPRESSION:["BLENDTYPE","VALUE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["return","kB","(","kj",",","ki",",","kk",")",";"]}]}},{TYPE:"elif",EXPRESSION:["BLENDTYPE","COLOR",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["return","kC","(","kj",",","ki",",","kk",")",";"]}]}},{TYPE:"elif",EXPRESSION:["BLENDTYPE","SOFT_LIGHT",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["return","kE","(","kj",",","ki",",","kk",")",";"]}]}},{TYPE:"elif",EXPRESSION:["BLENDTYPE","LINEAR_LIGHT",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["return","kF","(","kj",",","ki",",","kk",")",";"]}]}}]},{TYPE:"txt",TOKENS:["return","vec3","(","1.0",",","0.0",",","1.0",")",";","}","float","JV","(","float","kG",",","float","kH",",","float","aL",",","float","kI",")","{","vec3","ki","=","vec3","(","kG",")",",","kj","=","vec3","(","kH",")",";","float","kk","=","aL","*","kI",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["BLENDTYPE","MIX",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["return","kl","(","kj",",","ki",",","kk",")",".","x",";"]}]}},{TYPE:"elif",EXPRESSION:["BLENDTYPE","ADD",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["return","km","(","ki",",","kj",",","kk",")",".","x",";"]}]}},{TYPE:"elif",EXPRESSION:["BLENDTYPE","SUBTRACT",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["return","kn","(","ki",",","kj",",","kk",")",".","x",";"]}]}},{TYPE:"elif",EXPRESSION:["BLENDTYPE","MULTIPLY",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["return","kJ","(","kG",",","kH",",","kk",",","kI",")",";"]}]}},{TYPE:"elif",EXPRESSION:["BLENDTYPE","SCREEN",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["return","kK","(","kG",",","kH",",","kk",",","kI",")",";"]}]}},{TYPE:"elif",EXPRESSION:["BLENDTYPE","OVERLAY",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["return","kL","(","kG",",","kH",",","kk",",","kI",")",";"]}]}},{TYPE:"elif",EXPRESSION:["BLENDTYPE","DIFFERENCE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["return","ks","(","ki",",","kj",",","kk",")",".","x",";"]}]}},{TYPE:"elif",EXPRESSION:["BLENDTYPE","DIVIDE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["return","kt","(","ki",",","kj",",","kk",")",".","x",";"]}]}},{TYPE:"elif",EXPRESSION:["BLENDTYPE","DARKEN",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["return","ku","(","ki",",","kj",",","kk",")",".","x",";"]}]}},{TYPE:"elif",EXPRESSION:["BLENDTYPE","LIGHTEN",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["return","kv","(","ki",",","kj",",","kk",")",".","x",";"]}]}},{TYPE:"elif",EXPRESSION:["BLENDTYPE","SOFT_LIGHT",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["return","kE","(","kj",",","ki",",","kk",")",".","x",";"]}]}},{TYPE:"elif",EXPRESSION:["BLENDTYPE","LINEAR_LIGHT",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["return","kF","(","kj",",","ki",",","kk",")",".","x",";"]}]}}]},{TYPE:"txt",TOKENS:["return","0.0",";","}","vec3","eB","(","vec3","ex",",","vec3","ey",",","vec4","eA",",","float","ew",",","vec3","ez",")","{","float","JW","=","1.0",";","JW","=","eA",".","a",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["MTEX_RGBTOINT"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["JW","=","ge","(","eA",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["MTEX_NEGATIVE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["MTEX_RGBTOINT",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["eA","=","vec4","(","vec3","(","1.0",")","-","eA",".","rgb",",","eA",".","a",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["JW","=","1.0","-","JW",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WOMAP_HORIZ","WOMAP_ZENUP","WOMAP_ZENDOWN",{TYPE:"logical_or_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["MTEX_RGBTOINT"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["eA","=","vec4","(","u_sky_tex_color",",","1.0",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["JW","=","eA",".","a",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WOMAP_HORIZ"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["ex","=","JU","(","eA",".","rgb",",","ex",",","JW",",","u_sky_tex_fac","[","1","]",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WOMAP_ZENUP","WOMAP_ZENDOWN",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","JX","=","0.0",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WO_SKYREAL"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["if","(","dot","(","ez",",","vec3","(","0.0",",","0.0",",","1.0",")",")",">=","0.0",")","{"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WOMAP_ZENUP"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["JX","=","u_sky_tex_fac","[","2","]",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:[";"]}]}}]},{TYPE:"txt",TOKENS:["}"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WOMAP_ZENDOWN"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["else","JX","=","u_sky_tex_fac","[","3","]",";"]}]}}]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WOMAP_ZENUP"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["JX","=","u_sky_tex_fac","[","2","]",";"]}]}},{TYPE:"elif",EXPRESSION:["WOMAP_ZENDOWN"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["JX","=","u_sky_tex_fac","[","3","]",";"]}]}}]}]}}]},{TYPE:"txt",TOKENS:["if","(","JX","!=","0.0",")","ey","=","JU","(","eA",".","rgb",",","ey",",","JW",",","JX",")",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WOMAP_BLEND"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["MTEX_RGBTOINT",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["JW","=","dot","(","eA",".","rgb",",","vec3","(","0.2126",",","0.7152",",","0.0722",")",")",";"]}]}}]},{TYPE:"txt",TOKENS:["ew","=","JV","(","u_sky_tex_dvar",",","ew",",","JW",",","u_sky_tex_fac","[","0","]",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WO_SKYBLEND"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","bs","=","mix","(","ex",",","ey",",","ew",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","bs","=","ex",";"]}]}}]},{TYPE:"txt",TOKENS:["return","bs",";","}"]}]}}]}]},e["include/std.glsl"]={TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"STD_ENUMS_GLSL",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"STD_ENUMS_GLSL",TOKENS:[""]},{TYPE:"var",NAME:"CONSTANTS_HACK",TOKENS:["0"]},{TYPE:"define",NAME:"TEXTURE_COORDS_NONE",TOKENS:["0"]},{TYPE:"define",NAME:"TEXTURE_COORDS_UV_ORCO",TOKENS:["1"]},{TYPE:"define",NAME:"TEXTURE_COORDS_NORMAL",TOKENS:["2"]},{TYPE:"define",NAME:"TEXTURE_BLEND_TYPE_MIX",TOKENS:["1"]},{TYPE:"define",NAME:"TEXTURE_BLEND_TYPE_MULTIPLY",TOKENS:["2"]},{TYPE:"define",NAME:"SHADOW_SRC_NONE",TOKENS:["1"]},{TYPE:"define",NAME:"SHADOW_SRC_DEPTH",TOKENS:["2"]},{TYPE:"define",NAME:"SHADOW_SRC_MASK",TOKENS:["3"]},{TYPE:"define",NAME:"SHADOW_DST_NONE",TOKENS:["1"]},{TYPE:"define",NAME:"SHADOW_DST_DEPTH",TOKENS:["2"]},{TYPE:"define",NAME:"SHADOW_DST_MASK",TOKENS:["3"]},{TYPE:"define",NAME:"NO_SHADOWS",TOKENS:["1"]},{TYPE:"define",NAME:"SHADOW_CASTING",TOKENS:["2"]},{TYPE:"define",NAME:"SHADOW_MASK_GENERATION",TOKENS:["3"]},{TYPE:"define",NAME:"SHADOW_MAPPING_OPAQUE",TOKENS:["4"]},{TYPE:"define",NAME:"SHADOW_MAPPING_BLEND",TOKENS:["5"]},{TYPE:"define",NAME:"POISSON_X_16",TOKENS:["4"]},{TYPE:"define",NAME:"POISSON_X_8",TOKENS:["2"]},{TYPE:"define",NAME:"POISSON_X_4",TOKENS:["1"]},{TYPE:"define",NAME:"NO_SOFT_SHADOWS",TOKENS:["0"]},{TYPE:"define",NAME:"SPECULAR_PHONG",TOKENS:["1"]},{TYPE:"define",NAME:"SPECULAR_COOKTORR",TOKENS:["2"]},{TYPE:"define",NAME:"SPECULAR_WARDISO",TOKENS:["3"]},{TYPE:"define",NAME:"SPECULAR_BLINN",TOKENS:["4"]},{TYPE:"define",NAME:"SPECULAR_TOON",TOKENS:["5"]},{TYPE:"define",NAME:"DIFFUSE_LAMBERT",TOKENS:["1"]},{TYPE:"define",NAME:"DIFFUSE_OREN_NAYAR",TOKENS:["2"]},{TYPE:"define",NAME:"DIFFUSE_FRESNEL",TOKENS:["3"]},{TYPE:"define",NAME:"DIFFUSE_MINNAERT",TOKENS:["4"]},{TYPE:"define",NAME:"DIFFUSE_TOON",TOKENS:["5"]},{TYPE:"define",NAME:"MIX",TOKENS:["0"]},{TYPE:"define",NAME:"ADD",TOKENS:["1"]},{TYPE:"define",NAME:"SUBTRACT",TOKENS:["2"]},{TYPE:"define",NAME:"MULTIPLY",TOKENS:["3"]},{TYPE:"define",NAME:"SCREEN",TOKENS:["4"]},{TYPE:"define",NAME:"OVERLAY",TOKENS:["5"]},{TYPE:"define",NAME:"DIFFERENCE",TOKENS:["6"]},{TYPE:"define",NAME:"DIVIDE",TOKENS:["7"]},{TYPE:"define",NAME:"DARKEN",TOKENS:["8"]},{TYPE:"define",NAME:"LIGHTEN",TOKENS:["9"]},{TYPE:"define",NAME:"HUE",TOKENS:["10"]},{TYPE:"define",NAME:"SATURATION",TOKENS:["11"]},{TYPE:"define",NAME:"VALUE",TOKENS:["12"]},{TYPE:"define",NAME:"COLOR",TOKENS:["13"]},{TYPE:"define",NAME:"SOFT_LIGHT",TOKENS:["14"]},{TYPE:"define",NAME:"LINEAR_LIGHT",TOKENS:["15"]},{TYPE:"define",NAME:"REFL_NONE",TOKENS:["0"]},{TYPE:"define",NAME:"REFL_MIRRORMAP",TOKENS:["1"]},{TYPE:"define",NAME:"REFL_PLANE",TOKENS:["2"]},{TYPE:"define",NAME:"REFL_CUBE",TOKENS:["3"]},{TYPE:"define",NAME:"REFL_PBR_SIMPLE",TOKENS:["4"]},{TYPE:"define",NAME:"REFL_PBR_STANDARD",TOKENS:["5"]},{TYPE:"define",NAME:"INVERSE_QUADRATIC",TOKENS:["0"]},{TYPE:"define",NAME:"LINEAR",TOKENS:["1"]},{TYPE:"define",NAME:"QUADRATIC",TOKENS:["2"]},{TYPE:"define",NAME:"HEMI",TOKENS:["1"]},{TYPE:"define",NAME:"SPOT",TOKENS:["2"]},{TYPE:"define",NAME:"POINT",TOKENS:["3"]},{TYPE:"define",NAME:"SUN",TOKENS:["4"]},{TYPE:"define",NAME:"DOF_SIMPLE",TOKENS:["0"]},{TYPE:"define",NAME:"DOF_BOKEH",TOKENS:["1"]},{TYPE:"define",NAME:"COC_ALL",TOKENS:["0"]},{TYPE:"define",NAME:"COC_FOREGROUND",TOKENS:["1"]},{TYPE:"define",NAME:"COC_COMBINE",TOKENS:["2"]},{TYPE:"define",NAME:"VT_WORLD_TO_WORLD",TOKENS:["0"]},{TYPE:"define",NAME:"VT_WORLD_TO_OBJECT",TOKENS:["1"]},{TYPE:"define",NAME:"VT_WORLD_TO_CAMERA",TOKENS:["2"]},{TYPE:"define",NAME:"VT_OBJECT_TO_WORLD",TOKENS:["3"]},{TYPE:"define",NAME:"VT_OBJECT_TO_OBJECT",TOKENS:["4"]},{TYPE:"define",NAME:"VT_OBJECT_TO_CAMERA",TOKENS:["5"]},{TYPE:"define",NAME:"VT_CAMERA_TO_WORLD",TOKENS:["6"]},{TYPE:"define",NAME:"VT_CAMERA_TO_OBJECT",TOKENS:["7"]},{TYPE:"define",NAME:"VT_CAMERA_TO_CAMERA",TOKENS:["8"]},{TYPE:"define",NAME:"VT_POINT",TOKENS:["0"]},{TYPE:"define",NAME:"VT_VECTOR",TOKENS:["1"]},{TYPE:"define",NAME:"VT_NORMAL",TOKENS:["2"]},{TYPE:"define",NAME:"NM_TANGENT",TOKENS:["0"]},{TYPE:"define",NAME:"NM_OBJECT",TOKENS:["1"]},{TYPE:"define",NAME:"NM_WORLD",TOKENS:["2"]},{TYPE:"define",NAME:"NM_BLENDER_OBJECT",TOKENS:["3"]},{TYPE:"define",NAME:"NM_BLENDER_WORLD",TOKENS:["4"]},{TYPE:"define",NAME:"BILLBOARD_ALIGN_VIEW",TOKENS:["1"]},{TYPE:"define",NAME:"BILLBOARD_ALIGN_XY",TOKENS:["2"]},{TYPE:"define",NAME:"BILLBOARD_ALIGN_YZ",TOKENS:["3"]},{TYPE:"define",NAME:"BILLBOARD_ALIGN_ZX",TOKENS:["4"]},{TYPE:"define",NAME:"POST_EFFECT_NONE",TOKENS:["1"]},{TYPE:"define",NAME:"POST_EFFECT_GRAYSCALE",TOKENS:["2"]},{TYPE:"define",NAME:"POST_EFFECT_BLUR",TOKENS:["3"]},{TYPE:"define",NAME:"POST_EFFECT_GLOW_BLUR",TOKENS:["4"]},{TYPE:"define",NAME:"POST_EFFECT_DOF_BLUR",TOKENS:["5"]},{TYPE:"define",NAME:"POST_EFFECT_ALPHA_BLUR",TOKENS:["6"]},{TYPE:"define",NAME:"POST_EFFECT_EXTEND",TOKENS:["7"]},{TYPE:"define",NAME:"FLIP_CUBEMAP_COORDS",TOKENS:["8"]},{TYPE:"define",NAME:"BLUR_PASS_1",TOKENS:["1"]},{TYPE:"define",NAME:"BLUR_PASS_2",TOKENS:["2"]},{TYPE:"define",NAME:"BLUR_PASS_3",TOKENS:["3"]},{TYPE:"define",NAME:"BLUR_PASS_4",TOKENS:["4"]},{TYPE:"define",NAME:"BLUR_PASS_5",TOKENS:["5"]},{TYPE:"define",NAME:"DV_NONE",TOKENS:["0"]},{TYPE:"define",NAME:"DV_OPAQUE_WIREFRAME",TOKENS:["1"]},{TYPE:"define",NAME:"DV_TRANSPARENT_WIREFRAME",TOKENS:["2"]},{TYPE:"define",NAME:"DV_FRONT_BACK_VIEW",TOKENS:["3"]},{TYPE:"define",NAME:"DV_BOUNDINGS",TOKENS:["4"]},{TYPE:"define",NAME:"DV_CLUSTERS_VIEW",TOKENS:["5"]},{TYPE:"define",NAME:"DV_BATCHES_VIEW",TOKENS:["6"]},{TYPE:"define",NAME:"DV_RENDER_TIME",TOKENS:["7"]},{TYPE:"define",NAME:"SSAO_QUALITY_8",TOKENS:["1"]},{TYPE:"define",NAME:"SSAO_QUALITY_16",TOKENS:["2"]},{TYPE:"define",NAME:"SSAO_QUALITY_24",TOKENS:["3"]},{TYPE:"define",NAME:"SSAO_QUALITY_32",TOKENS:["4"]},{TYPE:"define",NAME:"AA_METHOD_FXAA_LIGHT",TOKENS:["1"]},{TYPE:"define",NAME:"AA_METHOD_FXAA_QUALITY",TOKENS:["2"]},{TYPE:"define",NAME:"AA_QUALITY_LOW",TOKENS:["0"]},{TYPE:"define",NAME:"AA_QUALITY_MEDIUM",TOKENS:["1"]},{TYPE:"define",NAME:"AA_QUALITY_HIGH",TOKENS:["2"]},{TYPE:"define",NAME:"SMAA_RESOLVE",TOKENS:["25"]},{TYPE:"define",NAME:"SMAA_EDGE_DETECTION",TOKENS:["24"]},{TYPE:"define",NAME:"SMAA_BLENDING_WEIGHT_CALCULATION",TOKENS:["23"]},{TYPE:"define",NAME:"SMAA_NEIGHBORHOOD_BLENDING",TOKENS:["26"]},{TYPE:"define",NAME:"AA_METHOD_SMAA_LOW",TOKENS:["1"]},{TYPE:"define",NAME:"AA_METHOD_SMAA_MEDIUM",TOKENS:["2"]},{TYPE:"define",NAME:"AA_METHOD_SMAA_HIGH",TOKENS:["3"]},{TYPE:"define",NAME:"AA_METHOD_SMAA_ULTRA",TOKENS:["4"]},{TYPE:"define",NAME:"REFL_PASS_NONE",TOKENS:["0"]},{TYPE:"define",NAME:"REFL_PASS_PLANE",TOKENS:["1"]},{TYPE:"define",NAME:"REFL_PASS_CUBE",TOKENS:["2"]},{TYPE:"define",NAME:"SRGB_NONE",TOKENS:["0"]},{TYPE:"define",NAME:"SRGB_SIMPLE",TOKENS:["1"]},{TYPE:"define",NAME:"SRGB_PROPER",TOKENS:["2"]},{TYPE:"define",NAME:"CAM_TYPE_ORTHO",TOKENS:["0"]},{TYPE:"define",NAME:"CAM_TYPE_PERSP",TOKENS:["1"]},{TYPE:"define",NAME:"M_PI",TOKENS:["3.14159265359"]},{TYPE:"define",NAME:"M_PI_4",TOKENS:["0.785398163"]},{TYPE:"define",NAME:"INV_PI",TOKENS:["0.318309886"]},{TYPE:"define",NAME:"UP_VECTOR",TOKENS:["vec3","(","0.0",",","0.0",",","1.0",")"]},{TYPE:"define",NAME:"RIGHT_VECTOR",TOKENS:["vec3","(","1.0",",","0.0",",","0.0",")"]},{TYPE:"define",NAME:"TOWARD_VECTOR",TOKENS:["vec3","(","0.0",",","-","1.0",",","0.0",")"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CONSTANTS_HACK"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","_0_0","=","0.0",";","float","_0_5","=","0.5",";","float","_1_0","=","1.0",";","float","_255_0","=","255.0",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"_0_0",TOKENS:["0.0"]},{TYPE:"define",NAME:"_0_5",TOKENS:["0.5"]},{TYPE:"define",NAME:"_1_0",TOKENS:["1.0"]},{TYPE:"define",NAME:"_255_0",TOKENS:["255.0"]}]}}]}]}}]}]},e["include/to_world.glslv"]={TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"TO_WORLD_GLSLV",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"TO_WORLD_GLSLV",TOKENS:[""]},{TYPE:"include",FILE:"math.glslv"},{TYPE:"var",NAME:"BILLBOARD_ALIGN",TOKENS:["BILLBOARD_ALIGN_VIEW"]},{TYPE:"var",NAME:"BILLBOARD_SPHERICAL",TOKENS:["0"]},{TYPE:"var",NAME:"BILLBOARD_RANDOM",TOKENS:["0"]},{TYPE:"var",NAME:"BILLBOARD",TOKENS:["0"]},{TYPE:"var",NAME:"BILLBOARD_JITTERED",TOKENS:["0"]},{TYPE:"var",NAME:"BILLBOARD_PRES_GLOB_ORIENTATION",TOKENS:["0"]},{TYPE:"var",NAME:"STATIC_BATCH",TOKENS:["0"]},{TYPE:"var",NAME:"REFLECTION_PASS",TOKENS:["REFL_PASS_NONE"]},{TYPE:"define",NAME:"MAX_BILLBOARD_ANGLE",TOKENS:["M_PI_4"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["BILLBOARD_SPHERICAL","BILLBOARD",{TYPE:"logic_negative_expr",PLACES:1},"BILLBOARD_ALIGN","BILLBOARD_ALIGN_VIEW",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_and_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["mat3","bj","(","vec3","JY",",","mat3","N",")","{","vec4","JZ","=","vec4","(","N","[","1","]","[","1","]",",","N","[","1","]","[","2","]",",","N","[","2","]","[","0","]",",","N","[","2","]","[","1","]",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_PASS","REFL_PASS_PLANE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec4","J_","=","X","(","RIGHT_VECTOR",",","-","M_PI","/","2.0",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec4","J_","=","X","(","RIGHT_VECTOR",",","M_PI","/","2.0",")",";"]}]}}]},{TYPE:"txt",TOKENS:["JZ","=","qX","(","J_",",","JZ",")",";","JZ","=","kR","(","JZ",")",";","mat3","bk","=","da","(",")",";","bk","[","0","]","=","JY",";","bk","=","dd","(","JZ",",","bk",")",";","return","bk",";","}"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["mat3","Kb","(","vec3","lH",",","vec3","JY",")","{","vec3","Ka","=","lH","-","JY",";","Ka",".","z","=","0.0",";","Ka","=","normalize","(","Ka",")",";","vec4","JZ","=","rd","(","Ka",",","TOWARD_VECTOR",")",";","mat3","bk","=","da","(",")",";","bk","[","0","]","=","JY",";","bk","=","dd","(","JZ",",","bk",")",";","return","bk",";","}"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["BILLBOARD_JITTERED"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["mat3","at","(","in","vec3","Kc",",","float","Kd",",","float","Ke",",","float","Kf",",","vec3","a_",",","mat3","Z",")","{","float","Ic","=","fract","(","length","(","a_",")","/","0.17",")",";","float","Kg","=","Kf","+","Ic","/","10.0",";","float","Kh","=","Ic",";","if","(","Kf","!=","0.0",")","Kh","/=","Kf",";","Kc","*=","1.0","+","0.5","*","sin","(","Kd",")",";","float","Ki","=","length","(","Kc",")","*","Ke","*","sin","(","2.0","*","3.14","*","Kd","*","Kg","+","Kh",")",";","vec4","Kj","=","X","(","TOWARD_VECTOR",",","Ki",")",";","vec4","Kk","=","vec4","(","Z","[","1","]","[","1","]",",","Z","[","1","]","[","2","]",",","Z","[","2","]","[","0","]",",","Z","[","2","]","[","1","]",")",";","Kk","=","qX","(","Kk",",","Kj",")",";","Z","=","dd","(","Kk",",","Z",")",";","return","Z",";","}"]}]}}]},{TYPE:"txt",TOKENS:["mat3","as","(","in","vec3","lH",",","in","vec3","aq",",","in","mat3","N",",","in","mat3","Z",")","{"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["BILLBOARD_SPHERICAL","BILLBOARD",{TYPE:"logic_negative_expr",PLACES:1},"BILLBOARD_ALIGN","BILLBOARD_ALIGN_VIEW",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_and_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["mat3","lW","=","bj","(","aq",",","N",")",";"]}]}},{TYPE:"elif",EXPRESSION:["BILLBOARD_RANDOM"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","Ic","=","fract","(","(","aq",".","x","*","1.43","-","aq",".","z","*","0.123","+","aq",".","y","*","6.1",")",")",";","float","Kl","=","2.0","*","M_PI","*","Ic",";","vec4","Km","=","vec4","(","N","[","1","]","[","1","]",",","N","[","1","]","[","2","]",",","N","[","2","]","[","0","]",",","N","[","2","]","[","1","]",")",";","float","Kn","=","asin","(","2.0","*","(","Km",".","x","*","Km",".","y","-","Km",".","z","*","Km",".","w",")",")",";","float","hu","=","Kn","-","Kl",";","if","(","hu","<","0.0",")","hu","=","2.0","*","M_PI","+","hu",";","float","Ko","=","Kl",";","if","(","hu","<=","MAX_BILLBOARD_ANGLE",")","Ko","+=","hu",";","else","if","(","hu","<=","M_PI","-","MAX_BILLBOARD_ANGLE",")","Ko","+=","MAX_BILLBOARD_ANGLE","*","(","2.0","*","hu","-","M_PI",")","/","(","2.0","*","MAX_BILLBOARD_ANGLE","-","M_PI",")",";","else","if","(","hu","<=","M_PI","+","MAX_BILLBOARD_ANGLE",")","Ko","+=","hu","-","M_PI",";","else","if","(","hu","<=","2.0","*","M_PI","-","MAX_BILLBOARD_ANGLE",")","Ko","+=","MAX_BILLBOARD_ANGLE","*","(","2.0","*","hu","-","M_PI",")","/","(","2.0","*","MAX_BILLBOARD_ANGLE","-","M_PI",")","+","M_PI",";","else","Ko","+=","hu","-","2.0","*","M_PI",";","vec4","Kp","=","X","(","UP_VECTOR",",","Ko",")",";","mat3","lW","=","da","(",")",";","lW","[","0","]","=","aq",";","lW","=","dd","(","Kp",",","lW",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["mat3","lW","=","Kb","(","lH",",","aq",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["BILLBOARD_PRES_GLOB_ORIENTATION","STATIC_BATCH",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["Z","[","0","]","=","vec3","(","0.0",",","0.0",",","0.0",")",";","lW","=","aY","(","lW",",","Z",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["lW","[","1","]","[","0","]","*=","Z","[","1","]","[","0","]",";"]}]}}]},{TYPE:"txt",TOKENS:["return","lW",";","}","au","av","(","in","vec3","fn",",","in","vec3","Kq",",","in","vec3","Kr",",","in","vec3","Ks",",","in","vec3","Kt",",","in","vec3","Ku",",","in","mat3","Z",")","{","fn","=","ap","(","Z",",","fn",")",";","Kq","=","ap","(","Z",",","Kq",")",";","Kr","=","_","(","Z",",","Kr",")",";","Ks","=","_","(","Z",",","Ks",")",";","Kt","=","_","(","Z",",","Kt",")",";","Ku","=","_","(","Z",",","Ku",")",";","return","lX","(","au","(","fn",",","Kq",",","Kr",",","Ks",",","Kt",",","Ku",",","vec3","(","0.0",")",")",")",";","}"]}]}}]}]},e["include/wind_bending.glslv"]={TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"WIND_BENDING_GLSLV",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"WIND_BENDING_GLSLV",TOKENS:[""]},{TYPE:"var",NAME:"WIND_BEND",TOKENS:["0"]},{TYPE:"var",NAME:"MAIN_BEND_COL",TOKENS:["0"]},{TYPE:"var",NAME:"DETAIL_BEND",TOKENS:["0"]},{TYPE:"var",NAME:"BEND_CENTER_ONLY",TOKENS:["0"]},{TYPE:"var",NAME:"REFLECTION_PASS",TOKENS:["REFL_PASS_NONE"]},{TYPE:"var",NAME:"BILLBOARD",TOKENS:["0"]},{TYPE:"include",FILE:"std.glsl"},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WIND_BEND"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["void","KH","(","inout","vec3","bo",",","in","vec3","Kv",",","in","float","Kw",",","in","float","Kx",",","in","float","fu",",","in","vec3","Kc",",","in","float","Ky",",","in","mat4","bV",")","{"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_PASS","REFL_PASS_PLANE",{TYPE:"equal_expr",PLACES:2},"BILLBOARD",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","Kz","=","(","bV","*","vec4","(","bo",",","1.0",")",")",".","xyz",";","vec3","KA","=","(","bV","*","vec4","(","Kv",",","1.0",")",")",".","xyz",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","Kz","=","bo",";","vec3","KA","=","Kv",";"]}]}}]},{TYPE:"txt",TOKENS:["float","dA","=","length","(","KA",")",";","float","KB","=","Kx","*","(","1.0","+","0.1","*","fract","(","dA",")",")",";","float","KC","=","Kw","*","Ky","*","(","1.0","+","sin","(","2.0","*","3.14","*","fu","*","KB","+","dA",")",")",";","float","KD","=","(","Kz",".","z","-","KA",".","z",")","*","abs","(","KC",")",";","KD","+=","1.0",";","KD","*=","KD",";","KD","=","KD","*","KD","-","KD",";","vec3","KE","=","Kz",";","KE",".","xy","+=","Kc",".","xy","*","KD","*","sign","(","KC",")",";","vec3","KF","=","KE","-","KA",";","if","(","all","(","equal","(","KF",",","vec3","(","0.0",")",")",")",")","bo","=","Kv",";","else","{"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_PASS","REFL_PASS_PLANE",{TYPE:"equal_expr",PLACES:2},"BILLBOARD",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["KF","=","(","bV","*","vec4","(","KF",",","0.0",")",")",".","xyz",";"]}]}}]},{TYPE:"txt",TOKENS:["float","KG","=","length","(","Kz","-","KA",")",";","bo","=","Kv","+","normalize","(","KF",")","*","KG",";","}","}"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DETAIL_BEND"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec4","KI","(","vec4","x",")","{","return","x","*","x","*","(","3.0","-","2.0","*","x",")",";","}","vec4","KJ","(","vec4","x",")","{","return","abs","(","fract","(","x","+","0.5",")","*","2.0","-","1.0",")",";","}","vec4","KK","(","vec4","x",")","{","return","KI","(","KJ","(","x",")",")",";","}","void","KW","(","inout","vec3","bo",",","in","float","fu",",","in","vec3","U",",","in","vec3","Kc",",","in","vec3","Kv",",","in","float","KL",",","in","float","KM",",","in","float","KN",",","in","vec3","KO",",","in","mat4","bV",")","{","float","KP",";","float","KQ",";","float","KR",";","vec2","KS",";","vec4","KT",";","vec2","KU",";","vec3","KV",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_PASS","REFL_PASS_PLANE",{TYPE:"equal_expr",PLACES:2},"BILLBOARD",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","Kz","=","(","bV","*","vec4","(","bo",",","1.0",")",")",".","xyz",";","vec3","KA","=","(","bV","*","vec4","(","Kv",",","1.0",")",")",".","xyz",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","Kz","=","bo",";","vec3","KA","=","Kv",";"]}]}}]},{TYPE:"txt",TOKENS:["KP","=","dot","(","KA",",","vec3","(","1.0",")",")",";","KQ","=","KP","+","KO",".","g",";","KR","=","dot","(","Kz",",","vec3","(","KO",".","g",")",")",";","KS","=","(","fu","+","vec2","(","KR",",","KQ",")",")",";","KT","=","(","(","fract","(","(","KS",".","xxyy","*","vec4","(","1.975",",","0.793",",","0.375",",","0.193",")",")",")","*","2.0",")","-","1.0",")","*","length","(","Kc",")","*","KL",";","KT","=","KK","(","KT",")",";","KU","=","KT",".","xz","+","KT",".","yw",";","KU",".","y","=","0.5","-","KU",".","y",";","KV","=","KU",".","xxy","*","KO",".","rrb","*","vec3","(","KM","*","U",".","x",",","KM","*","U",".","y",",","KN",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_PASS","REFL_PASS_PLANE",{TYPE:"equal_expr",PLACES:2},"BILLBOARD",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["KV","=","(","bV","*","vec4","(","KV",",","0.0",")",")",".","xyz",";"]}]}}]},{TYPE:"txt",TOKENS:["bo","+=","KV",";","}"]}]}}]},{TYPE:"txt",TOKENS:["void","ax","(","inout","vec3","O",",","inout","vec3","ao",",","in","vec3","U",",","in","mat4","bV",")","{","vec3","KX","=","u_wind","*","1.0","+","0.7","*","sin","(","u_time",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["BEND_CENTER_ONLY"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","KY","=","ao",";","vec3","KZ","=","a_emitter_center",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_PASS","REFL_PASS_PLANE",{TYPE:"equal_expr",PLACES:2},"BILLBOARD",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["KZ","=","(","bV","*","vec4","(","KZ",",","1.0",")",")",".","xyz",";"]}]}}]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","KY","=","O",";","vec3","KZ","=","ao",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["MAIN_BEND_COL"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DETAIL_BEND"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["KW","(","KY",",","u_time",",","U",",","KX",",","KZ",",","au_detail_bending_freq",",","au_detail_bending_amp",",","au_branch_bending_amp",",","a_bending_col_detail",",","bV",")",";"]}]}}]},{TYPE:"txt",TOKENS:["KH","(","KY",",","KZ",",","au_wind_bending_amp",",","au_wind_bending_freq",",","u_time",",","KX",",","a_bending_col_main",",","bV",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["KH","(","KY",",","KZ",",","au_wind_bending_amp",",","au_wind_bending_freq",",","u_time",",","KX",",","1.0",",","bV",")",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["BEND_CENTER_ONLY"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["O","+=","KY","-","ao",";","ao","=","KY",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["O","=","KY",";","ao","=","KZ",";"]}]}}]},{TYPE:"txt",TOKENS:["}"]}]}}]}]}}]}]}};var Fs={parser:{parse:function(){}}},Gs=A("__shaders",function(e,t){var r=ha(e),_=Ds(e),n=Wo(e),a=ga(e),o=n.defaults,i=n.context_limits,s=n.paths,E=!1,c={},l={},T=null,u={},d=["anchors.glslf","anchors.glslv","color_id.glslf","color_id.glslv","shadow.glslf","shadow.glslv","error.glslf","error.glslv","grass_map.glslf","grass_map.glslv","halo.glslf","halo.glslv","line.glslf","line.glslv","main.glslf","main.glslv","main_stack.glslf","particle_system.glslf","particle_system_stack.glslf","particle_system.glslv","proc_skybox.glslf","skybox.glslv","lens_flares.glslf","lens_flares.glslv","sky.glslf","sky.glslv","water.glslf","water.glslv","tex_skybox.glslf","debug_view.glslf","debug_view.glslv","node_skybox.glslf","irradiance_skybox.glslf","r_convolution_skybox.glslf","postprocessing/antialiasing.glslf","postprocessing/bloom_combine.glslf","postprocessing/coc.glslf","postprocessing/compositing.glslf","postprocessing/depth_pack.glslf","postprocessing/dof.glslf","postprocessing/glow.glslf","postprocessing/god_rays.glslf","postprocessing/god_rays.glslv","postprocessing/god_rays_combine.glslf","postprocessing/luminance.glslf","postprocessing/luminance_av.glslf","postprocessing/luminance_truncated.glslf","postprocessing/motion_blur.glslf","postprocessing/outline.glslf","postprocessing/performance.glslf","postprocessing/postprocessing.glslf","postprocessing/postprocessing.glslv","postprocessing/smaa.glslf","postprocessing/smaa.glslv","postprocessing/ssao.glslf","postprocessing/ssao_blur.glslf","postprocessing/stereo.glslf","postprocessing/precompute_brdf.glslf","include/blending.glslf","include/caustics.glslf","include/color_util.glslf","include/coverage.glslf","include/depth_fetch.glslf","include/dynamic_grass.glslv","include/environment.glslf","include/fog.glslf","include/fxaa.glslf","include/halo_color.glslf","include/lighting_nodes.glslf","include/math.glslv","include/mirror.glslf","include/nodes.glslf","include/nodes.glslv","include/pack.glslf","include/particles.glslv","include/particles_nodes.glslf","include/particles_nodes.glslv","include/precision_statement.glslf","include/procedural.glslf","include/refraction.glslf","include/scale_texcoord.glslv","include/shadow.glslf","include/shadow.glslv","include/skin.glslv","include/sky_blending.glslf","include/std.glsl","include/to_world.glslv","include/wind_bending.glslv"],P=!1,A=0;t.VALID=A,t.INVALID_TEX_IMAGE_UNITS=1,t.INVALID_F_UNIFORM_VECTORS=2,t.INVALID_V_UNIFORM_VECTORS=4,t.INVALID_VERTEX_ATTRIBS=8,t.INVALID_VARYING_VECTORS=16,t.COMPILATION_ERROR=32;var S=/(?:^|[^a-zA-Z_])uniform.*?(sampler2D|samplerCube)(?=\s)(.*?\[\s*([0-9]*)\s*\])?/,p=/(?:^|[^a-zA-Z_])(uniform)(?=\s)\s*(float|vec2|vec3|vec4|ivec2|ivec3|ivec4|bvec2|bvec3|bvec4|mat2|mat3|mat4|sampler2D|samplerCube)\s*(.*?\[\s*([0-9]*)\s*\])?/,m=/(?:^|[^a-zA-Z_])(in)(?=\s)\s*(float|vec2|vec3|vec4|mat2|mat3|mat4)\s*(.*?\[\s*([0-9]*)\s*\])?/,O=/(?:^|[^a-zA-Z_])(varying)(?=\s)\s*(float|vec2|vec3|vec4|mat2|mat3|mat4)\s*(.*?\[\s*([0-9]*)\s*\])?/,v=/(?:\W|^)discard(\W|$)/,N=15,g=new Int16Array(2),h=null,R=null,I=null,b=0,Y=0,L=[],M=null,x=!1;function y(){return{vert:"",frag:"",directives:[],node_elements:[],status:A,attribute_count:0,texture_count:0}}function w(e){var t=y();return t.vert=e.vert,t.frag=e.frag,t.directives=ln(e.directives),t.node_elements=ln(e.node_elements),t.status=e.status,t.attribute_count=e.attribute_count,t.texture_count=e.texture_count,t}function U(e,t,r){var _=e.directives;if("string"==typeof r){var n=C(e,r);n&&(r=n[1])}else r=String(r);for(var o=0;o<_.length;o++)if(_[o][0]==t)return void(_[o][1]=r);E&&a.error("Incompatible directive '"+t+"' was set for shaders "+e.vert+"/"+e.frag+".")}function C(e,t){for(var r=e.directives,_=0;_<r.length;_++)if(r[_][0]==t)return r[_];return!1}function D(e,t,r){o.gl_debug&&(r=F(r),a.error("shader compilation failed:\n"+r+"\n"+M.getShaderInfoLog(e)+" ("+t+")"))}function F(e){for(var t=e.split("\n"),r=0;r<t.length;r++)t[r]=r+1+" "+t[r];return t.join("\n")}function G(e,t){return e+t}function k(e,t){var r=z(e.type),_=z(t.type),n=e.array_size,a=t.array_size;return r>_?-1:r<_?1:n>a?-1:n<a?1:0}function K(e,t,r){for(var _=e.split(";"),n=[],a=0;a<_.length;a++){var o=_[a].match(p);o&&n.push({type:o[2],array_size:o[4]?parseInt(o[4],10):1})}return B(n,t,r)}function B(e,t,r){if(!e.length)return!0;for(var _=0;_<r;_++)t[_]=0;Y=r,e.sort(k);var n=0,a=0,o=0;return function(){for(;o<e.length;){var r=e[o];if(4!=z(r.type))break;a+=Q(r.type)*r.array_size,o++}return!(a>Y||(b=a,H(t,0,a,0,4),0))}()&&function(){for(var r=0;o<e.length;){var _=e[o];if(3!=z(_.type))break;r+=Q(_.type)*_.array_size,o++}return!((n=a+r)>Y||(H(t,a,r,0,3),0))}()&&function(){for(var r=Y-n,_=r,a=r;o<e.length;){var i=e[o];if(2!=z(i.type))break;var s=Q(i.type)*i.array_size;if(s<=_)_-=s;else{if(!(s<=a))return!1;a-=s}o++}var E=r-a;return H(t,n,r-_,0,2),H(t,Y-E,E,2,2),!0}()&&function(){for(;o<e.length;){for(var _=e[o],n=Q(_.type)*_.array_size,a=-1,i=r+1,s=-1,E=0;E<4;E++){var c=g;c[0]=0,c[1]=1,X(t,E,n,c)&&c[1]<i&&(s=c[0],i=c[1],a=E)}if(a<0)return!1;H(t,s,n,a,1),o++}return!0}()}function X(e,t,r,_){for(;b<e.length&&e[b]===N;)b++;for(;Y>0&&e[Y]===N;)Y--;if(Y-b<r)return!1;for(var n=1<<t,a=0,o=-1,i=e.length+1,s=!1,E=b;E<=Y;E++)if(E<Y&&!(e[E]&n))s||(a=E,s=!0);else{if(s){var c=E-a;c>=r&&c<i&&(i=c,o=a)}s=!1}return!(o<0||(_[0]=o,_[1]=i,0))}function H(e,t,r,_,n){for(var a=0,o=0;o<n;o++)a|=1<<_+o;for(o=0;o<r;o++)e[t+o]|=a}function Q(e){var t=0;switch(e){case"mat4":t=4;break;case"mat3":t=3;break;case"mat2":t=2;break;default:t=1}return t}function z(e){var t=0;switch(e){case"mat4":case"vec4":case"ivec4":case"bvec4":case"mat2":t=4;break;case"mat3":case"vec3":case"ivec3":case"bvec3":t=3;break;case"vec2":case"ivec2":case"bvec2":t=2;break;default:t=1}return t}function V(e,t){var r=e+t;if(l[r])return l[r];if(T){var _=T[t];if(!_)return null;n=Fs.parser.parse(_)}else{var n;if(!(n=f.require("shader_texts")[t]))return null}return l[r]=n,n}function j(e){var t={};function r(e,t,_){e instanceof Array?function(e,t,_){for(var n=0;n<e.length;n++)r(e[n],t,_)}(e,t,_):e instanceof Object&&e&&function(e,t,_){for(var n in t&&t(e),e)r(e[n],t,_);_&&_(e)}(e,t,_)}var _=function(e){"var"==e.TYPE?t[e.NAME]=e.TOKENS.join(""):"include"==e.TYPE&&r(V(s.shaders_path,s.shaders_include_dir+e.FILE),_)};return r(e,_),t}function q(e,t,_){var n=_.node_elements,i=[],c=function(e,t){for(var r={},_=t.directives||[],n=0;n<_.length;n++)r[_[n][0]]=[_[n][1]];for(n=0;n<t.node_elements.length;n++)r["USE_NODE_"+t.node_elements[n].id]=["1"];for(var i in o.webgl2?(r.GLSL1=["0"],r.GLSL3=["1"],r.GLSL_VERSION=["300 es"],r.GLSL_IN=["in"],r.GLSL_OUT=["out"],r.GLSL_OUT_FRAG_COLOR=["glsl_out_frag_color"],r.GLSL_TEXTURE=["texture"],r.GLSL_TEXTURE_CUBE=["texture"],r.GLSL_TEXTURE_PROJ=["textureProj"],r.GLSL_TEXTURE_LOD=["textureLod"],r.GLSL_TEXTURE_CUBE_LOD=["textureLod"]):(r.GLSL1=["1"],r.GLSL3=["0"],r.GLSL_VERSION=["100"],r.GLSL_IN="vert"==e?["attribute"]:["varying"],r.GLSL_OUT="vert"==e?["varying"]:[""],r.GLSL_OUT_FRAG_COLOR=["gl_FragColor"],r.GLSL_TEXTURE=["texture2D"],r.GLSL_TEXTURE_CUBE=["textureCube"],r.GLSL_TEXTURE_PROJ=["texture2DProj"],r.GLSL_TEXTURE_LOD=["textureLod"],o.texture_lod_available?(r.GLSL_TEXTURE_LOD=["texture2DLodEXT"],r.GLSL_TEXTURE_CUBE_LOD=["textureCubeLodEXT"]):(r.GLSL_TEXTURE_LOD=["texture2D"],r.GLSL_TEXTURE_CUBE_LOD=["textureCube"])),r.GLSL_SMPLR2D_SHDW=o.compared_mode_depth&&!o.rgba_fallback_shadows?["sampler2DShadow"]:["sampler2D"],r)r[i][0].constructor!=String&&a.warn("Warning! The value of a directive '"+i+"' is not of type string.");return r}(e,_),l={},T=[_[e]],u={},d={},f=[];for(var P in n)for(var A in n[P].inputs)f.push(n[P].inputs[A]);var S=!1;v(t);var p=0,m=0,O=0;return i.join("\n");function v(e){for(var t=e.PARTS,_=0;_<t.length;_++){var a=t[_];switch(a.TYPE){case"cond":N(a);break;case"include":h(a);break;case"var":break;case"define":R(a);break;case"error":I(a);break;case"line":break;case"pragma":b(a);break;case"undef":Y(a);break;case"warning":L(a);break;case"extension":M(a);break;case"version":x(a);case"#":break;case"node":y(a);break;case"nodes_global":U(n);break;case"nodes_main":D(n);break;case"txt":B(a.TOKENS);break;default:r.panic("Unknown element type: "+a.TYPE)}}}function N(e){for(var t=e.PARTS,r=0;r<t.length;r++){var _=t[r];switch(_.TYPE){case"if":case"elif":if(g(_.EXPRESSION))return void v(_.GROUP);break;case"else":return void v(_.GROUP);case"ifdef":_.NAME in c&&v(_.GROUP);break;case"ifndef":_.NAME in c||v(_.GROUP)}}}function g(e,t){return function(e){for(var t=[],_=0;_<e.length;_++)if(e[_]instanceof Object)switch(e[_].TYPE){case"conditional_expr":var n=t.pop(),o=t.pop(),i=t.pop();t.push(i?o:n);break;case"logical_or_expr":for(var s=t.pop(),E=0;E<e[_].PLACES-1;E++){var c=t.pop();s=s||c}t.push(s);break;case"logical_and_expr":for(s=t.pop(),E=0;E<e[_].PLACES-1;E++)c=t.pop(),s=s&&c;t.push(s);break;case"logical_bitor_expr":for(s=t.pop(),E=0;E<e[_].PLACES-1;E++)s|=t.pop();t.push(s);break;case"logical_bitxor_expr":for(s=t.pop(),E=0;E<e[_].PLACES-1;E++)s^=t.pop();t.push(s);break;case"logical_bitand_expr":for(s=t.pop(),E=0;E<e[_].PLACES-1;E++)s&=t.pop();t.push(s);break;case"equal_expr":var l=t.pop(),d=t.pop();t.push(d==l);break;case"non_equal_expr":l=t.pop(),d=t.pop(),t.push(d!=l);break;case"le_expr":l=t.pop(),d=t.pop(),t.push(d<=l);break;case"ge_expr":l=t.pop(),d=t.pop(),t.push(d>=l);break;case"l_expr":l=t.pop(),d=t.pop(),t.push(d<l);break;case"g_expr":l=t.pop(),d=t.pop(),t.push(d>l);break;case"left_shift_expr":d=t.pop(),l=t.pop(),t.push(d<<l);break;case"right_shift_expr":d=t.pop(),l=t.pop(),t.push(d>>l);break;case"add_expr":d=t.pop(),l=t.pop(),t.push(d+l);break;case"sub_expr":d=t.pop(),l=t.pop(),t.push(d-l);break;case"mul_expr":d=t.pop(),l=t.pop(),t.push(d*l);break;case"div_expr":d=t.pop(),l=t.pop(),t.push(d/l);break;case"mod_expr":d=t.pop(),l=t.pop(),t.push(d%l);break;case"pre_inc_expr":case"post_inc_expr":c=t.pop(),t.push(++c);break;case"pre_dec_expr":case"post_dec_expr":c=t.pop(),t.push(--c);break;case"positive_expr":c=t.pop(),t.push(+c);break;case"negative_expr":c=t.pop(),t.push(-c);break;case"one_compl_expr":c=t.pop(),t.push(~c);break;case"logic_negative_expr":c=t.pop(),t.push(!c);break;default:r.panic("Unknown operation type: "+e[_].TYPE)}else if(/^[a-zA-Z_$][a-zA-Z_$0-9]*$/.test(c=e[_])){if(t.push(0),0!=c.indexOf("USE_NODE_")){var f=T[T.length-1];f in u||(u[f]=[]),-1==u[f].indexOf(c)&&(u[f].push(c),a.error("Undefined directive '"+c+"' in shader '"+f+"'. Should it be defined with #var/#node_var or #define?"))}}else t.push(parseFloat(e[_]));if(1==t.length)return t[0];r.panic("Incorrect expression: "+e.join(" "))}(X(e,c,l,!0,t))}function h(e){var t=e.FILE,r=V(s.shaders_path,s.shaders_include_dir+t);T.push("include/"+t),v(r),T.pop()}function R(e){c[e.NAME]=e.TOKENS}function I(e){r.panic("Shader error: #error "+e.TOKENS.join(" "))}function b(e){i.push("#pragma "+e.NAME+" "+e.TOKENS.join(" "))}function Y(e){delete c[e.NAME]}function L(e){a.warn("Shader warning: #warning "+e.TOKENS.join(" "))}function M(e){var t=X(e.TOKENS,c,l,!1);i.push("#extension "+t.join(" "))}function x(e){var t=X(e.TOKENS,c,l,!1);i.push("#version "+t.join(" "))}function y(e){d[e.NAME]=e}function w(e,t,r){if("PARTICLE_INFO"==e.id&&t.IS_OPTIONAL){if(1==c.PARTICLE_BATCH){var _=!1;switch(r){case 0:_=ee(e.dirs,"PART_INFO_IND")||ee(e.dirs,"PART_INFO_AGE")||ee(e.dirs,"PART_INFO_LT")||ee(e.dirs,"PART_INFO_SIZE");break;case 1:_=ee(e.dirs,"PART_INFO_LOC");break;case 2:_=ee(e.dirs,"PART_INFO_VEL");break;case 3:_=ee(e.dirs,"PART_INFO_A_VEL");break;case 4:_=ee(e.dirs,"PART_INFO_IND")}return _}return!1}return!0}function U(t){for(var r=0;r<t.length;r++){var _=t[r],n=d[_.id];if(n)for(var a=0,o=0;o<n.DECLARATIONS.length;o++){var i=n.DECLARATIONS[o];if("node_param"==i.TYPE){if(w(_,i,a)){var s=i.QUALIFIER.join(" ")+" ";"vert"==e?s+=_.vparams[a]:"frag"==e&&(s+=_.params[a],null!==_.param_values[a]&&(s+="="+_.param_values[a])),B(K(s+=";"))}a++}}}}function C(e,t){for(var r=T[T.length-1],_=function(e){for(var t={},r=0;r<e.NODE_VARS.length;r++){var _=e.NODE_VARS[r];t[_.NAME]=[_.TOKENS.join("")]}return t}(e),n=0;n<t.dirs.length;n++){var o=t.dirs[n][0];o in _?_[o]=[t.dirs[n][1]]:E&&a.error("Incompatible node directive '"+o+"' was set for node "+t.id+" in shader "+r+".")}var i=0;for(n=0;n<e.DECLARATIONS.length;n++){var s=e.DECLARATIONS[n];if("node_out"==s.TYPE){var c=f.indexOf(t.outputs[i])>-1|0;_["USE_OUT_"+s.NAME]=[c],i++}}return _}function D(e){for(var t=0;t<e.length;t++){var r=e[t],_=d[r.id];if(_){var n={};p=0,m=0,O=0;var a=C(_,r);F(r,_.DECLARATIONS,n,a),i.push("{"),G(r,_.STATEMENTS,n,a),i.push("}")}}}function F(t,r,_,n){for(var a=0;a<r.length;a++){var o=r[a];switch(o.TYPE){case"node_in":var i=t.inputs[p];if(null!==t.input_values[p]){if(("MATERIAL_BEGIN"==t.id&&3===p||!n.MATERIAL_EXT&&("MATERIAL_BEGIN"==t.id&&4===p||"MATERIAL_END"==t.id&&3===p||"MATERIAL_END"==t.id&&4===p||"MATERIAL_END"==t.id&&5===p)||"TEXTURE_COLOR"==t.id||"TEXTURE_NORMAL"==t.id)&&o.IS_OPTIONAL){_[o.NAME]=t.input_values[p],p++;continue}var s=o.QUALIFIER.join(" ")+" ";B(K(s+=i+"="+t.input_values[p]+";"))}_[o.NAME]=i,p++;break;case"node_out":i=t.outputs[m],(!o.IS_OPTIONAL||f.indexOf(i)>-1)&&(s=o.QUALIFIER.join(" ")+" ",B(K(s+=i+";")),_[o.NAME]=i),m++;break;case"node_param":"vert"==e?i=t.vparams[O]:"frag"==e&&(i=t.params[O]),_[o.NAME]=i,O++}}return _}function G(e,t,r,_){for(var n=0;n<t.length;n++){var a=t[n];switch(a.TYPE){case"node_cond":k(e,a.PARTS,r,_);break;case"txt":for(var o=[],i=0;i<a.TOKENS.length;i++){var s=a.TOKENS[i];o.push(s in r?r[s]:s)}B(o,_)}}}function k(e,t,r,_){for(var n=0;n<t.length;n++){var a=t[n];switch(a.TYPE){case"node_if":case"node_elif":if(g(a.EXPRESSION,_))return void G(e,a.STATEMENTS,r,_);break;case"node_else":return void G(e,a.STATEMENTS,r,_);case"node_ifdef":(a.NAME in c||a.NAME in _)&&G(e,a.STATEMENTS,r,_);break;case"node_ifndef":a.NAME in c||a.NAME in _||G(e,a.STATEMENTS,r,_)}}}function K(e){return e.match(/([\d]+\.[\d]+|[\w]+|[^\s])/g)}function B(t,r){if((t=function(e,t){if(!o.webgl2&&"frag"==t){var r=e.join(" ");S&&(r.match(/[^;]*;/)?(r=r.replace(/[^;]*;/,""),S=!1):r=""),(r=r.replace(/GLSL_OUT [^;]*;/g,"")).match(/GLSL_OUT(?:$| [^;]*)/)&&(r=r.replace(/GLSL_OUT(?:$| [^;]*)/,""),S=!0),e=(r=(r=r.replace(/ {2,}/g," ")).trim())?r.split(" "):[]}return e}(t,e)).length){var _=X(t,c,l,!1,r);i.push(_.join(" "))}}function X(e,t,r,_,n){var a=[];return function e(t,r,_,n,a,o){for(var i=0;i<t.length;i++){var s=t[i];if(o&&s in o)var E=o[s];else{if(!(s in r)){a.push(s);continue}E=r[s]}0==E.length&&n?a.push(0):e(E,r,_,n,a,o)}}(e,t,r,_,a,n),a}}function W(e,t,r,_,n){P&&function(e,t,r,_){if(r==M.VERTEX_SHADER)var n=_.vert;else n=_.frag;var a=function(e,t){for(var r=0,_=0;_<e.length;_++)r=(r<<5)-r+e.charCodeAt(_),r&=r;return r}(t),o=L[a];o?o.count++:L[a]=o={count:1,shader_filename:n,hc:a}}(0,r,_,n);var a=e.createShader(_);return e.shaderSource(a,r),e.compileShader(a),a}function J(e){M.deleteProgram(e.program),M.deleteShader(e.vshader),M.deleteShader(e.fshader),delete c[e.shader_id]}function Z(e,t){switch(!t&&e.length?t=e.length:t||(t=1),t){case 1:return $(e);case 2:return"vec2("+$(e[0])+","+$(e[1])+")";case 3:return"vec3("+$(e[0])+","+$(e[1])+","+$(e[2])+")";case 4:return"vec4("+$(e[0])+","+$(e[1])+","+$(e[2])+","+$(e[3])+")";case 9:return"mat3("+$(e[0])+","+$(e[1])+","+$(e[2])+","+$(e[3])+","+$(e[4])+","+$(e[5])+","+$(e[6])+","+$(e[7])+","+$(e[8])+")";case 16:return"mat4("+$(e[0])+","+$(e[1])+","+$(e[2])+","+$(e[3])+","+$(e[4])+","+$(e[5])+","+$(e[6])+","+$(e[7])+","+$(e[8])+","+$(e[9])+","+$(e[10])+","+$(e[11])+","+$(e[12])+","+$(e[13])+","+$(e[14])+","+$(e[15])+")";default:r.panic("Wrong glsl value dimension")}}function $(e){return e%1?String(e):String(e)+".0"}function ee(e,t){for(var r=0;r<e.length;r++)if(e[r][0]==t)return!0;return!1}t.setup_context=function(e){M=e},t.init_shaders_info=y,t.clone_shaders_info=w,t.set_directive=U,t.get_directive=C,t.set_default_directives=function(e){e.directives=ln(function(e,t){var r=e+t;if(!(r in u)){var _=V(s.shaders_path,e),n=V(s.shaders_path,t),a=j(_),o=j(n);for(var i in o)a[i]=o[i];var E=[];for(var i in a)E.push([i,a[i]]);u[r]=E}return u[r]}(e.vert,e.frag)),U(e,"PRECISION",n.defaults.precision),U(e,"EPSILON",Z("highp"==n.defaults.precision?1e-6:1e-4)),U(e,"CONSTANTS_HACK",0|o.shader_constants_hack),U(e,"SRGB",o.srgb_type),U(e,"COMPARED_MODE",0|o.compared_mode_depth)},t.get_vname=function(e){return e.vert},t.get_fname=function(e){return e.frag},t.get_compiled_shader=function(e){var t=JSON.stringify(e.vert)+JSON.stringify(e.frag)+JSON.stringify(e.directives)+JSON.stringify(e.node_elements),r=c[t];if(r)return r;var _=e.frag,n=V(s.shaders_path,e.vert),E=V(s.shaders_path,_);if(!n||!E)return null;var l=q("vert",n,e),T=q("frag",E,e);if(function(e,t,r){var _,n=A,a=(_=S,(e.split(";").map(function(e){var t=e.match(_);return t&&(t[3]?parseInt(t[3],10):1)}).filter(function(e){return e})||[]).reduce(G,0));r.texture_count=a,a>i.max_texture_image_units&&(n|=1),h||(h=new Uint32Array(i.max_varying_vectors)),R||(R=new Uint32Array(i.max_fragment_uniform_vectors)),I||(I=new Uint32Array(i.max_vertex_uniform_vectors)),K(e,R,i.max_fragment_uniform_vectors)||(n|=2),K(t,I,i.max_vertex_uniform_vectors)||(n|=4);var s=function(e){return o.webgl2?(e.replace(/(.*?)\([^()]*?\)(.*?)/g,"$1$2").match(/(?:^|[^a-zA-Z_])in(?=\s)/g)||[]).length:(e.match(/(?:^|[^a-zA-Z_])attribute(?=\s)/g)||[]).length}(t);r.attribute_count=s,s>i.max_vertex_attribs&&(n|=8),function(e){if(o.webgl2){e=e.replace(/(.*?)\([^()]*?\)(.*?)/g,"$1$2");var t=m}else t=O;return B(e.split(";").map(function(e){var r=e.match(t);return r&&{type:r[2],array_size:r[4]?parseInt(r[4],10):1}}).filter(function(e){return e}),h,i.max_varying_vectors)}(e)||(n|=16),r.status=n}(T,l,e),e.status===A){c[t]=r=function(e,t,r,_,n){var a=W(e,0,t,e.VERTEX_SHADER,n),o=W(e,0,r,e.FRAGMENT_SHADER,n),i=e.createProgram();e.attachShader(i,a),e.attachShader(i,o),e.linkProgram(i);for(var s={vshader:a,fshader:o,program:i,attributes:{},uniforms:{},permanent_uniform_setters:ua(),permanent_sc_uniform_setters:ua(),permanent_uniform_setters_table:{},need_uniforms_update:!0,no_permanent_uniforms:!1,transient_uniform_setters:ua(),transient_sc_uniform_setters:ua(),shaders_info:w(n),shader_id:_,has_discard:function(e){return Boolean(e.match(v))}(r),cleanup_gl_data_on_unload:!0},E=e.getProgramParameter(i,e.ACTIVE_ATTRIBUTES),c=0;c<E;c++){var l=e.getActiveAttrib(i,c).name,T=e.getAttribLocation(i,l);s.attributes[l]=T}var u=e.getProgramParameter(i,e.ACTIVE_UNIFORMS);for(c=0;c<u;c++){var d=e.getActiveUniform(i,c).name.split("[0]").join(""),f=e.getUniformLocation(i,d);s.uniforms[d]=f}return s}(M,l,T,t,e);var u=!M.getShaderParameter(r.fshader,M.COMPILE_STATUS),d=!M.getShaderParameter(r.vshader,M.COMPILE_STATUS),f=!M.getProgramParameter(r.program,M.LINK_STATUS);u?D(r.fshader,t,T):d?D(r.vshader,t,l):f&&function(e,t,r,_){o.gl_debug&&(r=F(r),_=F(_),a.error("shader linking failed:\n"+r+"\n\n\n"+_+"\n"+M.getProgramInfoLog(e)+" ("+t+")"))}(r.program,t,l,T),(u||d||f)&&(e.status|=32,r=null)}else r=null;return r},t.load_shaders=function(){if(x=!1,f.module_check("shader_texts"))x=!0;else{for(var e=[],t=_.AT_TEXT,r=0;r<d.length;r++){var n=cs(s.shaders_path+d[r]);e.push({id:d[r],type:t,url:n})}e.length?_.enqueue(e,function(e,t,r,_){!function(e,t){T||(T={}),T[e]=t}(t,e)},function(){x=!0}):a.error("Shaders have not been found.")}},t.check_shaders_loaded=function(){return x},t.debug_get_compilation_stats=function(){return L},t.get_compiled_shaders=function(){return c},t.cleanup=function(){for(var e in c)J(c[e]);for(var t in l)delete l[t];for(var r in L)delete L[r];h=null,R=null,I=null,u={}},t.cleanup_shader=J,t.debug_shaders_info=function(e){var t=e.directives;a.log("Shader: "+e.vert+" "+e.frag+", "+String(t.length)+" directives: ");for(var r=0;r<t.length;r++)a.log("  "+t[r][0],t[r][1])},t.glsl_value=Z,t.check_uniform=function(e,t){return t in e.uniforms},t.reset=function(){M=null}}),ks=A("__nodemat",function(e,t){var r=ha(e),_=Wo(e),n=ei(e),a=$o(e),o=ga(e),i=Gs(e),s=ys(e),E={},c={},l={},T={},u=0,d=_.defaults,f=0,P=1,A=.01,S=0,m=1,O=2,v=0,N=1,g=2,h=3,R=4,I=5,Y=6,L=7,M=8;t.VT_WORLD_TO_WORLD=v,t.VT_WORLD_TO_OBJECT=N,t.VT_WORLD_TO_CAMERA=g,t.VT_OBJECT_TO_WORLD=h,t.VT_OBJECT_TO_OBJECT=R,t.VT_OBJECT_TO_CAMERA=I,t.VT_CAMERA_TO_WORLD=Y,t.VT_CAMERA_TO_OBJECT=L,t.VT_CAMERA_TO_CAMERA=M;var x=0,y=1,w=2,U=3,C=4;t.NM_TANGENT=x,t.NM_OBJECT=y,t.NM_WORLD=w,t.NM_BLENDER_OBJECT=U,t.NM_BLENDER_WORLD=C;var D=0,F=2;function G(e,t,r,_,n,o){if(t in c)return c[t];var E={graph:null,id:t,cleanup_on_unload:!0};if(r||(T={},u=0),"SHADOW"!=_&&"COLOR_ID"!=_){for(var l=a.create(),d=e.nodes,f=0;f<d.length;f++)if(null==oe(l,d[f],0,_,n,o))return c[t]=null,E;if(r&&-1==_e(e,l,"GROUP_OUTPUT","group"))return E;var P=function(e){var t=[];return a.traverse(e,function(e,r){"GROUP"==r.type&&t.push(r)}),t}(l),A=r?e.links:e.links.slice();if(!function(e,t,r){for(var _=0;_<r.length;_++){var n=r[_].data.node_group_graph,o=r[_].data.node_group_links;if(!n)return!1;a.traverse(n,function(t,r){a.append_node(e,a.gen_node_id(e),r)});for(var i=0;i<o.length;i++)t.push(o[i]);Me(r[_],t,e)}return!0}(l,A,P))return E;if(r)return E.graph=l,E;for(f=0;f<A.length;f++)for(var S=A[f],p=J(S.from_node,l),m=J(S.to_node,l),O=0;O<p.length;O++)for(var v=0;v<m.length;v++){var N=p[O],g=m[v];if(!ve(l,N,g,a.get_node_attr(l,N),a.get_node_attr(l,g),S))return c[t]=null,E}!function(e){var t=[];a.traverse(e,function(r,_){switch(_.type){case"B4W_TRANSLUCENCY":a.traverse_edges(e,function(n,o,i){var s=a.get_node_attr(e,o);n==r&&"MATERIAL_EXT"==s.type&&"Translucency"==_.outputs[i[0]].name&&t.push(n,o,[i[0]+1,i[1]+1])})}});for(var r=0;r<t.length;r+=3)a.append_edge(e,t[r],t[r+1],t[r+2])}(l);var h=!1,R=-1;"GLOW"==_?R=_e(e,l,"B4W_GLOW_OUTPUT","material",!0):(-1==(R=_e(e,l,"OUTPUT","material",!1,!0))&&(R=_e(e,l,"OUTPUT_MATERIAL","material",!1,!0)),-1==R&&(R=_e(e,l,"OUTPUT_WORLD","material",!1,!0),h=!0)),-1==R&&(l=function(){var e=a.create(),t={default_value:new Float32Array([0,0,0]),identifier:"Color",is_linked:!1,name:"Color"};return a.append_node(e,0,{data:null,dirs:[],params:[],inputs:[t,{default_value:1,identifier:"Alpha",is_linked:!1,name:"Alpha"}],outputs:[],type:"OUTPUT",vparams:[]}),e}(),R=0),function(e){var t=[];a.traverse(e,function(e,r){"B4W_PARALLAX"!=r.type&&"REROUTE"!=r.type||t.push(e,r)});for(var r=0;r<t.length;r+=2){var _=t[r],n=t[r+1];if("B4W_PARALLAX"==n.type)Z(e,_,n);else if("REROUTE"==n.type){for(var o=a.get_in_edge(e,_,0),i=a.out_edge_count(e,_),s=[],E=[],c=[],l=0;l<i;l++){var T=a.get_out_edge(e,_,l),u=E.indexOf(T),d=a.get_edge_attr(e,_,T,u>=0?c[u]:0);if(d){var f=d[1],P=n.inputs[0].default_value,A=a.get_node_attr(e,T).inputs[f];switch(typeof P){case"number":if("object"==typeof A.default_value)for(var S=A.default_value,p=0;p<S.length;p++)S[p]=P;else"number"==typeof A.default_value&&(A.default_value=P);break;case"object":if("object"==typeof A.default_value)for(S=A.default_value,p=0;p<S.length;p++)S[p]=P[p];else"number"==typeof A.default_value&&(A.default_value=.35*P[0]+.45*P[1]+.2*P[2])}}var m=n.outputs;for(p=0;p<m.length;p++)m[p].default_value=n.inputs[0].default_value;-1!=u?c[u]+=1:(E.push(T),c.push(1),s.push(_,T))}if(-1!=o){var O=a.get_edge_attr(e,o,_,0)[0];for(l=0;l<E.length;l++)for(p=0;p<c[l];p++){var v=a.get_edge_attr(e,_,E[l],p)[1];a.append_edge(e,o,E[l],[O,v])}}for(l=0;l<s.length;l+=2)a.remove_edge(e,s[l],s[l+1],-1)}}}(l);var I=a.subgraph_node_conn(l,R,a.BACKWARD_DIR);h?(function(e,t){var r=[];a.traverse(e,function(e,t){"OUTPUT_WORLD"==t.type&&r.push({node_id:e,node:t})});for(var _=0;_<r.length;++_){var n=r[_].node_id,o=r[_].node,i=a.gen_node_id(e);a.append_node(e,i,o.data.output_world_surface);for(var s=a.in_edge_count(e,n),E=[],c=[],l={},T=0;T<s;T++){var u=a.get_in_edge(e,n,T);u in l||(l[u]=0);var d=a.get_edge_attr(e,u,n,l[u]++);switch(E.push([u,n,d]),d[1]){case D:c.push([u,i,d])}}for(T=0;T<E.length;T++)a.remove_edge_by_attr(e,E[T][0],E[T][1],E[T][2]);for(T=0;T<c.length;T++)a.append_edge(e,c[T][0],c[T][1],c[T][2]);a.remove_node(e,n)}}(I),function(e,t){var r=[];if(a.traverse(e,function(e,t){"MIX_SHADER"!=t.type&&"ADD_SHADER"!=t.type||r.push({node_id:e,node:t})}),r.length)for(var _={name:"RGB_WORLD_NODE",type:"RGB_WORLD_NODE",factor:.5},n=0;n<r.length;n++){var o=r[n].node_id,i=r[n].node;switch(_.name=i.name,_.fac=i.inputs[0].default_value,_.fac_is_linked=i.inputs[0].is_linked,_.color1_is_linked=i.inputs[1].is_linked,_.color2_is_linked=i.inputs[2].is_linked,i.type){case"ADD_SHADER":_.type="ADD_WORLD_RGB";break;case"MIX_SHADER":_.type="MIX_WORLD_RGB"}for(var s=oe(e,_,0,t,null,[]),E=a.in_edge_count(e,o),c=[],l=[],T={},u=0;u<E;u++){var d=a.get_in_edge(e,o,u);d in T||(T[d]=0);var f=a.get_edge_attr(e,d,o,T[d]++);c.push([d,o,f]),l.push([d,s,f])}for(u=0;u<c.length;u++)a.remove_edge_by_attr(e,c[u][0],c[u][1],c[u][2]);for(u=0;u<l.length;u++)a.append_edge(e,l[u][0],l[u][1],l[u][2]);var P=a.out_edge_count(e,o),A=[],S=[],p={};for(u=0;u<P;u++){var m=a.get_out_edge(e,o,u);m in p||(p[m]=0),f=a.get_edge_attr(e,o,m,p[m]++),A.push([o,m,f]),S.push([s,m,f])}for(u=0;u<A.length;u++)a.remove_edge_by_attr(e,A[u][0],A[u][1],A[u][2]);for(u=0;u<S.length;u++)a.append_edge(e,S[u][0],S[u][1],S[u][2]);a.remove_node(e,o)}}(I,_),function(e){var t=-1,r=[],_=[],n=["OUTPUT_WORLD_SURFACE","BACKGROUND","RGB","VALUE","ADD_WORLD_RGB","MIX_WORLD_RGB","TEXTURE_ENVIRONMENT_EQUIRECTANGULAR","TEXTURE_ENVIRONMENT_MIRROR_BALL","GEOMETRY_NO","GEOMETRY_TRN","GEOMETRY_GL","GEOMETRY_IN","TEXTURE_COLOR","TEX_COORD_GE","TEX_COORD_OB","TEX_COORD_NO","COMBRGB","COMBHSV","CURVE_RGB","CURVE_VEC","B4W_LINEAR_TO_SRGB","B4W_NORMAL_VIEW","B4W_VECTOR_VIEW","B4W_SRGB_TO_LINEAR","B4W_REFLECT","B4W_CLAMP","B4W_TIME","B4W_SMOOTHSTEP","NORMAL","MAPPING","MATH_ADD","MATH_SUBTRACT","MATH_MULTIPLY","MATH_DIVIDE","MATH_SINE","MATH_COSINE","MATH_TANGENT","MATH_ARCSINE","MATH_ARCCOSINE","MATH_ARCTANGENT","MATH_POWER","MATH_LOGARITHM","MATH_MINIMUM","MATH_MAXIMUM","MATH_ROUND","MATH_LESS_THAN","MATH_GREATER_THAN","MATH_MODULO","MATH_ABSOLUTE","MIX_RGB_MIX","MIX_RGB_ADD","MIX_RGB_MULTIPLY","MIX_RGB_SUBTRACT","MIX_RGB_SCREEN","MIX_RGB_DIVIDE","MIX_RGB_DIFFERENCE","MIX_RGB_DARKEN","MIX_RGB_LIGHTEN","MIX_RGB_OVERLAY","MIX_RGB_DODGE","MIX_RGB_BURN","MIX_RGB_HUE","MIX_RGB_SATURATION","MIX_RGB_VALUE","MIX_RGB_COLOR","MIX_RGB_SOFT_LIGHT","MIX_RGB_LINEAR_LIGHT","SEPRGB","SEPHSV","VALTORGB","VECT_TRANSFORM","VECT_MATH_ADD","VECT_MATH_SUBTRACT","VECT_MATH_AVERAGE","VECT_MATH_DOT_PRODUCT","VECT_MATH_CROSS_PRODUCT","VECT_MATH_NORMALIZE"];a.traverse(e,function(e,_){switch(n.indexOf(_.type)){case-1:r.push({node_id:e,node:_});break;case 0:t=e}});for(var o=0;o<r.length;o++)for(var i=r[o].node_id,s=a.out_edge_count(e,i),E={},c=0;c<s;c++){var l=a.get_out_edge(e,i,c);l in E||(E[l]=0);var T=a.get_edge_attr(e,i,l,E[l]++);_.push([i,l,T])}for(o=0;o<_.length;o++)a.remove_edge_by_attr(e,_[o][0],_[o][1],_[o][2]);if(_.length){var u=a.subgraph_node_conn(e,t,a.BACKWARD_DIR);e.nodes=u.nodes,e.edges=u.edges}}(I),function(e){var t=-1,r=[],_=[];a.traverse(e,function(e,_){switch(_.type){case"ADD_WORLD_RGB":case"MIX_WORLD_RGB":r.push({node_id:e,node:_});break;case"OUTPUT_WORLD_SURFACE":t=e,r.push({node_id:e,node:_})}});for(var n=0;n<r.length;n++)for(var o=r[n].node_id,i=r[n].node,s=a.in_edge_count(e,o),E={},c=0;c<s;c++){var l=a.get_in_edge(e,o,c),T=a.get_node_attr(e,l);l in E||(E[l]=0);var u=a.get_edge_attr(e,l,o,E[l]++);"OUTPUT_WORLD_SURFACE"!=i.type&&0==u[1]||"ADD_WORLD_RGB"==T.type||"MIX_WORLD_RGB"==T.type||"BACKGROUND"==T.type||_.push([l,o,u])}for(n=0;n<_.length;n++)a.remove_edge_by_attr(e,_[n][0],_[n][1],_[n][2]);if(_.length){var d=a.subgraph_node_conn(e,t,a.BACKWARD_DIR);e.nodes=d.nodes,e.edges=d.edges}}(I)):(function(e,t,r){var _=[];a.traverse(e,function(e,t){"MATERIAL"!=t.type&&"MATERIAL_EXT"!=t.type||_.push({node_id:e,node:t})});for(var n=0;n<_.length;++n){var o=_[n].node_id,i=_[n].node,s=a.gen_node_id(e);a.append_node(e,s,i.data.material_begin);var E=a.gen_node_id(e);a.append_node(e,E,i.data.material_end),a.append_edge(e,s,E,[4,2]);for(var c={5:["LIGHTING_APPLY",10],6:["LIGHTING_APPLY",6],7:["MATERIAL_END",3],8:["MATERIAL_END",4],9:["MATERIAL_END",5]},l=a.in_edge_count(e,o),T=[],u=[],d=[],f={},P=0;P<l;P++){var A=a.get_in_edge(e,o,P);A in f||(f[A]=0);var S=a.get_edge_attr(e,A,o,f[A]++);T.push([A,o,S]);var p=c[S[1]];if(p)switch(p[0]){case"MATERIAL_END":u.push([A,E,[S[0],p[1]]]);break;case"LIGHTING_APPLY":d.push([A,[S[0],p[1]]])}else u.push([A,s,S])}for(k(e,i.data.value,s,E,d,r),P=0;P<T.length;P++)a.remove_edge_by_attr(e,T[P][0],T[P][1],T[P][2]);for(P=0;P<u.length;P++)a.append_edge(e,u[P][0],u[P][1],u[P][2]);var m=a.out_edge_count(e,o),O=[],v=[],N={};for(P=0;P<m;P++){var g=a.get_out_edge(e,o,P);g in N||(N[g]=0),S=a.get_edge_attr(e,o,g,N[g]++),O.push([o,g,S]),v.push([E,g,S])}for(P=0;P<O.length;P++)a.remove_edge_by_attr(e,O[P][0],O[P][1],O[P][2]);for(P=0;P<v.length;P++)a.append_edge(e,v[P][0],v[P][1],v[P][2]);a.remove_node(e,o)}}(I,0,o),function(e,t,r){var _=[];a.traverse(e,function(e,t){"OUTPUT_MATERIAL"==t.type&&_.push({node_id:e,node:t})});for(var n=0;n<_.length;++n){var o=_[n].node_id,i=_[n].node,s=!1,E=!1,c=a.gen_node_id(e);a.append_node(e,c,i.data.output_surface);for(var l=a.in_edge_count(e,o),T=[],u=[],d={},f=0;f<l;f++){var P=a.get_in_edge(e,o,f);P in d||(d[P]=0);var A=a.get_edge_attr(e,P,o,d[P]++);switch(T.push([P,o,A]),A[1]){case D:s=!0,u.push([P,c,A]);break;case F:E=!0;var S=a.gen_node_id(e);a.append_node(e,S,i.data.displacement_bump),u.push([P,S,[A[0],0]])}}for(f=0;f<T.length;f++)a.remove_edge_by_attr(e,T[f][0],T[f][1],T[f][2]);for(f=0;f<u.length;f++)a.append_edge(e,u[f][0],u[f][1],u[f][2]);if(a.remove_node(e,o),s)E&&X(e,c,S),Q(e,0,r);else{var p=a.get_node_attr(e,c);e.nodes=[0,p],e.edges=[]}}}(I,0,o)),q(I),function(e){(function(e){var t=[];a.traverse(e,function(e,r){"GEOMETRY_VC"!=r.type&&"GEOMETRY_NO"!=r.type&&"GEOMETRY_FB"!=r.type&&"GEOMETRY_VW"!=r.type&&"GEOMETRY_GL"!=r.type&&"GEOMETRY_LO"!=r.type&&"GEOMETRY_OR"!=r.type&&"GEOMETRY_BF"!=r.type&&"GEOMETRY_IN"!=r.type||t.push(e,r)});for(var r=[],_=0;_<t.length;_+=2){for(var n=t[_],o=t[_+1],i=!0,s=0;s<r.length;s++)if(te(o,(d=r[s]).attr)){for(var E=[],c=a.out_edge_count(e,n),l=0;l<c;l++){var T=a.get_out_edge(e,n,l),u=a.get_edge_attr(e,n,T,0);E.push(n,T,u),a.append_edge(e,d.id,T,u)}for(l=0;l<E.length;l+=3)a.remove_edge(e,E[l],E[l+1],0);a.remove_node(e,n),i=!1;break}var d;i&&r.push(d={id:n,attr:o})}})(e),function(e){var t=[];if(a.traverse(e,function(e,r){"TEXTURE_COLOR"!=r.type&&"TEXTURE_NORMAL"!=r.type||t.push(e,r)}),t.length){for(var r=function(e){for(var t={},r=0;r<e.nodes.length;r+=2)t[_=e.nodes[r]]={ascs_ids:{},is_completed:!1};for(r=0;r<e.edges.length;r+=3)t[e.edges[r+1]].ascs_ids[e.edges[r]]=!0;for(var _ in t)ee(_,t);for(var _ in t)t[_]=Object.keys(t[_].ascs_ids).map(function(e){return parseInt(e,10)});return t}(e),_=[],n=0;n<t.length;n+=2){for(var o=t[n],i=t[n+1],s=!0,E=0;E<_.length;E++)if(!((O=_[E]).merged_nodes.length>=3)&&te(i,O.attr)&&!(r[o].indexOf(O.id)>-1||r[O.id].indexOf(o)>-1)){for(var c=!1,l=0;l<O.merged_nodes.length;l++){var T=O.merged_nodes[l].id;if(r[o].indexOf(T)>-1||r[T].indexOf(o)>-1){c=!0;break}}if(!c){var u=[],d=a.in_edge_count(e,o),f={};for(l=0;l<d;l++){(I=a.get_in_edge(e,o,l))in f||(f[I]=0);var P=a.get_edge_attr(e,I,o,f[I]++);u.push(I,o,P)}var A=[],S=a.out_edge_count(e,o),p={};for(l=0;l<S;l++)(b=a.get_out_edge(e,o,l))in p||(p[b]=0),P=a.get_edge_attr(e,o,b,p[b]++),A.push(o,b,P);var m=u.concat(A);for(l=0;l<m.length;l+=3)a.remove_edge(e,m[l],m[l+1],0);a.remove_node(e,o),O.merged_nodes.push(N={id:o,attr:i,edges_in:u,edges_out:A}),s=!1;break}}s&&_.push(O={id:o,attr:i,merged_nodes:[]})}for(n=0;n<_.length;n++){var O,v=(O=_[n]).merged_nodes.length;for(E=0;E<v;E++){var N,g=O.merged_nodes[E],h=g.edges_in,R=g.edges_out;for(O.attr.inputs[E+1].is_linked=(N=g.attr).inputs[0].is_linked,O.attr.inputs[E+1].default_value=N.inputs[0].default_value,O.attr.outputs[2*(E+1)].is_linked=N.outputs[0].is_linked,O.attr.outputs[2*(E+1)].default_value=N.outputs[0].default_value,O.attr.outputs[2*(E+1)+1].is_linked=N.outputs[1].is_linked,O.attr.outputs[2*(E+1)+1].default_value=N.outputs[1].default_value,l=0;l<h.length;l+=3){var I=h[l];(P=h[l+2])[1]+=E+1,a.append_edge(e,I,O.id,P)}for(l=0;l<R.length;l+=3){var b=R[l+1];(P=R[l+2])[0]+=2*(E+1),a.append_edge(e,O.id,b,P)}O.attr.dirs.push(["USE_uv"+(E+2),1])}a.remove_node(e,O.id),a.append_node(e,O.id,O.attr)}}}(e),function(e,t){var r={};for(var _ in a.traverse(e,function(e,t){if("GEOMETRY_UV"==t.type||"UVMAP"==t.type||"TEX_COORD_UV"==t.type){var _=t.data.value;_ in r||(r[_]=[]),r[_].push(e,t)}}),r){var n=r[_];if(n.length>2)for(var o=oe(e,$(_),0,void 0,null,[]),i=a.get_node_attr(e,o),s=0;s<n.length;s+=2){for(var E=n[s],c=n[s+1],l=[],T={},u=a.out_edge_count(e,E),d=0;d<u;d++){var f=a.get_out_edge(e,E,d);f in T||(T[f]=0);var P=a.get_edge_attr(e,E,f,T[f]);T[f]++,l.push(E,f,P);var A=P.splice(0,P.length);switch(c.type){case"GEOMETRY_UV":A[0]=0,i.outputs[0].is_linked=!0;break;case"UVMAP":case"TEX_COORD_UV":A[0]=1,i.outputs[1].is_linked=!0}a.append_edge(e,o,f,A)}for(d=0;d<l.length;d+=3)a.remove_edge(e,l[d],l[d+1],0);a.remove_node(e,E)}}}(e)}(I),function(e){var t=[],r=[];a.traverse(e,function(e,_){"GEOMETRY_VC"==_.type&&t.push(e,_),"GEOMETRY_VW"==_.type&&r.push(e,_)}),function(e,t){for(var r=0;r<t.length;r+=2){for(var _=t[r],n=t[r+1],o=!1,i=[],s=[],E=[[],[],[]],c=a.out_edge_count(e,_),l=0;l<c;l++){var T=a.get_out_edge(e,_,l);if("SEPRGB"!=a.get_node_attr(e,T).type){o=!1;break}i.push(_,T);for(var u={},d=a.out_edge_count(e,T),f=0;f<d;f++){var P=a.get_out_edge(e,T,f);P in u||(u[P]=0);var A=a.get_edge_attr(e,T,P,u[P]++);i.push(T,P),E[A[0]].push(_,P,A)}s.push(T),o=!0}if(o){var S=0,p=0;for(l=0;l<E.length;l++)E[l].length&&(S++,p|=1<<2-l);if(S){for(n.type+=S,n.outputs=[],l=0;l<E.length;l++)if(E[l].length)for(n.outputs.push({default_value:0,identifier:"RGB"[l],is_linked:!0,name:"RGB"[l]}),f=0;f<E[l].length;f+=3)E[l][f+2][0]=Qn(p,l);for(l=0;l<i.length;l+=2)a.remove_edge(e,i[l],i[l+1],0);for(l=0;l<s.length;l++)a.remove_node(e,s[l]);for(l=0;l<E.length;l++)for(f=0;f<E[l].length;f+=3)a.append_edge(e,E[l][f],E[l][f+1],E[l][f+2])}}}}(e,t),function(e,t){for(var r=0;r<t.length;r+=2){for(var _=t[r],n=!0,o=[],i=a.out_edge_count(e,_),s=0;s<i;s++){var E=a.get_out_edge(e,_,s);if("B4W_REFLECT"==a.get_node_attr(e,E).type){var c=a.get_edge_attr(e,_,E,0),l=a.get_edge_attr(e,_,E,1);c&&1==c[1]||l&&1==l[1]?n=!1:o.push(_,E)}else n=!1}for(s=0;s<o.length;s+=2)re(e,o[s],o[s+1]);n&&a.remove_node(e,_)}}(e,r)}(I),function(e,t){var r=[];a.traverse_edges(e,function(_,n,o){var i=a.get_node_attr(e,_),s=a.get_node_attr(e,n),E=kn(i.outputs[o[0]].default_value),c=kn(s.inputs[o[1]].default_value);if(E!=c){var l,T={default_value:[0,0,0],identifier:"Vector",is_linked:!0,name:"Vector"},u={default_value:0,identifier:"Value",is_linked:!0,name:"Value"};E&&!c?l=ne("vector_to_scalar","B4W_VECTOSCAL",[T],[u]):!E&&c&&(l=ne("scalar_to_vector","B4W_SCALTOVEC",[u],[T])),oe(e,l,0,t,null,[]),r.push([_,n,e.nodes[e.nodes.length-2],o])}});for(var _=0;_<r.length;++_)a.remove_edge_by_attr(e,r[_][0],r[_][1],r[_][3]),a.append_edge(e,r[_][0],r[_][2],[r[_][3][0],0]),a.append_edge(e,r[_][2],r[_][1],[0,r[_][3][1]])}(I,_),function(e){var t=[],r=[];a.traverse(I,function(e,_){switch(_.type){case"VALTORGB":t.push(_);break;case"CURVE_VEC":case"CURVE_RGB":r.push(_)}});var _=0,n=null,o=null,E=t.length+r.length;if(t.length){n=s.extract_col_ramps_data(t,s.COLORRAMP_TEXT_SIZE);for(var c=0;c<t.length;c++)t[c].dirs.push(["NODE_TEX_ROW",i.glsl_value((_+.5)/E)]),_++}if(r.length)for(o=s.extract_vec_curves_data(r,s.CURVE_NODES_TEXT_SIZE),c=0;c<r.length;c++)r[c].dirs.push(["NODE_TEX_ROW",i.glsl_value((_+.5)/E)]),_++;var l=null;if(n&&o?((l=new Uint8Array(n.length+o.length)).set(n),l.set(o,n.length)):l=n||o,l)var T=s.create_color_ramp_texture(l,s.CURVE_NODES_TEXT_SIZE);else T=null;for(c=0;c<t.length;c++)t[c].data.texture=T;for(c=0;c<r.length;c++)r[c].data.texture=T}()}else{var b=G(e,t,r,"MAIN",n,o),Y=a.clone(b.graph,function(e){var t=Tn(e);return t.inputs=ln(e.inputs),t.outputs=ln(e.outputs),t});-1==(R=_e(e,Y,"OUTPUT","material",!1,!0))&&(R=_e(e,Y,"OUTPUT_MATERIAL","material",!1,!0)),function(e,t){a.traverse_edges(e,function(r,_,n){var o=a.get_node_attr(e,_);_==t&&"Color"==o.inputs[n[1]].identifier&&a.remove_edge_by_attr(e,r,_,n)})}(Y,R),q(I=a.subgraph_node_conn(Y,R,a.BACKWARD_DIR))}return E.graph=I,c[t]=E,E}function k(e,t,r,_,n,o){var i={name:"LIGHTING_AMBIENT",type:"LIGHTING_AMBIENT"},s=oe(e,i,0,null,null,[]),E=s;if(K(e,r,s,"E"),K(e,r,s,"A"),K(e,r,s,"D"),!t.use_shadeless)for(var c,l,T,u,d=0;d<o.length;d++){var f=o[d];c=oe(e,i={name:"LIGHTING_LAMP",type:"LIGHTING_LAMP"},0,null,null,[]),K(e,E,l=oe(e,i={name:"LIGHTING_APPLY",type:"LIGHTING_APPLY"},0,null,null,[]),"color"),K(e,E,l,"specular"),K(e,c,l,"ldir"),K(e,r,l,"normal"),K(e,r,l,"D"),K(e,r,l,"S"),K(e,c,l,"lcolorint"),K(e,r,c,"shadow_factor");var P="SPECULAR_"+t.specular_shader;if(K(e,c,T=oe(e,i={name:P,type:P,use_tangent_shading:t.use_tangent_shading},0,null,null,[]),"ldir"),K(e,c,T,"lfac"),K(e,r,T,"normal"),K(e,T,l,"sfactor"),K(e,c,T,"norm_fac"),K(e,r,T,"sp_params"),"HEMI"==f.type)var A="DIFFUSE_LAMBERT";else A="DIFFUSE_"+t.diffuse_shader;K(e,c,u=oe(e,i={name:A,type:A,use_tangent_shading:t.use_tangent_shading},0,null,null,[]),"ldir"),K(e,c,u,"lfac"),K(e,r,u,"normal"),K(e,c,u,"norm_fac"),K(e,u,l,"lfactor"),"DIFFUSE_LAMBERT"!=A&&K(e,r,u,"dif_params");for(var S=0;S<n.length;S++)a.append_edge(e,n[S][0],l,n[S][1]);E=l}K(e,E,_,"color"),K(e,E,_,"specular")}function K(e,t,r,_){for(var n=a.get_node_attr(e,t),o=-1,i=a.get_node_attr(e,r).inputs,s=0;s<i.length;s++)if(_==i[s].identifier){o=s;break}if(-1!=o){var E=-1,c=n.outputs;for(s=0;s<c.length;s++)if(_==c[s].identifier){E=s;break}-1!=E&&(a.append_edge(e,t,r,[E,o]),c[E].is_linked=!0,i[o].is_linked=!0)}}function X(e,t,r){var _,n=a.subgraph_node_conn(e,t,a.BACKWARD_DIR),o=(_=[],a.traverse(n,function(e,t){for(var r=!1,n=t.inputs,a=0;a<n.length;a++)if("Normal"==n[a].identifier){r=!n[a].is_linked;break}r&&_.push(e)}),_);if(o.length){var i=function(e){return a.clone(e,ae,Oe)}(a.subgraph_node_conn(e,r,a.BACKWARD_DIR));a.traverse(i,function(e,t){t.name="displacement%join%"+t.name}),a.append_subgraph(i,n,[],[]);var s=-1;a.traverse(n,function(e,t){if("DISPLACEMENT_BUMP"==t.type)return s=e,1});for(var E=0;E<o.length;E++){var c=o[E],l=a.get_node_attr(n,c);K(n,s,c,"Normal"),H(l,"USE_NORMAL_IN",1)}}e.nodes=n.nodes,e.edges=n.edges}function H(e,t,r){for(var _=e.dirs,n=0;n<_.length;n++){var a=_[n];a[0]==t&&(a[1]=r)}}function Q(e,t,r){var _=[];a.traverse(e,function(e,t){"OUTPUT_SURFACE"==t.type&&_.push({node_id:e,node:t})});var n=[];_.length&&a.traverse(e,function(e,t){"MIX_SHADER"==t.type&&n.push({node_id:e,node:t})});for(var o=0;o<_.length;++o){var i=_[o].node_id,s=_[o].node,E=a.gen_node_id(e);a.append_node(e,E,s.data.bsdf_begin);var c=a.gen_node_id(e);a.append_node(e,c,s.data.bsdf_end),a.append_edge(e,E,c,[4,2]);for(var l=a.in_edge_count(e,i),T=[],u=[],d={},f=0;f<l;f++){var P=a.get_in_edge(e,i,f),A=a.get_node_attr(e,P);P in d||(d[P]=0);var S=a.get_edge_attr(e,P,i,d[P]++);if(T.push([P,i,S]),u.push([P,E,S]),"BSDF_GLOSSY"==A.type||"BSDF_DIFFUSE"==A.type||"MIX_SHADER"==A.type||"EMISSION"==A.type||"BSDF_TRANSPARENT"==A.type||"BSDF_PRINCIPLED"==A.type){u.push([P,E,[1,1]]),u.push([P,E,[2,2]]),u.push([P,E,[3,3]]),u.push([P,E,[4,4]]),u.push([P,E,[5,5]]),u.push([P,E,[6,6]]),u.push([P,E,[7,7]]),u.push([P,E,[8,8]]),u.push([P,E,[9,9]]),u.push([P,E,[10,10]]);for(var p=0;p<n.length;++p)for(var m=n[p].node_id,O=a.in_edge_count(e,m),v=0;v<O;v++){var N=a.get_in_edge(e,m,v),g=a.get_node_attr(e,N),h=a.get_edge_attr(e,N,m,0);if(0!=h[1]&&("BSDF_GLOSSY"==g.type||"BSDF_DIFFUSE"==g.type||"MIX_SHADER"==g.type||"EMISSION"==g.type||"BSDF_TRANSPARENT"==g.type||"BSDF_PRINCIPLED"==g.type)){var R=1==h[1]?3:13;u.push([N,m,[1,R]]),u.push([N,m,[2,R+1]]),u.push([N,m,[3,R+2]]),u.push([N,m,[4,R+3]]),u.push([N,m,[5,R+4]]),u.push([N,m,[6,R+5]]),u.push([N,m,[7,R+6]]),u.push([N,m,[8,R+7]]),u.push([N,m,[9,R+8]]),u.push([N,m,[10,R+9]])}}}}for(j(e,s.data.value,E,c,[],r),u.push([c,i,[0,0]]),u.push([c,i,[1,1]]),f=0;f<T.length;f++)a.remove_edge_by_attr(e,T[f][0],T[f][1],T[f][2]);for(f=0;f<u.length;f++)a.append_edge(e,u[f][0],u[f][1],u[f][2])}}function j(e,t,r,_,n,o){var i,s,E,c={name:"LIGHTING_AMBIENT",type:"LIGHTING_AMBIENT"},l=oe(e,c,0,null,null,[]),T=l;K(e,r,l,"E"),K(e,r,l,"A"),K(e,r,l,"D");for(var u=0;u<o.length;u++){i=oe(e,c={name:"LIGHTING_LAMP",type:"LIGHTING_LAMP"},0,null,null,[]),K(e,T,s=oe(e,c={name:"LIGHTING_APPLY",type:"LIGHTING_APPLY"},0,null,null,[]),"color"),K(e,T,s,"specular"),K(e,i,s,"ldir"),K(e,r,s,"normal"),K(e,r,s,"D"),K(e,r,s,"S"),K(e,i,s,"lcolorint"),K(e,r,i,"shadow_factor");var d=t.bsdf_shader;K(e,i,E=oe(e,c={name:d,type:d},0,null,null,[]),"ldir"),K(e,i,E,"lfac"),K(e,r,E,"normal"),K(e,i,E,"norm_fac"),K(e,r,E,"bsdf_params"),K(e,E,s,"lfactor"),K(e,E,s,"sfactor");for(var f=0;f<n.length;f++)a.append_edge(e,n[f][0],s,n[f][1]);T=s}K(e,r,_,"bsdf_params"),K(e,r,_,"d_color"),K(e,r,_,"s_color"),K(e,r,_,"e_color"),K(e,r,_,"emission"),K(e,r,_,"a_color"),K(e,r,_,"alpha"),K(e,T,_,"color"),K(e,T,_,"specular")}function q(e){a.traverse(e,function(t,r){for(var _=r.inputs,n=r.outputs,a=0;a<_.length;a++)W(e,_[a],t,a,1);for(a=0;a<n.length;a++)W(e,n[a],t,a,0)})}function W(e,t,r,_,n){if(t.is_linked){var o=!0;a.traverse_edges(e,function(e,t,a){(!n&&e==r&&a[0]==_||n&&t==r&&a[1]==_)&&(o=!1)}),o&&(t.is_linked=!1)}}function J(e,t){var _=[];if(a.traverse(t,function(t,r){r.name==e.name&&_.push(t)}),_.length)return _;r.panic("Node not found")}function Z(e,t,r){var _=function(e,t,r){for(var _=e.edges,n=0;n<_.length;n+=3)if(_[n+1]==t&&1==_[n+2][1])return _[n];return-1}(e,t);if(-1!=_){var n=a.get_node_attr(e,_);if(r.data=n.data,a.remove_edge(e,_,t,-1),0==a.out_edge_count(e,_)){var o=a.get_in_edge(e,_,0);-1!=o&&a.remove_edge(e,o,_,-1),a.remove_node(e,_)}}r.inputs.splice(1,1)}function $(e){var t=ne("merged_uv","UV_MERGED",[],[{default_value:[0,0,0],identifier:"UV_geom",is_linked:!1,name:"UV_geom"},{default_value:[0,0,0],identifier:"UV_cycles",is_linked:!1,name:"UV_cycles"}]);return t.uv_layer=e,t}function ee(e,t){var r=t[e];if(!r.is_completed){var _=ln(r);for(var n in r.ascs_ids){ee(n,t);var a=t[n];for(var o in a.ascs_ids)_.ascs_ids[o]=!0}_.is_completed=!0,t[e]=_}}function te(e,t){if(e.type!==t.type)return!1;switch(e.type){case"GEOMETRY_VC":return e.data.value==t.data.value;case"GEOMETRY_NO":return function(t,r,_){for(var n=e.dirs,a=-1,o=0;o<n.length;o++){var i=n[o];if("USE_NORMAL_IN"==i[0]){a=i[1];break}}var s=r.dirs,E=-1;for(o=0;o<s.length;o++){var c=s[o];if("USE_NORMAL_IN"==c[0]){E=c[1];break}}return a===E}(0,t);case"GEOMETRY_FB":case"GEOMETRY_VW":case"GEOMETRY_GL":case"GEOMETRY_LO":case"GEOMETRY_OR":case"GEOMETRY_BF":case"GEOMETRY_IN":return!0;case"TEXTURE_COLOR":case"TEXTURE_NORMAL":return e.data.bpy_uuid==t.data.bpy_uuid&&e.data.value.img_uuid==t.data.value.img_uuid;case"VALUE":case"RGB":return e.origin_name==t.origin_name;default:return!1}}function re(e,t,r){var _=a.get_node_attr(e,r);_.type+="_WORLD",a.remove_edge(e,t,r,0),_.inputs.splice(0,1);var n=a.get_in_edge(e,r,0);n!=a.NULL_NODE&&(a.get_edge_attr(e,n,r,0)[1]=0)}function _e(e,t,r,_,n,a){for(var i=e.nodes,s=null,E=0;E<i.length;E++){var c=i[E];n?"GROUP"==c.type&&c.node_tree_name==r&&(s=c):c.type==r&&(s=c)}return s?J(s,t)[0]:(a||o.error('No "'+r+'" node in node '+_),-1)}function ne(e,t,r,_){return{name:e,type:t,inputs:r,outputs:_}}function ae(e){var t={name:"",origin_name:"",type:"",vparams:[],inputs:[],outputs:[],params:[],data:null,dirs:[]};t.name=e.name,t.origin_name=e.origin_name,t.type=e.type;for(var r=t.vparams,_=e.vparams,n=0;n<_.length;n++)r.push(me(_[n]));var a=t.params,o=e.params;for(n=0;n<o.length;n++)a.push(me(o[n]));var i=t.inputs,s=e.inputs;for(n=0;n<s.length;n++)i.push(Pe(s[n]));var E=t.outputs,c=e.outputs;for(n=0;n<c.length;n++)E.push(Pe(c[n]));var l=t.dirs,T=e.dirs;for(n=0;n<T.length;n++)l.push(T[n].slice());return t.data=e.data,t}function oe(e,t,_,n,E,c){var l,f,P=t.name,A=t.name,D=t.type,F=[],G=[],k=[],K=[],X=null,H="uv_layer"in t&&(t.uv_layer||E&&E.uv_name)||"",Q="color_layer"in t&&(t.color_layer||E&&E.vc_name)||"",j=[];switch(D){case"BSDF_ANISOTROPIC":case"BSDF_GLASS":case"BSDF_HAIR":case"BSDF_TRANSLUCENT":case"BSDF_REFRACTION":case"BSDF_TOON":case"BSDF_VELVET":case"SUBSURFACE_SCATTERING":case"AMBIENT_OCCLUSION":case"VOLUME_ABSORPTION":case"VOLUME_SCATTER":case"BLACKBODY":case"WAVELENGTH":case"SEPXYZ":case"COMBXYZ":case"LIGHT_FALLOFF":case"TEX_SKY":case"TEX_NOISE":case"TEX_WAVE":case"TEX_MUSGRAVE":case"TEX_GRADIENT":case"TEX_MAGIC":case"TEX_CHECKER":case"TEX_BRICK":case"WIREFRAME":case"TANGENT":case"LIGHT_PATH":case"HOLDOUT":case"HAIR_INFO":case"SCRIPT":G=Ae(t),k=Se(t),o.warn(D+" node is not fully supported.");break;case"BRIGHTCONTRAST":case"ADD_SHADER":G=Ae(t),k=Se(t);break;case"MIX_SHADER":G.push(Te(t,"Fac"));var q=Te(t,"Shader"),W=q.is_linked;G.push(q);var J=Te(t,"Shader_001");J||(J=Te(t,"Shader.001"));var Z=J.is_linked;G.push(J),G.push(fe("d_color1","d_color1",[0,0,0],W)),G.push(fe("d_roughness1","d_roughness1",0,W)),G.push(fe("s_color1","s_color1",[0,0,0],W)),G.push(fe("s_roughness1","s_roughness1",0,W)),G.push(fe("metalness1","metalness1",0,W)),G.push(fe("normal1","normal1",[0,0,0],W)),G.push(fe("e_color1","e_color1",[0,0,0],W)),G.push(fe("emission1","emission1",0,W)),G.push(fe("a_color1","a_color1",[0,0,0],W)),G.push(fe("alpha1","alpha1",1,W)),G.push(fe("d_color2","d_color2",[0,0,0],Z)),G.push(fe("d_roughness2","d_roughness2",0,Z)),G.push(fe("s_color2","s_color2",[0,0,0],Z)),G.push(fe("s_roughness2","s_roughness2",0,Z)),G.push(fe("metalness2","metalness2",0,Z)),G.push(fe("normal2","normal2",[0,0,0],Z)),G.push(fe("e_color2","e_color2",[0,0,0],Z)),G.push(fe("emission2","emission2",0,Z)),G.push(fe("a_color2","a_color2",[0,0,0],Z)),G.push(fe("alpha2","alpha2",1,Z));var $=ue(t,"Shader"),ee=$.is_linked;k=[$,fe("d_color","d_color",[0,0,0],ee),fe("d_roughness","d_roughness",0,ee),fe("s_color","s_color",[0,0,0],ee),fe("s_roughness","s_roughness",0,ee),fe("metalness","metalness",0,ee),fe("normal","normal",[0,0,0],ee),fe("e_color","e_color",[0,0,0],ee),fe("emission","emission",0,ee),fe("a_color","a_color",[0,0,0],ee),fe("alpha","alpha",1,ee)];break;case"OBJECT_INFO":G=Ae(t),k=[];var te=ue(t,"Location"),re=ue(t,"Object Index"),_e=ue(t,"Material Index"),ne=ue(t,"Random");k.push(te),k.push(re),k.push(_e),k.push(ne),j.push(["USE_LOCATION_OUT",0|te.is_linked]),j.push(["USE_OBJ_IND_OUT",0|re.is_linked]),j.push(["USE_MAT_IND_OUT",0|_e.is_linked]),j.push(["USE_RANDOM_OUT",0|ne.is_linked]);break;case"UVMAP":if(H||(D="EMPTY_UV"),"EMPTY_UV"!=D){var ae=ce("param_"+D+"_a"),Ee=ce("param_"+D+"_v");F.push(pe(ae)),F.push(pe(Ee)),K.push(pe(Ee)),X={name:ae,value:H}}k=Se(t);break;case"UV_MERGED":ae=ce("param_UV_MERGED_a"),Ee=ce("param_UV_MERGED_v"),F.push(pe(ae)),F.push(pe(Ee)),k.push(ue(t,"UV_geom")),k.push(ue(t,"UV_cycles")),K.push(pe(Ee)),X={name:ae,value:H};break;case"CAMERA":G=[],k=Se(t);break;case"COMBRGB":case"COMBHSV":G=Ae(t),k=Se(t);break;case"CURVE_RGB":case"CURVE_VEC":"CURVE_RGB"==D?(xe(t,0,0,1)&&j.push(["READ_R",1]),xe(t,1,0,1)&&j.push(["READ_G",1]),xe(t,2,0,1)&&j.push(["READ_B",1]),xe(t,3,0,1)&&j.push(["READ_A",1])):(xe(t,0,-1,1)&&j.push(["READ_R",1]),xe(t,1,-1,1)&&j.push(["READ_G",1]),xe(t,2,-1,1)&&j.push(["READ_B",1])),G=Ae(t),k=Se(t),X={value:t};break;case"PARTICLE_INFO":G=Ae(t),k=Se(t);for(var de=0;de<t.outputs.length;de++){var Pe=t.outputs[de],me=Pe.identifier,Oe=pe("v_param_PART_INFO_"+me.replace(" ",""));if(Pe.is_linked)switch(me){case"Size":j.push(["PART_INFO_SIZE",i.glsl_value(1)]);break;case"Age":j.push(["PART_INFO_AGE",i.glsl_value(1)]);break;case"Lifetime":j.push(["PART_INFO_LT",i.glsl_value(1)]);break;case"Location":j.push(["PART_INFO_LOC",i.glsl_value(1)]);break;case"Index":var ve=pe("a_param_PART_INFO_"+Pe.identifier.replace(" ",""));X=ve,j.push(["PART_INFO_IND",i.glsl_value(1)]);break;case"Velocity":j.push(["PART_INFO_VEL",i.glsl_value(1)]);break;case"Angular Velocity":j.push(["PART_INFO_A_VEL",i.glsl_value(1)])}"Age"!=me&&"Lifetime"!=me&&"Size"!=me&&(F.push(Oe),K.push(Oe))}ve&&F.push(ve);break;case"NEW_GEOMETRY":case"GEOMETRY":if(!le(t))return!0;if(!(D=function(e,t){for(var r=e.outputs,_=0,n=0;n<r.length;n++){var a=r[n];if(a.is_linked&&!(_++<t))switch(a.identifier){case"UV":return"GEOMETRY_UV";case"Vertex Color":return"GEOMETRY_VC";case"Normal":return"GEOMETRY_NO";case"True Normal":return"GEOMETRY_TRN";case"Front/Back":return"GEOMETRY_FB";case"View":return"GEOMETRY_VW";case"Global":case"Position":return"GEOMETRY_GL";case"Local":return"GEOMETRY_LO";case"Orco":return"GEOMETRY_OR";case"Incoming":return"GEOMETRY_IN";case"Backfacing":return"GEOMETRY_BF";default:return null}}}(t,_)))return o.error("Geometry output is not supported"),null;switch(D){case"GEOMETRY_UV":H||(D="EMPTY_UV"),"EMPTY_UV"!=D&&(ae=ce("param_GEOMETRY_UV_a"),Ee=ce("param_GEOMETRY_UV_v"),F.push(pe(ae)),F.push(pe(Ee)),K.push(pe(Ee)),X={name:ae,value:H}),k.push(ue(t,"UV"));break;case"GEOMETRY_VC":if(Q||(D="EMPTY_VC"),"EMPTY_VC"!=D){var Ne=ce("param_GEOMETRY_VC_a"),ge=ce("param_GEOMETRY_VC_v");F.push(pe(Ne)),F.push(pe(ge)),K.push(pe(ge)),X={name:Ne,value:Q}}k.push(ue(t,"Vertex Color"));break;case"GEOMETRY_NO":G.push(fe("Normal","Normal",[0,0,0],!1)),j.push(["USE_NORMAL_IN",0]),k.push(ue(t,"Normal"));break;case"GEOMETRY_TRN":D="GEOMETRY_NO",G.push(fe("Normal","Normal",[0,0,0],!1)),k.push(ue(t,"True Normal")),j.push(["USE_NORMAL_IN",0]),o.warn("Geometry True Normal output is not fully supported.");break;case"GEOMETRY_FB":k.push(ue(t,"Front/Back"));break;case"GEOMETRY_VW":k.push(ue(t,"View"));break;case"GEOMETRY_GL":k.push(ue(t,"Global")||ue(t,"Position"));break;case"GEOMETRY_LO":k.push(ue(t,"Local"));break;case"GEOMETRY_OR":var he=ce("param_GEOMETRY_OR_v");F.push(pe(he)),k.push(ue(t,"Orco")),K.push(pe(he));break;case"GEOMETRY_IN":k.push(ue(t,"Incoming"));break;case"GEOMETRY_BF":k.push(ue(t,"Backfacing"))}break;case"ATTRIBUTE":if(!le(t))return!0;"EMPTY_VC"!=(D=Q?"GEOMETRY_VC":"EMPTY_VC")&&(Ne=ce("param_GEOMETRY_VC_a"),ge=ce("param_GEOMETRY_VC_v"),F.push(pe(Ne)),F.push(pe(ge)),K.push(pe(ge)),X={name:Ne,value:Q}),k.push(ue(t,"Color"));break;case"TEX_COORD":if(!le(t))return!0;switch(D=function(e,t){for(var r=e.outputs,_=0,n=0;n<r.length;n++){var a=r[n];if(a.is_linked&&!(_++<t))switch(a.identifier){case"Camera":return"TEX_COORD_CA";case"Generated":return"TEX_COORD_GE";case"Normal":return"TEX_COORD_NO";case"Object":return"TEX_COORD_OB";case"Reflection":return"TEX_COORD_RE";case"UV":return"TEX_COORD_UV";case"Window":return"TEX_COORD_WI";default:return null}}}(t,_)){case"TEX_COORD_UV":H||(D="EMPTY_UV"),"EMPTY_UV"!=D&&(ae=ce("param_TEX_COORD_UV_a"),Ee=ce("param_TEX_COORD_UV_v"),F.push(pe(ae)),F.push(pe(Ee)),K.push(pe(Ee)),X={name:ae,value:H}),k.push(ue(t,"UV"));break;case"TEX_COORD_NO":k.push(ue(t,"Normal"));break;case"TEX_COORD_GE":var Re=ce("param_TEX_COORD_GE_v");F.push(pe(Re)),k.push(ue(t,"Generated")),K.push(pe(Re));break;case"TEX_COORD_OB":k.push(ue(t,"Object"));break;case"TEX_COORD_CA":k.push(ue(t,"Camera"));break;case"TEX_COORD_WI":k.push(ue(t,"Window"));break;case"TEX_COORD_RE":k.push(ue(t,"Reflection"))}break;case"GROUP":var Ie=t.node_tree_name;switch(Ie){case"B4W_LINEAR_TO_SRGB":if(!ie(t,[1],[1])){X=se(t,n,E,[]);break}D="B4W_LINEAR_TO_SRGB";break;case"B4W_NORMAL_VIEW":case"B4W_VECTOR_VIEW":if(!ie(t,[1],[1])){X=se(t,n,E,[]);break}D="B4W_VECTOR_VIEW";break;case"B4W_SRGB_TO_LINEAR":if(!ie(t,[1],[1])){X=se(t,n,E,[]);break}D="B4W_SRGB_TO_LINEAR";break;case"B4W_REFLECT":if(!ie(t,[1,1],[1])){X=se(t,n,E,[]);break}D="B4W_REFLECT";break;case"B4W_REFRACTION":if(!ie(t,[1,0],[1])){X=se(t,n,E,[]);break}D="B4W_REFRACTION";break;case"B4W_PARALLAX":if(!ie(t,[1,1,0,0,0],[1])){X=se(t,n,E,[]);break}var be=ce("param_B4W_PARALLAX_texture");K.push(pe(be)),D="B4W_PARALLAX";break;case"B4W_CLAMP":if(!ie(t,[1],[1])){X=se(t,n,E,[]);break}D="B4W_CLAMP";break;case"B4W_TRANSLUCENCY":if(!ie(t,[0,0,0,0,0],[0])){X=se(t,n,E,[]);break}D="B4W_TRANSLUCENCY";break;case"B4W_TIME":if(!ie(t,[],[0])){X=se(t,n,E,[]);break}D="B4W_TIME";break;case"B4W_SMOOTHSTEP":if(!ie(t,[0,0,0],[0])){X=se(t,n,E,[]);break}D="B4W_SMOOTHSTEP";break;case"B4W_GLOW_OUTPUT":D="B4W_GLOW_OUTPUT";break;default:X=se(t,n,E,c)}if(G=Ae(t),k=Se(t),"B4W_TRANSLUCENCY"==Ie){var Ye=fe("TranslucencyParams","TranslucencyParams",[0,0,0,0]);Ye.is_linked=k[0].is_linked,k.push(Ye)}break;case"LAMP":var Le=t.lamp;Le?(Le.uuid in T?j.push(["LAMP_INDEX",String(T[Le.uuid])]):(T[Le.uuid]=u,j.push(["LAMP_INDEX",String(u++)])),X=T):(o.error("There is no lamp in node: "+t.name),j.push(["LAMP_INDEX",-1])),k.push(ue(t,"Color")),k.push(ue(t,"Light Vector")),k.push(ue(t,"Distance")),k.push(ue(t,"Visibility Factor"));break;case"LIGHTING_AMBIENT":G=[fe("E","E",[0,0,0],!0),fe("A","A",[0,0,0],!0),fe("D","D",[0,0,0],!0)],k=[fe("color","color",[0,0,0],!0),fe("specular","specular",[0,0,0],!0)];break;case"LIGHTING_BEGIN":k=[fe("E","E",[0,0,0],!0),fe("A","A",[0,0,0],!0),fe("D","D",[0,0,0],!0),fe("S","S",[0,0,0],!0),fe("normal","normal",[0,0,0],!0),fe("dif_params","dif_params",[0,0],!0),fe("sp_params","sp_params",[0,0],!0),fe("shadow_factor","shadow_factor",0,!0),fe("translucency_color","translucency_color",0,!0),fe("translucency_params","translucency_params",[0,0,0,0],!0)];break;case"LIGHTING_END":G=[fe("color","color",[0,0,0],!0),fe("specular","specular",[0,0,0],!0)];break;case"LIGHTING_LAMP":G=[fe("shadow_factor","shadow_factor",0,!0)],k=[fe("ldir","ldir",[0,0,0],!0),fe("lfac","lfac",[0,0],!0),fe("lcolorint","lcolorint",[0,0,0],!0),fe("norm_fac","norm_fac",0,!0)];break;case"DIFFUSE_LAMBERT":G=[fe("ldir","ldir",[0,0,0],!0),fe("lfac","lfac",[0,0],!0),fe("normal","normal",[0,0,0],!0),fe("norm_fac","norm_fac",0,!0)],k=[fe("lfactor","lfactor",0,!0)],j.push(["MAT_USE_TBN_SHADING",0|t.use_tangent_shading]);break;case"DIFFUSE_FRESNEL":case"DIFFUSE_MINNAERT":case"DIFFUSE_OREN_NAYAR":case"DIFFUSE_TOON":G=[fe("ldir","ldir",[0,0,0],!0),fe("lfac","lfac",[0,0],!0),fe("normal","normal",[0,0,0],!0),fe("norm_fac","norm_fac",0,!0),fe("dif_params","dif_params",[0,0],!0)],k=[fe("lfactor","lfactor",0,!0)],j.push(["MAT_USE_TBN_SHADING",0|t.use_tangent_shading]);break;case"SPECULAR_BLINN":case"SPECULAR_PHONG":case"SPECULAR_COOKTORR":G=[fe("ldir","ldir",[0,0,0],!0),fe("lfac","lfac",[0,0],!0),fe("normal","normal",[0,0,0],!0),fe("norm_fac","norm_fac",0,!0),fe("sp_params","sp_params",[0,0],!0)],k=[fe("sfactor","sfactor",0,!0)],j.push(["MAT_USE_TBN_SHADING",0|t.use_tangent_shading]);break;case"SPECULAR_TOON":case"SPECULAR_WARDISO":G=[fe("ldir","ldir",[0,0,0],!0),fe("lfac","lfac",[0,0],!0),fe("normal","normal",[0,0,0],!0),fe("norm_fac","norm_fac",0,!0),fe("sp_params","sp_params",[0,0],!0)],k=[fe("sfactor","sfactor",0,!0)],j.push(["MAT_USE_TBN_SHADING",0|t.use_tangent_shading]);break;case"BSDF_COMPUTE":G=[fe("ldir","ldir",[0,0,0],!0),fe("lfac","lfac",[0,0],!0),fe("normal","normal",[0,0,0],!0),fe("norm_fac","norm_fac",0,!0),fe("bsdf_params","bsdf_params",[0,0,0,0],!0)],k=[fe("lfactor","lfactor",0,!0),fe("sfactor","sfactor",0,!0)];break;case"LIGHTING_APPLY":G=[fe("color","color",[0,0,0,0],!0),fe("specular","specular",[0,0,0],!0),fe("lfactor","lfactor",0,!0),fe("sfactor","sfactor",0,!0),fe("ldir","ldir",[0,0,0],!0),fe("normal","normal",[0,0,0],!0),fe("translucency_params","translucency_params",[0,0,0,0],!0),fe("D","D",[0,0,0],!0),fe("S","S",[0,0,0],!0),fe("lcolorint","lcolorint",[0,0,0],!0),fe("translucency_color","translucency_color",0,!0)],k=[fe("color","color",[0,0,0,0],!0),fe("specular","specular",[0,0,0],!0)];break;case"NORMAL":G=Ae(t),k=Se(t);var Me=ue(t,"Normal");K.push(pe(ce("param_NORMAL_Normal"),Me.default_value,3));break;case"MAPPING":var ye=t.vector_type;D="MAPPING",G.push(Te(t,"Vector")),k.push(ue(t,"Vector"));var we=j_(t.rotation),Ue=j_(t.scale),Fe=j_(t.translation),Ge=p(),ke=an(we,p());switch("TEXTURE"!=ye&&"NORMAL"!=ye||(Ue[0]=Ue[0]||1,Ue[1]=Ue[1]||1,Ue[2]=Ue[2]||1),b(ke,new Float32Array([Ue[0],0,0,0,Ue[1],0,0,0,Ue[2]]),Ge),l=Ge,(f=B())[15]=1,f[14]=0,f[13]=0,f[12]=0,f[11]=0,f[10]=l[8],f[9]=l[7],f[8]=l[6],f[7]=0,f[6]=l[5],f[5]=l[4],f[4]=l[3],f[3]=0,f[2]=l[2],f[1]=l[1],f[0]=l[0],Ge=f,ye){case"POINT":Ge[12]=Fe[0],Ge[13]=Fe[1],Ge[14]=Fe[2];break;case"TEXTURE":Ge[12]=Fe[0],Ge[13]=Fe[1],Ge[14]=Fe[2],Ge=V(Ge,Ge);break;case"NORMAL":V(Ge,Ge),z(Ge,Ge)}switch(ye){case"NORMAL":j.push(["MAPPING_IS_NORMAL",1]);case"TEXTURE":j.push(["MAPPING_TRS_MATRIX_DEF",1]),j.push(["MAPPING_TRS_MATRIX",i.glsl_value(Ge,16)]);break;case"POINT":0!==De(we)?(j.push(["MAPPING_TRS_MATRIX_DEF",1]),j.push(["MAPPING_TRS_MATRIX",i.glsl_value(Ge,16)])):(0!==Ce(Ue,f_)&&(j.push(["MAPPING_SCALE_DEF",1]),j.push(["MAPPING_SCALE",i.glsl_value(Ue,3)])),0!==De(Fe)&&(j.push(["MAPPING_TRANS_DEF",1]),j.push(["MAPPING_TRANS",i.glsl_value(Fe,3)])));break;case"VECTOR":0!==De(we)?(j.push(["MAPPING_TRS_MATRIX_DEF",1]),j.push(["MAPPING_TRS_MATRIX",i.glsl_value(Ge,16)])):0!==Ce(Ue,f_)&&(j.push(["MAPPING_SCALE_DEF",1]),j.push(["MAPPING_SCALE",i.glsl_value(Ue,3)]))}t.use_min&&(j.push(["MAPPING_MIN_CLIP_DEF",1]),j.push(["MAPPING_MIN_CLIP",i.glsl_value(t.min,3)])),t.use_max&&(j.push(["MAPPING_MAX_CLIP_DEF",1]),j.push(["MAPPING_MAX_CLIP",i.glsl_value(t.max,3)]));break;case"MATERIAL":case"MATERIAL_EXT":var Ke=[],Be=[],Xe=[],He=[fe("E","E",[0,0,0],!0),fe("A","A",[0,0,0],!0),fe("D","D",[0,0,0],!0),fe("S","S",[0,0,0],!0),fe("normal","normal",[0,0,0],!0),fe("dif_params","dif_params",[0,0],!0),fe("sp_params","sp_params",[0,0],!0),fe("shadow_factor","shadow_factor",0,!0)],Qe=[fe("color","color",[0,0,0],!0),fe("specular","specular",[0,0,0],!0),fe("normal","normal",[0,0,0],!0)],ze=[ue(t,"Color"),ue(t,"Alpha"),ue(t,"Normal")],Ve=[];if((Nt=Te(t,"Color")).default_value.splice(3),Xe.push(Nt),G.push(Nt),(Nt=Te(t,"Spec")).default_value.splice(3),Xe.push(Nt),G.push(Nt),(Nt=Te(t,"DiffuseIntensity"))||(Nt=Te(t,"Refl")),Nt.default_value=t.diffuse_intensity,Xe.push(Nt),G.push(Nt),(yt=Te(t,"Normal")).default_value.splice(3),Xe.push(yt),G.push(yt),"MATERIAL_EXT"==D){(Nt=Te(t,"Emit"))||(Nt=fe("Emit","Emit",0)),Xe.push(Nt),G.push(Nt),(Nt=Te(t,"Translucency"))?(Nt.default_value=0,Nt.name="Translucency",Nt.identifier="Translucency"):Nt=fe("Translucency","Translucency",0),G.push(Nt),(Nt=Te(t,"Translucency"))?(Nt.default_value=[0,0,0,0],Nt.name="TranslucencyParams",Nt.identifier="TranslucencyParams"):Nt=fe("TranslucencyParams","TranslucencyParams",[0,0,0,0]),G.push(Nt);var je=Te(t,"Reflectivity"),qe=Te(t,"Ray Mirror");if(je){Nt=je;var We="Reflectivity"}else qe?(Nt=qe,We="Ray Mirror"):(Nt=je,We="Reflectivity");Nt||(Nt=fe(We,We,0)),G.push(Nt),Qe.push(Nt),(Nt=Te(t,"SpecTra"))||(Nt=fe("SpecTra","SpecTra",0)),G.push(Nt),Qe.push(Nt),(Nt=Te(t,"Alpha"))||(Nt=fe("Alpha","Alpha",t.alpha)),G.push(Nt),Qe.push(Nt),ze.push(ue(t,"Diffuse")),ze.push(ue(t,"Spec")),Ke.push(["MATERIAL_EXT",1]),Be.push(["MATERIAL_EXT",1])}else Xe.push(fe("emit_intensity","emit_intensity",0)),Qe.push(fe("reflect_factor","reflect_factor",0)),Qe.push(fe("specular_alpha","specular_alpha",0)),Qe.push(fe("alpha_in","alpha_in",0)),ze.push(fe("diffuse_out","diffuse_out",0)),ze.push(fe("spec_out","spec_out",0)),Ke.push(["MATERIAL_EXT",0]),Be.push(["MATERIAL_EXT",0]);Ve.push(pe(ce("param_MATERIAL_alpha"),t.alpha)),Ve.push(pe(ce("param_MATERIAL_spec_alpha"),t.specular_alpha)),k=ze,Ke.push(["USE_MATERIAL_NORMAL",0|yt.is_linked]),t.use_diffuse&&(Ke.push(["USE_MATERIAL_DIFFUSE",1]),Be.push(["USE_MATERIAL_DIFFUSE",1])),t.use_specular&&Be.push(["USE_MATERIAL_SPECULAR",1]);var Je,Ze,$e,et=[],tt=0;switch(t.specular_shader){case"COOKTORR":case"PHONG":Je=t.specular_hardness;break;case"WARDISO":Je=t.specular_slope;break;case"TOON":Je=t.specular_toon_size,tt=t.specular_toon_smooth;break;case"BLINN":Je=t.specular_ior,tt=t.specular_hardness;break;default:o.error("unsupported specular shader: "+t.specular_shader+' (material "'+t.material_name+'")'),Je=t.specular_hardness}switch(t.diffuse_shader){case"LAMBERT":Ze=0,$e=0;break;case"OREN_NAYAR":Ze=t.roughness,$e=0;break;case"FRESNEL":Ze=t.diffuse_fresnel,$e=t.diffuse_fresnel_factor;break;case"MINNAERT":Ze=t.darkness,$e=0;break;case"TOON":Ze=t.diffuse_toon_size,$e=t.diffuse_toon_smooth;break;default:o.error("unsupported diffuse shader: "+t.diffuse_shader+' (material "'+t.material_name+'")'),Ze=0,$e=0}et.push(pe(ce("param_MATERIAL_diffuse"),[Ze,$e],2)),et.push(pe(ce("param_MATERIAL_spec"),[t.specular_intensity,Je,tt],3)),Ke.push(["SHADELESS_MAT",t.use_shadeless?1:0]);var rt={name:t.name,value:{specular_shader:t.specular_shader,diffuse_shader:t.diffuse_shader,use_shadeless:t.use_shadeless,use_tangent_shading:t.use_tangent_shading}};X={name:t.name,value:{specular_shader:t.specular_shader,diffuse_shader:t.diffuse_shader,use_shadeless:t.use_shadeless,use_tangent_shading:t.use_tangent_shading},material_begin:{name:"material_begin",type:"MATERIAL_BEGIN",inputs:Xe,outputs:He,params:et,data:rt,dirs:Ke,vparams:[]},material_end:{name:"material_end",type:"MATERIAL_END",inputs:Qe,outputs:ze,params:Ve,data:rt,dirs:Be,vparams:[]}};break;case"BSDF_PRINCIPLED":G=Ae(t);var _t=Te(t,"Base Color"),nt=Te(t,"Metallic"),at=Te(t,"Roughness"),ot=Te(t,"Normal");G=[_t,nt,at,ot],j.push(["USE_NORMAL_IN",0|ot.is_linked]),k=[it=ue(t,"BSDF"),fe("d_color","d_color",[0,0,0],st=it.is_linked),fe("d_roughness","d_roughness",0,st),fe("s_color","s_color",[0,0,0],st),fe("s_roughness","s_roughness",0,st),fe("metalness","metalness",1,st),fe("normal","normal",[0,0,0],st),fe("e_color","e_color",[0,0,0],st),fe("emisson","emisson",0,st),fe("a_color","a_color",[0,0,0],st),fe("alpha","alpha",1,st)];break;case"BSDF_DIFFUSE":G=Ae(t),j.push(["USE_NORMAL_IN",0|G[2].is_linked]),k=[it=ue(t,"BSDF"),fe("d_color","d_color",[0,0,0],st=it.is_linked),fe("d_roughness","d_roughness",0,st),fe("s_color","s_color",[0,0,0],st),fe("s_roughness","s_roughness",0,st),fe("metalness","metalness",0,st),fe("normal","normal",[0,0,0],st),fe("e_color","e_color",[0,0,0],st),fe("emisson","emisson",0,st),fe("a_color","a_color",[0,0,0],st),fe("alpha","alpha",1,st)];break;case"BSDF_GLOSSY":G=Ae(t),j.push(["USE_NORMAL_IN",0|G[2].is_linked]),k=[it=ue(t,"BSDF"),fe("d_color","d_color",[0,0,0],st=it.is_linked),fe("d_roughness","d_roughness",0,st),fe("s_color","s_color",[0,0,0],st),fe("s_roughness","s_roughness",0,st),fe("metalness","metalness",1,st),fe("normal","normal",[0,0,0],st),fe("e_color","e_color",[0,0,0],st),fe("emisson","emisson",0,st),fe("a_color","a_color",[0,0,0],st),fe("alpha","alpha",1,st)];break;case"BSDF_TRANSPARENT":var it,st,Et=t.b4w_use_alpha;G=Ae(t),k=[it=ue(t,"BSDF"),fe("d_color","d_color",[0,0,0],st=it.is_linked),fe("d_roughness","d_roughness",0,st),fe("s_color","s_color",[0,0,0],st),fe("s_roughness","s_roughness",0,st),fe("metalness","metalness",0,st),fe("normal","normal",[0,0,0],st),fe("e_color","e_color",[0,0,0],st),fe("emisson","emisson",0,st),fe("a_color","a_color",[0,0,0],st),fe("alpha","alpha",Et?0:1,st)],X={value:{use_alpha:Et}},j.push(["USE_ALPHA",0|Et]);break;case"EMISSION":G=Ae(t);var ct=ue(t,"Emission"),lt=ct.is_linked;k=[ct,fe("d_color","d_color",[0,0,0],lt),fe("d_roughness","d_roughness",0,lt),fe("s_color","s_color",[0,0,0],lt),fe("s_roughness","s_roughness",0,lt),fe("metalness","metalness",1,lt),fe("normal","normal",[0,0,0],lt),fe("e_color","e_color",[0,0,0],lt),fe("emisson","emisson",1,lt),fe("a_color","a_color",[0,0,0],st),fe("alpha","alpha",1,st)];break;case"MATH":switch(t.operation){case"ADD":D="MATH_ADD";break;case"SUBTRACT":D="MATH_SUBTRACT";break;case"MULTIPLY":D="MATH_MULTIPLY";break;case"DIVIDE":D="MATH_DIVIDE";break;case"SINE":D="MATH_SINE";break;case"COSINE":D="MATH_COSINE";break;case"TANGENT":D="MATH_TANGENT";break;case"ARCSINE":D="MATH_ARCSINE";break;case"ARCCOSINE":D="MATH_ARCCOSINE";break;case"ARCTANGENT":D="MATH_ARCTANGENT";break;case"POWER":D="MATH_POWER";break;case"LOGARITHM":D="MATH_LOGARITHM";break;case"MINIMUM":D="MATH_MINIMUM";break;case"MAXIMUM":D="MATH_MAXIMUM";break;case"ROUND":D="MATH_ROUND";break;case"LESS_THAN":D="MATH_LESS_THAN";break;case"GREATER_THAN":D="MATH_GREATER_THAN";break;case"MODULO":D="MATH_MODULO";break;case"ABSOLUTE":D="MATH_ABSOLUTE";break;default:return o.error("Unsupported MATH operation: "+t.operation),null}j.push(["MATH_USE_CLAMP",Number(t.use_clamp)]),G=Ae(t),k=Se(t);break;case"MIX_RGB":switch(t.blend_type){case"MIX":D="MIX_RGB_MIX";break;case"ADD":D="MIX_RGB_ADD";break;case"MULTIPLY":D="MIX_RGB_MULTIPLY";break;case"SUBTRACT":D="MIX_RGB_SUBTRACT";break;case"SCREEN":D="MIX_RGB_SCREEN";break;case"DIVIDE":D="MIX_RGB_DIVIDE";break;case"DIFFERENCE":D="MIX_RGB_DIFFERENCE";break;case"DARKEN":D="MIX_RGB_DARKEN";break;case"LIGHTEN":D="MIX_RGB_LIGHTEN";break;case"OVERLAY":D="MIX_RGB_OVERLAY";break;case"DODGE":D="MIX_RGB_DODGE";break;case"BURN":D="MIX_RGB_BURN";break;case"HUE":D="MIX_RGB_HUE";break;case"SATURATION":D="MIX_RGB_SATURATION";break;case"VALUE":D="MIX_RGB_VALUE";break;case"COLOR":D="MIX_RGB_COLOR";break;case"SOFT_LIGHT":D="MIX_RGB_SOFT_LIGHT";break;case"LINEAR_LIGHT":D="MIX_RGB_LINEAR_LIGHT";break;default:return o.error("Unsupported MIX_RGB blend type: "+t.blend_type),null}j.push(["MIX_RGB_USE_CLAMP",Number(t.use_clamp)]),G=Ae(t),k=Se(t);break;case"MIX_WORLD_RGB":case"ADD_WORLD_RGB":G=[fe("Factor","Factor",t.fac,t.fac_is_linked),fe("Color1","Color1",[0,0,0],t.color1_is_linked),fe("Color2","Color1",[0,0,0],t.color2_is_linked)],k=[fe("Color","Color",[0,0,0],!0)];break;case"OUTPUT":G=Ae(t),k=[];break;case"OUTPUT_MATERIAL":G=Ae(t),k=[];var Tt=(St=Te(t,"Surface")).is_linked,ut={name:"bsdf_begin",type:"BSDF_BEGIN",inputs:[St,fe("d_color","d_color",[0,0,0],Tt),fe("d_roughness","d_roughness",0,Tt),fe("s_color","s_color",[0,0,0],Tt),fe("s_roughness","s_roughness",0,Tt),fe("metalness","metalness",0,Tt),fe("normal","normal",[0,0,0],Tt),fe("e_color","e_color",[0,0,0],Tt),fe("emission","emission",0,Tt),fe("a_color","a_color",[0,0,0],Tt),fe("alpha","alpha",0,Tt)],outputs:[fe("E","E",[0,0,0],!0),fe("A","A",[0,0,0],!0),fe("D","D",[0,0,0],!0),fe("S","S",[0,0,0],!0),fe("normal","normal",[0,0,0],!0),fe("bsdf_params","bsdf_params",[0,0,0,0],!0),fe("shadow_factor","shadow_factor",0,!0),fe("d_color","d_color",[0,0,0],!0),fe("s_color","s_color",[0,0,0],!0),fe("e_color","e_color",[0,0,0],!0),fe("emission","emission",0,!0),fe("a_color","a_color",[0,0,0],!0),fe("alpha","alpha",0,!0)],params:[],data:null,dirs:[],vparams:[]},dt={name:"bsdf_end",type:"BSDF_END",inputs:[fe("color","color",[0,0,0],!0),fe("specular","specular",[0,0,0],!0),fe("normal","normal",[0,0,0],!0),fe("bsdf_params","bsdf_params",[0,0,0,0],!0),fe("d_color","d_color",[0,0,0],!0),fe("s_color","s_color",[0,0,0],!0),fe("e_color","e_color",[0,0,0],!0),fe("emission","emission",0,!0),fe("a_color","a_color",[0,0,0],!0),fe("alpha","alpha",0,!0)],outputs:[fe("color","color",[0,0,0],Tt),fe("alpha","alpha",1,Tt)],params:[],data:null,dirs:[],vparams:[]},ft={name:"output_surface",type:"OUTPUT_SURFACE",inputs:[St,fe("alpha","alpha",1,Tt)],outputs:[],params:[],data:{value:{bsdf_shader:"BSDF_COMPUTE"},bsdf_begin:ut,bsdf_end:dt},dirs:[],vparams:[]},Pt=[fe("Height","Height",0,!0)],At=[fe("Normal","Normal",[0,0,0],!1)];X={name:t.name,output_surface:ft,displacement_bump:{name:"displacement_bump",type:"DISPLACEMENT_BUMP",inputs:Pt,outputs:At,params:[],data:null,dirs:[],vparams:[]}};break;case"OUTPUT_WORLD":G=Ae(t),k=Se(t);var St=Te(t,"Surface");X={name:t.name,output_world_surface:ft={name:"output_world_surface",type:"OUTPUT_WORLD_SURFACE",inputs:[St],outputs:[],params:[],data:null,dirs:[],vparams:[]}};break;case"RGB":K.push({name:"-1",value:t.name}),k.push(ue(t,"Color"));break;case"SEPRGB":case"SEPHSV":G=Ae(t),k=Se(t);break;case"TEX_ENVIRONMENT":(pt=t.image)?(D="TEXTURE_ENVIRONMENT_"+t.projection,j.push("NONE"==t.color_space?["NON_COLOR",1]:["NON_COLOR",0]),G.push(Te(t,"Vector")),j.push(["USE_VECTOR_IN",0|G[0].is_linked]),k.push(ue(t,"Color")),be=ce("param_TEXTURE_texture"),K.push(pe(be)),(It=s.create_texture(s.TT_RGBA_INT,!1)).repeat=!0,It.source="IMAGE",d.anisotropic_available&&(It.anisotropic_filtering=16),s.append_img_info(It,pt),X={bpy_name:t.name,bpy_uuid:"",name:be,value:It}):D="TEXTURE_EMPTY";break;case"TEX_IMAGE":var pt;if(pt=t.image){D="TEXTURE_COLOR",j.push("NONE"==t.color_space?["NON_COLOR",1]:["NON_COLOR",0]),j.push(["CONVERT_UV",0]);for(var mt=0;mt<4;++mt)mt?(Nt=fe("Vector"+mt,"Vector"+mt,[0,0,0],!1),gt=fe("Color"+mt,"Color"+mt,[0,0,0],!1),ht=fe("Alpha"+mt,"Alpha"+mt,0,!1)):(Nt=Te(t,"Vector"),gt=ue(t,"Color"),ht=ue(t,"Alpha")),G.push(Nt),k.push(gt),k.push(ht);be=ce("param_TEXTURE_texture"),K.push(pe(be)),(It=s.create_texture(s.TT_RGBA_INT,!1)).repeat="REPEAT"==t.extension,It.source="IMAGE",s.append_img_info(It,pt),X={bpy_name:t.name,bpy_uuid:"",name:be,value:It}}else D="TEXTURE_EMPTY";break;case"TEXTURE":if("TEXTURE_EMPTY"==(D=function(e){if(!e.texture||!e.texture._render)return"TEXTURE_EMPTY";for(var t=e.outputs,_=!1,n=!1,a=!1,i=0;i<t.length;i++){var s=t[i];if(s.is_linked)switch(s.identifier){case"Color":_=!0;break;case"Normal":n=!0;break;case"Value":a=!0;break;default:r.panic("Unknown texture output")}}return _?(n&&o.warn('Node "'+e.name+'" has both Color and Normal outputs. Normal will be omitted.'),"ENVIRONMENT_MAP"==e.texture.type?"TEXTURE_ENVIRONMENT_CUBE":"TEXTURE_COLOR"):n?"TEXTURE_NORMAL":a?"ENVIRONMENT_MAP"==e.texture.type?"TEXTURE_ENVIRONMENT_CUBE":"TEXTURE_COLOR":void 0}(t)))k.push(ue(t,"Color")),k.push(ue(t,"Normal")),k.push(ue(t,"Value"));else if("TEXTURE_ENVIRONMENT_CUBE"==D)G.push(Te(t,"Vector")),k.push(ue(t,"Color")),k.push(ue(t,"Value"));else{if("TEXTURE_NORMAL"==D&&"ENVIRONMENT_MAP"==t.texture.type)return o.error("Wrong output for ENVIRONMENT_MAP texture: "+t.name),null;if("TEXTURE_COLOR"==D){var Ot=!1,vt=t.texture.image;!vt||"Non-Color"!=vt.colorspace_settings_name&&"Non-Colour Data"!=vt.colorspace_settings_name||(Ot=!0),j.push(["NON_COLOR",Number(Ot)]),j.push(["CONVERT_UV",1])}for(mt=0;mt<4;++mt){var Nt,gt,ht,Rt="TEXTURE_COLOR"==D?"Color":"Normal";mt?(Nt=fe("Vector"+mt,"Vector"+mt,[0,0,0],!1),gt=fe(Rt+mt,Rt+mt,[0,0,0],!1),ht=fe("Value"+mt,"Value"+mt,0,!1)):(Nt=Te(t,"Vector"),gt=ue(t,Rt),ht=ue(t,"Value")),G.push(Nt),k.push(gt),k.push(ht)}}var It;"TEXTURE_EMPTY"!=D&&(be=ce("param_TEXTURE_texture"),K.push(pe(be)),X={bpy_name:t.texture.name,bpy_uuid:t.texture.uuid,name:be,value:It=t.texture._render});break;case"VALTORGB":G=Ae(t),k=Se(t),X={value:t};var bt=t.color_ramp.interpolation;"CONSTANT"!=bt&&"LINEAR"!=bt&&o.warn("Color Ramp node is not fully supported.");break;case"VALUE":D="VALUE",K.push({name:"-1",value:t.name}),k.push(ue(t,"Value"));break;case"VECT_MATH":switch(t.operation){case"ADD":D="VECT_MATH_ADD";break;case"SUBTRACT":D="VECT_MATH_SUBTRACT";break;case"AVERAGE":D="VECT_MATH_AVERAGE";break;case"DOT_PRODUCT":D="VECT_MATH_DOT_PRODUCT";break;case"CROSS_PRODUCT":D="VECT_MATH_CROSS_PRODUCT";break;case"NORMALIZE":D="VECT_MATH_NORMALIZE";break;default:return o.error("Unsupported VECT_MATH operation: "+t.operation),null}G=Ae(t),k=Se(t);break;case"VECT_TRANSFORM":switch(t.vector_type){case"POINT":j.push(["VECTOR_TYPE",i.glsl_value(S)]);break;case"VECTOR":j.push(["VECTOR_TYPE",i.glsl_value(m)]);break;case"NORMAL":j.push(["VECTOR_TYPE",i.glsl_value(O)]);break;default:return o.error("Unsupported VECT_TRANSFORM vector_type: "+t.vector_type),null}var Yt=t.convert_from,Lt=t.convert_to,Mt=v;if("WORLD"==Yt)if("WORLD"==Lt)Mt=v;else if("OBJECT"==Lt)Mt=N;else{if("CAMERA"!=Lt)return o.error("Unsupported VECT_TRANSFORM convert_to: "+t.convert_to),null;Mt=g}else if("OBJECT"==Yt)if("WORLD"==Lt)Mt=h;else if("OBJECT"==Lt)Mt=R;else{if("CAMERA"!=Lt)return o.error("Unsupported VECT_TRANSFORM convert_to: "+t.convert_to),null;Mt=I}else{if("CAMERA"!=Yt)return o.error("Unsupported VECT_TRANSFORM convert_from: "+t.convert_from),null;if("WORLD"==Lt)Mt=Y;else if("OBJECT"==Lt)Mt=L;else{if("CAMERA"!=Lt)return o.error("Unsupported VECT_TRANSFORM convert_to: "+t.convert_to),null;Mt=M}}j.push(["CONVERT_TYPE",i.glsl_value(Mt)]),G=Ae(t),k=Se(t);break;case"NORMAL_MAP":var xt=x;switch(t.space){case"TANGENT":xt=x;break;case"OBJECT":xt=y;break;case"WORLD":xt=w;break;case"BLENDER_OBJECT":xt=U;break;case"BLENDER_WORLD":xt=C;break;default:return o.error("Unsupported NORMAL_MAP space: "+t.space),null}j.push(["SPACE",i.glsl_value(xt)]),G.push(Te(t,"Strength")),G.push(Te(t,"Color")),G.push(fe("Normal","Normal",[0,0,0],!1)),j.push(["USE_NORMAL_IN",0]),k.push(ue(t,"Normal"));break;case"FRESNEL":var yt=Te(t,"Normal");G.push(Te(t,"IOR")),G.push(yt),k.push(ue(t,"Fac")),j.push(["USE_FRESNEL_NORMAL",0|yt.is_linked]);break;case"LAYER_WEIGHT":yt=Te(t,"Normal"),G.push(Te(t,"Blend")),G.push(yt),k=Se(t),j.push(["USE_NORMAL_IN",0|yt.is_linked]);break;case"BUMP":yt=Te(t,"Normal"),j.push(["INVERT",t.invert?1:0]),j.push(["USE_NORMAL_IN",0|yt.is_linked]),G=Ae(t),k=Se(t);break;case"BACKGROUND":default:G=Ae(t),k=Se(t)}var wt={name:P,origin_name:A,type:D,vparams:F,inputs:G,outputs:k,params:K,data:X,dirs:j},Ut=a.gen_node_id(e);return a.append_node(e,Ut,wt),"GEOMETRY"!=t.type&&"TEX_COORD"!=t.type&&"NEW_GEOMETRY"!=t.type||!function(e,t){for(var r=e.outputs,_=0,n=0;n<r.length;n++)if(r[n].is_linked&&_++>t)return!0;return!1}(t,_)||null!=oe(e,t,++_,n,E,c)?Ut:null}function ie(e,t,r){for(var _=e.inputs,n=e.outputs,a=e.node_tree_name,i=0;i<t.length;i++){var s=_[i];if(!s||s.default_value instanceof Array!=t[i])return o.warn('Wrong inputs for custom node group "'+e.name+'" of type: "',a,'".Processing as general node group.'),!1}for(i=0;i<r.length;i++){var E=n[i];if(!E||E.default_value instanceof Array!=r[i])return o.warn('Wrong outputs for custom node group "'+e.name+'" of type: "',a,'".Processing as general node group.'),!1}return!0}function se(e,t,r,n){var a=function(e){var t={};for(var r in e)if("links"==r||"nodes"==r){t[r]=[];for(var _=0;_<e[r].length;_++)for(var n in t[r][_]={},e[r][_])if("links"==r)for(var a in t[r][_][n]={},e[r][_][n])t[r][_][n][a]=Ee(e[r][_][n][a]);else t[r][_][n]=Ee(e[r][_][n])}else t[r]=Ee(e[r]);return t}(e.node_group.node_tree),o=e.node_tree_name;if("B4W_REPLACE"==o||"B4W_LEVELS_OF_QUALITY"==o){var i,s=ne("Group input","GROUP_INPUT",[],e.inputs),E=ne("Group output","GROUP_OUTPUT",e.outputs,[]);i={from_node:s,from_socket:"B4W_REPLACE"==o||"B4W_LEVELS_OF_QUALITY"==o&&(d.quality==_.P_LOW||d.force_low_quality_nodes)?s.outputs[1]:s.outputs[0],to_node:E,to_socket:E.inputs[0]},a.nodes=[s,E],a.links=[i]}return function(e,t){for(var r=t.nodes,_=t.links,n=0;n<r.length;n++)r[n].name=ge(r[n].type,e,r[n].name);for(n=0;n<_.length;n++)_[n].from_node.name=ge(_[n].from_node.type,e,_[n].from_node.name),_[n].to_node.name=ge(_[n].to_node.type,e,_[n].to_node.name)}(e.name,a),{node_group_graph:G(a,e.node_group.uuid,!0,t,r,n).graph,node_group_links:a.links}}function Ee(e){var t=typeof e;return"string"!=t&&"number"!=t&&"boolean"!=t&&e?Tn(e):e}function ce(e){E[e]||(E[e]=0);var t=e+"_"+E[e];return t=t.replace(/ /g,"_").replace(/\//g,"_"),E[e]++,t}function le(e){for(var t=e.outputs,r=0;r<t.length;r++)if(t[r].is_linked)return!0;return!1}function Te(e,t){for(var r=e.inputs,_=0;_<r.length;_++){var n=r[_];if(n.identifier==t)return de(n)}return null}function ue(e,t){for(var r=e.outputs,_=0;_<r.length;_++){var n=r[_];if(n.identifier==t)return de(n)}return null}function de(e){return{name:e.name,identifier:e.identifier,is_linked:e.is_linked,default_value:(t=e.default_value,kn(t)?t.slice(0):t)};var t}function fe(e,t,r,_){return{name:e,identifier:t,is_linked:_,default_value:r}}function Pe(e){return fe(e.name,e.identifier,e.default_value,e.is_linked)}function Ae(e){for(var t=[],r=0;r<e.inputs.length;r++){var _=de(e.inputs[r]);_.default_value.length&&_.default_value.splice(3),t.push(_)}return t}function Se(e){for(var t=[],r=0;r<e.outputs.length;r++){var _=de(e.outputs[r]);t.push(_)}return t}function pe(e,t,r){if(null===t||void 0===t)var _=null;else _=i.glsl_value(t,r);return{name:e,value:_}}function me(e){return{name:e.name,value:e.value}}function Oe(e){return e.slice()}function ve(e,t,r,_,n,o){for(var i=[],s=o.from_socket.identifier,E=o.to_socket.identifier,c=_.outputs,l=0;l<c.length;l++)if(c[l].identifier==s){i.push(l);break}var T=n.inputs;for(l=0;l<T.length;l++)if(T[l].identifier==E){i.push(l);break}return 2==i.length&&a.append_edge(e,t,r,i),!0}function Ne(e){return e.replace(/\./g,"")}function ge(e,t,r){return"GROUP_INPUT"==e?t+"*GI*"+r:"GROUP_OUTPUT"==e?t+"*GO*"+r:t+"%join%"+r}function he(e,t,r,_,n,a){switch(e.type){case"GROUP":e.name==t&&_.push(r);break;case"GROUP_INPUT":e.name.indexOf(t+"*GI*")||n.push(r);break;case"GROUP_OUTPUT":e.name.indexOf(t+"*GO*")||a.push(r)}}function Re(e,t,r){for(var _=[],n=0;n<r.length;n++){for(var a=r[n],o=null,i=0;i<t.length;i++)if(a.from_socket.identifier==t[i].to_socket.identifier){o=t[i];break}o?(a.from_node=o.from_node,a.from_socket=o.from_socket):_.push(a)}for(n=0;n<t.length;n++)e.splice(e.indexOf(t[n]),1);return _}function Ie(e,t,r){for(var _,n=J(e.to_node,t),o=0;o<n.length;o++)for(var i=a.get_node_attr(t,n[o]),s=0;s<i.inputs.length;s++){var E=i.inputs[s];if(E.identifier==e.to_socket.identifier){var c=Ye(E.default_value);if(Ye(r)==c)E.default_value=r;else switch(c){case f:Le(r,E.default_value);break;case P:E.default_value=((_=r)[0]+_[1]+_[2])/3}break}}}function be(e,t,r,_){for(var n=0;n<_.length;n++){for(var a,o=_[n],i=0;i<r.inputs.length;i++)if(o.from_socket.identifier==r.inputs[i].identifier){a=r.inputs[i].default_value;break}Ie(o,t,a);var s=e.indexOf(o);-1!=s&&e.splice(s,1)}}function Ye(e){return e instanceof Object?f:P}function Le(e,t){return t[0]=t[1]=t[2]=e,t}function Me(e,t,r){for(var _=e.name,n=[],o=[],i=[],s=[],E=0;E<t.length;E++){var c=t[E];he(c.from_node,_,c,n,i,s),he(c.to_node,_,c,o,i,s)}var l,T=Re(t,o,i),u=Re(t,s,n);(function(e,t){if(t.length)for(var r=t[0].from_node.name,_=0;_<e.length;_++)e[_].from_node.name==r&&t.push(e[_])})(t,T),be(t,r,e,T),u.length&&(a.traverse(r,function(e,t){"GROUP_OUTPUT"!=t.type||t.name.indexOf(_+"*GO*")||(l=t)}),be(t,r,l,u))}function xe(e,t,r,_){var n=e.curve_mapping.curves_data[t];return!(2==n.length&&n[0][0]<r+A&&n[0][1]<r+A&&n[1][0]>_-A&&n[1][1]>_-A)}t.get_ngraph_proxy_cached=function(e){return c[e]},t.cleanup_ngraph_proxy=function(e){delete c[e]},t.compose_ngraph_proxy=function(e,t,r,_,n,a,o,i){return G(e,t,r,a,o,i)},t.create_lighting_graph=function(e,t,r){if(e in l)return l[e];var _=a.create(),n={name:"LIGHTING_BEGIN",type:"LIGHTING_BEGIN"},o=oe(_,n,0,null,null,r);return k(_,t,o,oe(_,n={name:"LIGHTING_END",type:"LIGHTING_END"},0,null,null,r),[[o,[8,10]],[o,[9,6]]],r),q(_),l[e]=_,_},t.generate_graph_id=function(e,t,r,_){switch(e+=r,t){case"GLOW":e+="11";case"COLOR_ID":case"SHADOW":e+="00";default:e+="10"}return _&&_.vc_name&&(e+=_.vc_name),_&&_.uv_name&&(e+=_.uv_name),e},t.compose_node_elements=function(e){var t=[],r={};E={};var _=a.topsort(e);return a.traverse(_,function(e,_){var n=function(e){for(var t=[],r=[],_=[],n=[],a=[],o=[],s=0;s<e.inputs.length;s++){var E=e.inputs[s];if(E.is_linked)t.push(null),r.push(null);else{t.push(ce("in_"+e.type+"_"+Ne(E.identifier)));var c=i.glsl_value(E.default_value,0);d.shader_constants_hack&&(e.type.indexOf("MIX_RGB_")>=0&&("Color1"==E.identifier||"Color2"==E.identifier||"Fac"==E.identifier)||e.type.indexOf("MATH_")>=0&&("Value"==E.identifier||"Value_001"==E.identifier||"Value.001"==E.identifier)||e.type.indexOf("VECT_MATH_")>=0&&("Vector_001"==E.identifier||"Vector.001"==E.identifier)||e.type.indexOf("LIGHTING_APPLY")>=0||e.type.indexOf("MATERIAL_END")>=0||e.type.indexOf("MATERIAL_BEGIN")>=0)&&(c=c.replace(/(,)/g,"$1 ").replace(/(^|[^0-9]|\s)(0\.0)($|[^0-9]|\s)/g,"$1_0_0$3").replace(/(^|[^0-9]|\s)(1\.0)($|[^0-9]|\s)/g,"$1_1_0$3").replace(/\s+/g,"")),r.push(c)}}for(s=0;s<e.outputs.length;s++){var l=e.outputs[s];_.push(l.is_linked?null:ce("out_"+e.type+"_"+Ne(l.identifier)))}for(s=0;s<e.params.length;s++){var T=e.params[s];n.push(T.name),a.push(T.value)}for(s=0;s<e.vparams.length;s++)o.push(e.vparams[s].name);return{id:e.type,inputs:t,input_values:r,outputs:_,params:n,param_values:a,vparams:o,dirs:JSON.parse(JSON.stringify(e.dirs))}}(_);t.push(n),r[e]=n}),a.traverse_edges(_,function(e,t,n){var o=a.get_node_attr(_,e),i=r[e].outputs,s=r[t].inputs,E=i[n[0]]||ce("out_"+o.type+"_"+Ne(o.outputs[n[0]].identifier));i[n[0]]=E,s[n[1]]=E}),t},t.check_material_glow_output=function(e){if(e.node_tree)for(var t=0;t<e.node_tree.nodes.length;t++){var r=e.node_tree.nodes[t];if("GROUP"==r.type&&"B4W_GLOW_OUTPUT"==r.node_tree_name)return!0}return!1},t.print_node_graph=function(e,t,r){o.log("\n====== USER: "+t+", MATERIAL: "+r+" ======\n"+n.nodegraph_to_dot(e,!0)+"\n=============================================================")},t.cleanup=function(){for(var e in c)delete c[e];for(var e in l)delete l[e];for(var t in T)delete T[t];u=0},t.get_max_env_texture_height=function(e){var t=-1;return a.traverse(e,function(e,r){"TEXTURE_ENVIRONMENT_EQUIRECTANGULAR"!=r.type&&"TEXTURE_ENVIRONMENT_MIRROR_BALL"!=r.type||(t=Math.max(t,r.data.value.height))}),t}}),Ks=A("__batch",function(e,t){var r=ha(e),_=Wo(e),n=Jo(e),a=ga(e),o=Zo(e),i=$o(e),s=ks(e),E=os(e),c=is(e),l=Ps(e),T=Qi(e),u=As(e),d=ps(e),f=Gs(e),P=ai(e),A=ys(e),S=wi(e),m=_.defaults,O=_.context_limits,v=_.scenes,N=_.hmd_params,g=!1,R=!1,I=20,b=new Float32Array([0,0,-Math.sqrt(.5),Math.sqrt(.5)]),Y=2e5,L=1,M=2,x=new Float32Array(3),y=new Float32Array(3),w=new Float32Array(3),U=new Float32Array(4),C=ba(),D=p(),F={},G=new Float32Array(24),k=[5,4];function K(e){var t={type:e,subtype:"",id:0,data_id:0,cluster_id:-1,odd_id_prop:"",debug_id_color:-1,debug_main_batch_id:-1,debug_main_batch_render_time:0,debug_render_time:0,debug_render_time_queries:[],textures:[],texture_names:[],bpy_tex_names:[],material_names:[],common_attributes:[],uv_maps_usage:null,vertex_colors_usage:{},shader:null,shaders_info:f.init_shaders_info(),ngraph_proxy_id:"",attribute_setters:[],bufs_data:null,vaos:ua(),use_shape_keys:!1,debug_sphere:!1,debug_sphere_dynamic:!1,num_vertices:0,num_triangles:0,jitter_amp:0,jitter_freq:0,dynamic_grass:!1,grass_scale_threshold:0,grass_size:0,grass_map_dim:new Float32Array(3),cube_fog:new Float32Array(16),alpha_clip:!1,alpha_antialiasing:!1,blend:!1,depth_mask:!1,xray:!1,use_backface_culling:!1,use_shadeless:!1,dynamic_geometry:!1,shadow_cast:!1,shadow_cast_only:!1,shadow_receive:!1,reflexible:!1,reflexible_only:!1,reflective:!1,draw_mode:S.DM_DEFAULT,z_sort:!1,forked_batch:!1,do_not_cull:!1,caustics:!1,lod_dist_max:E.LOD_DIST_MAX_INFINITY,lod_dist_min:0,lod_lower_border_range:0,lod_upper_border_range:0,lod_settings:X(),cube_reflection_id:-1,plane_reflection_id:-1,halo:!1,halo_size:0,halo_hardness:0,halo_stars_blend:0,halo_stars_height:0,halo_rings_color:new Float32Array(3),halo_lines_color:new Float32Array(3),halo_particles:!1,ambient:0,emit:0,diffuse_intensity:1,reflect_factor:0,specular_color_factor:0,specular_alpha:1,parallax_scale:0,diffuse_color_factor:0,alpha_factor:1,normal_factor:0,mirror_factor:0,offset_z:0,refr_bump:0,diffuse_params:new Float32Array(2),specular_params:new Float32Array(3),texture_scale:new Float32Array(3),specular_color:new Float32Array(3),diffuse_color:new Float32Array(4),fresnel_params:new Float32Array(2),lamp_uuid_indexes:null,lamp_light_positions:null,lamp_light_directions:null,lamp_light_color_intensities:null,has_nodes:!1,wireframe_edge_color:ve(),water:!1,water_dynamic:!1,water_shore_smoothing:!1,water_generated_mesh:!1,water_num_cascads:0,water_subdivs:0,water_detailed_dist:0,water_norm_uv_velocity:.1,shallow_water_col_fac:0,shore_water_col_fac:0,foam_factor:0,foam_uv_freq:new Float32Array(2),foam_mag:new Float32Array(2),foam_scale:new Float32Array(2),shallow_water_col:new Float32Array(3),shore_water_col:new Float32Array(3),normalmap_scales:null,refractive:!1,is_sky:!1,draw_proc_sky:!1,particles_data:null,line_width:0,anchor_positions:null,part_node_data:null,node_values:[],node_value_inds:[],node_rgbs:[],node_rgb_inds:[],bounds_local:Po(),use_be:!1,submesh:null,cleanup_gl_data_on_unload:!0,inst_array_state:0,obj_info_params:new Float32Array(3),lights:[]};return t.diffuse_color[3]=1,t.depth_mask=!0,t.line_width=1,t.lod_settings.hyst_prev_state=-1,t}function B(e){var t,r,_=K(e.type);return _.subtype=e.subtype,_.id=e.id,_.cluster_id=e.cluster_id,_.odd_id_prop=e.odd_id_prop,_.debug_id_color=e.debug_id_color,_.debug_main_batch_id=e.debug_main_batch_id,_.debug_main_batch_render_time=e.debug_main_batch_render_time,_.debug_render_time=e.debug_render_time,_.debug_render_time_queries=[],_.textures=e.textures.slice(),_.texture_names=e.texture_names.slice(),_.bpy_tex_names=e.bpy_tex_names.slice(),_.material_names=e.material_names.slice(),_.common_attributes=e.common_attributes.slice(),_.uv_maps_usage=ln(e.uv_maps_usage),_.vertex_colors_usage=ln(e.vertex_colors_usage),_.shader=e.shader,_.shaders_info=f.clone_shaders_info(e.shaders_info),_.ngraph_proxy_id=e.ngraph_proxy_id,_.attribute_setters=T.clone_attribute_setters(e.attribute_setters),_.bufs_data=e.bufs_data,_.use_shape_keys=e.use_shape_keys,_.debug_sphere=e.debug_sphere,_.debug_sphere_dynamic=e.debug_sphere_dynamic,_.num_vertices=e.num_vertices,_.num_triangles=e.num_triangles,_.jitter_amp=e.jitter_amp,_.jitter_freq=e.jitter_freq,_.grass_scale_threshold=e.grass_scale_threshold,_.grass_size=e.grass_size,_.grass_map_dim=e.grass_map_dim,_.cube_fog=e.cube_fog,_.alpha_clip=e.alpha_clip,_.alpha_antialiasing=e.alpha_antialiasing,_.blend=e.blend,_.depth_mask=e.depth_mask,_.xray=e.xray,_.use_backface_culling=e.use_backface_culling,_.use_shadeless=e.use_shadeless,_.dynamic_geometry=e.dynamic_geometry,_.shadow_cast=e.shadow_cast,_.shadow_cast_only=e.shadow_cast_only,_.shadow_receive=e.shadow_receive,_.reflexible=e.reflexible,_.reflexible_only=e.reflexible_only,_.reflective=e.reflective,_.dynamic_grass=e.dynamic_grass,_.draw_mode=e.draw_mode,_.z_sort=e.z_sort,_.forked_batch=e.forked_batch,_.do_not_cull=e.do_not_cull,_.caustics=e.caustics,_.lod_dist_max=e.lod_dist_max,_.lod_dist_min=e.lod_dist_min,_.lod_lower_border_range=e.lod_lower_border_range,_.lod_upper_border_range=e.lod_upper_border_range,_.lod_settings=(t=e.lod_settings,(r=X()).use_smoothing=t.use_smoothing,r.coverage=t.coverage,r.cmp_logic=t.cmp_logic,r.dest_coverage=t.dest_coverage,r.hyst_prev_state=t.hyst_prev_state,r.hyst_interval_min=t.hyst_interval_min,r.hyst_interval_max=t.hyst_interval_max,r.prev_dist=t.prev_dist,r),_.cube_reflection_id=e.cube_reflection_id,_.plane_reflection_id=e.plane_reflection_id,_.halo=e.halo,_.halo_size=e.halo_size,_.halo_hardness=e.halo_hardness,_.halo_stars_blend=e.halo_stars_blend,_.halo_stars_height=e.halo_stars_height,he(e.halo_rings_color,_.halo_rings_color),he(e.halo_lines_color,_.halo_lines_color),_.halo_particles=e.halo_particles,_.ambient=e.ambient,_.emit=e.emit,_.diffuse_intensity=e.diffuse_intensity,_.reflect_factor=e.reflect_factor,_.specular_color_factor=e.specular_color_factor,_.specular_alpha=e.specular_alpha,_.parallax_scale=e.parallax_scale,_.diffuse_color_factor=e.diffuse_color_factor,_.alpha_factor=e.alpha_factor,_.normal_factor=e.normal_factor,_.mirror_factor=e.mirror_factor,_.offset_z=e.offset_z,_.refr_bump=e.refr_bump,_.diffuse_params[0]=e.diffuse_params[0],_.diffuse_params[1]=e.diffuse_params[1],he(e.specular_params,_.specular_params),he(e.texture_scale,_.texture_scale),he(e.specular_color,_.specular_color),nr(e.diffuse_color,_.diffuse_color),_.fresnel_params.set(e.fresnel_params),_.lamp_uuid_indexes=ln(e.lamp_uuid_indexes),e.lamp_light_positions&&(_.lamp_light_positions=new Float32Array(e.lamp_light_positions),_.lamp_light_directions=new Float32Array(e.lamp_light_directions),_.lamp_light_color_intensities=new Float32Array(e.lamp_light_color_intensities)),_.has_nodes=e.has_nodes,he(e.wireframe_edge_color,_.wireframe_edge_color),_.water=e.water,_.water_dynamic=e.water_dynamic,_.water_shore_smoothing=e.water_shore_smoothing,_.water_generated_mesh=e.water_generated_mesh,_.water_num_cascads=e.water_num_cascads,_.water_subdivs=e.water_subdivs,_.water_detailed_dist=e.water_detailed_dist,_.water_norm_uv_velocity=e.water_norm_uv_velocity,_.shallow_water_col_fac=e.shallow_water_col_fac,_.shore_water_col_fac=e.shore_water_col_fac,_.foam_factor=e.foam_factor,_.foam_uv_freq.set(e.foam_uv_freq),_.foam_mag.set(e.foam_mag),_.foam_scale.set(e.foam_scale),he(e.shallow_water_col,_.shallow_water_col),he(e.shore_water_col,_.shore_water_col),_.normalmap_scales=ln(e.normalmap_scales),_.refractive=e.refractive,_.is_sky=e.is_sky,_.draw_proc_sky=e.draw_proc_sky,e.particles_data&&(_.particles_data=c.clone_particles_data(e.particles_data)),_.line_width=e.line_width,e.anchor_positions&&(_.anchor_positions=new Float32Array(e.anchor_positions)),_.part_node_data=ln(e.part_node_data),_.node_values=e.node_values.slice(),_.node_value_inds=e.node_value_inds.slice(),_.node_rgbs=e.node_rgbs.slice(),_.node_rgb_inds=e.node_rgb_inds.slice(),Ao(e.bounds_local,_.bounds_local),_.use_be=e.use_be,_.cleanup_gl_data_on_unload=e.cleanup_gl_data_on_unload,_.obj_info_params=e.obj_info_params,_.lights=e.lights,_}function X(){var e={use_smoothing:!1,coverage:0,cmp_logic:0,dest_coverage:0,hyst_prev_state:0,hyst_interval_min:0,hyst_interval_max:0,prev_dist:0};return e.cmp_logic=1,e}function H(e){switch(e.type){case"MAIN":case"PARTICLES":case"LINE":e.subtype=e.blend?e.xray?"XRAY":"BLEND":"OPAQUE";break;case"SHADOW":e.subtype=e.shadow_cast_only?"CAST":"RECEIVE";break;case"COLOR_ID":e.subtype=e.xray?"COLOR_ID_XRAY":"COLOR_ID"}}function Q(e,t,_,n){var o=[],i=e._object,s=q(_,t,!t.do_not_render,!1),E=e.data,l=i.materials,T=new Array(l.length),d=new Array(l.length),f=[],A=u.find_subs(_,P.MAIN_OPAQUE),p=!1;A&&(p=!!A.light_positions.length);for(var O=0;O<s.length;O++)for(var v=s[O],N=0;N<l.length;N++){var g=l[N];if(!ze(i,N)&&!S.has_empty_submesh(E,N))if("PHYSICS"==v&&e.b4w_collision&&"NAVMESH"==e.game.physics_type)f.push(S.extract_submesh(E,N,[],t.bone_skinning_info,{},null));else if((!g.is_lens_flares||p)&&((R=K(v)).lights=ln(n),"MAIN"==v?T[N]=R:"DEBUG_VIEW"==v&&(d[N]=R),R.cluster_id=e.b4w_cluster_data.cluster_id,pe(R,g)&&W(R,g,E))){"SHADOW"==v&&T[N]&&(R.use_shadeless=T[N].use_shadeless),R.draw_mode=t.use_shape_keys||t.dynamic_geometry?S.DM_DYNAMIC_TRIANGLES:S.DM_DEFAULT,ce(R,t),ue(R,e.particle_systems),"DYNAMIC"!=t.type&&"COLOR_ID"!=R.type||(R.odd_id_prop=Qe(R,t,e.uuid)),R.do_not_cull=e.b4w_do_not_cull,"MAIN"==R.type&&(R.caustics=e.b4w_caustics),fe(R,"DISABLE_FOG",0|("COLOR_ID"!=v&&"SHADOW"!=v&&e.b4w_disable_fogging));var h=S.extract_submesh(E,N,R.common_attributes,t.bone_skinning_info,R.vertex_colors_usage,R.uv_maps_usage);!g.use_tangent_shading||"a_shade_tangs"in h.va_frames[0]||(fe(R,"CALC_TBN",1),de(R,"a_tbn")),g.is_lens_flares&&(h=z(h)),Ue(R),o.push({batch:R,obj_render:t,batch_render:t,submesh:h,mat_names:[g.name],rel_bpy_objects:[e]})}}if(f.length){var R;(R=K("PHYSICS")).subtype="NAVMESH",R.odd_id_prop=Qe(R,t,e.uuid),h=S.submesh_list_join(f);var I=[];for(O=0;O<l.length;O++)I.push(l[O].name);Ue(R),o.push({batch:R,obj_render:t,batch_render:t,submesh:h,mat_names:I,rel_bpy_objects:[e]})}for(O=0;O<d.length;O++)d[O]&&(d[O].debug_main_batch_id=T[O].id,Ue(d[O]));var b=e.particle_systems;if(b.length>0){var Y=!1,L=!1;for(O=0;O<b.length;O++){var M=b[O],x=M.settings;if(x.use_render_emitter&&o.length&&(Y=!0),"HAIR"!=x.type||"OBJECT"!=x.render_type&&"GROUP"!=x.render_type&&M.transforms.length||(L=!0),Y&&L)break}if(o.length)var y=o[0];else y=function(e,t,r){var _=K("TMP");return ue(_,r),{batch:_,submesh:S.extract_submesh(e,0,_.common_attributes,t.bone_skinning_info,_.vertex_colors_usage,_.uv_maps_usage)}}(E,t,b);var w=y.batch.vertex_colors_usage;if(L)if(l.length>1)var U=function(e,t,r,_){for(var n={},a=0;a<t.length;a++){var o=t[a].settings;if("HAIR"==o.type&&("OBJECT"==o.render_type||"GROUP"==o.render_type)){var i=o.b4w_vcol_from_name;""!==i&&""!==o.b4w_vcol_to_name&&(n[i]=ln(r[i]))}}return"a_bending_col_main"in r&&(n.a_bending_col_main=ln(r.a_bending_col_main)),"a_bending_col_detail"in r&&(n.a_bending_col_detail=ln(r.a_bending_col_detail)),S.extract_submesh_all_mats(e,[],n)}(E,b,w);else U=y.submesh;else U=null;var C=function(e,t,_,n,o,i){for(var s=e._object,E=[],l=e.particle_systems,T=e.data,d=0;d<l.length;d++){var f=l[d],A=f.settings;if(A.count)if("EMITTER"==A.type){if("DYNAMIC"==t.type){var p=K("PARTICLES");p.bounds_local.bb=t.bb_local,p.bounds_local.be=t.be_local,p.bounds_local.bs=t.bs_local,p.lights=ln(i);var O=V(f,s.materials),v=s.materials[O];if(ze(s,O))continue;if("HALO"===f.settings.render_type&&"HALO"==v.type&&(p.halo_particles=!0),!W(p,v,T))continue;Ae(p,f,s),p.dynamic_geometry=!0,p.do_not_cull=e.b4w_do_not_cull,p.odd_id_prop=Qe(p,t,s.name+"_"+A.uuid),c.create_particles_data(p,f,v);var N=c.generate_emitter_particles_submesh(p,T,f,s.render);c.update_particles_submesh(N,p,A.count),c.update_particles_objs_cache(s),ce(p,s.render),Ue(p),E.push({batch:p,obj_render:t,batch_render:t,submesh:N,mat_names:[v.name],rel_bpy_objects:[e]})}}else if("HAIR"==A.type){var g=tn(f.seed),h=-1!=sa(m.loaded_data_version,k)&&!A.b4w_initial_rand_rotation&&!A.b4w_hair_billboard,R=4;if(h&&(R=8),f.transforms.length)var I=f.transforms;else for(var b=S.geometry_random_points(o,A.count,!1,g),Y=(I=new Float32Array(b.length*R),0);Y<b.length;Y++){var L=.75+.5*en(g);I[Y*R]=b[Y][0],I[Y*R+1]=b[Y][1],I[Y*R+2]=b[Y][2],I[Y*R+3]=L,h&&(I[Y*R+4]=1,I[Y*R+5]=0,I[Y*R+6]=0,I[Y*R+7]=0)}var M=!!u.find_subs(_,P.GRASS_MAP);if("OBJECT"==A.render_type){var x=[q(_,A.dupli_object._object.render,!t.do_not_render,!0)],y=Se(e,t,n,o,[A.dupli_object],x,[I],A,f,M,g,!1,i);E.push.apply(E,y)}else if("GROUP"==A.render_type){var w=A.dupli_group.objects;for(x=[],Y=0;Y<w.length;Y++){var U=q(_,w[Y]._object.render,!t.do_not_render,!0);x.push(U)}var C=!1,D=[];for(Y=0;Y<w.length;Y++)D.push(w[Y]._object);if(A.use_whole_group){var F=xe(I,D,h,R);C=!0}else F=A.use_group_count?we(I,D,A.dupli_weights,g,h,R):Me(I,D,g,h,R);y=Se(e,t,n,o,w,x,F,A,f,M,g,C,i),E.push.apply(E,y)}"INSTANCE"==A.b4w_wind_bend_inheritance&&s.render.wind_bending&&a.warn('Emitter object "'+s.name+"\" has a particle system with wind bending inheritance from the particle instance. Wind bending on the emitter isn't disabled. Expect unforeseen behavior.")}else r.panic("Unknown particle settings type")}return E}(e,t,_,w,U,n);Y?o.push.apply(o,C):o=C}return o}function z(e){for(var t=e.base_length,r=e.va_frames[0].a_position,_=[],n=[],a=0;a<t;a++)n.push(r[3*a]),_.push(r[3*a+1]),n.push(r[3*a+2]);return _=new Float32Array(_),n=new Float32Array(n),e.va_common.a_lf_dist=_,e.va_common.a_lf_bb_vertex=n,e}function V(e,t){var r=e.settings.material-1;return r>=t.length&&(a.warn('Wrong material used for rendering particle system "'+e.name+'"'),r=0),r}function j(e,t){return"DYNAMIC"==e[0].type||"COLOR_ID"==t.type?e[0]:E.clone_render(e[0])}function q(e,t,r,_){var n=[];if(_||(t.selectable&&u.find_subs(e,P.COLOR_PICKING)||t.outlining&&u.find_subs(e,P.OUTLINE_MASK))&&n.push("COLOR_ID"),r&&(n.push("MAIN"),n.push("NODES_GLOW"),u.find_subs(e,P.DEBUG_VIEW)&&n.push("DEBUG_VIEW"),u.find_subs(e,P.SHADOW_RECEIVE)&&n.push("SHADOW"),u.find_subs(e,P.GRASS_MAP)&&n.push("GRASS_MAP")),n.push("PHYSICS"),t.shadow_cast_only||t.reflexible_only){var a=null;if(t.shadow_cast_only&&(a=["MAIN","NODES_GLOW","COLOR_ID","PHYSICS","DEBUG_VIEW"]),t.reflexible_only){var o=["COLOR_ID","PHYSICS","SHADOW","DEBUG_VIEW"];a=null!==a?function(e,t){var r,_,n=[],a={},o=t.length;for(r=0;r<o;r++)a[t[r]]=!0;for(o=e.length,r=0;r<o;r++)(_=e[r])in a&&n.push(_);return n}(a,o):o}n=function(e,t){for(var r=0;r<t.length;r++){var _=e.indexOf(t[r]);-1!==_&&e.splice(_,1)}return e}(n,a)}return n}function W(e,t,_){var n;switch(e.type){case"MAIN":n=function(e,t,r){if(t.do_not_render)return!1;if(t.use_nodes&&"HALO"!=t.type)return ae(e,t,r,"MAIN"),!0;ee(e,t),e.use_backface_culling=t.use_backface_culling,e.xray=t.render_above_all&&"OPAQUE"!=t.blend_mode&&"CLIP"!=t.blend_mode&&"ALPHA_ANTIALIASING"!=t.blend_mode,e.offset_z=t.offset_z,e.texture_scale.set([1,1,1]);var _=t.texture_slots;if(e.diffuse_color.set(t.diffuse_color),e.diffuse_color[3]=t.alpha,t.is_lens_flares)ke(e,"lens_flares.glslv","lens_flares.glslf"),de(e,"a_position"),de(e,"a_texcoord"),Be(e,A.get_batch_texture(_[0]),"u_sampler",(g=_[0].texture).name);else{if(ke(e,"main.glslv","main_stack.glslf"),!t.use_shadeless){var n={use_shadeless:t.use_shadeless,diffuse_shader:t.diffuse_shader,specular_shader:t.specular_shader,use_tangent_shading:t.use_tangent_shading},i=J(t.uuid,"MAIN"),E=s.create_lighting_graph(i,n,e.lights);e.shaders_info.node_elements=s.compose_node_elements(E)}var c=te("use_map_color_diffuse",!0,_),l=te("use_map_color_spec",!0,_),T=te("use_map_normal",!0,_),u=te("use_map_mirror",!0,_),d=te("use_stencil",!0,_),P=c[0],S=l[0],p=T[0],O=u[0],v=c[1],N=d[0]&&te("use_rgb_to_intensity",!0,_)[0];if(P){var g=P.texture;switch(P.blend_type){case"MIX":fe(e,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case"MULTIPLY":fe(e,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}Be(e,A.get_batch_texture(P),"u_colormap0",g.name),e.diffuse_color_factor=P.diffuse_color_factor,e.alpha_factor=P.use_map_alpha?P.alpha_factor:0,e.texture_scale.set(P.scale)}var h=P&&P==S;if(S&&(h||(g=S.texture,Be(e,A.get_batch_texture(S),"u_specmap0",g.name)),e.specular_color_factor=S.specular_color_factor),p&&(g=p.texture,de(e,"a_tbn"),Be(e,A.get_batch_texture(p),"u_normalmap0",g.name),e.normal_factor=p.normal_factor,g.b4w_use_map_parallax&&m.parallax)){var R=f.glsl_value(g.b4w_parallax_steps),I=f.glsl_value(g.b4w_parallax_lod_dist);fe(e,"PARALLAX",1),fe(e,"PARALLAX_STEPS",R),fe(e,"PARALLAX_LOD_DIST",I),e.parallax_scale=g.b4w_parallax_scale}O&&(g=O.texture,Be(e,A.get_batch_texture(O),"u_mirrormap",g.name),e.mirror_factor=O.mirror_factor);var b=P&&v&&N?1:0;b&&(Be(e,A.get_batch_texture(v),"u_colormap1",(g=v.texture).name),Be(e,A.get_batch_texture(N),"u_stencil0",(g=N.texture).name));var Y=P||S||p;Y&&e.texture_scale.set(Y.scale),fe(e,"TEXTURE_SPEC",void 0==S?0:1),fe(e,"ALPHA_AS_SPEC",h?1:0),fe(e,"TEXTURE_STENCIL_ALPHA_MASK",b),de(e,"a_position"),de(e,"a_tbn"),(P||S||p)&&de(e,"a_texcoord"),t.water_settings.is_water&&function(e,t){t.water=!0,t.water_dynamic=e.water_settings.is_dynamic,e.water_settings.shore_smoothing&&!t.blend?(a.warn('Material: "'+e.name+'" is opaque.',"Disabling water shore smoothing."),t.water_shore_smoothing=!1):t.water_shore_smoothing="REFLECT"!=t.subtype&&e.water_settings.shore_smoothing,ke(t,"water.glslv","water.glslf");var r={use_shadeless:!1,diffuse_shader:e.diffuse_shader,specular_shader:e.specular_shader,use_tangent_shading:e.use_tangent_shading},_=J(e.uuid),n=s.create_lighting_graph(_,r,t.lights);t.shaders_info.node_elements=s.compose_node_elements(n),de(t,"a_position"),m.water_wireframe_debug?(de(t,"a_polyindex"),t.depth_mask=!0,Re(0,0,0,t.wireframe_edge_color),o.get_standard_derivatives()?fe(t,"DEBUG_WIREFRAME",1):fe(t,"DEBUG_WIREFRAME",2)):fe(t,"DEBUG_WIREFRAME",0);var i=e.texture_slots,E=te("use_map_normal",!0,i),c=te("use_map_mirror",!0,i)[0];E.length&&(Be(t,A.get_batch_texture(E[0]),"u_normalmap0",(P=E[0].texture).name),t.water_norm_uv_velocity=e.water_settings.norm_uv_velocity),fe(t,"NUM_NORMALMAPS",E.length),t.normalmap_scales=new Array(E.length);for(var l=0;l<E.length;l++)t.normalmap_scales[l]=new Float32Array(2),t.normalmap_scales[l].set([E[l].scale[0],E[l].scale[1]]);c&&(Be(t,A.get_batch_texture(c),"u_mirrormap",(P=c.texture).name),t.mirror_factor=c.mirror_factor);var T=null;if(m.foam)for(l=0;l<i.length;l++)if(!0===(u=i[l]).texture.b4w_water_foam){T=u;break}for(T&&(fe(t,"FOAM",1),Be(t,A.get_batch_texture(T),"u_foam",(P=T.texture).name),t.foam_factor=e.water_settings.foam_factor,t.foam_uv_freq.set(P.b4w_foam_uv_freq),t.foam_mag.set(P.b4w_foam_uv_magnitude),t.foam_scale[0]=T.scale[0],t.foam_scale[1]=T.scale[1]),l=0;l<i.length;l++){var u;if(!0===(u=i[l]).texture.b4w_shore_dist_map){var d=u;break}}if(d&&m.allow_vertex_textures){var P;Be(t,A.get_batch_texture(d),"u_shore_dist_map",(P=d.texture).name),fe(t,"SHORE_PARAMS",1);var S=u.texture.b4w_shore_boundings;fe(t,"MAX_SHORE_DIST",f.glsl_value(u.texture.b4w_max_shore_dist)),fe(t,"SHORE_MAP_SIZE_X",f.glsl_value(S[0]-S[1])),fe(t,"SHORE_MAP_SIZE_Y",f.glsl_value(S[2]-S[3])),fe(t,"SHORE_MAP_CENTER_X",f.glsl_value((S[0]+S[1])/2)),fe(t,"SHORE_MAP_CENTER_Y",f.glsl_value((S[2]+S[3])/2))}if(e.water_settings.is_generated_mesh?(fe(t,"GENERATED_MESH",1),t.water_generated_mesh=!0,t.water_num_cascads=e.water_settings.num_cascads,t.water_subdivs=e.water_settings.num_subdivs,t.water_detailed_dist=e.water_settings.detailed_dist):(de(t,"a_tbn"),(T||E.length)&&de(t,"a_texcoord"),fe(t,"GENERATED_MESH",0)),e.water_settings.is_dynamic){var p=f.glsl_value(e.water_settings.dst_noise_scale0),O=f.glsl_value(e.water_settings.dst_noise_scale1),v=f.glsl_value(e.water_settings.dst_noise_freq0),N=f.glsl_value(e.water_settings.dst_noise_freq1),g=f.glsl_value(e.water_settings.dir_min_shore_fac),h=f.glsl_value(e.water_settings.dir_freq),R=f.glsl_value(e.water_settings.dir_noise_scale),I=f.glsl_value(e.water_settings.dir_noise_freq),b=f.glsl_value(e.water_settings.dir_min_noise_fac),Y=f.glsl_value(e.water_settings.dst_min_fac),L=f.glsl_value(e.water_settings.waves_hor_fac);fe(t,"DST_NOISE_SCALE_0",p),fe(t,"DST_NOISE_SCALE_1",O),fe(t,"DST_NOISE_FREQ_0",v),fe(t,"DST_NOISE_FREQ_1",N),fe(t,"DIR_MIN_SHR_FAC",g),fe(t,"DIR_FREQ",h),fe(t,"DIR_NOISE_SCALE",R),fe(t,"DIR_NOISE_FREQ",I),fe(t,"DIR_MIN_NOISE_FAC",b),fe(t,"DST_MIN_FAC",Y),fe(t,"WAVES_HOR_FAC",L)}_e(t,e),ne(t,e),t.shallow_water_col.set(e.water_settings.shallow_col),t.shore_water_col.set(e.water_settings.shore_col),t.shallow_water_col_fac=e.water_settings.shallow_col_fac,t.shore_water_col_fac=e.water_settings.shore_col_fac,fe(t,"ABSORB",f.glsl_value(e.water_settings.absorb_factor)),fe(t,"SSS_STRENGTH",f.glsl_value(e.water_settings.sss_strength)),fe(t,"SSS_WIDTH",f.glsl_value(e.water_settings.sss_width))}(t,e),"HALO"===t.type&&(ke(e,"halo.glslv","halo.glslf"),Z(e,t),e.common_attributes=["a_position"]),t.use_tangent_shading&&(fe(e,"USE_TBN_SHADING",1),de(e,"a_shade_tangs")),fe(e,"TEXCOORD",0),fe(e,"NORMAL_TEXCOORD",0),P&&$(e,P,"TEXTURE_COLOR0_CO"),v&&$(e,v,"TEXTURE_COLOR1_CO"),N&&$(e,N,"TEXTURE_STENCIL_ALPHA_MASK_CO"),S&&$(e,S,"TEXTURE_SPEC_CO"),p&&$(e,p,"TEXTURE_NORM_CO"),fe(e,"SHADELESS",t.use_shadeless?1:0),e.use_shadeless=t.use_shadeless}return fe(e,"ALPHA","OPAQUE"===t.blend_mode?0:1),fe(e,"ALPHA_CLIP","CLIP"===t.blend_mode?1:0),fe(e,"DOUBLE_SIDED_LIGHTING",t.use_double_sided_lighting?1:0),t.use_vertex_color_paint?(fe(e,"VERTEX_COLOR",1),de(e,"a_color")):fe(e,"VERTEX_COLOR",0),e.ambient=t.ambient,e.diffuse_intensity=t.diffuse_intensity,e.emit=t.emit,e.specular_color.set(t.specular_color),e.specular_alpha=t.specular_alpha,_e(e,t),ne(e,t),fe(e,"WETTABLE",t.is_wettable?1:0),re(e,t),t.is_refractive&&!e.blend?(a.warn('Material "'+t.name+'" is not blend. Disabling refractions.'),e.refractive=!1):e.refractive=t.is_refractive,e.refr_bump=t.refr_bump,!0}(e,t,_);break;case"NODES_GLOW":n=ae(e,t,_,"GLOW");break;case"SHADOW":n=function(e,t,r){if(t.is_lens_flares||t.water_settings.is_water||t.do_not_render||"HALO"==t.type)return!1;if(ee(e,t),e.use_backface_culling=t.use_backface_culling,e.blend)return!1;!t.use_nodes||"CLIP"!=t.blend_mode&&"ALPHA_ANTIALIASING"!=t.blend_mode?ke(e,"shadow.glslv","shadow.glslf"):ae(e,t,r,"SHADOW"),e.depth_mask=e.depth_mask&&!(m.reuse_depth_optimization&&"ALPHA_ANTIALIASING"==t.blend_mode),ar(0,0,0,t.alpha,e.diffuse_color),de(e,"a_position"),de(e,"a_tbn"),fe(e,"ALPHA","OPAQUE"===t.blend_mode?0:1),e.texture_scale.set([1,1,1]);var _=te("use_map_color_diffuse",!0,t.texture_slots)[0];if(!_||"CLIP"!=t.blend_mode&&"ALPHA_ANTIALIASING"!=t.blend_mode)fe(e,"TEXTURE_COLOR",0);else{switch(_.blend_type){case"MIX":fe(e,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case"MULTIPLY":fe(e,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}e.texture_scale.set(_.scale),fe(e,"TEXTURE_COLOR",1),de(e,"a_texcoord");var n=A.get_batch_texture(_);"IMAGE"!=n.source&&"ENVIRONMENT_MAP"!=n.source&&"CANVAS"!=n.source&&"NONE"!=n.source||Be(e,n,"u_colormap0",_.texture.name)}return!0}(e,t,_);break;case"PHYSICS":n=function(e,t){var r=t.physics_settings,_=t.water_settings;return r.use_coll_physics?(e.use_ghost=r.use_ghost,e.collision_id=r.collision_id,e.collision_margin=r.collision_margin,e.collision_group=r.collision_group,e.collision_mask=r.collision_mask,e.friction=r.friction,e.elasticity=r.elasticity,!0):!!_.is_water&&(e.water=!0,e.water_dynamics=_.is_dynamic,e.dst_noise_scale0=_.dst_noise_scale0,e.dst_noise_scale1=_.dst_noise_scale1,e.dst_noise_freq0=_.dst_noise_freq0,e.dst_noise_freq1=_.dst_noise_freq1,e.dir_min_shore_fac=_.dir_min_shore_fac,e.dir_freq=_.dir_freq,e.dir_noise_scale=_.dir_noise_scale,e.dir_noise_freq=_.dir_noise_freq,e.dir_min_noise_fac=_.dir_min_noise_fac,e.dst_min_fac=_.dst_min_fac,e.waves_hor_fac=_.waves_hor_fac,!0)}(e,t);break;case"COLOR_ID":n=function(e,t,r){if(t.is_lens_flares||"HALO"==t.type)return!1;var _=t.blend_mode,n=_;"ALPHA_ANTIALIASING"==n&&(n="CLIP",t.blend_mode="CLIP"),ee(e,t),e.use_backface_culling=t.use_backface_culling,e.z_sort=!1,e.depth_mask=!0,e.blend=!1,e.xray=t.render_above_all&&"OPAQUE"!=n&&"CLIP"!=n,t.use_nodes&&"CLIP"==n?ae(e,t,r,"COLOR_ID"):ke(e,"color_id.glslv","color_id.glslf"),ar(0,0,0,t.alpha,e.diffuse_color),de(e,"a_position"),fe(e,"ALPHA","OPAQUE"===n?0:1),e.texture_scale.set([1,1,1]);var a=te("use_map_color_diffuse",!0,t.texture_slots)[0];if(fe(e,"ALPHA_CLIP","CLIP"===n?1:0),a&&"CLIP"==n){switch(a.blend_type){case"MIX":fe(e,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case"MULTIPLY":fe(e,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}e.texture_scale.set(a.scale),fe(e,"TEXTURE_COLOR",1),de(e,"a_texcoord");var o=A.get_batch_texture(a);"IMAGE"!=o.source&&"ENVIRONMENT_MAP"!=o.source&&"CANVAS"!=o.source&&"NONE"!=o.source||Be(e,o,"u_colormap0",a.texture.name)}else fe(e,"TEXTURE_COLOR",0);return t.blend_mode=_,!0}(e,t,_);break;case"GRASS_MAP":n=function(e,t){if(!t.terrain_settings.is_terrain||t.do_not_render)return!1;if(ee(e,t),e.use_backface_culling=t.use_backface_culling,e.blend=!1,e.z_sort=!1,e.depth_mask=!0,ke(e,"grass_map.glslv","grass_map.glslf"),de(e,"a_position"),t.terrain_settings.dynamic_grass_size)var r=t.terrain_settings.dynamic_grass_size;else r=null;if(t.terrain_settings.dynamic_grass_color)var _=t.terrain_settings.dynamic_grass_color;else _=null;return e.vertex_colors_usage.a_grass_size={generate_buffer:!0,src:[]},r?(e.vertex_colors_usage.a_grass_size.src.push({name:r,mask:4}),fe(e,"DYNAMIC_GRASS_SIZE",1)):fe(e,"DYNAMIC_GRASS_SIZE",0),e.vertex_colors_usage.a_grass_color={generate_buffer:!0,src:[]},_?(e.vertex_colors_usage.a_grass_color.src.push({name:_,mask:7}),fe(e,"DYNAMIC_GRASS_COLOR",1)):fe(e,"DYNAMIC_GRASS_COLOR",0),fe(e,"GRASS_TEXTURE_SIZE",f.glsl_value(v.grass_tex_size)),!0}(e,t);break;case"DEBUG_VIEW":n=Ee(e,t);break;case"PARTICLES":n=function(e,t,r){if(t.do_not_render)return!1;var _=t.texture_slots;if(e.halo_particles)ke(e,"particle_system.glslv","particle_system_stack.glslf"),fe(e,"HALO_PARTICLES",1),Z(e,t);else{var n={use_shadeless:!1,diffuse_shader:t.diffuse_shader,specular_shader:t.specular_shader,use_tangent_shading:t.use_tangent_shading};if(t.use_nodes)return ke(e,"particle_system.glslv","particle_system.glslf"),ae(e,t,r,"PARTICLES"),!0;ke(e,"particle_system.glslv","particle_system_stack.glslf");var a=J(t.uuid),o=s.create_lighting_graph(a,n,e.lights);e.shaders_info.node_elements=s.compose_node_elements(o);var i=te("use_map_color_diffuse",!0,_)[0];if(i){switch(fe(e,"TEXTURE_COLOR",1),i.blend_type){case"MIX":fe(e,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case"MULTIPLY":fe(e,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}e.diffuse_color_factor=i.diffuse_color_factor,e.alpha_factor=i.use_map_alpha?i.alpha_factor:0,Be(e,A.get_batch_texture(i),"default"+String(e.textures.length),i.texture.name)}}return e.diffuse_color.set(t.diffuse_color),e.diffuse_color[3]=t.alpha,e.ambient=t.ambient,e.diffuse_intensity=t.diffuse_intensity,e.emit=t.emit,e.specular_color.set(t.specular_color),e.specular_alpha=t.specular_alpha,de(e,"a_position"),de(e,"a_tbn"),fe(e,"ALPHA","OPAQUE"===t.blend_mode?0:1),fe(e,"ALPHA_CLIP","CLIP"===t.blend_mode?1:0),fe(e,"PARTICLES_SHADELESS",t.use_shadeless?1:0),_e(e,t),ne(e,t),ee(e,t),e.use_backface_culling=t.use_backface_culling,e.xray=t.render_above_all&&"OPAQUE"!=t.blend_mode&&"CLIP"!=t.blend_mode&&"ALPHA_ANTIALIASING"!=t.blend_mode,e.offset_z=t.offset_z,!0}(e,t,_);break;default:r.panic("Wrong batch type: "+e.type)}return n}function J(e,t,r){var _="";return d.check_active()&&(_=d.get_active().uuid),s.generate_graph_id(e,t,_,r)}function Z(e,t){var r=t.halo_settings;fe(e,"NUM_RINGS",r.ring_count),fe(e,"NUM_LINES",r.line_count),fe(e,"NUM_STARS",r.star_tip_count),fe(e,"SKY_STARS",r.is_sky_stars?1:0),e.halo_size=r.size,e.halo_hardness=r.hardness/20,e.halo_rings_color.set(r.rings_color),e.halo_lines_color.set(r.lines_color),e.halo_stars_blend=1/r.stars_blend_height,e.halo_stars_height=r.stars_min_height,e.halo=!0}function $(e,t,r){switch(t.texture_coords){case"UV":case"ORCO":fe(e,r,"TEXTURE_COORDS_UV_ORCO"),fe(e,"TEXCOORD",1);break;case"NORMAL":fe(e,r,"TEXTURE_COORDS_NORMAL"),fe(e,"NORMAL_TEXCOORD",1);break;default:fe(e,r,"TEXTURE_COORDS_NONE")}}function ee(e,t){switch(t.blend_mode){case"ALPHA_ANTIALIASING":e.blend=!1,e.z_sort=!1,e.depth_mask=!0,e.alpha_clip=!1,e.alpha_antialiasing=!0;break;case"ALPHA_SORT":e.blend=!0,e.z_sort=!0,e.depth_mask=!0,e.alpha_clip=!1,e.alpha_antialiasing=!1;break;case"ALPHA":e.blend=!0,e.z_sort=!1,e.depth_mask=!0,e.alpha_clip=!1,e.alpha_antialiasing=!1;break;case"CLIP":e.blend=!1,e.z_sort=!1,e.depth_mask=!0,e.alpha_clip=!0,e.alpha_antialiasing=!1;break;case"ADD":e.blend=!0,e.z_sort=!1,e.depth_mask=!1,e.alpha_clip=!1,e.alpha_antialiasing=!1;break;case"OPAQUE":e.blend=!1,e.z_sort=!1,e.depth_mask=!0,e.alpha_clip=!1,e.alpha_antialiasing=!1;break;default:r.panic("Unknown alpha blend mode: "+t.blend_mode)}}function te(e,t,r){for(var _=[],n=r.length,a=0;a<n;a++){var o=r[a];o[e]==t&&o.texture&&o.texture._render&&_.push(o)}return _}function re(e,t){var r=t.raytrace_mirror;e.reflect_factor=r.reflect_factor,e.fresnel_params[0]=r.fresnel,e.fresnel_params[1]=1-r.fresnel_factor/5}function _e(e,t){var r,_=0;switch(t.specular_shader){case"PHONG":case"COOKTORR":r=t.specular_hardness;break;case"WARDISO":r=t.specular_slope;break;case"TOON":r=t.specular_toon_size,_=t.specular_toon_smooth;break;case"BLINN":r=t.specular_ior,_=t.specular_hardness;break;default:a.error("unsupported specular shader: "+t.specular_shader+' (material "'+t.name+'")'),r=t.specular_hardness}e.specular_params[0]=t.specular_intensity,e.specular_params[1]=r,e.specular_params[2]=_}function ne(e,t){switch(t.diffuse_shader){case"LAMBERT":e.diffuse_params[0]=0,e.diffuse_params[1]=0;break;case"OREN_NAYAR":e.diffuse_params[0]=t.roughness,e.diffuse_params[1]=0;break;case"FRESNEL":e.diffuse_params[0]=t.diffuse_fresnel,e.diffuse_params[1]=t.diffuse_fresnel_factor;break;case"MINNAERT":e.diffuse_params[0]=t.darkness,e.diffuse_params[1]=0;break;case"TOON":e.diffuse_params[0]=t.diffuse_toon_size,e.diffuse_params[1]=t.diffuse_toon_smooth;break;default:a.error("unsupported diffuse shader: "+t.diffuse_shader+' (material "'+t.name+'")'),e.diffuse_params[0]=0,e.diffuse_params[1]=0}}function ae(e,t,r,_){if(!t.use_nodes||t.do_not_render)return!1;var n;switch(_){case"MAIN":ke(e,"main.glslv","main.glslf"),n=!1;break;case"GLOW":ke(e,"main.glslv","main.glslf"),n=!0;break;case"SHADOW":ke(e,"shadow.glslv","shadow.glslf"),n=!1;break;case"COLOR_ID":ke(e,"color_id.glslv","color_id.glslf"),n=!1}var E=t.node_tree,c={vc_name:r.active_vcol_name,uv_name:r.active_uv_name},l=J(t.uuid,_,c),T=s.compose_ngraph_proxy(E,l,!1,r.name,t.name,_,c,e.lights);if(!T.graph)return a.error('Failed to create node graph for material "'+t.name+'", disable nodes'),se(e,t),!0;e.ngraph_proxy_id=T.id,e.has_nodes=!0,fe(e,"NODES",1),fe(e,"DOUBLE_SIDED_LIGHTING",t.use_double_sided_lighting?1:0),de(e,"a_position"),t.use_orco_tex_coord&&de(e,"a_orco_tex_coord"),ee(e,t),e.use_backface_culling=t.use_backface_culling,e.offset_z=t.offset_z,n?(fe(e,"ALPHA",1),fe(e,"ALPHA_CLIP",0)):(fe(e,"ALPHA","OPAQUE"===t.blend_mode?0:1),fe(e,"ALPHA_CLIP","CLIP"===t.blend_mode?1:0)),e.xray=t.render_above_all&&"OPAQUE"!=t.blend_mode&&"CLIP"!=t.blend_mode&&"ALPHA_ANTIALIASING"!=t.blend_mode,e.emit=t.emit,e.ambient=t.ambient,re(e,t),fe(e,"WETTABLE",t.is_wettable?1:0);var u=null,d=!1;i.traverse(T.graph,function(r,_){switch(_.type){case"UVMAP":case"TEX_COORD_UV":case"GEOMETRY_UV":case"UV_MERGED":var n=_.data.name,i=_.data.value;e.uv_maps_usage||(e.uv_maps_usage={}),e.uv_maps_usage[i]=n;break;case"GEOMETRY_VC":case"GEOMETRY_VC1":case"GEOMETRY_VC2":case"GEOMETRY_VC3":e.vertex_colors_usage[n=_.data.name]={generate_buffer:!0,src:[{name:_.data.value}]};var E=0;if("GEOMETRY_VC"==_.type)E=7;else for(var c=0;c<_.outputs.length;c++){var l="RGB".indexOf(_.outputs[c].identifier);l>-1&&(E|=1<<2-l)}e.vertex_colors_usage[n].src[0].mask=E;break;case"TEX_COORD_NO":case"TEX_COORD_RE":case"GEOMETRY_NO":case"FRESNEL":case"LAYER_WEIGHT":de(e,"a_tbn");break;case"TEX_COORD_OB":fe(e,"USE_MODEL_TSR_INVERSE",1);break;case"TEX_COORD_WI":fe(e,"USE_POSITION_CLIP",1);break;case"MATERIAL_BEGIN":_.data.value.use_tangent_shading&&(fe(e,"USE_TBN_SHADING",1),"PARTICLES"!=e.type&&de(e,"a_shade_tangs")),de(e,"a_tbn"),d=!0;break;case"BSDF_BEGIN":d=!0,de(e,"a_tbn");break;case"TEXTURE_COLOR":case"TEXTURE_ENVIRONMENT_CUBE":case"TEXTURE_ENVIRONMENT_EQUIRECTANGULAR":case"TEXTURE_ENVIRONMENT_MIRROR_BALL":Be(e,_.data.value,n=_.data.name,_.data.bpy_name);break;case"TEXTURE_NORMAL":case"B4W_PARALLAX":fe(e,"CALC_TBN_SPACE",1),de(e,"a_tbn"),_.data&&Be(e,_.data.value,n=_.data.name,_.data.bpy_name);break;case"NORMAL_MAP":switch(de(e,"a_tbn"),Number(_.dirs[0][1])){case s.NM_TANGENT:fe(e,"CALC_TBN_SPACE",1);break;case s.NM_OBJECT:case s.NM_BLENDER_OBJECT:fe(e,"USE_MODEL_TSR",1)}break;case"LAMP":_.data&&(e.lamp_uuid_indexes=_.data);break;case"B4W_REFRACTION":e.blend?e.refractive=!0:(e.refractive=!1,a.warn('Material "'+t.name+'" is not blend. Disabling refractions.')),fe(e,"USE_POSITION_CLIP",1);break;case"VALTORGB":case"CURVE_VEC":case"CURVE_RGB":u||(u=_.data.texture);break;case"PARTICLE_INFO":"PARTICLES"==e.type&&_.data&&(e.part_node_data=_.data);break;case"VECT_TRANSFORM":switch(Number(_.dirs[1][1])){case s.VT_WORLD_TO_OBJECT:fe(e,"USE_MODEL_TSR_INVERSE",1);break;case s.VT_WORLD_TO_CAMERA:fe(e,"USE_VIEW_TSR",1);break;case s.VT_OBJECT_TO_WORLD:fe(e,"USE_MODEL_TSR",1);break;case s.VT_OBJECT_TO_CAMERA:fe(e,"USE_MODEL_TSR",1),fe(e,"USE_VIEW_TSR",1);break;case s.VT_CAMERA_TO_WORLD:fe(e,"USE_VIEW_TSR_INVERSE",1);break;case s.VT_CAMERA_TO_OBJECT:fe(e,"USE_MODEL_TSR_INVERSE",1),fe(e,"USE_VIEW_TSR_INVERSE",1)}break;case"OBJECT_INFO":fe(e,"USE_MODEL_TSR",1),e.obj_info_params[1]=t.pass_index,e.obj_info_params[2]=Math.random();break;case"B4W_VECTOR_VIEW":case"GEOMETRY_VW":fe(e,"USE_VIEW_TSR",1);break;case"B4W_REFLECT":fe(e,"USE_VIEW_TSR_INVERSE",1);break;case"BUMP":case"DISPLACEMENT_BUMP":de(e,"a_tbn"),o.get_standard_derivatives()?fe(e,"USE_DERIVATIVES_EXT",1):a.warn('"OES_standard_derivatives" extension is not available. Disabling the BUMP node in the "'+t.name+'" material.');break;case"BSDF_TRANSPARENT":_.data.value.use_alpha?fe(e,"USE_BSDF_TRANSPARENT_ALPHA",1):(e.blend=!0,e.refractive=!0,fe(e,"USE_BSDF_TRANSPARENT_REFRACT",1));break;case"BSDF_GLOSSY":case"BSDF_DIFFUSE":case"BSDF_PRINCIPLED":fe(e,"USE_BSDF_SKY_DIM",1),o.get_texture_lod()&&fe(e,"USE_TEXTURE_LOD_EXT",1)}}),u&&Be(e,u,"u_nodes_texture"),d||(e.use_shadeless=!0);var f=e.shaders_info.node_elements=s.compose_node_elements(T.graph);oe(T.graph,e);for(var P=e.node_value_inds,A=e.node_rgb_inds,S=0;S<f.length;S++){var p=f[S];switch(p.id){case"VALUE":if(O=p.param_values[0])for(var m=0;m<P.length;m+=3)if(P[m]==O){p.dirs.push(["VALUE_ROW_IND",P[m+1]]),p.dirs.push(["VALUE_COL_IND",P[m+2]]);break}break;case"RGB":var O;if(O=p.param_values[0])for(m=0;m<A.length;m+=2)if(A[m]==O){p.dirs.push(["RGB_IND",A[m+1]]);break}}}return fe(e,"NUM_VALUES",e.node_values.length/4),fe(e,"NUM_RGBS",e.node_rgbs.length),!0}function oe(e,t,r){var _=[],n=[],a=[],o=[];!function(e,t,r,_,n,a){i.traverse(e,function(e,t){if("VALUE"==t.type){var o=ie("",t.name);r.push(t.outputs[0].default_value);var i=_.length/3,s=parseInt(i/4),E=parseInt(i%4);_.push(o,s,E)}else if("RGB"==t.type){o=ie("",t.name);var c=t.outputs[0].default_value.slice(0,3);n.push(c[0],c[1],c[2]),a.push(o,a.length/2)}});for(var o=r.length+4-r.length%4,s=r.length;s<o;s++)r.push(0)}(e,0,_,n,a,o),t.node_values=_,t.node_value_inds=n,t.node_rgbs=a,t.node_rgb_inds=o}function ie(e,t){return(e?e+"%join%":"")+t}function se(e,t){switch(e.type){case"SHADOW":ke(e,"shadow.glslv","shadow.glslf");break;case"COLOR_ID":ke(e,"color_id.glslv","color_id.glslf");break;default:ke(e,"main.glslv","main_stack.glslf")}return fe(e,"SHADELESS",1),de(e,"a_position"),de(e,"a_tbn"),ar(1,0,1,1,e.diffuse_color),t&&(fe(e,"ALPHA","OPAQUE"===t.blend_mode?0:1),fe(e,"ALPHA_CLIP","CLIP"===t.blend_mode?1:0),fe(e,"VERTEX_COLOR",0),e.offset_z=t.offset_z,ee(e,t),e.use_backface_culling=t.use_backface_culling),!0}function Ee(e,t){return!(t&&(t.is_lens_flares||t.do_not_render)||(ke(e,"debug_view.glslv","debug_view.glslf"),de(e,"a_position"),de(e,"a_tbn"),de(e,"a_polyindex"),e.depth_mask=!0,Re(0,0,0,e.wireframe_edge_color),0))}function ce(e,t){if(e.data_id=t.data_id,"PHYSICS"!==e.type){switch("DYNAMIC"==t.type||"COLOR_ID"==e.type?(fe(e,"AU_QUALIFIER",t.is_hair_particles?"GLSL_IN":"uniform"),fe(e,"STATIC_BATCH",0)):(fe(e,"AU_QUALIFIER","GLSL_IN"),fe(e,"STATIC_BATCH",1)),"DEBUG_VIEW"==e.type&&(o.get_standard_derivatives()?fe(e,"WIREFRAME_QUALITY",1):fe(e,"WIREFRAME_QUALITY",0),e.debug_sphere?(fe(e,"DEBUG_SPHERE",1),fe(e,"DEBUG_SPHERE_DYNAMIC",e.debug_sphere_dynamic?1:0)):fe(e,"DEBUG_SPHERE",0),fe(e,"ALPHA",1)),t.use_shape_keys&&"PARTICLES"!=e.type&&!t.is_hair_particles&&(e.use_shape_keys=t.use_shape_keys),t.wind_bending?(""!==t.main_bend_col?(e.vertex_colors_usage.a_bending_col_main={generate_buffer:!0,src:[{name:t.main_bend_col,mask:4}]},de(e,"a_bending_col_main"),""!==t.detail_bend_col.leaves_stiffness&&""!==t.detail_bend_col.leaves_phase&&""!==t.detail_bend_col.overall_stiffness?(e.vertex_colors_usage.a_bending_col_detail={generate_buffer:!0,src:[{name:t.detail_bend_col.leaves_stiffness,mask:4},{name:t.detail_bend_col.leaves_phase,mask:2},{name:t.detail_bend_col.overall_stiffness,mask:1}]},de(e,"a_bending_col_detail"),de(e,"a_tbn"),fe(e,"DETAIL_BEND",1)):fe(e,"DETAIL_BEND",0),fe(e,"MAIN_BEND_COL",1)):fe(e,"MAIN_BEND_COL",0),fe(e,"BEND_CENTER_ONLY",t.bend_center_only?1:0),fe(e,"WIND_BEND",1)):fe(e,"WIND_BEND",0),fe(e,"BILLBOARD_PRES_GLOB_ORIENTATION",0|t.billboard_pres_glob_orientation),fe(e,"BILLBOARD",t.billboard?1:0),fe(e,"HAIR_BILLBOARD",t.billboard&&t.is_hair_particles?1:0),fe(e,"BILLBOARD_SPHERICAL",t.billboard_spherical?1:0),t.billboard_type){case"RANDOM":fe(e,"BILLBOARD_RANDOM",1),fe(e,"BILLBOARD_JITTERED",0);break;case"JITTERED":fe(e,"BILLBOARD_RANDOM",0),fe(e,"BILLBOARD_JITTERED",1);break;default:fe(e,"BILLBOARD_RANDOM",0),fe(e,"BILLBOARD_JITTERED",0)}fe(e,"DYNAMIC_GRASS",t.dynamic_grass&&m.allow_vertex_textures?1:0),e.dynamic_grass=t.dynamic_grass,"PARTICLES"!=e.type&&(e.dynamic_geometry=t.dynamic_geometry),e.shadow_cast=t.shadow_cast,e.shadow_cast_only=t.shadow_cast_only,e.shadow_receive=t.shadow_receive&&!e.use_shadeless&&!(e.blend&&m.disable_blend_shadows_hack),m.rgba_fallback_shadows?("MAIN"==e.type&&e.shadow_receive||"SHADOW"==e.type)&&fe(e,"RGBA_SHADOWS",1):fe(e,"RGBA_SHADOWS",0),e.reflexible=t.reflexible,e.reflexible_only=t.reflexible_only,e.reflective=t.reflective,e.obj_info_params[0]=t.pass_index,e.lod_dist_max=t.lod_dist_max,e.lod_dist_min=t.lod_dist_min,e.lod_lower_border_range=t.lod_lower_border_range,e.lod_upper_border_range=t.lod_upper_border_range,e.cube_reflection_id=t.cube_reflection_id,e.plane_reflection_id=t.plane_reflection_id,t.is_skinning?(de(e,"a_influence"),fe(e,"SKINNED",1),m.skinning_hack?(fe(e,"DISABLE_TANGENT_SKINNING",1),fe(e,"FRAMES_BLENDING",0)):(fe(e,"DISABLE_TANGENT_SKINNING",0),fe(e,"FRAMES_BLENDING",t.frames_blending?1:0)),fe(e,"MAX_BONES",t.max_bones)):(fe(e,"SKINNED",0),fe(e,"FRAMES_BLENDING",0),fe(e,"DISABLE_TANGENT_SKINNING",0)),t.vertex_anim?(fe(e,"VERTEX_ANIM",1),fe(e,"VERTEX_ANIM_MIX_NORMALS_FACTOR",m.vert_anim_mix_normals_hack?.5:"u_va_frame_factor")):fe(e,"VERTEX_ANIM",0),t.is_skinning&&t.vertex_anim&&r.panic("Skinning and vertex animation are mutually exlusive")}}function le(e,t,r){if(t.length){for(var _=E.get_shadow_lamps(t,m.ssao&&r.b4w_enable_ssao),n=e.shaders_info,a=e.lamp_uuid_indexes,o=0,i=0;i<e.shaders_info.node_elements.length;i++){var s=e.shaders_info.node_elements[i];if("LIGHTING_LAMP"==s.id){var c=(p=t[o++%t.length]).light,l=E.get_scene_data(p,r);if("SPOT"==c.type||"POINT"==c.type)var T=Math.cos(c.spot_size/2);if("SPOT"==c.type)var u=c.spot_blend*(1-T);var d=l.light_index,P=_.indexOf(p);s.dirs=[["LAMP_TYPE",c.type],["LAMP_IND",d],["LAMP_SPOT_SIZE",f.glsl_value(T||.01)],["LAMP_SPOT_BLEND",f.glsl_value(u||.01)],["LAMP_LIGHT_DIST",f.glsl_value(c.distance)],["LAMP_USE_SPHERE",c.use_sphere?1:0],["LAMP_SHADOW_MAP_IND",P]]}else if("LAMP"==s.id&&a)for(var A=s.dirs[0][1],S=0;S<t.length;S++){var p;a[(p=t[S]).uuid]==A&&("SPOT"!=(c=p.light).type&&"POINT"!=c.type||(T=Math.cos(c.spot_size/2)),"SPOT"==c.type&&(u=c.spot_blend*(1-T)),s.dirs.push(["LAMP_TYPE",c.type],["LAMP_SPOT_SIZE",f.glsl_value(T||.01)],["LAMP_SPOT_BLEND",f.glsl_value(u||.01)],["LAMP_LIGHT_DIST",f.glsl_value(c.distance)],["LAMP_USE_SPHERE",c.use_sphere?1:0]))}}if(a){var O=0;for(var v in a)O++;for(e.lamp_light_positions=new Float32Array(3*O),e.lamp_light_directions=new Float32Array(3*O),e.lamp_light_color_intensities=new Float32Array(3*O),f.set_directive(n,"NUM_LAMP_LIGHTS",O),i=0;i<t.length;i++)Te(e,t[i])}}}function Te(e,t){if(t.uuid in e.lamp_uuid_indexes){var r=e.lamp_uuid_indexes[t.uuid],_=Fa(t.render.world_tsr);e.lamp_light_positions.set(_,3*r),e.lamp_light_directions.set(t.light.direction,3*r),e.lamp_light_color_intensities.set(t.light.color_intensity,3*r)}}function ue(e,t){for(var r=0;r<t.length;r++){var _=t[r].settings.b4w_vcol_from_name;""!==_&&""!==t[r].settings.b4w_vcol_to_name&&(e.vertex_colors_usage[_]={generate_buffer:!1,src:[{name:_,mask:7}]})}}function de(e,t){var r=e.common_attributes;-1==r.indexOf(t)&&r.push(t),e.common_attributes=r.sort()}function fe(e,t,r){f.set_directive(e.shaders_info,t,r)}function Pe(e,t,r){if("PHYSICS"!=e.type){var _=e.draw_mode;e.halo&&"PARTICLES"!=e.type&&(t=S.extract_halo_submesh(t)),e.water_generated_mesh&&(t=l.generate_cascaded_grid(e.water_num_cascads,e.water_subdivs,e.water_detailed_dist));var n=S.submesh_to_bufs_data(t,_,e.vertex_colors_usage);e.bufs_data=n,R||e.dynamic_geometry||e.z_sort||e.use_shape_keys||(n.ibo_array=null,n.vbo_source_data.length=0);var a=t.va_frames.length;e.num_vertices=t.base_length*a,e.num_triangles=function(e){switch(e.draw_mode){case S.DM_DEFAULT:case S.DM_TRIANGLES:case S.DM_DYNAMIC_TRIANGLES:return!0;default:return!1}}(e)?S.is_indexed(t)?t.indices.length/3*a:t.base_length/3*a:0,g&&(e.submesh=t)}else"NAVMESH"==e.subtype?e.bufs_data=S.submesh_to_bufs_data(t,S.DM_DEFAULT,[]):(t.shape_keys.length>0&&S.submesh_init_shape_keys(t,t.va_frames[0],r),e.submesh=t)}function Ae(e,t,_){var n=t.settings;switch(n.b4w_billboard_align){case"VIEW":fe(e,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_VIEW");break;case"XY":fe(e,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_XY");break;case"YZ":fe(e,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_YZ");break;case"ZX":fe(e,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_ZX");break;default:r.panic("Wrong billboard align value")}fe(e,"BILLBOARD",0);var a=n.b4w_enable_soft_particles&&E.check_obj_soft_particles_accessibility(_,n);fe(e,"SOFT_PARTICLES",n.b4w_particles_softness>0&&a&&m.depth_tex_available?1:0),fe(e,"SOFT_STRENGTH",f.glsl_value(n.b4w_particles_softness)),f.set_directive(e.shaders_info,"WORLD_SPACE","WORLD"==n.b4w_coordinate_system?1:0)}function Se(e,t,_,n,a,o,i,s,c,l,T,u,d){var f=e._object,P=[],A=s.b4w_dynamic_grass;if(!l&&A)return P;for(var p="INSTANCE"==s.b4w_wind_bend_inheritance,O="INSTANCE"==s.b4w_shadow_inheritance,v="INSTANCE"==s.b4w_reflection_inheritance,N=[],g=[],h=0;h<a.length;h++){var R=a[h]._object.render;(V=E.clone_render(t)).billboard=s.b4w_hair_billboard,V.billboard_type=s.b4w_hair_billboard_type,V.billboard_spherical="SPHERICAL"==s.b4w_hair_billboard_geometry,V.dynamic_grass=A,V.is_hair_particles=!0,p?(V.wind_bending=R.wind_bending,V.wind_bending_angle=R.wind_bending_angle,V.wind_bending_freq=R.wind_bending_freq,V.detail_bending_freq=R.detail_bending_freq,V.main_bend_col=R.main_bend_col,V.detail_bending_amp=R.detail_bending_amp,V.branch_bending_amp=R.branch_bending_amp,V.wind_bending_amp=R.wind_bending_amp,V.detail_bend_col=R.detail_bend_col,V.bend_center_only=!1):(V.wind_bending=f.render.wind_bending,V.wind_bending_angle=f.render.wind_bending_angle,V.wind_bending_freq=f.render.wind_bending_freq,V.detail_bending_freq=f.render.detail_bending_freq,V.main_bend_col=f.render.main_bend_col,V.detail_bending_amp=f.render.detail_bending_amp,V.branch_bending_amp=f.render.branch_bending_amp,V.wind_bending_amp=f.render.wind_bending_amp,V.detail_bend_col=f.render.detail_bend_col,V.bend_center_only=!0),O?(V.shadow_cast=R.shadow_cast,V.shadow_cast_only=R.shadow_cast_only,V.shadow_receive=R.shadow_receive):(V.shadow_cast=f.render.shadow_cast,V.shadow_cast_only=f.render.shadow_cast_only,V.shadow_receive=f.render.shadow_receive),v?(V.reflexible=R.reflexible,V.reflexible_only=R.reflexible_only,V.reflective=R.reflective,V.cube_reflection_id=R.cube_reflection_id,V.plane_reflection_id=R.plane_reflection_id,V.reflection_type=R.reflection_type):(V.reflexible=f.render.reflexible,V.reflexible_only=f.render.reflexible_only,V.reflective=f.render.reflective,V.cube_reflection_id=f.render.cube_reflection_id,V.plane_reflection_id=f.render.plane_reflection_id,V.reflection_type=f.render.reflection_type),N.push(V);var I=i[h];I||(I=new Float32Array),u&&tn(c.seed,T);var x=new Float32Array(3),y=new Float32Array([0,0,0,1]),w=[],U=-1!=sa(m.loaded_data_version,k)&&!s.b4w_initial_rand_rotation&&!s.b4w_hair_billboard,C=4;U&&(C=8);for(var D=0;D<I.length;D+=C){x[0]=I[D],x[1]=I[D+1],x[2]=I[D+2];var F=I[D+3]*ka(R.world_tsr);if(s.b4w_initial_rand_rotation){switch(s.b4w_rotation_type){case"XYZ":Ke(G=new Float32Array([en(T),en(T),en(T)]),G);break;case"Z":var G=new Float32Array([0,0,1]);break;default:r.panic("Unsupported random rotation type: "+s.b4w_rotation_type)}Dr(G,s.b4w_rand_rotation_strength*(2*Math.PI*en(T)-Math.PI),y)}else U&&(y.set(I.subarray(D+4,D+8)),ta(y,y),!s.use_whole_group)&&Fr(y,s.use_rotation_dupli?Ba(R.world_tsr):b,y);var B=ya(x,F,y,ba());w.push(B)}g.push(w)}var X={},H=0;for(h=0;h<a.length;h++){var Q=a[h]._object.materials;for(D=0;D<Q.length;D++)Q[D].name in X?X[Q[D].name]++:(X[Q[D].name]=1,H++)}H=H||1;var z={};for(h=0;h<a.length;h++){var V,j=a[h],q=o[h],J={};if((V=N[h]).wind_bending&&(J.au_wind_bending_amp=[V.wind_bending_amp],J.au_wind_bending_freq=[V.wind_bending_freq],J.au_detail_bending_freq=[V.detail_bending_freq],J.au_detail_bending_amp=[V.detail_bending_amp],J.au_branch_bending_amp=[V.branch_bending_amp],V.wind_bending_amp=0,V.wind_bending_freq=0,V.detail_bending_freq=0,V.detail_bending_amp=0,V.branch_bending_amp=0),(w=g[h]).length){var Z=j.data,$=(Q=j._object.materials,new Array(Q.length)),ee=new Array(Q.length);for(D=0;D<Q.length;D++)if(!ze(f,D)&&!S.has_empty_submesh(Z,D))for(var te=0;te<q.length;te++){var re=q[te],_e=K(re),ne=Q[D];if("MAIN"==re?$[D]=_e:"DEBUG_VIEW"==re&&(ee[D]=_e),_e.cluster_id=e.b4w_cluster_data.cluster_id,pe(_e,ne)&&(_e.lights=ln(d),W(_e,ne,Z))){"SHADOW"==re&&$[D]&&(_e.use_shadeless=$[D].use_shadeless),_e.draw_mode=S.DM_DEFAULT,ce(_e,V),_e.odd_id_prop=Qe(_e,V,s.uuid),_e.do_not_cull=e.b4w_do_not_cull||s.b4w_dynamic_grass,"MAIN"==_e.type&&(_e.caustics=e.b4w_caustics),fe(_e,"DISABLE_FOG",0|("COLOR_ID"!=re&&"SHADOW"!=re&&e.b4w_disable_fogging)),"JITTERED"==s.b4w_hair_billboard_type&&(_e.jitter_amp=s.b4w_hair_billboard_jitter_amp,_e.jitter_freq=s.b4w_hair_billboard_jitter_freq),A&&(_e.grass_scale_threshold=s.b4w_dynamic_grass_scale_threshold),p||(delete _e.vertex_colors_usage.a_bending_col_main,delete _e.vertex_colors_usage.a_bending_col_detail);var ae=S.extract_submesh(Z,D,_e.common_attributes,t.bone_skinning_info,_e.vertex_colors_usage,_e.uv_maps_usage),oe=f.render.world_tsr,ie=!0;if(X[ne.name]>1){var se=0;for(var Ee in ae.va_frames)se++;ie=ae.indices.length*w.length*se*X[ne.name]>Y*H}var le=m.allow_instanced_arrays_ext&&ie&&"PHYSICS"!=_e.type;if(le){_e.inst_array_state=s.use_whole_group?M:L;var Te=S.clone_submesh(ae);if(S.calc_unit_boundings(ae,Te,w),Te.instanced_array_data={tsr_array:w,stat_part_em_tsr:oe,static_hair:"STATIC"==t.type,submesh_params:J,part_inh_attrs:{},dyn_grass:A},V.wind_bending&&V.bend_center_only){var ue=ge(0,0,0);ja(ue,f.render.world_tsr,ue);for(var de=[],Pe=0;Pe<w.length;Pe++)de.push(ue[0],ue[1],ue[2]);Te.instanced_array_data.part_inh_attrs.a_emitter_center={num_comp:3,data:de}}S.calc_unit_boundings(ae,ae,w),"STATIC"==t.type&&S.bounding_data_apply_transform(Te.submesh_bd,oe)}else Te=Oe(Te=S.make_propagated_submesh(ae,J,w),w),V.wind_bending&&V.bend_center_only&&(Te=Ye(Te,f.render.world_tsr));var Ae=me(s.b4w_vcol_from_name,s.b4w_vcol_to_name,_e,_,!p,Z);fe(_e,"USE_INSTANCED_PARTCLS",(Te=Le(Te,w,f.render.bb_local,n,Ae,_e.vertex_colors_usage,z,le)).instanced_array_data?1:0),Ue(_e),P.push({batch:_e,obj_render:t,batch_render:V,submesh:Te,mat_names:[ne.name],rel_bpy_objects:[e]})}}for(D=0;D<ee.length;D++)ee[D]&&(ee[D].debug_main_batch_id=$[D].id,Ue(ee[D]))}}return P}function pe(e,t){var r=!0;return"NODES_GLOW"==e.type&&(r=s.check_material_glow_output(t)),r}function me(e,t,r,_,n,a){var o=[];if(""!==e&&""!==t){var i=function(e,t){var r=[];for(var _ in t)for(var n=t[_].src,a=0,o=0;o<n.length;o++){var i=n[o].mask;e==n[o].name&&r.push(_,i,a),a+=Xn(i)}return r}(t,r.vertex_colors_usage);if(i.length>0)for(var s=0;s<i.length;s+=3)o.push({emitter_attr:e,emitter_mask:7,particle_attr:i[s],particle_mask:i[s+1],dst_channel_offset:i[s+2]});else S.has_attr(r.common_attributes,"a_color")&&t==a.active_vcol_name&&o.push({emitter_attr:e,emitter_mask:7,particle_attr:"a_color",particle_mask:7,dst_channel_offset:0})}return n&&("a_bending_col_main"in _&&o.push({emitter_attr:"a_bending_col_main",emitter_mask:4,particle_attr:"a_bending_col_main",particle_mask:4,dst_channel_offset:0}),"a_bending_col_detail"in _&&o.push({emitter_attr:"a_bending_col_detail",emitter_mask:7,particle_attr:"a_bending_col_detail",particle_mask:7,dst_channel_offset:0})),o}function Oe(e,t){e.va_common.au_center_pos=new Float32Array(3*e.base_length);for(var r=t.length,_=e.base_length/r,n=0;n<r;n++)for(var a=t[n],o=3*_*n,i=0;i<_;i++)e.va_common.au_center_pos[o+3*i]=a[0],e.va_common.au_center_pos[o+3*i+1]=a[1],e.va_common.au_center_pos[o+3*i+2]=a[2];return e}function Ye(e,t){e.va_common.a_emitter_center=new Float32Array(3*e.base_length);var r=ge(0,0,0);ja(r,t,r);for(var _=0;_<e.base_length;_++)e.va_common.a_emitter_center[3*_]=r[0],e.va_common.a_emitter_center[3*_+1]=r[1],e.va_common.a_emitter_center[3*_+2]=r[2];return e}function Le(e,t,r,_,n,o,i,s){for(var E=!1,c=0;c<n.length;c++)if((p=_.va_common[d=n[c].emitter_attr])&&p.length>0){E=!0;break}if(s)var l=e.instanced_array_data.part_inh_attrs;if(E){var T=function(e,t,r,_){var n=new Float32Array(3),a=new Float32Array(3),o=new Uint32Array(r.length);"verts_indices"in _||function(e,t,r){e.cell_size=new Float32Array(3),e.base_point=new Float32Array(3),e.verts_indices=new Uint32Array(r.length/3),e.octs_indices=new Uint32Array(r.length/3),e.cell_size[0]=(t.max_x-t.min_x)/I,e.cell_size[1]=(t.max_y-t.min_y)/I,e.cell_size[2]=(t.max_z-t.min_z)/I,e.base_point[0]=t.min_x,e.base_point[1]=t.min_y,e.base_point[2]=t.min_z;for(var _=0;_<r.length/3;_++){var n=r[3*_+1],a=r[3*_+2],o=Rn((r[3*_]-e.base_point[0])/e.cell_size[0]),i=Rn((n-e.base_point[1])/e.cell_size[1]),s=Rn((a-e.base_point[2])/e.cell_size[2]);o=Un(o,0,I-1),i=Un(i,0,I-1),s=Un(s,0,I-1),e.verts_indices[_]=_,e.octs_indices[_]=s*Math.pow(I,2)+i*I+o}for(S.sort_two_arrays(e.octs_indices,e.verts_indices,S.SORT_NUMERIC,!0),e.verts_offsets=new Uint32Array(Math.pow(I,3)),_=0;_<e.octs_indices.length;_++)e.verts_offsets[e.octs_indices[_]]++;for(delete e.octs_indices,_=1;_<e.verts_offsets.length;_++)e.verts_offsets[_]+=e.verts_offsets[_-1]}(_,e,t);for(var i=0;i<r.length;i++){n[0]=r[i][0],n[1]=r[i][1],n[2]=r[i][2];var s=1e10,E=-1,c=Rn((n[0]-_.base_point[0])/_.cell_size[0]),l=Rn((n[1]-_.base_point[1])/_.cell_size[1]),T=Rn((n[2]-_.base_point[2])/_.cell_size[2]);c=Un(c,0,I-1),l=Un(l,0,I-1);for(var u=(T=Un(T,0,I-1))*Math.pow(I,2)+l*I+c,d=_.verts_offsets[u],f=0==u?0:_.verts_offsets[u-1];f<d;f++){var P=_.verts_indices[f];a[0]=t[3*P],a[1]=t[3*P+1],a[2]=t[3*P+2],be(a,n,a),(A=Fe(a))<=s&&(s=A,E=P)}if(-1==E)for(f=0;f<t.length/3;f++){var A;a[0]=t[3*f],a[1]=t[3*f+1],a[2]=t[3*f+2],be(a,n,a),(A=Fe(a))<=s&&(s=A,E=f)}o[i]=E}return o}(r,_.va_frames[0].a_position,t,i),u=e.base_length/t.length;for(c=0;c<n.length;c++){var d,f=n[c].particle_attr,P=n[c].particle_mask,A=n[c].emitter_mask,p=_.va_common[d=n[c].emitter_attr];switch(f){case"a_bending_col_main":var m=1;break;case"a_bending_col_detail":case"a_color":m=3;break;default:m=0;for(var O=0;O<o[f].src.length;O++)m+=Xn(o[f].src[O].mask)}if(p&&p.length>0){var v=Xn(A),N=Xn(P),g=A&P,h=Hn(g);if(g!=P&&a.error("Wrong color extraction from "+d+" to "+f+"."),s)for(l[f]={num_comp:m,data:[]},O=0;O<t.length;O++)for(b=(R=T[O])*v,x=0;x<h.length;x++)h[x]&&(y=Qn(A,x),l[f].data.push(p[b+y]));else for("a_bending_col_main"!=f&&"a_bending_col_detail"!=f||(e.va_common[f]=new Float32Array(e.base_length*N)),O=0;O<t.length;O++){var R,b=(R=T[O])*v,Y=O*u*m;if(-1!=R)for(var L=0;L<u;L++)for(var M=L*m,x=0;x<h.length;x++)if(h[x]){var y=Qn(A,x),w=n[c].dst_channel_offset+Qn(P,x);e.va_common[f][Y+M+w]=p[b+y]}}}else e.va_common[f]=new Float32Array(0)}}return e}function Me(e,t,r,_,n){for(var a=t.length,o={},i=0;i<e.length;i+=n)o[s=Math.floor(a*en(r))]=o[s]||[],o[s].push(e[i],e[i+1],e[i+2],e[i+3]),_&&o[s].push(e[i+4],e[i+5],e[i+6],e[i+7]);for(var s in o)o[s]=new Float32Array(o[s]);return o}function xe(e,t,r,_){for(var n,a,o,i,s,E,c,l,T,u,d,f,P,A,S,p,m={},O=new Float32Array([0,0,0,1]),v=0;v<e.length;v+=_)for(var N=0;N<t.length;N++){var g=ve(),h=ka(t[N].render.world_tsr);ye(Fa(t[N].render.world_tsr),h,g);var R=Ne([e[v],e[v+1],e[v+2]]);m[N]||(m[N]=new Float32Array(e.length)),r&&(m[N][v+4]=O[0]=e[v+4],m[N][v+5]=O[1]=e[v+5],m[N][v+6]=O[2]=e[v+6],m[N][v+7]=O[3]=e[v+7],ta(O,O),d=void 0,f=void 0,P=void 0,A=void 0,S=void 0,p=void 0,A=(l=(a=O)[1])*(P=(c=a[0])*(s=(n=g)[1])-l*(i=n[0]))-(T=a[2])*(f=T*i-c*(E=n[2])),S=T*(d=l*E-T*s)-c*P,p=c*f-l*d,f*=2*(u=a[3]),P*=2*u,S*=2,p*=2,(o=g)[0]=i+(d*=2*u)+(A*=2),o[1]=s+f+S,o[2]=E+P+p),Ie(R,g,R),m[N][v]=R[0],m[N][v+1]=R[1],m[N][v+2]=R[2],m[N][v+3]=e[v+3]}return m}function we(e,t,r,_,n,o){var i={};function s(e){for(var t=[0],r=0;r<e.length;r++)t[r+1]=t[r]+e[r].count;var n=t[t.length-1]*en(_),a=0;for(r=0;r<t.length;r++)if(n>=t[r]&&n<t[r+1]){a=r;break}return a}for(var E=[],c=0;c<t.length;c++)for(var l=t[c],T=l.origin_name||l.name,u=0;u<r.length;u++){var d=r[u];T==d.name&&E.push(d)}for(r.length!=E.length&&a.error("dupli weights match failed"),c=0;c<e.length;c+=o)i[f=s(E)]=i[f]||[],i[f].push(e[c],e[c+1],e[c+2],e[c+3]),n&&i[f].push(e[c+4],e[c+5],e[c+6],e[c+7]);for(var f in i)i[f]=new Float32Array(i[f]);return i}function Ue(e){Ce(e,function(e){e.id=0,e.id=n.calc_variable_id(e,0)})}function Ce(e,t){for(var r=null,_=null,n=[],a=0;a<e.textures.length;a++){var o=e.textures[a],i=o.canvas_context;i&&(r||(r={}),r[a]=i,o.canvas_context=null);var s=o.video_file;s&&(_||(_={}),_[a]=s,o.video_file=null),n.push(o.num_users),o.num_users=0}var E=e.bounds_local;e.bounds_local=null;var c=e.vaos;e.vaos=null;var l=e.bufs_data;e.bufs_data=null;var T=e.submesh;if(e.submesh=null,t(e),e.bufs_data=l,e.submesh=T,e.vaos=c,e.bounds_local=E,r)for(var a in r)e.textures[a].canvas_context=r[a];if(_)for(var a in _)e.textures[a].video_file=_[a];for(a=0;a<e.textures.length;a++)e.textures[a].num_users=n[a]}function Ge(e,t,r,_){var n=K("DEBUG_VIEW");if(ke(n,"debug_view.glslv","debug_view.glslf"),n.debug_sphere=!0,n.depth_mask=!0,n.odd_id_prop=Qe(n,e,t),n.debug_sphere_dynamic=r,ce(n,e),Ue(n),_.use_be){var a=_.bounds_local.be,o=ve(),i=l.generate_uv_sphere(16,8,1,o,!1,!1),s=ge(De(a.axis_x),De(a.axis_y),De(a.axis_z));S.scale_submesh_xyz(i,s,o);var E=Ke(a.axis_x,x),c=Ke(a.axis_y,y),T=Ke(a.axis_z,w);!s[0]&&s[1]&&s[2]?Xe(c,T,E):!s[1]&&s[0]&&s[2]?Xe(T,E,c):!s[2]&&s[0]&&s[1]&&Xe(E,c,T);var u=function(e,t,r,_){return _[0]=e[0],_[1]=t[0],_[2]=r[0],_[3]=e[1],_[4]=t[1],_[5]=r[1],_[6]=e[2],_[7]=t[2],_[8]=r[2],_}(E,c,T,D);h(u,u),Da(qr(u,U),C),Ua(1,C),wa(a.center,C),S.submesh_apply_transform(i,C)}else{var d=_.bounds_local.bs;i=l.generate_uv_sphere(16,8,d.radius,d.center,!1,!1)}return Ao(_.bounds_local,n.bounds_local),S.submesh_drop_indices(i,1,!0),i.va_common.a_polyindex=S.extract_polyindices(i),Pe(n,i),n}function ke(e,t,r){e.shaders_info.vert=t,e.shaders_info.frag=r,f.set_default_directives(e.shaders_info)}function Be(e,t,r,_){_=_||"",-1==e.texture_names.indexOf(r)&&(e.textures.push(t),e.texture_names.push(r),e.bpy_tex_names.push(_)),e.shader&&T.assign_texture_uniforms(e)}function He(e){return e.shaders_info||r.panic("No shaders info for batch "+e.name),e.shader=f.get_compiled_shader(e.shaders_info),function(e){var t=e.shaders_info;if(t.status===f.VALID){var _=e.shader.attributes,n=e.bufs_data.pointers;for(var o in _)n[o]||r.panic('missing data for "'+o+'" attribute')}t.status&f.INVALID_TEX_IMAGE_UNITS&&a.error("Texture limit exceeded for shader - "+t.frag+', materials: "'+e.material_names.join(", ")+'". Maximum texture count: '+O.max_texture_image_units+", actual texture count: "+t.texture_count),t.status&f.INVALID_F_UNIFORM_VECTORS&&a.error("Fragment uniform limit exceeded for shader - "+t.frag+', materials: "'+e.material_names.join(", ")+'". '),t.status&f.INVALID_V_UNIFORM_VECTORS&&a.error("Vertex uniform limit exceeded for shader - "+t.vert+', materials: "'+e.material_names.join(", ")+'". '),t.status&f.INVALID_VERTEX_ATTRIBS&&a.error("Vertex attribute limit exceeded for shader - "+t.vert+', materials: "'+e.material_names.join(", ")+'". Maximum attribute count: '+O.max_vertex_attribs+", actual attribute count: "+t.attribute_count),t.status&f.INVALID_VARYING_VECTORS&&function(e){if("MAIN"!=e.type||e.has_nodes||a.error("Varying limit exceeded for shader - "+e.shaders_info.frag+', materials: "'+e.material_names.join(", ")+'"'),"MAIN"==e.type&&e.has_nodes||"NODES_GLOW"==e.type){var t=0,r=0;e.uv_maps_usage&&(t=Vn(e.uv_maps_usage)),e.vertex_colors_usage&&(r=Vn(e.vertex_colors_usage)),a.error("Varying limit exceeded for node shader - "+e.shaders_info.frag+", uv: "+t+", vc: "+r+', materials: "'+e.material_names.join(", ")+'"')}}(e),t.status&f.COMPILATION_ERROR&&a.error("Shader compilation/linking error: "+t.vert+", "+t.frag+', materials: "'+e.material_names.join(", ")+'"')}(e),e.shaders_info.status===f.VALID&&(T.assign_uniform_setters(e.shader),T.assign_attribute_setters(e),T.assign_texture_uniforms(e),!0)}function Qe(e,t,r){var _=r;return"NAVMESH"==e.subtype?_:t.dynamic_geometry?"_odd_id_"+n.unique_id():_}function ze(e,t){return t>=0&&t<e.mat_inheritance_data.is_disabled.length&&e.mat_inheritance_data.is_disabled[t]}t.batch_get_debug_storage=function(e){return F[e]||null},t.batch_set_debug_storage=function(e,t){F[e]=t},t.clone_batch=B,t.generate_main_batches=function(e,t,r,_){var a=(r||[]).map(function(e){return e.light}),o=function(e,t,r){for(var _=[],n=0;n<e.length;n++){var a=e[n],o=a._object;o.is_hair_dupli||_.push.apply(_,Q(a,o.render,t,r))}return _}(t,e._render.graph,a);o=function(e){for(var t=[],r=[],_={},a=0;a<e.length;a++){var o=null;if((T=e[a].batch).id in _){var i=_[T.id],s=r[i].batch;if(Ce(T,function(e){Ce(s,function(t){Zn(e,t)&&e.inst_array_state!=L&&(o=r[i])})}),!o)do{T.id++}while(_[T.id])}if(!!o||(o={batch:T,obj_renders_ordered:[],batch_renders_ordered:[],submeshes_ordered:[],rel_bpy_objects:[],rel_bpy_objects_uuids:[],mat_names:[]},_[T.id]=r.length,r.push(o)),e[a].submesh&&e[a].submesh.base_length){o.obj_renders_ordered.push(e[a].obj_render),o.batch_renders_ordered.push(e[a].batch_render),o.submeshes_ordered.push(e[a].submesh);for(var E=0;E<e[a].rel_bpy_objects.length;E++){var c=e[a].rel_bpy_objects[E];-1==o.rel_bpy_objects_uuids.indexOf(c.uuid)&&(o.rel_bpy_objects.push(c),o.rel_bpy_objects_uuids.push(c.uuid))}for(E=0;E<e[a].mat_names.length;E++){var l=e[a].mat_names[E];-1==o.mat_names.indexOf(l)&&o.mat_names.push(l)}}o.mat_names.sort()}for(a=0;a<r.length;a++){var T,u=r[a].obj_renders_ordered,d=r[a].batch_renders_ordered,f=r[a].submeshes_ordered,P=j(d,T=r[a].batch);if("STATIC"==P.type&&"COLOR_ID"!=T.type)for(E=0;E<u.length;E++){var A=u[E],p=d[E],m=f[E],O=xa(C);if(A.billboard&&!A.billboard_pres_glob_orientation?Ca(Ka(A.world_tsr,U),O):Ma(A.world_tsr,O),p.is_hair_particles?m.instanced_array_data||(p.billboard?S.submesh_apply_particle_transform(m,O):S.submesh_apply_transform(m,O)):S.submesh_apply_transform(m,O),p.is_hair_particles)fe(T,"AU_QUALIFIER","GLSL_IN");else if(r[a].rel_bpy_objects.length>1){var v={};(p.wind_bending||p.billboard)&&(v.au_center_pos=[O[0],O[1],O[2]]),p.wind_bending&&(v.au_wind_bending_amp=[p.wind_bending_amp],v.au_wind_bending_freq=[p.wind_bending_freq],v.au_detail_bending_amp=[p.detail_bending_amp],v.au_detail_bending_freq=[p.detail_bending_freq],v.au_branch_bending_amp=[p.branch_bending_amp]),S.submesh_apply_params(m,v),fe(T,"AU_QUALIFIER","GLSL_IN")}else P.center_pos.set(O.subarray(0,3)),fe(T,"AU_QUALIFIER","uniform")}if(0==f.length)m=S.init_submesh(n.unique_name("%empty"));else if(1==f.length)m=f[0];else{var N=[];for(E=0;E<f.length;E++)S.is_long_submesh(f[E])||N.push(E);if(N.length<f.length)for(E=0;E<N.length;E++)S.submesh_drop_indices(f[N[E]]);m=S.submesh_list_join(f)}if("STATIC"==P.type){if("COLOR_ID"!=T.type){var g=[];for(E=0;E<r[a].rel_bpy_objects.length;E++)Uo(r[a].rel_bpy_objects[E]._object.render.bbr_world,g);vo(g,0,g.length,P.bb_world),So(P.bb_world,P.bb_local),P.be_world=Co(j_(g),!0),xo(P.be_world,P.be_local),P.bs_world=Do(P.be_world),Lo(P.bs_world,P.bs_local)}if(P.is_lod){var h=r[a].rel_bpy_objects[0].b4w_cluster_data;P.lod_center.set(h.cluster_center?h.cluster_center:P.bs_world.center)}}if("PARTICLES"!=T.type){var R=m.submesh_bd;P.billboard?(So(P.bb_local,T.bounds_local.bb),xo(P.be_local,T.bounds_local.be),Lo(P.bs_local,T.bounds_local.bs),T.use_be=!1):(So(R.bb_local,T.bounds_local.bb),xo(R.be_local,T.bounds_local.be),Lo(P.bs_local.radius<R.bs_local.radius?"STATIC"==P.type&&"COLOR_ID"!=T.type?P.bs_world:P.bs_local:R.bs_local,T.bounds_local.bs),T.use_be=Fo(T.bounds_local.be,T.bounds_local.bs))}t.push({batch:T,render:P,submesh:m,mat_names:r[a].mat_names,rel_bpy_objects:r[a].rel_bpy_objects})}return t}(o);for(var i=0;i<o.length;i++)if((A=o[i].batch).material_names=o[i].mat_names,Pe(A,o[i].submesh),le(A,r,e),"STATIC"==o[i].render.type&&"COLOR_ID"!=A.type){var s=n.unique_name("%meta%"+A.type+"%"+A.material_names.join("%")+"%"),c=E.create_object(s,"MESH");if(E.meta_obj_append_render(c,o[i].render),E.append_scene_data(c,e),E.append_batch(c,e,A),_.push(c),"MAIN"==A.type)for(var l=0;l<o[i].rel_bpy_objects.length;l++)(T=o[i].rel_bpy_objects[l]._object).meta_objects.push(c)}else E.append_batch(T=o[i].rel_bpy_objects[0]._object,e,A);if(m.debug_view){for(i=0;i<o.length;i++)if("DYNAMIC"==(P=o[i].render).type){var T=o[i].rel_bpy_objects[0]._object;if("MAIN"==(A=o[i].batch).type){var u=E.get_scene_data(T,e).batches,d=!1;for(l=0;l<u.length;l++)if(u[l].debug_sphere){d=!0;continue}if(d)continue;var f=Ge(P,T.name,!0,A);E.append_batch(T,e,f)}}for(i=0;i<_.length;i++){var P=(T=_[i]).render;"MAIN"==(A=E.get_scene_data(T,e).batches[0]).type&&(f=Ge(P,T.name,!1,A),E.append_batch(T,e,f))}for(i=0;i<o.length;i++){var A;"DEBUG_VIEW"==(A=o[i].batch).type&&(A.debug_id_color=i)}}for(i=0;i<t.length;i++)for(u=E.get_scene_data(t[i]._object,e).batches,l=0;l<u.length;l++)H(u[l]);for(i=0;i<_.length;i++)for(u=E.get_scene_data(_[i],e).batches,l=0;l<u.length;l++)H(u[l])},t.append_sky_batch_to_world=function(e,t,r){var _=e._render.world_light_set,n=K("MAIN");if(ke(n,"sky.glslv","sky.glslf"),n.is_sky=!0,n.depth_mask=!1,t.procedural_skydome)fe(n,"PROCEDURAL_SKYDOME",1),n.draw_proc_sky=!0;else{var a=_.sky_texture_param;Be(n,u.find_subs(e._render.graph,P.SKY).camera.color_attachment,"u_sky"),a&&(fe(n,"WO_SKYTEX",1),a.invert&&fe(n,"MTEX_NEGATIVE",1),a.use_rgb_to_intensity&&fe(n,"MTEX_RGBTOINT",1),fe(n,"BLENDTYPE",a.blend_type),a.use_map_blend&&fe(n,"WOMAP_BLEND",1),a.use_map_horizon&&fe(n,"WOMAP_HORIZ",1),a.use_map_zenith_up&&fe(n,"WOMAP_ZENUP",1),a.use_map_zenith_down&&fe(n,"WOMAP_ZENDOWN",1)),_.use_sky_blend&&fe(n,"WO_SKYBLEND",1),_.use_sky_paper&&fe(n,"WO_SKYPAPER",1),_.use_sky_real&&fe(n,"WO_SKYREAL",1)}t.reflexible&&(n.reflexible=!0,t.reflexible_only&&(n.reflexible_only=!0)),de(n,"a_position");var o=l.generate_fullscreen_quad();if(Pe(n,o),H(n),n.do_not_cull=!0,Ue(n),E.append_batch(r,e,n),u.find_subs(e._render.graph,P.DEBUG_VIEW)){var i=B(n);i.type="DEBUG_VIEW",i.subtype="",Ee(i),fe(i,"DEBUG_VIEW_SPECIAL_SKYDOME",1),o.va_common.a_polyindex=S.extract_polyindices(o),Pe(i,o),i.debug_main_batch_id=n.id,Ue(i),E.append_batch(r,e,i)}},t.create_forked_batches=function(e,t,r){for(var _=E.get_scene_data(e,r).batches,n=[],a=u.find_subs(t,P.MAIN_PLANE_REFLECT),o=u.find_subs(t,P.MAIN_CUBE_REFLECT),i=u.find_subs(t,P.OUTLINE_MASK),s=u.find_subs(t,P.COLOR_PICKING),c=0;c<_.length;c++){var l=_[c],T=null;"SHADOW"==l.type&&"RECEIVE"==l.subtype&&l.shadow_cast&&((T=B(l)).subtype="CAST"),"MAIN"!=l.type&&"PARTICLES"!=l.type||!a&&!o||!l.reflexible||((T=B(l)).subtype="REFLECT",T.refractive=!1,T.z_sort&&(T.z_sort=!1,T.depth_mask=!1),T.particles_data=l.particles_data),"COLOR_ID"==l.type&&i&&e.render.outlining&&(s&&e.render.selectable?(T=B(l)).subtype="OUTLINE":l.subtype="OUTLINE"),T&&(T.forked_batch=!0,Ue(T),n.push(T))}for(var d=0;d<n.length;d++)E.append_batch(e,r,n[d])},t.wb_angle_to_amp=function(e,t,r){var _=r*(t.max_z-t.min_z);if(0==_)return 0;var n=_*Math.tan(e);return.5*(Math.sqrt(2*Math.sqrt(4*n+1)+2)/2-1)/_},t.wb_amp_to_angle=function(e,t,r){var _=r*(t.max_z-t.min_z);if(0==_)return 0;e*=2*_;var n=Math.pow(e+1,4)-Math.pow(e+1,2);return Math.atan(n/_)},t.bb_bpy_to_b4w=function(e){var t={max_x:0,min_x:0,max_y:0,min_y:0,max_z:0,min_z:0};return t.max_x=e.max_x,t.min_x=e.min_x,t.max_y=e.max_y,t.min_y=e.min_y,t.max_z=e.max_z,t.min_z=e.min_z,t},t.name_list_to_node_name=function(e,t){for(var r=e[t],_=t+1;_<e.length;_++)r=ie(r,e[_]);return r},t.update_batch_material_error=se,t.update_batch_lights=le,t.set_lamp_data=Te,t.assign_shadow_receive_dirs=function(e,t,r){if(fe(e,"CSM_SECTION1",0),fe(e,"CSM_SECTION2",0),fe(e,"CSM_SECTION3",0),fe(e,"NUM_CAST_LAMPS",0),t){fe(e,"NUM_CAST_LAMPS",t.lamp_types.length),m.mac_os_shadow_hack&&fe(e,"MAC_OS_SHADOW_HACK",1);for(var _=1;_<t.csm_num;_++)fe(e,"CSM_SECTION"+String(_),1);fe(e,"SHADOW_TEX_RES",f.glsl_value(t.csm_resolution)),fe(e,"CSM_FADE_LAST_CASCADE",t.fade_last_cascade?1:0),fe(e,"CSM_BLEND_BETWEEN_CASCADES",t.blend_between_cascades&&!m.chrome_csm_blend_hack?1:0)}else fe(e,"SHADOW_TEX_RES",0),fe(e,"CSM_FADE_LAST_CASCADE",0),fe(e,"CSM_BLEND_BETWEEN_CASCADES",0)},t.set_batch_directive=fe,t.get_batch_directive=function(e,t){return f.get_directive(e.shaders_info,t)},t.update_batch_geometry=Pe,t.update_batch_id=Ue,t.update_local_bounds_from_pos=function(e,t){e.bounds_local.bb=vo(t,0,t.length,e.bounds_local.bb);var r=go(e.bounds_local.bb,G);e.bounds_local.be=Co(r,!0),e.bounds_local.bs=Do(e.bounds_local.be),e.use_be=Fo(e.bounds_local.be,e.bounds_local.bs)},t.apply_shader=ke,t.append_texture=Be,t.replace_texture=function(e,t,r){var _=e.texture_names.indexOf(r);_>-1&&(e.textures[_]=t)},t.create_shadeless_batch=function(e,t,r){var _=K("MAIN");return r<1&&(_.blend=!0),ar(t[0],t[1],t[2],r,_.diffuse_color),_.draw_mode=S.DM_TRIANGLES,Pe(_,e),ke(_,"main.glslv","main_stack.glslf"),fe(_,"SHADELESS",1),He(_),_},t.update_shader=He,t.generate_line_batches=function(e,t){for(var r=0;r<t.length;r++){var _=t[r],n=K("LINE");ke(n,"line.glslv","line.glslf"),n.blend=!0,n.do_not_cull=!0,Pe(n,l.generate_line()),H(n),E.append_scene_data(_,e),E.append_batch(_,e,n),He(n)}},t.check_batch_perm_uniform=function(e,t){return!!e.shader.permanent_uniform_setters.length&&!!e.shader.permanent_uniform_setters_table[t]},t.create_depth_pack_batch=function(e){var t=K("DEPTH_PACK");return t.use_backface_culling=!0,t.depth_mask=!1,Pe(t,l.generate_fullscreen_tri()),ke(t,"postprocessing/postprocessing.glslv","postprocessing/depth_pack.glslf"),He(t),t},t.create_postprocessing_batch=function(e){var t=K("POSTPROCESSING");switch(ke(t,"postprocessing/postprocessing.glslv","postprocessing/postprocessing.glslf"),e){case"NONE":fe(t,"POST_EFFECT","POST_EFFECT_NONE");break;case"GRAYSCALE":fe(t,"POST_EFFECT","POST_EFFECT_GRAYSCALE");break;case"X_BLUR":case"Y_BLUR":fe(t,"POST_EFFECT","POST_EFFECT_BLUR");break;case"X_GLOW_BLUR":case"Y_GLOW_BLUR":case"X_BLOOM_BLUR":case"Y_BLOOM_BLUR":fe(t,"POST_EFFECT","POST_EFFECT_GLOW_BLUR");break;case"X_DOF_BLUR":case"Y_DOF_BLUR":fe(t,"POST_EFFECT","POST_EFFECT_DOF_BLUR");break;case"X_ALPHA_BLUR":case"Y_ALPHA_BLUR":fe(t,"POST_EFFECT","POST_EFFECT_ALPHA_BLUR");break;case"X_EXTEND":case"Y_EXTEND":fe(t,"POST_EFFECT","POST_EFFECT_EXTEND");break;case"FLIP_CUBEMAP_COORDS":fe(t,"POST_EFFECT","FLIP_CUBEMAP_COORDS");break;default:r.panic("Wrong postprocessing effect: "+e)}return fe(t,"SHADOW_USAGE","NO_SHADOWS"),t.use_backface_culling=!0,t.depth_mask=!1,Pe(t,l.generate_fullscreen_tri()),He(t),t},t.create_ssao_batch=function(e){var t=K("SSAO");t.depth_mask=!1,t.use_backface_culling=!0,Pe(t,l.generate_fullscreen_tri()),ke(t,"postprocessing/postprocessing.glslv","postprocessing/ssao.glslf"),fe(t,"SSAO_QUALITY","SSAO_QUALITY_"+e.ssao_samples),fe(t,"SSAO_HEMISPHERE",e.ssao_hemisphere?1:0),fe(t,"SHADOW_USAGE","NO_SHADOWS");var r={width:4,height:4,data:new Uint8Array([150,123,254,0,127,3,97,0,164,246,99,0,155,177,14,0,54,83,221,0,2,142,143,0,32,57,79,0,49,160,32,0,57,232,115,0,178,216,203,0,70,196,218,0,241,164,82,0,225,58,85,0,233,88,189,0,144,25,203,0,117,73,12,0])},_=A.create_texture(A.TT_RGBA_INT,!1);return _.source="NODE_TEX",A.update_texture(_,r,0),Be(t,_,"u_ssao_special_tex"),He(t),t},t.create_ssao_blur_batch=function(e){var t=K("SSAO_BLUR");return t.depth_mask=!1,t.use_backface_culling=!0,Pe(t,l.generate_fullscreen_tri()),ke(t,"postprocessing/postprocessing.glslv","postprocessing/ssao_blur.glslf"),fe(t,"SSAO_BLUR_DEPTH",e.ssao_blur_depth?1:0),fe(t,"SHADOW_USAGE","NO_SHADOWS"),He(t),t},t.create_coc_batch=function(e){var t=K("COC");switch(t.depth_mask=!1,t.use_backface_culling=!0,Pe(t,l.generate_fullscreen_tri()),ke(t,"postprocessing/postprocessing.glslv","postprocessing/coc.glslf"),fe(t,"DEPTH_RGBA",1),e){case"COC_ALL":fe(t,"COC_TYPE","COC_ALL");break;case"COC_FOREGROUND":fe(t,"COC_TYPE","COC_FOREGROUND");break;case"COC_COMBINE":fe(t,"COC_TYPE","COC_COMBINE")}return fe(t,"SHADOW_USAGE","NO_SHADOWS"),He(t),t},t.create_dof_batch=function(e){var t=K("DOF");return t.depth_mask=!1,t.use_backface_culling=!0,Pe(t,l.generate_fullscreen_tri()),ke(t,"postprocessing/postprocessing.glslv","postprocessing/dof.glslf"),e.dof_bokeh?fe(t,"DOF_TYPE","DOF_BOKEH"):(fe(t,"DOF_TYPE","DOF_SIMPLE"),fe(t,"DEPTH_RGBA",1)),fe(t,"SHADOW_USAGE","NO_SHADOWS"),He(t),t},t.create_outline_batch=function(){var e=K("OUTLINE");return e.depth_mask=!1,e.use_backface_culling=!0,Pe(e,l.generate_fullscreen_tri()),ke(e,"postprocessing/postprocessing.glslv","postprocessing/outline.glslf"),He(e),e},t.create_glow_combine_batch=function(){var e=K("GLOW_COMBINE");return e.depth_mask=!1,e.use_backface_culling=!0,Pe(e,l.generate_fullscreen_tri()),ke(e,"postprocessing/postprocessing.glslv","postprocessing/glow.glslf"),He(e),e},t.create_god_rays_batch=function(e,t,r){var _=K("GOD_RAYS");return _.depth_mask=!1,_.use_backface_culling=!0,Pe(_,l.generate_billboard()),ke(_,"postprocessing/god_rays.glslv","postprocessing/god_rays.glslf"),fe(_,"DEPTH_RGBA",e?1:0),fe(_,"WATER_EFFECTS",t?1:0),fe(_,"STEPS_PER_PASS",f.glsl_value(r,1)),fe(_,"SHADOW_USAGE","NO_SHADOWS"),He(_),_},t.create_god_rays_combine_batch=function(){var e=K("GOD_RAYS_COM");return e.depth_mask=!1,e.use_backface_culling=!0,Pe(e,l.generate_fullscreen_tri()),ke(e,"postprocessing/postprocessing.glslv","postprocessing/god_rays_combine.glslf"),fe(e,"SAFARI_CANVAS_ALPHA_HACK",m.safari_canvas_alpha_hack?1:0),He(e),e},t.create_cube_sky_batch=function(e,t){var r=K("SKY");if(r.depth_mask=!1,r.use_backface_culling=!1,Pe(r,l.generate_plane(1,1)),""!=t.sky_ngraph_proxy_id)ke(r,"skybox.glslv","node_skybox.glslf"),fe(r,"IS_WORLD",1),function(e,t){var r=t._render.world_light_set;if(""!=r.ngraph_proxy_id){e.has_nodes=!0,e.ngraph_proxy_id=r.ngraph_proxy_id;var _=s.get_ngraph_proxy_cached(r.ngraph_proxy_id).graph;if(!_)return a.error('Failed to create node graph for world "'+t.world.name+'", disable nodes'),se(e,t.world.name),!0;var n=null;i.traverse(_,function(t,r){switch(r.type){case"TEXTURE_COLOR":case"TEXTURE_ENVIRONMENT_EQUIRECTANGULAR":case"TEXTURE_ENVIRONMENT_MIRROR_BALL":Be(e,r.data.value,r.data.name,r.data.bpy_name);break;case"VALTORGB":case"CURVE_VEC":case"CURVE_RGB":n||(n=r.data.texture);break;case"VECT_TRANSFORM":switch(Number(r.dirs[1][1])){case s.VT_WORLD_TO_OBJECT:fe(e,"USE_MODEL_TSR_INVERSE",1);break;case s.VT_WORLD_TO_CAMERA:fe(e,"USE_VIEW_TSR",1);break;case s.VT_OBJECT_TO_WORLD:fe(e,"USE_MODEL_TSR",1);break;case s.VT_OBJECT_TO_CAMERA:fe(e,"USE_MODEL_TSR",1),fe(e,"USE_VIEW_TSR",1);break;case s.VT_CAMERA_TO_WORLD:fe(e,"USE_VIEW_TSR_INVERSE",1);break;case s.VT_CAMERA_TO_OBJECT:fe(e,"USE_MODEL_TSR_INVERSE",1),fe(e,"USE_VIEW_TSR_INVERSE",1)}break;case"B4W_VECTOR_VIEW":fe(e,"USE_VIEW_TSR",1);break;case"B4W_REFLECT":fe(e,"USE_VIEW_TSR_INVERSE",1)}}),n&&Be(e,n,"u_nodes_texture");var o=e.shaders_info.node_elements=s.compose_node_elements(_);oe(_,e);for(var E=e.node_value_inds,c=e.node_rgb_inds,l=0;l<o.length;l++){var T=o[l];switch(T.id){case"VALUE":if(d=T.param_values[0])for(var u=0;u<E.length;u+=3)if(E[u]==d){T.dirs.push(["VALUE_ROW_IND",E[u+1]]),T.dirs.push(["VALUE_COL_IND",E[u+2]]);break}break;case"RGB":var d;if(d=T.param_values[0])for(u=0;u<c.length;u+=2)if(c[u]==d){T.dirs.push(["RGB_IND",c[u+1]]);break}}}fe(e,"NUM_VALUES",e.node_values.length/4),fe(e,"NUM_RGBS",e.node_rgbs.length)}}(r,e);else if(t.procedural_skydome)ke(r,"skybox.glslv","proc_skybox.glslf"),fe(r,"WATER_EFFECTS",1);else{if(ke(r,"skybox.glslv","tex_skybox.glslf"),e){var _=e._render.world_light_set;if(_.sky_texture_slot){var n=_.sky_texture_slot.texture;Be(r,A.get_batch_texture(_.sky_texture_slot,null),"u_sky_texture",n.name)}_.sky_texture_param&&fe(r,"WO_SKYTEX",1)}t.sky_invert&&fe(r,"MTEX_NEGATIVE",1),t.sky_use_rgb_to_intensity&&fe(r,"MTEX_RGBTOINT",1),fe(r,"BLENDTYPE",t.sky_blend_type),t.sky_use_map_blend&&fe(r,"WOMAP_BLEND",1),t.sky_use_map_horizon&&fe(r,"WOMAP_HORIZ",1),t.sky_use_map_zenith_up&&fe(r,"WOMAP_ZENUP",1),t.sky_use_map_zenith_down&&fe(r,"WOMAP_ZENDOWN",1),t.use_sky_blend&&fe(r,"WO_SKYBLEND",1),t.use_sky_paper&&fe(r,"WO_SKYPAPER",1),t.use_sky_real&&fe(r,"WO_SKYREAL",1)}return He(r),r},t.append_cube_sky_batch_to_world=function(e,t){var r=u.find_subs(e._render.graph,P.SKY);r&&E.append_batch(t,e,r.draw_data[0].bundles[0].batch)},t.create_cube_irradiance_batch=function(e,t){var r=K("IRRADIANCE");return r.depth_mask=!1,r.use_backface_culling=!1,Pe(r,l.generate_plane(1,1)),ke(r,"skybox.glslv","irradiance_skybox.glslf"),He(r),r},t.create_cube_roughness_convolution_batch=function(e,t){var r=K("R_CONVOLUTION");return r.depth_mask=!1,r.use_backface_culling=!1,Pe(r,l.generate_plane(1,1)),ke(r,"skybox.glslv","r_convolution_skybox.glslf"),He(r),r},t.create_brdf_batch=function(e,t){var r=K("BRDF");return r.depth_mask=!1,r.use_backface_culling=!1,Pe(r,l.generate_plane(1,1)),ke(r,"postprocessing/postprocessing.glslv","postprocessing/precompute_brdf.glslf"),He(r),r},t.create_antialiasing_batch=function(e){var t=K("ANTIALIASING");return t.depth_mask=!1,t.use_backface_culling=!0,Pe(t,l.generate_fullscreen_tri()),ke(t,"postprocessing/postprocessing.glslv","postprocessing/antialiasing.glslf"),m.quality_aa_method?(fe(t,"AA_METHOD","AA_METHOD_FXAA_QUALITY"),fe(t,"AA_QUALITY",e.fxaa_quality)):fe(t,"AA_METHOD","AA_METHOD_FXAA_LIGHT"),He(t),t},t.create_smaa_batch=function(e){var t=K("SMAA");return Pe(t,l.generate_fullscreen_tri()),ke(t,"postprocessing/smaa.glslv","postprocessing/smaa.glslf"),fe(t,"AA_METHOD","AA_METHOD_SMAA_HIGH"),fe(t,"SMAA_PASS",e),fe(t,"SMAA_PREDICATION",0),fe(t,"SMAA_REPROJECTION",0),He(t),t.depth_mask=!1,t.use_backface_culling=!0,t},t.create_compositing_batch=function(){var e=K("COMPOSITING");return e.depth_mask=!1,e.use_backface_culling=!0,Pe(e,l.generate_fullscreen_tri()),ke(e,"postprocessing/postprocessing.glslv","postprocessing/compositing.glslf"),He(e),e},t.create_motion_blur_batch=function(e){var t=K("MOTION_BLUR");return t.use_backface_culling=!0,t.depth_mask=!1,Pe(t,l.generate_fullscreen_tri()),ke(t,"postprocessing/postprocessing.glslv","postprocessing/motion_blur.glslf"),He(t),t},t.create_stereo_batch=function(e){var t=K("STEREO");return t.use_backface_culling=!0,t.depth_mask=!1,Pe(t,l.generate_fullscreen_tri()),ke(t,"postprocessing/postprocessing.glslv","postprocessing/stereo.glslf"),fe(t,"ANAGLYPH","ANAGLYPH"===e?1:0),fe(t,"SIDEBYSIDE","SIDEBYSIDE"===e?1:0),fe(t,"DISTOR_SCALE",N.nonwebvr.distor_scale),He(t),t},t.create_luminance_batch=function(){var e=K("LUMINANCE");return e.depth_mask=!1,e.use_backface_culling=!0,Pe(e,l.generate_fullscreen_tri()),ke(e,"postprocessing/postprocessing.glslv","postprocessing/luminance.glslf"),He(e),e},t.create_average_luminance_batch=function(){var e=K("LUMINANCE");return e.depth_mask=!1,e.use_backface_culling=!0,Pe(e,l.generate_fullscreen_tri()),ke(e,"postprocessing/postprocessing.glslv","postprocessing/luminance_av.glslf"),He(e),e},t.create_luminance_truncated_batch=function(e){var t=K("LUMINANCE_X_BLUR");return t.depth_mask=!1,t.use_backface_culling=!0,Pe(t,l.generate_fullscreen_tri()),ke(t,"postprocessing/postprocessing.glslv","postprocessing/luminance_truncated.glslf"),e&&f.set_directive(t.shaders_info,"ADAPTIVE_BLOOM",1),He(t),t},t.create_bloom_combine_batch=function(e){var t=K("BLOOM");if(t.depth_mask=!1,t.use_backface_culling=!0,Pe(t,l.generate_fullscreen_tri()),ke(t,"postprocessing/postprocessing.glslv","postprocessing/bloom_combine.glslf"),1==e)var r="BLUR_PASS_1";else 2==e?r="BLUR_PASS_2":3==e?r="BLUR_PASS_3":4==e?r="BLUR_PASS_4":5==e&&(r="BLUR_PASS_5");return f.set_directive(t.shaders_info,"BLUR_PASS_NUM",r),He(t),t},t.create_velocity_batch=function(){var e=K("VELOCITY");return e.depth_mask=!1,e.use_backface_culling=!0,Pe(e,l.generate_fullscreen_tri()),ke(e,"postprocessing/postprocessing.glslv","postprocessing/velocity.glslf"),He(e),e},t.create_anchor_visibility_batch=function(){var e=K("ANCHOR_VISIBILITY");return e.depth_mask=!0,e.use_backface_culling=!0,e.draw_mode=S.DM_TRIANGLES,ke(e,"anchors.glslv","anchors.glslf"),Pe(e,l.generate_index(1)),fe(e,"ANCHOR_NUM",1),He(e),e.anchor_positions=new Float32Array(3),e},t.create_performance_batch=function(){var e=K("PERFORMANCE");return e.depth_mask=!1,e.use_backface_culling=!0,Pe(e,l.generate_fullscreen_tri()),ke(e,"postprocessing/postprocessing.glslv","postprocessing/performance.glslf"),He(e),e},t.update_anchor_visibility_batch=function(e,t){var r=t.length/3;r!=e.anchor_positions.length/3&&(Pe(e,l.generate_index(r)),fe(e,"ANCHOR_NUM",r),He(e)),e.anchor_positions=t},t.get_first_batch=function(e){if(!e.scenes_data.length)return null;var t=e.scenes_data[0];return t.batches.length?t.batches[0]:null},t.find_batch_material_any=function(e,t,r){for(var _=e.scenes_data[0].batches,n=0;n<_.length;n++)if(_[n].type==r&&-1!=_[n].material_names.indexOf(t))return _[n];return null},t.find_batch_material=function(e,t,r){for(var _=e.scenes_data[0].batches,n=0;n<_.length;n++)if(_[n].type==r&&!_[n].forked_batch&&-1!=_[n].material_names.indexOf(t))return _[n];return null},t.find_batch_material_forked=function(e,t,r){for(var _=e.scenes_data[0].batches,n=0;n<_.length;n++)if(_[n].type==r&&_[n].forked_batch&&-1!=_[n].material_names.indexOf(t))return _[n];return null},t.iterate_batches_by_mat=function(e,t,r,_){for(var n=e.scenes_data[0].batches,a=0;a<n.length;a++){var o=n[a];if(-1!=o.material_names.indexOf(t)&&(!_||o.type==_)&&r(o))return}},t.check_batch_type=function(e,t){for(var r=e.scenes_data[0].batches,_=0;_<r.length;_++)if(r[_].type==t)return!0;return!1},t.get_batch_by_type=function(e,t,r){for(var _=(r?E.get_scene_data(e,r):e.scenes_data[0]).batches,n=0;n<_.length;n++)if(_[n].type==t)return _[n];return null},t.clear_batch=function(e){var t=e.textures;e.textures=[];for(var r=0;r<t.length;r++)A.cleanup_unused(t[r]);if(e.textures=t,e.bufs_data&&e.bufs_data.cleanup_gl_data_on_unload&&S.cleanup_bufs_data(e.bufs_data),e.cleanup_gl_data_on_unload&&e.vaos.length&&T.cleanup_vao(e),e.shader&&e.shader.cleanup_gl_data_on_unload&&f.cleanup_shader(e.shader),e.ngraph_proxy_id){var _=s.get_ngraph_proxy_cached(e.ngraph_proxy_id);_&&_.cleanup_on_unload&&s.cleanup_ngraph_proxy(e.ngraph_proxy_id)}},t.set_cleanup_nodemat=function(e,t){if(""!==e.ngraph_proxy_id){var r=s.get_ngraph_proxy_cached(e.ngraph_proxy_id);r&&(r.cleanup_on_unload=t)}},t.generate_odd_id=Qe,t.cleanup=function(){F={}},t.set_nodemat_value=function(e,t,r){for(var _=e.node_value_inds,n=0;n<_.length;n+=3)if(_[n]==t)return e.node_values[4*_[n+1]+_[n+2]]=r,!0;return!1},t.set_nodemat_rgb=function(e,t,r,_,n){for(var a=e.node_rgb_inds,o=0;o<a.length;o+=2)if(a[o]==t){var i=a[o+1];return e.node_rgbs[3*i]=r,e.node_rgbs[3*i+1]=_,e.node_rgbs[3*i+2]=n,!0}return!1},t.get_nodemat_value=function(e,t){for(var r=e.node_value_inds,_=0;_<r.length;_+=3)if(r[_]==t)return e.node_values[4*r[_+1]+r[_+2]];return null},t.get_nodemat_rgb=function(e,t,r){for(var _=e.node_rgb_inds,n=0;n<_.length;n+=2)if(_[n]==t){var a=_[n+1];return r[0]=e.node_rgbs[3*a],r[1]=e.node_rgbs[3*a+1],r[2]=e.node_rgbs[3*a+2],r}return null}}),Bs=A("__anchors",function(e,t){var r=Ks(e),_=oE(e),n=Wo(e),a=aE(e),o=ds(e),i=Ms(e),s=os(e),E=ga(e),c=Qi(e),l=ps(e),T=ai(e),u=ri(e),d=Os(e),f=n.defaults,P=[],A=!1,S=null,p=!1,m=!1,O=new Float32Array(0),v=new Uint8Array(16),N=new Float32Array(2),g=new Float32Array(3),h=new Float32Array(3);function R(e){if(!m&&!A){var t=S;if(t){if("visible"==t.lastElementChild.style.visibility)return I(),void(S=null);if(1==t.style.opacity){var r=t.lastElementChild,_=t.firstElementChild,n=r.firstElementChild,a=Math.ceil(r.getBoundingClientRect().width),o=Math.ceil(r.getBoundingClientRect().height),i=Math.ceil(_.getBoundingClientRect().width),s=Math.ceil(_.getBoundingClientRect().height);r.style.position="absolute",r.style.visibility="visible";var E=!0,c=!0;_.style.display="none",m=!0,i!=a?u.animate(i,a,200,function(e){e==a&&(E=!1,c||l()),r.style.width=e+"px"}):(E=!1,c||(m=!1)),s!=o?u.animate(s,o,200,function(e){e==o&&(c=!1,E||l()),r.style.height=e+"px"}):(c=!1,E||(m=!1))}}}function l(){m=!1,n.style.visibility="visible"}}function I(){var e=S.lastElementChild;S.firstElementChild.style.display="",e.style.visibility="hidden",e.style.position="relative",e.firstElementChild.style.visibility="hidden"}function b(e){e.style.cssText+="color:       #fff;font-family: Arial;font-size:   12px;font-weight: bold;line-height: 1.25;"}function Y(){for(var e=0,t=0;t<P.length;t++)P[t].detect_visibility&&e++;O=new Float32Array(3*e)}function L(e,t){return t.depth-e.depth}function M(e,t,r){var _=e.element;f.ie_edge_anchors_floor_hack&&(t=Math.floor(t),r=Math.floor(r)),"transform"in _.style?_.style.transform="translate3d("+t+"px, "+r+"px, 0px)":"webkitTransform"in _.style?_.style.webkitTransform="translate3d("+t+"px, "+r+"px, 0px)":(_.style.left=t+"px",_.style.top=r+"px")}function x(e,t){var r=l.get_camera(l.get_main()),n=Fa(e.obj.render.world_tsr);return _.project_point(r,n,t),t}function y(e){var t=l.get_subs(l.get_main(),T.ANCHOR_VISIBILITY).camera,r=a.canvas_to_viewport_coords(e.x,e.y,N,t);return c.read_pixels(t.framebuffer,r[0],t.height-r[1],2,2,v),v[0]+v[4]+v[8]+v[12]>=255?"visible":"out"==e.appearance||v[0]+v[4]+v[8]+v[12]==0?"covered":e.appearance}function w(e){a.get_container().removeChild(e.element)}function U(e){for(var t=0;t<P.length;t++)if(P[t].obj==e)return!0;return!1}function C(e,t,r){if(e.element)var _=Math.round(e.element.offsetWidth)||0,n=Math.round(e.element.offsetHeight)||0;else _=0,n=0;var a=e.x,o=e.y;return t>=a&&t<=a+_&&r<o&&r>=o-n}function D(e,t){if(!e.is_lod)return!0;var r=e.lod_dist_max;return!(t<e.lod_dist_min)&&(r==s.LOD_DIST_MAX_INFINITY||t<r)}t.append=function(e){if(!U(e)){var t=e.anchor.detect_visibility&&Boolean(l.get_subs(l.get_main(),T.ANCHOR_VISIBILITY)),r={type:e.anchor.type,obj:e,x:0,y:0,depth:0,appearance:"out",detect_visibility:t,element:null,move_cb:null,annotation_max_width:e.anchor.max_width,element_id:e.anchor.element_id};switch(r.type){case"ANNOTATION":r.element=function(e){var t=e.obj,r=a.get_container(),_=i.get_meta_tags(t),n=t.name,s="",E=document.createElement("div"),c=E.cloneNode(!1),l=document.createElement("span");return E.style.cssText+="position:        absolute;height:          0;top:             0;left:            0;transform-style: preserve-3d;",c.style.cssText+="background-color:   #000;border-radius:      20px 20px 20px 0px;box-shadow:         0px 0px 10px rgb(180, 180, 200);-webkit-box-shadow: 0px 0px 10px rgb(180, 180, 200);opacity:            1.0;box-sizing:         border-box;bottom:             0;left:               0;padding:            6px 12px 6px 12px;position:           absolute;",E.style.visibility="hidden",_&&(s=_.description||s,n=_.title||n),l.innerHTML=n,l.style.cssText+="-webkit-touch-callout: none;-webkit-user-select:   none;-khtml-user-select:    none;-moz-user-select:      none;-ms-user-select:       none;user-select:           none;cursor:                default;",b(l),l.style.whiteSpace="nowrap",c.appendChild(l),E.appendChild(c),s&&function(e,t,r){var _=document.createElement("div"),n=document.createElement("span");r&&(_.style.maxWidth=r+"px"),_.style.cssText+="background-color:   #000;border-radius:      20px 20px 20px 0px;bottom:             0;box-shadow:         0px 0px 10px rgb(180, 180, 200);-webkit-box-shadow: 0px 0px 10px rgb(180, 180, 200);left:               0;box-sizing:         border-box;opacity:            1.0;padding:            6px 12px 6px 12px;position:           relative;z-index:            2;",b(n),n.innerHTML=e,_.style.visibility="hidden",n.style.visibility="hidden",_.appendChild(n),t.appendChild(_),o.add_click_listener(t,function(e){m||t!=S&&1==t.style.opacity&&(A||(S&&"visible"==S.lastElementChild.style.visibility&&I(),S=t))})}(s,E,e.annotation_max_width),r.appendChild(E),E}(r);break;case"ELEMENT":if(r.element=document.getElementById(e.anchor.element_id),r.element)for(var _=0;_<P.length;_++)"ELEMENT"==P[_].type&&P[_].element_id==e.anchor.element_id&&(E.warn("Anchor with the id '"+e.anchor.element_id+"' already exists, making the new anchor generic."),r.type="GENERIC");else E.warn("Anchor HTML element with the id '"+e.anchor.element_id+"' was not found, making it generic."),r.type="GENERIC"}P.push(r),Y(),p||(p=!0,a.get_container().addEventListener("mouseup",R))}},t.remove=function(e){for(var t=0;t<P.length;t++){var r=P[t];if(r.obj==e){"ANNOTATION"==r.type&&w(r),P.splice(t,1),Y(),t--;break}}},t.update=function(e){for(var t=0,_=P.length;_--;){if((c=P[_]).detect_visibility){var n=Fa(c.obj.render.world_tsr);O.set(n,3*t++)}var a=x(c,g),o=a[0],i=a[1],s=a[2];if(e||o!=c.x||i!=c.y||s!=c.depth){switch(c.type){case"ANNOTATION":M(c,o,i);break;case"ELEMENT":var E=c.element.getBoundingClientRect();M(c,o-E.width/2,i-E.height/2)}c.x=o,c.y=i,c.depth=s,c.move_cb&&c.move_cb(o,i,c.appearance,c.obj,c.element)}}for(P.sort(L),_=0;_<P.length;_++){var c;"GENERIC"!=(c=P[_]).type&&(c.element.style.zIndex=S==c.element?P.length:_)}if(t>0){var u=l.get_subs(l.get_main(),T.ANCHOR_VISIBILITY),d=u.draw_data[0].bundles[0];r.update_anchor_visibility_batch(d.batch,O),T.append_draw_data(u,d)}},t.update_visibility=function(){for(var e=a.get_container(),t=l.get_active(),r=l.get_subs(t,T.STEREO),_=Boolean(r&&r.enable_hmd_stereo),n=P.length;n--;){var o=P[n],i=o.obj,s=i.render,E=o.x,c=o.y,u=o.depth,f=l.get_camera(l.get_main()),A=Ue(d.get_translation(i,g),d.get_translation(f,h));if(E<0||c<0||u<0||u>1||l.is_hidden(i)||E>=e.clientWidth||c>=e.clientHeight||!D(s,A))var p="out";else p="visible";if(o.detect_visibility&&"out"!=p&&(p=y(o)),_&&(p="out"),p!=o.appearance){switch(o.type){case"ANNOTATION":case"ELEMENT":var m=o.element;if(!m)break;"out"==p?(m.style.visibility="hidden",m.children.length&&(m.children[0].style.visibility="hidden")):"visible"==p?(m.style.visibility="visible",m.children.length&&(m.children[0].style.visibility="visible"),m.style.opacity=1):(m.style.visibility="visible",m.style.opacity=.1,m.children.length&&(m.children[0].style.visibility="visible"),"ANNOTATION"==o.type&&m.children.length>1&&"visible"==m.lastElementChild.style.visibility&&(I(),m==S&&(S=null)))}o.appearance=p,o.move_cb&&o.move_cb(E,c,o.appearance,i,m)}}},t.attach_move_cb=function(e,t){for(var r=0;r<P.length;r++)P[r].obj==e&&(P[r].move_cb=t)},t.detach_move_cb=function(e){for(var t=0;t<P.length;t++)P[t].obj==e&&(P[t].move_cb=null)},t.cleanup=function(){for(var e=0;e<P.length;e++){var t=P[e];"ANNOTATION"==t.type&&w(t)}P.length=0},t.is_anchor=U,t.get_element_id=function(e){for(var t=0;t<P.length;t++)if(P[t].obj==e)return P[t].element_id;return!1},t.pause=function(){A=!0},t.resume=function(){A=!1},t.pick_anchor=function(e,t){for(var r=-1,_=0;_<P.length;_++)if("visible"==P[_].appearance&&C(P[_],e,t))if(r<0){var n=P[_].depth;r=_}else P[_].depth<n&&(r=_,n=P[_].depth);return r<0?null:P[r].obj}}),Xs=A("__controls",function(e,t){var r=ha(e),_=Wo(e),n=aE(e),a=ds(e),o=Ms(e),i=ga(e),s=Ns(e),E=ri(e),c=_.controls,l=_.defaults,T=[],u={},d=[],f=[],P=[],A=new Float32Array(2),S=new Float32Array(2),p=ve(),m=Yr(),O=!1,v=0,N=20,g=30,h=40,R=50,I=60,b=70,Y=75,L=80,M=90,x=100,y=110,w=120,U=130,C=140,D=150,F=160,G=170,k=180,K=190,B=200,X=210,H=220,Q=230,z=240,V=250,j=260,q=270,W=280,J=290;t.CT_POSITIVE=10,t.CT_CONTINUOUS=20,t.CT_TRIGGER=30,t.CT_SHOT=40,t.CT_LEVEL=50,t.CT_CHANGE=60,t.PL_SINGLE_TOUCH_MOVE=0,t.PL_MULTITOUCH_MOVE_ZOOM=1,t.PL_MULTITOUCH_MOVE_PAN=2,t.PL_MULTITOUCH_MOVE_ROTATE=3;var Z=.3,$=.1,ee=.01,te=0,re=1,_e=2,ne=3,ae=16,oe=10,ie=1;function se(e,t){return t||(t=n.get_container()),{type:e,value:0,payload:null,element:t,do_activation:!1,key:0,collision_id:"",calc_pos_norm:!1,collision_obj:null,collision_cb:function(){},col_imp_obj:null,col_imp_cb:function(){},source_object:null,from:new Float32Array(3),to:new Float32Array(3),is_binary_value:!1,ign_src_rot:!1,ray_test_id:0,ray_test_cb:function(){},axis:"",time_last:0,trans_last:new Float32Array(3),quat_last:new Float32Array(4),threshold:0,quat_temp:new Float32Array(4),avg_linear_vel:0,avg_angular_vel:0,rotation_threshold:0,avg_vertical_vel:0,period:0,repeat:!1,enable_toggle_switch:!1,gamepad_id:0,position:ve(),orientation:Yr(),callback:function(){}}}function Ee(e){e.mouse_select_data.is_updated||(e.mouse_select_data.obj=o.pick_object(e.mouse_select_data.coord[0],e.mouse_select_data.coord[1]),e.mouse_select_data.is_updated=!0,e.global_selected_obj=e.mouse_select_data.obj);for(var t=0;t<oe;++t){var r=e.touch_select_dlist[t];r.is_updated||(r.obj=o.pick_object(r.coord[0],r.coord[1]),r.is_updated=!0,e.global_selected_obj=r.obj)}}function ce(e){if(!e.is_updated_keyboard){for(var t=0;t<e.downed_keys.length;t++)e.downed_keys[t]==re?e.downed_keys[t]=_e:e.downed_keys[t]==ne&&(e.downed_keys[t]=te);e.is_updated_keyboard=!0}e.mouse_state==re?e.mouse_state=_e:e.mouse_state==ne&&(e.mouse_state=te);for(var r=0;r<e.touch_select_dlist.length;r++){var _=e.touch_select_dlist[r];_.touch_state==re?_.touch_state=_e:_.touch_state==ne&&(_.touch_state=te)}e.wheel_delta=0,e.mouse_last_x=e.mouse_curr_x,e.mouse_last_y=e.mouse_curr_y,e.downed_keys[0]=te,e.touches_last_x.set(e.touches_curr_x),e.touches_last_y.set(e.touches_curr_y),e.touch_zoom_last_dist=e.touch_zoom_curr_dist,e.gyro_gamma_last=e.gyro_gamma_new,e.gyro_beta_last=e.gyro_beta_new,e.gyro_alpha_last=e.gyro_alpha_new,e.is_updated_gyro_quat=!1}function le(e){e||(e=n.get_container());for(var t=0;t<P.length;t++)if(e==(r=P[t]).element)return r;var r={element:e,is_updated_keyboard:!0,mouse_state:te,is_touch_ended:!0,mouse_last_x:0,mouse_last_y:0,mouse_curr_x:0,mouse_curr_y:0,pointerlock_dx:0,pointerlock_dy:0,touches_last_x:new Float32Array(2),touches_curr_x:new Float32Array(2),touches_last_y:new Float32Array(2),touches_curr_y:new Float32Array(2),touch_zoom_curr_dist:0,touch_zoom_last_dist:0,touch_start_rot:0,downed_keys:new Uint8Array(256),wheel_delta:0,global_selected_obj:null,mouse_select_data:_(),touch_select_dlist:new Array(oe),is_updated_gyro_quat:!1,gyro_quat:Yr(),gyro_gamma_new:0,gyro_beta_new:0,gyro_alpha_new:0,gyro_gamma_last:0,gyro_beta_last:0,gyro_alpha_last:1/0,orientation_quat_cb:null,orientation_angles_cb:null,mouse_wheel_cb:null,mouse_down_which_cb:null,mouse_select_cb:null,touch_select_start_cb:null,touch_select_end_cb:null,mouse_up_which_cb:null,mouse_location_cb:null,pointerlock_cb:null,keyboard_downed_keys_cb:null,touch_start_cb:null,touch_move_cb:null,touch_end_cb:null,registered_accum_values:{}};for(t=0;t<oe;++t)r.touch_select_dlist[t]=_();function _(){return{coord:new Float32Array(2),is_updated:!0,obj:null,identifier:-1,touch_state:te}}return r.orientation_quat_cb=function(e){r.is_updated_gyro_quat||(a.gyro_angles_to_quat(e,r.gyro_quat),r.is_updated_gyro_quat=!0)},r.orientation_angles_cb=function(e){var t=he(e,p);r.gyro_alpha_new=t[0],r.gyro_beta_new=t[1],r.gyro_gamma_new=t[2],r.gyro_alpha_last==1/0&&(r.gyro_alpha_last=t[0],r.gyro_beta_last=t[1],r.gyro_gamma_last=t[2])},r.mouse_wheel_cb=function(e){r.wheel_delta+=e*c.mouse_wheel_notch_multiplier},r.mouse_down_which_cb=function(e){var t=a.get_device_by_type_element(a.DEVICE_MOUSE,r.element),_=a.get_vector_param(t,a.MOUSE_LOCATION,A);r.mouse_last_x=_[0],r.mouse_last_y=_[1],r.mouse_curr_x=_[0],r.mouse_curr_y=_[1],r.mouse_state!=ne&&r.mouse_state!=te||(r.mouse_state=re),r.which=e},r.mouse_select_cb=function(e){var t=a.get_device_by_type_element(a.DEVICE_MOUSE,r.element),_=a.get_vector_param(t,a.MOUSE_LOCATION,A),o=n.client_to_canvas_coords(_[0],_[1],A);r.mouse_select_data.is_updated=!1,r.mouse_select_data.coord[0]=o[0],r.mouse_select_data.coord[1]=o[1]},r.touch_select_start_cb=function(e){for(var t=0;t<e.length;++t){for(var _=e[t],a=null,o=null,i=0;i<r.touch_select_dlist.length;i++){var s=r.touch_select_dlist[i],E=s.touch_state==ne||s.touch_state==te;if(s.identifier==_.identifier){E&&(o=s);break}!a&&E&&((a=s).identifier=_.identifier)}var c=o||a;if(c){var l=n.client_to_canvas_coords(e[t].clientX,e[t].clientY,A);c.is_updated=!1,c.touch_state=re,c.coord[0]=l[0],c.coord[1]=l[1]}}},r.touch_select_end_cb=function(e){for(var t=0;t<r.touch_select_dlist.length;++t){for(var _=r.touch_select_dlist[t],n=!1,a=0;a<e.length;++a)if(e[a].identifier==_.identifier){n=!0;break}n||(_.touch_state!=te&&(_.touch_state=ne),_.obj=null)}},r.mouse_up_which_cb=function(e){var t=a.get_device_by_type_element(a.DEVICE_MOUSE,r.element),_=a.get_vector_param(t,a.MOUSE_LOCATION,A);r.mouse_last_x=_[0],r.mouse_last_y=_[1],r.mouse_curr_x=_[0],r.mouse_curr_y=_[1],r.mouse_state!=te&&(r.mouse_state=ne),r.which=e},r.mouse_location_cb=function(e){l.ie11_edge_touchscreen_hack&&r.mouse_state==te||(r.mouse_curr_x=e[0],r.mouse_curr_y=e[1])},r.pointerlock_cb=function(e){r.pointerlock_dx+=e[0],r.pointerlock_dy+=e[1]},r.keyboard_down_keys_cb=function(e){r.downed_keys[e]!=_e&&(r.downed_keys[e]=re,r.is_updated_keyboard=!1)},r.keyboard_down_mod_keys_cb=function(e){for(var t=0;t<r.downed_keys.length;t++)r.downed_keys[t]!=te&&(r.downed_keys[t]=ne,r.is_updated_keyboard=!1)},r.keyboard_up_keys_cb=function(e){r.is_updated_keyboard=!1,r.downed_keys[e]=ne},r.touch_start_cb=function(e){if(r.is_touch_ended=!1,1==e.length)r.touches_last_x[0]=e[0].clientX,r.touches_last_x[1]=-1,r.touches_last_y[0]=e[0].clientY,r.touches_last_y[1]=-1;else if(e.length>1){var t=ge(e);r.touch_zoom_curr_dist=r.touch_zoom_last_dist=t,r.touches_last_x[0]=e[0].clientX,r.touches_last_x[1]=e[1].clientX,r.touches_last_y[0]=e[0].clientY,r.touches_last_y[1]=e[1].clientY,r.touch_start_rot=function(e){var t=e[0],r=e[1];return Math.atan2(t.clientY-r.clientY,t.clientX-r.clientX)}(e)}r.touches_curr_x.set(r.touches_last_x),r.touches_curr_y.set(r.touches_last_y)},r.touch_move_cb=function(e){if(1===e.length)r.touches_curr_x[0]=e[0].clientX,r.touches_curr_x[1]=-1,r.touches_curr_y[0]=e[0].clientY,r.touches_curr_y[1]=-1;else if(e.length>1){r.touches_curr_x[0]=e[0].clientX,r.touches_curr_x[1]=e[1].clientX,r.touches_curr_y[0]=e[0].clientY,r.touches_curr_y[1]=e[1].clientY;var t=ge(e);r.touch_zoom_curr_dist=t}},r.touch_end_cb=function(e){0==e.length&&(r.is_touch_ended=!0)},P.push(r),r}function Te(e,t){if(t in e.registered_accum_values&&e.registered_accum_values[t]>0)e.registered_accum_values[t]+=1;else switch(e.registered_accum_values[t]=1,t){case"orientation_quat":(r=a.get_device_by_type_element(a.DEVICE_GYRO))&&a.attach_param_cb(r,a.GYRO_ORIENTATION_ANGLES,e.orientation_quat_cb);break;case"orientation_angles":(r=a.get_device_by_type_element(a.DEVICE_GYRO))&&a.attach_param_cb(r,a.GYRO_ORIENTATION_ANGLES,e.orientation_angles_cb);break;case"mouse_wheel":(r=a.get_device_by_type_element(a.DEVICE_MOUSE,e.element))&&a.attach_param_cb(r,a.MOUSE_WHEEL,e.mouse_wheel_cb);break;case"mouse_down_which":(r=a.get_device_by_type_element(a.DEVICE_MOUSE,e.element))&&a.attach_param_cb(r,a.MOUSE_DOWN_WHICH,e.mouse_down_which_cb);break;case"mouse_select":(r=a.get_device_by_type_element(a.DEVICE_MOUSE,e.element))&&a.attach_param_cb(r,a.MOUSE_DOWN_WHICH,e.mouse_select_cb);break;case"touch_select":(r=a.get_device_by_type_element(a.DEVICE_TOUCH,e.element))&&(a.attach_param_cb(r,a.TOUCH_START,e.touch_select_start_cb),a.attach_param_cb(r,a.TOUCH_END,e.touch_select_end_cb));break;case"mouse_up_which":(r=a.get_device_by_type_element(a.DEVICE_MOUSE,e.element))&&a.attach_param_cb(r,a.MOUSE_UP_WHICH,e.mouse_up_which_cb);break;case"mouse_location":(r=a.get_device_by_type_element(a.DEVICE_MOUSE,e.element))&&a.attach_param_cb(r,a.MOUSE_LOCATION,e.mouse_location_cb);break;case"mouse_pointerlock":(r=a.get_device_by_type_element(a.DEVICE_MOUSE,e.element))&&a.attach_param_cb(r,a.MOUSE_LOCATION_PL,e.pointerlock_cb);break;case"keyboard_downed_keys":(r=a.get_device_by_type_element(a.DEVICE_KEYBOARD,e.element))&&(a.attach_param_cb(r,a.KEYBOARD_DOWN,e.keyboard_down_keys_cb),a.attach_param_cb(r,a.KEYBOARD_DOWN_MODIFIED,e.keyboard_down_mod_keys_cb),a.attach_param_cb(r,a.KEYBOARD_UP,e.keyboard_up_keys_cb));break;case"touch_start":(r=a.get_device_by_type_element(a.DEVICE_TOUCH,e.element))&&a.attach_param_cb(r,a.TOUCH_START,e.touch_start_cb);break;case"touch_move":(r=a.get_device_by_type_element(a.DEVICE_TOUCH,e.element))&&a.attach_param_cb(r,a.TOUCH_MOVE,e.touch_move_cb);break;case"touch_end":var r;(r=a.get_device_by_type_element(a.DEVICE_TOUCH,e.element))&&a.attach_param_cb(r,a.TOUCH_END,e.touch_end_cb)}}function ue(e,t){if(t in e.registered_accum_values&&e.registered_accum_values[t]>0&&(e.registered_accum_values[t]-=1,!e.registered_accum_values[t]))switch(t){case"orientation_quat":(r=a.get_device_by_type_element(a.DEVICE_GYRO))&&a.detach_param_cb(r,a.GYRO_ORIENTATION_QUAT,e.orientation_quat_cb);break;case"orientation_angles":(r=a.get_device_by_type_element(a.DEVICE_GYRO))&&a.detach_param_cb(r,a.GYRO_ORIENTATION_ANGLES,e.orientation_angles_cb);break;case"mouse_wheel":(r=a.get_device_by_type_element(a.DEVICE_MOUSE,e.element))&&a.detach_param_cb(r,a.MOUSE_WHEEL,e.mouse_wheel_cb);break;case"mouse_down_which":(r=a.get_device_by_type_element(a.DEVICE_MOUSE,e.element))&&a.detach_param_cb(r,a.MOUSE_DOWN_WHICH,e.mouse_down_which_cb);break;case"mouse_select":(r=a.get_device_by_type_element(a.DEVICE_MOUSE,e.element))&&a.detach_param_cb(r,a.MOUSE_DOWN_WHICH,e.mouse_select_cb);break;case"touch_select":(r=a.get_device_by_type_element(a.DEVICE_TOUCH,e.element))&&(a.detach_param_cb(r,a.TOUCH_START,e.touch_select_start_cb),a.detach_param_cb(r,a.TOUCH_END,e.touch_select_end_cb));break;case"mouse_up_which":(r=a.get_device_by_type_element(a.DEVICE_MOUSE,e.element))&&a.detach_param_cb(r,a.MOUSE_UP_WHICH,e.mouse_up_which_cb);break;case"mouse_location":(r=a.get_device_by_type_element(a.DEVICE_MOUSE,e.element))&&a.detach_param_cb(r,a.MOUSE_LOCATION,e.mouse_location_cb);break;case"mouse_pointerlock":(r=a.get_device_by_type_element(a.DEVICE_MOUSE,e.element))&&a.detach_param_cb(r,a.MOUSE_LOCATION_PL,e.pointerlock_cb);break;case"keyboard_downed_keys":(r=a.get_device_by_type_element(a.DEVICE_KEYBOARD,e.element))&&(a.detach_param_cb(r,a.KEYBOARD_DOWN,e.keyboard_down_keys_cb),a.detach_param_cb(r,a.KEYBOARD_DOWN_MODIFIED,e.keyboard_down_mod_keys_cb),a.detach_param_cb(r,a.KEYBOARD_UP,e.keyboard_up_keys_cb));break;case"touch_start":(r=a.get_device_by_type_element(a.DEVICE_TOUCH,e.element))&&a.detach_param_cb(r,a.TOUCH_START,e.touch_start_cb);break;case"touch_move":(r=a.get_device_by_type_element(a.DEVICE_TOUCH,e.element))&&a.detach_param_cb(r,a.TOUCH_MOVE,e.touch_move_cb);break;case"touch_end":var r;(r=a.get_device_by_type_element(a.DEVICE_TOUCH,e.element))&&a.detach_param_cb(r,a.TOUCH_END,e.touch_end_cb)}}function de(e,t){e.value=Number(t)}function fe(e){for(var t=e.sensors,r=e.sensor_values,_=0;_<t.length;_++)r[_]=t[_].value;return e.logic_fun(r)}function Pe(e,r,_){if(_)switch(e.type){case w:var n=Ga((u=e.source_object).render.world_tsr,p),o=Xa(u.render.world_tsr,m),i=Ue(e.trans_last,n),s=e.quat_temp;Vr(e.quat_last,s),Fr(o,s,s),mr(s,s);var E=Math.abs(2*Math.acos(s[3])),c=i/_;e.avg_linear_vel=Cn(c,e.avg_linear_vel,_,Z),e.payload[0]=c;var T=E/_;e.avg_angular_vel=Cn(T,e.avg_angular_vel,_,Z),e.payload[1]=T,de(e,e.avg_linear_vel>=e.threshold||e.avg_angular_vel>=e.rotation_threshold?1:0),he(n,e.trans_last),nr(o,e.quat_last),e.time_last=r;break;case U:n=Ga((u=e.source_object).render.world_tsr,p);var u,d=Math.abs(n[1]-e.trans_last[1])/_;e.avg_vertical_vel=Cn(d,e.avg_vertical_vel,_,Z),e.payload=d,de(e,e.avg_vertical_vel>=e.threshold?1:0),he(n,e.trans_last),e.time_last=r;break;case C:!e.do_activation&&e.period>=0&&r-e.time_last>=e.period&&(de(e,1),e.repeat?e.time_last=r:e.period=-e.period);break;case D:e.time_last||(e.time_last=r),de(e,r-e.time_last),e.time_last=r;break;case F:de(e,r);break;case k:var f=le(e.element);e.payload[0]=f.gyro_gamma_new-f.gyro_gamma_last,e.payload[1]=f.gyro_beta_new-f.gyro_beta_last,e.payload[2]=f.gyro_alpha_new-f.gyro_alpha_last;break;case K:f=le(e.element),e.payload[0]=f.gyro_gamma_new,e.payload[1]=f.gyro_beta_new,e.payload[2]=f.gyro_alpha_new;break;case B:nr((f=le(e.element)).gyro_quat,e.payload);break;case X:var P=a.get_device_by_type_element(a.DEVICE_HMD);a.get_vector_param(P,a.HMD_ORIENTATION_QUAT,e.payload);break;case H:P=a.get_device_by_type_element(a.DEVICE_HMD),a.get_vector_param(P,a.HMD_POSITION,e.payload);break;case z:P=Re(e.gamepad_id),e.value=a.get_gamepad_btn_value(P,e.key);break;case V:P=Re(e.gamepad_id),e.value=a.get_gamepad_axis_value(P,e.key);break;case j:P=Re(e.gamepad_id),a.get_gamepad_position(P,e.payload),de(e,1);break;case q:P=Re(e.gamepad_id),a.get_gamepad_orientation(P,e.payload),de(e,1);break;case Q:de(e,e.callback());break;case g:de(e,(f=le(e.element)).wheel_delta);break;case h:if(f=le(e.element),!l.ie11_edge_touchscreen_hack||f.mouse_state==re||f.mouse_state==_e){var O=f.mouse_curr_x-f.mouse_last_x,v=f.mouse_curr_y-f.mouse_last_y;switch(e.payload.coords[0]=f.mouse_curr_x,e.payload.coords[1]=f.mouse_curr_y,e.axis){case"X":de(e,O);break;case"Y":de(e,v);break;case"XY":de(e,$=Math.sqrt(O*O+v*v))}}break;case W:v=(f=le(e.element)).pointerlock_dy;var M=Cn(O=f.pointerlock_dx,0,_,Ie()),x=Cn(v,0,_,Ie());Math.abs(O)>ee||Math.abs(v)>ee?(f.pointerlock_dx-=M,f.pointerlock_dy-=x,e.payload.coords[0]=M,e.payload.coords[1]=x):(e.payload.coords[0]=0,e.payload.coords[1]=0),de(e,Math.sqrt(O*O+v*v));break;case R:de(e,(f=le(e.element)).mouse_state!=te|0),e.payload.which=f.which,e.payload.coords[0]=f.mouse_curr_x,e.payload.coords[1]=f.mouse_curr_y;break;case G:if(f=le(e.element),de(e,0),e.enable_toggle_switch)f.global_selected_obj==e.source_object&&de(e,1);else if(f.mouse_state!=te&&f.mouse_select_data.obj==e.source_object)de(e,1);else for(var y=0;y<oe;++y){var J=f.touch_select_dlist[y];if(J.touch_state!=te&&J.obj==e.source_object){de(e,1);break}}break;case N:f=le(e.element),e.payload=f.downed_keys[e.key],1==e.payload||f.downed_keys[0]&&e.key==ae?de(e,1):e.payload||de(e,0);break;case I:if(-1==(f=le(e.element)).touches_curr_x[1]&&-1==f.touches_curr_y[1]){O=f.touches_curr_x[0]-f.touches_last_x[0],v=f.touches_curr_y[0]-f.touches_last_y[0];var $=Math.sqrt(O*O+v*v);if(-1!=f.touches_last_x[1]&&-1!=f.touches_last_y[1]){var ne=f.touches_curr_x[0]-f.touches_last_x[1],ie=f.touches_curr_y[0]-f.touches_last_y[1],se=Math.sqrt(ne*ne+ie*ie);se<$&&(O=ne,v=ie,$=se)}e.payload.gesture=t.PL_SINGLE_TOUCH_MOVE}else{var Ee=A;Ee[0]=(f.touches_curr_x[0]+f.touches_curr_x[1])/2,Ee[1]=(f.touches_curr_y[0]+f.touches_curr_y[1])/2;var ce=S;ce[0]=(f.touches_last_x[0]+f.touches_last_x[1])/2,ce[1]=(f.touches_last_y[0]+f.touches_last_y[1])/2,O=Ee[0]-ce[0],v=Ee[1]-ce[1],$=Math.sqrt(O*O+v*v),e.payload.gesture=t.PL_MULTITOUCH_MOVE_PAN}switch(e.payload.coords[0]=f.touches_curr_x[0],e.payload.coords[1]=f.touches_curr_y[0],e.axis){case"X":de(e,O);break;case"Y":de(e,v);break;case"XY":de(e,$)}break;case b:var Te=(f=le(e.element)).touch_zoom_curr_dist-f.touch_zoom_last_dist;e.payload=t.PL_MULTITOUCH_MOVE_ZOOM,de(e,Te);break;case Y:if(-1!=(f=le(e.element)).touches_curr_x[1]){var ue=Math.atan2(f.touches_curr_y[0]-f.touches_curr_y[1],f.touches_curr_x[0]-f.touches_curr_x[1]);e.payload=t.PL_MULTITOUCH_MOVE_ROTATE,de(e,ue-f.touch_start_rot)}break;case L:f=le(e.element),e.payload.coords[0]=f.touches_curr_x[0],e.payload.coords[1]=f.touches_curr_y[0],de(e,f.is_touch_ended?0:1)}}function Ae(e){var _=0;switch(e.type){case t.CT_POSITIVE:_=(a=fe(e))?1:0;break;case t.CT_CONTINUOUS:var n=e.last_pulse;(a=fe(e))?(_=1,e.last_pulse=1):1==n?(_=-1,e.last_pulse=-1):_=0;break;case t.CT_TRIGGER:n=e.last_pulse,(a=fe(e))&&-1==n?(_=1,e.last_pulse=1):a||1!=n?_=0:(_=-1,e.last_pulse=-1);break;case t.CT_SHOT:n=e.last_pulse,(a=fe(e))&&-1==n?(_=1,e.last_pulse=1):a||1!=n?_=0:(_=0,e.last_pulse=-1);break;case t.CT_LEVEL:var a=fe(e);e.last_logic_result!=a?(_=1,e.last_logic_result=a):_=0;break;case t.CT_CHANGE:for(var o=e.sensors,i=e.last_sensor_values,s=0;s<o.length;s++){var E=o[s].value;_||E==i[s]||(_=1),i[s]=E}break;default:r.panic("Wrong sensor manifold type: "+e.type)}return _}function Se(e){for(var t=0;t<e.length;t++){var r=e[t];switch(r.type){case g:case h:case I:case b:case Y:case L:case C:de(r,0)}}}function pe(e){if(e.do_activation){switch(e.type){case M:s.append_collision_test(e.collision_obj,e.collision_id,e.collision_cb,e.calc_pos_norm);break;case x:s.apply_collision_impulse_test(e.col_imp_obj,e.col_imp_cb);break;case y:e.ray_test_id=s.append_ray_test(e.source_object,e.from,e.to,e.collision_id,e.ray_test_cb,!1,!1,e.calc_pos_norm,e.ign_src_rot),e.payload.ray_test_id=e.ray_test_id;break;case C:e.time_last=E.get_timeline(),e.period<0&&(e.period=-e.period);break;case N:Te(t=le(e.element),"keyboard_downed_keys");break;case g:Te(t=le(e.element),"mouse_wheel");break;case h:Te(t=le(e.element),"mouse_down_which"),Te(t,"mouse_up_which"),Te(t,"mouse_location");break;case W:Te(t=le(e.element),"mouse_pointerlock");break;case J:a.activate_pointerlock(e);break;case R:Te(t=le(e.element),"mouse_down_which"),Te(t,"mouse_up_which");break;case I:Te(t=le(e.element),"touch_start"),Te(t,"touch_move"),Te(t,"touch_end");break;case b:case Y:Te(t=le(e.element),"touch_start"),Te(t,"touch_move");break;case L:Te(t=le(e.element),"touch_start"),Te(t,"touch_end");break;case G:Te(t=le(e.element),"mouse_select"),Te(t,"touch_select"),Te(t,"touch_start"),Te(t,"touch_end"),Te(t,"mouse_down_which"),Te(t,"mouse_up_which");break;case k:case K:Te(t=le(e.element),"orientation_angles");break;case B:var t;Te(t=le(e.element),"orientation_quat");break;case z:case j:case q:a.get_device_by_type_element(0==e.gamepad_id?a.DEVICE_GAMEPAD0:1==e.gamepad_id?a.DEVICE_GAMEPAD1:2==e.gamepad_id?a.DEVICE_GAMEPAD2:a.DEVICE_GAMEPAD3)}e.do_activation=!1}}function me(e,t){var _=(e=e||u).sensor_manifolds;if(_){var n=e.sensor_manifolds_arr;if(t){var a=_[t];if(a){for(var o=a.sensors,s=0;s<o.length;s++){var E=o[s],c=Oe(E,d,f);if(1==c.length){Ne(E);var l=d.indexOf(E);l>-1?(d.splice(l,1),f.splice(l,1)):r.panic("Sensors cache is corrupted")}else c.length>1&&c.splice(c.indexOf(a),1)}delete _[t];var P=n.indexOf(a);P>-1?n.splice(P,1):r.panic("Incorrect manifolds array"),Object.getOwnPropertyNames(_).length||function(e){var t=T.indexOf(e);t>-1?T.splice(t,1):i.error("Wrong object")}(e)}}else{var A=[];for(var S in _)A.push(S);for(s=0;s<A.length;s++)me(e,A[s])}O=!0}}function Oe(e,t,r){var _=t.indexOf(e);return _>-1?r[_]:[]}function Ne(e){switch(e.type){case M:s.remove_collision_test(e.collision_obj,e.collision_id,e.collision_cb),e.do_activation=!0;break;case x:s.clear_collision_impulse_test(e.col_imp_obj),e.do_activation=!0;break;case y:s.remove_ray_test(e.ray_test_id),e.do_activation=!0;break;case C:e.do_activation=!0;break;case N:ue(t=le(e.element),"keyboard_downed_keys"),e.do_activation=!0;break;case g:ue(t=le(e.element),"mouse_wheel"),e.do_activation=!0;break;case h:ue(t=le(e.element),"mouse_down_which"),ue(t,"mouse_up_which"),ue(t,"mouse_location"),e.do_activation=!0;break;case W:ue(t=le(e.element),"mouse_pointerlock"),e.do_activation=!0;break;case R:ue(t=le(e.element),"mouse_down_which"),ue(t,"mouse_up_which"),e.do_activation=!0;break;case I:ue(t=le(e.element),"touch_start"),ue(t,"touch_move"),ue(t,"touch_end"),e.do_activation=!0;break;case b:case Y:ue(t=le(e.element),"touch_start"),ue(t,"touch_move"),e.do_activation=!0;break;case L:ue(t=le(e.element),"touch_start"),ue(t,"touch_end"),e.do_activation=!0;break;case G:ue(t=le(e.element),"mouse_select"),ue(t,"touch_select"),ue(t,"touch_start"),ue(t,"touch_end"),ue(t,"mouse_down_which"),ue(t,"mouse_up_which"),e.do_activation=!0;break;case k:case K:ue(t=le(e.element),"orientation_angles"),e.do_activation=!0;break;case B:var t;ue(t=le(e.element),"orientation_quat"),e.do_activation=!0;break;case X:case H:e.do_activation=!0}}function ge(e){var t=e[0],r=e[1],_=t.clientX-r.clientX,n=t.clientY-r.clientY;return Math.sqrt(_*_+n*n)}function Re(e){if(0==e)var t=a.get_device_by_type_element(a.DEVICE_GAMEPAD0);else t=a.get_device_by_type_element(1==e?a.DEVICE_GAMEPAD1:2==e?a.DEVICE_GAMEPAD2:a.DEVICE_GAMEPAD3);return t}function Ie(){return $*ie}t.update=function(e,t){for(var r=0;r<P.length;r++)Ee(P[r]);for(r=0;r<d.length;r++)Pe(d[r],e,t);for(r=0;r<T.length;r++)for(var _=(o=T[r]).sensor_manifolds_arr,n=0;n<_.length;n++)if((i=_[n]).update_counter!=v){i.update_counter=v;var a=Ae(i);if(a&&(O=!1,i.callback(o==u?null:o,i.id,a,i.callback_param),O)){r=-1;break}}for(r=0;r<T.length;r++){var o;for(_=(o=T[r]).sensor_manifolds_arr,n=0;n<_.length;n++){var i;Se((i=_[n]).sensors)}}for(r=0;r<P.length;r++)ce(P[r]);v++},t.create_custom_sensor=function(e){var t=se(10);return de(t,e),t},t.create_keyboard_sensor=function(e){var t=document,r=se(N,t);return r.key=e,r.do_activation=!0,r},t.create_gamepad_btn_sensor=function(e,t){var r=document,_=se(z,r);return t=t||a.get_first_gmpd_id(),_.gamepad_id=t,_.key=e,_.do_activation=!0,_},t.create_gamepad_axis_sensor=function(e,t){var r=document,_=se(V,r);return t=void 0==t?a.get_first_gmpd_id():t,_.gamepad_id=t,_.key=e,_.do_activation=!0,_},t.create_gamepad_position_sensor=function(e){var t=document,r=se(j,t);return e=void 0===e?a.get_first_gmpd_id():e,r.gamepad_id=e,r.do_activation=!0,r.payload=ve(),r},t.create_gamepad_orientation_sensor=function(e){var t=document,r=se(q,t);return e=void 0===e?a.get_first_gmpd_id():e,r.gamepad_id=e,r.do_activation=!0,r.payload=Yr(),r},t.create_collision_sensor=function(e,t,r){if(!e||!s.obj_has_physics(e))return i.error("Wrong collision object"),null;var _=se(M);return _.collision_obj=e,_.collision_id=t,_.calc_pos_norm=r,_.payload={coll_obj:null,coll_pos:r?new Float32Array(3):null,coll_norm:r?new Float32Array(3):null,coll_dist:0},_.collision_cb=function(e,t,r,n,a){de(_,e);var o=_.payload;o.coll_obj=t,_.calc_pos_norm&&(o.coll_pos.set(r),o.coll_norm.set(n),o.coll_dist=a)},_.do_activation=!0,_},t.create_collision_impulse_sensor=function(e){if(!e||!e.physics)return i.error("Wrong collision impulse object"),null;var t=se(x);return t.col_imp_obj=e,t.col_imp_cb=function(e){de(t,e)},t.do_activation=!0,t},t.create_ray_sensor=function(e,t,r,_,n,a,o){var i=se(y);return i.source_object=e,i.from=t,i.to=r,i.collision_id=_,i.is_binary_value=n,i.calc_pos_norm=a,i.ign_src_rot=o,i.payload={hit_fract:0,obj_hit:null,hit_time:0,hit_pos:new Float32Array(3),hit_norm:new Float32Array(3),ray_test_id:0},i.ray_test_cb=function(e,t,r,_,n,a){de(i,i.is_binary_value?-1==t?0:1:t),i.payload.hit_fract=t,i.payload.obj_hit=r,i.payload.hit_time=_,i.calc_pos_norm&&(i.payload.hit_pos.set(n),i.payload.hit_norm.set(a))},i.do_activation=!0,i},t.create_mouse_click_sensor=function(e){var t=se(R,e);return t.do_activation=!0,t.payload={coords:new Float32Array(2),which:null},t},t.create_mouse_wheel_sensor=function(e){var t=se(g,e);return t.do_activation=!0,t},t.create_mouse_move_sensor=function(e,t){var r=se(h,t);return r.axis=e||"XY",r.payload={coords:new Float32Array(2)},r.do_activation=!0,r},t.create_touch_move_sensor=function(e,t){var r=se(I,t);return r.axis=e||"XY",r.payload={coords:new Float32Array(2),gesture:0},r.do_activation=!0,r},t.create_touch_zoom_sensor=function(e){var t=se(b,e);return t.payload=0,t.do_activation=!0,t},t.create_touch_rotate_sensor=function(e){var t=se(Y,e);return t.payload=0,t.do_activation=!0,t},t.create_touch_click_sensor=function(e){var t=se(L,e);return t.payload={coords:new Float32Array(2)},t.do_activation=!0,t},t.create_motion_sensor=function(e,t,r){if(!e)return i.error("Wrong collision object"),null;var _=se(w);_.source_object=e;var n=Fa(e.render.world_tsr),a=Ba(e.render.world_tsr);return _.quat_temp=new Float32Array(4),_.trans_last=new Float32Array(n),_.quat_last=new Float32Array(a),_.avg_linear_vel=0,_.avg_angular_vel=0,_.threshold=t||.1,_.rotation_threshold=r||.1,_.time_last=0,_.payload=new Float32Array([0,0]),_},t.create_vertical_velocity_sensor=function(e,t){if(!e)return i.error("Wrong collision object"),null;var r=se(U);r.source_object=e;var _=Fa(e.render.world_tsr),n=Ba(e.render.world_tsr);return r.trans_last=new Float32Array(_),r.quat_last=new Float32Array(n),r.avg_vertical_vel=0,r.threshold=t||1,r.time_last=0,r.payload=0,r},t.create_timer_sensor=function(e,t){var r=se(C);return r.period=e,r.repeat=t,r.do_activation=!0,r},t.reset_timer_sensor=function(e,t,r,_){var n=(e=e||u).sensor_manifolds;if(!n||!n[t])return i.error("reset_timer_sensor(): wrong object"),null;var a=n[t].sensors[r];if(!a)return i.error("reset_timer_sensor(): sensor not found"),null;a.time_last=E.get_timeline(),a.period=_},t.create_elapsed_sensor=function(){var e=se(D);return e.time_last=0,e},t.create_gyro_delta_sensor=function(){var e=se(k,window);return e.payload=new Float32Array(3),de(e,a.get_device_by_type_element(a.DEVICE_GYRO)?1:0),e.do_activation=!0,e},t.create_gyro_angles_sensor=function(){var e=se(K,window);return e.payload=new Float32Array(3),de(e,a.get_device_by_type_element(a.DEVICE_GYRO)?1:0),e.do_activation=!0,e},t.create_gyro_quat_sensor=function(){var e=se(B,window);return e.payload=Yr(),de(e,a.get_device_by_type_element(a.DEVICE_GYRO)?1:0),e.do_activation=!0,e},t.create_hmd_quat_sensor=function(){var e=se(X,window);return e.payload=Yr(),de(e,a.get_device_by_type_element(a.DEVICE_HMD)?1:0),e.do_activation=!0,e},t.create_hmd_position_sensor=function(){var e=se(H,window);return e.payload=ve(),de(e,a.get_device_by_type_element(a.DEVICE_HMD)?1:0),e.do_activation=!0,e},t.create_timeline_sensor=function(){return se(F)},t.create_selection_sensor=function(e,t){var r=se(G);return r.source_object=e,r.enable_toggle_switch=t,r.do_activation=!0,r},t.create_callback_sensor=function(e,t){var r=se(Q);return r.callback=e,de(r,t),r},t.create_plock_mouse_sensor=function(e){var t=se(W,e);return t.payload={coords:new Float32Array(2)},t.do_activation=!0,t},t.create_plock_sensor=function(e){var t=se(J,e);return t.do_activation=!0,t},t.sensor_set_value=de,t.get_sensor_value=function(e,t,r){var _=(e=e||u).sensor_manifolds;if(!_||!_[t])return i.error("get_sensor_value(): wrong object"),null;var n=_[t].sensors[r];return n?n.value:(i.error("get_sensor_value(): sensor not found"),null)},t.get_sensor_payload=function(e,t,r){var _=(e=e||u).sensor_manifolds;if(!_||!_[t])return i.error("get_sensor_payload(): wrong object"),null;var n=_[t].sensors[r];return n?n.payload:(i.error("get_sensor_payload(): sensor not found"),null)},t.cleanup=function(){T=[],u={};for(var e=0;e<d.length;e++)Ne(d[e]);d.length=0,f.length=0},t.check_sensor_manifold=function(e,t){if(!(e=e||u).sensor_manifolds)return!1;if(t&&e.sensor_manifolds[t])return!0;if(t)return!1;for(var r in e.sensor_manifolds)return!0;return!1},t.create_sensor_manifold=function(e,t,r,_,n,a,o){(e=e||u).sensor_manifolds_arr=e.sensor_manifolds_arr||[],e.sensor_manifolds=e.sensor_manifolds||{};var i=e.sensor_manifolds,s=e.sensor_manifolds_arr;i[t]&&me(e,t);var E={id:t,type:r,sensors:_.slice(0),logic_fun:n,sensor_values:new Array(_.length),callback:a,callback_param:o,last_pulse:-1,last_logic_result:0,last_sensor_values:new Array(_.length),update_counter:-1};i[t]=E,s.push(E),-1==T.indexOf(e)&&T.push(e);for(var c=0;c<E.sensors.length;c++){var l=E.sensors[c];pe(l);var P=d.indexOf(l);-1==P?(d.push(l),f.push([E])):f[P].push(E)}O=!0},t.default_AND_logic_fun=function(e){for(var t=0;t<e.length;t++)if(!e[t])return e[t];return e[e.length-1]},t.default_OR_logic_fun=function(e){for(var t=0;t<e.length;t++)if(e[t])return e[t];return e[e.length-1]},t.remove_sensor_manifold=me,t.reset=function(){for(var e=0;e<T.length;e++){var t=T[e],r=t.sensor_manifolds,_=t.sensor_manifolds_arr;for(var n in r)delete r[n];_.length=0}for(e=0;e<d.length;e++)Ne(d[e]);T.length=0,d.length=0,f.length=0},t.debug=function(){i.log(String(T.length)+" objects with manifolds",T),i.log(String(d.length)+" sensors",d);for(var e=[],t=[],r=0;r<d.length;r++){var _=d[r];_.type==M&&e.push(_),_.type==y&&t.push(_)}i.log(String(e.length)+" collision sensors",e),i.log(String(t.length)+" ray sensors",t)},t.set_plock_smooth_factor=function(e){ie=e}}),Hs=A("__loader",function(e,t){var r=$o(e),_=ga(e),n=Wo(e).defaults,a=3,o=4,i=0,s=1,E=2,c=3,l="color: #f0f;";t.SYNC_PRIORITY=0,t.ASYNC_PRIORITY=1,t.FINISH_PRIORITY=2;var T=null;function u(){return T}function d(e){T=e}function f(e){return e.background_loading=e.background_loading||!1,e.priority||0===e.priority||(e.priority=e.SYNC_PRIORITY),e.inputs=e.inputs||[],e.is_finished=e.is_finished||!1,e.skip=e.skip||!1,e.relative_size=e.relative_size||0,e.is_resource=e.is_resource||!1,e.primary_only=e.primary_only||!1,e.status=i,e.loop_index=0,e.load_rate=0,e.cb_param=e.cb_param||null,e}function P(e,t,r){if(t.complete_load_cb(r,t),t.status=a,e.active_threads--,n.debug_loading){var o=Math.round(performance.now()-t.time_load_start);_.log("%cTHREAD "+t.id+": 100% LOADING END "+o+"ms",l)}!function(e){e.stageload_cb=null,e.complete_load_cb=null,n.debug_loading||(e.stage_graph=null),e.stages_queue=null}(t)}function A(e,_){var n=e.stages_queue.length;do{var a=r.get_node_attr(e.stage_graph,e.stages_queue[0]),o=m(e,a,_);a.priority==t.ASYNC_PRIORITY&&(e.reset_time_cycle=!0);var i=e.stages_queue.shift();e.stages_queue.push(i),n--}while(!o&&0!=n)}function S(e,t){for(var _=[],n=[],a=0;a<t.length;a++){var o=t[a];r.get_node_attr(e.stage_graph,o).is_finished&&(r.traverse_outputs(e.stage_graph,o,function(n,a,o){var i=!0;r.traverse_inputs(e.stage_graph,n,function(e,t,r){if(!t.is_finished)return i=!1,1}),i&&-1==_.indexOf(n)&&-1==t.indexOf(n)&&_.push(n)}),n.push(a))}for(a=n.length-1;a>=0;a--)t.splice(n[a],1);return _}function p(e){var t=[],_=e.stages_queue,n=!1;do{var a=S(e,_);t.push.apply(t,_),a.length>0&&(n=!0),_=a}while(a.length>0);return n&&t.sort(function(t,_){var n=r.get_node_attr(e.stage_graph,t),a=r.get_node_attr(e.stage_graph,_),o=a.priority-n.priority;return 0==o&&(o=n.background_loading-a.background_loading),o}),e.stages_queue=t,e.stages_queue.length}function m(e,t,r){if(t.skip)return t.is_finished=!0,n.debug_loading&&_.log("%cTHREAD "+e.id+": SKIP STAGE "+t.name,l),N(e,t),!1;if(n.debug_loading&&t.status==i){var a=O(e),o="LOADING START "+t.name,c=Math.round(performance.now()-e.time_load_start);_.log("%cTHREAD "+e.id+": "+a+"% "+o+" "+c+"ms ",l)}if(!t.cb_before&&!t.cb_loop&&!t.cb_after)return N(e,t),!1;if(t.status==i&&(t.status++,t.cb_before))return t.cb_before(r,e,t,t.cb_param,N,g),!0;if(t.status==s){if(t.cb_loop)return t.cb_loop(r,e,t,t.cb_param,N,g),!0;t.status++}return!(t.status!=E||(t.status++,!t.cb_after)||(t.cb_after(r,e,t,t.cb_param,N,g),0))}function O(e){if(0==e.stages_size_total)return 100;var t=0;return r.traverse(e.stage_graph,function(r,_){v(e,_)&&(t+=_.load_rate*_.relative_size)}),Rn(100*t/e.stages_size_total)}function v(e,t){return!(e.do_not_load_resources&&t.is_resource)}function N(e,t){if(t.is_finished=!0,t.status=c,h(e,t,1),n.debug_loading){var r=O(e),a="LOADING END "+t.name,o=Math.round(performance.now()-e.time_load_start);_.log("%cTHREAD "+e.id+": "+r+"% "+a+" "+o+"ms ",l)}}function g(e,t,r){r<1?h(e,t,r):t.status++}function h(e,t,r){var _=u();if(t.cb_before||t.cb_loop||t.cb_after){t.load_rate=r;var n=O(e);e.curr_percents==n&&1!=r||(e.stageload_cb(n,performance.now()-e.time_load_start,e.id),e.curr_percents=n,_.make_idle_iteration=!0)}}function R(e){e.skip=!0}function I(){return 0==u().active_threads}function b(e){return e&&(e.status==a||e.status==o)}t.get_scheduler=u,t.create_scheduler=function(){var e={threads:[],current_thread_index:0,active_threads:0,start_secondary_threads:!1,make_idle_iteration:!1};return d(e),e},t.create_thread=function(e,n,a,o,i,s,E,c,T){var d=u(),P=d.threads.length,A={id:P,is_primary:0==P,status:0,filepath:n,binary_name:"",loaded_cb:a||function(){},load_hidden:c||!1,wait_complete_loading:s,time_load_start:0,curr_percents:0,stages_size_total:0,reset_time_cycle:!1,stageload_cb:o||function(){},complete_load_cb:i||function(){},stage_graph:null,stages_queue:null,has_video_textures:!1,has_background_music:!1,init_wa_context:!1,is_preloading:T},S=function(e,n,a,o){var i=u(),s=r.create();for(var E in n){var c=f(n[E]);(o&&c.is_resource||!e&&c.primary_only)&&R(c),r.append_node_attr(s,c)}for(var E in n){(c=n[E]).name=E;for(var T=0;T<c.inputs.length;T++)r.append_edge_attr(s,n[c.inputs[T]],c,null)}var d=f({name:"out",priority:t.FINISH_PRIORITY,cb_before:function(e,t,r,n,a,o){t.is_primary&&(i.start_secondary_threads=!0),b(t)||(t.status=2),t.loaded_cb(t.id,!0),a(t,r),_.log("%cTHREAD "+t.id+": LOADED CALLBACK",l)},relative_size:5});if(a)var P=r.get_sink_nodes(s);else{var A,S=r.clone(s);do{for(P=r.get_sink_nodes(S),A=[],T=0;T<P.length;T++)(m=r.get_node_attr(S,p=P[T])).background_loading&&A.push(p);for(T=0;T<A.length;T++)r.remove_node(S,A[T]);A.length&&r.cleanup_loose_edges(S)}while(A.length)}for(r.append_node_attr(s,d),T=0;T<P.length;T++){var p,m=r.get_node_attr(s,p=P[T]);d.inputs.push(m.name),r.append_edge_attr(s,m,d,null)}return s}(A.is_primary,e,s,E);A.stage_graph=S;for(var p=[],m=r.get_source_nodes(S),O=0;O<m.length;O++)p.push(m[O]);return A.stages_queue=p,r.traverse(S,function(e,t){(t.cb_before||t.cb_loop||t.cb_after)&&v(A,t)&&(A.stages_size_total+=t.relative_size)}),d.threads.push(A),d.active_threads++,A.id},t.update_scheduler=function(e){var t=u();if(t&&!I())if(t.make_idle_iteration)t.make_idle_iteration=!1;else{var r=performance.now();do{var a=t.threads[t.current_thread_index],o=e[a.id];if(b(a)||(0==a.status&&(a.status=1,a.time_load_start=performance.now(),a.stageload_cb(0,0,a.id),n.debug_loading&&_.log("%cTHREAD "+a.id+": 0% LOADING START 0ms",l)),p(a)?A(a,o):P(t,a,o)),t.start_secondary_threads&&(t.current_thread_index=(t.current_thread_index+1)%t.threads.length),a.reset_time_cycle)return void(a.reset_time_cycle=!1)}while(performance.now()-r<16)}},t.abort_thread=function(e){var t=u();P(t,e,null),e.status=o,e.is_primary&&(t.start_secondary_threads=!0),e.loaded_cb(e.id,!1)},t.stage_part_finish_cb=g,t.skip_stage_by_name=function(e,t){var _=function(e,t){var _=null;return r.traverse(e.stage_graph,function(e,r){if(r.name==t)return _=r,1}),_}(e,t);null!==_&&R(_)},t.is_finished=I,t.thread_is_finished=b,t.is_primary_loaded=function(e){var t=u();return!!t&&t.threads[e|=0]&&(t.threads[e].status==a||2==t.threads[e].status)},t.graph_to_dot=function(e){if(n.debug_loading){var a=u();return a&&a.threads[e]&&a.threads[e].stage_graph?r.debug_dot(a.threads[e].stage_graph,function(e,r){if(r.skip)return"SKIPPED\n("+r.name+")";var _=r.name+"\n",n=[];return n.push(r.priority==t.ASYNC_PRIORITY?"ASYNC":"SYNC"),r.background_loading&&n.push("BKG"),r.is_resource&&n.push("RES"),_+n.join(" | ")},null):null}_.error("Debug mode isn't enabled. Can not retrieve the graph.")},t.cleanup=function(){d(null)}});function Qs(e,t){var r=e[0],_=e[1],n=e[2],a=e[3];_=Ws(_=Ws(_=Ws(_=Ws(_=qs(_=qs(_=qs(_=qs(_=js(_=js(_=js(_=js(_=Vs(_=Vs(_=Vs(_=Vs(_,n=Vs(n,a=Vs(a,r=Vs(r,_,n,a,t[0],7,-680876936),_,n,t[1],12,-389564586),r,_,t[2],17,606105819),a,r,t[3],22,-1044525330),n=Vs(n,a=Vs(a,r=Vs(r,_,n,a,t[4],7,-176418897),_,n,t[5],12,1200080426),r,_,t[6],17,-1473231341),a,r,t[7],22,-45705983),n=Vs(n,a=Vs(a,r=Vs(r,_,n,a,t[8],7,1770035416),_,n,t[9],12,-1958414417),r,_,t[10],17,-42063),a,r,t[11],22,-1990404162),n=Vs(n,a=Vs(a,r=Vs(r,_,n,a,t[12],7,1804603682),_,n,t[13],12,-40341101),r,_,t[14],17,-1502002290),a,r,t[15],22,1236535329),n=js(n,a=js(a,r=js(r,_,n,a,t[1],5,-165796510),_,n,t[6],9,-1069501632),r,_,t[11],14,643717713),a,r,t[0],20,-373897302),n=js(n,a=js(a,r=js(r,_,n,a,t[5],5,-701558691),_,n,t[10],9,38016083),r,_,t[15],14,-660478335),a,r,t[4],20,-405537848),n=js(n,a=js(a,r=js(r,_,n,a,t[9],5,568446438),_,n,t[14],9,-1019803690),r,_,t[3],14,-187363961),a,r,t[8],20,1163531501),n=js(n,a=js(a,r=js(r,_,n,a,t[13],5,-1444681467),_,n,t[2],9,-51403784),r,_,t[7],14,1735328473),a,r,t[12],20,-1926607734),n=qs(n,a=qs(a,r=qs(r,_,n,a,t[5],4,-378558),_,n,t[8],11,-2022574463),r,_,t[11],16,1839030562),a,r,t[14],23,-35309556),n=qs(n,a=qs(a,r=qs(r,_,n,a,t[1],4,-1530992060),_,n,t[4],11,1272893353),r,_,t[7],16,-155497632),a,r,t[10],23,-1094730640),n=qs(n,a=qs(a,r=qs(r,_,n,a,t[13],4,681279174),_,n,t[0],11,-358537222),r,_,t[3],16,-722521979),a,r,t[6],23,76029189),n=qs(n,a=qs(a,r=qs(r,_,n,a,t[9],4,-640364487),_,n,t[12],11,-421815835),r,_,t[15],16,530742520),a,r,t[2],23,-995338651),n=Ws(n,a=Ws(a,r=Ws(r,_,n,a,t[0],6,-198630844),_,n,t[7],10,1126891415),r,_,t[14],15,-1416354905),a,r,t[5],21,-57434055),n=Ws(n,a=Ws(a,r=Ws(r,_,n,a,t[12],6,1700485571),_,n,t[3],10,-1894986606),r,_,t[10],15,-1051523),a,r,t[1],21,-2054922799),n=Ws(n,a=Ws(a,r=Ws(r,_,n,a,t[8],6,1873313359),_,n,t[15],10,-30611744),r,_,t[6],15,-1560198380),a,r,t[13],21,1309151649),n=Ws(n,a=Ws(a,r=Ws(r,_,n,a,t[4],6,-145523070),_,n,t[11],10,-1120210379),r,_,t[2],15,718787259),a,r,t[9],21,-343485551),e[0]=eE(r,e[0]),e[1]=eE(_,e[1]),e[2]=eE(n,e[2]),e[3]=eE(a,e[3])}function zs(e,t,r,_,n,a){return eE((t=eE(eE(t,e),eE(_,a)))<<n|t>>>32-n,r)}function Vs(e,t,r,_,n,a,o){return zs(t&r|~t&_,e,t,n,a,o)}function js(e,t,r,_,n,a,o){return zs(t&_|r&~_,e,t,n,a,o)}function qs(e,t,r,_,n,a,o){return zs(t^r^_,e,t,n,a,o)}function Ws(e,t,r,_,n,a,o){return zs(r^(t|~_),e,t,n,a,o)}function Js(e){var t,r=[];for(t=0;t<64;t+=4)r[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return r}var Zs="0123456789abcdef".split("");function $s(e){for(var t="",r=0;r<4;r++)t+=Zs[e>>8*r+4&15]+Zs[e>>8*r&15];return t}function eE(e,t){return e+t&4294967295}function tE(e){return function(e){for(var t=0;t<e.length;t++)e[t]=$s(e[t]);return e.join("")}(function(e){var t,r=e.length,_=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=e.length;t+=64)Qs(_,Js(e.substring(t-64,t)));e=e.substring(t-64);var n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<e.length;t++)n[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(n[t>>2]|=128<<(t%4<<3),t>55)for(Qs(_,n),t=0;t<16;t++)n[t]=0;return n[14]=8*r,Qs(_,n),_}(e))}var rE=A("__logic_nodes",function(e,t){var r=gs(e),_=ha(e),n=Ds(e),a=oE(e),o=Ls(e),i=Ms(e),s=ga(e),E=ps(e),c=Wo(e),l=Xs(e),T=Ks(e),u=wi(e),d=Ns(e),f=Ss(e),P=ri(e),A=Os(e),S=os(e),p=new Float32Array(4),O=new Float32Array(3),v=new Float32Array(3),N=new Float32Array(2),g=new Float32Array(9),h=new Float32Array(16),R=1,I=2,b=-1,Y=0,L=1,M=2;t.NT_NUMBER=Y,t.NT_STRING=L,t.NT_OBJECT=M,t.NMO_DIV=0,t.NMO_SUB=1,t.NMO_MUL=2,t.NMO_ADD=3,t.NMO_RAND=4,t.NMO_SIN=5,t.NMO_COS=6,t.NMO_TAN=7,t.NMO_ARCSIN=8,t.NMO_ARCCOS=9,t.NMO_ARCTAN=10,t.NMO_LOG=11,t.NMO_MIN=12,t.NMO_MAX=13,t.NMO_ROUND=14,t.NMO_MOD=15,t.NMO_ABS=16,t.NSO_JOIN=0,t.NSO_FIND=1,t.NSO_REPLACE=2,t.NSO_SPLIT=3,t.NSO_COMPARE=4,t.NC_GEQUAL=0,t.NC_LEQUAL=1,t.NC_GREATER=2,t.NC_LESS=3,t.NC_NOTEQUAL=4,t.NC_EQUAL=5;var x=0;t.NST_WORLD=x,t.NST_PARENT=1,t.NST_LOCAL=2,t.NCMS_STATIC=0,t.NCMS_TARGET=1,t.NCMS_EYE=2,t.NCMS_HOVER=3,t.NCPT_OBJECT=0,t.NCPT_VARIABLE=1;var y={ENTRYPOINT:function(e,t,r,_,n,a){switch(t.state){case I:r.callstack.push({caller_node:null,variables:r.variables,logic_func:null}),r.curr_node=e.slot_idx_order}},HIDE:function(e,t,r,_,n,a){var o=e.bools.id0;switch(t.state){case R:break;case I:var c=F(e,r,function(e,t,r){o||(t.obj=i.get_object(i.GET_OBJECT_BY_DUPLI_NAME_LIST,e.objects_paths.id0,0),t.obj||(s.error("Logic script error: object not found. Node: ",e.name),e.mute=!0))}),l=o?G(e.vars.id0,t.variables,r.variables):c.obj;e.bools.ch?E.change_visibility_rec(l,!0):E.change_visibility(l,!0),r.curr_node=e.slot_idx_order}},SHOW:function(e,t,r,_,n,a){var o=e.bools.id0;switch(t.state){case R:break;case I:var c=F(e,r,function(e,t,r){o||(t.obj=i.get_object(i.GET_OBJECT_BY_DUPLI_NAME_LIST,e.objects_paths.id0,0),t.obj||(s.error("Logic script error: object not found. Node: ",e.name),e.mute=!0))}),l=o?G(e.vars.id0,t.variables,r.variables):c.obj;e.bools.ch?E.change_visibility_rec(l,!1):E.change_visibility(l,!1),r.curr_node=e.slot_idx_order}},PAGEPARAM:function(e,t,r,_,n,a){switch(t.state){case I:k(e.vars.vd,t.variables,r.variables,function(e,t,r){var _=c.get("url_params");if(_&&e in _)return Number(_[e]);var n=r?location.hash:location.search;if(!n)return 0;for(var a=n.slice(1).split("&"),o=0;o<a.length;o++){var i=a[o].split("=");if(i.length>1&&i[0]==e)return W(i[1],t)}return 0}(e.param_name,e.floats.ptp,e.bools.hsh)),r.curr_node=e.slot_idx_order}},SWITCH_SELECT:function(e,t,r,_,n,a){switch(t.state){case R:break;case I:var o=F(e,r,function(e,t,r){t.state=-3});if(-3==o.state)o.state=-2,function(e,t){for(var r=e.nodes,_=0;_<r.length;_++){var n=r[_];"SWITCH_SELECT"==n.type&&n!=t&&(F(n,e.thread_state).state=-3)}}(t.logic_threads[r.thread_index],e),function(e,t,r){var _=i.get_selectable_objects(),n=F(e,r.thread_state);for(var a in n.sel_obj_idxs=[],n.links_idxs=[],e.objects_paths){var o=e.bools[a]?G(e.vars[a],t.variables,r.thread_state.variables):i.get_object(i.GET_OBJECT_BY_DUPLI_NAME_LIST,e.objects_paths[a],0),E=_.indexOf(o);if(-1==E)return s.error("logic script error: non-selectable object:",e.objects_paths[a][e.objects_paths[a].length-1]),-1;n.sel_obj_idxs.push(E),n.links_idxs.push(e.links_dict[a])}n.sel_objs_len=_.length;for(var c=[],T=0;T<_.length;T++)c.push(l.create_selection_sensor(_[T],!1));var u=Q();l.create_sensor_manifold(null,"LOGIC_NODES_SWITCH_SELECT_"+Z(e.label),l.CT_SHOT,c,l.default_OR_logic_fun,u,[e,t,r])}(e,t,t.logic_threads[r.thread_index]);else if(-2==o.state)o.state=-1;else if(0==o.state||1==o.state){if(e.vars.vd&&e.vars.vd[1]){var E=i.get_selectable_objects();k(e.vars.vd,t.variables,r.variables,E[o.select_object_idx])}r.curr_node=o.state?o.slot_idx_jump:e.slot_idx_order,o.state=-3,l.remove_sensor_manifold(null,"LOGIC_NODES_SWITCH_SELECT_"+Z(e.label));break}}},SELECT:function(e,t,r,_,n,a){switch(t.state){case R:s.error("Logic script error: node is deprecated. Node: ",e.name),e.mute=!0}},PLAY:function(e,t,r,n,a,i){switch(t.state){case R:o.stop_nla(),e.bools.not_wait||(e.bools.not_wait=!1);break;case I:var s=F(e,r);switch(s.state){case b:if(o.is_play(t._nla)){if(t.curr_thread==t.nla_thread&&r.in_progress)break;var E=t.nla_thread;if(E){var c=j(E);E.thread_state.curr_node=c[E.thread_state.curr_node].slot_idx_order,function(e){var t=e.thread_state.callstack,r=t.length,_=[];r<=1&&_.push(e.nodes);for(var n=1;n<r;n++)_.push(t[n].logic_func.func.nodes);for(n=0;n<_.length;n++)for(var a=0;a<_[n].length;a++){var o=_[n][a];"PLAY"==o.type&&(F(o,e.thread_state).state=b)}}(t.nla_thread)}}if(r.in_progress=!e.bools.not_wait,t.nla_thread=t.curr_thread,s.state=0,e.frame_start_mask&&(o.set_range_start(e.frame_start),o.set_offset_from_range_start(n)),e.frame_end_mask)o.set_range_end(e.frame_end);else{var l=o.get_frame(n),T=-1;for(var u in t.sorted_markers_values)if(l<t.sorted_markers_values[u]){T=u;break}o.set_range_end(T>=0?t.sorted_markers_values[T]:o.get_frame_end())}o.play_nla(null),e.bools.not_wait&&(r.curr_node=e.slot_idx_order,s.state=b,r.in_progress=!1);break;case 0:o.is_play()||(r.curr_node=e.slot_idx_order,s.state=b,r.in_progress=!1);break;case 1:r.curr_node=e.slot_idx_order,s.state=b,t.nla_thread=null,r.in_progress=!1;break;default:_.panic("Unknown state of "+e.name),s.state=b}}},REDIRECT:function(e,t,r,_,n,a){switch(t.state){case I:var o=e.bools.url?W(G(e.vars.url,t.variables,r.variables),L):e.strings.url;window.location.href=o,t.state=3}},MATH:function(e,t,r,n,a,o){switch(t.state){case I:var i=-1==e.vars.id0[1]?e.floats.inp1:W(G(e.vars.id0,t.variables,r.variables),Y),s=-1==e.vars.id1[1]?e.floats.inp2:W(G(e.vars.id1,t.variables,r.variables),Y),E=0;switch(e.op){case 3:E=i+s;break;case 2:E=i*s;break;case 1:E=i-s;break;case 0:0==s&&_.panic("Division by zero in Logic script"),E=i/s;break;case 4:E=Math.random()*(s-i)+i;break;case 5:E=Math.sin(i);break;case 6:E=Math.cos(i);break;case 7:E=Math.tan(i);break;case 8:E=Math.asin(i);break;case 9:E=Math.acos(i);break;case 10:E=Math.atan(i);break;case 11:E=Math.log(i);break;case 12:E=Math.min(i,s);break;case 13:E=Math.max(i,s);break;case 14:E=Math.round(i);break;case 15:E=i%s;break;case 16:E=Math.abs(i)}k(e.vars.vd,t.variables,r.variables,E),r.curr_node=e.slot_idx_order}},CONDJUMP:function(e,t,r,_,n,a){switch(t.state){case I:var o=e.common_usage_names.variable_type,s=$(e,o),E=!1;if(o==M){var c=e.bools.id0?G(e.vars.id0,t.variables,r.variables):i.get_object(i.GET_OBJECT_BY_DUPLI_NAME_LIST,e.objects_paths.id0,0),l=e.bools.id1?G(e.vars.id1,t.variables,r.variables):i.get_object(i.GET_OBJECT_BY_DUPLI_NAME_LIST,e.objects_paths.id1,0);switch(e.common_usage_names.condition){case 5:c==l&&(E=!0);break;case 4:c!=l&&(E=!0)}}else switch(c=-1==e.vars.id0[1]?s.inp1:W(G(e.vars.id0,t.variables,r.variables),o),l=-1==e.vars.id1[1]?s.inp2:W(G(e.vars.id1,t.variables,r.variables),o),e.common_usage_names.condition){case 5:c==l&&(E=!0);break;case 4:c!=l&&(E=!0);break;case 3:c<l&&(E=!0);break;case 2:c>l&&(E=!0);break;case 1:c<=l&&(E=!0);break;case 0:c>=l&&(E=!0)}r.curr_node=E?e.slot_idx_jump:e.slot_idx_order}},REGSTORE:function(e,t,r,_,n,a){switch(t.state){case I:if(e.bools.vs)var o=G(e.vars.vs,t.variables,r.variables);else{var s=e.common_usage_names.variable_type,E=$(e,s);o=s==M?i.get_object(i.GET_OBJECT_BY_DUPLI_NAME_LIST,E.id0,0):E.inp1}k([e.bools.new&&e.bools.gl||e.vars.vd[0],e.vars.vd[1]],t.variables,r.variables,o),r.curr_node=e.slot_idx_order}},PLAY_ANIM:function(e,t,n,a,o,i){var E=e.bools.id0,c=e.bools.env;switch(t.state){case R:break;case I:var l=F(e,n,function(e,r,_){r.obj=c?H(e):z(e,"id0",E,t.variables,_.variables),r.obj||E||(s.error("Logic script error: object not found. Node: ",e.name),e.mute=!0)});switch(c||(l.obj=E?G(e.vars.id0,t.variables,n.variables):l.obj),0!=l.state||r.is_play(l.obj,l.anim_slot)||(l.state=1),l.state){case b:for(var T in t.logic_threads){var u=t.logic_threads[T],d=j(u),f=u.thread_state.curr_node;if(-1!=f){var P=d[f],A=F(P,u.thread_state);"PLAY_ANIM"==P.type&&P!=e&&0==A.state&&A.obj==l.obj&&(A.state=1)}}var S=e.common_usage_names.param_anim_behavior;if(""==e.anim_name)r.apply_def(l.obj),r.set_behavior(l.obj,S,r.SLOT_ALL);else{var p=function(e,t){for(var _=-1,n=0;n<8;n++){var a=e.anim_slots[n];if(a&&a.animation_name&&r.strip_baked_suffix(a.animation_name)==r.strip_baked_suffix(t)){if(-1==_)return-1;_=n}}return _}(l.obj,e.anim_name);-1==p?(l.anim_slot=r.slot_by_anim_type(l.obj,e.anim_name),r.apply(l.obj,null,e.anim_name,l.anim_slot)):l.anim_slot=p,r.set_behavior(l.obj,S,l.anim_slot)}e.bools.not_wait||(n.in_progress=!0),r.play(l.obj,null,l.anim_slot),l.state=0,e.bools.not_wait&&(n.curr_node=e.slot_idx_order,l.state=b);break;case 0:break;case 1:e.bools.not_wait||(n.in_progress=!1),n.curr_node=e.slot_idx_order,l.state=b;break;default:_.panic("Unknown state of "+e.name),l.state=b}}},SELECT_PLAY:K,SEND_REQ:function(e,t,r,_,a,o){var i=F(e,r);function s(e,r,_,n,a){var o=JSON.stringify(e),i=a[1],s=F(a[0],i);k(a[0].vars.dst,t.variables,i.variables,o),s.state=1}switch(t.state){case I:switch(i.state){case-1:i.state=0;var E=e.bools.url?W(G(e.vars.url,t.variables,r.variables),L):e.strings.url,c={};if(e.bools.ct&&(c["Content-Type"]=e.strings.ct),"GET"==e.common_usage_names.request_type)n.enqueue([{id:E,type:n.AT_JSON,url:E,overwrite_header:c,param:[e,r]}],s,null,null,null);else if("POST"==e.common_usage_names.request_type){var l=W(G(e.vars.dst1,t.variables,r.variables),L);n.enqueue([{id:E,type:n.AT_JSON,url:E,overwrite_header:c,request_method:"POST",post_data:l,param:[e,r]}],s,null,null,null)}break;case 0:break;case 1:i.state=-1,r.curr_node=e.slot_idx_order}}},INHERIT_MAT:function(e,t,r,_,n,a){switch(t.state){case R:break;case I:var o=F(e,r,function(e,t,r){for(var _=0;_<2;_++)t.objects["id"+_]=i.get_object(i.GET_OBJECT_BY_DUPLI_NAME_LIST,e.objects_paths["id"+_],0),t.objects["id"+_]||(s.error("Logic script error: object not found. Node: ",e.name),e.mute=!0)});i.inherit_material(o.objects.id0,e.materials_names.id0,o.objects.id1,e.materials_names.id1),r.curr_node=e.slot_idx_order}},SET_SHADER_NODE_PARAM:function(e,t,r,_,n,a){switch(t.state){case R:break;case I:var o=F(e,r,function(e,t,r){e.objects_paths.id0&&(t.objects.id0=i.get_object(i.GET_OBJECT_BY_DUPLI_NAME_LIST,e.objects_paths.id0,0),e.objects_paths.id0||(s.error("Logic script error: object not found. Node: ",e.name),e.mute=!0),e.nodes_paths.id0.unshift(e.materials_names.id0))}).objects.id0,E=e.nodes_paths.id0,c=E[0],l=T.name_list_to_node_name(E,1),u=T.find_batch_material(o,c,"MAIN");if(r.curr_node=e.slot_idx_order,null===u)return void s.error('Material "'+c+'" was not found in the object "'+o.name+'".');"ShaderNodeRGB"==e.shader_nd_type&&i.set_nodemat_rgb(o,c,l,e.bools.id0?W(G(e.vars.id0,t.variables,r.variables),Y):e.floats.id0,e.bools.id1?W(G(e.vars.id1,t.variables,r.variables),Y):e.floats.id1,e.bools.id2?W(G(e.vars.id2,t.variables,r.variables),Y):e.floats.id2),"ShaderNodeValue"==e.shader_nd_type&&i.set_nodemat_value(o,c,l,e.bools.id0?W(G(e.vars.id0,t.variables,r.variables),Y):e.floats.id0)}},DELAY:function(e,t,r,_,n,a){var o=F(e,r);switch(t.state){case R:break;case I:if(o.state==b)return o.state=0,o.timer=0,void(r.in_progress=!0);0==o.state&&(o.timer+=n,(e.bools.dl?W(G(e.vars.dl,t.variables,r.variables),Y):e.floats.dl)<o.timer&&(o.state=b,r.curr_node=e.slot_idx_order,r.in_progress=!1))}},APPLY_SHAPE_KEY:function(e,t,r,_,n,a){switch(t.state){case R:break;case I:var o=F(e,r,function(e,t,r){var _=t.objects.id0=i.get_object(i.GET_OBJECT_BY_DUPLI_NAME_LIST,e.objects_paths.id0,0);_||(s.error("Logic script error: object not found. Node: ",e.name),e.mute=!0);var n=e.common_usage_names.sk;u.check_shape_keys(_)?u.has_shape_key(_,n)||(s.error("Wrong key name:",n),e.mute=!0):(s.error("No shape keys in object:",_.name),e.mute=!0)});u.apply_shape_key(o.objects.id0,e.common_usage_names.sk,e.bools.skv?W(G(e.vars.skv,t.variables,r.variables),Y):e.floats.skv),r.curr_node=e.slot_idx_order}},OUTLINE:function(e,t,r,_,n,a){var o=e.bools.id0;switch(t.state){case R:break;case I:var E=F(e,r,function(e,t,r){o||(t.obj=i.get_object(i.GET_OBJECT_BY_DUPLI_NAME_LIST,e.objects_paths.id0,0),t.obj||(s.error("Logic script error: object not found. Node: ",e.name),e.mute=!0),t.obj&&t.obj.render&&t.obj.render.outlining||(s.error("Can't evaluate 'Outline' logic node: wrong object"),e.mute=!0))}),c=o?G(e.vars.id0,t.variables,r.variables):E.obj;switch(e.common_usage_names.outline_operation){case"PLAY":var l=c.render.outline_anim_settings_default;i.apply_outline_anim(c,l.outline_duration,l.outline_period,l.outline_relapses);break;case"STOP":i.clear_outline_anim(c);break;case"INTENSITY":i.set_outline_intensity(c,e.bools.in?W(G(e.vars.in,t.variables,r.variables),Y):e.floats.in)}r.curr_node=e.slot_idx_order}},MOVE_CAMERA:function(e,t,r,_,n,o){function i(e,t,r,_){switch(a.get_move_style(e)){case a.MS_TARGET_CONTROLS:a.set_trans_pivot(e,t,r);break;case a.MS_EYE_CONTROLS:case a.MS_STATIC:A.set_tsr(e,_);break;case a.MS_HOVER_CONTROLS:be(r,t,O),Ke(O,O),a.set_hover_pivot(e,r);var n,o=0;v[0]=O[0],v[1]=0,v[2]=O[2];var i=Be(v,O);n=Math.acos(i/(De(v)*De(O))),o=O[2]?Math.atan(O[0]/O[2]):O[0]>0?0:Math.PI,O[2]>0&&O[0]>0?N[1]=-(Math.PI+N[1]):O[2]>0&&O[0]<0?N[1]=-(Math.PI+N[1]):O[2]<0&&O[0]<0?(N[0]+=Math.PI,o=-(Math.PI-o)):O[2]<0&&O[0]>0&&(N[0]+=Math.PI,o-=Math.PI),a.set_rotation_hover_angles(e,o+Math.PI,-n)}A.update_transform(e),d.sync_transform(e)}function c(e,t,r,_){Ae(t,r,S_,h),V(h,h);var n=g;m(h,n),qr(n,p),mr(p,p),ya(t,ka(e.render.world_tsr),p,_)}var l=e.bools.id0,T=e.bools.id1,u=e.bools.id2;switch(t.state){case R:break;case I:var f=F(e,r,function(e,r,_){(r.objects.ca=z(e,"id0",l,t.variables,_.variables))||l||(s.error("Logic script error: object not found. Node: ",e.name),e.mute=!0),r.objects.tr=z(e,"id1",T,t.variables,_.variables),r.objects.tr||T||(s.error("Logic script error: object not found. Node: ",e.name),e.mute=!0),r.objects.ta=z(e,"id2",u,t.variables,_.variables),r.objects.ta||u||(s.error("Logic script error: object not found. Node: ",e.name),e.mute=!0),r.state=b,r.camera_state={trans_start:new Float32Array(3),trans_end:new Float32Array(3),interp_trans:new Float32Array(3),target_start:new Float32Array(3),target_end:new Float32Array(3),interp_target:new Float32Array(3),tsr_start:new Float32Array(8),tsr_end:new Float32Array(8),interp_tsr:new Float32Array(8)}}),S=l?G(e.vars.id0,t.variables,r.variables):f.objects.ca,L=T?G(e.vars.id1,t.variables,r.variables):f.objects.tr,M=u?G(e.vars.id2,t.variables,r.variables):f.objects.ta,x=Fa(L.render.world_tsr),y=Fa(M.render.world_tsr);switch(f.state){case b:var w=e.bools.dur?W(G(e.vars.dur,t.variables,r.variables),Y):e.floats.dur;if(0==w)return c(S,x,y,f.camera_state.tsr_end),i(S,x,y,f.camera_state.tsr_end),void(r.curr_node=e.slot_idx_order);he(Fa(S.render.world_tsr),f.camera_state.trans_start);var U=a.get_move_style(S);U==a.MS_HOVER_CONTROLS?he(S.render.hover_pivot,f.camera_state.target_start):U==a.MS_STATIC||U==a.MS_EYE_CONTROLS?(Ma(S.render.world_tsr,f.camera_state.tsr_start),c(S,x,y,f.camera_state.tsr_end)):he(S.render.pivot,f.camera_state.target_start),he(x,f.camera_state.trans_end),he(y,f.camera_state.target_end),f.state=0;var C=P.animate(0,1,1e3*w,function(e){E.check_active()&&(U==a.MS_STATIC||U==a.MS_EYE_CONTROLS?ro(f.camera_state.tsr_start,f.camera_state.tsr_end,aa(e),f.camera_state.interp_tsr):(f.camera_state.interp_target=He(f.camera_state.target_start,f.camera_state.target_end,aa(e),f.camera_state.interp_target),f.camera_state.interp_trans=He(f.camera_state.trans_start,f.camera_state.trans_end,aa(e),f.camera_state.interp_trans)),i(S,f.camera_state.interp_trans,f.camera_state.interp_target,f.camera_state.interp_tsr),1==e&&(f.state=1))});break;case 0:break;case 1:P.clear_animation(C),f.state=b,r.curr_node=e.slot_idx_order}}},SET_CAMERA_MOVE_STYLE:function(e,t,r,_,n,o){var E=e.bools;switch(t.state){case R:break;case I:var c=F(e,r,function(e,t,r){E.id0||(t.objects.id0=i.get_object(i.GET_OBJECT_BY_DUPLI_NAME_LIST,e.objects_paths.id0,0))||(s.error("Logic script error: object not found. Node: ",e.name),e.mute=!0),E.pvo&&!E.id1&&(t.objects.id1=i.get_object(i.GET_OBJECT_BY_DUPLI_NAME_LIST,e.objects_paths.id1,0))}),l=E.id0?G(e.vars.id0,t.variables,r.variables):c.objects.id0,T=l.render;if(c.cam_state={target_cam_upside_down:T.target_cam_upside_down,use_panning:T.use_panning,horizontal_limits:T.horizontal_limits,vertical_limits:T.vertical_limits,distance_limits:T.distance_limits,hover_horiz_trans_limits:T.hover_horiz_trans_limits,hover_vert_trans_limits:T.hover_vert_trans_limits,pivot_limits:T.pivot_limits,enable_hover_hor_rotation:T.enable_hover_hor_rotation},S.is_camera(l)){var u=l.render,f=c.cam_state;switch(a.wipe_move_style(l),e.common_usage_names.camera_move_style){case 0:u.move_style=a.MS_STATIC;break;case 2:u.move_style=a.MS_EYE_CONTROLS;var P=Fa(u.world_tsr);a.setup_eye_model(l,P,null,f.horizontal_limits,f.vertical_limits);break;case 3:u.move_style=a.MS_HOVER_CONTROLS,P=Fa(u.world_tsr);var p=O;e.bools.pvo?p=Fa((E.id1?G(e.vars.id1,t.variables,r.variables):c.objects.id1).render.world_tsr):(p[0]=e.bools.pvx?W(G(e.vars.pvx,t.variables,r.variables),Y):e.floats.pvx,p[1]=e.bools.pvy?W(G(e.vars.pvy,t.variables,r.variables),Y):e.floats.pvy,p[2]=e.bools.pvz?W(G(e.vars.pvz,t.variables,r.variables),Y):e.floats.pvz),a.setup_hover_model(l,P,p,f.distance_limits,f.vertical_limits,f.hover_horiz_trans_limits,f.hover_vert_trans_limits,f.enable_hover_hor_rotation);break;case 1:u.move_style=a.MS_TARGET_CONTROLS,P=Fa(u.world_tsr),p=O,e.bools.pvo?p=Fa((E.id1?G(e.vars.id1,t.variables,r.variables):c.objects.id1).render.world_tsr):(p[0]=e.bools.pvx?W(G(e.vars.pvx,t.variables,r.variables),Y):e.floats.pvx,p[1]=e.bools.pvy?W(G(e.vars.pvy,t.variables,r.variables),Y):e.floats.pvy,p[2]=e.bools.pvz?W(G(e.vars.pvz,t.variables,r.variables),Y):e.floats.pvz),a.setup_target_model(l,P,p,f.horizontal_limits,f.vertical_limits,f.distance_limits,f.pivot_limits,f.use_panning)}var m=v;m[0]=e.bools.vtr?W(G(e.vars.vtr,t.variables,r.variables),Y):e.floats.vtr,m[1]=e.bools.vro?W(G(e.vars.vro,t.variables,r.variables),Y):e.floats.vro,m[2]=e.bools.vzo?W(G(e.vars.vzo,t.variables,r.variables),Y):e.floats.vzo,m[0]=Un(m[0],0,1/0),m[1]=Un(m[1],0,1/0),m[2]=Un(m[2],0,.99),u.velocity_trans=m[0],u.velocity_rot=m[1],u.velocity_zoom=m[2],A.update_transform(l),d.sync_transform(l),a.init_ortho_props(l)}else s.error("Logic script error: object is not a Camera. Node: ",e.name);r.curr_node=e.slot_idx_order}},SET_CAMERA_LIMITS:function(e,t,r,_,n,o){var E=e.bools;switch(t.state){case R:break;case I:var c=F(e,r,function(e,t,r){E.id0||(t.objects.id0=i.get_object(i.GET_OBJECT_BY_DUPLI_NAME_LIST,e.objects_paths.id0,0))||(s.error("Logic script error: object not found. Node: ",e.name),e.mute=!0)}),l=E.id0?G(e.vars.id0,t.variables,r.variables):c.objects.id0;if(S.is_camera(l)){switch(l.render.move_style){case a.MS_TARGET_CONTROLS:if(e.bools.dsl){var T=e.bools.dslmin?W(G(e.vars.dslmin,t.variables,r.variables),Y):e.floats.dslmin,u=e.bools.dslmax?W(G(e.vars.dslmax,t.variables,r.variables),Y):e.floats.dslmax;(L={}).min=Math.max(T,0),L.max=Math.max(u,0),a.set_distance_limits(l,L)}if(e.bools.vrl){var f=e.bools.vrldown?W(G(e.vars.vrldown,t.variables,r.variables),Y):e.floats.vrldown,P=e.bools.vrlup?W(G(e.vars.vrlup,t.variables,r.variables),Y):e.floats.vrlup;(L={}).down=f,L.up=P,L.camera_space="CAMERA"==e.common_usage_names.cam_lim_vert_rot_space_type,a.set_vertical_rot_limits(l,L)}if(e.bools.hrl){var p=e.bools.hrlleft?W(G(e.vars.hrlleft,t.variables,r.variables),Y):e.floats.hrlleft,m=e.bools.hrlright?W(G(e.vars.hrlright,t.variables,r.variables),Y):e.floats.hrlright;(L={}).left=p,L.right=m,L.camera_space="CAMERA"==e.common_usage_names.cam_lim_hor_rot_space_type,a.set_horizontal_rot_limits(l,L)}if(e.bools.pvl){var O=e.bools.pvlmin?W(G(e.vars.pvlmin,t.variables,r.variables),Y):e.floats.pvlmin,v=e.bools.pvlmax?W(G(e.vars.pvlmax,t.variables,r.variables),Y):e.floats.pvlmax;(L={}).min_z=O,L.max_z=v,a.set_pivot_limits(l,L)}break;case a.MS_HOVER_CONTROLS:if(e.bools.htl){var N=e.bools.htlmin?W(G(e.vars.htlmin,t.variables,r.variables),Y):e.floats.htlmin,g=e.bools.htlmax?W(G(e.vars.htlmax,t.variables,r.variables),Y):e.floats.htlmax;(L={}).min=N,L.max=g,a.set_hor_trans_limits(l,L)}if(e.bools.vtl){var h=e.bools.vtlmin?W(G(e.vars.vtlmin,t.variables,r.variables),Y):e.floats.vtlmin,b=e.bools.vtlmax?W(G(e.vars.vtlmax,t.variables,r.variables),Y):e.floats.vtlmax;(L={}).min=h,L.max=b,a.set_vert_trans_limits(l,L)}e.bools.vrl&&(f=e.bools.vrldown?W(G(e.vars.vrldown,t.variables,r.variables),Y):e.floats.vrldown,P=e.bools.vrlup?W(G(e.vars.vrlup,t.variables,r.variables),Y):e.floats.vrlup,(L={}).down=f,L.up=P,L.camera_space="CAMERA"==e.common_usage_names.cam_lim_vert_rot_space_type,a.hover_set_vertical_limits(l,L)),e.bools.dsl&&(T=e.bools.dslmin?W(G(e.vars.dslmin,t.variables,r.variables),Y):e.floats.dslmin,u=e.bools.dslmax?W(G(e.vars.dslmax,t.variables,r.variables),Y):e.floats.dslmax,(L={}).min=Math.max(T,0),L.max=Math.max(u,0),a.hover_set_distance_limits(l,L));break;case a.MS_EYE_CONTROLS:var L;if(e.bools.vrl&&(f=e.bools.vrldown?W(G(e.vars.vrldown,t.variables,r.variables),Y):e.floats.vrldown,P=e.bools.vrlup?W(G(e.vars.vrlup,t.variables,r.variables),Y):e.floats.vrlup,(L={}).down=f,L.up=P,L.camera_space="CAMERA"==e.common_usage_names.cam_lim_vert_rot_space_type,a.set_vertical_rot_limits(l,L)),e.bools.hrl)p=e.bools.hrlleft?W(G(e.vars.hrlleft,t.variables,r.variables),Y):e.floats.hrlleft,m=e.bools.hrlright?W(G(e.vars.hrlright,t.variables,r.variables),Y):e.floats.hrlright,(L={}).left=p,L.right=m,L.camera_space="CAMERA"==e.common_usage_names.cam_lim_hor_rot_space_type,a.set_horizontal_rot_limits(l,L)}A.update_transform(l),d.sync_transform(l)}else s.error("Logic script error: object is not a Camera. Node: ",e.name);r.curr_node=e.slot_idx_order}},MOVE_TO:function(e,t,r,_,n,a){function o(e,t){A.set_tsr(e,t),A.update_transform(e),d.sync_transform(e)}var i=e.bools,c=i.id0,l=i.id1;switch(t.state){case R:break;case I:var T=F(e,r,function(e,r,_){r.objects.id0=z(e,"id0",c,t.variables,_.variables),r.objects.id0||c||(s.error("Logic script error: object not found. Node: ",e.name),e.mute=!0),r.objects.id1=z(e,"id1",l,t.variables,_.variables),r.objects.id1||l||(s.error("Logic script error: object not found. Node: ",e.name),e.mute=!0),r.state=b,r.obj_state={dest_tsr_start:new Float32Array(8),dest_tsr_end:new Float32Array(8),interp_tsr_dest:new Float32Array(8)}}),u=i.id0?G(e.vars.id0,t.variables,r.variables):T.objects.id0;if(u.is_dynamic){switch(Ma(u.render.world_tsr,T.obj_state.dest_tsr_start),Ma((i.id1?G(e.vars.id1,t.variables,r.variables):T.objects.id1).render.world_tsr,T.obj_state.dest_tsr_end),T.state){case b:var f=e.bools.dur?W(G(e.vars.dur,t.variables,r.variables),Y):e.floats.dur;if(0==f)return o(u,T.obj_state.dest_tsr_end),void(r.curr_node=e.slot_idx_order);T.state=0;var S=P.animate(0,1,1e3*f,function(e){E.check_active()&&(T.obj_state.interp_dest=ro(T.obj_state.dest_tsr_start,T.obj_state.dest_tsr_end,aa(e),T.obj_state.interp_tsr_dest),o(u,T.obj_state.interp_tsr_dest),1==e&&(T.state=1))});break;case 0:break;case 1:P.clear_animation(S),T.state=b,r.curr_node=e.slot_idx_order}break}s.error("Logic script error: object '"+u.name+"' must be dynamic. Node: ",e.name),r.curr_node=e.slot_idx_order}},TRANSFORM_OBJECT:function(e,t,r,_,n,a){function o(e,t,r){r==x?A.set_tsr(e,t):A.set_tsr_rel(e,t),A.update_transform(e),d.sync_transform(e)}var i=e.bools.id0,c=F(e,r,function(e,r,_){r.obj=z(e,"id0",i,t.variables,_.variables),r.obj||i||(s.error("Logic script error: object not found. Node: ",e.name),e.mute=!0),r.state=b,r.obj_state={space:x,tsr_start:new Float32Array(8),tsr_end:new Float32Array(8),interp_tsr:new Float32Array(8)}});switch(t.state){case R:break;case I:var l=i?G(e.vars.id0,t.variables,r.variables):c.obj;switch(c.state){case b:var T=v;T[0]=e.bools.trx?W(G(e.vars.trx,t.variables,r.variables),Y):e.floats.trx,T[1]=e.bools.try?W(G(e.vars.try,t.variables,r.variables),Y):e.floats.try,T[2]=e.bools.trz?W(G(e.vars.trz,t.variables,r.variables),Y):e.floats.trz;var u=O;u[0]=e.bools.rox?W(G(e.vars.rox,t.variables,r.variables),Y)*Math.PI/180:e.floats.rox,u[1]=e.bools.roy?W(G(e.vars.roy,t.variables,r.variables),Y)*Math.PI/180:e.floats.roy,u[2]=e.bools.roz?W(G(e.vars.roz,t.variables,r.variables),Y)*Math.PI/180:e.floats.roz;var f=e.bools.sc?G(e.vars.sc,t.variables,r.variables):e.floats.sc;switch(rn(u,p),ya(T,f,p,c.obj_state.tsr_end),c.obj_state.space=e.common_usage_names.space_type,c.obj_state.space){case x:A.get_tsr(l,c.obj_state.tsr_start);break;case 1:A.get_tsr_rel(l,c.obj_state.tsr_start);break;case 2:A.get_tsr_rel(l,c.obj_state.tsr_start),Va(c.obj_state.tsr_start,c.obj_state.tsr_end,c.obj_state.tsr_end)}var S=e.bools.dur?W(G(e.vars.dur,t.variables,r.variables),Y):e.floats.dur;if(0==S)return o(l,c.obj_state.tsr_end,c.obj_state.space),void(r.curr_node=e.slot_idx_order);c.state=0;var m=P.animate(0,1,1e3*S,function(e){E.check_active()&&(ro(c.obj_state.tsr_start,c.obj_state.tsr_end,aa(e),c.obj_state.interp_tsr),o(l,c.obj_state.interp_tsr,c.obj_state.space),1==e&&(c.state=1))});break;case 0:break;case 1:P.clear_animation(m),c.state=b,r.curr_node=e.slot_idx_order}}},SPEAKER_PLAY:function(e,t,r,n,a,o){var i=e.bools.id0;switch(t.state){case R:void 0==e.bools.not_wait&&(e.bools.not_wait=!0);break;case I:var E=F(e,r,function(e,r,_){r.obj=z(e,"id0",i,t.variables,_.variables),r.obj||i||(s.error("Logic script error: object not found. Node: ",e.name),e.mute=!0)});switch(E.obj=i?G(e.vars.id0,t.variables,r.variables):E.obj,f.is_playing(E.obj)||0==E.state&&(E.state=1),E.state){case b:for(var c in t.logic_threads){var l=t.logic_threads[c].thread_state.curr_node;if(-1!=l){var T=t.logic_threads[c].nodes[l];"SPEAKER_PLAY"==T.type&&T!=e&&0==E.state&&T.obj==e.obj&&(T.state=1)}}e.bools.not_wait||(r.in_progress=!0),f.play_def(E.obj),E.state=0;break;case 0:e.bools.not_wait&&(r.curr_node=e.slot_idx_order,E.state=b);break;case 1:e.bools.not_wait||(r.in_progress=!1),r.curr_node=e.slot_idx_order,E.state=b;break;default:_.panic("Unknown state of "+e.name),E.state=b}}},SPEAKER_STOP:function(e,t,r,_,n,a){var o=e.bools.id0;switch(t.state){case R:break;case I:var i=F(e,r,function(e,r,_){r.obj=z(e,"id0",o,t.variables,_.variables),r.obj||o||(s.error("Logic script error: object not found. Node: ",e.name),e.mute=!0)}),E=o?G(e.vars.id0,t.variables,r.variables):i.obj;f.stop(E),r.curr_node=e.slot_idx_order}},STOP_ANIM:function(e,t,_,n,a,o){var i=e.bools.id0,E=e.bools.env;switch(t.state){case R:break;case I:var c=F(e,_,function(e,r,_){r.obj=E?H(e):z(e,"id0",i,t.variables,_.variables),r.obj||i||(s.error("Logic script error: object not found. Node: ",e.name),e.mute=!0)});c.obj=i?G(e.vars.id0,t.variables,_.variables):c.obj,r.stop(c.obj,r.SLOT_ALL),e.bools.rst&&r.set_first_frame(c.obj,r.SLOT_ALL),_.curr_node=e.slot_idx_order}},STOP_TIMELINE:function(e,t,r,_,n,a){switch(t.state){case I:e.bools.rst&&o.set_offset_from_range_start(_),o.stop_nla(),r.curr_node=e.slot_idx_order}},CONSOLE_PRINT:function(e,t,r,_,n,a){switch(t.state){case I:var o=0,i="{";for(var E in e.vars){o>0&&(i+=", ");var c=e.vars[E][1],l=G(e.vars[E],t.variables,r.variables);i+='"'+c+'": ';try{i+=JSON.stringify(l)}catch(e){i+=l?'{"name": "'+l.name+'", "type": "'+l.type+'"}':"Object"}++o}s.log(e.common_usage_names.msg,i+="}"),r.curr_node=e.slot_idx_order}},STRING:function(e,t,r,_,n,a){switch(t.state){case I:var o=e.bools.id0?W(G(e.vars.id0,t.variables,r.variables),L):e.strings.id0,i=e.bools.id1?W(G(e.vars.id1,t.variables,r.variables),L):e.strings.id1,s=0;switch(e.common_usage_names.string_operation){case 0:s=o+i;break;case 1:s=o.indexOf(i);break;case 2:var E=e.bools.id2?W(G(e.vars.id2,t.variables,r.variables),L):e.strings.id2;s=o.replace(i,E);break;case 3:var c=e.vars;s=o.substring(0,o.indexOf(i)),k(c.dst1,t.variables,r.variables,o.substring(o.indexOf(i)+1,o.length)),""==G(c.dst,t.variables,r.variables)&&(s=G(c.dst1,t.variables,r.variables),k(c.dst1,t.variables,r.variables,""));break;case 4:switch(e.common_usage_names.condition){case 5:s=o==i?1:0;break;case 4:s=o!=i?1:0;break;case 3:s=o<i?1:0;break;case 2:s=o>i?1:0;break;case 1:s=o<=i?1:0;break;case 0:s=o>=i?1:0}}k(e.vars.dst,t.variables,r.variables,s),r.curr_node=e.slot_idx_order}},GET_TIMELINE:function(e,t,r,_,n,a){switch(t.state){case I:var i=W(e.bools.nla?o.get_frame(_):P.get_frame(_),Y);k(e.vars.vd,t.variables,r.variables,i),r.curr_node=e.slot_idx_order}},JSON:function(e,t,r,_,n,a){switch(t.state){case I:switch(e.common_usage_names.json_operation){case"PARSE":try{var o=W(G(e.vars.jsn,t.variables,r.variables),L);!function(e,t,r,_){for(var n=0;n<t.length;n++){for(var a=t[n].split("."),o=e,i=r[n],s=0;s<a.length&&void 0!==(o=o[a[s]])&&null!==o;s++);o=J(o),_[i]=o}}(JSON.parse(o),e.parse_json_paths,e.parse_json_vars,r.variables)}catch(e){s.error("logic script error: non valid JSON string")}break;case"ENCODE":var i={};!function(e,t,r,_){_||(_={});for(var n=0;n<t.length;n++){var a=t[n].split("."),o=_,i=r[n];if(i in e){for(var s=0;s<a.length-1;s++)void 0===o[a[s]]&&(o[a[s]]=isNaN(a[s+1])?{}:[]),o=o[a[s]];o[a[a.length-1]]=J(e[i])}}}(r.variables,e.encode_json_paths,e.encode_json_vars,i);var E=W(JSON.stringify(i),L);k(e.vars.jsn,t.variables,r.variables,E)}r.curr_node=e.slot_idx_order}},JS_CALLBACK:function(e,t,r,_,n,a){switch(t.state){case I:for(var o,E=e.bools.cb?W(G(e.vars.cb,t.variables,r.variables),L):e.strings.cb,c=[],l=0,T="id"+l,u=e.common_usage_names.js_cb_params;T in u;)o=0==u[T]?i.get_object(i.GET_OBJECT_BY_DUPLI_NAME_LIST,e.objects_paths[T],0):G(e.vars[T],t.variables,r.variables),c.push(o),T="id"+ ++l;var d=[];for(T="out"+(l=0);T in e.vars;)o=G(e.vars[T],t.variables,r.variables),d.push(o),T="out"+ ++l;var f=1;if(E in U){if(f=!U[E](c,d))for(var P=0;P<d.length;P++)(T="out"+P)in e.vars&&k(e.vars[T],t.variables,r.variables,J(d[P]))}else s.error("logic script error: no custom callback with id "+E);f&&(r.curr_node=e.slot_idx_order)}},EMPTY:K,DATE_TIME:function(e,t,r,_,n,a){switch(t.state){case I:var o,i,s,E,c,l,T=e.common_usage_names.time_type,u=new Date;"L"==T?(o=u.getFullYear(),i=u.getMonth(),s=u.getDate(),E=u.getHours(),c=u.getMinutes(),l=u.getSeconds()):(o=u.getUTCFullYear(),i=u.getUTCMonth(),s=u.getUTCDate(),E=u.getUTCHours(),c=u.getUTCMinutes(),l=u.getUTCSeconds()),e.bools.y&&k(e.vars.y,t.variables,r.variables,o),e.bools.M&&k(e.vars.M,t.variables,r.variables,i),e.bools.d&&k(e.vars.d,t.variables,r.variables,s),e.bools.h&&k(e.vars.h,t.variables,r.variables,E),e.bools.m&&k(e.vars.m,t.variables,r.variables,c),e.bools.s&&k(e.vars.s,t.variables,r.variables,l),r.curr_node=e.slot_idx_order}},ELAPSED:function(e,t,r,_,n,a){switch(t.state){case I:k(e.vars.s,t.variables,r.variables,n),r.curr_node=e.slot_idx_order}},CALL_FUNC:function(e,t,r,_,n,a){switch(t.state){case R:for(var o=e.logic_node_trees.id0,i=e.logic_functions.id0,s=0;s<t.logic_functions.length;s++){var E=t.logic_functions[s];if(E.id[0][0]==o[0]&&E.id[0][1]==o[1]&&E.id[1]==i){e.func_id=s;break}}break;case I:var c={};for(var l in r.variables_references={},e.vars){var T=e.vars[l][1],u=e.strings[l];c[u]=e.vars[l][0]?t.variables[T]:r.variables[T],l.startsWith("out")&&(r.variables_references[T]=u)}r.callstack.push({caller_node:e,variables:c,logic_func:t.logic_functions[e.func_id]}),r.variables=c,r.update_script_cycle=!0,r.curr_node=t.logic_functions[e.func_id].func.nodes[0].slot_idx_order}},DEF_FUNC:K,SWITCH:function(e,t,r,_,n,a){switch(t.state){case R:var o=Object.keys(e.vars);for(var i in o)o[i].startsWith("id")||o.splice(i,1);e.links_keys=o;break;case I:var s=G(e.vars.v,t.variables,r.variables);for(var i in e.links_keys)if(s==G(e.vars[e.links_keys[i]],t.variables,r.variables))return void(r.curr_node=e.links_dict[e.links_keys[i]]);r.curr_node=e.slot_idx_order}}},w=[],U={},C={};function D(e,t){return{name:e.name,type:e.type,label:e.label,slot_idx_order:e.slot_idx_order,slot_idx_jump:e.slot_idx_jump,frame_start:e.frame_range[0],frame_end:e.frame_range[1],frame_start_mask:!e.frame_range_mask||e.frame_range_mask[0],frame_end_mask:!e.frame_range_mask||e.frame_range_mask[1],param_name:e.param_name,op:e.operation,mute:e.mute,dupli_name_list:e.object,anim_name:e.anim_name,parse_json_vars:e.parse_json_vars,parse_json_paths:e.parse_json_paths,objects_paths:e.objects_paths,nodes_paths:e.nodes_paths,floats:e.floats,bools:e.bools,vars:e.variables,strings:e.strings,logic_functions:e.logic_functions,logic_node_trees:e.logic_node_trees,materials_names:e.materials_names,shader_nd_type:e.shader_nd_type,common_usage_names:e.common_usage_names,encode_json_vars:e.encode_json_vars,encode_json_paths:e.encode_json_paths,thread:t,process_node:y[e.type]?y[e.type]:B,processed:!1,links_dict:e.links,instances:[],func_id:-1,links_keys:null,select_object_idx:-1}}function F(e,t,_){var n=t.thread_index+1-e.instances.length;if(n>0)for(var a=0;a<n;a++)e.instances.push(0);return e.instances[t.thread_index]||(e.instances[t.thread_index]={objects:{},slot_idx_jump:-1,state:b,sel_obj_idxs:[],timer:-1,camera_state:{},anim_slot:r.SLOT_ALL,obj_state:null},_&&_(e,e.instances[t.thread_index],t)),e.instances[t.thread_index]}function G(e,t,r){return e[0]?t[e[1]]:r[e[1]]}function k(e,t,r,_){e[0]?t[e[1]]=_:r[e[1]]=_}function K(e,t,r,_,n,a){switch(t.state){case R:break;case I:r.curr_node=e.slot_idx_order}}function B(e,t,r,_,n,a){switch(t.state){case R:s.error("Unknown node type: "+e.type);break;case I:r.curr_node=e.slot_idx_order}}function X(e,t,r,_){for(var n=w[e],a=0;a<w[e].logic_threads.length;a++)n.curr_thread=w[e].logic_threads[a],q(w[e].logic_threads[a],n,t,r,_)}function H(e){return i.get_world_by_name(e.dupli_name_list[0],0)}t.init_logic=function(e,t){var r={data_id:t,scene_name:e.name,state:0,nla_thread:null,scene:e,curr_thread:null,logic_threads:[],logic_functions:[],sorted_markers_values:[],variables:{},variables_references:{}};e._logic=r,function(e,t){var r=e.b4w_logic_nodes,_=t.logic_threads,n=t.logic_functions;t.state=R;for(var a=-1,o=0;o<r.length;o++){for(var i={nodes:[],thread_state:{scene:e,curr_node:0,in_progress:!1,update_script_cycle:!1,thread_index:o,callstack:[],variables:{R1:0,R2:0,R3:0,R4:0,R5:0,R6:0,R7:0,R8:0}}},s=r[o],E=0;E<s.length;E++){var c=D(s[E],i);i.nodes.push(c)}switch(i.nodes[0].type){case"ENTRYPOINT":i.thread_state.thread_index=++a,_.push(i);break;case"DEF_FUNC":var l=i.nodes[0];i.thread_state=null,n.push({id:[l.logic_node_trees.id0,l.logic_functions.id0],func:i})}}for(o=0;o<_.length;o++){i=_[o];for(var T=0;T<i.nodes.length;T++)(c=i.nodes[T]).mute||c.process_node(c,t,i.thread_state,0,0)}for(o=0;o<n.length;o++){var u=n[o].func;for(T=0;T<u.nodes.length;T++)(c=u.nodes[T]).mute||c.process_node(c,t,0,0,0)}var d=e.timeline_markers;for(var f in d)t.sorted_markers_values.push(d[f]);t.sorted_markers_values.sort(function(e,t){return e-t}),t.state=I,w.push(t)}(e,r)},t.update=function(e,t){var r=o.get_start_time();if(!(r<=0))for(var _=0;_<w.length;_++)X(_,e,t,r)},t.append_custom_cb=function(e,t){U[e]=t},t.remove_custom_cb=function(e){delete U[e]},t.run_ep=function(e,t){for(var r=0;r<w.length;r++)if(w[r].scene_name==e){for(var _=w[r],n=0;n<_.logic_threads.length;n++){var a=_.logic_threads[n].nodes[0];if(a.name==t){a.bools.js&&(a.mute=!1),_.logic_threads[n].thread_state.curr_node=0;break}}break}};var Q=function(){return function(e,t,r,_){var n=_[1],a=_[2],i=F(_[0],a.thread_state);if(-1==i.state){for(var s=0;s<i.sel_objs_len;s++)if(l.get_sensor_value(e,t,s)){for(var E=0;E<i.sel_obj_idxs.length;E++)if(i.sel_obj_idxs[E]==s)return n.nla_thread==i.thread?(o.is_play(n._nla)&&(i.state=-3),a.thread_state.in_progress||(i.state=1,i.slot_idx_jump=i.links_idxs[E])):(i.state=1,i.slot_idx_jump=i.links_idxs[E]),void(i.select_object_idx=s);i.select_object_idx=s}i.state=0}}};function z(e,t,r,_,n){return r?G(e.vars[t],_,n):i.get_object(i.GET_OBJECT_BY_DUPLI_NAME_LIST,e.objects_paths[t],0)}function j(e){var t=e.thread_state.callstack;if(t.length<=1)var r=e.nodes;else r=t[t.length-1].logic_func.func.nodes;return r}function q(e,t,r,_,n,a){e.thread_state.update_script_cycle=!1;var o=e.thread_state.callstack;if(o.length<=1)var i=e.nodes;else i=o[o.length-1].logic_func.func.nodes;if(i.length){if(!a)for(var s=0;s<i.length;s++)i[s].processed=!1;for(s=0;s<i.length;s++){if(!(e.thread_state.curr_node>=0)){if(e.thread_state.callstack.length>1){var E=e.thread_state.callstack.pop().caller_node,c=o[o.length-1];if(c.logic_func)var l=c.logic_func.func.nodes;else l=e.nodes;e.thread_state.curr_node=E.slot_idx_order,f=l[E.slot_idx_order];var T=e.thread_state.variables;for(var u in e.thread_state.variables=c.variables,e.thread_state.variables_references){var d=e.thread_state.variables_references[u];void 0===e.thread_state.variables[u]?t.variables[u]=T[d]:e.thread_state.variables[u]=T[d]}return void q(e,t,r,_,n,!0)}return}var f;if((f=i[e.thread_state.curr_node]).processed)return;if(f.mute){if("ENTRYPOINT"==f.type)return;e.thread_state.curr_node=f.slot_idx_order,f.processed=!0}else if(f.process_node(f,t,e.thread_state,r,_,n),f.processed=!0,e.thread_state.update_script_cycle)return}o.splice(0,o.length)}}function W(e,t){switch(t){case Y:return Number(e)?Number(e):0;case L:return String(e);case M:return e;default:return null}}function J(e){switch(typeof e){case"string":return W(e,L);case"number":return W(e,Y);default:return W(e,L)}}function Z(e){C[e]||(C[e]=0);var t=e+"_"+C[e];return t=t.replace(/ /g,"_").replace(/\//g,"_"),C[e]++,t}function $(e,t){switch(t){case Y:return e.floats;case L:return e.strings;case M:return e.objects_paths}}t.cleanup=function(){w.length=0,U={},C={}}}),_E=A("__reformer",function(e,t){var r=ha(e),_=Wo(e),n=xs(e),a=ga(e),o=rE(e),i=gs(e),s=_.defaults,E=!0,c=!1,l={},T=p(),u=gi(),d=Yr();function f(e){switch(e.type){case"VALTORGB":e.color_ramp||(e.color_ramp={elements:[{position:.5,color:[1,1,1,1]}]},v("node Color Ramp",e,"color_ramp"));break;case"CURVE_RGB":e.curve_mapping||(e.curve_mapping={curves_data:[[[0,0],[1,1]],[[0,0],[1,1]],[[0,0],[1,1]],[[0,0],[1,1]]],curves_handle_types:["EXTRAPOLATED","EXTRAPOLATED","EXTRAPOLATED","EXTRAPOLATED"],curve_extend:[["AUTO","AUTO"],["AUTO","AUTO"],["AUTO","AUTO"],["AUTO","AUTO"]]},v("node RGB Curves",e,"curve_mapping"));break;case"CURVE_VEC":e.curve_mapping||(e.curve_mapping={curves_data:[[[0,0],[1,1]],[[0,0],[1,1]],[[0,0],[1,1]]],curves_handle_types:["EXTRAPOLATED","EXTRAPOLATED","EXTRAPOLATED"],curve_extend:[["AUTO","AUTO"],["AUTO","AUTO"],["AUTO","AUTO"]]},v("node Vector Curves",e,"curve_mapping"));break;case"MAPPING":e.vector_type||(e.vector_type="POINT",v("node Mapping",e,"vector_type"));break;case"MATERIAL":case"MATERIAL_EXT":"alpha"in e||(e.alpha=1,v("node material",e,"alpha")),"darkness"in e||(e.darkness=1,v("node material",e,"darkness")),"diffuse_toon_size"in e||(e.diffuse_toon_size=.5,v("node material",e,"diffuse_toon_size")),"diffuse_toon_smooth"in e||(e.diffuse_toon_smooth=.1,v("node material",e,"diffuse_toon_smooth")),"diffuse_intensity"in e||(e.diffuse_intensity=1,v("node material",e,"diffuse_intensity")),"use_tangent_shading"in e||(e.use_tangent_shading=!1,v("node material",e,"use_tangent_shading")),"specular_shader"in e||(e.specular_shader="COOKTORR",v("node material",e,"specular_shader")),"specular_ior"in e||(e.specular_ior=4,v("node material",e,"specular_ior")),"specular_hardness"in e||(e.specular_hardness=50,v("node material",e,"specular_hardness")),"specular_slope"in e||(e.specular_slope=.1,v("node material",e,"specular_slope")),"specular_toon_size"in e||(e.specular_toon_size=.5,v("node material",e,"specular_toon_size")),"specular_toon_smooth"in e||(e.specular_toon_smooth=.1,v("node material",e,"specular_toon_smooth")),"specular_intensity"in e||(e.specular_intensity=.5,v("node material",e,"specular_intensity")),"diffuse_shader"in e||(e.diffuse_shader="LAMBERT",v("node material",e,"diffuse_shader")),"roughness"in e||(e.roughness=.5,v("node material",e,"roughness")),"diffuse_fresnel"in e||(e.diffuse_fresnel=.1,v("node material",e,"diffuse_fresnel")),"diffuse_fresnel_factor"in e||(e.diffuse_fresnel_factor=.5,v("node material",e,"diffuse_fresnel_factor"));break;case"MATH":case"MIX_RGB":"use_clamp"in e||(e.use_clamp=!1,v("node "+e.type,e,"use_clamp"));break;case"GROUP":switch(e.node_tree_name=e.node_tree_name.replace(/\.[0-9]{3,}$/g,""),e.node_tree_name){case"CLAMP":case"LEVELS_OF_QUALITY":case"LINEAR_TO_SRGB":case"NORMAL_VIEW":case"PARALLAX":case"REFLECT":case"REFRACTION":case"REPLACE":case"SMOOTHSTEP":case"SRGB_TO_LINEAR":case"TIME":case"TRANSLUCENCY":case"VECTOR_VIEW":e.node_tree_name="B4W_"+e.node_tree_name}break;case"VECT_TRANSFORM":"convert_from"in e||(e.convert_from="WORLD",v("node "+e.type,e,"convert_from")),"convert_to"in e||(e.convert_to="WORLD",v("node "+e.type,e,"convert_to")),"vector_type"in e||(e.vector_type="POINT",v("node "+e.type,e,"vector_type"));break;case"ATTRIBUTE":e.color_layer="";break;case"BSDF_TRANSPARENT":"b4w_use_alpha"in e||(e.b4w_use_alpha=!1,v("node "+e.type,e,"b4w_use_alpha"))}}function P(e){var t=e.nla_tracks;if(t)for(var r=0;r<t.length;r++)for(var _=t[r],n=0;n<_.strips.length;n++){var a=_.strips[n];"action"in a||(a.action=null,v("strip",a,"action")),"action_frame_start"in a||(a.action_frame_start=0,v("strip",a,"action_frame_start")),"action_frame_end"in a||(a.action_frame_end=a.frame_end-a.frame_start,v("strip",a,"action_frame_end")),"repeat"in a||(a.repeat=1,v("strip",a,"repeat")),"use_reverse"in a||(a.use_reverse=!1,v("strip",a,"use_reverse")),"scale"in a||(a.scale=1,v("strip",a,"scale"))}}function A(e){for(var t=["b4w_apply_scale","b4w_apply_modifiers","b4w_export_edited_normals","b4w_loc_export_vertex_anim","b4w_shape_keys"],r=null,_=0;_<t.length;_++)e[t[_]]&&(r?(e[t[_]]=!1,a.warn('WARNING property "'+t[_]+'" of object "'+e.name+'" has been set to "false". Foreground property "'+r+'" already exists.')):r=t[_])}function S(e){var t=e.game,r=t.collision_bounds_type;t.use_collision_bounds&&"BOX"!=r&&"CYLINDER"!=r&&"CONE"!=r&&"SPHERE"!=r&&"CAPSULE"!=r&&"EMPTY"!=r&&(a.error("Wrong collision bounds type "+r+". Disable physics for object "+e.name),e.b4w_collision=!1,e.b4w_floating=!1,e.b4w_vehicle=!1,e.b4w_character=!1)}function O(e,t){var r=e[0],_=e[1],n=e[2];return t[0]=e[3],t[1]=r,t[2]=_,t[3]=n,t}function v(e,t,r){if(E){var _=r+">>"+e;_ in l||(l[_]={storage:[],report_type:"undefined",type:e}),l[_].storage.push(t.name)}else c=!0}function N(e,t,r){if(E){var _=r+">>"+e;_ in l||(l[_]={storage:[],report_type:"deprecated",type:e}),l[_].storage.push(t.name)}else c=!0}function g(e){E?a.warn(e):c=!0}function h(e){var t=e.scale;if(0==t[0]&&0==t[1]&&0==t[2])return!0;var r=Math.abs((t[0]-t[1])/t[0]),_=Math.abs((t[1]-t[2])/t[1]);return r<.005&&_<.005}function R(e){return e.scale[0]<0||e.scale[1]<0||e.scale[2]<0}function I(e,t){for(var r,_,n,a,o=0,i=0,s=0,E=new Float32Array(16),c=[],l=1;l<t.count;l++){if(t.use_constant_offset&&(o+=t.constant_offset_displace[0],i+=t.constant_offset_displace[1],s+=t.constant_offset_displace[2]),t.use_relative_offset){var T=e.b4w_boundings.bb;o+=(T.max_x-T.min_x)*t.relative_offset_displace[0],i+=(T.max_y-T.min_y)*t.relative_offset_displace[1],s+=(T.max_z-T.min_z)*t.relative_offset_displace[2]}r=o,_=i,n=s,(a=E)||(a=new Float32Array(16)),Q(a),a[12]=r,a[13]=_,a[14]=n;var u=L(e);y(u,E),c.push(u)}for(l=0;l<c.length;l++)M(e,c[l])}function b(e,t){for(var r=n.create_spline(t.object),_=new Float32Array(16),a=r.is_3d?4:3,o=new Float32Array(a),i=new Float32Array(a),s=new Float32Array(3),E=new Float32Array(4),c=new Float32Array(4),l=new Float32Array(3),T=new Float32Array(3),d=new Float32Array(3),f=0;f<e.submeshes.length;f++){var P=e.submeshes[f],A=P.position,S=P.tbn,p=Y(t.deform_axis);l[0]=0,l[1]=0,l[2]=0,l[p]=1;for(var m=n.spline_length(r),O=0;O<A.length/3;O++){d[0]=A[3*O],d[1]=A[3*O+1],d[2]=A[3*O+2];var v=d[p],N=n.spline_len_to_t(r,v);n.spline_point(r,N,o),s[0]=o[0],s[1]=o[1],s[2]=o[2],n.spline_derivative(r,N,i),T[0]=i[0],T[1]=0,T[2]=i[2],Ke(T,T),wr(l,T,E),v<0?(o[0]=T[0],o[1]=T[1],o[2]=T[2],ye(o,v,o),Ie(s,o,s)):v>m&&(o[0]=T[0],o[1]=T[1],o[2]=T[2],ye(o,v-m,o),Ie(s,o,s)),Ee(E,s,_),r.is_3d&&(Dr(l,o[3],c),We(d,c,d)),d[p]=0,je(d,_,d),A[3*O]=d[0],A[3*O+1]=d[1],A[3*O+2]=d[2];var g=Ri(S,O,u);Yi(g,E,g),Ii(S,g,O)}}}function Y(e){switch(e){case"POS_X":case"NEG_X":return 0;case"POS_Y":case"NEG_Y":return 1;case"POS_Z":case"NEG_Z":return 2;default:r.panic("Wrong deform axis value "+e)}}function L(e,t){t||(t=e.name+"_COPY");var r=e.materials,_=e.submeshes;e.materials=null,e.submeshes=null;var n=ln(e);e.materials=r,e.submeshes=_,n.name=t,n.materials=e.materials.slice(0),n.submeshes=[];for(var a=0;a<_.length;a++){var o=Tn(_[a]);n.submeshes.push(o)}return n}function M(e,t){for(var r=0;r<e.submeshes.length;r++){var _=e.submeshes[r],n=t.submeshes[r],o=_.base_length,i=_.indices.length;if(o)for(var s in _)switch(s){case"base_length":_[s]+=n[s];break;case"boundings":break;case"indices":_[s]=(l=n[s],u=void 0,T=(c=_[s]).length,(u=new Uint32Array(T+l.length)).set(c),u.set(l,T),u);for(var E=i;E<_[s].length;E++)_[s][E]+=o;break;case"position":_[s]=x(_[s],n[s],_[s].length/o/3);break;case"tbn":_[s]=x(_[s],n[s],_[s].length/o/4);break;case"shade_tangs":_[s]=x(_[s],n[s],_[s].length/o/3);break;case"group":_[s]=x(_[s],n[s],_[s].length/o);break;case"texcoord":_[s]=x(_[s],n[s],_.uv_layers.length);break;case"color":_[s]=x(_[s],n[s],_.vertex_colors.length);break;case"uv_layers":case"vertex_colors":break;default:a.warn('array_mesh_join(): unknown submesh property "'+s+'"'),_[s]=q_(_[s],n[s])}}var c,l,T,u;return e}function x(e,t,r){if(r>1){for(var _=e.length/r,n=t.length/r,a=new Float32Array(e.length+t.length),o=0,i=0;i<r;i++)a.set(e.subarray(_*i,_*(i+1)),o),o+=_,a.set(t.subarray(n*i,n*(i+1)),o),o+=n;return a}return q_(e,t)}function y(e,t){for(var r=qr(m(t,T),d),_=0;_<e.submeshes.length;_++){var n=e.submeshes[_];An(n.position,t,n.position,0),Yi(n.tbn,r,n.tbn)}}t.check_bpy_data=function(e){l={};var t=function(t,r){switch(t.type){case"ARRAY":if(!("fit_type"in t))return function(e,r,_){E?a.error("WARNING Incomplete modifier "+String(t.type)+' for "'+r.name+'", reexport "'+_+'" scene'):c=!0}(0,r,e.b4w_filepath_blend),!1}return!0},r=e.worlds;if(0==r.length){E?a.warn('WARNING Datablock world is missing, reexport "'+e.b4w_filepath_blend+'" scene'):c=!0;var _={name:"DEFAULT",horizon_color:new Float32Array([0,0,0]),zenith_color:new Float32Array([0,0,0]),light_settings:{use_environment_light:!1,environment_energy:1,environment_color:"PLAIN"},fog_settings:{use_fog:!1,intensity:0,depth:25,start:5,height:0,falloff:"INVERSE_QUADRATIC",use_custom_color:!0,color:[.5,.5,.5]},use_sky_paper:!1,use_sky_blend:!1,use_sky_real:!1,use_nodes:!1,node_tree:null,texture_slots:[]};r.push(_)}for(var n=0;n<r.length;n++){"use_sky_blend"in(_=r[n])||(v("world",_,"use_sky_blend"),_.use_sky_blend=!1),"use_sky_paper"in _||(v("world",_,"use_sky_paper"),_.use_sky_paper=!1),"use_sky_real"in _||(v("world",_,"use_sky_real"),_.use_sky_real=!1),"b4w_sky_settings"in _&&"rayleigh_brightness"in _.b4w_sky_settings||(v("world",_,"rayleigh_brightness"),_.b4w_sky_settings={render_sky:!1,procedural_skydome:!1,use_as_enviroment_map:!1,color:[.24,.43,.75],rayleigh_brightness:3.3,mie_brightness:.1,spot_brightness:10,scatter_strength:.2,rayleigh_strength:.2,mie_strength:.006,rayleigh_collection_power:.5,mie_collection_power:.5,mie_distribution:.4}),"fog_settings"in _||(v("world",_,"fog_settings"),_.fog_settings={use_fog:!1,intensity:0,depth:25,start:0,height:0,falloff:"QUADRATIC",use_custom_color:!0,color:[.5,.5,.5]},"b4w_fog_color"in _&&(_.fog_settings.use_custom_color=!0,_.fog_settings.color=_.b4w_fog_color),"b4w_fog_density"in _&&_.b4w_fog_density>0&&(_.fog_settings.depth=1/_.b4w_fog_density)),"render_sky"in _.b4w_sky_settings||(v("world",_,"render_sky"),_.b4w_sky_settings.render_sky=!1);for(var o=_.texture_slots,i=0;i<o.length;i++)"blend_type"in(J=o[i])||(J.blend_type="MIX",v("world_texture_slot",J,"blend_type")),"use_map_blend"in J||(J.use_map_blend=!1,v("world_texture_slot",J,"use_map_blend")),"use_map_horizon"in J||(J.use_map_horizon=!0,v("world_texture_slot",J,"use_map_horizon")),"use_map_zenith_up"in J||(J.use_map_zenith_up=!1,v("world_texture_slot",J,"use_map_zenith_up")),"use_rgb_to_intensity"in J||(J.use_rgb_to_intensity=!1,v("world_texture_slot",J,"use_rgb_to_intensity")),"invert"in J||(J.invert=!1,v("world_texture_slot",J,"invert")),"color"in J||(J.color=[1,0,1],v("world_texture_slot",J,"color")),"blend_factor"in J||(J.blend_factor=0,v("world_texture_slot",J,"blend_factor")),"horizon_factor"in J||(J.horizon_factor=1,v("world_texture_slot",J,"horizon_factor")),"zenith_up_factor"in J||(J.zenith_up_factor=0,v("world_texture_slot",J,"zenith_up_factor")),"zenith_down_factor"in J||(J.zenith_down_factor=0,v("world_texture_slot",J,"zenith_down_factor")),"default_value"in J||(J.default_value=1,v("world_texture_slot",J,"default_value"));"b4w_use_default_animation"in _||(v("world",_,"b4w_use_default_animation"),_.b4w_use_default_animation=!1),"b4w_anim_behavior"in _||(v("world",_,"b4w_anim_behavior"),_.b4w_anim_behavior="CYCLIC")}var T=e.scenes;for(n=0;n<T.length;n++){var u=T[n],d=u.world;"timeline_markers"in u||(u.timeline_markers=null,v("scene",u,"timeline_markers")),"boolean"==typeof u.b4w_enable_physics&&(u.b4w_enable_physics="AUTO"),"b4w_reflection_quality"in u||(u.b4w_reflection_quality="MEDIUM",v("scene",u,"b4w_reflection_quality")),"b4w_use_nla"in u||(u.b4w_use_nla=!1,v("scene",u,"b4w_use_nla")),"fps"in u||(u.fps=24,v("scene",u,"fps")),"b4w_nla_cyclic"in u||(u.b4w_nla_cyclic=!1,v("scene",u,"b4w_nla_cyclic")),"b4w_logic_nodes"in u||(u.b4w_logic_nodes=[],v("scene",u,"b4w_logic_nodes")),"b4w_detect_collisions"in u&&(N("scene",u,"b4w_detect_collisions"),delete u.b4w_detect_collisions),"audio_doppler_speed"in u||(u.audio_doppler_speed=343.3),"audio_doppler_factor"in u||(u.audio_doppler_factor=1),"b4w_dynamic_compressor_settings"in u||(u.b4w_dynamic_compressor_settings={threshold:-24,knee:30,ratio:12,attack:.003,release:.25},v("scene",u,"b4w_dynamic_compressor_settings")),"b4w_enable_convolution_engine"in u||(u.b4w_enable_convolution_engine=!1),"b4w_enable_bloom"in u||(u.b4w_enable_bloom=!1,v("scene",u,"b4w_enable_bloom")),"b4w_enable_motion_blur"in u||(u.b4w_enable_motion_blur=!1,v("scene",u,"b4w_enable_motion_blur")),"b4w_enable_color_correction"in u||(u.b4w_enable_color_correction=!1,v("scene",u,"b4w_enable_color_correction")),"b4w_antialiasing_quality"in u||(u.b4w_antialiasing_quality="MEDIUM",v("scene",u,"b4w_antialiasing_quality")),"b4w_tags"in u||(u.b4w_tags={title:"",description:""},v("scene",u,"b4w_tags")),"b4w_lod_smooth_type"in u||(u.b4w_lod_smooth_type="OFF",v("scene",u,"b4w_lod_smooth_type")),"b4w_lod_hyst_interval"in u||(u.b4w_lod_hyst_interval=0,v("scene",u,"b4w_lod_hyst_interval")),"b4w_enable_object_selection"in u||(u.b4w_enable_object_selection="AUTO",v("scene",u,"b4w_enable_object_selection")),"b4w_enable_outlining"in u||(u.b4w_enable_outlining="AUTO",v("scene",u,"b4w_enable_outlining")),"b4w_enable_glow_materials"in u||(u.b4w_enable_glow_materials="AUTO",v("scene",u,"b4w_enable_glow_materials")),"b4w_enable_anchors_visibility"in u||(u.b4w_enable_anchors_visibility="AUTO",v("scene",u,"b4w_enable_anchors_visibility")),"b4w_outline_color"in u||(u.b4w_outline_color=[1,1,1],v("scene",u,"b4w_outline_color")),"b4w_outline_factor"in u||(u.b4w_outline_factor="b4w_glow_factor"in u?u.b4w_glow_factor:1,v("scene",u,"b4w_outline_factor")),"b4w_shadow_settings"in u||(v("scene",u,"b4w_shadow_settings"),u.b4w_shadow_settings=d.b4w_shadow_settings||{csm_resolution:2048,blur_samples:"16x",self_shadow_polygon_offset:1,b4w_enable_csm:!1,csm_num:1,csm_first_cascade_border:10,first_cascade_blur_radius:3,csm_last_cascade_border:100,last_cascade_blur_radius:1.5,fade_last_cascade:!0,blend_between_cascades:!0});var p=u.b4w_shadow_settings;"csm_resolution"in p||(v("scene",u,"b4w_shadow_settings.csm_resolution"),p.csm_resolution=2048),"blur_samples"in p||(v("scene",u,"b4w_shadow_settings.blur_samples"),p.blur_samples="16x"),"soft_shadows"in p||(v("scene",u,"b4w_shadow_settings.soft_shadows"),p.soft_shadows=!0),"self_shadow_polygon_offset"in p||(v("scene",u,"b4w_shadow_settings.self_shadow_polygon_offset"),p.self_shadow_polygon_offset=1),"self_shadow_normal_offset"in p||(v("scene",u,"b4w_shadow_settings.self_shadow_normal_offset"),p.self_shadow_normal_offset=.01),"b4w_enable_csm"in p||(v("scene",u,"b4w_shadow_settings.b4w_enable_csm"),p.b4w_enable_csm=!1),"csm_num"in p||(v("scene",u,"b4w_shadow_settings.csm_num"),p.csm_num=1),"csm_first_cascade_border"in p||(v("scene",u,"b4w_shadow_settings.csm_first_cascade_border"),p.csm_first_cascade_border=10),"first_cascade_blur_radius"in p||(v("scene",u,"b4w_shadow_settings.first_cascade_blur_radius"),p.first_cascade_blur_radius=3),"csm_last_cascade_border"in p||(v("scene",u,"b4w_shadow_settings.csm_last_cascade_border"),p.csm_last_cascade_border=100),"last_cascade_blur_radius"in p||(v("scene",u,"b4w_shadow_settings.last_cascade_blur_radius"),p.last_cascade_blur_radius=1.5),"fade_last_cascade"in p||(v("scene",u,"b4w_shadow_settings.fade_last_cascade"),p.fade_last_cascade=!0),"blend_between_cascades"in p||(v("scene",u,"b4w_shadow_settings.blend_between_cascades"),p.blend_between_cascades=!0),"b4w_ssao_settings"in u||(v("scene",u,"b4w_ssao_settings"),u.b4w_ssao_settings=d.b4w_ssao_settings||{dist_factor:0,samples:16,hemisphere:!1,blur_depth:!1,blur_discard_value:1});var m=u.b4w_ssao_settings;if("dist_factor"in m||(v("scene",u,"b4w_ssao_settings.dist_factor"),m.dist_factor=0),"samples"in m||(v("scene",u,"b4w_ssao_settings.samples"),m.samples=16),"hemisphere"in m||(v("scene",u,"b4w_ssao_settings.hemisphere"),m.hemisphere=!1),"blur_depth"in m||(v("scene",u,"b4w_ssao_settings.blur_depth"),m.blur_depth=!1),"blur_discard_value"in m||(v("scene",u,"b4w_ssao_settings.blur_discard_value"),m.blur_discard_value=1),"b4w_bloom_settings"in u||(v("scene",u,"b4w_bloom_settings"),u.b4w_bloom_settings=d.b4w_bloom_settings||{key:.2,blur:4,edge_lum:1}),"key"in u.b4w_bloom_settings||(v("scene",u,"b4w_bloom_settings.key"),u.b4w_bloom_settings.key=.2),"blur"in u.b4w_bloom_settings||(v("scene",u,"b4w_bloom_settings.blur"),u.b4w_bloom_settings.blur=4),"edge_lum"in u.b4w_bloom_settings||(v("scene",u,"b4w_bloom_settings.edge_lum"),u.b4w_bloom_settings.edge_lum=1),"adaptive"in u.b4w_bloom_settings||(v("scene",u,"b4w_bloom_settings.adaptive"),u.b4w_bloom_settings.adaptive=!0),"average_luminance"in u.b4w_bloom_settings||(v("scene",u,"b4w_bloom_settings.average_luminance"),u.b4w_bloom_settings.average_luminance=.5),"b4w_motion_blur_settings"in u||(v("scene",u,"b4w_motion_blur_settings"),u.b4w_motion_blur_settings=d.b4w_motion_blur_settings||{motion_blur_factor:.01,motion_blur_decay_threshold:.01}),"motion_blur_factor"in u.b4w_motion_blur_settings||(v("scene",u,"b4w_motion_blur_settings.motion_blur_factor"),u.b4w_motion_blur_settings.motion_blur_factor=.01),"motion_blur_decay_threshold"in u.b4w_motion_blur_settings||(v("scene",u,"b4w_motion_blur_settings.motion_blur_decay_threshold"),u.b4w_motion_blur_settings.motion_blur_decay_threshold=.01),"b4w_color_correction_settings"in u||(v("scene",u,"b4w_color_correction_settings"),u.b4w_color_correction_settings=d.b4w_color_correction_settings||{brightness:0,contrast:0,exposure:1,saturation:1}),"b4w_god_rays_settings"in u||(v("scene",u,"b4w_god_rays_settings"),u.b4w_god_rays_settings=d.b4w_god_rays_settings||{intensity:.7,max_ray_length:1,steps_per_pass:10}),"steps_per_pass"in u.b4w_god_rays_settings||(v("scene",u,"b4w_god_rays_settings.steps_per_pass"),u.b4w_god_rays_settings.steps_per_pass=10),!("b4w_glow_settings"in u)){v("scene",u,"b4w_glow_settings"),u.b4w_glow_settings={render_glow_over_blend:!1,small_glow_mask_coeff:2,large_glow_mask_coeff:2,small_glow_mask_width:2,large_glow_mask_width:6};var I=u.b4w_glow_settings;"b4w_render_glow_over_blend"in d&&(I.render_glow_over_blend=d.b4w_render_glow_over_blend),"b4w_small_glow_mask_coeff"in d&&(I.small_glow_mask_coeff=d.b4w_small_glow_mask_coeff),"b4w_large_glow_mask_coeff"in d&&(I.large_glow_mask_coeff=d.b4w_large_glow_mask_coeff),"b4w_small_glow_mask_width"in d&&(I.small_glow_mask_width=d.b4w_small_glow_mask_width),"b4w_large_glow_mask_width"in d&&(I.large_glow_mask_width=d.b4w_large_glow_mask_width)}var b=u.b4w_render_shadows;"AUTO"!=b&&"OFF"!=b&&"ON"!=b&&(u.b4w_render_shadows=b?"ON":"OFF");var Y=u.b4w_render_reflections;"OFF"!=Y&&"ON"!=Y&&(u.b4w_render_reflections=Y?"ON":"OFF");var L=u.b4w_render_refractions;"AUTO"!=L&&"OFF"!=L&&"ON"!=L&&(u.b4w_render_refractions=L?"ON":"OFF"),"b4w_render_dynamic_grass"in u||(v("scene",u,"b4w_render_dynamic_grass"),u.b4w_render_dynamic_grass="AUTO"),u.b4w_nla_script&&N("scene",u,"b4w_nla_script"),"audio_distance_model"in u||(v("scene",u,"audio_distance_model"),u.audio_distance_model="INVERSE_CLAMPED"),"b4w_custom_prop"in u||(v("scene",u,"b4w_custom_prop"),u.b4w_custom_prop=null)}var M=e.meshes;for(n=0;n<M.length;n++){var x=M[n];if(!x.b4w_boundings){v("mesh",x,"b4w_boundings"),x.b4w_boundings={};var y=x.b4w_boundings;y.bb=x.b4w_bounding_box?x.b4w_bounding_box:{max_x:0,max_y:0,max_z:0,min_x:0,min_y:0,min_z:0},y.bb_src=x.b4w_bounding_box_source?x.b4w_bounding_box_source:x.b4w_bounding_box,y.bs_cen=x.b4w_bounding_sphere_center?x.b4w_bounding_sphere_center:[0,0,0],y.bc_cen=x.b4w_bounding_cylinder_center?x.b4w_bounding_cylinder_center:[0,0,0],y.be_cen=x.b4w_bounding_ellipsoid_center?x.b4w_bounding_ellipsoid_center:[0,0,0],y.be_ax=x.b4w_bounding_ellipsoid_axes?x.b4w_bounding_ellipsoid_axes:[((C=y.bb).max_x-C.min_x)/2,(C.max_y-C.min_y)/2,(C.max_z-C.min_z)/2],y.rbb=x.b4w_rotated_bounding_box?x.b4w_rotated_bounding_box:{rbb_c:[((C=y.bb).max_x+C.min_x)/2,(C.max_y+C.min_y)/2,(C.max_z+C.min_z)/2],rbb_s:[1,1,1]},y.caxis_x=x.b4w_cov_axis_x?x.b4w_cov_axis_x:[1,0,0],y.caxis_y=x.b4w_cov_axis_y?x.b4w_cov_axis_y:[0,1,0],y.caxis_z=x.b4w_cov_axis_z?x.b4w_cov_axis_z:[0,0,1]}"is_boundings_overridden"in x||(v("mesh",x,"is_boundings_overridden"),x.is_boundings_overridden=!1),"b4w_shape_keys"in x||(x.b4w_shape_keys=[],v("mesh",x,"b4w_shape_keys"));for(var w=!0,U=0;U<x.submeshes.length;U++){var C,D=x.submeshes[U];"boundings"in D||(w=!1,D.boundings={be_ax:x.b4w_bounding_ellipsoid_axes,be_cen:x.b4w_bounding_ellipsoid_center,bb:{max_x:x.b4w_bounding_box.max_x,max_y:x.b4w_bounding_box.max_y,max_z:x.b4w_bounding_box.max_z,min_x:x.b4w_bounding_box.min_x,min_y:x.b4w_bounding_box.min_y,min_z:x.b4w_bounding_box.min_z}}),"uv_layers"in D||(v("submesh",x,"uv_layers"),D.uv_layers=x.uv_textures),"be_ax"in D.boundings||(D.boundings.be_ax=x.b4w_bounding_ellipsoid_axes),"be_cen"in D.boundings||(D.boundings.be_cen=x.b4w_bounding_ellipsoid_center),"bb"in D.boundings||(D.boundings.bb=x.b4w_bounding_box),"rbb"in D.boundings||(D.boundings.rbb={rbb_c:[((C=x.b4w_bounding_box).max_x+C.min_x)/2,(C.max_y+C.min_y)/2,(C.max_z+C.min_z)/2],rbb_s:[1,1,1]}),"caxis_x"in D.boundings||(D.boundings.caxis_x=[1,0,0]),"caxis_y"in D.boundings||(D.boundings.caxis_y=[0,1,0]),"caxis_z"in D.boundings||(D.boundings.caxis_z=[0,0,1])}for(w||v("mesh",x,"submesh_bd"),A(x),i=0;i<x.b4w_vertex_anim.length;i++){var F=x.b4w_vertex_anim[i];"allow_nla"in F||(v('mesh["b4w_vertex_anim"]',x,"allow_nla"),F.allow_nla=!0)}"active_uv_name"in x||(v("mesh",x,"active_uv_name"),x.active_uv_name="")}var G=e.cameras;for(n=0;n<G.length;n++){var k=G[n];k.type||(k.type="PERSP",v("camera",k,"type")),"b4w_eye_target_dist"in k&&(delete k.b4w_eye_target_dist,N("camera",k,"b4w_eye_target_dist")),"b4w_hover_zero_level"in k||(k.b4w_hover_zero_level=0,v("camera",k,"b4w_hover_zero_level")),"b4w_trans_velocity"in k||(k.b4w_trans_velocity=1,v("camera",k,"b4w_trans_velocity")),"b4w_rot_velocity"in k||(k.b4w_rot_velocity=1,v("camera",k,"b4w_rot_velocity")),"b4w_zoom_velocity"in k||(k.b4w_zoom_velocity=.1,v("camera",k,"b4w_zoom_velocity")),"b4w_use_target_distance_limits"in k||(k.b4w_use_target_distance_limits=k.b4w_use_distance_limits||!1,v("camera",k,"b4w_use_target_distance_limits")),"b4w_use_zooming"in k||(k.b4w_use_zooming=k.b4w_use_distance_limits||!1,v("camera",k,"b4w_use_zooming")),"b4w_distance_min"in k||(k.b4w_distance_min=1,v("camera",k,"b4w_distance_min")),"b4w_distance_max"in k||(k.b4w_distance_max=100,v("camera",k,"b4w_distance_max")),"b4w_horizontal_translation_min"in k||(k.b4w_horizontal_translation_min=-100,v("camera",k,"b4w_horizontal_translation_min")),"b4w_horizontal_translation_max"in k||(k.b4w_horizontal_translation_max=100,v("camera",k,"b4w_horizontal_translation_max")),"b4w_vertical_translation_min"in k||(k.b4w_vertical_translation_min=-100,v("camera",k,"b4w_vertical_translation_min")),"b4w_vertical_translation_max"in k||(k.b4w_vertical_translation_max=100,v("camera",k,"b4w_vertical_translation_max")),"b4w_use_horizontal_clamping"in k||(k.b4w_use_horizontal_clamping=!1,v("camera",k,"b4w_use_horizontal_clamping")),"b4w_rotation_left_limit"in k||(k.b4w_rotation_left_limit=-Math.PI,v("camera",k,"b4w_rotation_left_limit")),"b4w_rotation_right_limit"in k||(k.b4w_rotation_right_limit=Math.PI,v("camera",k,"b4w_rotation_right_limit")),"b4w_horizontal_clamping_type"in k||(k.b4w_horizontal_clamping_type="LOCAL",v("camera",k,"b4w_horizontal_clamping_type")),"b4w_use_vertical_clamping"in k||(k.b4w_use_vertical_clamping=!1,v("camera",k,"b4w_use_vertical_clamping")),"b4w_rotation_down_limit"in k||(k.b4w_rotation_down_limit=-Math.PI/2,v("camera",k,"b4w_rotation_down_limit")),"b4w_rotation_up_limit"in k||(k.b4w_rotation_up_limit=Math.PI/2,v("camera",k,"b4w_rotation_up_limit")),"b4w_vertical_clamping_type"in k||(k.b4w_vertical_clamping_type="LOCAL",v("camera",k,"b4w_vertical_clamping_type")),"b4w_hover_angle_min"in k||(k.b4w_hover_angle_min=Math.PI/6,v("camera",k,"b4w_hover_angle_min")),"b4w_hover_angle_max"in k||(k.b4w_hover_angle_max=Math.PI/6,v("camera",k,"b4w_hover_angle_max")),"b4w_enable_hover_hor_rotation"in k||(k.b4w_enable_hover_hor_rotation=!0,v("camera",k,"b4w_enable_hover_hor_rotation")),"b4w_use_panning"in k||(k.b4w_use_panning=!0,v("camera",k,"b4w_use_panning")),"b4w_use_pivot_limits"in k||(k.b4w_use_pivot_limits=!1,k.b4w_pivot_z_min=0,k.b4w_pivot_z_max=10,v("camera",k,"b4w_use_pivot_limits")),"b4w_dof_bokeh"in k||(k.b4w_dof_bokeh=!1,v("camera",k,"b4w_dof_bokeh")),"b4w_dof_bokeh_intensity"in k||(k.b4w_dof_bokeh_intensity=.3,v("camera",k,"b4w_dof_bokeh_intensity")),"b4w_dof_foreground_blur"in k||(k.b4w_dof_foreground_blur=!1,v("camera",k,"b4w_dof_foreground_blur")),"b4w_dof_front_start"in k||(k.b4w_dof_front_start=0,v("camera",k,"b4w_dof_front_start")),"b4w_dof_front_end"in k||(k.b4w_dof_front_end=k.b4w_dof_front,v("camera",k,"b4w_dof_front_end")),"b4w_dof_rear_start"in k||(k.b4w_dof_rear_start=0,v("camera",k,"b4w_dof_rear_start")),"b4w_dof_rear_end"in k||(k.b4w_dof_rear_end=k.b4w_dof_rear,v("camera",k,"b4w_dof_rear_end")),"sensor_fit"in k||(k.sensor_fit="VERTICAL",v("camera",k,"sensor_fit"))}var K=e.lamps;for(n=0;n<K.length;n++){var B=K[n];"b4w_generate_shadows"in B||(B.b4w_generate_shadows=!1,v("lamp",B,"b4w_generate_shadows")),"b4w_dynamic_intensity"in B||(B.b4w_dynamic_intensity=!1,v("lamp",B,"b4w_dynamic_intensity")),"use_diffuse"in B||(B.use_diffuse=!0,v("lamp",B,"use_diffuse")),"use_specular"in B||(B.use_specular=!0,v("lamp",B,"use_specular")),"clip_start"in B||(B.clip_start=.1,v("lamp",B,"clip_start")),"clip_end"in B||(B.clip_end=30,v("lamp",B,"clip_end")),"POINT"!=B.type&&"SPOT"!=B.type||("use_sphere"in B||(B.use_sphere=!1,v("lamp",B,"use_sphere")),s.mali4_lamps_hack&&(B.type="SUN"))}var X=e.speakers;for(n=0;n<X.length;n++){var H=X[n];"b4w_behavior"in H||(H.b4w_behavior=H.b4w_background_music?"BACKGROUND_SOUND":"POSITIONAL"),"b4w_auto_play"in H||(H.b4w_auto_play=!1,v("speaker",H,"b4w_auto_play")),"b4w_enable_doppler"in H||(H.b4w_enable_doppler=!1,v("speaker",H,"b4w_enable_doppler")),"b4w_delay"in H||(H.b4w_delay=0),"b4w_delay_random"in H||(H.b4w_delay_random=0),"b4w_volume_random"in H||(H.b4w_volume_random=0),"b4w_pitch_random"in H||(H.b4w_pitch_random=0),"b4w_fade_in"in H||(H.b4w_fade_in=0),"b4w_fade_out"in H||(H.b4w_fade_out=0),"b4w_loop"in H||(H.b4w_loop=!1),"b4w_loop_start"in H||(H.b4w_loop_start=0,v("speaker",H,"b4w_loop_start")),"b4w_loop_end"in H||(H.b4w_loop_end=0,v("speaker",H,"b4w_loop_end")),H.animation_data&&P(H.animation_data)}var Q=e.textures;for(n=0;n<Q.length;n++){var z=Q[n];"b4w_anisotropic_filtering"in z||(z.b4w_anisotropic_filtering="OFF",v("texture",z,"b4w_anisotropic_filtering")),"b4w_water_foam"in z||(z.b4w_water_foam=!1,v("texture",z,"b4w_water_foam")),"b4w_foam_uv_freq"in z||(z.b4w_foam_uv_freq=[1,1],v("texture",z,"b4w_foam_uv_freq")),"b4w_foam_uv_magnitude"in z||(z.b4w_foam_uv_magnitude=[1,1],v("texture",z,"b4w_foam_uv_magnitude")),"b4w_parallax_steps"in z||(z.b4w_parallax_steps=5,v("material",z,"b4w_parallax_steps")),"b4w_parallax_lod_dist"in z||(z.b4w_parallax_lod_dist=10,v("material",z,"b4w_parallax_lod_dist")),"b4w_shore_dist_map"in z||(z.b4w_shore_dist_map=!1,v("texture",z,"b4w_shore_dist_map")),"b4w_shore_boundings"in z||(z.b4w_shore_boundings=[1e3,-1e3,1e3,-1e3],v("texture",z,"b4w_shore_boundings")),"b4w_max_shore_dist"in z||(z.b4w_max_shore_dist=100,v("texture",z,"b4w_max_shore_dist")),"b4w_disable_compression"in z||(z.b4w_disable_compression=!1,v("texture",z,"b4w_disable_compression")),"b4w_source_type"in z||(z.b4w_source_type="",v("texture",z,"b4w_source_type")),"b4w_source_id"in z||(z.b4w_source_id="",v("texture",z,"b4w_source_id")),"b4w_source_size"in z||(z.b4w_source_size=1024,v("texture",z,"b4w_source_size")),"b4w_enable_canvas_mipmapping"in z||(z.b4w_enable_canvas_mipmapping=!0,v("texture",z,"b4w_enable_canvas_mipmapping")),"b4w_nla_video"in z||(z.b4w_nla_video=!1,v("texture",z,"b4w_nla_video"))}var V=e.images;for(n=0;n<V.length;n++){var j=V[n];"colorspace_settings_name"in j||(j.colorspace_settings_name="sRGB",v("image",j,"colorspace_settings_name"))}var q=e.materials;for(n=0;n<q.length;n++){var W=q[n];"ALPHA_ANTIALIASING"==W.game_settings.alpha_blend&&(s.mali_alpha_antialias_hack?W.game_settings.alpha_blend="CLIP":s.msaa_samples<2&&(a.warn('Material "'+W.name+'" has the "Alpha Anti-Aliasing" transparency type, but multisampling is disabled. Changed to "Alpha Clip".'),W.game_settings.alpha_blend="CLIP")),"use_tangent_shading"in W||(W.use_tangent_shading=!1,v("material",W,"use_tangent_shading")),"b4w_node_mat_type"in W&&N("material",W,"b4w_node_mat_type"),"b4w_skydome"in W&&N("material",W,"b4w_skydome"),"b4w_procedural_skydome"in W&&N("material",W,"b4w_procedural_skydome"),"b4w_lens_flares"in W||(W.b4w_lens_flares=!1,v("material",W,"b4w_lens_flares")),"LENS_FLARES"===W.name&&(W.b4w_lens_flares||a.warn('"LENS_FLARES" material name has been found. Enable the "Lens Flare" property for this material.'),W.b4w_lens_flares=!0),W.b4w_water&&("b4w_water_shore_smoothing"in W||(W.b4w_water_shore_smoothing=!1,v("material",W,"b4w_water_shore_smoothing")),"b4w_water_dynamic"in W||(W.b4w_water_dynamic=!1,v("material",W,"b4w_water_dynamic")),"b4w_waves_height"in W||(W.b4w_waves_height=1,v("material",W,"b4w_waves_height")),"b4w_waves_length"in W||(W.b4w_waves_length=1,v("material",W,"b4w_waves_length")),"b4w_water_dst_noise_scale0"in W||(W.b4w_water_dst_noise_scale0=.05,v("material",W,"b4w_water_dst_noise_scale0")),"b4w_water_dst_noise_scale1"in W||(W.b4w_water_dst_noise_scale1=.03,v("material",W,"b4w_water_dst_noise_scale1")),"b4w_water_dst_noise_freq0"in W||(W.b4w_water_dst_noise_freq0=1.3,v("material",W,"b4w_water_dst_noise_freq0")),"b4w_water_dst_noise_freq1"in W||(W.b4w_water_dst_noise_freq1=1,v("material",W,"b4w_water_dst_noise_freq1")),"b4w_water_dir_min_shore_fac"in W||(W.b4w_water_dir_min_shore_fac=.4,v("material",W,"b4w_water_dir_min_shore_fac")),"b4w_water_dir_freq"in W||(W.b4w_water_dir_freq=.5,v("material",W,"b4w_water_dir_freq")),"b4w_water_dir_noise_scale"in W||(W.b4w_water_dir_noise_scale=.05,v("material",W,"b4w_water_dir_noise_scale")),"b4w_water_dir_noise_freq"in W||(W.b4w_water_dir_noise_freq=.07,v("material",W,"b4w_water_dir_noise_freq")),"b4w_water_dir_min_noise_fac"in W||(W.b4w_water_dir_min_noise_fac=.5,v("material",W,"b4w_water_dir_min_noise_fac")),"b4w_water_dst_min_fac"in W||(W.b4w_water_dst_min_fac=.2,v("material",W,"b4w_water_dst_min_fac")),"b4w_water_waves_hor_fac"in W||(W.b4w_water_waves_hor_fac=5,v("material",W,"b4w_water_waves_hor_fac")),"b4w_water_absorb_factor"in W||(W.b4w_water_absorb_factor=6,v("material",W,"b4w_water_absorb_factor")),"b4w_water_fog_color"in W||(W.b4w_water_fog_color=[.5,.7,.7],v("material",W,"b4w_water_fog_color")),"b4w_foam_factor"in W||(W.b4w_foam_factor=5,v("material",W,"b4w_foam_factor")),"b4w_generated_mesh"in W||(W.b4w_generated_mesh=!1,v("material",W,"b4w_generated_mesh")),"b4w_water_num_cascads"in W||(W.b4w_water_num_cascads=5,v("material",W,"b4w_water_num_cascads")),"b4w_water_subdivs"in W||(W.b4w_water_subdivs=64,v("material",W,"b4w_water_subdivs")),"b4w_water_detailed_dist"in W||(W.b4w_water_detailed_dist=1e3,v("material",W,"b4w_water_detailed_dist")),"b4w_water_enable_caust"in W||(W.b4w_water_enable_caust=!1,v("material",W,"b4w_water_enable_caust")),"b4w_water_caust_scale"in W||(W.b4w_water_caust_scale=.25,v("material",W,"b4w_water_caust_scale")),"b4w_water_caust_brightness"in W||(W.b4w_water_caust_brightness=.5,v("material",W,"b4w_water_caust_brightness"))),"b4w_dynamic_grass_size"in W||(W.b4w_dynamic_grass_size=""),"b4w_dynamic_grass_color"in W||(W.b4w_dynamic_grass_color=""),"diffuse_intensity"in W||(W.diffuse_intensity=1,v("material",W,"diffuse_intensity")),"b4w_use_ghost"in W||(W.b4w_use_ghost=!1),"b4w_collision_margin"in W||(W.b4w_collision_margin=.04,v("material",W,"b4w_collision_margin")),"b4w_collision_group"in W||(W.b4w_collision_group=128,v("material",W,"b4w_collision_group")),"b4w_collision_mask"in W||(W.b4w_collision_mask=127,v("material",W,"b4w_collision_mask")),"b4w_do_not_render"in W||(W.b4w_do_not_render=!1,v("material",W,"b4w_do_not_render")),"HALO"!=W.type||"b4w_halo_sky_stars"in W||(W.b4w_halo_sky_stars=!1,v("material",W,"b4w_halo_sky_stars")),"HALO"!=W.type||"b4w_halo_stars_blend_height"in W||(W.b4w_halo_stars_blend_height=10,v("material",W,"b4w_halo_stars_blend_height")),"HALO"!=W.type||"b4w_halo_stars_min_height"in W||(W.b4w_halo_stars_min_height=0,v("material",W,"b4w_halo_stars_min_height")),"specular_shader"in W||(W.specular_shader="COOKTORR",v("material",W,"specular_shader")),"diffuse_shader"in W||(W.diffuse_shader="LAMBERT",v("material",W,"diffuse_shader")),"roughness"in W||(W.roughness=.5,v("material",W,"roughness")),"diffuse_fresnel"in W||(W.diffuse_fresnel=.1,v("material",W,"diffuse_fresnel")),"diffuse_fresnel_factor"in W||(W.diffuse_fresnel_factor=.5,v("material",W,"diffuse_fresnel_factor")),"specular_slope"in W||(W.specular_slope=.2,v("material",W,"specular_slope")),"specular_toon_size"in W||(W.specular_toon_size=.5,v("material",W,"specular_toon_size")),"specular_toon_smooth"in W||(W.specular_toon_smooth=.1,v("material",W,"specular_toon_smooth")),"specular_alpha"in W||(W.specular_alpha=1,v("material",W,"specular_alpha")),"b4w_wettable"in W||(W.b4w_wettable=!1,v("material",W,"b4w_wettable")),"b4w_refractive"in W||(W.b4w_refractive=!1,v("material",W,"b4w_refractive")),"b4w_refr_bump"in W||(W.b4w_refr_bump=0,v("material",W,"b4w_refr_bump")),"b4w_shallow_water_col"in W||(W.b4w_shallow_water_col=[0,.8,.3],v("material",W,"b4w_shallow_water_col")),"b4w_shore_water_col"in W||(W.b4w_shore_water_col=[0,.9,.2],v("material",W,"b4w_shore_water_col")),"b4w_shallow_water_col_fac"in W||(W.b4w_shallow_water_col_fac=1,v("material",W,"b4w_shallow_water_col_fac")),"b4w_shore_water_col_fac"in W||(W.b4w_shore_water_col_fac=.5,v("material",W,"b4w_shore_water_col_fac")),"b4w_water_sss_strength"in W||(W.b4w_water_sss_strength=5.9,v("material",W,"b4w_water_sss_strength")),"b4w_water_sss_width"in W||(W.b4w_water_sss_width=.45,v("material",W,"b4w_water_sss_width")),"b4w_render_above_all"in W||(W.b4w_render_above_all=!1,v("material",W,"b4w_render_above_all")),"b4w_water_norm_uv_velocity"in W||(W.b4w_water_norm_uv_velocity=.05,v("material",W,"b4w_water_norm_uv_velocity")),"specular_ior"in W||(W.specular_ior=1,v("material",W,"specular_ior")),"darkness"in W||(W.darkness=0,v("material",W,"darkness")),"diffuse_toon_size"in W||(W.diffuse_toon_size=0,v("material",W,"diffuse_toon_size")),"diffuse_toon_smooth"in W||(W.diffuse_toon_smooth=0,v("material",W,"diffuse_toon_smooth")),"pass_index"in W||(W.pass_index=0,v("material",W,"pass_index"));for(o=W.texture_slots,i=0;i<o.length;i++){var J;"blend_type"in(J=o[i])||(J.blend_type="MIX",v("texture_slot",J,"blend_type"))}if(W.node_tree){var Z=W.node_tree.nodes;for(i=0;i<Z.length;i++)f(Z[i]);W.node_tree.animation_data&&P(W.node_tree.animation_data)}}var $=e.node_groups;for(n=0;n<$.length;n++)for(Z=$[n].node_tree.nodes,i=0;i<Z.length;i++)f(Z[i]);var ee=e.objects;for(n=0;n<ee.length;n++){var te=ee[n];switch(te.type){case"MESH":"b4w_dynamic_geometry"in te||(te.b4w_dynamic_geometry=!1),"b4w_reflexible"in te||(te.b4w_reflexible=!1),"b4w_reflexible_only"in te||(te.b4w_reflexible_only=!1),"b4w_reflective"in te||(te.b4w_reflective=!1),"b4w_reflection_type"in te||(te.b4w_reflection_type="PLANE",v("object",te,"b4w_reflection_type")),"b4w_wind_bending"in te||(te.b4w_wind_bending=!1,v("object",te,"b4w_wind_bending")),"b4w_wind_bending_angle"in te||(te.b4w_wind_bending_angle=10,te.b4w_wind_bending_freq=.25,v("object",te,"wind bending params")),"b4w_detail_bending_amp"in te||(te.b4w_detail_bending_amp=.1,te.b4w_branch_bending_amp=.3,v("object",te,"detail bending params")),"b4w_detail_bending_freq"in te||(te.b4w_detail_bending_freq=1,v("object",te,"b4w_detail_bending_freq")),"b4w_main_bend_stiffness_col"in te||(te.b4w_main_bend_stiffness_col="",v("object",te,"b4w_main_bend_stiffness_col")),"b4w_detail_bend_colors"in te||(te.b4w_detail_bend_colors={leaves_stiffness_col:"",leaves_phase_col:"",overall_stiffness_col:""},v("object",te,"b4w_detail_bend_colors")),"b4w_caustics"in te||(te.b4w_caustics=!1),"vertex_groups"in te&&te.vertex_groups.length&&te.data&&0==te.data.vertex_groups.length&&(te.data.vertex_groups=te.vertex_groups,delete te.vertex_groups,v("object",te,"vertex_groups")),"b4w_vertex_anim"in te&&te.b4w_vertex_anim.length&&te.data&&0==te.data.b4w_vertex_anim.length&&(te.data.b4w_vertex_anim=te.b4w_vertex_anim,delete te.b4w_vertex_anim,v("object",te,"b4w_vertex_anim")),"b4w_do_not_render"in te||(te.b4w_do_not_render=!1),"b4w_hidden_on_load"in te||(te.b4w_hidden_on_load=!1),"b4w_hide_chldr_on_load"in te||(te.b4w_hide_chldr_on_load=!1),"use_ghost"in te.game||(te.game.use_ghost=!1),"use_sleep"in te.game||(te.game.use_sleep=!1),"velocity_min"in te.game||(te.game.velocity_min=0),"velocity_max"in te.game||(te.game.velocity_max=0),"collision_group"in te.game||(te.game.collision_group=1),"collision_mask"in te.game||(te.game.collision_mask=255),S(te),"b4w_vehicle_settings"in te?te.b4w_vehicle_settings&&("steering_ratio"in te.b4w_vehicle_settings||(te.b4w_vehicle_settings.steering_ratio=10),"steering_max"in te.b4w_vehicle_settings||(te.b4w_vehicle_settings.steering_max=1),"inverse_control"in te.b4w_vehicle_settings||(te.b4w_vehicle_settings.inverse_control=!1),"force_max"in te.b4w_vehicle_settings||(te.b4w_vehicle_settings.force_max=1500),"brake_max"in te.b4w_vehicle_settings||(te.b4w_vehicle_settings.brake_max=100),"speed_ratio"in te.b4w_vehicle_settings||(te.b4w_vehicle_settings.speed_ratio=.027),"max_speed_angle"in te.b4w_vehicle_settings||(te.b4w_vehicle_settings.max_speed_angle=Math.PI),"delta_tach_angle"in te.b4w_vehicle_settings||(te.b4w_vehicle_settings.delta_tach_angle=4.43),"suspension_compression"in te.b4w_vehicle_settings||(te.b4w_vehicle_settings.suspension_compression=4.4),"suspension_stiffness"in te.b4w_vehicle_settings||(te.b4w_vehicle_settings.suspension_stiffness=20),"suspension_damping"in te.b4w_vehicle_settings||(te.b4w_vehicle_settings.suspension_damping=2.3),"wheel_friction"in te.b4w_vehicle_settings||(te.b4w_vehicle_settings.wheel_friction=1e3),"roll_influence"in te.b4w_vehicle_settings||(te.b4w_vehicle_settings.roll_influence=.1),"max_suspension_travel_cm"in te.b4w_vehicle_settings||(te.b4w_vehicle_settings.max_suspension_travel_cm=30),"floating_factor"in te.b4w_vehicle_settings||(te.b4w_vehicle_settings.floating_factor=3),"floating_factor"in te.b4w_vehicle_settings||(te.b4w_vehicle_settings.floating_factor=3),"water_lin_damp"in te.b4w_vehicle_settings||(te.b4w_vehicle_settings.water_lin_damp=.9),"water_rot_damp"in te.b4w_vehicle_settings||(te.b4w_vehicle_settings.water_rot_damp=.9)):(te.b4w_vehicle_settings=null,v("object",te,"b4w_vehicle_settings")),"b4w_floating_settings"in te?te.b4w_floating_settings&&("floating_factor"in te.b4w_floating_settings||(te.b4w_floating_settings.floating_factor=3),"water_lin_damp"in te.b4w_floating_settings||(te.b4w_floating_settings.water_lin_damp=.8),"water_rot_damp"in te.b4w_floating_settings||(te.b4w_floating_settings.water_rot_damp=.8)):(te.b4w_floating_settings=null,v("object",te,"b4w_floating_settings")),"b4w_character_settings"in te?te.b4w_character_settings&&("walk_speed"in te.b4w_character_settings||(te.b4w_character_settings.walk_speed=4),"run_speed"in te.b4w_character_settings||(te.b4w_character_settings.run_speed=8),"step_height"in te.b4w_character_settings||(te.b4w_character_settings.step_height=.25),"jump_strength"in te.b4w_character_settings||(te.b4w_character_settings.jump_strength=5),"waterline"in te.b4w_character_settings||(te.b4w_character_settings.waterline=0)):(te.b4w_character_settings=null,v("object",te,"b4w_character_settings")),"b4w_selectable"in te||(te.b4w_selectable=!1,v("object",te,"b4w_selectable")),"b4w_outlining"in te||(te.b4w_outlining=!1,v("object",te,"b4w_outlining")),"b4w_outline_on_select"in te||(te.b4w_outline_on_select=!1,v("object",te,"b4w_outline_on_select")),"b4w_billboard"in te||(te.b4w_billboard=!1,v("object",te,"b4w_billboard")),"b4w_billboard_geometry"in te||(te.b4w_billboard_geometry="SPHERICAL",v("object",te,"b4w_billboard_geometry")),"b4w_pres_glob_orientation"in te||(te.b4w_pres_glob_orientation=!1,v("object",te,"b4w_pres_glob_orientation")),"b4w_outline_settings"in te||("b4w_glow_settings"in te?te.b4w_outline_settings=te.b4w_glow_settings:(te.b4w_outline_settings={},te.b4w_outline_settings.outline_duration=1,te.b4w_outline_settings.outline_period=1,te.b4w_outline_settings.outline_relapses=0),v("object",te,"b4w_outline_settings")),"lod_levels"in te||(te.lod_levels=[],v("object",te,"lod_levels")),"b4w_animation_mixing"in te||(te.b4w_animation_mixing=!1,v("object",te,"b4w_animation_mixing"));break;case"EMPTY":"b4w_anchor"in te||(te.b4w_anchor=null,v("object",te,"b4w_anchor")),!te.b4w_anchor||"max_width"in te.b4w_anchor||(te.b4w_anchor.max_width=250)}if("collision_margin"in te.game||(te.game.collision_margin=.04,v("object",te,"collision_margin")),"b4w_anim_behavior"in te||(te.b4w_anim_behavior=te.b4w_cyclic_animation?"CYCLIC":"FINISH_STOP",v("object",te,"b4w_anim_behavior")),!("rotation_quaternion"in te)){var re=[0,0,0,1];rn(te.rotation_euler,re),O(re,re),te.rotation_quaternion=re,v("object",te,"rotation_quaternion")}"webgl_do_not_batch"in te&&(te.b4w_do_not_batch=te.webgl_do_not_batch,te.webgl_do_not_batch&&N("object",te,"webgl_do_not_batch")),"b4w_shadow_cast_only"in te||(te.b4w_shadow_cast_only=!1,v("object",te,"b4w_shadow_cast_only")),"b4w_correct_bounding_offset"in te||(te.b4w_correct_bounding_offset="AUTO",v("object",te,"b4w_correct_bounding_offset"));var _e=te.particle_systems;for(i=0;i<_e.length;i++){var ne=_e[i],ae=ne.settings;"use_rotation_dupli"in ae||(ae.use_rotation_dupli=!1,v("particle_settings",ae,"use_rotation_dupli")),"use_whole_group"in ae||(ae.use_whole_group=!1,v("particle_settings",ae,"use_whole_group")),ne.transforms||(ne.transforms=new Float32Array,v("particle_system",ne,"transforms")),"b4w_billboard_align"in ae||(ae.b4w_billboard_align="VIEW",v("particle_settings",ae,"b4w_billboard_align")),"b4w_dynamic_grass"in ae||(ae.b4w_dynamic_grass=!1,v("object",ae,"b4w_dynamic_grass")),"b4w_dynamic_grass_scale_threshold"in ae||(ae.b4w_dynamic_grass_scale_threshold=.01,v("object",ae,"b4w_dynamic_grass_scale_threshold")),"b4w_initial_rand_rotation"in ae||(ae.b4w_initial_rand_rotation=!1,v("particle_settings",ae,"b4w_initial_rand_rotation")),"b4w_rotation_type"in ae||(ae.b4w_rotation_type="Z",v("particle_settings",ae,"b4w_rotation_type")),"b4w_rand_rotation_strength"in ae||(ae.b4w_rand_rotation_strength=1,v("particle_settings",ae,"b4w_rand_rotation_strength")),"b4w_hair_billboard"in ae||(ae.b4w_hair_billboard=!1,v("particle_settings",ae,"b4w_hair_billboard")),"b4w_hair_billboard_type"in ae||(ae.b4w_hair_billboard_type="BASIC",v("particle_settings",ae,"b4w_hair_billboard_type")),"b4w_hair_billboard_jitter_amp"in ae||(ae.b4w_hair_billboard_jitter_amp=0,v("particle_settings",ae,"b4w_hair_billboard_jitter_amp")),"b4w_hair_billboard_jitter_freq"in ae||(ae.b4w_hair_billboard_jitter_freq=0,v("particle_settings",ae,"b4w_hair_billboard_jitter_freq")),"b4w_hair_billboard_geometry"in ae||(ae.b4w_hair_billboard_geometry="SPHERICAL",v("particle_settings",ae,"b4w_hair_billboard_geometry")),"b4w_wind_bend_inheritance"in ae||(ae.b4w_wind_bend_inheritance="PARENT",v("particle_settings",ae,"b4w_wind_bend_inheritance")),"b4w_shadow_inheritance"in ae||(ae.b4w_shadow_inheritance="PARENT",v("particle_settings",ae,"b4w_shadow_inheritance")),"b4w_reflection_inheritance"in ae||(ae.b4w_reflection_inheritance="PARENT",v("particle_settings",ae,"b4w_reflection_inheritance")),"b4w_vcol_from_name"in ae||(ae.b4w_vcol_from_name="",v("particle_settings",ae,"b4w_vcol_from_name")),"b4w_vcol_to_name"in ae||(ae.b4w_vcol_to_name="",v("particle_settings",ae,"b4w_vcol_to_name")),"b4w_coordinate_system"in ae||(ae.b4w_coordinate_system="LOCAL",v("particle_settings",ae,"b4w_coordinate_system")),"b4w_allow_nla"in ae||(ae.b4w_allow_nla=!0,v("particle_settings",ae,"b4w_allow_nla")),"b4w_enable_soft_particles"in ae||(ae.b4w_enable_soft_particles=!1,v("particle_settings",ae,"b4w_enable_soft_particles")),"b4w_particles_softness"in ae||(ae.b4w_particles_softness=1,v("particle_settings",ae,"b4w_particles_softness")),"billboard_tilt"in ae||(ae.billboard_tilt=0,v("particle_settings",ae,"billboard_tilt")),"billboard_tilt_random"in ae||(ae.billboard_tilt_random=0,v("particle_settings",ae,"billboard_tilt_random")),"use_rotations"in ae||(ae.use_rotations=!1,v("particle_settings",ae,"use_rotations"))}"constraints"in te||(te.constraints=[],v("object",te,"constraints"));var oe=te.constraints;for(i=0;i<oe.length;i++){var ie=oe[i];"influence"in ie||(ie.influence=1),"axes"in ie||(ie.axes=[1,1,1])}var se=te.modifiers;for(i=0;i<se.length;i++)t(se[i],te)||(se.splice(i,1),i--);if("animation_data"in te||(te.animation_data={action:null,nla_tracks:[]},v("object",te,"animation_data")),te.animation_data){if("action"in te.animation_data){if(te.animation_data.action){var Ee=te.animation_data.action.fcurves;for(var ce in Ee){var le=Ee[ce];for(var Te in le){var ue=le[Te];"num_channels"in ue||(ue.num_channels=1,g('B4W Warning: no channels number in animation fcurve for "'+te.animation_data.action.name+'" action, reexport scene'))}}}}else te.animation_data.action=null,g("no action in animation data "+te.name);"nla_tracks"in te.animation_data||(te.animation_data.nla_tracks=[],g("no NLA in animation data "+te.name)),P(te.animation_data)}"b4w_collision_id"in te||(te.b4w_collision_id="",v("object",te,"b4w_collision_id")),"b4w_viewport_alignment"in te||(te.b4w_viewport_alignment=null,v("object",te,"b4w_viewport_alignment")),"pinverse_tsr"in te||(te.pinverse_tsr=null,v("object",te,"pinverse_tsr")),"b4w_cluster_data"in te||(te.b4w_cluster_data={cluster_id:-1,cluster_center:null},v("object",te,"b4w_cluster_data")),"pass_index"in te||(te.pass_index=0,v("object",te,"pass_index")),"b4w_custom_prop"in te||(v("object",te,"b4w_custom_prop"),te.b4w_custom_prop=null),R(te)&&g('negative scale for object "'+te.name+'", can lead to some errors'),h(te)||g("non-uniform scale for object "+te.name)}for(var de in c&&a.error("Compatibility issues detected"),l){var fe=l[de],Pe=de.match(/.*?(?=>>|$)/i)[0];a.warn('Property "'+String(Pe)+'" is '+fe.report_type+' for "'+fe.type+'". To fix this, reexport '+e.b4w_filepath_blend)}},t.apply_mesh_modifiers=function(e){if(!function(e){for(var t=e.modifiers,r=0;r<t.length;r++){var _=t[r].type;if("ARRAY"==_||"CURVE"==_)return!0}return!1}(e))return null;for(var t=L(e.data,e.data.name+"_MOD"),r=e.modifiers,_=0;_<r.length;_++){var n=r[_];switch(n.type){case"ARRAY":I(t,n);break;case"CURVE":b(t,n)}Ho(t)}return t},t.assign_logic_nodes_object_params=function(e,t,r){function _(t,r){var _=t[0];if(t.length>1)for(var n=1;n<t.length;n++)_+="*"+t[n];for(n=0;n<e.length;n++){var a=e[n];if(a.name==_)for(var o in r)a[o]=r[o]}}function n(e,t){for(var r in e)_(e[r],t)}for(var a=r.b4w_logic_nodes,s=0;s<a.length;s++)for(var E=a[s],c=0;c<E.length;c++){var l=E[c],T={register1:"variable1",register2:"variable2",registerd:"variabled"};for(var u in T)u in l&&(l[T[u]]=l[u]);for(var d in l.variables)"boolean"!=typeof l.variables[d][0]&&(l.variables[d]=[!1,l.variables[d]]);for(var f in["MATH","CONDJUMP","PAGEPARAM","REGSTORE"].indexOf(l.type)>=0&&("variable1"in l&&(l.variables.id0=[!1,l.variable1]),"variable2"in l&&(l.variables.id1=[!1,l.variable2]),"variabled"in l&&(l.variables.vd=[!1,l.variabled])),l.links)f.startsWith("id")||delete l.links[f];var P=l.common_usage_names,A=l.variables;switch(l.type){case"SELECT":for(var S=0;S<e.length;S++){var p=e[S];p.name==l.object&&(p.b4w_selectable=!0)}l.bools||(l.bools={}),l.bools.not_wait||(l.bools.not_wait=!1),g('Logic nodes type "SELECT" is deprecated');break;case"SWITCH_SELECT":if(n(l.objects_paths,{b4w_selectable:!0}),l.links instanceof Array){g('Format of a "SWITCH_SELECT" node is outdated. It is recommended to reexport the scene "'+r.name+'"');var m={},O=0;for(S in l.objects_paths)m[S]=l.links[O],O++;l.links=m}break;case"SELECT_PLAY":g('Logic nodes type "SELECT_PLAY" is deprecated, node will be muted. To fix this, reexport the scene "'+r.name+'"'),l.mute=!0;break;case"SELECT_PLAY_ANIM":g('Logic nodes type "SELECT_PLAY_ANIM" is deprecated');break;case"SHOW":case"HIDE":l.bools||(l.bools={}),void 0===l.bools.ch&&(l.bools.ch=!1),l.bools.id0||n(l.objects_paths,{b4w_do_not_batch:!0});break;case"SET_SHADER_NODE_PARAM":case"INHERIT_MAT":n(l.objects_paths,{b4w_do_not_batch:!0});break;case"PLAY":r.b4w_use_nla=!0;break;case"MOVE_TO":n(l.objects_paths,{b4w_do_not_batch:!0});break;case"TRANSFORM_OBJECT":switch(n(l.objects_paths,{b4w_do_not_batch:!0}),P.space_type){case"WORLD":P.space_type=o.NST_WORLD;break;case"PARENT":P.space_type=o.NST_PARENT;break;case"LOCAL":P.space_type=o.NST_LOCAL}break;case"OUTLINE":n(l.objects_paths,{b4w_outlining:!0});break;case"CONDJUMP":if(l.condition&&(P.condition=l.condition),"cnd"in l.floats)P.condition=l.floats.cnd;else switch(P.condition){case"GEQUAL":P.condition=o.NC_GEQUAL;break;case"LEQUAL":P.condition=o.NC_LEQUAL;break;case"GREATER":P.condition=o.NC_GREATER;break;case"LESS":P.condition=o.NC_LESS;break;case"NOTEQUAL":P.condition=o.NC_NOTEQUAL;break;case"EQUAL":P.condition=o.NC_EQUAL}switch(void 0!=l.number1&&(l.input1=l.number1),void 0!=l.number2&&(l.input2=l.number2),l.bools||(l.bools={}),l.bools.str&&(P.variable_type="STRING"),P.variable_type){case"NUMBER":P.variable_type=o.NT_NUMBER;break;case"STRING":P.variable_type=o.NT_STRING;break;case"OBJECT":P.variable_type=o.NT_OBJECT}void 0===P.variable_type&&(P.variable_type=o.NT_NUMBER,l.floats.inp1=l.input1,l.floats.inp2=l.input2),void 0===A.id0&&(A.id0=A.v1,A.id1=A.v2);break;case"SEND_REQ":l.bools||(l.bools={}),l.strings||(l.strings={}),void 0===l.bools.ct&&(l.bools.ct=!1),void 0!=l.url&&(l.bools.url=!1,l.strings.url=l.url);break;case"MATH":switch(void 0!=l.number1&&(l.input1=l.number1),void 0!=l.number2&&(l.input2=l.number2),void 0!=l.input1&&(l.floats.inp1=l.input1),void 0!=l.input2&&(l.floats.inp2=l.input2),l.operation){case"DIV":l.operation=o.NMO_DIV;break;case"SUB":l.operation=o.NMO_SUB;break;case"MUL":l.operation=o.NMO_MUL;break;case"ADD":l.operation=o.NMO_ADD;break;case"RAND":l.operation=o.NMO_RAND;break;case"SIN":l.operation=o.NMO_SIN;break;case"COS":l.operation=o.NMO_COS;break;case"TAN":l.operation=o.NMO_TAN;break;case"ARCSIN":l.operation=o.NMO_ARCSIN;break;case"ARCCOS":l.operation=o.NMO_ARCCOS;break;case"ARCTAN":l.operation=o.NMO_ARCTAN;break;case"LOG":l.operation=o.NMO_LOG;break;case"MIN":l.operation=o.NMO_MIN;break;case"MAX":l.operation=o.NMO_MAX;break;case"ROUND":l.operation=o.NMO_ROUND;break;case"MOD":l.operation=o.NMO_MOD;break;case"ABS":l.operation=o.NMO_ABS}void 0===A.id0&&(A.id0=A.v1,A.id1=A.v2);break;case"REGSTORE":if(l.floats||(l.floats={}),l.strings||(l.strings={}),void 0!=l.number1&&(l.input1=l.number1),void 0!=l.input1)switch(typeof l.input1){case"number":l.floats.inp1=l.input1,P.variable_type="NUMBER";break;default:l.strings.inp1=l.input1,P.variable_type="STRING"}switch(P.variable_type){case"NUMBER":P.variable_type=o.NT_NUMBER;break;case"STRING":P.variable_type=o.NT_STRING;break;case"OBJECT":P.variable_type=o.NT_OBJECT,n(l.objects_paths,{b4w_do_not_batch:!0})}break;case"PAGEPARAM":l.bools||(l.bools={}),void 0===l.bools.hsh&&(l.bools.hsh=!1),l.floats||(l.floats={}),void 0===l.floats.ptp&&(l.floats.ptp=0);break;case"STOP_ANIM":case"PLAY_ANIM":if(l.bools||(l.bools={}),void 0===l.bools.env&&(l.bools.env=!1),void 0===l.bools.id0&&(l.bools.id0=!1),l.bools.id0||_(l.objects_paths.id0,{b4w_do_not_batch:!0}),"PLAY_ANIM"==l.type){var v=P.param_anim_behavior;v||(v="FINISH_STOP"),P.param_anim_behavior=i.anim_behavior_bpy_b4w(v)}break;case"STRING":switch(P.string_operation){case"JOIN":P.string_operation=o.NSO_JOIN;break;case"FIND":P.string_operation=o.NSO_FIND;break;case"REPLACE":P.string_operation=o.NSO_REPLACE;break;case"SPLIT":P.string_operation=o.NSO_SPLIT;break;case"COMPARE":P.string_operation=o.NSO_COMPARE}if("cnd"in l.floats)P.condition=l.floats.cnd;else switch(P.condition){case"GEQUAL":P.condition=o.NC_GEQUAL;break;case"LEQUAL":P.condition=o.NC_LEQUAL;break;case"GREATER":P.condition=o.NC_GREATER;break;case"LESS":P.condition=o.NC_LESS;break;case"NOTEQUAL":P.condition=o.NC_NOTEQUAL;break;case"EQUAL":P.condition=o.NC_EQUAL}break;case"REDIRECT":void 0!=l.url&&(l.bools.url=!1,l.strings.url=l.url);break;case"SET_CAMERA_MOVE_STYLE":switch(P.camera_move_style){case"STATIC":P.camera_move_style=o.NCMS_STATIC;break;case"TARGET":P.camera_move_style=o.NCMS_TARGET;break;case"EYE":P.camera_move_style=o.NCMS_EYE;break;case"HOVER":P.camera_move_style=o.NCMS_HOVER}break;case"ENTRYPOINT":l.bools||(l.bools={}),void 0===l.bools.js&&(l.bools.js=!1),l.bools.js&&(l.mute=!0);break;case"JS_CALLBACK":var N=P.js_cb_params;for(var u in N)switch(N[u]){case"OBJECT":N[u]=o.NCPT_OBJECT;break;case"VARIABLE":N[u]=o.NCPT_VARIABLE}}}}}),nE=A("__data",function(e,t){var r=ha(e),_=Bs(e),n=gs(e),a=Ds(e),o=Ks(e),i=Wo(e),s=ms(e),E=Xs(e),c=ti(e),l=Jo(e),T=ni(e),u=Zo(e),d=ds(e),f=Hs(e),P=Ls(e),A=rE(e),S=is(e),p=ks(e),m=Ms(e),O=os(e),v=Ns(e),N=ga(e),g=_E(e),h=Qi(e),R=ps(e),I=Ss(e),b=Gs(e),Y=ai(e),L=ys(e),M=ri(e),x=Os(e),y=i.animation,w=i.defaults,U=i.assets,C=i.physics,D=i.sfx,F=!1,G=3,k=4,K=null,B=null,X="",H=null,Q={},z=new Float32Array(3),V=new Float32Array(4),j=new Float32Array(4),q=gi(),W="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALAAAACwCAYAAACvt+ReAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAbrwAAG68BXhqRHAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAABVDSURBVHic7Z15kF1Vncc/v05Ys7JIQJZ0GLaAgCzCQARGFMIwZKTiqCPBAbTEEodBhYKALJKSVWYsCpTBcgCLAdQBHWZACCCyhCElIRiWEMOSBZAkCglJOoTQyW/++J3Xfe95971+273v3fvOp6qr+5573+vT3d8+93vP+Z3fTwjUhKoKsC0wLvKxDTA68rEVMNK9ZDiwpft6PdDvvl4LvA+sBt5zn1cCy4EVwDJgpYhouj9RMZB2d6ATUdWtgD2BXvcxARgPbJ5RFzYAS4BFwGL38YqIvJ/R988NQcCAqm4LHADsA+yLibannX1KYBMm6JeBBcA8EVnZ3i61n64UsKoOAyYCh7iPCeTvd6HA68BcYA6wQEQ2trdL2ZO3P1rDqGoPsD9wNHAkMKqBt1nNoFctfV7j2ldj/rbPXdsvIuvd994S88QAIzCfHPXOHyHurRvt21PALOAFEdnUwHvkjsILWFV7gcnAUcDYWl8GvAEsZNCDLhKR91rfw4RvrjoWuyv0us97ALtS+99rFfAEMFNElqTRx06hkAJ2I94ngRMwXzsUmzCxzsP85csisja9HtaPqo7CbM9EzK/vRW1/vwXATODJ0h2hSBRKwO5hbAom3KFuw2uAZzD/+JyIrEm5ey1FVUcDB2Ee/hPU9vM+ANwnIu+m3L3MKISAVXU3YCrwNwx6zSTWArOBJ7Gn+P4q1+YGVR0OfByzSX+N+exKfAg8DtwtIm9m0L1UybWAVfWjwJcw4Vb6WRT4A3YbnV0U0VZCVTfDRDwZOJDKv5dNwGPAXSLydja9az25FLCqbg9MA44FhlW4bDXwIPYgszyrvnUSqrojJuRqlqof+C1wp4i8k1XfWkWuBKyqmwN/D3wRW7ZN4m3gfzHhfpBV3zoZNyofBXwem81I4gPgHsxabMiqb82SGwGr6lHAV7A50yQWA3cCT4c4gmRcPMeRwCnY0ngSK4BbRGRWZh1rgo4XsJtZOAvzdUm8CfwSeKxbJu+bxQl5EnAqsEuFy+YAPxKRP2fWsQboWAG7X/JJwGkMRnVFWQXcDjwchNsYbnVyMibkMQmXvA/8DLi/U+9qHSlg95B2HvCxhNP9wG+AO0SkL+F8oE7cws9UzCNvlnDJAuA6EVmWacdqoOMErKpHA98keS7zReAGEXkr2151B6q6C3A2sF/C6bWYpXgy215Vp2MErKpbYMI9NuF0H3ArNrPQkbeyouCs2wnA6SQPIo8AN3XKDE9HCFhVdwK+iwWv+DwLXF+k5c88oKrbAecAByecfh24shMsRdsFrKqHYn53pHdqAzYtdk8YdduDG40nA18DtvBOrwP+TURmZ96xCG0VsKp+DrtV+f1YDFwrIkuz7lOgHBeSej6wm38KmzP+deadcrRFwG765kxsmszncexBrXChf3nGzVScg63o+cwEftyOHSGZC9htmLwAONQ71Y/9N/9P1n0K1I6qngycQXkMyjPANVkPPJkKWFVHApcDe3un1mIPBc9n2Z9AY6jqgcBFlM9SLAAuy3J+PjMBu20yM4DdvVPLge+JyBtZ9SXQPC4G+zJsD1+U14BLs9p+lYmAXTzDFZRHQi0EZojIqiz6EWgtqroNcCmWQyPKUuDiLKY+Uxewqo4BrqL8CfZF4PKQrCPfuIe7S7Dg+ShvARekPTilKmBVHYGNvHt4p54FrshT3GmgMm4V9SJsf16URcBFae43TE3Abrbh+5Q/sM0Gri761p5uwwXNTwcO904twOxEKrMTqaRPcvO851Eu3uewqZYg3oIhIh9iVnGOd2ofYLrLhtRy0sr/dSbl/4nzMdvwYUrfM9Bm3MB0JfCCd+pQbFNCy2m5gN3ysL/CthCbWgmrawXHPdfMAF7xTk12iyAtpaUCVtXDsNiGKMuxqbIg3i7BzSzNwPbXRfmqC95qGS0TsKqOA75N/MGwjzDP25W41K+XYausA83AeS58tiW0RMCRucBo7oF+zPMWOrlcoDJudfUqIBrkMxK40KVIaJpWjcBnUR6MfkuIbQiIyDzgNq95d+AbrXj/pgWsqpMo3wb0eIgqC5Rw8cL+Xrrj3P7HpmhKwKr6EeBfvOYlwA3NvG+gkFyPxUhEOcvtQG+YhgXstpucSzykbgO2kyLMOARiOE1ci2XHLDES+I7TUkM0MwJPoTxvw63hoS1QCRFZjCVKiXIAcGKj79mQgJ11+LLX/BxwX6MdCXQN92K7N6Kc1qiVaHQE/ibx7JB9wA/D7uHAUDiN3MhgMRyArWlwqbluAbsskf5qyq0hb0OgVlwe4tu85sPcjFZd1CVgN/l8htf8IrYrNRCohwexAK8oX3OxxTVT7wg8FdghctyPbYEP1iFQF04zNzBYQxpge+Cz9bxPzQJ2qYb+wWu+NyTaCzSKW2q+32v+gttDWRP1jMDTiOfpXYUllg4EmuFOrJ5JiS2xDPI1UZOAXTWgT3vNt4f8vIFmcRq63Wv+jCtQMyS1jsCnEM/E8haWZjO3qOrDqrp/u/sRAGwSIFqzbjjwj7W8cEgBuwQWftDFfxagMvpngLmqerNbmAm0CVci4ude87GquvNQr61lBP6cd90SrCJ6ERiO7d/7o6pe0KoY1UBDPI5lJS3Rg2mvKlUF7J4Gj/Ga7yjgtNk2wNXAC6r6+XZ3phtxmvqF1/wpl/2nIkONwFOI1x7+E/B0/d3LDXsBvwz+uG08hRWqLLEZySl4B6goYLdN6ASv+b8LOPomEfxxG3Be+F6v+cRqq3PVRuCjie9xWwM82nj3ckfwx+3hYeLzwqNITqoNVBfw8d7xg10aqB78cYa46kd+bM3kStcnCtjVRNgn2gQ81Gznck7wx9kxE9NciYluOreMSiOwr/g/iMjbiVd2H8Efp4wr3+XvaPcdAZAgYJeYz/ccIVwyTvDH6ePf8Y9x2oyRNALvD4yNHPdhKVED5QR/nB5PY7XoSmwD7OtflCRgf9n4/0I61CEJ/rjFuCSB/sBZNhsRE7DL4XqEd01Rlo2zIPjj1uJrb5JvI/wReCIwOnK8GpiXQseKTPDHrWMutv5QYix2txvAF7Bf42BOsA8NE/xxkzjtzfWaYxr1BezvNvbTxQfqJ/jj5njWO45pdEDALuqnN3JuE5asJNAagj9ujGeJL2rs4YpmAvER+EDiyakXplkeqUsJ/rhOXMXP16JNRFKaRQU80XtteHhLj+CP68PX4sB8cE9So+Pl1LoTKBH8cW34WowL2BUlHB+5QIE/pt+vgCP44+rMJ+6DJ7h49YEReE/io/Ebwf9mTvDHFRCR1dhO+BLDcOWLS6Lt9V7j1/gKZEfwx8ks9I4nwKCAd/dOLkq9O4GhCP44jp84vRcqj8BBwJ1D8MeGr8legB5Xn8CPdg9lAjqL4I/jOSMAxquq9ADbAtFfyJpQWbNj6Vp/7BKoR3PxbQmM7QHGedcuy6xXgUbpVn+83DselyRg/6JA59Jt/tjX5g5BwPmnm/xx4gjs5576S0adCbSWbvDHK7zj7XqI78AAy7weyC9F9serveNRSQIOS8jFoIj+2Bfw6CDgYlM0f+xrc3QPVnC52kWB/FMUf+yPwCN7sBysUT7IqDOB7Mm7P97gHW+eJOCwC7n45NUff+gdb5YkYP+iQDHJoz9OFPBwrzGMwN1FnvxxooADgRLvt7sD9dJD+Yjrj8iBYrMSmA7sLyL3tbszQ1Bmd4djw/Lm3kX+016gePQDtwAXi8if292ZGqko4ChhBC4+jwDfFpEX292ROqlJwBVLGgVyz0Lg3BxYhUr4MyUbeihfeRtFoGjkyedWoyzsYTgJ68sZdSaQPnn0udVIFHBZhE9GnQmkS159bjV8bb4XBFw88u5zq+Hb27XDMX8UZfuMOhNoLSuBa4AfugIpRWQH7/id4ZTvM9oxo84EWkPRfG41fG0uTxKwr/JA51JEn1sNX5uJAg4jcOdTZJ9bjbId9D3Au8SD2EdFaxAEOoqizOfWjapuC4yINL0PvNcjIgos9a7vzapjgZroB34C7C0i1xT4Ia0aE7zjJSIyUPUwMfNfoCN4BDhIRL7eBQ9p1ej1jhfBYODOYu+kr/ZA9nSrz63EeO94CQwK2B+B90y9O4FKdMN8biPs5R0vhkEBvwJsxGoPAOyqqqNCnYxM6ab53LpQ1dHAzpGmjcCr4DK0i8h64jZCgH0y6l8g+Nyh2Jd4Ec7XnWZjlYkq1uIKpMZCYIqIHNdFixGN4GvxpdIX1QScx8QXeaFr53Mb5EDveECr0e1Dz2PF5EpD9d6qOsbVqg20huBz60RVxxCvoqUkjcAishJ4PXKhAB9Pu4NdRPC5jXEIcf/7SrSGi58XYm7CiwPNEXxuc/ganBM98AU8xzs+TFXDLuXGCD63SZz2fAHHBllfwAuI79AYSbAR9RLiFlrHwcTT/67CKzkbE7CIbASe8t7kk6l0rZgEn9tajvaOZ4nIpmhDUm60Wd7xEarqJ5QIxAk+t8W4bJmHec2+NhMF/DwWI1xiBHB467pWKILPTY8jga0jx+8SmT4rUSZgFx/sK/2ElnYt/wSfmz7HecdPOG3GqJRedaZ3fKCq7tSSbuWf4HNTRlV3BA7wmh9KujZRwCKyBJuRGGgCjm9J7/JL8LnZMZn44sV8EfF3DQGVR2AoH4VPUNUtm+1ZDgk+N0NUdQvKLauvxQGqCfgJ4nnTRgHHNt613BF8bns4jngGnjUkzD6UqChgEfkA+I3XPFVVu6EsQfC5bcBp67Ne831Oi4kMJcb7iecP3hE4orHu5YLgc9vLJCA6WbAB02BFqgpYRN4FHveap6mqJF2fY4LPbTNu9D3Fa340GnmWRC124G4guny3G+VLfHkl+NzO4Rhg18jxRuBXQ71oSAGLyJvAY17zNFUdlnB5nngAOCD43PbjRt8ves2/E5E/DfXaWh/I7iJejuuj5HxeWEROFBF/G1WgPZwI7BI57gd+XssLaxKwiLwN/NZrPlVVRyRdHwjUiqqOBKZ5zQ+LyLJaXl/PlNidwPrI8RjgS3W8PhBIYhrxed/12B2/JmoWsIi8gz3QRTlJVXdJuj4QGApV3Q34W6/5F272qybqXZT4FfF8wsOBbxVwWi2QMk4z/0x8Z/wy4N563qcuAbtpplu95n0I4ZaB+jmR8oQlP613KrPuZWERmQX83ms+XVW3q/e9At2Jqm4PnOY1zxaR2fW+V6NxDTcCfZHjEQQrEaiBiHWI7rZYB/x7I+/XkICdyb7daz4ImNLI+wW6ipOBQ72220TkL428WTORZfcDL3htp6tqbxPvGSgwqro78E9e8zxsVbQhGhaw25/0r8DaSPPmwPldGvgeqIKqbgWcD0R3uK/BEnmX7XWrlaZie92wf4PXvBtwbvDDgRJOC+cQXy4G+HGj1qFE08HpIvIUFgAe5QjKA5MD3ctUyhPkzBSRJ5t941btrriJeGZLgDNU1c/rGugyVPUgyn3vq8DNrXj/lgjYbfn4PvG8asOA74aHuu7FLRVPZ7D2CpjvvapVsdct298mIiuAHxAPft8auERVt2nV9wnkA1dZ83vEq2sqcJ2I+OWNG6alGzRF5DnKl5rHAZe6p9BAF6CqWwOXUV6c+6ci8mwrv1fLdxiLyK8Bf1/ZnsCMML1WfFxeh0uBv/JOPSgidQXq1EJaW+R/Avjr2hOBi13WwUABcQmpLwQ+5p2agz3ot5xUBOxyuF5HPD0VWLLsC0K61uLh/qYXUb5MPB+42uWebjmpLja4LUdXAHt4p54HZpSK1QXyjbMNF2PxMFEWAReKyNryV7WG1FfLXJnQq7EVuigvAZeLyLq0+xBID/dccwnltdzeBKYPldehWVJPEyUiq7H/Tj+74H7AFWGKLb+4qbJrKBfvUuCitMULGYzAJdzu0xmUVx1/BxuJ/ZW8QAfjFim+R/lU2WvApVkVyMw04MZ54sspLyTeB1wpIvOy7E+gMdzy8HTiixRgD2yXi0hf+avSIfOIMeeZLgA+4Z3aiC2C3NtMeF0gPVxU2VQstsHPzPR74NqsH8zbEvLoUgmdCZyUcHo2FiOa2X9xYGjcwPMtksuuPQjclNZUWTXaGrOrqicDX03ox1Lsv3lx5p0KlOF2UpxPeTzvJuA/0lhhq5W2B52r6gHYL2esd+pD4A7gnmAp2oOzDFOAM4jvpACLKvuBiPj1tTOl7QIGUNVx2CqOv34OVhv3epcZKJARbuv7OZQvToDNNFzZyqiyRukIAcNAZcZvUF4fDGyW4mfAA2E0Thc36v4d9qC2dcIlM4GbOyWXcscIuISqTgLOJl7kucR84AYReSPbXnUHbm73bCzwymcNcKPbQtYxdJyAYeD29R3Ki92B5Y69D7grzFS0BrfIdAqW7ml4wiXzsJmhpjZgpkFHChhqupWtxpKrPNSO6Zsi4LLsnwCcSjzFaYl1wG10sHXrWAGXcOvtX8cq2CSxHPgvTMibKlwTiOAGh0nAl4GdK1z2DPCjThx1o3S8gEs4b/wVbItSEkuxxMizOnW0aDduAWkSZhd2rXDZMmxu9+nMOtYEuREwDET8n4jd8pJsBdiIfC82Iod4YwaCzY8CvkD5YkSJ9Vj+57s7ZYahFnIl4BLOVkwDPk3yQwfYU/ODmJDfzqpvnYSq7oQVzp5MsscFeyh+GHsorjkzeqeQSwGXUNUdsTodn6JybLNiO0BmYjloczO6NIKbTz8SqyK1P5X/xhuB32HCbfuCRKPkWsAlXJ2OqZiQq+23W4cFC80C5opIf5Vrc4OzCAdhNuFwKtsrsCX6R7El+iHrsHU6hRBwCbe74yTMJ1e6ZZbow56052JiTn33QCtR1bHAwcAh2EbKoUqercFS4t6Xt5+1GoUScAm3yfAo7Dbq12FIfAmWr+t5bLXvZbcVqmNQ1THYCtm+2Bae3ant7zcfeAh4slrV97xSSAFHccujx2P1nbet9WXAW1j1+iVY4sIlWT3kuHoj44EJQC+WGKaecmbvAk9gGSALvexeeAGXcJP3+2Ej8yTKwzdroQ+bJ12BTdetwFYE10Q+r8PiZPtL03guGHw49qC5NWZvRkc+74DNb5c+GqmAugrz9rOAl7plLrxrBBzFTejvhXnHQ7C8FXn7XSjwCvCs+1jYjSuRefujpYLzl/tj/nIi5i/9PV/tZiNmZV7Gcmq8mNXO304mCDgBd8vfA/OfvZgXHQ9klZxwPbAY89+L3NevhpXFcoKA68BN05V86g7Adgz62NGYd90KG72Hua8B3sdG0H5MnH2YZy755ncY9NTLijTNlTb/Dz+sKh/f1rAbAAAAAElFTkSuQmCC",J=null,Z=null,$=0,ee=!1,te=null,re=["LAMP"],_e=["MESH","CAMERA","EMPTY"],ne=12,ae=["BSDF_PRINCIPLED","BSDF_GLOSSY","BSDF_DIFFUSE","BSDF_TRANSPARENT"],oe=null;function ie(e,t){K[t.id]=null,B[t.id]=null}function se(e,t,r,_){var n,a;if(e instanceof ArrayBuffer){var o=c.get_width_height(e,_);n=o.width,a=o.height}else n=e.width,a=e.height;N.log("%cLOAD IMAGE "+n+"x"+a,"color: #"+(n>2048||a>2048?"a00":n>1024||a>1024?"aa0":"0a0"),t),-1==t.indexOf(X)&&r&&N.warn("image",t,"is not from app root.")}function Ee(e,t,_,n,o,i){var s=t.filepath;s||r.panic("Nothing requested");var E=function(n,i,l,T){if(!n)return l==a.AT_JSON_ZIP?(N.warn("Compressed file ",T,"not found or invalid. Trying to load non-compressed",s),void a.enqueue([{id:s,type:a.AT_JSON,url:s,is_fetch:t.is_preloading}],E,null,c)):void f.abort_thread(t);for(var u in N.log("%cLOAD METADATA","color: #616",T),function(e){var t=ca(e.b4w_format_version);switch(sa(t,w.min_format_version)){case-1:t[0]<w.min_format_version[0]?r.panic("JSON version is too old relative to B4W engine: "+Ea(t)+", required: "+Ea(w.min_format_version)+". Reexport scene with the latest B4W addon to fix it."):N.warn("JSON version is a bit old relative to B4W engine: "+Ea(t)+", required: "+Ea(w.min_format_version)+". Some compatibility issues can occur. Reexport scene with the latest B4W addon to fix it.");break;case 1:t[0]>w.min_format_version[0]?r.panic("B4W engine version is too old relative to JSON. Can't load the scene. Update your engine version to fix it."):N.error("B4W engine version is a bit old relative to JSON. Some compatibility issues can occur. Update your engine version to fix it.")}w.loaded_data_version=t}(n),n)e[u]=n[u];!function(e,t){e.is_primary&&(H=R.find_main_scene(t.scenes));var r=t.binaries[0].binfile;r?e.binary_name=r:(f.skip_stage_by_name(e,"load_binaries"),f.skip_stage_by_name(e,"prepare_bindata")),w.is_mobile_device||f.skip_stage_by_name(e,"mobile_media_start"),w.antialiasing&&w.smaa||f.skip_stage_by_name(e,"load_smaa_textures")}(t,e),function(e,t){if(e.b4w_export_errors)for(var r=0;r<e.b4w_export_errors.length;r++){var _=e.b4w_export_errors[r];(t.is_primary&&"PRIMARY"==_.type||"ALL"==_.type)&&N.export_error(_.text+" See more details in https://www.blend4web.com/doc/en/addon.html#non-critical-export-errors")}}(e,t),function(e,t){if(e.b4w_export_warnings)for(var r=0;r<e.b4w_export_warnings.length;r++){var _=e.b4w_export_warnings[r];(t.is_primary&&"PRIMARY"==_.type||"ALL"==_.type)&&N.export_warn(_.text+" See more details in https://www.blend4web.com/doc/en/addon.html#other-messages")}}(e,t),t.is_preloading&&ye(e),o(t,_)},c=function(e){i(t,_,e)};if(w.assets_gzip_available)var l=s+".gz",T=a.AT_JSON_ZIP;else l=s,T=a.AT_JSON;a.enqueue([{id:l,type:T,url:l,is_fetch:t.is_preloading}],E,null,c)}function ce(e,t,_,n,o,i){var s=At(t.filepath)+t.binary_name;s||r.panic("Binary data is missing");var E=function(n,i,l,T){if(!n)return l==a.AT_ARRAYBUFFER_ZIP?(N.warn("Compressed file ",T,"not found or invalid. Trying to load non-compressed",s),void a.enqueue([{id:s,type:a.AT_ARRAYBUFFER,url:s,is_fetch:t.is_preloading}],E,null,c)):void f.abort_thread(t);N.log("%cLOAD BINARY","color: #616",T),e.bin_data=n,function(e,t){var _=function(e){return[new Uint32Array(e,4,1)[0],new Uint32Array(e,8,1)[0]]}(e),n=ca(t.b4w_format_version);_[0]!=n[0]&&r.panic("BIN version does not match to JSON version: "+Ea(_)+", required: "+Ea(w.min_format_version)+". Couldn't load the scene. Reexport scene to fix it."),_[1]!=n[1]&&N.warn("BIN version does not match to JSON version: "+ +Ea(_)+", required: "+Ea(w.min_format_version)+". Some compatibility issues can occur. Reexport scene to fix it.")}(n,e),o(t,_)},c=function(e){i(t,_,e)};if(w.assets_gzip_available)var l=s+".gz",T=a.AT_ARRAYBUFFER_ZIP;else l=s,T=a.AT_ARRAYBUFFER;a.enqueue([{id:l,type:T,url:l,is_fetch:t.is_preloading}],E,null,c)}function le(e,t,r,_,n,a){b.check_shaders_loaded()&&n(t,r)}function Te(e,t,r,_,a,o){var i,s=e.bin_data,E=e.binaries[0],c=e.objects,l=e.meshes,T=e.actions,u=(i=new Uint16Array([255]),255==new DataView(i.buffer).getUint16(0,!0));!function(e,t,r,_,n){for(var a=["indices"],o=["position","texcoord","texcoord2","shade_tangs"],i=["normal","tangent"],s=["group"],E=["color"],c=0;c<r.length;c++)for(var l=r[c].submeshes,T=0;T<l.length;T++){for(var u in l[T]){var d=l[T][u][1];-1!=a.indexOf(u)?l[T][u]=fe(e,l[T][u][0]*Q_+t.int+n,d,_):-1!=o.indexOf(u)?l[T][u]=de(e,l[T][u][0]*H_+t.float+n,d,_):-1!=i.indexOf(u)?l[T][u]=Pe(e,l[T][u][0]*X_+t.short+n,d):-1!=s.indexOf(u)?l[T][u]=Ae(e,l[T][u][0]*X_+t.ushort+n,d):-1!=E.indexOf(u)&&(l[T][u]=Se(e,l[T][u][0]*B_+t.uchar+n,d))}if(ue(r[c],l[T]),delete l[T].normal,delete l[T].tangent,"texcoord2"in l[T]){var f=new Float32Array(l[T].texcoord.length+l[T].texcoord2.length);f.set(l[T].texcoord),f.set(l[T].texcoord2,l[T].texcoord.length),l[T].texcoord=f,delete l[T].texcoord2}}}(s,E,l,u,ne),function(e,t,r,_,n){for(var a=0;a<r.length;a++)for(var o=r[a].particle_systems,i=0;i<o.length;i++){var s=o[i];s.transforms=de(e,s.transforms[0]*H_+t.float+n,s.transforms[1],_)}}(s,E,c,u,ne),function(e,t,r,_,a){for(var o=0;o<r.length;o++){var i=r[o],s=i.fcurves,E=i.frame_range,c=E[0],l=E[1],T=n.get_approx_curve_length(c,l),u=null;T<0&&(T=0);var d=!1,f=!1;for(var P in s)d|=P.indexOf("rotation_euler")>-1,f|=P.indexOf("rotation_quaternion")>-1;var A=[];for(var P in s)if(d&&f&&P.indexOf("rotation_euler")>-1)delete s[P];else{var S=s[P];for(var p in S){var m=S[p],O=de(e,t.float+m.bin_data_pos[0]*H_+a,m.bin_data_pos[1],_),v=new Float32Array(T);null===u&&(u=new Int8Array(T)),n.approximate_curve(m,O,v,u,c,l),m._pierced_points=v}P.indexOf("rotation_euler")>-1&&(n.fcurve_replace_euler_by_quat(s[P]),A.push(P))}for(var N=0;N<A.length;N++){var g=A[N];s[g.replace("euler","quaternion")]=s[g],delete s[g]}i._bflags=u}}(s,E,T,u,ne),a(t,r)}function ue(e,t){if(e.b4w_shape_keys.length){var r=t.base_length,_=t.normal.length/r/G,n=t.normal.length/G;t.tbn=Ai(t.normal.subarray(0,r*G),t.tangent.subarray(0,r*k),gi(n));for(var a=1;a<_;a++)for(var o=a*r,i=0;i<r;i++){var s=t.normal.subarray(i*G,(i+1)*G),E=Ie(t.normal.subarray((o+i)*G,(o+i+1)*G),s,z),c=hi(q);if(t.tangent.length){var l=t.tangent.subarray(i*k,(i+1)*k),T=or(t.tangent.subarray((o+i)*k,(o+i+1)*k),l,V),u=Ai(s,l);yi(Ai(E,T),u,c)}else pi(c,wr(s,E,j),0);Ii(t.tbn,c,o+i)}}else t.tbn=Ai(t.normal,t.tangent)}function de(e,t,r,_){if(_)var n=new Float32Array(e,t,r);else{n=new Float32Array(r);for(var a=new DataView(e),o=0;o<r;o++)n[o]=a.getFloat32(t+o*H_,!0)}return n}function fe(e,t,r,_){if(_)var n=new Uint32Array(e,t,r);else{n=new Uint32Array(r);for(var a=new DataView(e),o=0;o<r;o++)n[o]=a.getUint32(t+o*Q_,!0)}return n}function Pe(e,t,r){for(var _=new Float32Array(r),n=new DataView(e),a=0;a<r;a++)_[a]=n.getInt16(t+a*X_,!0)/32767;return _}function Ae(e,t,r){for(var _=new Float32Array(r),n=new DataView(e),a=0;a<r;a++)_[a]=n.getUint16(t+a*X_,!0)/65535;return _}function Se(e,t,r){for(var _=new Float32Array(r),n=new DataView(e),a=0;a<r;a++)_[a]=n.getUint8(t+a*B_)/255;return _}function pe(e,t,_,a,o,i){!function(e){var t=e.cameras,_=e.groups,n=e.materials,a=e.meshes,o=e.node_groups,i=e.objects,s=e.particles,E=e.scenes,c=e.speakers,l=e.lamps,T=e.textures,u=e.worlds;o||(N.warn('"node_groups" datablock undefined. reexport main scene.'),o=e.node_groups=[]);for(var d=function(e){for(var t=["actions","armatures","cameras","curves","groups","images","lamps","materials","meshes","node_groups","objects","particles","scenes","sounds","speakers","textures","worlds"],r={},_=0;_<t.length;_++)for(var n=e[t[_]],a=0;a<n.length;a++){var o=n[a];r[o.uuid]=o}return r}(e),f=0;f<E.length;f++){for(var P=E[f],A=P.objects,S=0;S<A.length;S++)Be(A,S,d);P.camera&&Be(P,"camera",d),P.world&&Be(P,"world",d)}for(f=0;f<_.length;f++){var p=_[f].objects;for(S=0;S<p.length;S++)Be(p,S,d)}for(f=0;f<i.length;f++){var m=i[f];switch(m.dupli_group&&Be(m,"dupli_group",d),m.parent&&Be(m,"parent",d),m.dg_parent&&Be(m,"dg_parent",d),(X=m.animation_data)&&ke(X,d),m.type){case"MESH":m.data||r.panic("mesh not found for object "+m.name),Be(m,"data",d);var O=!1,v=m.modifiers;for(S=0;S<v.length;S++){var g=v[S];"ARMATURE"==g.type?(O&&N.warn('Object "'+m.name+'" has more than one armature modifiers. Only the first one will be used.'),O=!0,Be(g,"object",d)):"CURVE"==g.type&&Be(g,"object",d)}var h=m.particle_systems;if(h)for(S=0;S<h.length;S++)Be(h[S],"settings",d);break;case"ARMATURE":Be(m,"data",d);var R=m.pose.bones,I=m.data.bones;for(S=0;S<R.length;S++){var b,Y=R[S];if(Y.bone=I[Y.bone],b=Y.constraints)for(var L=0;L<b.length;L++)(x=b[L]).target&&Be(x,"target",d);var M=Y.parent_recursive;for(L=0;L<M.length;L++)M[L]=R[M[L]]}break;case"LAMP":case"CAMERA":case"SPEAKER":case"CURVE":Be(m,"data",d)}if(b=m.constraints)for(S=0;S<b.length;S++){var x;(x=b[S]).target&&Be(x,"target",d)}var y=m.lod_levels;if(y)for(S=0;S<y.length;S++){var w=y[S];w.object&&Be(w,"object",d)}}for(f=0;f<a.length;f++){var U=a[f].materials;for(S=0;S<U.length;S++)Be(U,S,d)}for(f=0;f<n.length;f++){var C=n[f],D=C.texture_slots;for(S=0;S<D.length;S++)Be(D[S],"texture",d);(H=C.node_tree)&&Ke(H,d)}for(f=0;f<o.length;f++)(H=o[f].node_tree)&&Ke(H,d);for(f=0;f<T.length;f++){var F=T[f],G=F.type;"IMAGE"!=G&&"ENVIRONMENT_MAP"!=G||Be(F,"image",d)}for(f=0;f<t.length;f++){var k=t[f];k.dof_object&&Be(k,"dof_object",d)}for(f=0;f<c.length;f++){var K=c[f];K.sound&&Be(K,"sound",d),(X=K.animation_data)&&ke(X,d)}for(f=0;f<s.length;f++){var B=s[f];for(D=B.texture_slots,S=0;S<D.length;S++)Be(D[S],"texture",d);B.dupli_group&&Be(B,"dupli_group",d),B.dupli_object&&Be(B,"dupli_object",d)}for(f=0;f<l.length;f++)(X=l[f].animation_data)&&ke(X,d);for(f=0;f<u.length;f++){var X,H,Q=u[f];if(D=Q.texture_slots)for(S=0;S<D.length;S++)Be(D[S],"texture",d);(X=Q.animation_data)&&ke(X,d),(H=Q.node_tree)&&Ke(H,d)}}(e),g.check_bpy_data(e),ye(e),function(e,t){for(var r=At(t.filepath),_=e.textures,n=function(e,t){return t.is_primary?e.scenes[0].b4w_anisotropic_filtering:H.b4w_anisotropic_filtering}(e,t),a=0;a<_.length;a++){var o=_[a];t.is_primary||"SCENE"!=o.b4w_source_type||(o.b4w_source_id="");var i=L.create_texture_bpy(o,n,e.scenes,t.id,r);o._render=i}}(e,t),function(e){for(var t={},r=e.objects,_=0;_<r.length;_++){var n=r[_];if("MESH"===n.type&&!n.particle_systems.length)for(var a=n.data,o=a.name,i=a.submeshes,s=a.materials,E=0;E<i.length;E++)0!==i[E].base_length||t[o]||(s[E]&&N.warn('material "'+s[E].name+'" is not assigned to any face (object "'+n.name+'").'),t[o]=!0)}}(e),function(e){var t=[];e.materials=[];for(var r=e.meshes,_=0;_<r.length;_++){var n=r[_];if(0==n.materials.length){var a=Rs();n.materials.push(a),-1==t.indexOf(a.uuid)&&(t.push(a.uuid),e.materials.push(a))}else for(var o=0;o<n.materials.length;o++){var i=n.materials[o],s=hs();Is(i,s),n.materials[o]=s,-1==t.indexOf(s.uuid)&&(t.push(s.uuid),e.materials.push(s))}}}(e),function(e,t){for(var r=0;r<e.length;r++){var _=e[r];_._data_id=t,n.append_action(_)}}(e.actions,t.id),function(e){for(var t={lod_parents:[],lod_levels_data:[]},r=e.scenes,_=0;_<r.length;_++)for(var n=r[_],a=r[_].objects,o=0;o<a.length;o++)tt(n,a,a[o],null,t);for(_=0;_<t.lod_levels_data.length;_++){var i=t.lod_levels_data[_];for(o=0;o<i.old_lods.length;o++){var s=i.old_lods[o],E=i.new_lods[o],c=i.scene_arrays[o],l=i.objs_container_arrays[o];i.lod_levels[o].object=E;for(var T=0;T<l.length;T++)$_(l[T],E);rt(s,c)}}}(e),function(e,t){if(!t.is_primary&&e.scenes.length>1&&(e.scenes=[R.find_main_scene(e.scenes)],N.warn("loading data contains multiple scenes.","Only the first one will be loaded.")),t.is_primary)var r=H;else r=R.find_main_scene(e.scenes);if(M.set_framerate(H.fps),e.scenes.length>1){var _=e.scenes.indexOf(H);e.scenes.splice(_,1),e.scenes.unshift(H)}for(var n=0;n<e.scenes.length;n++){var a=e.scenes[n];if(a._render=R.create_scene_render(),a._is_main=a==r,a._is_primary_thread=t.is_primary,C.enabled){if("OFF"==a.b4w_enable_physics||"AUTO"==a.b4w_enable_physics&&!Oe(a))continue;(t.is_primary||!v.scene_has_physics(H)&&a==R.find_main_scene(e))&&v.init_scene_physics(a)}}}(e,t),function(e){for(var t=0;t<e.scenes.length;t++){var r=e.scenes[t];if(r.b4w_use_logic_editor){var _=Ne(r,"ALL");g.assign_logic_nodes_object_params(_,r.world,r)}}}(e),function(e,t){for(var r=0;r<e.scenes.length;r++){for(var _=e.scenes[r],n=Ne(_,"ALL"),a=0;a<n.length;a++)m.check_bpy_obj_scene_compatibility(i=n[a],_,e)&&(i._scenes||(i._scenes=[]),i._scenes.push(t.is_primary?_:H));ge(n)}!function(e,t){for(var r=e.scenes,_=[],n=0;n<r.length;n++)Re(r[n].objects,0,t.is_primary,_);for(B[t.id]=[],n=0;n<_.length;n++)for(var a=_[n],o=0;o<a.length;o++)for(var i=a[o],s=0;s<i.length;s++)B[t.id].push(i[s]);var E=e.particles;for(n=0;n<E.length;n++){var c=E[n].dupli_object;c&&(c._is_hair_dupli=!0,B[t.id].push(c));var l=E[n].dupli_group;if(l){var T=l.objects;for(o=0;o<T.length;o++)(c=T[o])._is_hair_dupli=!0,B[t.id].push(c)}}var u=B[t.id];for(n=u.length-1;n>=0;n--)u[n]._scenes||u.splice(n,1)}(e,t);var o=Ye(t.id);for(r=0;r<o.length;r++){var i=o[r];if(!t.is_primary&&i.parent&&re.indexOf(i.parent.type)>-1&&(i.parent=""),"MESH"==i.type){var s=g.apply_mesh_modifiers(i);s&&(e.meshes.push(s),i.data=s)}i._def_action_slots=m.get_bpy_def_action_slots(i,!1),i._is_dynamic=m.bpy_obj_is_dynamic(i)}for(r=0;r<o.length;r++){var E=(i=o[r])._is_dynamic;for(a=0;a<i.lod_levels.length;a++)(c=i.lod_levels[a].object)&&(E=E||c._is_dynamic);if(E)for(i._is_dynamic=!0,a=0;a<i.lod_levels.length;a++){var c;(c=i.lod_levels[a].object)&&(c._is_dynamic=!0)}}}(e,t),function(e,t){for(var r=0;r<e.scenes.length;r++){var _=e.scenes[r];(a=_.world)._scenes||(a._scenes=[]),a._scenes.push(t.is_primary?_:H)}var n=[];for(r=0;r<e.worlds.length;r++)(a=e.worlds[r])._scenes?(a._def_action_slots=m.get_bpy_def_action_slots(a,!0),a._is_dynamic=m.bpy_obj_is_dynamic(a)):n.push(a);for(r=0;r<n.length;r++){var a,o=e.worlds.indexOf(a=n[r]);e.worlds.splice(o,1)}}(e,t),function(e){for(var t=e.node_groups,r=e.materials,_=0;_<t.length;_++)(n=t[_].node_tree)&&(ve(n,a=[],!0),n._bsdf_types=a);for(_=0;_<r.length;_++){var n,a;(n=r[_].node_tree)&&(ve(n,a=[],!1),n._bsdf_types=a)}}(e),function(e,t){for(var r=0;r<e.scenes.length;r++){var _=t.is_primary?e.scenes[r]:H;Boolean(Le(t.id,_,"SPEAKER").length)&&!_._sfx&&I.attach_scene_sfx(_)}}(e,t),F&&N.log("%cDEBUG BPYDATA:","color: #a0a",e),o(t,_)}function me(e,t,r,_,n,o){for(var i=At(t.filepath),s=[],E=[],c=0;c<e.speakers.length;c++){var l=e.speakers[c],T=l.sound.uuid;if(-1==E.indexOf(T)){switch(E.push(T),l.b4w_behavior){case"POSITIONAL":case"BACKGROUND_SOUND":var u=a.AT_AUDIOBUFFER;break;case"BACKGROUND_MUSIC":u=a.AT_AUDIO_ELEMENT}qe(s,T,u,cs(i+l.sound.filepath),t.is_preloading)}}s.length?a.enqueue(s,function(){},function(){n(t,r)}):n(t,r)}function Oe(e){for(var t=Ne(e,"ALL"),r=0;r<t.length;r++){if(t[r].b4w_collision)return!0;var _=t[r].data;if(_.materials)for(var n=0;n<_.materials.length;n++)if(_.materials[n].physics_settings.use_coll_physics)return!0}return!1}function ve(e,t,r){for(var _=e.nodes,n=0;n<_.length;n++){var a=_[n],o=a.type;if("GROUP"==o&&a.node_group){var i=a.node_group.node_tree;if(!i)continue;if(r)ve(i,t,!0);else for(var s=i._bsdf_types,E=0;E<s.length;E++){var c=s[E];-1==t.indexOf(c)&&t.push(c)}}else-1!=ae.indexOf(o)&&-1==t.indexOf(o)&&t.push(o)}}function Ne(e,t){t||(t="ALL");var r=[];return-1==e.objects.indexOf(e.camera)&&e.objects.push(e.camera),function e(t,r,_){for(var n=0;n<t.length;n++){var a=t[n];"ALL"!=r&&r!=a.type||_.push(a);var o=a.dupli_group;o&&e(o.objects,r,_)}}(e.objects,t,r),r}function ge(e){for(var t=0;t<e.length;t++){var r=e[t];if(r._scenes&&"WORLD"!=r.type)for(var _=r.particle_systems,n=0;n<_.length;n++){var a=_[n].settings;if("HAIR"==a.type)if("OBJECT"==a.render_type)(s=a.dupli_object)._scenes||(s._scenes=r._scenes.slice());else if("GROUP"==a.render_type)for(var o=a.dupli_group,i=0;i<o.objects.length;i++){var s;(s=o.objects[i])._scenes||(s._scenes=r._scenes.slice())}}}}function Re(e,t,r,_){_[t]=_[t]||[];for(var n=_[t],a=0;a<e.length;a++){var o=e[a],i=pt(o);n[i]=n[i]||[],(r||-1==re.indexOf(o.type))&&-1==n[i].indexOf(o)&&n[i].push(o);var s=o.dupli_group;s&&Re(s.objects,t+1,r,_)}}function Ye(e){return B[e]}function Le(e,t,r){for(var _=[],n=Ye(e),a=0;a<n.length;a++){var o=n[a];if(o.type==r||"ALL"==r)for(var i=0;i<o._scenes.length;i++)t==o._scenes[i]&&_.push(o)}return _}function Me(e,t,_,a,o,i){for(var E=Ye(t.id),c=0;c<E.length;c++)(f=m.create_object_from_bpy(E[c])).render.data_id=t.id;var l=e.worlds;for(c=0;c<l.length;c++)m.create_object_from_bpy(l[c],!0);var T=m.get_all_objects("ALL",t.id);for(c=0;c<E.length;c++)P.update_object(d=E[c],f=d._object);for(c=0;c<l.length;c++){var u=l[c];P.update_object(u,u._object)}for(t.is_primary&&function(e,t){for(var r=0;r<e.scenes.length;r++){for(var _=e.scenes[r],n=m.get_scene_objs(_,"LAMP",t),a=new Array(n.length),o=0;o<n.length;o++)a[o]=o;for(a.sort(function(e,t){var r=n[e].light,_=n[t].light;return!_.use_diffuse||!_.use_specular||r.use_diffuse&&r.use_specular?!r.use_diffuse&&(_.use_diffuse||!r.use_specular&&_.use_specular)?1:0:1}),o=0;o<a.length;o++)O.get_scene_data(n[a[o]],_).light_index=o}}(e,t.id),c=0;c<E.length;c++){var d,f;(f=(d=E[c])._object).is_hair_dupli||(s.prepare_object_relations(d,f),m.update_object_relations(d,f),x.update_transform(f)),"MESH"==f.type&&m.generate_mesh_render_boundings(d,f)}!function(e){for(var t=0;t<e.length;t++){var r=e[t],_=r._object,n=_.render;if(O.is_mesh(_)||O.is_empty(_)){var a=r.lod_levels.length;if(a){for(var o=[r],i=[0],s=1/0,E=0;E<a;E++){var c=r.lod_levels[E].distance;if(!(l=r.lod_levels[E].object)){s=c;break}o.push(l),i.push(c)}for(i.push(s),E=0;E<o.length;E++){var l,T=(l=o[E])._object.render;T.is_lod=!0,"DYNAMIC"==n.type&&E>0&&be(n.bs_world.center,T.bs_world.center,T.main_lod_offset),T.lod_dist_min=i[E],T.lod_dist_max=i[E+1];var u=i[E+1]-i[E],d=E==o.length-1?1/0:i[E+2]-i[E+1];T.lod_lower_border_range=Math.min(0==E?0:i[E]-i[E-1],u),T.lod_upper_border_range=Math.min(u,d)}}}}}(E),function(e){for(var t=0;t<e.length;t++){var r=e[t];if("MESH"==r.type){var _=r.armobj;if(_){var n=_.render,a=r.render.bone_skinning_info,o=[];for(var i in a){var s=a[i];o.push(4*s.deform_bone_index,4*s.bone_index)}n.mesh_to_arm_bone_maps.push(o),n.skinned_renders.push(r.render)}}}}(T),function(e){for(var t=-1,r=-1,_=n.get_max_bones(),a=0;a<e.length;a++){var o=(s=e[a]).render;if(O.is_mesh(s)&&o.is_skinning){var i=o.max_bones;i>t&&(t=i),_>=i&&i>r&&(r=i)}}for(a=0;a<e.length;a++){var s;o=(s=e[a]).render,O.is_mesh(s)&&o.is_skinning&&(o.frames_blending=!0,t<_?o.max_bones=t:o.max_bones<=_?o.max_bones=r:(N.warn('too many bones for "'+s.name+'" / '+o.max_bones+" bones (max "+_+" with blending, "+2*_+" without blending). Blending between frames will be disabled."),o.max_bones=t,o.frames_blending=!1),o.frames_blending=o.frames_blending&&!y.frames_blending_hack)}}(T),function(e){for(var t=0;t<e.length;t++){var _=e[t];if(_.is_vehicle){var n=_.vehicle_settings;if("CHASSIS"==n.part){if(_.vehicle={},_.vehicle.force_max=n.force_max,_.vehicle.brake_max=n.brake_max,_.vehicle.suspension_compression=n.suspension_compression,_.vehicle.suspension_stiffness=n.suspension_stiffness,_.vehicle.suspension_damping=n.suspension_damping,_.vehicle.wheel_friction=n.wheel_friction,_.vehicle.roll_influence=n.roll_influence,_.vehicle.max_suspension_travel_cm=n.max_suspension_travel_cm,_.vehicle.engine_force=0,_.vehicle.brake_force=1,_.vehicle.steering=0,_.vehicle.speed=0,_.vehicle.props=[],_.vehicle.prop_offsets=[],_.vehicle.steering_wheel=null,T=O.get_dg_parent(_))var a=O.get_dg_objects(T,e);else a=e;for(var o=0;o<a.length;o++)if((d=a[o]).is_vehicle){var i=d.vehicle_settings;if(v.is_car_wheel(d)&&n.name==i.name){var s=v.wheel_index(d.vehicle_settings.part);_.vehicle.props[s]=d,_.vehicle.prop_offsets[s]=new Float32Array(8)}else if(v.is_vehicle_steering_wheel(d)&&n.name==i.name){_.vehicle.steering_wheel=d,_.vehicle.steering_max=i.steering_max,_.vehicle.steering_ratio=i.steering_ratio,_.vehicle.inverse_control=i.inverse_control;var E=Va(A=Ha(_.render.world_tsr,ba()),d.render.world_tsr,A);_.vehicle.steering_wheel_tsr=E,Za(f=new Float32Array([1,0,0]),E,f),_.vehicle.steering_wheel_axis=f}else if(v.is_vehicle_speedometer(d)&&n.name==i.name){_.vehicle.speedometer=d,_.vehicle.speed_ratio=i.speed_ratio,_.vehicle.max_speed_angle=i.max_speed_angle;var c=Va(A=Ha(_.render.world_tsr,ba()),d.render.world_tsr,A);_.vehicle.speedometer_tsr=c,Za(P=new Float32Array([1,0,0]),c,P),_.vehicle.speedometer_axis=P}else if(v.is_vehicle_tachometer(d)&&n.name==i.name){_.vehicle.tachometer=d,_.vehicle.delta_tach_angle=i.delta_tach_angle;var l=Va(A=Ha(_.render.world_tsr,ba()),d.render.world_tsr,A);_.vehicle.tachometer_tsr=l,Za(S=new Float32Array([1,0,0]),l,S),_.vehicle.tachometer_axis=S}}4!=_.vehicle.props.length&&r.panic("Not enough wheels for chassis "+_.name)}else if("HULL"==n.part){var T;if(_.vehicle={},_.vehicle.props=[],_.vehicle.prop_offsets=[],_.vehicle.force_max=n.force_max,_.vehicle.brake_max=n.brake_max,_.vehicle.floating_factor=n.floating_factor,_.vehicle.water_lin_damp=n.water_lin_damp,_.vehicle.water_rot_damp=n.water_rot_damp,_.vehicle.engine_force=0,_.vehicle.brake_force=1,_.vehicle.steering=0,_.vehicle.speed=0,_.vehicle.steering_wheel=null,T=O.get_dg_parent(_))var u=O.get_dg_objects(T,e);else u=e;for(o=0;o<u.length;o++){var d;if((d=u[o]).is_vehicle)if(i=d.vehicle_settings,v.is_boat_bob(d)&&n.name==i.name)_.vehicle.props.push(d),_.vehicle.prop_offsets.push(new Float32Array(8));else if(v.is_vehicle_steering_wheel(d)&&n.name==i.name){var f;_.vehicle.steering_wheel=d,_.vehicle.steering_max=i.steering_max,_.vehicle.steering_ratio=i.steering_ratio,_.vehicle.inverse_control=i.inverse_control,E=Va(A=Ha(_.render.world_tsr,ba()),d.render.world_tsr,A),_.vehicle.steering_wheel_tsr=E,Za(f=new Float32Array([1,0,0]),E,f),_.vehicle.steering_wheel_axis=f}else if(v.is_vehicle_speedometer(d)&&n.name==i.name){var P;_.vehicle.speedometer=d,_.vehicle.speed_ratio=i.speed_ratio,_.vehicle.max_speed_angle=i.max_speed_angle,c=Va(A=Ha(_.render.world_tsr,ba()),d.render.world_tsr,A),_.vehicle.speedometer_tsr=c,Za(P=new Float32Array([1,0,0]),c,P),_.vehicle.speedometer_axis=P}else if(v.is_vehicle_tachometer(d)&&n.name==i.name){var A,S;_.vehicle.tachometer=d,_.vehicle.delta_tach_angle=i.delta_tach_angle,l=Va(A=Ha(_.render.world_tsr,ba()),d.render.world_tsr,A),_.vehicle.tachometer_tsr=l,Za(S=new Float32Array([1,0,0]),l,S),_.vehicle.tachometer_axis=S}}}}}}(T),function(e){for(var t=0;t<e.length;t++){var r=e[t];if(r.is_floating){var _=r.floating_settings;if("MAIN_BODY"==_.part){r.floater={},r.floater.floating_factor=_.floating_factor,r.floater.water_lin_damp=_.water_lin_damp,r.floater.water_rot_damp=_.water_rot_damp,r.floater.bobs=[];var n=O.get_dg_parent(r);if(n)var a=O.get_dg_objects(n,e);else a=e;for(var o=0;o<a.length;o++){var i=a[o];if(i.is_floating){var s=i.floating_settings;v.is_floater_bob(i)&&_.name==s.name&&(r.floater.bobs.push(i),i.bob_synchronize_pos=i.floating_settings.synchronize_position)}}}}}}(T),o(t,_)}function xe(e,t,r,_,n,a){!function(e){for(var t=0;t<e.scenes.length;t++){var r=e.scenes[t];r._camera=r.camera._object}}(e);for(var i=0;i<e.scenes.length;i++){var s=t.is_primary?e.scenes[i]:H,E=m.get_scene_objs(s,"LAMP",t.is_primary?t.id:0),c=m.get_scene_objs(s,"ALL",t.id),l=Le(t.id,s,"MESH"),T=Le(t.id,s,"EMPTY");t.is_primary&&R.append_scene(s,c,E,l,T);for(var u=!1,d=0;d<T.length;d++)for(var f=(L=T[d]._object).scenes_data,P=0;P<f.length;P++){var A=f[P].scene,S=R.update_force_scene(A,L);s.name==A.name&&(u=u||S)}t.is_primary&&s._render.water_params&&!u&&N.warn('Scene "'+s.name+'" has water but has no wind. Using default settings.');var p=[];R.set_active(s),o.generate_main_batches(s,l,E,p);var v=m.get_scene_objs(s,"LINE",t.id);o.generate_line_batches(s,v);var g=R.get_graph(s);if(t.is_primary){var h=s._render.sky_params,I=s.world;if(h.render_sky||h.procedural_skydome){var b=I._object;o.append_sky_batch_to_world(s,h,b),o.create_forked_batches(b,g,s)}R.generate_auxiliary_batches(s,g);var Y=s._render.world_light_set;Y&&(Y.use_environment_light||Y.ngraph_proxy_id)&&o.append_cube_sky_batch_to_world(s,I._object)}for(d=0;d<l.length;d++)o.create_forked_batches(l[d]._object,g,s);for(d=0;d<p.length;d++)o.create_forked_batches(p[d],g,s),m.objects_storage_add(p[d]);for(c=m.get_scene_objs(s,"ALL",t.id),R.assign_scene_data_subs(s,c,E),d=0;d<c.length;d++){var L;(L=c[d]).render.use_shape_keys&&!L.is_boundings_overridden&&m.update_boundings(L),O.check_inv_zup_tsr_is_needed(L)&&(L.need_inv_zup_tsr=!0),m.update_lod_scene(L,s)}}R.append_scene_vtex(H,e.textures,t.id),t.is_primary&&H._render.video_textures.length&&(t.has_video_textures=!0),n(t,r)}function ye(e){var t=e.materials;if(function(e){for(var t=0;t<e.length;t++){var r=e[t],_=Boolean("FILE"==r.source&&r.filepath.indexOf(".dds")>-1&&"dds"==w.compress_format);r._comp_method=_?"dds":""}}(e.images),(U.dds_available&&"dds"==w.compress_format||U.pvr_available&&"pvr"==w.compress_format)&&w.use_compression)for(var r=0;r<t.length;r++){for(var _=t[r],n=_.texture_slots,a=0;a<n.length;a++){var o=n[a],i=o.texture;"IMAGE"!=i.type&&"ENVIRONMENT_MAP"!=i.type||(u=i.image)&&!u._comp_method&&Ue(u,l=!i.b4w_disable_compression&&!o.use_map_normal&&"ENVIRONMENT_MAP"!=i.type&&!i.b4w_shore_dist_map&&"MOVIE"!=u.source)}var s=_.node_tree;if(s){var E=s.nodes;for(a=0;a<E.length;a++){var c=E[a],l=!1;if("TEXTURE"==c.type){var T=c.texture;T&&(u=T.image)&&!u._comp_method&&(l=!T.b4w_disable_compression&&"MOVIE"!=T.image.source&&"ENVIRONMENT_MAP"!=T.type&&!we(c))}else if("TEX_IMAGE"==c.type){var u;(u=c.image)&&!u._comp_method&&(l="MOVIE"!=u.source)}else"TEX_ENVIRONMENT"==c.type&&(l=!1);u&&!u._comp_method&&Ue(u,l)}}}}function we(e){for(var t=e.outputs,r=0;r<t.length;r++){var _=t[r];if(_.is_linked&&"Normal"==_.identifier)return!0}return!1}function Ue(e,t){e.filepath.indexOf(".dds")>-1?e._comp_method="dds":t?(e._comp_method=w.compress_format,e.filepath+="dds"==w.compress_format?".dds":".pvr"):e._comp_method=""}function Ce(e,t,r,_,n,a){for(var o=e.groups,i=e.objects,s={},E={},c={},l={},T=0;T<o.length;T++){var u=o[T];s[u.uuid]=u,c[u.uuid]=u}for(T=0;T<i.length;T++){var d=i[T];E[d.uuid]=d,l[d.uuid]=d}var f=e.scenes;for(T=0;T<f.length;T++)De(f[T].objects,null,l,c,null);for(var P in c)P in s||o.push(c[P]);for(var P in l)P in E||i.push(l[P]);n(t,r)}function De(e,t,r,_,n){for(var a=[],o=0;o<e.length;o++){var i=(v=r[(m=e[o]).uuid]).proxy;if(i){t&&-1==a.indexOf(i.uuid)&&a.push(i.uuid);for(var s=r[i.uuid],E=s.constraints,c=0;c<E.length;c++){var T=ln(E[c]);T.name=T.name+"_CLONE",v.constraints.push(T)}"b4w_proxy_inherit_anim"in v&&!v.b4w_proxy_inherit_anim||(v.animation_data&&(s.animation_data=ln(v.animation_data)),s.b4w_use_default_animation=v.b4w_use_default_animation,s.b4w_auto_skel_anim=v.b4w_auto_skel_anim,s.b4w_anim_behavior=v.b4w_anim_behavior,s.b4w_cyclic_animation=v.b4w_cyclic_animation)}}for(o=0;o<a.length;o++){var u=Z_(e,"uuid",a[o]);u>-1&&e.splice(u,1)}var d={};if(t)for(o=0;o<e.length;o++){var f=ln(v=r[(m=e[o]).uuid]),P="origin_name"in v?v.origin_name:v.name;f.name=O.gen_dupli_name(t.name,P),f.origin_name=P,f.dg_parent={uuid:t.uuid},Fe(f),r[f.uuid]=f,d[m.uuid]=f.uuid,m.uuid=f.uuid,n&&n[v.uuid]&&(f.b4w_cluster_data=n[v.uuid])}for(o=0;o<e.length;o++)if((v=r[(m=e[o]).uuid]).dupli_group){var A=v.dupli_group,S=_[A.uuid],p=ln(S);p.name=l.unique_name(S.name+"_CLONE"),Ge(p),_[p.uuid]=p,A.uuid=p.uuid,De(p.objects,v,r,_,v.b4w_cluster_data)}if(t)for(o=0;o<e.length;o++){var m,v;(v=r[(m=e[o]).uuid]).parent&&v.parent.uuid in d?v.parent.uuid=d[v.parent.uuid]:v.parent&&(N.warn("Object's \""+v.name+'" parent is not in dupli group. Disabling parenting.'),v.parent=null);for(E=v.constraints,c=0;c<E.length;c++)(b=E[c]).target&&b.target.uuid in d&&(b.target.uuid=d[b.target.uuid]);var g=v.pose;if(g){var h=g.bones;for(c=0;c<h.length;c++){var R=h[c].constraints;if(R)for(var I=0;I<R.length;I++){var b;(b=R[I]).target&&b.target.uuid in d&&(b.target.uuid=d[b.target.uuid])}}}var Y=v.modifiers;for(c=0;c<Y.length;c++){var L=Y[c];L.object&&L.object.uuid in d&&(L.object.uuid=d[L.object.uuid])}var M=v.lod_levels;if(M&&M.length)for(c=0;c<M.length;c++){var x=M[c];x.object&&x.object.uuid in d&&(x.object.uuid=d[x.object.uuid])}}for(var y in d)Q[y]=d[y]}function Fe(e){e.uuid=tE("Object"+e.name)}function Ge(e){e.uuid=tE("Group"+e.name)}function ke(e,t){if(e.action&&Be(e,"action",t),e.nla_tracks)for(var r=0;r<e.nla_tracks.length;r++)for(var _=e.nla_tracks[r],n=0;n<_.strips.length;n++)_.strips[n].action&&Be(_.strips[n],"action",t)}function Ke(e,t){for(var r=e.nodes,_=0;_<r.length;_++){var n=r[_];"TEXTURE"==n.type&&n.texture&&Be(n,"texture",t),"LAMP"==n.type&&n.lamp&&(n.lamp.uuid in Q&&(n.lamp.uuid=Q[n.lamp.uuid]),t[n.lamp.uuid]||(n.lamp=null)),"GROUP"==n.type&&n.node_group&&Be(n,"node_group",t),"TEX_IMAGE"!=n.type&&"TEX_ENVIRONMENT"!=n.type||!n.image||Be(n,"image",t)}var a=e.links;for(_=0;_<a.length;_++){var o=a[_];Xe(o,"from_node",r),Xe(o,"to_node",r),He(o,"from_socket",o.from_node.outputs),He(o,"to_socket",o.to_node.inputs)}var i=e.animation_data;i&&ke(i,t)}function Be(e,t,r){if(e[t]){var _=r[e[t].uuid];_||N.error("Dangling link found:",t,e),e[t]=_}}function Xe(e,t,r){var _=J_("name",e[t].name,r);e[t]=_}function He(e,t,r){var _=J_("identifier",e[t].identifier,r);e[t]=_}function Qe(e,t,r,_,n,o){for(var i=[],s=[],E={},c=e.images,l=L.get_img_textures(),T=At(t.filepath),u=0;u<c.length;u++){var d=c[u],f=d.uuid;if(f){var P=cs(T+d.filepath),A=a.split_extension(P),S=A[1].toLowerCase(),p=d.source;if("FILE"===p){if(d._comp_method)var m=a.AT_ARRAYBUFFER;else m=a.AT_IMAGE_ELEMENT;if(!a.check_image_extension(S)){N.error('image "'+d.name+'" has unsupported format or broken path.');continue}U.min50_available&&w.use_min50&&(P=ze(A))}else{if("MOVIE"!==p){N.error('Image "'+d.name+'" has unsupported format "'+p+'".');continue}if(w.seq_video_fallback)P=A[0]+".altconv.seq",m=a.AT_SEQ_VIDEO_ELEMENT;else{var O=I.detect_video_container(S);if(""==O){N.error("failed to load video file (unsupported format)",P);continue}P=O!=S?A[0]+".altconv."+O:A[0]+"."+A[1],m=a.AT_VIDEO_ELEMENT}}f in E||(E[f]=[]);for(var v=0;v<l.length;v++){var g=l[v];(!L.get_cache_loaded_status(g)&&g.img_comp_method==d._comp_method&&g.img_uuid==f||t.is_preloading)&&E[f].push(g)}d._comp_method&&w.assets_gzip_available&&(m=a.AT_ARRAYBUFFER_ZIP,P+=".gz"),E[f].length&&i.push({id:f,type:m,url:P,is_fetch:t.is_preloading})}}if(i.length){var h=0,b=function(_,n,c,l){if(_){if(t.is_preloading)P=c;else{for(var T=E[n],u=0;u<T.length;u++){var d=T[u];if(c==a.AT_SEQ_VIDEO_ELEMENT)d.seq_fps=_.fps,L.update_texture(d,_.images,t.id);else if(L.update_texture(d,_,t.id),"ENVIRONMENT_MAP"==d.source&&t.is_primary)for(var f=0;f<e.scenes.length;f++)R.update_world_texture(e.scenes[f]);L.set_cache_loaded_status(d,!0)}var P=T[0].img_comp_method}c==a.AT_VIDEO_ELEMENT||c==a.AT_SEQ_VIDEO_ELEMENT?function(e,t,r,n){if(n==a.AT_VIDEO_ELEMENT)var o=_.videoWidth,i=_.videoHeight;else o=_.images[0].width,i=_.images[0].height;N.log("%cLOAD VIDEO "+o+"x"+i,"color: #"+(o>2048||i>2048?"a00":o>1024||i>1024?"aa0":"0a0"),t),-1==t.indexOf(X)&&N.warn("video",t,"is not from app root.")}(0,l,0,c):se(_,l,!0,P)}else{var A=function(e,t,r,_){var n,o=t.split("?v")[0],i=a.split_extension(o);if("gz"==i[1])var s=i[0],E=a.AT_ARRAYBUFFER;else if("dds"==i[1]||"pvr"==i[1])s=i[0],E=a.AT_IMAGE_ELEMENT,function(e){for(var t=0;t<e.length;t++)e[t].img_comp_method=""}(_[e]);else{if(-1==o.indexOf(".min50"))return null;s=(n=o.split(".min50"))[0]+n[1],E=a.AT_IMAGE_ELEMENT}return{id:e,type:E,url:s,is_fetch:r}}(n,l,t.is_preloading,E);A&&(N.warn("Trying to load fallback image",A.url),s.push(A))}var S=++h/(i.length+s.length);o(t,r,S)},Y=function(){s.length?(a.enqueue(s,b,Y),s.length=0):(N.log("%cLOADED ALL IMAGES","color: #0a0"),n(t,r))};a.enqueue(i,b,Y)}else n(t,r)}function ze(e){if("dds"==e[1]){var t=a.split_extension(e[0]);return t[0]+".min50."+t[1]+".dds"}return e[0]+".min50."+e[1]}function Ve(e,t,r,_,n,a){for(var o=R.get_rendered_scenes(),i=0;i<o.length;i++){var s=o[i];if(s.b4w_use_nla){var E=s.b4w_nla_cyclic;s.b4w_use_logic_editor&&(E=!1),P.update_scene(s,E,t.id)}}n(t,r)}function je(e,t,r,_,n,o){for(var i=At(t.filepath),s=[],E={},c=m.get_all_objects("ALL",t.id),l=0;l<c.length;l++){var T=c[l];if(We(T)){var u=T.sfx.uuid;if("BACKGROUND_MUSIC"==I.get_spk_behavior(T)?(u=zn(),t.has_background_music=!0):"NONE"!=I.get_spk_behavior(T)&&w.init_wa_context_hack&&(t.init_wa_context=!0),!(u in E)){E[u]=[];var d=cs(i+T.sfx.filepath);switch(I.source_type(T)){case I.AST_ARRAY_BUFFER:var f=a.AT_AUDIOBUFFER;break;case I.AST_HTML_ELEMENT:f=a.AT_AUDIO_ELEMENT}qe(s,u,f,d,t.is_preloading)}E[u].push(T)}}if(s.length){var P=0;a.enqueue(s,function(e,_,n,a){if(e){N.log("%cLOAD SOUND","color: #0aa",a),-1==a.indexOf(X)&&N.warn("sound",a,"is not from app root.");for(var i=E[_],c=0;c<i.length;c++)I.update_spkobj(i[c],e)}var l=++P/s.length;o(t,r,l)},function(){N.log("%cLOADED ALL SOUNDS","color: #0aa"),n(t,r)})}else n(t,r)}function qe(e,t,r,_,n){var o=a.split_extension(_),i=o[1].toLowerCase(),s=I.detect_audio_container(i);""!=s?e.push({id:t,type:r,url:_=s!=i?o[0]+".altconv."+s:o[0]+"."+o[1],is_fetch:n}):N.error("failed to load audio file (unsupported format)",_)}function We(e){return O.is_speaker(e)&&I.source_type(e)!=I.AST_NONE}function Je(e,t,r){for(var _=m.get_scene_objs(e,"SPEAKER",t),n=0;n<_.length;n++){var a=_[n];O.is_speaker(a)&&(I.is_autoplay(a)||r)&&I.play_def(a)}}function Ze(e,t){for(var r=e._render.video_textures,_=0;_<r.length;_++){var n=r[_]._render;e.b4w_use_nla&&r[_].b4w_nla_video||!r[_].use_auto_refresh||t==n.vtex_data_id&&(L.reset_video(n),L.play_video(n))}}function $e(e,t,r,_,n,a){P.prepare(),n(t,r)}function et(e,t,r,_,n,a){P.start(),N.log("%cSTART NLA","color: #0a0"),n(t,r)}function tt(e,t,r,_,n){for(var a=r.lod_levels.length,o=0;o<a;o++){var i=r.lod_levels[o],s=i.object;if(s){var E=n.lod_parents.indexOf(r);if(-1==E)n.lod_parents.push(r),n.lod_levels_data.push(c={old_lods:[],new_lods:[],lod_levels:[],scene_arrays:[],objs_container_arrays:[]});else var c=n.lod_levels_data[E];var l=c.old_lods.indexOf(s);if(-1!=E&&-1!=l)c.scene_arrays[l].push(e),c.objs_container_arrays[l].push(t);else{var T=Tn(s);T.name=r.name+"_LOD_"+String(o+1),T.b4w_cluster_data=r.b4w_cluster_data,Fe(T),T.lod_levels=[],_&&(T.dg_parent=_),c.old_lods.push(s),c.new_lods.push(T),c.lod_levels.push(i),c.scene_arrays.push([e]),c.objs_container_arrays.push([t])}}}var u=r.dupli_group;if(u)for(var d=u.objects,f=0;f<d.length;f++)tt(e,d,d[f],r,n)}function rt(e,t){for(var r=0;r<t.length;r++){for(var _=t[r].objects,n=0;n<_.length;n++){var a=_[n].dupli_group;a&&_t(e,a)}var o=_.indexOf(e);o>-1&&_.splice(o,1)}}function _t(e,t){var r=t.objects,_=r.indexOf(e);_>-1&&r.splice(_,1);for(var n=0;n<r.length;n++)(t=r[n].dupli_group)&&_t(e,t)}function nt(e,t,r,_,n,a){for(var o=!0,i=0;i<e.scenes.length;i++)if(!v.check_worker_loaded(e.scenes[i])){o=!1;break}o&&(n(t,r),N.log("%cPHYSICS READY","color: #0a0"))}function at(e,t,r,_,n,a){for(var o=0;o<e.scenes.length;o++){var i=e.scenes[o];if(t.is_primary)var s=v.scene_has_physics(i);else s=v.scene_has_physics(H)||v.scene_has_physics(i),i=H;if(C.enabled&&s)for(var E=0;E<_e.length;E++)for(var c=m.get_scene_objs(i,_e[E],t.id),l=0;l<c.length;l++){var T=c[l];T.render.data_id==t.id&&(v.append_object(T,i),t.load_hidden&&v.obj_has_physics(T)&&v.disable_simulation(T))}}n(t,r)}function ot(e,t,r,_,n,o){for(var i={},s=[],E=e.scenes,c=0;c<e.scenes.length;c++){var l=E[c];if(l._render.water_params){var T=l._render.water_params.shoremap_image;if(T&&"FILE"===T.source){var u=T.uuid,d=cs(At(t.filepath)+T.filepath);if(T._comp_method)var f=a.AT_ARRAYBUFFER;else f=a.AT_IMAGE_ELEMENT;s.push({id:u,type:f,url:d}),i[u]=T}}}s.length?a.enqueue(s,function(e,r,_,n){if(e){se(e,n,!0);var a=function(e){for(var t=[],r=L.get_img_textures(),_=0;_<r.length;_++){var n=r[_];n.uri===e&&t.push(n)}return t}(r);for(s=0;s<a.length;s++)L.update_texture(a[s],e,t.id);for(s=0;s<E.length;s++)(c=E[s])._render.water_params&&(l=c._render.water_params.shoremap_image)===T&&it(e,T,c)}else for(var o=i[r],s=0;s<E.length;s++){var c,l;(l=(c=E[s])._render.water_params.shoremap_image)===o&&(c._render.water_params.shoremap_image=null,N.warn("image",l.filepath," was not found. Disabling water shore effects."))}},function(){n(t,r)}):n(t,r)}function it(e,t,r){var _=document.createElement("canvas"),n=t.size[0],a=t.size[1];_.width=n,_.height=a;var o=_.getContext("2d");o.drawImage(e,0,0);var i=o.getImageData(0,0,n,a).data,s=new Float32Array(4);s[0]=1/16581375,s[1]=1/65025,s[2]=1/255,s[3]=1;for(var E=n*a,c=new Float32Array(E),l=0;l<E;l++)c[l]=s[1]*i[4*l+2]+s[2]*i[4*l+3];r._render.shore_distances=c}function st(e,t,r,_,n,o){for(var s=e.scenes[0],E=[],c=[Y.SMAA_EDGE_DETECTION,Y.SMAA_BLENDING_WEIGHT_CALCULATION,Y.SMAA_NEIGHBORHOOD_BLENDING,Y.SMAA_RESOLVE],l=0;l<c.length;l++){var T=R.get_subs(s,c[l]);T&&E.push(T)}if(E.length){var u=[],d=a.AT_IMAGE_ELEMENT;for(u.push({id:"SEARCH_TEXTURE",type:d,url:i.paths.smaa_search_texture_path,is_fetch:t.is_preloading}),u.push({id:"AREA_TEXTURE",type:d,url:i.paths.smaa_area_texture_path,is_fetch:t.is_preloading}),l=0;l<E.length;l++){var f=E[l];if(f.type==Y.SMAA_BLENDING_WEIGHT_CALCULATION){for(var P=f.slinks_internal,A=0;A<P.length;A++){var S=P[A];if("u_search_tex"==S.to)var p=S.texture;else if("u_area_tex"==S.to)var m=S.texture}break}}u.length?a.enqueue(u,function(e,r,_,n){if(e){if(se(e,n,!1),"SEARCH_TEXTURE"==r)var a=p;else a=m;a.source="IMAGE",L.update_texture(a,e,t.id),L.set_filters(a,L.TF_LINEAR,L.TF_LINEAR)}},function(){n(t,r)}):n(t,r)}else n(t,r)}function Et(e,t,r,_,n,a){for(var o=0;o<e.scenes.length;o++){var i=e.scenes[o];t.is_primary||(i=H);for(var s=m.get_scene_objs(i,"LAMP",t.id),E=0;E<s.length;E++){var c=s[E];c.render.data_id==t.id&&_.added_objects.push({scene:i,obj:c})}var l=m.get_scene_objs(i,"ALL",t.id);for(E=0;E<l.length;E++){var T=l[E];"LAMP"!=T.type&&T.render.data_id==t.id&&(t.load_hidden&&O.is_mesh(T)&&R.change_visibility(T,!0),_.added_objects.push({scene:i,obj:T}))}}}function ct(e,t,r,n,a,o){var i=n.added_objects,s=n.obj_counter;if(i.length){var E=i[s].obj,c=i[s].scene,l=O.get_scene_data(E,c);R.append_object(c,E),!E.anchor||c._render.anaglyph_use||c._render.sidebyside_use||_.append(E);var T=++n.obj_counter/i.length;E.render.hide_children&&R.change_visibility_rec(E,!0);var u=l.cube_refl_subs;if(-1!=E.render.cube_reflection_id&&u){var d=he(E.render.bs_world.center,z);R.update_cube_reflect_subs(u,d)}var f=E.reflective_objs;if(f.length&&c._render.reflection_params)for(var P=Fa(E.render.world_tsr),A=Ba(E.render.world_tsr),S=l.plane_refl_subs,p=0;p<S.length;p++)R.update_plane_reflect_subs(S[p],P,A),O.update_refl_objects(f,S[p].camera.reflection_plane)}else T=1;o(t,r,T)}function lt(e,t,r,_,n,a){if(t.is_primary){var o=R.get_main();R.update_world_texture(o);for(var i=R.get_rendered_scenes(),s=0;s<i.length;s++){var E=i[s];R.update_world_texture(E),R.prepare_rendering(E,o)}R.set_active(o)}else R.update_scene_permanent_uniforms(H);var c=m.get_all_objects("ALL",t.id);m.update_objects_dynamics(c),n(t,r)}function Tt(e,t,r,_,n,a){if(t.is_primary)for(var o=R.get_rendered_scenes(),i=0;i<o.length;i++)for(var s=o[i],E=m.get_scene_objs(s,"WORLD",0),c=0;c<E.length;c++)R.init_cube_sky_dim(s,E[c]),R.update_world_texture(s);n(t,r)}function ut(e,t,r,_,n,a){if(t.is_primary)for(var o=R.get_rendered_scenes(),i=0;i<o.length;i++){var s=o[i];s.b4w_use_logic_editor&&A.init_logic(s,t.id)}n(t,r)}function dt(e,t,r,_,n,a){if(t.is_primary)for(var o=0;o<e.scenes.length;o++)Ze(e.scenes[o],t.id),Je(e.scenes[o],t.id,!1);else Ze(H,t.id),Je(H,t.id,!1);n(t,r)}function ft(e,t,r,_,n,a){!function(e,t){for(var r=0;r<e.scenes.length;r++)e.scenes[r].camera=null}(e),w.media_auto_activation&&(t.has_video_textures||t.has_background_music||t.init_wa_context)?J||function(e,t,r,_){var n=oe.parentElement;$=n.style.zIndex,n.style.zIndex="999",(J=document.createElement("div")).style.position="relative",J.style.height="88px",J.style.width="88px";var a=Math.round(oe.offsetHeight/2-44),o=Math.round(oe.offsetWidth/2-44);J.style.top=a.toString()+"px",J.style.left=o.toString()+"px",J.style.backgroundImage="url('"+W+"')",J.style.backgroundSize="88px",(Z=document.createElement("div")).style.position="relative",Z.style.height=oe.offsetHeight.toString()+"px",Z.style.width=oe.offsetWidth.toString()+"px",Z.style.background="rgba(0, 0, 0, 0.5)",Z.style.zIndex="999",n.appendChild(Z),Z.appendChild(J),d.add_click_listener(J,te=function(){if(r.has_video_textures&&(L.play(),L.pause(),L.reset()),r.has_background_music){if(r.is_primary)for(var n=0;n<e.scenes.length;n++)Je(e.scenes[n],r.id,!0);else Je(H,r.id,!0);I.pause()}r.init_wa_context&&I.play_empty_sound(),Pt(),t(r,_)})}(e,n,t,r):n(t,r)}function Pt(){if(J){var e=oe.parentElement;e.style.zIndex=$,d.remove_click_listener(J,te),Z.removeChild(J),e.removeChild(Z),Z=null,J=null,$=0}}function At(e){var t=e.split("/").slice(0,-1).join("/");return t&&(t+="/"),t}function St(e){n.is_animated(e)&&n.remove(e),S.remove_obj_from_cache(e),m.clear_outline_anim(e),E.check_sensor_manifold(e)&&E.remove_sensor_manifold(e),v.obj_has_physics(e)&&v.remove_object(e),R.remove_object_bundles(e),O.is_speaker(e)&&I.speaker_remove(e),_.is_anchor(e)&&_.remove(e)}function pt(e){var t=function(e){var t=n.get_bpy_armobj(e);return t&&t.parent==e?null:e.parent||t}(e);return t?1+pt(t):0}t.is_primary_loaded=function(e){return f.is_primary_loaded(e)},t.update=function(){f.update_scheduler(K)},t.setup_canvas=function(e){oe=e},t.update_media_controls=function(e,t){if(J){Z.style.height=t.toString()+"px",Z.style.width=e.toString()+"px";var r=Math.round(t/2-44),_=Math.round(e/2-44);J.style.top=r.toString()+"px",J.style.left=_.toString()+"px"}},t.load=function(e,t,r,_,n){var a={load_main:{priority:f.ASYNC_PRIORITY,background_loading:!1,inputs:[],is_resource:!1,relative_size:500,primary_only:!1,cb_before:Ee},duplicate_objects:{priority:f.SYNC_PRIORITY,background_loading:!1,inputs:["load_main"],is_resource:!1,relative_size:50,primary_only:!1,cb_before:Ce},load_binaries:{priority:f.ASYNC_PRIORITY,background_loading:!1,inputs:["load_main"],is_resource:!1,relative_size:500,primary_only:!1,cb_before:ce},wait_for_shaders:{priority:f.SYNC_PRIORITY,background_loading:!1,inputs:[],is_resource:!1,relative_size:50,primary_only:!0,cb_loop:le},prepare_bindata:{priority:f.SYNC_PRIORITY,background_loading:!1,inputs:["duplicate_objects","load_binaries"],is_resource:!1,relative_size:100,primary_only:!1,cb_before:Te},prepare_bpy_data:{priority:f.SYNC_PRIORITY,background_loading:!1,inputs:["duplicate_objects","prepare_bindata"],is_resource:!1,relative_size:100,primary_only:!1,cb_before:pe},process_objects:{priority:f.SYNC_PRIORITY,background_loading:!1,inputs:["prepare_bpy_data"],is_resource:!1,relative_size:150,primary_only:!1,cb_before:Me},process_scenes:{priority:f.SYNC_PRIORITY,background_loading:!1,inputs:["process_objects","wait_for_shaders"],is_resource:!1,relative_size:300,primary_only:!1,cb_before:xe},load_smaa_textures:{priority:f.ASYNC_PRIORITY,background_loading:!1,inputs:["process_scenes"],is_resource:!1,relative_size:30,primary_only:!0,cb_before:st},load_shoremap:{priority:f.ASYNC_PRIORITY,background_loading:!1,inputs:["process_scenes"],is_resource:!1,relative_size:30,primary_only:!0,cb_before:ot},load_images:{priority:f.ASYNC_PRIORITY,background_loading:!0,inputs:["process_scenes"],is_resource:!0,relative_size:500,primary_only:!1,cb_before:Qe},update_scenes_nla:{priority:f.SYNC_PRIORITY,background_loading:!1,inputs:["process_scenes","load_images"],is_resource:!1,relative_size:50,primary_only:!1,cb_before:Ve},wait_physics_workers:{priority:f.SYNC_PRIORITY,background_loading:!1,inputs:["load_shoremap"],is_resource:!1,relative_size:20,primary_only:!1,cb_loop:nt},add_physics_objects:{priority:f.SYNC_PRIORITY,background_loading:!1,inputs:["wait_physics_workers"],is_resource:!1,relative_size:50,primary_only:!1,cb_before:at},add_objects:{priority:f.SYNC_PRIORITY,background_loading:!1,inputs:["add_physics_objects"],is_resource:!1,relative_size:600,primary_only:!1,cb_before:Et,cb_loop:ct,cb_after:lt,cb_param:{added_objects:[],obj_counter:0}},init_cube_sky_dynamic_props:{priority:f.SYNC_PRIORITY,background_loading:!1,inputs:["add_objects","load_images"],is_resource:!1,relative_size:50,primary_only:!1,cb_before:Tt},init_logic_nodes:{priority:f.SYNC_PRIORITY,background_loading:!1,inputs:["update_scenes_nla","add_objects"],is_resource:!1,relative_size:50,primary_only:!1,cb_before:ut},load_speakers:{priority:f.ASYNC_PRIORITY,background_loading:!0,inputs:["add_objects"],is_resource:!0,relative_size:100,primary_only:!1,cb_before:je},mobile_media_start:{priority:f.SYNC_PRIORITY,background_loading:!1,inputs:["load_images","update_scenes_nla","load_speakers","init_logic_nodes"],is_resource:!0,relative_size:5,primary_only:!1,cb_before:ft,cb_loop:ft},synchronize_media:{priority:f.SYNC_PRIORITY,background_loading:!0,inputs:["mobile_media_start"],is_resource:!0,relative_size:50,primary_only:!1,cb_before:dt},prepare_nla:{priority:f.SYNC_PRIORITY,background_loading:!1,inputs:["mobile_media_start"],is_resource:!1,relative_size:5,primary_only:!0,cb_before:$e},start_nla:{priority:f.SYNC_PRIORITY,background_loading:!0,inputs:["prepare_nla"],is_resource:!1,relative_size:5,primary_only:!0,cb_before:et}},o=f.get_scheduler();return o||(o=f.create_scheduler(),K={},B={},Q={}),K[o.threads.length]={},f.create_thread(a,e,t,r,ie,_||D.audio_loading_hack,w.do_not_load_resources,n,!1)},t.unload=function(e){var t=f.get_scheduler();if(t&&t.threads.length&&(!e||f.thread_is_finished(t.threads[e]))){if(0==e)N.log("%cUNLOAD ALL","color: #00a"),_.cleanup(),n.cleanup(),I.cleanup(),o.cleanup(),R.cleanup(),f.cleanup(),E.cleanup(),v.cleanup(),m.cleanup(),l.cleanup(),h.cleanup(),p.cleanup(),b.cleanup(),u.cleanup(),a.cleanup(),L.cleanup(),A.cleanup(),S.cleanup(),d.cleanup(),T.cleanup(),B=null,Q={},H=null,K=null,ee=!1;else{N.log("%cUNLOAD DATA "+e,"color: #00a"),n.remove_actions(e);for(var r=m.get_all_objects("ALL",m.DATA_ID_ALL),i=0;i<r.length;i++)O.get_object_data_id(s=r[i])!=e&&m.obj_switch_cleanup_flags(s,!1,!1,!1);for(i=(r=m.get_all_objects("ALL",e)).length-1;i>=0;i--){var s;St(s=r[i]),m.remove_object(s)}for(r=m.get_all_objects("ALL",m.DATA_ID_ALL),i=0;i<r.length;i++)m.obj_switch_cleanup_flags(r[i],!0,!0,!0)}P.cleanup(e),Pt()}else N.error("Unable to unload data!")},t.prepare_object_unloading=St,t.set_debug_resources_root=function(e){X=e},t.activate_media=function(){ee||w.media_auto_activation||(L.play(),L.pause(),L.reset(),Je(H,m.DATA_ID_ALL,!0),I.pause(),w.init_wa_context_hack&&I.play_empty_sound(),ee=!0)},t.reset=function(){oe=null},t.prefetch=function(e,t,r){var _={load_main:{priority:f.ASYNC_PRIORITY,background_loading:!1,inputs:[],is_resource:!1,relative_size:500,primary_only:!1,cb_before:Ee},load_binaries:{priority:f.ASYNC_PRIORITY,background_loading:!1,inputs:["load_main"],is_resource:!1,relative_size:500,primary_only:!1,cb_before:ce},load_images:{priority:f.ASYNC_PRIORITY,background_loading:!1,inputs:["load_main"],is_resource:!1,relative_size:500,primary_only:!1,cb_before:Qe},preload_sounds:{priority:f.ASYNC_PRIORITY,background_loading:!1,inputs:["load_main"],is_resource:!1,relative_size:500,primary_only:!1,cb_before:me}},n=f.get_scheduler();return n||(n=f.create_scheduler(),K={},B={},Q={}),K[n.threads.length]={},f.create_thread(_,e,t,r,ie,!1,w.do_not_load_resources,!1,!0)},t.unfetch=function(){a.clear_cache()}}),aE=A("__container",function(e,t){var r=ha(e),_=Wo(e),n=nE(e),a=us(e),o=ga(e),i=ps(e),s=ai(e),E=Os(e),c=_.defaults,l=_.context_limits,T=null,u=null,d=null,f=null,P={clientX:0,clientY:0},A={width:0,height:0,scale:1,offset_top:0,offset_left:0};function S(){return u}function p(){return d}function m(){return f}function O(e,t){A.offset_left=e,A.offset_top=t}function v(){var e=u.getBoundingClientRect();O(e.left,e.top)}function N(e,t,r,_){if(c.ie11_edge_mouseoffset_hack){var n=r.getBoundingClientRect();_[0]=e-n.left,_[1]=t-n.top}else{P.clientX=e,P.clientY=t,P.view=window;var a=new MouseEvent("b4w_convert",P);r.dispatchEvent(a),_[0]=a.offsetX,_[1]=a.offsetY}return _}function g(e,t,r,_){e.style.width=r+"px",e.style.height=_+"px",t&&(t.style.width=r+"px",t.style.height=_+"px")}function h(e,t,r){var _=S(),s=p();r&&g(_,s,e,t),s&&(s.width=e,s.height=t,a.update_dim());var u=Math.floor(e*c.canvas_resolution_factor),d=Math.floor(t*c.canvas_resolution_factor);_.width=u,_.height=d;var f=Math.min(T.drawingBufferWidth,l.max_renderbuffer_size,l.max_viewport_dims[0]),P=Math.min(T.drawingBufferHeight,l.max_renderbuffer_size,l.max_viewport_dims[1]);if(u>f||d>P){o.warn("Canvas size exceeds platform limits, downscaling");var A=Math.min(f/u,f/d);u*=A,d*=A}if(e)var m=u/e;else m=1;_.width=Math.floor(u),_.height=Math.floor(d),i.setup_dim(_.width,_.height,m),i.check_active()&&E.update_transform(i.get_active()._camera),n.update_media_controls(_.width,_.height)}t.setup_context=function(e){T=e},t.get_canvas=S,t.get_canvas_hud=p,t.get_container=m,t.init=function(e,t){e&&e.parentNode?(u=e,d=t,f=e.parentNode):r.panic("canvas container is not available")},t.insert_to_container=function(e,t){switch(t=t||"LAST"){case"FIRST":f.insertBefore(e,f.firstElementChild);break;case"JUST_BEFORE_CANVAS":f.insertBefore(e,u);break;case"JUST_AFTER_CANVAS":u.nextElementSibling?f.insertBefore(e,u.nextElementSibling):f.appendChild(e,u);break;case"LAST":f.appendChild(e,u);break;default:o.error(t+" invalid stack order")}},t.get_viewport_width=function(){return A.width},t.get_viewport_height=function(){return A.height},t.set_canvas_offsets=O,t.update_canvas_offsets=v,t.setup_viewport_dim=function(e,t,r){A.width=e,A.height=t,A.scale=r,v()},t.force_offsets_updating=function(){},t.client_to_canvas_coords=function(e,t,r){return N(e,t,u,r)},t.get_coords_target_space=function(e,t,r){if(e.constructor==MouseEvent)r[0]=e.offsetX,r[1]=e.offsetY;else if(e.constructor==TouchEvent){if("touchend"==e.type)var _=e.changedTouches;else _=t?e.targetTouches:e.touches;N(_[0].clientX,_[0].clientY,e.target,r)}else r[0]=-1,r[1]=-1;return r},t.client_to_element_coords=N,t.canvas_to_viewport_coords=function(e,t,r,_){if(r||(r=new Float32Array(2)),r[0]=e*A.scale,r[1]=t*A.scale,_){var n=_.width/A.width;r[0]*=n,r[1]*=n}return r},t.viewport_to_canvas_coords=function(e,t,r,_){if(r||(r=new Float32Array(2)),r[0]=e/A.scale,r[1]=t/A.scale,_){var n=_.width/A.width;r[0]/=n,r[1]/=n}return r},t.is_child=function(e){return!(!e||!e.parentNode)&&(e.parentNode==f||t.is_child(e.parentNode))},t.is_hidpi=function(){return!!(c.allow_hidpi&&window.devicePixelRatio>=2)},t.resize=h,t.resize_to_container=function(e){var t=m(),r=S(),_=t.clientWidth,n=t.clientHeight;if(e||_!=r.clientWidth||n!=r.clientHeight){var a=r.width,o=r.height;if(g(S(),p(),_,n),i.check_active()){var E=i.get_active(),c=i.get_subs(E,s.STEREO);if(c&&c.enable_hmd_stereo)return void h(a,o,!1)}h(_,n,!1)}},t.reset=function(){T=null,u=null,d=null,f=null}}),oE=A("__camera",function(e,t){var r=ha(e),_=aE(e),n=os(e),a=ga(e),o=ps(e),i=ai(e),s=Os(e);t.TYPE_NONE=10,t.TYPE_PERSP=20,t.TYPE_ORTHO=30,t.TYPE_PERSP_ASPECT=40,t.TYPE_ORTHO_ASPECT=50,t.TYPE_ORTHO_ASYMMETRIC=60,t.TYPE_STEREO_LEFT=70,t.TYPE_STEREO_RIGHT=80,t.TYPE_HMD_LEFT=90,t.TYPE_HMD_RIGHT=100,t.MS_STATIC=0,t.MS_TARGET_CONTROLS=2,t.MS_EYE_CONTROLS=3,t.MS_HOVER_CONTROLS=4;var E=2.5,c=In(40),l=.1,T=1e3,u=In(.5),d=new Float32Array([1,1,1,1]),f=new Float32Array([-1,-1,1,1]),P=new Float32Array([0,0,-1,1]),A=new Float32Array(2),S=new Float32Array(2),p=new Float32Array(2),m=new Float32Array(3),O=new Float32Array(3),v=new Float32Array(3),N=new Float32Array(3),g=new Float32Array(3),h=new Float32Array(3),R=new Float32Array(4),I=new Float32Array(4),b=new Float32Array(4),Y=new Float32Array(4),L=new Float32Array(16),M=new Float32Array(24),x=new Float32Array(6);function y(e,t,r,_,n){s.set_translation(e,t),r&&_e(e,t,r),oe(e,_),ie(e,n)}function w(e,t,r,_,n,a,o,i){var E=e.render;s.set_translation(e,t),E.pivot.set(r),_e(e,t,r),oe(e,_),ie(e,n),Te(e,a),fe(e,o),E.use_panning=i}function U(e,t,r,_,n,a,o,i){var E=e.render;s.set_translation(e,t),E.hover_pivot.set(r),_e(e,t,r),le(e,_),se(e,n),Se(e,a),pe(e,o),E.enable_hover_hor_rotation=i}function C(e,t,r){var _=e.render,n=Fa(_.world_tsr),o=Ba(_.world_tsr),i=b;i.set(S_),i[3]=0;var s=Q(e,A)[1],E=sn(o,O_,m);return Tt(x,n),ut(x,E),(!ra(i,-t,x,r)||Math.abs(s)<u)&&(a.warn("Active hover camera view vector and the supporting plane are parallel to each other. Hover pivot will be set based on the camera position."),r[0]=n[0],r[1]=n[1],r[2]=0),r}function D(e){for(var r=e.render,_=0;_<e.scenes_data.length;_++){var n=e.scenes_data[_].cameras[0];if(n.type==t.TYPE_ORTHO)switch(r.move_style){case t.MS_TARGET_CONTROLS:var a=Fa(r.world_tsr);r.init_dist=Ue(a,r.pivot),r.init_fov=n.fov;break;case t.MS_HOVER_CONTROLS:a=Fa(r.world_tsr),r.init_dist=Ue(a,r.hover_pivot),r.init_fov=n.fov}}}function F(e){var t={type:e,name:"",size_mult:1,width:0,height:0,framebuffer:null,framebuffer_prev:null,color_attachment:null,depth_attachment:null,aspect:0,fov:0,fit:"VERTICAL",near:0,far:0,left:0,right:0,top:0,bottom:0,hmd_fov:tr(),world_tsr:new Float32Array(9),view_matrix:new Float32Array(16),view_refl_matrix:new Float32Array(16),view_transform_params:{trans:ve(),angle:0},proj_matrix:new Float32Array(16),view_proj_matrix:new Float32Array(16),view_proj_inv_matrix:new Float32Array(16),prev_view_proj_matrix:new Float32Array(16),sky_vp_inv_matrix:new Float32Array(16),direction:new Float32Array(3),view_tsr:La(),view_tsr_inv:La(),real_view_tsr:La(),real_view_tsr_inv:La(),shadow_cast_billboard_view_tsr:La(),dof_distance:0,dof_front_start:0,dof_front_end:0,dof_rear_start:0,dof_rear_end:0,dof_power:0,dof_bokeh_intensity:0,dof_object:null,dof_bokeh:!1,dof_foreground_blur:!1,dof_on:!1,lod_eye:new Float32Array(3),frustum_planes:k(),stereo_conv_dist:0,stereo_eye_dist:0,reflection_plane:null,csm_centers:null,csm_radii:null,csm_center_dists:new Float32Array(4),pcf_blur_radii:new Float32Array(4)};return t.hmd_fov[0]=t.hmd_fov[2]=0,t.hmd_fov[1]=t.hmd_fov[3]=0,t}function G(e,t){var r,_,n=F(e.type);return n.name=e.name,n.size_mult=e.size_mult,n.width=e.width,n.height=e.height,t||(n.framebuffer=e.framebuffer,n.framebuffer_prev=e.framebuffer_prev,n.color_attachment=e.color_attachment,n.depth_attachment=e.depth_attachment),n.aspect=e.aspect,n.fit=e.fit,n.fov=e.fov,n.near=e.near,n.far=e.far,n.left=e.left,n.right=e.right,n.top=e.top,n.bottom=e.bottom,nr(e.hmd_fov,n.hmd_fov),Ma(e.world_tsr,n.world_tsr),H(e.view_matrix,n.view_matrix),H(e.view_refl_matrix,n.view_refl_matrix),n.view_transform_params=ln(e.view_transform_params),H(e.proj_matrix,n.proj_matrix),H(e.view_proj_matrix,n.view_proj_matrix),H(e.view_proj_inv_matrix,n.view_proj_inv_matrix),H(e.prev_view_proj_matrix,n.prev_view_proj_matrix),H(e.sky_vp_inv_matrix,n.sky_vp_inv_matrix),n.direction.set(e.direction),Ma(e.view_tsr,n.view_tsr),Ma(e.view_tsr_inv,n.view_tsr_inv),Ma(e.real_view_tsr,n.real_view_tsr),Ma(e.real_view_tsr_inv,n.real_view_tsr_inv),Ma(e.shadow_cast_billboard_view_tsr,n.shadow_cast_billboard_view_tsr),n.dof_distance=e.dof_distance,n.dof_front_start=e.dof_front_start,n.dof_front_end=e.dof_front_end,n.dof_rear_start=e.dof_rear_start,n.dof_rear_end=e.dof_rear_end,n.dof_power=e.dof_power,n.dof_bokeh_intensity=e.dof_bokeh_intensity,n.dof_object=e.dof_object,n.dof_bokeh=e.dof_bokeh,n.dof_foreground_blur=e.dof_foreground_blur,n.dof_on=e.dof_on,he(e.lod_eye,n.lod_eye),nr((r=e.frustum_planes).left,(_=n.frustum_planes).left),nr(r.right,_.right),nr(r.top,_.top),nr(r.bottom,_.bottom),nr(r.near,_.near),nr(r.far,_.far),n.stereo_conv_dist=e.stereo_conv_dist,n.stereo_eye_dist=e.stereo_eye_dist,e.reflection_plane&&(n.reflection_plane=rr(e.reflection_plane)),function(e,t){if(e.csm_centers){var r=e.csm_centers.length;t.csm_centers=new Array(r);for(var _=0;_<r;_++)t.csm_centers[_]=Ne(e.csm_centers[_]);t.csm_radii=new Float32Array(e.csm_radii)}}(e,n),nr(e.csm_center_dists,n.csm_center_dists),nr(e.pcf_blur_radii,n.pcf_blur_radii),n}function k(){return{left:new Float32Array([0,0,0,0]),right:new Float32Array([0,0,0,0]),top:new Float32Array([0,0,0,0]),bottom:new Float32Array([0,0,0,0]),near:new Float32Array([0,0,0,0]),far:new Float32Array([0,0,0,0])}}function K(e){switch(e){case"STATIC":return t.MS_STATIC;case"TARGET":return t.MS_TARGET_CONTROLS;case"EYE":return t.MS_EYE_CONTROLS;case"HOVER":return t.MS_HOVER_CONTROLS;default:r.panic("Unknown move style")}}function B(e){var _=F(e);if(e==t.TYPE_NONE)return _;switch(e){case t.TYPE_PERSP:Z(_,c,l,T);break;case t.TYPE_ORTHO:Z(_,E,l,T);break;case t.TYPE_PERSP_ASPECT:case t.TYPE_ORTHO_ASPECT:case t.TYPE_ORTHO_ASYMMETRIC:break;case t.TYPE_STEREO_LEFT:case t.TYPE_STEREO_RIGHT:case t.TYPE_HMD_LEFT:case t.TYPE_HMD_RIGHT:r.panic("Stereo camera may only be created from perspective one");break;default:r.panic("Unknown camera type")}return _}function X(e,_,a){if(e.type!=t.TYPE_STEREO_LEFT&&e.type!=t.TYPE_STEREO_RIGHT&&e.type!=t.TYPE_HMD_LEFT&&e.type!=t.TYPE_HMD_RIGHT&&r.panic("set_stereo_params(): wrong camera type"),e.type!=t.TYPE_STEREO_LEFT&&e.type!=t.TYPE_STEREO_RIGHT||(e.stereo_conv_dist=_),e.stereo_eye_dist=a,Ve(e,!1),o.check_active()){var i=o.get_active(),s=i._render.shadow_params;if(s)for(var E=n.get_scene_data(o.get_camera(i),i).cameras,c=0;c<E.length;c++)tt(E[c],s)}}function Q(e,t){return j(Ba(e.render.world_tsr),e.render.vertical_axis,t)}function j(e,t,r){var _=m,n=O;Be(t,S_)>0?(Xe(P_,t,_),Ke(_,_)):he(S_,_),Xe(t,_,n);var a=sn(e,S_,v),o=sn(e,m_,N),i=-Math.asin(Be(a,t)),s=Be(o,t);if(Math.abs(i)>Math.PI/4)var E=ye(o,-W_(i),g);else E=ye(a,-W_(Math.asin(s)),h);var c=Math.atan(Math.abs(Be(n,E)/Be(_,E))),l=i;s>0&&(l=W_(l)*Math.PI-l);var T=c;return Be(_,E)<0&&(T=Math.PI-T),Be(n,E)<0&&(T=2*Math.PI-T),r[0]=T,r[1]=l,r}function q(e){switch(e.fit){case"AUTO":return e.aspect>1?nt(e)?e.fov/e.aspect:2*Math.atan(Math.tan(e.fov/2)/e.aspect):e.fov;case"HORIZONTAL":return nt(e)?e.fov/e.aspect:2*Math.atan(Math.tan(e.fov/2)/e.aspect);case"VERTICAL":return e.fov}}function Z(e,_,n,a){switch(e.type){case t.TYPE_PERSP:case t.TYPE_STEREO_LEFT:case t.TYPE_STEREO_RIGHT:case t.TYPE_ORTHO:e.fov=_,e.aspect=1;break;case t.TYPE_HMD_LEFT:case t.TYPE_HMD_RIGHT:break;default:r.panic("set_frustum(): Unsupported camera type: "+e.type)}e.near=n,e.far=a}function $(e,r){var _=Ga(r.render.world_tsr,m),n=Xa(r.render.world_tsr,R);if(V(Ee(n,_,L),e.view_matrix),o.check_active())var a=o.get_active(),s=o.get_subs(a,i.STEREO);e.type==t.TYPE_STEREO_LEFT||s&&s.enable_hmd_stereo&&e.type==t.TYPE_HMD_LEFT?e.view_matrix[12]+=e.stereo_eye_dist/2:(e.type==t.TYPE_STEREO_RIGHT||s&&s.enable_hmd_stereo&&e.type==t.TYPE_HMD_RIGHT)&&(e.view_matrix[12]-=e.stereo_eye_dist/2),e.reflection_plane&&(za(e.view_matrix,e.real_view_tsr),Ha(e.real_view_tsr,e.real_view_tsr_inv),function(e){var t=e.reflection_plane[0],r=e.reflection_plane[1],_=e.reflection_plane[2],n=e.reflection_plane[3],a=e.view_refl_matrix;a[0]=1-2*t*t,a[1]=-2*t*r,a[2]=-2*t*_,a[3]=0,a[4]=-2*t*r,a[5]=1-2*r*r,a[6]=-2*r*_,a[7]=0,a[8]=-2*t*_,a[9]=-2*r*_,a[10]=1-2*_*_,a[11]=0,a[12]=-2*t*n,a[13]=-2*r*n,a[14]=-2*_*n,a[15]=1}(e),function(e){W(e.view_matrix,e.view_refl_matrix,e.view_matrix)}(e),ee(e,!0),je(_,e.view_refl_matrix,_)),za(e.view_matrix,e.view_tsr),Ha(e.view_tsr,e.view_tsr_inv),ya(_,1,n,e.world_tsr),Je(e)}function ee(e,t){Ve(e,!0);var r=b,_=L;V(e.view_matrix,_),z(_,_),gr(e.reflection_plane,_,r);var n=Y;n[0]=(W_(r[0])+e.proj_matrix[8])/e.proj_matrix[0],n[1]=(W_(r[1])+e.proj_matrix[9])/e.proj_matrix[5],n[2]=-1,n[3]=(1+e.proj_matrix[10])/e.proj_matrix[14],Tr(r,2/(r[0]*n[0]+r[1]*n[1]+r[2]*n[2]+r[3]*n[3]),r),e.proj_matrix[2]=r[0],e.proj_matrix[6]=r[1],e.proj_matrix[10]=r[2]+1,e.proj_matrix[14]=r[3],qe(e),t||Je(e)}function te(e,t,r){var _=be(r,t,m);if(De(_)){Ke(_,_);var n=_a(O_,_,R);s.set_rotation(e,n)}s.set_translation(e,t)}function _e(e,t,r){var _=e.render,n=function(e){var t=Ba(e.render.world_tsr),r=e.render.vertical_axis;return Be(sn(t,A_,m),r)<0}(e);if(te(e,t,r),n){var a=he(_.vertical_axis,m);Ge(a,a),ae(e,a,!0)}else ae(e,_.vertical_axis,!0)}function ne(e,t){for(var r=e.render,_=t.cameras,n=sn(Xa(r.world_tsr,R),O_,m),a=Ga(r.world_tsr,O),o=t.shadow_cameras,i=0;i<o.length;i++)he(n,(E=o[i]).direction),Ga(r.world_tsr,E.lod_eye);for(i=0;i<_.length;i++){var E;if($(E=_[i],e),he(n,E.direction),E.dof_object&&E.dof_on){var c=Ue(a,s.get_translation(E.dof_object,v));E.dof_distance=c}}}function ae(e,t,r){var _=Ba(e.render.world_tsr),n=sn(_,S_,m);if(Ke(n,n),Math.abs(Be(t,n))>.999999)var a=Cr(R);else{var o=Xe(t,n,O);Ke(o,o),Be(sn(_,m_,v),t)>0&&Ge(o,o);var i=sn(_,P_,v);Ke(i,i);var s=Un(Be(i,o),-1,1);mr(a=s<=-.999999?Dr(n,Math.acos(s),R):wr(i,o,R),a)}Fr(a,_,_),r&&Be(t,sn(_,A_,m))<0&&Kr(_,Math.PI,_)}function oe(e,r){var _=e.render;r?(_.horizontal_limits=_.horizontal_limits||{},_.horizontal_limits.left=r.left,_.horizontal_limits.right=r.right,_.horizontal_limits.left_local=r.left,_.horizontal_limits.right_local=r.right,_.horizontal_limits.camera_space=Boolean(r.camera_space),function(e){var r=e.render,_=r.horizontal_limits;if(_&&(r.move_style==t.MS_EYE_CONTROLS||r.move_style==t.MS_TARGET_CONTROLS)){var n=Q(e,A);_.camera_space?(_.left+=n[0],_.right+=n[0]):(_.left_local-=n[0],_.right_local-=n[0]),_.left=Jn(_.left),_.right=Jn(_.right),_.left_local=Jn(_.left_local),_.right_local=Jn(_.right_local)}}(e)):_.horizontal_limits=null}function ie(e,t){var r=e.render;t?(r.vertical_limits=r.vertical_limits||{},r.vertical_limits.down=t.down,r.vertical_limits.up=t.up,r.vertical_limits.down_local=t.down,r.vertical_limits.up_local=t.up,r.vertical_limits.camera_space=Boolean(t.camera_space),ce(e)):r.vertical_limits=null}function se(e,t){var r=e.render;if(!t){var _=Q(e,A);t={down:_[1],up:_[1]}}r.vertical_limits=r.vertical_limits||{},r.vertical_limits.down=t.down,r.vertical_limits.up=t.up,ce(e),r.distance_limits&&r.vertical_limits&&ze(e)}function ce(e){var r=e.render,_=r.vertical_limits;if(_)switch(r.move_style){case t.MS_EYE_CONTROLS:case t.MS_TARGET_CONTROLS:var n=Q(e,A);_.camera_space?(_.up+=n[1],_.down+=n[1]):(_.up_local-=n[1],_.down_local-=n[1]),_.up=Wn(_.up,-Math.PI,Math.PI),_.down=Wn(_.down,-Math.PI,Math.PI),_.up_local=Wn(_.up_local,-Math.PI,Math.PI),_.down_local=Wn(_.down_local,-Math.PI,Math.PI);break;case t.MS_HOVER_CONTROLS:_.up=Wn(_.up,-Math.PI,Math.PI),_.down=Wn(_.down,-Math.PI,Math.PI),_.up=Un(_.up,-Math.PI/2,0),_.down=Un(_.down,-Math.PI/2,0)}}function le(e,t){var r=e.render;if(!t){var _=s.obj_point_distance(e,r.hover_pivot);t={min:_,max:_}}r.distance_limits=r.distance_limits||{},r.distance_limits.min=t.min,r.distance_limits.max=t.max,r.distance_limits&&r.vertical_limits&&ze(e)}function Te(e,t){var r=e.render;t?(r.distance_limits=r.distance_limits||{},r.distance_limits.min=t.min,r.distance_limits.max=t.max):r.distance_limits=null}function fe(e,t){var r=e.render;t?(r.pivot_limits=r.pivot_limits||{},r.pivot_limits.min_z=t.min_z,r.pivot_limits.max_z=t.max_z):r.pivot_limits=null}function Se(e,t){var r=e.render;t?(r.hover_horiz_trans_limits=r.hover_horiz_trans_limits||{},r.hover_horiz_trans_limits.min=t.min,r.hover_horiz_trans_limits.max=t.max):r.hover_horiz_trans_limits=null}function pe(e,t){var r=e.render;t?(r.hover_vert_trans_limits=r.hover_vert_trans_limits||{},r.hover_vert_trans_limits.min=t.min,r.hover_vert_trans_limits.max=t.max):r.hover_vert_trans_limits=null}function me(e){var r=e.render;if(n.is_camera(e))for(var _=e.scenes_data,a=0;a<_.length;a++){var o=_[a].cameras;if(o[0].type===t.TYPE_ORTHO){switch(r.move_style){case t.MS_TARGET_CONTROLS:var i=Ue(Fa(r.world_tsr),r.pivot)/r.init_dist*r.init_fov;break;case t.MS_HOVER_CONTROLS:i=Ue(Fa(r.world_tsr),r.hover_pivot)/r.init_dist*r.init_fov;break;default:i=o[0].fov}for(var s=0;s<o.length;s++){var E=o[s];E.fov=i,Ve(E,!0)}ne(e,_[a])}}}function Oe(e){var r=e.render,_=r.move_style;if(_===t.MS_TARGET_CONTROLS||_===t.MS_EYE_CONTROLS){if(r.horizontal_limits){var n=r.horizontal_limits.left,a=r.horizontal_limits.right,o=Q(e,A);if(_==t.MS_TARGET_CONTROLS)var i=na(o[0],n,a);else i=na(o[0],a,n);i&&(_==t.MS_TARGET_CONTROLS?Ye(e,i,0):Me(e,i,0))}if(r.vertical_limits){var s=r.vertical_limits.down,E=r.vertical_limits.up;o=Q(e,A),(i=_==t.MS_TARGET_CONTROLS?na(o[1],E,s):na(o[1],s,E))&&(_==t.MS_TARGET_CONTROLS?Ye(e,0,i):Me(e,0,i))}_===t.MS_TARGET_CONTROLS&&r.distance_limits&&function(e){var t=e.render,r=Fa(t.world_tsr),_=be(r,t.pivot,m),n=De(_);if(n>t.distance_limits.max)ye(_,t.distance_limits.max/n,_),Ie(t.pivot,_,r);else if(n<t.distance_limits.min){var a=sn(Ba(t.world_tsr),O_,O);ye(a,100*t.distance_limits.min,a),Ie(_,a,_),ye(_,-t.distance_limits.min/De(_),_),Ie(t.pivot,_,r)}}(e)}_===t.MS_TARGET_CONTROLS&&r.pivot_limits&&function(e){var t=e.render,r=t.pivot[2],_=Un(t.pivot[2],t.pivot_limits.min_z,t.pivot_limits.max_z);if(_!=r){var n=Re(0,0,_-r,m);Ie(t.pivot,n,t.pivot);var a=Fa(t.world_tsr);Ie(a,n,a)}}(e),_===t.MS_HOVER_CONTROLS&&(function(e){var t=e.render;if(t.hover_horiz_trans_limits){var r=Un(t.hover_pivot[0],t.hover_horiz_trans_limits.min,t.hover_horiz_trans_limits.max)-t.hover_pivot[0];t.hover_pivot[0]+=r,Fa(t.world_tsr)[0]+=r}if(t.hover_vert_trans_limits){var _=Un(t.hover_pivot[1],t.hover_vert_trans_limits.min,t.hover_vert_trans_limits.max)-t.hover_pivot[1];t.hover_pivot[1]+=_,Fa(t.world_tsr)[1]+=_}}(e),function(e){var t=e.render,r=na(Q(e,A)[1],t.vertical_limits.up,t.vertical_limits.down);r&&ke(e,0,r)}(e))}function ge(e,t,r,_){var n=Q(e,p);return _[0]=t-n[0],_[1]=r-n[1],_}function Ye(e,t,r){Qe(e,e.render.pivot,t,r)}function Le(e,t,r){var _=ge(e,t,r,S);Ye(e,_[0],_[1])}function Me(e,t,r){Ce(e,t,r)}function xe(e,t,r){Fe(e,t,r)}function Ce(e,t,r){var _=e.render;if(t||r){var n=Cr(R);t&&Fr(n,Dr(_.vertical_axis,t,I),n);var a=Ba(_.world_tsr);if(r){var o=Dr(sn(a,P_,m),r,I);mr(o,o),Fr(n,o,n)}Fr(n,a,a),mr(a,a)}}function Fe(e,t,r){var _=e.render,n=j(Xa(_.world_tsr,R),_.vertical_axis,A);Ce(e,t-n[0],r-n[1])}function ke(e,t,r){var _=e.render;_.enable_hover_hor_rotation||(t=0),Qe(e,_.hover_pivot,t,r),r&&ze(e)}function He(e,t,r){var _=ge(e,t,r,S);ke(e,_[0],_[1])}function Qe(e,t,r,_){var n=e.render;if(r||_){var a=Cr(R);r&&Dr(e.render.vertical_axis,r,R);var o=Ba(n.world_tsr);if(_){var i=Dr(sn(o,P_,m),_,I);mr(i,i),Fr(a,i,a)}var s=Fa(n.world_tsr);!function(e,t,r,_){_||(_=new Float32Array(3));var n=Jr;be(t,e,n),We(n,r,n),be(t,n,_)}(s,t,a,s),Fr(a,o,o),mr(o,o)}}function ze(e){var t=e.render,r=function(e,t){var r=e.render,_=r.vertical_limits,n=r.distance_limits;if(_.down-_.up){var a=(_.down-t)/(_.down-_.up);a=Math.max(a,0)}else a=0;return a*(n.max-n.min)+n.min}(e,Q(e,A)[1]),_=Fa(t.world_tsr),n=sn(Ba(t.world_tsr),O_,m);Ke(n,n),ye(n,r,n),be(t.hover_pivot,n,_)}function Ve(e,_){switch(e.type){case t.TYPE_PERSP:case t.TYPE_PERSP_ASPECT:de(q(e),e.aspect,e.near,e.far,e.proj_matrix);break;case t.TYPE_ORTHO:case t.TYPE_ORTHO_ASPECT:var n=q(e),a=n*e.aspect;Pe(-a,a,-n,n,e.near,e.far,e.proj_matrix);break;case t.TYPE_ORTHO_ASYMMETRIC:Pe(e.left,e.right,e.bottom,e.top,e.near,e.far,e.proj_matrix);break;case t.TYPE_STEREO_LEFT:case t.TYPE_STEREO_RIGHT:!function(e){var r=Math.tan(q(e)/2),_=e.near*r,n=e.aspect*e.stereo_conv_dist*r;if(e.type==t.TYPE_STEREO_LEFT)var a=n-e.stereo_eye_dist/2,o=n+e.stereo_eye_dist/2;else a=n+e.stereo_eye_dist/2,o=n-e.stereo_eye_dist/2;var i=-e.near/e.stereo_conv_dist*a,s=e.near/e.stereo_conv_dist*o;ue(i,s,-_,_,e.near,e.far,e.proj_matrix),e.left=i,e.right=s}(e);break;case t.TYPE_HMD_LEFT:case t.TYPE_HMD_RIGHT:!function(e){if(o.check_active()){var t=o.get_active(),r=o.get_subs(t,i.STEREO);if(r&&r.enable_hmd_stereo){var _=Math.tan(e.hmd_fov[0]),n=Math.tan(e.hmd_fov[1]),a=Math.tan(e.hmd_fov[2]),s=Math.tan(e.hmd_fov[3]);e.top=e.near*_,e.right=e.near*n,e.bottom=-e.near*a,e.left=-e.near*s,ue(e.left,e.right,e.bottom,e.top,e.near,e.far,e.proj_matrix)}else e.top=e.near*Math.tan(q(e)/2),e.bottom=-e.top,e.right=e.top*e.aspect,e.left=-e.right,de(q(e),e.aspect,e.near,e.far,e.proj_matrix)}}(e);break;case t.TYPE_NONE:return;default:r.panic("Wrong camera type: "+e.type)}qe(e),_||Je(e)}function qe(e){J(e.proj_matrix,e.view_transform_params.trans,e.proj_matrix),re(e.proj_matrix,e.view_transform_params.angle,e.proj_matrix)}function Je(e){Ze(e),$e(e),fn(e.view_proj_matrix,e.frustum_planes)}function Ze(e){H(e.view_matrix,e.view_proj_matrix),W(e.proj_matrix,e.view_proj_matrix,e.view_proj_matrix),V(e.view_proj_matrix,e.view_proj_inv_matrix)}function $e(e){H(e.view_matrix,e.sky_vp_inv_matrix),e.sky_vp_inv_matrix[12]=0,e.sky_vp_inv_matrix[13]=0,e.sky_vp_inv_matrix[14]=0,e.sky_vp_inv_matrix[15]=1,W(e.proj_matrix,e.sky_vp_inv_matrix,e.sky_vp_inv_matrix),V(e.sky_vp_inv_matrix,e.sky_vp_inv_matrix)}function et(e,_,n,a,o){var i,s,E,c,l,T,u,d;switch(a||(a=new Float32Array(24)),_||(_=e.near),n||(n=e.far),e.type){case t.TYPE_NONE:r.panic("Extraction from NONE camera is not possible");break;case t.TYPE_PERSP:case t.TYPE_PERSP_ASPECT:c=-(i=_*Math.tan(q(e)/2)),E=-(s=i*e.aspect),d=-(l=i*(n/_)),u=-(T=l*e.aspect);break;case t.TYPE_ORTHO:case t.TYPE_ORTHO_ASPECT:var f=q(e),P=f*e.aspect;i=l=f,s=T=P,c=d=-f,E=u=-P;break;case t.TYPE_ORTHO_ASYMMETRIC:i=l=e.top,s=T=e.right,c=d=e.bottom,E=u=e.left;break;case t.TYPE_STEREO_LEFT:case t.TYPE_STEREO_RIGHT:var A=_/e.near;c=-(i=_*Math.tan(q(e)/2)),d=-(l=i*(S=n/_)),T=(s=e.right*A)*S,u=(E=e.left*A)*S;break;case t.TYPE_HMD_LEFT:case t.TYPE_HMD_RIGHT:var S;l=(i=e.top*(A=_/e.near))*(S=n/_),d=(c=e.bottom*A)*S,T=(s=e.right*A)*S,u=(E=e.left*A)*S;break;default:r.panic("Wrong camera type: "+e.type)}if(a[0]=E,a[1]=c,a[2]=-_,a[3]=s,a[4]=c,a[5]=-_,a[6]=s,a[7]=i,a[8]=-_,a[9]=E,a[10]=i,a[11]=-_,a[12]=u,a[13]=d,a[14]=-n,a[15]=u,a[16]=l,a[17]=-n,a[18]=T,a[19]=l,a[20]=-n,a[21]=T,a[22]=d,a[23]=-n,o){var p=L;V(e.view_matrix,p),An(a,p,a,0)}return a}function tt(e,t){t.enable_csm?function(e,t){var r=t.csm_num;e.csm_centers||function(e,t){var r=t.csm_num;e.csm_centers=new Array(r);for(var _=0;_<r;_++)e.csm_centers[_]=new Float32Array(3);e.csm_radii=new Float32Array(r)}(e,t);for(var _=0;_<r;_++){var n=Qo(et(e,0==_?e.near:rt(t,e,_-1),rt(t,e,_),M));e.csm_centers[_].set(n.center),e.csm_radii[_]=n.radius,e.csm_center_dists[_]=De(n.center),e.pcf_blur_radii[_]=_t(t.first_cascade_blur_radius,t.last_cascade_blur_radius,r,_)}}(e,t):e.pcf_blur_radii[0]=t.first_cascade_blur_radius}function rt(e,t,r){var _=e.csm_num;return Un(_t(Un(e.csm_first_cascade_border,t.near,t.far),Un(e.csm_last_cascade_border,t.near,t.far),_,r),t.near,t.far)}function _t(e,t,r,_){switch(_){case 0:var n=e;break;case r-1:n=t;break;default:n=0==e?0:e*Math.pow(t/e,_/(r-1))}return n}function nt(e){switch(e.type){case t.TYPE_ORTHO:case t.TYPE_ORTHO_ASPECT:case t.TYPE_ORTHO_ASYMMETRIC:return!0;default:return!1}}function at(e,t){return t||(t=new Float32Array(3)),he(Fa(e.render.world_tsr),t),t}t.camera_object_to_camera=function(e,r){var _=r.render,n=e.data;switch(n.type){case"PERSP":(o=B(t.TYPE_PERSP)).fit=n.sensor_fit,Z(o,n.angle,n.clip_start,n.clip_end);break;case"ORTHO":var o;(o=B(t.TYPE_ORTHO)).fit=n.sensor_fit,Z(o,n.ortho_scale/2,n.clip_start,n.clip_end)}o.name=r.name;var i=r.scenes_data;i[0].cameras.push(o);for(var s=1;s<i.length;s++){var E=G(o,!1);i[s].cameras.push(E)}_.move_style=K(n.b4w_move_style),_.dof_distance=n.dof_distance;var c=n.dof_object;_.dof_object=c?c._object:null,_.dof_front_start=n.b4w_dof_front_start,_.dof_front_end=n.b4w_dof_front_end,_.dof_rear_start=n.b4w_dof_rear_start,_.dof_rear_end=n.b4w_dof_rear_end,_.dof_power=n.b4w_dof_power,_.dof_bokeh=n.b4w_dof_bokeh,_.dof_bokeh_intensity=n.b4w_dof_bokeh_intensity,_.dof_foreground_blur=n.b4w_dof_foreground_blur,_.velocity_trans=n.b4w_trans_velocity,_.velocity_rot=n.b4w_rot_velocity,_.velocity_zoom=n.b4w_zoom_velocity;var l=function(e,r){var _=r.render.move_style,n=e.data,a=null;return _!=t.MS_TARGET_CONTROLS&&_!=t.MS_EYE_CONTROLS||!n.b4w_use_horizontal_clamping||(a={left:n.b4w_rotation_left_limit,right:n.b4w_rotation_right_limit,camera_space:"LOCAL"==n.b4w_horizontal_clamping_type},_==t.MS_EYE_CONTROLS&&(a.left*=-1,a.right*=-1)),a}(e,r),T=function(e,r){var _=r.render.move_style,n=e.data,o=null;return _!=t.MS_TARGET_CONTROLS&&_!=t.MS_EYE_CONTROLS||!n.b4w_use_vertical_clamping?_==t.MS_HOVER_CONTROLS&&n.b4w_use_zooming&&(n.b4w_hover_angle_min<=n.b4w_hover_angle_max?((o={down:n.b4w_hover_angle_min,up:n.b4w_hover_angle_max}).down*=-1,o.up*=-1):a.error("Wrong angle limits for the HOVER camera. Disabling angle limits.")):(o={down:n.b4w_rotation_down_limit,up:n.b4w_rotation_up_limit,camera_space:"LOCAL"==n.b4w_vertical_clamping_type},_==t.MS_TARGET_CONTROLS&&(o.down*=-1,o.up*=-1)),o}(e,r),u=function(e,r){var _=r.render.move_style,n=e.data,o=null;return _==t.MS_TARGET_CONTROLS&&n.b4w_use_target_distance_limits&&n.b4w_distance_min<=n.b4w_distance_max?o={min:n.b4w_distance_min,max:n.b4w_distance_max}:_===t.MS_HOVER_CONTROLS&&n.b4w_use_zooming&&(n.b4w_distance_min<=n.b4w_distance_max?o={min:n.b4w_distance_min,max:n.b4w_distance_max}:a.error("Wrong distance limits for the HOVER camera. Disabling distance limits.")),o}(e,r),d=function(e,r){var _=e.data,n=null;return r.render.move_style==t.MS_HOVER_CONTROLS&&_.b4w_use_horizontal_clamping&&_.b4w_horizontal_translation_min<=_.b4w_horizontal_translation_max&&(n={min:_.b4w_horizontal_translation_min,max:_.b4w_horizontal_translation_max}),n}(e,r),f=function(e,r){var _=e.data,n=null;return r.render.move_style==t.MS_HOVER_CONTROLS&&_.b4w_use_vertical_clamping&&_.b4w_vertical_translation_min<=_.b4w_vertical_translation_max&&(n={min:_.b4w_vertical_translation_min,max:_.b4w_vertical_translation_max}),n}(e,r),P=function(e,r){var _=e.data,n=null;return r.render.move_style==t.MS_TARGET_CONTROLS&&_.b4w_use_pivot_limits&&(n={min_z:_.b4w_pivot_z_min,max_z:_.b4w_pivot_z_max}),n}(e,r);switch(_.move_style){case t.MS_STATIC:break;case t.MS_EYE_CONTROLS:y(r,Fa(r.render.world_tsr),null,l,T);break;case t.MS_TARGET_CONTROLS:w(r,Fa(r.render.world_tsr),n.b4w_target,l,T,u,P,n.b4w_use_panning);break;case t.MS_HOVER_CONTROLS:U(r,Fa(r.render.world_tsr),C(r,e.data.b4w_hover_zero_level,O),u,T,d,f,n.b4w_enable_hover_hor_rotation)}Oe(r),D(r)},t.setup_eye_model=y,t.setup_target_model=w,t.setup_hover_model=U,t.init_ortho_props=D,t.clone_camera=G,t.create_frustum_planes=k,t.move_style_bpy_to_b4w=K,t.create_camera=B,t.check_attachment=function(e,t){switch(t){case"COLOR":case"CUBEMAP":return Boolean(e.color_attachment);case"DEPTH":return Boolean(e.depth_attachment);case"SCREEN":return!Boolean(e.color_attachment)&&!Boolean(e.depth_attachment);default:r.panic("Wrong attachment type: "+t)}},t.set_attachment=function(e,t,_){switch(t){case"COLOR":case"CUBEMAP":e.color_attachment=_;break;case"DEPTH":e.depth_attachment=_;break;case"SCREEN":e.color_attachment=null,e.depth_attachment=null;break;default:r.panic("Wrong attachment type: "+t)}},t.get_attachment=function(e,t){switch(t){case"COLOR":case"CUBEMAP":return e.color_attachment;case"DEPTH":return e.depth_attachment;case"SCREEN":return null;default:r.panic("Wrong attachment type: "+t)}},t.make_stereo=function(e,_){(e.type!=t.TYPE_PERSP||_!=t.TYPE_STEREO_LEFT&&_!=t.TYPE_STEREO_RIGHT&&_!=t.TYPE_HMD_LEFT&&_!=t.TYPE_HMD_RIGHT)&&r.panic("make_stereo(): wrong camera type"),e.type=_,X(e,6,.065)},t.set_stereo_params=X,t.get_camera_angles=Q,t.get_camera_angles_from_quat=j,t.get_camera_angles_char=function(e,t){return Q(e,t),t[0]=Jn(t[0]+Math.PI),t[1]*=-1,t},t.set_fov=function(e,r){switch(e.type){case t.TYPE_PERSP:case t.TYPE_PERSP_ASPECT:case t.TYPE_STEREO_LEFT:case t.TYPE_STEREO_RIGHT:e.fov=r}},t.get_fov=function(e){switch(e.type){case t.TYPE_PERSP:case t.TYPE_PERSP_ASPECT:case t.TYPE_STEREO_LEFT:case t.TYPE_STEREO_RIGHT:return e.fov;default:return 0}},t.get_vfov=q,t.set_frustum=Z,t.set_frustum2=function(e,_,n,a,o){switch(e.type){case t.TYPE_PERSP:case t.TYPE_STEREO_LEFT:case t.TYPE_STEREO_RIGHT:case t.TYPE_ORTHO:e.fov=n,e.aspect=1;break;case t.TYPE_PERSP_ASPECT:case t.TYPE_ORTHO_ASPECT:e.fov=n,e.aspect=_/n;break;case t.TYPE_HMD_LEFT:case t.TYPE_HMD_RIGHT:break;default:r.panic("set_frustum2(): Unsupported camera type: "+e.type)}e.near=a,e.far=o},t.set_frustum_asymmetric=function(e,_,n,a,o,i,s){switch(e.type){case t.TYPE_ORTHO_ASYMMETRIC:e.left=_,e.right=n,e.bottom=a,e.top=o,e.near=i,e.far=s;break;default:r.panic("set_frustum_asymmetric(): Unsupported camera type: "+e.type)}},t.get_move_style=function(e){return e.render.move_style},t.set_view=$,t.set_projection_reflect=ee,t.set_view_trans_quat=function(e,r,_){var n=m;n[0]=0,n[1]=0,n[2]=-1,We(n,_,n),n[0]+=r[0],n[1]+=r[1],n[2]+=r[2];var a=O;a[0]=0,a[1]=1,a[2]=0,We(a,_,a),function(e,r,_,n){Ae(r,_,n,e.view_matrix);var a=o.get_active(),s=o.get_subs(a,i.STEREO);e.type==t.TYPE_STEREO_LEFT||s&&s.enable_hmd_stereo&&e.type==t.TYPE_HMD_LEFT?e.view_matrix[12]+=e.stereo_eye_dist/2:(e.type==t.TYPE_STEREO_RIGHT||s&&s.enable_hmd_stereo&&e.type==t.TYPE_HMD_RIGHT)&&(e.view_matrix[12]-=e.stereo_eye_dist/2),za(e.view_matrix,e.view_tsr),Ze(e),$e(e),wa(r,e.world_tsr)}(e,r,n,a)},t.set_look_at=te,t.set_look_at_corrected=_e,t.update_camera_transform=ne,t.update_camera=function(e){var r=e.render;switch(Oe(e),me(e),r.move_style){case t.MS_TARGET_CONTROLS:var _=Fa(r.world_tsr);Sa(_,Ba(r.world_tsr),r.pivot,O_);for(var n=0;n<e.scenes_data.length;n++)for(var a=e.scenes_data[n].cameras,o=0;o<a.length;o++){var i=a[o];i.type!=t.TYPE_STEREO_LEFT&&i.type!=t.TYPE_STEREO_RIGHT||X(i,Ue(_,r.pivot),i.stereo_eye_dist)}ae(e,r.vertical_axis);break;case t.MS_EYE_CONTROLS:e.constraint||ae(e,r.vertical_axis)}},t.correct_up=ae,t.set_horizontal_rot_limits=oe,t.set_vertical_rot_limits=ie,t.hover_set_vertical_limits=se,t.hover_set_distance_limits=le,t.set_distance_limits=Te,t.set_pivot_limits=fe,t.set_hor_trans_limits=Se,t.set_vert_trans_limits=pe,t.update_ortho_scale=me,t.rotate_target_angles=Ye,t.set_rotation_target_angles=Le,t.rotate_eye_angles=Me,t.set_rotation_eye_angles=xe,t.rotate_static_angles=Ce,t.set_rotation_static_angles=Fe,t.rotate_hover_angles=ke,t.set_rotation_hover_angles=He,t.rotate_angles=function(e,r,_){var n=e.render.move_style;n===t.MS_TARGET_CONTROLS?Ye(e,r,_):n===t.MS_EYE_CONTROLS?Me(e,r,_):n===t.MS_HOVER_CONTROLS?ke(e,r,_):n===t.MS_STATIC&&Ce(e,r,_)},t.set_rotation_angles=function(e,r,_){var n=e.render.move_style;n===t.MS_TARGET_CONTROLS?Le(e,r,_):n===t.MS_EYE_CONTROLS?xe(e,r,_):n===t.MS_HOVER_CONTROLS?He(e,r,_):n===t.MS_STATIC&&Fe(e,r,_)},t.is_float_aspect=function(e){switch(e.type){case t.TYPE_PERSP:case t.TYPE_ORTHO:case t.TYPE_STEREO_LEFT:case t.TYPE_STEREO_RIGHT:return!0;default:return!1}},t.get_angular_diameter=function(e){switch(e.type){case t.TYPE_PERSP:case t.TYPE_PERSP_ASPECT:case t.TYPE_STEREO_LEFT:case t.TYPE_STEREO_RIGHT:var r=q(e),_=function(e){switch(e.fit){case"AUTO":return e.aspect>1?e.fov:nt(e)?e.fov*e.aspect:2*Math.atan(Math.tan(e.fov/2)*e.aspect);case"HORIZONTAL":return e.fov;case"VERTICAL":return nt(e)?e.fov*e.aspect:2*Math.atan(Math.tan(e.fov/2)*e.aspect)}}(e);return Math.min(r,_);default:return a.error("get_angular_diameter(): Unsupported camera type: "+e.type),0}},t.set_aspect=function(e,r){switch(e.type){case t.TYPE_PERSP_ASPECT:case t.TYPE_ORTHO_ASPECT:a.error("set_aspect(): Unsupported camera type: "+e.type);break;default:e.aspect=r}},t.get_aspect=function(e){return e.aspect},t.set_projection=Ve,t.set_color_pick_proj=function(e,r,_,n,a){var o=1/Math.max(a,n);switch(e.type){case t.TYPE_NONE:case t.TYPE_PERSP:case t.TYPE_PERSP_ASPECT:var i=a/2,s=n/2;_=-(_-i)/i*Math.tan(q(e)/2),r=(r-s)/s*Math.tan(q(e)/2)*e.aspect,ue(e.near*(r-o),c=e.near*(r+o),e.near*(_-o),E=e.near*(_+o),e.near,e.far,e.proj_matrix);break;case t.TYPE_ORTHO:case t.TYPE_ORTHO_ASPECT:_=-_/a,Pe(((r/=n)-o)*((c=(E=q(e))*e.aspect)+c)-c,c=(r+o)*(c+c)-c,E+(_-o)*(E+E),E+=(_+o)*(E+E),e.near,e.far,e.proj_matrix);break;case t.TYPE_ORTHO_ASYMMETRIC:var E,c;Pe(e.left+((r/=n)-o)*(e.right-e.left),c=e.left+(r+o)*(e.right-e.left),e.top+((_=-_/a)-o)*(e.top-e.bottom),E=e.top+(_+o)*(e.top-e.bottom),e.near,e.far,e.proj_matrix)}qe(e),Je(e)},t.calc_sky_vp_inverse=$e,t.extract_frustum_corners=et,t.assign_boundings=function(e){var t=e.render,r={max_x:0,min_x:0,max_y:0,min_y:0,max_z:0,min_z:0};r.min_x=-1,r.max_x=1,r.min_y=-1,r.max_y=1,r.min_z=-1,r.max_z=1,t.bb_local=r;var _=bo(1,j_([0,0,0]));t.bs_local=_,t.bcap_local=ko(1,r),t.bcyl_local=Ko(1,r),t.bcon_local=Bo(1,r)},t.is_static_camera=function(e){return n.is_camera(e)&&e.render&&e.render.move_style==t.MS_STATIC},t.is_target_camera=function(e){return n.is_camera(e)&&e.render&&e.render.move_style==t.MS_TARGET_CONTROLS},t.is_eye_camera=function(e){return n.is_camera(e)&&e.render&&e.render.move_style==t.MS_EYE_CONTROLS},t.is_hover_camera=function(e){return n.is_camera(e)&&e.render&&e.render.move_style==t.MS_HOVER_CONTROLS},t.is_ortho_camera=function(e){return n.is_camera(e)&&e.render&&e.scenes_data[0].cameras[0].type==t.TYPE_ORTHO},t.update_camera_shadows=tt,t.csm_far_plane=rt,t.project_point=function(e,r,n){var o=e.scenes_data[0].cameras[0];switch(o.type){case t.TYPE_PERSP:case t.TYPE_PERSP_ASPECT:case t.TYPE_ORTHO:case t.TYPE_ORTHO_ASPECT:case t.TYPE_STEREO_LEFT:case t.TYPE_STEREO_RIGHT:case t.TYPE_HMD_LEFT:case t.TYPE_HMD_RIGHT:case t.TYPE_NONE:var i=b;i.set(r),i[3]=1,gr(i,o.view_proj_matrix,i);var s=-i[1]/i[3];return n[0]=(i[0]/i[3]+1)/2*o.width,n[1]=(s+1)/2*o.height,_.viewport_to_canvas_coords(n[0],n[1],n,o),n.length>2&&(n[2]=(i[2]/Math.abs(i[3])+1)/2),n;default:return a.error("Non-compatible camera"),n}},t.get_first_cam=function(e){return e.scenes_data[0].cameras[0]},t.get_edge=function(e,_){switch(e.type){case t.TYPE_PERSP:case t.TYPE_PERSP_ASPECT:case t.TYPE_STEREO_LEFT:case t.TYPE_STEREO_RIGHT:var n=Math.tan(q(e)/2);switch(_){case"LEFT":return-n*e.aspect;case"RIGHT":return n*e.aspect;case"TOP":return n;case"BOTTOM":return-n}break;case t.TYPE_ORTHO:case t.TYPE_ORTHO_ASPECT:switch(_){case"LEFT":return-q(e)*e.aspect;case"RIGHT":return q(e)*e.aspect;case"TOP":return q(e);case"BOTTOM":return-q(e)}break;case t.TYPE_ORTHO_ASYMMETRIC:switch(_){case"LEFT":return e.left;case"RIGHT":return e.right;case"TOP":return e.top;case"BOTTOM":return e.bottom}break;case t.TYPE_HMD_LEFT:case t.TYPE_HMD_RIGHT:var a=o.get_active(),s=o.get_subs(a,i.STEREO);if(s&&s.enable_hmd_stereo)switch(_){case"LEFT":return-Math.tan(Math.min(e.hmd_fov[1],e.hmd_fov[3]));case"RIGHT":return Math.tan(Math.min(e.hmd_fov[1],e.hmd_fov[3]));case"TOP":return Math.tan(Math.min(e.hmd_fov[0],e.hmd_fov[2]));case"BOTTOM":return-Math.tan(Math.min(e.hmd_fov[0],e.hmd_fov[2]))}else switch(n=Math.tan(q(e)/2),_){case"LEFT":return-n*e.aspect;case"RIGHT":return n*e.aspect;case"TOP":return n;case"BOTTOM":return-n}break;default:r.panic("Unknown camera type")}},t.is_ortho=nt,t.set_trans_pivot=function(e,t,r){var _=e.render;wa(t,_.world_tsr),he(r,_.pivot)},t.set_hover_pivot=function(e,t){var r=e.render,_=be(t,r.hover_pivot,m),n=Ie(_,Fa(r.world_tsr),_);s.set_translation(e,n),he(t,r.hover_pivot)},t.set_target_pivot=function(e,t){var r=e.render,_=be(t,r.pivot,m),n=Ie(_,Fa(r.world_tsr),_);s.set_translation(e,n),he(t,r.pivot)},t.get_eye=at,t.set_move_style=function(e,r){switch(e.render.move_style=r,e.render.horizontal_limits=null,e.render.vertical_limits=null,e.render.distance_limits=null,e.render.hover_horiz_trans_limits=null,e.render.hover_vert_trans_limits=null,D(e),r){case t.MS_STATIC:case t.MS_EYE_CONTROLS:break;case t.MS_HOVER_CONTROLS:U(e,Fa(e.render.world_tsr),C(e,0,O),null,null,null,null,e.render.enable_hover_hor_rotation);break;case t.MS_TARGET_CONTROLS:var _=at(e,m),n=sn(Ba(e.render.world_tsr),O_,O);he(we(_,n,10,n),e.render.pivot)}},t.wipe_move_style=function(e){var t=e.render;t.move_style=0,Re(0,0,0,t.pivot),Re(0,0,0,t.hover_pivot),t.use_panning=!1,t.horizontal_limits=null,t.vertical_limits=null,t.distance_limits=null,t.hover_horiz_trans_limits=null,t.hover_vert_trans_limits=null,t.pivot_limits=null,t.enable_hover_hor_rotation=!0},t.set_eye_distance=function(e,t){for(var r=0;r<e.length;r++){var _=e[r];70!=_.type&&80!=_.type&&90!=_.type&&100!=_.type||X(_,_.stereo_conv_dist,t)}},t.set_hmd_fov=function(e,t,r){for(var _=o.get_active(),a=n.get_scene_data(e,_).cameras,i=0;i<a.length;i++){var s=a[i];90!=s.type&&100!=s.type||(90==s.type&&nr(t,s.hmd_fov),100==s.type&&nr(r,s.hmd_fov),s.reflection_plane?ee(s,!1):Ve(s,!1))}},t.set_hmd_proj_mat=function(e,t,r){for(var _=o.get_active(),a=n.get_scene_data(e,_).cameras,i=0;i<a.length;i++){var s=a[i];90!=s.type&&100!=s.type||(90==s.type&&t&&H(t,s.proj_matrix),100==s.type&&r&&H(r,s.proj_matrix),qe(s),Je(s))}},t.set_proj_mat=function(e,r){for(var _,a,i,s,E,c,l,T,u=o.get_active(),A=n.get_scene_data(e,u).cameras,S=0;S<A.length;S++)if((N=A[S]).type==t.TYPE_NONE&&N.near||N.type==t.TYPE_PERSP||N.type==t.TYPE_PERSP_ASPECT){_=N.near,a=N.far;var p=V(r,L),m=gr(d,p,b);i=m[0]*_,s=m[1]*_;var O=gr(f,p,b);E=O[0]*_,c=O[1]*_;var v=gr(P,p,b);l=ue(E,i,c,s,_,a=-v[2]*v[3],L),T=(i-E)/(s-c);break}for(S=0;S<A.length;S++){var N;(N=A[S]).type!=t.TYPE_NONE&&N.type!=t.TYPE_PERSP&&N.type!=t.TYPE_PERSP_ASPECT||(N.far=a,N.near=_,N.right=i,N.top=s,N.left=E,N.bottom=c,N.aspect=T,N.fov=Math.atan(s/_)-Math.atan(c/_),H(l,N.proj_matrix),qe(N),Je(N))}}}),iE=A("camera",function(e,t){var r=oE(e),_=aE(e),n=os(e),a=Ns(e),o=ga(e),i=ps(e),s=Os(e),E=new Float32Array(2),c=new Float32Array(3),l=new Float32Array(3),T=(new Float32Array(4),Yr()),u={},d={};function f(e,t){return n.is_camera(e)?(t=t||new Float32Array(3),sn(Ba(e.render.world_tsr),O_,t),t):(o.error("get_view_vector(): Wrong camera object"),null)}t.MS_STATIC=r.MS_STATIC,t.MS_TARGET_CONTROLS=r.MS_TARGET_CONTROLS,t.MS_EYE_CONTROLS=r.MS_EYE_CONTROLS,t.MS_HOVER_CONTROLS=r.MS_HOVER_CONTROLS,t.static_setup=function(e,t){if(n.is_camera(e)){if(r.wipe_move_style(e),e.render.move_style=r.MS_STATIC,t){var _=t.pos||Fa(e.render.world_tsr);t.look_at?r.set_look_at(e,_,t.look_at):s.set_translation(e,_)}s.update_transform(e),a.sync_transform(e),r.init_ortho_props(e)}else o.error("static_setup(): Wrong camera object")},t.static_set_look_at=function(e,t,_){r.is_static_camera(e)?(t=t||Fa(e.render.world_tsr),_?r.set_look_at(e,t,_):s.set_translation(e,t),s.update_transform(e),a.sync_transform(e)):o.error("static_set_look_at(): Wrong camera object or camera move style")},t.static_set_rotation=function(e,t){r.is_static_camera(e)?(s.set_rotation(e,t),s.update_transform(e),a.sync_transform(e)):o.error("static_set_rotation(): Wrong camera object or camera move style")},t.static_get_rotation=function(e,t){return r.is_static_camera(e)?(t=t||new Float32Array(4),s.get_rotation(e,t)):(o.error("static_get_rotation(): Wrong camera object or camera move style"),null)},t.eye_setup=function(e,t){if(n.is_camera(e))if(!t||!t.horiz_rot_lim||"number"==typeof t.horiz_rot_lim.left&&"number"==typeof t.horiz_rot_lim.right)if(!t||!t.vert_rot_lim||"number"==typeof t.vert_rot_lim.down&&"number"==typeof t.vert_rot_lim.up){if(r.wipe_move_style(e),e.render.move_style=r.MS_EYE_CONTROLS,t){var _=t.pos||Fa(e.render.world_tsr);r.setup_eye_model(e,_,t.look_at,t.horiz_rot_lim,t.vert_rot_lim)}s.update_transform(e),a.sync_transform(e),r.init_ortho_props(e)}else o.error("eye_setup(): Wrong vertical limits object.");else o.error("eye_setup(): Wrong horizontal limits object.");else o.error("eye_setup(): Wrong camera object")},t.eye_set_look_at=function(e,t,_){r.is_eye_camera(e)?(t=t||Fa(e.render.world_tsr),_?r.set_look_at_corrected(e,t,_):s.set_translation(e,t),r.correct_up(e,e.render.vertical_axis,!0),s.update_transform(e),a.sync_transform(e)):o.error("eye_set_look_at(): Wrong camera object or camera move style")},t.eye_rotate=function(e,_,n,a){o.error_deprecated("eye_rotate","rotate_camera"),r.is_eye_camera(e)?t.rotate_camera(e,_,n,a=a||!1):o.error("eye_rotate(): Wrong camera object or camera move style")},t.eye_set_vertical_limits=function(e,t){r.is_eye_camera(e)?!t||"number"==typeof t.down&&"number"==typeof t.up?(r.set_vertical_rot_limits(e,t),s.update_transform(e),a.sync_transform(e)):o.error("eye_set_vertical_limits(): Incorrect limits object."):o.error("eye_set_vertical_limits(): Wrong camera object or camera move style")},t.eye_get_vertical_limits=function(e,t,_){if(!r.is_eye_camera(e))return o.error("eye_get_vertical_limits(): Wrong camera object or camera move style"),null;var n=e.render;return n.vertical_limits?(t=t||{},_?(t.down=n.vertical_limits.down_local,t.up=n.vertical_limits.up_local):(t.down=n.vertical_limits.down,t.up=n.vertical_limits.up),t.camera_space=_||!1,t):null},t.eye_set_horizontal_limits=function(e,t){r.is_eye_camera(e)?!t||"number"==typeof t.left&&"number"==typeof t.right?(r.set_horizontal_rot_limits(e,t),s.update_transform(e),a.sync_transform(e)):o.error("eye_set_horizontal_limits(): Incorrect limits object."):o.error("eye_set_horizontal_limits(): Wrong camera object or camera move style")},t.eye_get_horizontal_limits=function(e,t,_){if(!r.is_eye_camera(e))return o.error("eye_get_horizontal_limits(): Wrong camera object or camera move style"),null;var n=e.render;return n.horizontal_limits?(t=t||{},_?(t.left=n.horizontal_limits.left_local,t.right=n.horizontal_limits.right_local):(t.left=n.horizontal_limits.left,t.right=n.horizontal_limits.right),t.camera_space=_||!1,t):null},t.target_setup=function(e,t){if(n.is_camera(e))if(!t.horiz_rot_lim||"number"==typeof t.horiz_rot_lim.left&&"number"==typeof t.horiz_rot_lim.right)if(!t.vert_rot_lim||"number"==typeof t.vert_rot_lim.down&&"number"==typeof t.vert_rot_lim.up){if(t.dist_lim){if("number"!=typeof t.dist_lim.min||"number"!=typeof t.dist_lim.max||t.dist_lim.min>t.dist_lim.max)return void o.error("target_setup(): Wrong distance limits object");t.dist_lim.min=Math.max(t.dist_lim.min,0),t.dist_lim.max=Math.max(t.dist_lim.max,0)}if(t.pivot_lim&&("number"!=typeof t.pivot_lim.min_y||"number"!=typeof t.pivot_lim.max_y||t.pivot_lim.min_y>t.pivot_lim.max_y))o.error("target_setup(): Wrong pivot limits object");else{r.wipe_move_style(e),e.render.move_style=r.MS_TARGET_CONTROLS;var _=t.pos||Fa(e.render.world_tsr),i=t.pivot;if(!i){var E=f(e,c);i=Ie(_,E,E)}r.setup_target_model(e,_,i,t.horiz_rot_lim,t.vert_rot_lim,t.dist_lim,t.pivot_lim,t.use_panning||!1),s.update_transform(e),a.sync_transform(e),r.init_ortho_props(e)}}else o.error("target_setup(): Wrong vertical limits object");else o.error("target_setup(): Wrong horizontal limits object");else o.error("target_setup(): Wrong camera object")},t.target_rotate=function(e,_,n,a){o.error_deprecated("target_rotate","rotate_camera"),r.is_target_camera(e)?t.rotate_camera(e,_,n,a=a||!1):o.error("target_rotate(): Wrong camera object or camera move style")},t.target_set_trans_pivot=function(e,t,_){r.is_target_camera(e)?(t=t||Fa(e.render.world_tsr),r.set_trans_pivot(e,t,_=_||e.render.pivot),s.update_transform(e),a.sync_transform(e)):o.error("target_set_trans_pivot(): Wrong camera object or camera move style")},t.target_set_pivot_translation=function(e,t){r.is_target_camera(e)?(r.set_target_pivot(e,t),s.update_transform(e),a.sync_transform(e)):o.error("target_set_pivot_translation(): Wrong camera object or camera move style")},t.target_set_distance=function(e,t){if(r.is_target_camera(e)){var _=s.obj_point_distance(e,e.render.pivot),n=Math.max(0,t);s.move_local(e,0,0,n-_),s.update_transform(e),a.sync_transform(e)}else o.error("target_set_distance(): Wrong camera object or camera move style")},t.target_get_distance=function(e){return r.is_target_camera(e)?s.obj_point_distance(e,e.render.pivot):(o.error("target_get_distance(): Wrong camera object or camera move style"),0)},t.target_zoom_object=function(e,t){if(r.is_target_camera(e)){var _=s.get_object_center(t,!1,c),E=s.get_object_size(t),l=i.get_active(),T=n.get_scene_data(e,l),u=r.get_angular_diameter(T.cameras[0])/2,d=E/Math.sin(u),f=s.obj_point_distance(e,_);r.set_trans_pivot(e,Fa(e.render.world_tsr),_),s.update_transform(e),s.move_local(e,0,0,d-f),s.update_transform(e),a.sync_transform(e)}else o.error("target_zoom_object(): Wrong camera object or camera move style")},t.target_get_pivot=function(e,t){return r.is_target_camera(e)?(t=t||new Float32Array(3),he(e.render.pivot,t),t):(o.error("target_get_pivot(): Wrong camera object or camera move style"),null)},t.target_set_distance_limits=function(e,t){if(r.is_target_camera(e)){if(t){if("number"!=typeof t.min||"number"!=typeof t.max||t.min>t.max)return void o.error("target_set_distance_limits(): Wrong limits object");t.min=Math.max(t.min,0),t.max=Math.max(t.max,0)}r.set_distance_limits(e,t),s.update_transform(e),a.sync_transform(e)}else o.error("target_set_distance_limits(): Wrong camera object or camera move style")},t.target_get_distance_limits=function(e,t){if(!r.is_target_camera(e))return o.error("target_get_distance_limits(): Wrong camera object or camera move style"),null;var _=e.render;return _.distance_limits?((t=t||{}).min=_.distance_limits.min,t.max=_.distance_limits.max,t):null},t.target_set_vertical_limits=function(e,t){r.is_target_camera(e)?!t||"number"==typeof t.down&&"number"==typeof t.up?(r.set_vertical_rot_limits(e,t),s.update_transform(e),a.sync_transform(e)):o.error("target_set_vertical_limits(): Wrong limits object"):o.error("target_set_vertical_limits(): Wrong camera object or camera move style")},t.target_get_vertical_limits=function(e,t,_){if(!r.is_target_camera(e))return o.error("target_get_vertical_limits(): Wrong camera object or camera move style"),null;var n=e.render;return n.vertical_limits?(t=t||{},_?(t.down=n.vertical_limits.down_local,t.up=n.vertical_limits.up_local):(t.down=n.vertical_limits.down,t.up=n.vertical_limits.up),t.camera_space=_||!1,t):null},t.target_set_horizontal_limits=function(e,t){r.is_target_camera(e)?!t||"number"==typeof t.left&&"number"==typeof t.right?(r.set_horizontal_rot_limits(e,t),s.update_transform(e),a.sync_transform(e)):o.error("target_set_horizontal_limits(): Wrong limits object"):o.error("target_set_horizontal_limits(): Wrong camera object or camera move style")},t.target_get_horizontal_limits=function(e,t,_){if(!r.is_target_camera(e))return o.error("target_get_horizontal_limits(): Wrong camera object or camera move style"),null;var n=e.render;return n.horizontal_limits?(t=t||{},_?(t.left=n.horizontal_limits.left_local,t.right=n.horizontal_limits.right_local):(t.left=n.horizontal_limits.left,t.right=n.horizontal_limits.right),t.camera_space=_||!1,t):null},t.target_set_pivot_limits=function(e,t){r.is_target_camera(e)?t&&("number"!=typeof t.min_z||"number"!=typeof t.max_z||t.min_z>t.max_z)?o.error("target_set_pivot_limits(): Wrong limits object"):(r.set_pivot_limits(e,t),s.update_transform(e),a.sync_transform(e)):o.error("target_set_pivot_limits(): Wrong camera object or camera move style")},t.target_get_pivot_limits=function(e,t){if(!r.is_target_camera(e))return o.error("target_get_pivot_limits(): Wrong camera object or camera move style"),null;var _=e.render;return _.pivot_limits?((t=t||{}).min_z=_.pivot_limits.min_z,t.max_z=_.pivot_limits.max_z,t):null},t.target_pan_pivot=function(e,t,_){if(r.is_target_camera(e)){var n=e.render;if(n.use_panning){var i=c;i[0]=t,i[1]=-_,i[2]=0,Za(i,n.world_tsr,i),Ie(n.pivot,i,n.pivot);var E=Fa(n.world_tsr);Ie(E,i,E),s.update_transform(e),a.sync_transform(e)}}else o.error("target_pan_pivot(): wrong object")},t.target_switch_panning=function(e,t){if(!r.is_target_camera(e))return o.error("target_switch_panning(): Wrong camera object or camera move style"),null;e.render.use_panning=t},t.hover_setup_rel=function(e,_){if(t.hover_setup(e,{pos:_.pos,pivot:_.pivot}),"undefined"==typeof _.dist_interval)var n=0;else n=Math.max(_.dist_interval,0);if("undefined"==typeof _.angle_interval)var o=0;else o=Math.max(_.angle_interval,0);if("undefined"==typeof _.t)var i=.5;else i=Un(_.t,0,1);var E=t.hover_get_distance_limits(e,u);E.min=Math.max(E.min-i*n,0),E.max=E.max+(1-i)*n;var c=t.hover_get_vertical_limits(e,d);c.down=Un(c.down+i*o,-Math.PI/2,0),c.up=Un(c.up-(1-i)*o,-Math.PI/2,0),r.hover_set_distance_limits(e,E),r.hover_set_vertical_limits(e,c),s.update_transform(e),a.sync_transform(e),r.init_ortho_props(e)},t.hover_setup=function(e,t){if(n.is_camera(e)){if(t.dist_lim){if("number"!=typeof t.dist_lim.min||"number"!=typeof t.dist_lim.max||t.dist_lim.min>t.dist_lim.max)return void o.error("hover_setup(): Wrong distance limits object");t.dist_lim.min=Math.max(t.dist_lim.min,0),t.dist_lim.max=Math.max(t.dist_lim.max,0)}if(t.hover_angle_lim&&("number"!=typeof t.hover_angle_lim.down||"number"!=typeof t.hover_angle_lim.up||t.hover_angle_lim.down<t.hover_angle_lim.up))o.error("hover_setup(): Wrong hover angle limits object");else if(t.horiz_trans_lim&&("number"!=typeof t.horiz_trans_lim.min||"number"!=typeof t.horiz_trans_lim.max||t.horiz_trans_lim.min>t.horiz_trans_lim.max))o.error("hover_setup(): Wrong horizontal translation limits object");else if(t.vert_trans_lim&&("number"!=typeof t.vert_trans_lim.min||"number"!=typeof t.vert_trans_lim.max||t.vert_trans_lim.min>t.vert_trans_lim.max))o.error("hover_setup(): Wrong vertical translation limits object");else{r.wipe_move_style(e),e.render.move_style=r.MS_HOVER_CONTROLS;var _=t.pos||Fa(e.render.world_tsr);r.setup_hover_model(e,_,t.pivot,t.dist_lim,t.hover_angle_lim,t.horiz_trans_lim,t.vert_trans_lim,t.enable_horiz_rot||!1),s.update_transform(e),a.sync_transform(e),r.init_ortho_props(e)}}else o.error("hover_setup(): Wrong camera object")},t.hover_rotate=function(e,_,n,a){o.error_deprecated("hover_rotate","rotate_camera"),r.is_hover_camera(e)?t.rotate_camera(e,_,n,a=a||!1):o.error("hover_rotate(): Wrong camera object or camera move style")},t.hover_set_pivot_translation=function(e,t){r.is_hover_camera(e)?(r.set_hover_pivot(e,t),s.update_transform(e),a.sync_transform(e)):o.error("hover_set_pivot_translation(): Wrong camera object or camera move style")},t.hover_get_pivot=function(e,t){return r.is_hover_camera(e)?(t=t||new Float32Array(3),he(e.render.hover_pivot,t),t):(o.error("hover_get_pivot(): Wrong camera object or camera move style"),null)},t.hover_get_distance=function(e){return r.is_hover_camera(e)?s.obj_point_distance(e,e.render.hover_pivot):(o.error("hover_get_distance(): Wrong camera object or camera move style"),0)},t.hover_set_vertical_limits=function(e,t){r.is_hover_camera(e)?"number"!=typeof t.down||"number"!=typeof t.up||t.down<t.up?o.error("hover_set_vertical_limits(): Wrong limits object"):(r.hover_set_vertical_limits(e,t),s.update_transform(e),a.sync_transform(e)):o.error("hover_set_vertical_limits(): Wrong camera object or camera move style")},t.hover_get_vertical_limits=function(e,t){if(!r.is_hover_camera(e))return o.error("hover_get_vertical_limits(): Wrong camera object or camera move style"),null;var _=e.render;return(t=t||{}).down=_.vertical_limits.down,t.up=_.vertical_limits.up,t},t.hover_set_distance_limits=function(e,t){r.is_hover_camera(e)?"number"!=typeof t.min||"number"!=typeof t.max||t.min>t.max?o.error("hover_set_distance_limits(): Wrong limits object"):(t.min=Math.max(t.min,0),t.max=Math.max(t.max,0),r.hover_set_distance_limits(e,t),s.update_transform(e),a.sync_transform(e)):o.error("hover_set_distance_limits(): Wrong camera object or camera move style")},t.hover_get_distance_limits=function(e,t){if(!r.is_hover_camera(e))return o.error("hover_get_distance_limits(): Wrong camera object or camera move style"),null;var _=e.render;return(t=t||{}).min=_.distance_limits.min,t.max=_.distance_limits.max,t},t.hover_set_vert_trans_limits=function(e,t){r.is_hover_camera(e)?t&&("number"!=typeof t.min||"number"!=typeof t.max||t.min>t.max)?o.error("hover_set_vert_trans_limits(): Wrong limits object"):(r.set_vert_trans_limits(e,t),s.update_transform(e),a.sync_transform(e)):o.error("hover_set_vert_trans_limits(): Wrong camera object or camera move style")},t.hover_get_vert_trans_limits=function(e,t){if(!r.is_hover_camera(e))return o.error("hover_get_vert_trans_limits(): Wrong camera object or camera move style"),null;var _=e.render;return _.hover_vert_trans_limits?((t=t||{}).min=_.hover_vert_trans_limits.min,t.max=_.hover_vert_trans_limits.max,t):null},t.hover_set_horiz_trans_limits=function(e,t){r.is_hover_camera(e)?t&&("number"!=typeof t.min||"number"!=typeof t.max||t.min>t.max)?o.error("hover_set_horiz_trans_limits(): Wrong limits object"):(r.set_hor_trans_limits(e,t),s.update_transform(e),a.sync_transform(e)):o.error("hover_set_horiz_trans_limits(): Wrong camera object or camera move style")},t.hover_get_horiz_trans_limits=function(e,t){if(!r.is_hover_camera(e))return o.error("hover_get_horiz_trans_limits(): Wrong camera object or camera move style"),null;var _=e.render;return _.hover_horiz_trans_limits?((t=t||{}).min=_.hover_horiz_trans_limits.min,t.max=_.hover_horiz_trans_limits.max,t):null},t.hover_switch_horiz_rotation=function(e,t){if(!r.is_hover_camera(e))return o.error("hover_switch_horiz_rotation(): Wrong camera object or camera move style"),null;e.render.enable_hover_hor_rotation=t},t.is_static_camera=r.is_static_camera,t.is_target_camera=r.is_target_camera,t.is_eye_camera=r.is_eye_camera,t.is_hover_camera=r.is_hover_camera,t.get_move_style=function(e){return n.is_camera(e)?r.get_move_style(e):(o.error("get_move_style(): Wrong camera object"),null)},t.set_translation=function(e,t){if(n.is_camera(e)){var _=e.render;r.is_target_camera(e)?Ie(be(t,Fa(_.world_tsr),c),_.pivot,_.pivot):r.is_hover_camera(e)&&Ie(be(t,Fa(_.world_tsr),c),_.hover_pivot,_.hover_pivot),s.set_translation(e,t),s.update_transform(e),a.sync_transform(e)}else o.error("set_translation(): Wrong camera object")},t.get_translation=function(e,t){return n.is_camera(e)?(t=t||new Float32Array(3),s.get_translation(e,t)):(o.error("get_translation(): Wrong camera object"),null)},t.rotate_camera=function(e,t,_,i){n.is_camera(e)?((i=i||!1)?r.set_rotation_angles(e,t,_):r.rotate_angles(e,t,_),s.update_transform(e),a.sync_transform(e)):o.error("rotate_camera(): Wrong camera object")},t.set_velocities=function(e,t){if(n.is_camera(e)){var r=e.render;"number"==typeof t.trans&&(r.velocity_trans=Un(t.trans,0,1/0)),"number"==typeof t.rot&&(r.velocity_rot=Un(t.rot,0,1/0)),"number"==typeof t.zoom&&(r.velocity_zoom=Un(t.zoom,0,.99))}else o.error("set_velocities(): Wrong camera object")},t.get_velocities=function(e,t){if(!n.is_camera(e))return o.error("get_velocities(): Wrong camera object"),null;var r=e.render;return(t=t||{}).trans=r.velocity_trans,t.rot=r.velocity_rot,t.zoom=r.velocity_zoom,t},t.is_look_up=function(e){return n.is_camera(e)?sn(Ba(e.render.world_tsr),O_,c)[1]>=0:(o.error("is_look_up(): Wrong camera object"),!1)},t.get_camera_angles=function(e,t){return n.is_camera(e)?(t=t||new Float32Array(2),r.get_camera_angles(e,t),t):(o.error("get_camera_angles(): Wrong camera object"),null)},t.get_camera_angles_char=function(e,t){return n.is_camera(e)?(t=t||new Float32Array(2),r.get_camera_angles_char(e,t),t):(o.error("get_camera_angles_char(): Wrong camera object"),null)},t.get_camera_angles_dir=function(e,t){t=t||new Float32Array(2);var _=Ke(e,c),n=_a(O_,_,T);return Kn(n,!0),r.get_camera_angles_from_quat(n,S_,t),t},t.set_stereo_distance=function(e,t){if(n.is_camera(e))for(var _=i.get_active(),a=n.get_scene_data(e,_).cameras,s=0;s<a.length;s++){var E=a[s];E.type!=r.TYPE_STEREO_LEFT&&E.type!=r.TYPE_STEREO_RIGHT&&E.type!=r.TYPE_HMD_LEFT&&E.type!=r.TYPE_HMD_RIGHT||r.set_stereo_params(E,t,E.stereo_eye_dist)}else o.error("set_stereo_distance(): Wrong camera object")},t.get_stereo_distance=function(e){if(!n.is_camera(e))return o.error("get_stereo_distance(): Wrong camera object"),0;for(var t=i.get_active(),_=n.get_scene_data(e,t).cameras,a=0;a<_.length;a++){var s=_[a];if(s.type==r.TYPE_STEREO_LEFT||s.type==r.TYPE_STEREO_RIGHT)return s.stereo_conv_dist}return 0},t.set_eye_distance=function(e,t){if(n.is_camera(e)){var _=i.get_active(),a=n.get_scene_data(e,_);r.set_eye_distance(a.cameras,t)}else o.error("set_eye_distance(): Wrong camera object")},t.get_eye_distance=function(e){if(!n.is_camera(e))return o.error("get_eye_distance(): Wrong camera object"),0;for(var t=i.get_active(),_=n.get_scene_data(e,t).cameras,a=0;a<_.length;a++){var s=_[a];if(s.type==r.TYPE_STEREO_LEFT||s.type==r.TYPE_STEREO_RIGHT||s.type==r.TYPE_HMD_LEFT||s.type==r.TYPE_HMD_RIGHT)return s.stereo_eye_dist}return 0},t.set_vertical_axis=function(e,t){n.is_camera(e)?(he(t,e.render.vertical_axis),s.update_transform(e),a.sync_transform(e)):o.error("set_vertical_axis(): Wrong camera object")},t.get_vertical_axis=function(e,t){if(n.is_camera(e))return t||(t=ve()),he(e.render.vertical_axis,t),t;o.error("get_vertical_axis(): Wrong camera object")},t.translate_view=function(e,t,_,a){if(n.is_camera(e))for(var s=i.get_active(),E=n.get_scene_data(e,s).cameras,c=0;c<E.length;c++){var l=E[c];Re(-t,-_,0,l.view_transform_params.trans),l.reflection_plane?r.set_projection_reflect(l,!1):r.set_projection(l,!1)}else o.error("translate_view(): Wrong camera object")},t.get_view_vector=f,t.get_fov=function(e){if(!n.is_camera(e))return o.error("get_fov(): Wrong camera object"),0;var t=i.get_active(),_=n.get_scene_data(e,t);return r.get_fov(_.cameras[0])},t.set_fov=function(e,t){if(n.is_camera(e))for(var _=i.get_active(),a=n.get_scene_data(e,_).cameras,s=0;s<a.length;s++){var E=a[s];r.set_fov(E,t),E.reflection_plane?r.set_projection_reflect(E,!1):r.set_projection(E,!1)}else o.error("set_fov(): Wrong camera object")},t.set_hmd_fov=function(e,t,r){o.error_once("set_hmd_fov() deprecated")},t.correct_up=function(e,t,_){n.is_camera(e)?(r.correct_up(e,t=t||e.render.vertical_axis,_||!1),s.update_transform(e),a.sync_transform(e)):o.error("correct_up(): Wrong camera object")},t.set_ortho_scale=function(e,t){if(n.is_camera(e)&&r.is_ortho_camera(e)){var _=e.render;if(r.is_target_camera(e)){var a=Ue(Fa(_.world_tsr),_.pivot);_.init_fov=t/2*_.init_dist/a}else if(r.is_hover_camera(e))a=Ue(Fa(_.world_tsr),_.hover_pivot),_.init_fov=t/2*_.init_dist/a;else{var s=i.get_active();n.get_scene_data(e,s).cameras[0].fov=t/2}r.update_ortho_scale(e)}else o.error("set_ortho_scale(): Wrong camera object")},t.get_ortho_scale=function(e){if(!n.is_camera(e)||!r.is_ortho_camera(e))return o.error("get_ortho_scale(): Wrong camera object"),0;var t=i.get_active();return 2*n.get_scene_data(e,t).cameras[0].fov},t.is_ortho_camera=function(e){return n.is_camera(e)?r.is_ortho_camera(e):(o.error("is_ortho_camera(): Wrong camera object"),!1)},t.calc_ray=function(e,t,a,T){if(!n.is_camera(e))return o.error("calc_ray(): Wrong camera object"),null;var u=i.get_active(),d=n.get_scene_data(e,u).cameras[0];switch(T&&3==T.length?o.error_once('dest parameter in the function "calc_ray" should be type of parametric line.'):T=T||new Float32Array(6),d.type){case r.TYPE_PERSP:case r.TYPE_PERSP_ASPECT:case r.TYPE_STEREO_LEFT:case r.TYPE_STEREO_RIGHT:var f=Math.tan(r.get_vfov(d)/2),P=f*d.aspect,A=c,S=_.canvas_to_viewport_coords(t,a,E,d);return A[0]=(2*S[0]/d.width-1)*P,A[1]=(1-2*S[1]/d.height)*f,A[2]=-1,Za(A,e.render.world_tsr,A),Ke(A,A),3==T.length?he(A,T):(Tt(T,s.get_translation(e,l)),ut(T,A)),T;case r.TYPE_ORTHO:A=c,S=_.canvas_to_viewport_coords(t,a,E,d),A[0]=(2*S[0]/d.width-1)*d.top*d.aspect,A[1]=(1-2*S[1]/d.height)*d.top,A[2]=0,ja(A,e.render.world_tsr,A),he(A,T);var p=Ba(e.render.world_tsr);return We(O_,p,A),ut(T,A),T;default:return o.error("calc_ray(): Non-compatible camera"),T}},t.project_point=function(e,t,_){return n.is_camera(e)?(_=_||new Float32Array(2),r.project_point(e,t,_)):(o.error("project_point(): Wrong camera object"),null)},t.has_distance_limits=function(e){return(r.is_target_camera(e)||r.is_hover_camera(e))&&null!==e.render.distance_limits},t.has_vertical_rot_limits=function(e){return(r.is_eye_camera(e)||r.is_target_camera(e)||r.is_hover_camera(e))&&null!==e.render.vertical_limits},t.has_horizontal_rot_limits=function(e){return(r.is_target_camera(e)||r.is_eye_camera(e))&&null!==e.render.horizontal_limits},t.has_vertical_trans_limits=function(e){return r.is_hover_camera(e)&&null!==e.render.hover_vert_trans_limits},t.has_horizontal_trans_limits=function(e){return r.is_hover_camera(e)&&null!==e.render.hover_horiz_trans_limits},t.get_frustum_planes=function(e,t){if(!n.is_camera(e))return o.error("get_frustum_planes(): Wrong camera object"),null;var r=i.get_active(),_=n.get_scene_data(e,r).cameras[0].frustum_planes;return nr(_.left,t.left),nr(_.right,t.right),nr(_.top,t.top),nr(_.bottom,t.bottom),nr(_.near,t.near),nr(_.far,t.far),t},t.set_projection=function(e,t){n.is_camera(e)?r.set_proj_mat(e,t):o.error("set_projection(): Wrong camera object")}}),sE=A("__context",function(e,t){var r=null;t.setup=function(e){r=e},t.get_gl=function(){return r},t.reset=function(){r=null}}),EE=A("config",function(e,t){var r=Wo(e),_=Us(e),n=sE(e),a=nE(e),o=ga(e);t.P_LOW=r.P_LOW,t.P_HIGH=r.P_HIGH,t.P_ULTRA=r.P_ULTRA,t.P_CUSTOM=r.P_CUSTOM,t.P_AUTO=r.P_AUTO,t.set=r.set,t.get=r.get,t.reset=r.reset,t.reset_limits=r.reset_limits,t.get_std_assets_path=r.get_assets_path,t.get_assets_path=r.get_assets_path,t.apply_quality=function(e){a.is_primary_loaded()?o.error("Cannot change quality profile after a scene is loaded."):(r.set("quality",e),n.get_gl()&&(r.apply_quality(),_.set_hardware_defaults(n.get_gl(),!1)))}}),cE=A("constraints",function(e,t){var r=oE(e),_=ms(e),n=os(e),a=Ns(e),o=ga(e),i=Os(e);t.append_stiff=function(e,t,r,s,E){n.is_dynamic(e)?_.check_self_applying(e,t)?_.check_compatibility(e,t)?(r=r||new Float32Array(3),E=E||1,s=s||[0,0,0,1],t instanceof Array&&2==t.length?_.append_stiff_bone(e,t[0],t[1],r,s,E):_.append_stiff_obj(e,t,r,s,E),i.update_transform(e),a.sync_transform(e)):o.error("Constraint recursion is forbidden."):o.error("Can not apply constraint. Object and target must be different."):o.error('Wrong object: "'+e.name+'" is not dynamic.')},t.append_semi_stiff=function(e,t,r,s,E,c,l,T){n.is_dynamic(e)?_.check_self_applying(e,t)?_.check_compatibility(e,t)?(E=z_(E)?E:Math.PI/2,c=z_(c)?c:-Math.PI/2,l=z_(l)?l:Math.PI/2,T=z_(T)?T:-Math.PI/2,r=r||new Float32Array(3),s=s?new Float32Array(s):null,_.append_semi_stiff_obj(e,t,r,s,E,c,l,T),i.update_transform(e),a.sync_transform(e)):o.error("Constraint recursion is forbidden."):o.error("Can not apply constraint. Object and target must be different."):o.error('Wrong object: "'+e.name+'" is not dynamic.')},t.append_semi_stiff_cam=function(e,_,n,a,i,s,E,c){o.error_deprecated("append_semi_stiff_cam","append_semi_stiff"),r.is_eye_camera(e)?t.append_semi_stiff(e,_,n,a,i,s,E,c):o.error("append_semi_stiff_cam(): wrong object type, only EYE camera objects can be parented.")},t.append_semi_soft_cam=function(e,_,n,a){o.error_deprecated("append_semi_soft_cam","append_semi_soft"),r.is_eye_camera(e)?t.append_semi_soft(e,_,n,a):o.error("append_semi_soft_cam(): wrong object type, only EYE camera objects can be parented.")},t.append_semi_soft=function(e,t,r,s){n.is_dynamic(e)?_.check_self_applying(e,t)?_.check_compatibility(e,t)?((!z_(s)||s<0)&&(s=.25),r=r||new Float32Array(3),_.append_semi_soft_obj(e,t,r,s),i.update_transform(e),a.sync_transform(e)):o.error("Constraint recursion is forbidden."):o.error("Can not apply constraint. Object and target must be different."):o.error('Wrong object: "'+e.name+'" is not dynamic.')},t.append_stiff_trans=function(e,t,r){n.is_dynamic(e)?_.check_self_applying(e,t)?_.check_compatibility(e,t)?(r=r||new Float32Array(3),_.append_stiff_trans_obj(e,t,r),i.update_transform(e),a.sync_transform(e)):o.error("Constraint recursion is forbidden."):o.error("Can not apply constraint. Object and target must be different."):o.error('Wrong object: "'+e.name+'" is not dynamic.')},t.append_copy_loc=function(e,t,r,s,E){if(n.is_dynamic(e))if(_.check_self_applying(e,t))if(_.check_compatibility(e,t)){s=s||!1,r=r||"XYZ",E=E||1;var c=i.get_translation(e,new Float32Array(3)),l=new Float32Array(3);l[0]=-1!=r.indexOf("-X")?-1:-1!=r.indexOf("X")?1:0,l[1]=-1!=r.indexOf("-Y")?-1:-1!=r.indexOf("Y")?1:0,l[2]=-1!=r.indexOf("-Z")?-1:-1!=r.indexOf("Z")?1:0,_.append_copy_loc_obj(e,t,c,l,s,E),i.update_transform(e),a.sync_transform(e)}else o.error("Constraint recursion is forbidden.");else o.error("Can not apply constraint. Object and target must be different.");else o.error('Wrong object: "'+e.name+'" is not dynamic.')},t.append_copy_trans=function(e,t,r){n.is_dynamic(e)?_.check_self_applying(e,t)?_.check_compatibility(e,t)?(_.append_copy_trans_obj(e,t,r=r||1),i.update_transform(e),a.sync_transform(e)):o.error("Constraint recursion is forbidden."):o.error("Can not apply constraint. Object and target must be different."):o.error('Wrong object: "'+e.name+'" is not dynamic.')},t.append_copy_rot=function(e,t,r,s,E){if(n.is_dynamic(e))if(_.check_self_applying(e,t))if(_.check_compatibility(e,t)){s=s||!1,r=r||"XYZ",E=E||1;var c=new Float32Array(3);c[0]=-1!=r.indexOf("-X")?-1:-1!=r.indexOf("X")?1:0,c[1]=-1!=r.indexOf("-Y")?-1:-1!=r.indexOf("Y")?1:0,c[2]=-1!=r.indexOf("-Z")?-1:-1!=r.indexOf("Z")?1:0,_.append_copy_rot_obj(e,t,c,s,E),i.update_transform(e),a.sync_transform(e)}else o.error("Constraint recursion is forbidden.");else o.error("Can not apply constraint. Object and target must be different.");else o.error('Wrong object: "'+e.name+'" is not dynamic.')},t.append_stiff_trans_rot=function(e,t,r,s){n.is_dynamic(e)?_.check_self_applying(e,t)?_.check_compatibility(e,t)?(r=r||new Float32Array(3),s=s?new Float32Array(s):[0,0,0,1],_.append_stiff_trans_rot_obj(e,t,r,s,1),i.update_transform(e),a.sync_transform(e)):o.error("Constraint recursion is forbidden."):o.error("Can not apply constraint. Object and target must be different."):o.error('Wrong object: "'+e.name+'" is not dynamic.')},t.append_track=function(e,t,r,s,E,c){if(n.is_dynamic(e))if(_.check_self_applying(e,t))if(_.check_compatibility(e,t)){var l=A_;"-Y"==r?l=m_:"Y"==r?l=A_:"-X"==r?l=p_:"X"==r?l=P_:"-Z"==r?l=O_:"Z"==r&&(l=S_);var T=S_;"X"==s?T=P_:"Y"==s&&(T=A_),1!=Math.abs(Be(l,T))?(c=c||1,_.append_track_obj(e,t,l,T,E=E||!1,c),i.update_transform(e),a.sync_transform(e)):o.error("Can not use parallel vectors for track and up axes.")}else o.error("Constraint recursion is forbidden.");else o.error("Can not apply constraint. Object and target must be different.");else o.error('Wrong object: "'+e.name+'" is not dynamic.')},t.append_follow=function(e,t,r,s){n.is_dynamic(e)?_.check_self_applying(e,t)?_.check_compatibility(e,t)?(_.append_follow_obj(e,t,r,s),i.update_transform(e),a.sync_transform(e)):o.error("Constraint recursion is forbidden."):o.error("Can not apply constraint. Object and target must be different."):o.error('Wrong object: "'+e.name+'" is not dynamic.')},t.append_stiff_viewport=function(e,t,r){n.is_dynamic(e)?_.check_self_applying(e,t)?_.check_compatibility(e,t)?(_.append_stiff_viewport(e,t,r=r||{}),i.update_transform(e),a.sync_transform(e)):o.error("Constraint recursion is forbidden."):o.error("Can not apply constraint. Object and target must be different."):o.error('Wrong object: "'+e.name+'" is not dynamic.')},t.remove=function(e,t){t=t||!1,e.constraint&&_.remove(e,t),t&&i.update_transform(e)}}),lE=A("container",function(e,t){var r=aE(e),_=ga(e);t.get_canvas=r.get_canvas,t.get_canvas_hud=r.get_canvas_hud,t.get_container=r.get_container,t.insert_to_container=function(e,t){2==arguments.length?e&&t&&r.insert_to_container(e,t):_.error("insert_to_container(): two arguments required")},t.set_canvas_offsets=function(e,t){return _.error_once("container.set_canvas_offsets() deprecated. Not needed anymore. Use the container.client_to_canvas_coords method."),r.set_canvas_offsets(e,t)},t.update_canvas_offsets=function(){_.error_once("container.update_canvas_offsets() deprecated. Not needed anymore. Use the container.client_to_canvas_coords method."),r.update_canvas_offsets()},t.client_to_canvas_coords=function(e,t,_){return _||(_=new Float32Array(2)),r.client_to_canvas_coords(e,t,_)},t.client_to_element_coords=function(e,t,_,n){return n||(n=new Float32Array(2)),r.client_to_element_coords(e,t,_,n)},t.get_coords_target_space=function(e,t,_){return _||(_=new Float32Array(2)),r.get_coords_target_space(e,t,_)},t.force_offsets_updating=function(){_.error_once("container.force_offsets_updating() deprecated. Not needed anymore. Use the container.client_to_canvas_coords method."),r.force_offsets_updating()},t.resize=function(e,t,_){r.resize(e,t,_)},t.resize_to_container=function(e){r.resize_to_container(e=e||!1)}}),TE=A("controls",function(e,t){var r=Xs(e),_=Ns(e),n=ga(e);t.CT_POSITIVE=r.CT_POSITIVE,t.CT_CONTINUOUS=r.CT_CONTINUOUS,t.CT_TRIGGER=r.CT_TRIGGER,t.CT_SHOT=r.CT_SHOT,t.CT_LEVEL=r.CT_LEVEL,t.CT_CHANGE=r.CT_CHANGE,t.KEY_BACKSPACE=8,t.KEY_TAB=9,t.KEY_ENTER=13,t.KEY_SHIFT=16,t.KEY_CTRL=17,t.KEY_ALT=18,t.KEY_PAUSE=19,t.KEY_CAPSLOCK=20,t.KEY_ESC=27,t.KEY_SPACE=32,t.KEY_LEFT=37,t.KEY_UP=38,t.KEY_RIGHT=39,t.KEY_DOWN=40,t.KEY_1=49,t.KEY_2=50,t.KEY_3=51,t.KEY_4=52,t.KEY_5=53,t.KEY_6=54,t.KEY_7=55,t.KEY_8=56,t.KEY_9=57,t.KEY_A=65,t.KEY_B=66,t.KEY_C=67,t.KEY_D=68,t.KEY_E=69,t.KEY_F=70,t.KEY_G=71,t.KEY_H=72,t.KEY_I=73,t.KEY_J=74,t.KEY_K=75,t.KEY_L=76,t.KEY_M=77,t.KEY_N=78,t.KEY_O=79,t.KEY_P=80,t.KEY_Q=81,t.KEY_R=82,t.KEY_S=83,t.KEY_T=84,t.KEY_U=85,t.KEY_V=86,t.KEY_W=87,t.KEY_X=88,t.KEY_Y=89,t.KEY_Z=90,t.KEY_NUM0=96,t.KEY_NUM1=97,t.KEY_NUM2=98,t.KEY_NUM3=99,t.KEY_NUM4=100,t.KEY_NUM5=101,t.KEY_NUM6=102,t.KEY_NUM7=103,t.KEY_NUM8=104,t.KEY_NUM9=105,t.KEY_MULT=106,t.KEY_ADD=107,t.KEY_SUB=109,t.KEY_DEC_POINT=110,t.KEY_DIV=111,t.KEY_SEMI_COLON=186,t.KEY_EQUAL_SIGN=187,t.KEY_COMMA=188,t.KEY_DASH=189,t.KEY_PERIOD=190,t.KEY_FORWARD_SLASH=191,t.KEY_GRAVE_ACCENT=192,t.KEY_LEFT_SQ_BRACKET=219,t.KEY_BACK_SLASH=220,t.KEY_RIGHT_SQ_BRACKET=221,t.KEY_SINGLE_QUOTE=222,t.PL_SINGLE_TOUCH_MOVE=r.PL_SINGLE_TOUCH_MOVE,t.PL_MULTITOUCH_MOVE_ZOOM=r.PL_MULTITOUCH_MOVE_ZOOM,t.PL_MULTITOUCH_MOVE_PAN=r.PL_MULTITOUCH_MOVE_PAN,t.PL_MULTITOUCH_MOVE_ROTATE=r.PL_MULTITOUCH_MOVE_ROTATE,t.default_AND_logic_fun=r.default_AND_logic_fun,t.default_OR_logic_fun=r.default_OR_logic_fun,t.create_gamepad_btn_sensor=r.create_gamepad_btn_sensor,t.create_gamepad_axis_sensor=r.create_gamepad_axis_sensor,t.create_gamepad_position_sensor=r.create_gamepad_position_sensor,t.create_gamepad_orientation_sensor=r.create_gamepad_orientation_sensor,t.create_custom_sensor=r.create_custom_sensor,t.create_keyboard_sensor=r.create_keyboard_sensor,t.create_collision_sensor=function(e,t,_){return r.create_collision_sensor(e,t=t||"ANY",_=_||!1)},t.create_collision_impulse_sensor=r.create_collision_impulse_sensor,t.create_ray_sensor=function(e,t,a,o,i,s,E){if(!e||_.obj_has_physics(e))return r.create_ray_sensor(e,t,a,o=o||"ANY",i=i||!1,s=s||!1,E=E||!1);n.error_once("No physics for object "+e.name)},t.create_mouse_click_sensor=r.create_mouse_click_sensor,t.create_mouse_wheel_sensor=r.create_mouse_wheel_sensor,t.create_mouse_move_sensor=r.create_mouse_move_sensor,t.create_plock_mouse_sensor=r.create_plock_mouse_sensor,t.create_plock_sensor=r.create_plock_sensor,t.create_touch_move_sensor=r.create_touch_move_sensor,t.create_touch_zoom_sensor=r.create_touch_zoom_sensor,t.create_touch_rotate_sensor=r.create_touch_rotate_sensor,t.create_touch_click_sensor=r.create_touch_click_sensor,t.create_motion_sensor=r.create_motion_sensor,t.create_vertical_velocity_sensor=r.create_vertical_velocity_sensor,t.create_gyro_angles_sensor=r.create_gyro_angles_sensor,t.create_gyro_quat_sensor=r.create_gyro_quat_sensor,t.create_gyro_delta_sensor=r.create_gyro_delta_sensor,t.create_hmd_quat_sensor=r.create_hmd_quat_sensor,t.create_hmd_position_sensor=r.create_hmd_position_sensor,t.create_timer_sensor=function(e,t){return r.create_timer_sensor(e,t||!1)},t.reset_timer_sensor=r.reset_timer_sensor,t.create_elapsed_sensor=r.create_elapsed_sensor,t.create_timeline_sensor=r.create_timeline_sensor,t.create_selection_sensor=function(e,t){return r.create_selection_sensor(e,t||!1)},t.create_callback_sensor=function(e,t){return r.create_callback_sensor(e,t||0)},t.set_custom_sensor=function(e,t){r.sensor_set_value(e,t)},t.get_custom_sensor=function(e){return e.value},t.get_sensor_value=r.get_sensor_value,t.get_sensor_payload=r.get_sensor_payload,t.create_sensor_manifold=function(e,t,_,n,a,o,i){i=void 0===i?null:i,r.create_sensor_manifold(e,t,_,n,a=a||r.default_AND_logic_fun,o,i)},t.create_kb_sensor_manifold=function(e,t,_,n,a,o){var i=r.create_keyboard_sensor(n);r.create_sensor_manifold(e,t,_,[i],r.default_AND_logic_fun,a,o=void 0===o?null:o)},t.check_sensor_manifolds=function(e){return r.check_sensor_manifold(e,null)},t.check_sensor_manifold=r.check_sensor_manifold,t.remove_sensor_manifold=r.remove_sensor_manifold,t.reset=r.reset,t.set_plock_smooth_factor=r.set_plock_smooth_factor}),uE=A("data",function(e,t){var r=nE(e),_=Hs(e);t.load=r.load,t.unload=function(e){r.unload(e|=0)},t.set_debug_resources_root=r.set_debug_resources_root,t.is_primary_loaded=r.is_primary_loaded,t.is_idle=_.is_finished,t.load_and_add_new=r.load,t.cleanup=t.unload,t.activate_media=r.activate_media,t.prefetch=r.prefetch,t.unfetch=r.unfetch}),dE=A("__debug_batch",function(e,t){var r=Ks(e),_=ga(e),n=Ms(e),a=ps(e);function o(e,t,r){var n=[];for(var a in e)Vn(e[a])>1&&n.push([a,e[a]]);if(n.sort(function(e,t){var r=Vn(e[1]),_=Vn(t[1]);return _!=r?_-r:e<t?-1:t<e?1:0}),n.length){_.groupCollapsed(t+" "+r),_.log_raw("Property different variants (>1) | Property name");for(var o=0;o<n.length;o++)_.groupCollapsed(Vn(n[o][1]),n[o][0]),i(n[o][1]);_.groupEnd()}}function i(e){_.log_raw("Batches count for this property value | Property value");var t=[];for(var r in e)t.push([r,e[r]]);t.sort(function(e,t){return t[1]!=e[1]?t[1]-e[1]:e[0]<t[0]?-1:t[0]<e[0]?1:0});for(var n=0;n<t.length;n++)_.log_raw(t[n][1],t[n][0]);_.groupEnd()}t.print_batches_stat=function(){for(var e={},t=["bounds_local","bufs_data","id","attribute_setters","num_vertices","num_triangles","material_names","shader","bpy_tex_names"],i=0,s=0,E=n.get_scene_objs(a.get_main(),"MESH",n.DATA_ID_ALL),c=0;c<E.length;c++)for(var l=0;l<E[c].scenes_data.length;l++)for(var T=0;T<E[c].scenes_data[l].batches.length;T++){var u=r.clone_batch(E[c].scenes_data[l].batches[T]),d=u.shaders_info.vert+"/"+u.shaders_info.frag;u["shaders_info.directives"]=u.shaders_info.directives,u["shaders_info.node_elements"]=u.shaders_info.node_elements,delete u.shaders_info;for(var f=0;f<t.length;f++)delete u[t[f]];if(E[c].is_dynamic)s++;else for(var P in i++,u.type in e||(e[u.type]={}),d in e[u.type]||(e[u.type][d]={}),u){P in e[u.type][d]||(e[u.type][d][P]={});var A=JSON.stringify(u[P]);A in e[u.type][d][P]||(e[u.type][d][P][A]=0),e[u.type][d][P][A]++}}for(var S in _.group("Batches statistics:"),_.log_raw("STATIC/DYNAMIC count:",i+"/"+s),_.group("STATIC batches diversity:"),e)for(var d in e[S])o(e[S][d],S,d);_.groupEnd(),_.groupEnd()}}),fE=A("debug",function(e,t){var r=ha(e),_=Ks(e),n=Wo(e),a=Us(e),o=Xs(e),i=aE(e),s=sE(e),E=nE(e),c=_i(e),l=dE(e),T=ws(e),u=ni(e),d=ss(e),P=oi(e),A=Zo(e),S=wi(e),p=Hs(e),m=Ms(e),O=os(e),v=Ns(e),N=ga(e),g=Qi(e),h=ps(e),R=As(e),I=Ss(e),b=Gs(e),Y=ai(e),L=ri(e),M=ys(e),x=Os(e),y=ba(),w=new Float32Array(2),U=ve(),C=ve(),D=null,F=n.defaults,G=1e-6,k=[],K="",B="",X=!1,H=!1,Q=!0,z=new Uint8Array(4);function V(e,t,r,_){N.group(Y.subs_label(e),_);for(var n=0;n<r.length;n++){var a=r[n],o=a.render;if(o.type==_)for(var i=!1,s=0;s<t.length;s++){for(var E=t[s].bundles,c=0;c<E.length;c++){var l=E[c];if(l.do_render&&l.obj_render==o){N.log_raw("STATIC"==_?a.origin_name:a.name,a),i=!0;break}}if(i)break}}N.groupEnd()}function j(e,t){var r=A.get_debug_shaders();if(r){var _=r.getTranslatedShaderSource(e),n=r.getTranslatedShaderSource(t);if(a.detect_mobile()){_=_.replace("#version","#version 300 //"),n=n.replace("#version","#version 300 //");var o=W("/analyze_shader/vert_gles",_),i=W("/analyze_shader/frag_gles",n)}else _=_.replace("#version","#version 400 //"),n=n.replace("#version","#version 400 //"),o=W("/analyze_shader/vert",_),i=W("/analyze_shader/frag",n);var E=q(o),c=q(i);return{vsrc:s.get_gl().getShaderSource(e),vsrc_trans:_,vout:o,vstats:E,fsrc:s.get_gl().getShaderSource(t),fsrc_trans:n,fout:i,fstats:c}}N.warn("WEBGL_debug_shaders extension not found")}function q(e){var t={};if(!e)return t;for(var r=e.split("\n"),_=0;_<r.length;_++){var n=r[_];-1!=n.search(new RegExp(/^[A-Z.]+ ?/))&&((s=n.split(" ")[0])in t||(t[s]=0),t[s]++)}var a=0,o=0,i=0;for(var s in t)switch(s){case"KIL":case"TEX":case"TXB":case"TXP":case"KIL.F":case"TEX.F":case"TXB.F":case"TXD.F":case"TXL.F":case"TXQ.F":case"TXP.F":o+=t[s],a+=t[s];break;case"ATTRIB":i+=t[s];break;case"ADDRESS":case"PARAM":case"TEMP":case"ALIAS":case"OUTPUT":case"END":break;default:a+=t[s]}return t.ALL_OPS=a,t.TEX_OPS=o,t.ATTRIBS=i,t}function W(e,t){var r=new XMLHttpRequest;if(r.open("POST",e,!1),r.send(t),200==r.status)return r.responseText;throw N.error(r.responseText),"Error POST XHR: "+r.status}function J(e){e.sort(function(e,t){return t.fstats.ALL_OPS-e.fstats.ALL_OPS});for(var t=0;t<e.length;t++){var r=e[t],_=r.fstats,n=r.vstats,a=Z(r.cshader);a=a.length?"\t\t("+a.join(", ")+")":"\t\t(NA)",N.groupCollapsed("VERT ->","OPS",n.ALL_OPS,"ATT",n.ATTRIBS,"TEX",n.TEX_OPS,"\t\tFRAG ->","OPS",_.ALL_OPS,"TEX",_.TEX_OPS,a),N.groupCollapsed("directives");for(var o=r.shaders_info.directives.slice().sort(),i=0;i<o.length;i++){var s=o[i];N.log_raw(s[0],s[1])}N.groupEnd(),N.groupCollapsed("node elements");var E=r.shaders_info.node_elements;for(i=0;i<E.length;i++)N.log_raw(E[i]);N.groupEnd(),N.groupCollapsed("vert source"),N.log_raw(r.vsrc),N.groupEnd(),N.groupCollapsed("vert translated source"),N.log_raw(r.vsrc_trans),N.groupEnd();var c=["ALL_OPS","TEX_OPS","ATTRIBS"];for(var l in N.groupCollapsed("vert ops stats"),n)-1==c.indexOf(l)&&N.log_raw(l,n[l]);for(var l in N.groupEnd(),N.groupCollapsed("vert assembly"),N.log_raw(r.vout),N.groupEnd(),N.groupCollapsed("frag source"),N.log_raw(r.fsrc),N.groupEnd(),N.groupCollapsed("frag translated source"),N.log_raw(r.fsrc_trans),N.groupEnd(),N.groupCollapsed("frag ops stats"),_)-1==c.indexOf(l)&&N.log_raw(l,_[l]);N.groupEnd(),N.groupCollapsed("frag assembly"),N.log_raw(r.fout),N.groupEnd(),N.groupEnd()}}function Z(e){for(var t=[],r=h.get_all_scenes(),_=0;_<r.length;_++)for(var n=r[_],a=m.get_scene_objs(n,"MESH",m.DATA_ID_ALL),o=0;o<a.length;o++){var i=O.get_scene_data(a[o],n);if(i&&i.batches.length)for(var s=i.batches,E=0;E<s.length;E++){var c=s[E];if(c.shader==e)for(var l=0;l<c.material_names.length;l++){var T=c.material_names[l];-1==t.indexOf(T)&&t.push(T)}}}return t}function $(e,t){var r=function(){return k.push(r),e.apply(e,arguments)};return r}function ee(e,t,r,_,n){if(typeof t!=typeof e)throw"debug.eqv: wrong expected data type";if(e.length!=t.length)throw"debug.eqv: wrong expected vector length";r=r||G;for(var a=0;a<e.length;a++){if("number"!=typeof t[a]||isNaN(t[a]))throw"debug.eqv: wrong expected data type";if("number"!=typeof e[a]||isNaN(e[a]))throw"debug.eqv: wrong result data type";if(t[a]>e[a]+r||t[a]<e[a]-r)throw"debug.eqv: wrong result"}te(_,n,"eqv")}function te(e,t,r){if(e=e||"",t=t||"",H){if(""==e)throw"debug."+r+': no error is expected, but got "'+B+'"';if(B!=e)throw"debug."+r+': error "'+e+'" is expected, but got "'+B+'"'}else if(""!=e)throw"debug."+r+': error "'+e+'" is expected, but got nothing';if(X){if(""==t)throw"debug."+r+': no warning is expected, but got "'+K+'"';if(K!=t)throw"debug."+r+': warning "'+t+'" is expected, but got "'+K+'"'}else if(""!=t)throw"debug."+r+': warning "'+t+'" is expected, but got nothing';X=!1,H=!1}function re(){D&&(m.obj_switch_cleanup_flags(D,!1,!1,!1),E.prepare_object_unloading(D),m.obj_switch_cleanup_flags(D,!0,!0,!0),m.remove_object(D),D=null)}t.DV_NONE=u.DV_NONE,t.DV_OPAQUE_WIREFRAME=u.DV_OPAQUE_WIREFRAME,t.DV_TRANSPARENT_WIREFRAME=u.DV_TRANSPARENT_WIREFRAME,t.DV_FRONT_BACK_VIEW=u.DV_FRONT_BACK_VIEW,t.DV_BOUNDINGS=u.DV_BOUNDINGS,t.DV_CLUSTERS_VIEW=u.DV_CLUSTERS_VIEW,t.DV_BATCHES_VIEW=u.DV_BATCHES_VIEW,t.DV_RENDER_TIME=u.DV_RENDER_TIME,t.physics_stats=function(){v.debug_workers()},t.physics_id=function(e){N.log("O",v.find_obj_by_body_id(e));var t=v.get_active_scene();if(t)for(var r=t._physics.bundles,_=0;_<r.length;_++){var n=r[_];n.physics.body_id==e&&N.log("B",n)}else N.error("No active physics scene.")},t.visible_objects=function(){for(var e=h.get_active(),t=m.get_scene_objs(e,"MESH",m.DATA_ID_ALL),r=h.subs_array(e,[Y.MAIN_OPAQUE,Y.MAIN_BLEND,Y.MAIN_GLOW]),_=0;_<r.length;_++){var n=r[_],a=n.draw_data;a.length&&(V(n,a,t,"DYNAMIC"),V(n,a,t,"STATIC"))}},t.object_info=function(e){for(var t=h.get_active(),r=m.get_scene_objs(t,"MESH",m.DATA_ID_ALL),_=0;_<r.length;_++){var n=r[_];if(n.name==e){N.log("Object",n);for(var a=h.get_all_subscenes(t),o=0;o<a.length;o++){for(var i=a[o],s=[],E=i.draw_data,c=0;c<E.length;c++)for(var l=E[c].bundles,T=0;T<l.length;T++)l[T].obj_render==n.render&&s.push(l[T]);N.log("Subscene "+i.type,s)}}}},t.objects_stat=function(){var e=h.get_active();N.log("Armatures: "+m.get_scene_objs(e,"ARMATURE",m.DATA_ID_ALL).length),N.log("Cameras: "+m.get_scene_objs(e,"CAMERA",m.DATA_ID_ALL).length),N.log("Curves: "+m.get_scene_objs(e,"CURVE",m.DATA_ID_ALL).length),N.log("Empties: "+m.get_scene_objs(e,"EMPTY",m.DATA_ID_ALL).length),N.log("Lamps: "+m.get_scene_objs(e,"LAMP",m.DATA_ID_ALL).length),N.log("Meshes: "+m.get_scene_objs(e,"MESH",m.DATA_ID_ALL).length),N.log("Speakers: "+m.get_scene_objs(e,"SPEAKER",m.DATA_ID_ALL).length)},t.num_vertices=function(){for(var e=0,t=h.get_active(),r=h.subs_array(t,[Y.MAIN_OPAQUE,Y.MAIN_BLEND,Y.MAIN_GLOW]),_=0;_<r.length;_++)for(var n=r[_].draw_data,a=0;a<n.length;a++)for(var o=n[a].bundles,i=0;i<o.length;i++){var s=o[i].batch;s&&(e+=s.num_vertices)}return e},t.num_triangles=function(){for(var e=0,t=h.get_active(),r=h.subs_array(t,[Y.MAIN_OPAQUE,Y.MAIN_BLEND,Y.MAIN_GLOW]),_=0;_<r.length;_++)for(var n=r[_].draw_data,a=0;a<n.length;a++)for(var o=n[a].bundles,i=0;i<o.length;i++){var s=o[i].batch;s&&(e+=s.num_triangles)}return e},t.num_draw_calls=function(){for(var e=h.get_active(),t=h.subs_array(e,[Y.MAIN_OPAQUE,Y.MAIN_BLEND,Y.MAIN_GLOW,Y.MAIN_PLANE_REFLECT,Y.MAIN_PLANE_REFLECT_BLEND]),r=0,_=0;_<t.length;_++)for(var n=t[_].draw_data,a=0;a<n.length;a++)r+=n[a].bundles.length;var o=h.subs_array(e,[Y.MAIN_CUBE_REFLECT,Y.MAIN_CUBE_REFLECT_BLEND]);for(_=0;_<o.length;_++)for(n=o[_].draw_data,a=0;a<n.length;a++)r+=6*n[a].bundles.length;return r},t.num_shaders=function(){return Vn(b.get_compiled_shaders())},t.geometry_stats=function(){for(var e=h.get_active(),t=h.get_all_subscenes(e),r={},_=0;_<t.length;_++){var n=t[_];if(n.type!=Y.SINK&&n.type!=Y.DEBUG_VIEW)for(var a=n.draw_data,o=0;o<a.length;o++)for(var i=a[o].bundles,s=0;s<i.length;s++){var E=i[s].batch,c=i[s].obj_render;E&&(n.type!=Y.COLOR_PICKING&&n.type!=Y.OUTLINE_MASK||c.origin_selectable||c.origin_outlining)&&(r[E.id]=E)}}var l=0,T=0;for(var u in r){var d=r[u].bufs_data;d.debug_ibo_bytes&&(T+=d.debug_ibo_bytes/1048576),l+=d.debug_vbo_bytes/1048576}return{vbo_memory:l,ibo_memory:T}},t.num_textures=function(){for(var e=[],t=0,r=h.get_active(),_=h.subs_array(r,[Y.MAIN_OPAQUE,Y.MAIN_BLEND,Y.MAIN_GLOW]),n=0;n<_.length;n++)for(var a=_[n].draw_data,o=0;o<a.length;o++)for(var i=a[o].bundles,s=0;s<i.length;s++){var E=i[s].batch;if(E)for(var c=E.textures,l=0;l<c.length;l++){var T=c[l];if("IMAGE"===T.source||"ENVIRONMENT_MAP"===T.source){var u=T.w_texture;if(-1===e.indexOf(u)){e.push(u);var d=T.width*T.height*4/1048576/T.compress_ratio;t+=d*=1.3333}}}}return{number:e.length,memory:t}},t.num_render_targets=function(){for(var e=[],t=0,r=h.get_active(),_=h.get_all_subscenes(r),n=0;n<_.length;n++){var a=_[n];if(a.type!=Y.SINK){var o=a.camera,i=[o.color_attachment,o.depth_attachment];i.push.apply(i,a.textures_internal);for(var s=0;s<i.length;s++){var E=i[s];M.is_texture(E)&&-1==e.indexOf(E)&&(e.push(E),t+=o.width*o.height*M.get_texture_texel_size(E))}}}return{number:e.length,memory:t/1024/1024}},t.make_camera_frustum_shot=function(){var e=h.get_active(),t=h.get_subs(e,Y.MAIN_OPAQUE);t&&h.make_frustum_shot(t.camera,t,[1,1,0])},t.make_light_frustum_shot=function(){var e=h.get_active(),t=h.get_subs(e,Y.MAIN_OPAQUE),r=h.subs_array(e,[Y.SHADOW_CAST]);if(t)for(var _=0;_<r.length;_++){var n,a=r[_];switch(_){case 0:n=[1,0,0];break;case 1:n=[0,1,0];break;case 2:n=[0,0,1];break;default:n=[1,0,1]}h.make_frustum_shot(a.camera,t,n)}},t.scenegraph_to_dot=function(){for(var e=h.get_all_scenes(),t=0;t<e.length;t++){var r=h.get_graph(e[t]);N.log("\n"+R.debug_convert_to_dot(r))}},t.loading_graph_to_dot=function(e){N.log("\n"+p.graph_to_dot(e|=0))},t.controls_info=o.debug,t.object_distance=function(e,t){return Ue(Fa(e.render.world_tsr),Fa(t.render.world_tsr))},t.msg=function(){d.msg.apply(d,arguments)},t.fbmsg=function(){d.fbmsg.apply(d,arguments)},t.print_telemetry=function(){d.print_telemetry.apply(d,arguments)},t.plot_telemetry=function(){d.plot_telemetry.apply(d,arguments)},t.fbres=function(e,t){t||(t=16);var r=function(){d.fbmsg("FBRES",e()),setTimeout(r,t)};r()},t.assert_constants=function(){var e=new Float32Array(3),t=new Float32Array([0,0,0,1]),r=new Float32Array([1,0,0]),_=new Float32Array([0,1,0]),n=new Float32Array([0,0,1]),a=new Float32Array([-1,0,0]),o=new Float32Array([0,-1,0]),i=new Float32Array([0,0,-1]);if(!mn(e,u_))throw"Wrong VEC3_IDENT";if(!mn(t,d_))throw"Wrong QUAT4_IDENT";if(!mn(r,P_))throw"Wrong AXIS_X";if(!mn(_,A_))throw"Wrong AXIS_Y";if(!mn(n,S_))throw"Wrong AXIS_Z";if(!mn(a,p_))throw"Wrong AXIS_MX";if(!mn(o,m_))throw"Wrong AXIS_MY";if(!mn(i,O_))throw"Wrong AXIS_MZ"},t.mute_music=function(){for(var e=I.get_speaker_objects(),t=0;t<e.length;t++){var r=e[t];"BACKGROUND_MUSIC"==I.get_spk_behavior(r)&&I.mute(r,!0)}},t.check_finite=function(e){return T.finite(e)},t.set_debug_params=function(e){var t=h.get_active(),r=h.subs_array(t,[Y.DEBUG_VIEW]);if(r.length)for(var _=0;_<r.length;_++){var n=r[_];if("number"==typeof e.debug_view_mode)switch(e.debug_view_mode){case u.DV_NONE:case u.DV_OPAQUE_WIREFRAME:case u.DV_TRANSPARENT_WIREFRAME:case u.DV_FRONT_BACK_VIEW:case u.DV_BOUNDINGS:case u.DV_CLUSTERS_VIEW:case u.DV_BATCHES_VIEW:case u.DV_RENDER_TIME:h.set_debug_view_mode(n,e.debug_view_mode);break;default:N.error("set_debug_params(): Wrong debug view mode")}"number"==typeof e.debug_colors_seed&&h.set_debug_colors_seed(n,e.debug_colors_seed),"number"==typeof e.render_time_threshold&&h.set_render_time_threshold(n,e.render_time_threshold),"object"==typeof e.wireframe_edge_color&&h.set_wireframe_edge_color(n,j_(e.wireframe_edge_color))}else N.error("Debugging is not available on the scene.")},t.get_error_quantity=function(){return N.get_error_count()},t.get_warning_quantity=function(){return N.get_warning_count()},t.clear_errors_warnings=function(){return N.clear_errors_warnings()},t.analyze_shaders=function(e){var t=b.get_compiled_shaders(),r=0;for(var _ in t)e&&-1===_.indexOf(e)||r++;var n="of "+r+" analyzing...",a={};for(var _ in t)if(!e||-1!==_.indexOf(e)){var o=t[_],i=j(o.vshader,o.fshader);if(i){var s=o.shaders_info,E=s.vert+" + "+s.frag;i.cshader=o,i.shaders_info=s,(a[E]=a[E]||[]).push(i),N.log_raw(n)}}for(var E in a)N.group("%c"+E,"color: #800"),J(a[E]),N.groupEnd()},t.fake_load=function(e,t,_,n,a){(e=e||null)||r.panic("Stage load callback is undefined"),t=t||5e3,_=_||0,(n=n||100)>100&&r.panic("Max percentage must be less than 100"),_<0&&r.panic("Min percentage must be greater than 0"),_>n&&r.panic("Max percentage must be greater than min percentage");var o=L.animate(_,n,t,function(t){var r=t.toFixed();if(e(r),100==r)return L.clear_animation(o),void(a&&a())})},t.test_performance=function(e){if(b.check_shaders_loaded())if(A.get_disjoint_timer_query()){var r=F.gl_debug;F.gl_debug=!0;var _=R.create_performance_graph();h.generate_auxiliary_batches(null,_);for(var n=R.find_subs(_,Y.PERFORMANCE),a=n.camera,o=0;o<5;o++)g.draw(n);F.gl_debug=r,window.setTimeout(function(){P.process_timer_queries(n);var t=n.debug_render_time,r=a.width*a.height*4*10/(t/1e3)/Math.pow(10,9);e(t,r)},100)}else e(0,0);else window.setTimeout(function(){t.test_performance(e)},100)},t.calc_vbo_garbage_byte_size=c.calc_vbo_garbage_byte_size,t.show_vbo_garbage_info=c.show_vbo_garbage_info,t.print_batches_stat=function(){l.print_batches_stat()},t.start_debug=function(e){for(var t in k=[],Q=!0,"string"==typeof e&&(e=f.require(e)),e)"function"==typeof e[t]&&(e[t]=$(e[t]))},t.check_debug_result=function(){return Q},t.test=function(e,t){var r=N.error,_=N.error_once,n=N.warn;N.error=N.error_once=function(){var e=N.compose_args_prefix(arguments,"B4W ERROR");B=e.join(" "),H=!0},N.warn=function(){var e=N.compose_args_prefix(arguments,"B4W WARN");K=e.join(" "),X=!0},X=!1,H=!1;try{t();var a=!0}catch(t){Q=!1,console.error('Test "'+e+'" failed with exception: "'+t+'"'),a=!1,X=!1,H=!1}return N.error=r,N.error_once=_,N.warn=n,a},t.pix=function(e){var t=i.get_viewport_width(),_=i.get_viewport_height(),n=t/2,a=_/2;i.resize(t,_,!1);var o=h.get_active(),s=R.find_on_screen(o._render.graph);s||r.panic("Couldn't find onscreen subscene");var E=s.camera,c=i.canvas_to_viewport_coords(n,a,w,s.camera);c[1]=E.height-c[1],ee(e,g.read_pixels(E.framebuffer,c[0],c[1],1,1,z),1)},t.eqs=function(e,t,r,_){if(JSON.stringify(e)!=JSON.stringify(t))throw"debug.eqs: wrong result";te(r,_,"eqs")},t.eqv=ee,t.eqf=function(e,t,r,_,n){if("number"!=typeof t||isNaN(t))throw"debug.eqf: wrong expected data type";if("number"!=typeof e||isNaN(e))throw"debug.eqf: wrong result data type";if(t>e+(r=r||G)||t<e-r)throw"debug.eqf: wrong result";te(_,n,"eqf")},t.eq=function(e,t,r,_){if(e!==t)throw"debug.eq: wrong result";te(r,_,"eq")},t.ok=function(e,t,r){if(!Boolean(e))throw"debug.ok: wrong result";te(t,r,"ok")},t.stat=function(e){var t=[];for(var r in"string"==typeof e&&(e=f.require(e)),e)-1==k.indexOf(e[r])&&"function"==typeof e[r]&&t.push(r);if(t.length){N.groupCollapsed(t.length+" function(s) not tested.");for(var _=0;_<t.length;_++)N.log_raw(t[_]);N.groupEnd()}else N.group("All functions were tested.")},t.show_normals=function(e,t,r,n){re();var a=_.find_batch_material(e,t,"MAIN");if(!S.has_dyn_geom(e)||!a)return N.error("Normals are not avaliable for the dynamic object:",e.name),!1;var o=a.bufs_data;if(!(o&&o.pointers&&o.pointers.a_position&&o.pointers.a_tbn))return N.error("Normals are not avaliable for the object:",e.name),!1;var i=S.extract_array_float(o,"a_position"),s=S.extract_array_float(o,"a_normal"),E=x.get_tsr(e,y);D=m.create_line("normal_line");for(var c=new Float32Array(2*i.length),l=0;l<i.length;l+=3){var T=U;T[0]=i[l+0],T[1]=i[l+1],T[2]=i[l+2];var u=ja(T,E,C);c[2*l+0]=u[0],c[2*l+1]=u[1],c[2*l+2]=u[2];var d=ja(Ie(T,ye(s.subarray(l,l+3),r,C),C),E,C);c[2*l+3]=d[0],c[2*l+4]=d[1],c[2*l+5]=d[2]}var f=_.get_first_batch(D);S.draw_line(f,c,!0),g.assign_attribute_setters(f),f.diffuse_color.set([1,1,1,1]),f.line_width=n},t.hide_normals=re}),PE=A("input",function(e,t){var r=ds(e),_=oE(e),n=Wo(e),a=aE(e),o=os(e),i=ga(e),s=ps(e),E=tr(),c=tr(),l=!1,T=n.debug_subs,u=n.defaults;t.GMPD_BUTTON_12=r.GMPD_BUTTON_12,t.GMPD_BUTTON_13=r.GMPD_BUTTON_13,t.GMPD_BUTTON_15=r.GMPD_BUTTON_15,t.GMPD_BUTTON_14=r.GMPD_BUTTON_14,t.GMPD_BUTTON_3=r.GMPD_BUTTON_3,t.GMPD_BUTTON_0=r.GMPD_BUTTON_0,t.GMPD_BUTTON_1=r.GMPD_BUTTON_1,t.GMPD_BUTTON_2=r.GMPD_BUTTON_2,t.GMPD_BUTTON_5=r.GMPD_BUTTON_5,t.GMPD_BUTTON_7=r.GMPD_BUTTON_7,t.GMPD_BUTTON_4=r.GMPD_BUTTON_4,t.GMPD_BUTTON_6=r.GMPD_BUTTON_6,t.GMPD_BUTTON_8=r.GMPD_BUTTON_8,t.GMPD_BUTTON_9=r.GMPD_BUTTON_9,t.GMPD_BUTTON_10=r.GMPD_BUTTON_10,t.GMPD_BUTTON_11=r.GMPD_BUTTON_11,t.GMPD_BUTTON_16=r.GMPD_BUTTON_16,t.GMPD_BUTTON_17=r.GMPD_BUTTON_17,t.GMPD_BUTTON_18=r.GMPD_BUTTON_18,t.GMPD_BUTTON_19=r.GMPD_BUTTON_19,t.GMPD_BUTTON_20=r.GMPD_BUTTON_20,t.GMPD_BUTTON_21=r.GMPD_BUTTON_21,t.GMPD_BUTTON_22=r.GMPD_BUTTON_22,t.GMPD_BUTTON_23=r.GMPD_BUTTON_23,t.GMPD_BUTTON_24=r.GMPD_BUTTON_24,t.GMPD_BUTTON_25=r.GMPD_BUTTON_25,t.GMPD_TRACKPAD_BUTTON=r.GMPD_TRACKPAD_BUTTON,t.GMPD_TRIGGER_BUTTON=r.GMPD_TRIGGER_BUTTON,t.GMPD_GRIPS_BUTTON=r.GMPD_GRIPS_BUTTON,t.GMPD_MENU_BUTTON=r.GMPD_MENU_BUTTON,t.GMPD_AXIS_0=r.GMPD_AXIS_0,t.GMPD_AXIS_1=r.GMPD_AXIS_1,t.GMPD_AXIS_2=r.GMPD_AXIS_2,t.GMPD_AXIS_3=r.GMPD_AXIS_3,t.GMPD_AXIS_4=r.GMPD_AXIS_4,t.GMPD_AXIS_5=r.GMPD_AXIS_5,t.GMPD_AXIS_6=r.GMPD_AXIS_6,t.GMPD_AXIS_7=r.GMPD_AXIS_7,t.GMPD_AXIS_8=r.GMPD_AXIS_8,t.GMPD_AXIS_9=r.GMPD_AXIS_9,t.GMPD_AXIS_10=r.GMPD_AXIS_10,t.GMPD_AXIS_11=r.GMPD_AXIS_11,t.HMD_ORIENTATION_QUAT=r.HMD_ORIENTATION_QUAT,t.HMD_POSITION=r.HMD_POSITION,t.HMD_WEBVR_TYPE=r.HMD_WEBVR_TYPE,t.HMD_WEBVR_DESKTOP=r.HMD_WEBVR_DESKTOP,t.HMD_WEBVR_MOBILE=r.HMD_WEBVR_MOBILE,t.HMD_NON_WEBVR=r.HMD_NON_WEBVR,t.HMD_WEBVR1=r.HMD_WEBVR1,t.HMD_WEBVR1_1=r.HMD_WEBVR1_1;var d=r.HMD_EYE_DISTANCE;t.HMD_EYE_DISTANCE=d,t.HMD_DISTORTION=r.HMD_DISTORTION,t.HMD_BASELINE_DIST=r.HMD_BASELINE_DIST,t.HMD_SCREEN_LENS_DIST=r.HMD_SCREEN_LENS_DIST,t.HMD_SCREEN_WIDTH=r.HMD_SCREEN_WIDTH,t.HMD_SCREEN_HEIGHT=r.HMD_SCREEN_HEIGHT,t.HMD_BEVEL_SIZE=r.HMD_BEVEL_SIZE,t.MOUSE_LOCATION=r.MOUSE_LOCATION,t.MOUSE_DOWN_WHICH=r.MOUSE_DOWN_WHICH,t.MOUSE_UP_WHICH=r.MOUSE_UP_WHICH,t.MOUSE_WHEEL=r.MOUSE_WHEEL,t.KEYBOARD_UP=r.KEYBOARD_UP,t.KEYBOARD_DOWN=r.KEYBOARD_DOWN,t.TOUCH_START=r.TOUCH_START,t.TOUCH_MOVE=r.TOUCH_MOVE,t.TOUCH_END=r.TOUCH_END,t.GYRO_ORIENTATION_QUAT=r.GYRO_ORIENTATION_QUAT,t.GYRO_ORIENTATION_ANGLES=r.GYRO_ORIENTATION_ANGLES;var f={};f[r.DEVICE_HMD]=[r.HMD_ORIENTATION_QUAT,r.HMD_POSITION],f[r.DEVICE_MOUSE]=[r.MOUSE_LOCATION];var P={};P[r.DEVICE_HMD]=[r.HMD_WEBVR_TYPE];var A={};A[r.DEVICE_MOUSE]=[r.MOUSE_LOCATION,r.MOUSE_DOWN_WHICH,r.MOUSE_UP_WHICH,r.MOUSE_WHEEL],A[r.DEVICE_KEYBOARD]=[r.KEYBOARD_UP,r.KEYBOARD_DOWN],A[r.DEVICE_TOUCH]=[r.TOUCH_START,r.TOUCH_MOVE,r.TOUCH_END],A[r.DEVICE_GYRO]=[r.GYRO_ORIENTATION_QUAT,r.GYRO_ORIENTATION_ANGLES];var S={};function p(e){i.error_deprecated("enable_split_screen","screen.request_split_screen");var t=r.get_device_by_type_element(r.DEVICE_HMD);if(!t)return!1;if(l)return!0;var n=r.get_vector_param(t,r.HMD_FOV_LEFT,E),u=r.get_vector_param(t,r.HMD_FOV_RIGHT,c);_.set_hmd_fov(e,n,u);var f=r.get_value_param(t,d);if(f){var P=s.get_active(),A=o.get_scene_data(e,P);_.set_eye_distance(A.cameras,f)}var S={base_line_factor:.5,inter_lens_factor:.5,enable_hmd_stereo:!0};if(r.get_value_param(t,r.HMD_WEBVR_TYPE)&(r.HMD_NON_WEBVR|r.HMD_WEBVR_MOBILE|r.HMD_WEBVR_DESKTOP)&&(S.distortion_coefs=[t.distortion_coefs[0],t.distortion_coefs[1]],S.chromatic_aberration_coefs=[t.chromatic_aberration_coefs[0],t.chromatic_aberration_coefs[1],t.chromatic_aberration_coefs[2],t.chromatic_aberration_coefs[3]],t.webvr_hmd_device||(t.base_line_dist&&t.height_dist&&t.bevel_size?S.base_line_factor=(t.base_line_dist-t.bevel_size)/t.height_dist:t.bevel_size||(S.base_line_factor=t.base_line_dist/t.height_dist)),t.inter_lens_dist&&t.width_dist&&!t.webvr_hmd_device&&(S.inter_lens_factor=t.inter_lens_dist/t.width_dist),!T.enabled)){var p=1+t.distortion_coefs[0]+t.distortion_coefs[1];s.multiply_size_mult(p,p)}return s.set_hmd_params(S),a.resize_to_container(!0),r.reset_device(t),l=!0,!0}S[r.DEVICE_HMD]=[r.HMD_DISTORTION,r.HMD_EYE_DISTANCE,r.HMD_BASELINE_DIST,r.HMD_SCREEN_LENS_DIST,r.HMD_SCREEN_WIDTH,r.HMD_SCREEN_HEIGHT,r.HMD_BEVEL_SIZE],t.DEVICE_GYRO=r.DEVICE_GYRO,t.DEVICE_HMD=r.DEVICE_HMD,t.DEVICE_MOUSE=r.DEVICE_MOUSE,t.DEVICE_KEYBOARD=r.DEVICE_KEYBOARD,t.DEVICE_TOUCH=r.DEVICE_TOUCH,t.can_use_device=r.can_use_device,t.get_device_by_type_element=r.get_device_by_type_element,t.switch_prevent_default=function(e,t){e&&r.switch_prevent_default(e,t)},t.register_device=function(){i.error_once("input.register_device() deprecated")},t.reset_device=function(e){e&&e.type==r.DEVICE_HMD?r.reset_device(e):i.error("reset_device is undefined for device.")},t.get_vector_param=function(e,t,_){return e&&e.type in f&&f[e.type].indexOf(t)>=0?r.get_vector_param(e,t,_):(i.error("device hasn't param: ",t),null)},t.get_value_param=function(e,t){return e&&e.type in P&&P[e.type].indexOf(t)>=0?r.get_value_param(e,t):(i.error("device hasn't param: ",t),null)},t.attach_param_cb=function(e,t,_){if(_=_||null,e&&e.type in A&&A[e.type].indexOf(t)>=0)return r.attach_param_cb(e,t,_);i.error("device hasn't param: ",t)},t.detach_param_cb=function(e,t,_){if(_=_||null,e&&e.type in A&&A[e.type].indexOf(t)>=0)return r.detach_param_cb(e,t,_);i.error("device hasn't param: ",t)},t.set_config=function(e,t,_){if(e&&e.type in S&&S[e.type].indexOf(t)>=0)return r.set_config(e,t,_);i.error("device hasn't config: ",t)},t.request_fullscreen_hmd=function(){if(i.error_deprecated("request_fullscreen_hmd","screen.request_fullscreen_hmd"),s.check_active()){var e=s.get_camera(s.get_active());if(e){p(e);var t=r.get_device_by_type_element(r.DEVICE_HMD);if(t){var _=t.webvr_display;if(_&&!_.isPresenting)if(_.capabilities.canPresent){var n=a.get_canvas();_.requestPresent([{source:n}]).then(function(){if(!u.is_mobile_device){var e=_.getEyeParameters("left"),t=_.getEyeParameters("right");a.resize(2*Math.max(e.renderWidth,t.renderWidth),Math.max(e.renderHeight,t.renderHeight),!1)}},function(){i.error("HMD fullscreen request failed.")})}else i.error("HMD fullscreen request failed.")}}}},t.enable_split_screen=p,t.disable_split_screen=function(){i.error_deprecated("disable_split_screen","screen.exit_split_screen");var e=r.get_device_by_type_element(r.DEVICE_HMD);if(!l||!e||!e.registered)return!1;s.set_hmd_params({enable_hmd_stereo:!1});var t=1/(1+e.distortion_coefs[0]+e.distortion_coefs[1]);return s.multiply_size_mult(t,t),a.resize_to_container(!0),!0},t.set_gamepad_key=function(e,t,_){switch(e){case 0:var n=r.DEVICE_GAMEPAD0;break;case 1:n=r.DEVICE_GAMEPAD1;break;case 2:n=r.DEVICE_GAMEPAD2;break;case 3:n=r.DEVICE_GAMEPAD3;break;default:n=r.DEVICE_GAMEPAD0}var a=r.get_device_by_type_element(n);r.set_config(a,t,_)},t.get_pressed_gmpd_btn=r.get_pressed_gmpd_btn,t.get_moved_gmpd_axis=r.get_moved_gmpd_axis,t.get_gamepad_position=r.get_gamepad_position,t.get_gamepad_orientation=r.get_gamepad_orientation,t.check_enable_gamepad_indices=function(){for(var e=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads:[],t=[],r=0;r<e.length;r++)e[r]&&t.push(r);return t},t.get_vr_controller_id=function(e){for(var t=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads:[],r=0,_=0;r<4;r++){var n=t[r];if(n&&(""==n.id||"OpenVR Gamepad"==n.id||"Oculus Touch (Left)"==n.id||"Oculus Touch (Right)"==n.id)){if(_==e)return _;_++}}return e},t.add_click_listener=function(e,t){e&&t&&r.add_click_listener(e,t)},t.remove_click_listener=function(e,t){e&&t&&r.remove_click_listener(e,t)}}),AE=A("__main",function(e,t){var r=aE(e),_={callback:null,format:"image/png",quality:1,blob_url:"",last_auto_revoke:!1,curr_auto_revoke:!1};t.canvas_data_url=function(e,t,r,n){_.curr_auto_revoke="undefined"!=typeof n||n,_.last_auto_revoke=_.curr_auto_revoke,_.callback=e,_.format=t||_.format,_.quality=r||_.quality},t.frame=function(e,t){var n=_.callback;n&&(_.last_auto_revoke&&_.blob_url&&URL.revokeObjectURL(_.blob_url),function(e,t,_){var n=r.get_canvas();if(n.toBlob)n.toBlob(e,t,_);else{for(var a=atob(n.toDataURL(t,_).split(",")[1]),o=new Uint8Array(a.length),i=0;i<a.length;i++)o[i]=a.charCodeAt(i);e(new Blob([o],{type:t||"image/png"}))}}(function(e){navigator.msSaveOrOpenBlob?n(e):(_.blob_url=URL.createObjectURL(e),n(_.blob_url))},_.format,_.quality),_.callback=null,_.format="image/png",_.quality=1)}}),SE=A("main",function(e,t){var r=Bs(e),_=gs(e),n=Ds(e),a=Wo(e),o=Us(e),i=aE(e),s=sE(e),E=Xs(e),c=nE(e),l=ws(e),T=ss(e),u=Zo(e),d=wi(e),f=ds(e),P=us(e),A=Ls(e),S=AE(e),p=rE(e),m=Ms(e),O=Ns(e),v=ga(e),N=Qi(e),g=ps(e),h=Ss(e),R=Gs(e),I=ys(e),b=ri(e),Y=Os(e),L=is(e),M=a.context,x=a.defaults,y=0,w=0,U=0,C=[],D=function(){},F=function(){},G=function(){},k=["webgl","experimental-webgl"],K=["webgl2","experimental-webgl2"],B=null,X=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){return window.setTimeout(e,1e3/x.max_fps)};function H(e,t){for(var r=null,_=t?K:k,n=0;n<_.length;n++){var a=_[n];try{r=e.getContext(a,M)}catch(e){}if(r)break}return r&&o.detect_tegra_invalid_enum_issue(r),r}function Q(){z()||(w=performance.now()/1e3,h.pause(),O.pause(),I.pause(),r.pause())}function z(){return U<w}function V(){var e="HMD"===x.stereo&&f.get_webvr_display();e?e.requestAnimationFrame(V):X(V);var t=performance.now()/1e3;y||(y=t);var a=t-y;if(!(a<1/x.max_fps)){for(var o=b.get_timeline(),i=0;i<C.length;i++)C[i](o,a);z()||(U>y&&(a-=U-Math.max(w,y)),b.set_delta(a),b.set_timeline(o+=a),T.update(),n.update(),c.update(),function(e,t){c.is_primary_loaded()&&(P.reset(),Y.update(t),p.update(e,t),A.update(e,t),h.update(e,t),t&&_.update(t),c.is_primary_loaded()&&(O.update(e,t),c.is_primary_loaded()&&(f.update(e),E.update(e,t),c.is_primary_loaded()&&(r.update(!1),m.update(e,t),L.update(),G(t,e),c.is_primary_loaded()&&(g.update(e,t),r.update_visibility(),S.frame())))))}(o,a),F(a)),y=t,e&&e.isPresenting&&e.submitFrame()}}t.init=function(e,t){v.set_verbose(x.console_verbose);var r=ki()+" "+Ki()+" ("+Xi()+")";if(v.log("%cINIT ENGINE","color: #00a",r),v.log("%cUSER AGENT:","color: #00a",navigator.userAgent),!window.WebGLRenderingContext)return null;!function(){window.performance||(v.log("Apply performance workaround"),window.performance={});var e=Date.now();window.performance.now||(v.log("Apply performance.now() workaround"),window.performance.now=function(){return Date.now()-e}),b.set_timeline(0)}(),t?P.init(t):(a.defaults.show_hud_debug_info=!1,a.sfx.mix_mode=!1),o.apply_context_alpha_hack(),o.check_user_agent("Chrome")||o.check_user_agent("Firefox")||(x.webgl2=!1);var _=H(e,x.webgl2);return!_&&x.webgl2&&(x.webgl2=!1,_=H(e,!1)),_?(v.log("%cINIT WEBGL "+(x.webgl2?"2":"1"),"color: #00a"),B=_,function(e,t,r){e.addEventListener("webglcontextlost",function(e){e.preventDefault(),v.error("WebGL context lost"),Q()},!1),u.setup_context(r);var _,n,a,o,E=u.get_renderer_info();E&&v.log("%cRENDERER INFO:","color: #00a",r.getParameter(E.UNMASKED_VENDOR_WEBGL)+", "+r.getParameter(E.UNMASKED_RENDERER_WEBGL)),N.setup_context(r),d.setup_context(r),I.setup_context(r),R.setup_context(r),i.setup_context(r),s.setup(r),l.setup_context(r),c.setup_canvas(e),i.init(e,t),g.setup_dim(e.width,e.height,1),h.init(),f.init(),_=60,n=0,a=x.fps_measurement_interval,o=x.fps_callback_interval,F=function(e){if(!(e<1/x.max_fps)){_=Cn(1/e,_,e,a);var t=O.get_fps();0==(n=(n+1)%o)&&D(Math.round(_),t)}},V()}(e,t,_),a.apply_quality(),o.set_hardware_defaults(_,!0),a.set_paths(),R.load_shaders(),x.ie11_edge_touchscreen_hack&&(e.style["touch-action"]="none"),v.log("%cSET PRECISION:","color: #00a",x.precision),_):null},t.set_fps_callback=function(e){D=e},t.clear_fps_callback=function(){D=function(){}},t.set_render_callback=function(e){!function(e){G=e}(e)},t.clear_render_callback=function(){G=function(){}},t.pause=Q,t.resume=function(){z()&&(U=performance.now()/1e3,h.resume(),O.resume(),I.play(!0),r.resume())},t.is_paused=z,t.reset=function(){c.unload(0),s.reset(),c.reset(),u.reset(),N.reset(),d.reset(),I.reset_mod(),R.reset(),l.reset(),i.reset(),c.reset(),i.reset(),b.reset(),h.reset(),y=0,w=0,U=0,D=function(){},F=function(){},G=function(){},C.length=0,B=null},t.canvas_data_url=function(e,t,r,_){S.canvas_data_url(e,t,r,_)},t.detect_mobile=function(){return o.detect_mobile()},t.append_loop_cb=function(e){for(var t=0;t<C.length;t++)if(C[t]==e)return;C.push(e)},t.remove_loop_cb=function(e){for(var t=0;t<C.length;t++)if(C[t]==e){C.splice(t,1);break}},t.get_renderer_info=function(){var e=u.get_renderer_info();return e?{vendor:B.getParameter(e.UNMASKED_VENDOR_WEBGL),renderer:B.getParameter(e.UNMASKED_RENDERER_WEBGL)}:null}}),pE=A("physics",function(e,t){var r=Ns(e),_=ga(e),n=vs(e);function a(e,t,r,_,n){return function(e,t,r,_){var n=be(r,t,Jr),a=be(_,r,Zr),o=be(t,_,$r),i=be(e,t,e_),s=be(e,r,t_),E=be(e,_,r_),c=Xe(n,a,__);if(Be(Xe(c,n,n_),i)>=0&&Be(Xe(c,a,n_),s)>=0&&Be(Xe(c,o,n_),E)>=0){var l=De(c),T=Be(c,i);return Math.abs(T/l)}var u=De(be(i,ye(n,Un(Be(n,i)/De(n),0,1),n_),n_)),d=De(be(s,ye(a,Un(Be(a,s)/De(a),0,1),n_),n_)),f=De(be(E,ye(o,Un(Be(o,E)/De(o),0,1),n_),n_));return Math.min(Math.min(u,d),f)}(e,_[r[0]],_[r[1]],_[r[2]])}function o(e,t,r,_,a){var o=Math.abs(e[2]-t[2]);return o<a&&n.is_vector_in_poly(e,r,_)?o:Number.MAX_VALUE}t.CM_WALK=0,t.CM_RUN=1,t.CM_CLIMB=2,t.CM_FLY=3,t.enable_simulation=function(e){r.obj_has_physics(e)?r.enable_simulation(e):_.error_once("No physics for object "+e.name)},t.disable_simulation=function(e){r.obj_has_physics(e)?r.disable_simulation(e):_.error_once("No physics for object "+e.name)},t.has_physics=function(e){return r.obj_has_physics(e)},t.has_simulated_physics=function(e){return r.has_simulated_physics(e)},t.has_dynamic_physics=function(e){return r.has_dynamic_physics(e)},t.set_gravity=function(e,t){_.error_deprecated("set_gravity","set_object_gravity"),r.obj_has_physics(e)?r.set_gravity(e,0,0,-t):_.error_once("No physics for object "+e.name)},t.set_object_gravity=function(e,t){r.obj_has_physics(e)?r.set_gravity(e,t[0],t[1],t[2]):_.error_once("No physics for object "+e.name)},t.set_transform=function(e,t,n){r.obj_has_physics(e)?r.set_transform(e,t,n):_.error_once("No physics for object "+e.name)},t.sync_transform=function(e){r.obj_has_physics(e)?r.sync_transform(e):_.error_once("No physics for object "+e.name)},t.apply_velocity=function(e,t,n,a){r.obj_has_physics(e)?r.apply_velocity(e,t,n,a):_.error_once("No physics for object "+e.name)},t.apply_velocity_world=function(e,t,n,a){r.obj_has_physics(e)?r.apply_velocity_world(e,t,n,a):_.error_once("No physics for object "+e.name)},t.apply_force=function(e,t,n,a){r.obj_has_physics(e)?r.apply_force(e,t,n,a,!1):_.error_once("No physics for object "+e.name)},t.apply_force_world=function(e,t,n,a){r.obj_has_physics(e)?r.apply_force(e,t,n,a,!0):_.error_once("No physics for object "+e.name)},t.apply_torque=function(e,t,n,a){r.obj_has_physics(e)?r.apply_torque(e,t,n,a):_.error_once("No physics for object "+e.name)},t.set_angular_velocity=function(e,t,n,a){r.obj_has_physics(e)?r.set_angular_velocity(e,t,n,a):_.error_once("No physics for object "+e.name)},t.vehicle_throttle=function(e,t){r.obj_has_physics(e)?(r.is_vehicle_chassis(e)||r.is_vehicle_hull(e)||_.error("Wrong object"),r.vehicle_throttle(e,Un(t,-1,1))):_.error_once("No physics for object "+e.name)},t.vehicle_throttle_inc=function(e,t,n){if(r.obj_has_physics(e)){r.is_vehicle_chassis(e)||r.is_vehicle_hull(e)||_.error("Wrong object"),t=Un(t,0,1);var a=e.vehicle.engine_force;-1==n||1==n?(a+=n*t,a=Math.max(-1,Math.min(a,1))):0==n&&a>=0?(a-=t,a=Math.max(0,a)):0==n&&a<0?(a+=t,a=Math.min(0,a)):_.error("Wrong steering direction"),r.vehicle_throttle(e,Un(a,-1,1))}else _.error_once("No physics for object "+e.name)},t.vehicle_steer=function(e,t){r.obj_has_physics(e)?(r.is_vehicle_chassis(e)||r.is_vehicle_hull(e)||_.error("Wrong object"),r.vehicle_steer(e,Un(t,-1,1))):_.error_once("No physics for object "+e.name)},t.vehicle_steer_inc=function(e,t,n){if(r.obj_has_physics(e)){r.is_vehicle_chassis(e)||r.is_vehicle_hull(e)||_.error("Wrong object"),t=Un(t,0,1);var a=e.vehicle.steering;-1==n||1==n?(a+=n*t,a=Math.max(-1,Math.min(a,1))):0==n&&a>=0?(a-=t,a=Math.max(0,a)):0==n&&a<0?(a+=t,a=Math.min(0,a)):_.error("Wrong steering direction"),r.vehicle_steer(e,Un(a,-1,1))}else _.error_once("No physics for object "+e.name)},t.vehicle_brake=function(e,t){r.obj_has_physics(e)?(r.is_vehicle_chassis(e)||r.is_vehicle_hull(e)||_.error("Wrong object"),r.vehicle_brake(e,Un(t,0,1))):_.error_once("No physics for object "+e.name)},t.vehicle_brake_inc=function(e,t){if(r.obj_has_physics(e)){r.is_vehicle_chassis(e)||r.is_vehicle_hull(e)||_.error("Wrong object"),t=Un(t,-1,1);var n=e.vehicle.brake_force;r.vehicle_brake(e,Un(n+=n*t,0,1))}else _.error_once("No physics for object "+e.name)},t.is_vehicle_chassis=function(e){return r.is_vehicle_chassis(e)},t.is_vehicle_hull=function(e){return r.is_vehicle_hull(e)},t.get_vehicle_name=function(e){return r.obj_has_physics(e)?r.is_vehicle_chassis(e)||r.is_vehicle_hull(e)?e.vehicle_settings.name:(_.error("Wrong object"),null):(_.error_once("No physics for object "+e.name),null)},t.get_vehicle_throttle=function(e){return r.obj_has_physics(e)?r.is_vehicle_chassis(e)||r.is_vehicle_hull(e)?e.vehicle.engine_force:(_.error("Wrong object"),null):(_.error_once("No physics for object "+e.name),null)},t.get_vehicle_steering=function(e){return r.obj_has_physics(e)?r.is_vehicle_chassis(e)||r.is_vehicle_hull(e)?e.vehicle.steering:(_.error("Wrong object"),0):(_.error_once("No physics for object "+e.name),0)},t.get_vehicle_brake=function(e){return r.obj_has_physics(e)?r.is_vehicle_chassis(e)||r.is_vehicle_hull(e)?e.vehicle.brake_force:(_.error("Wrong object"),0):(_.error_once("No physics for object "+e.name),0)},t.get_vehicle_speed=function(e){return r.obj_has_physics(e)?r.is_vehicle_chassis(e)||r.is_vehicle_hull(e)?r.get_vehicle_speed(e):(_.error("Wrong object"),0):(_.error_once("No physics for object "+e.name),0)},t.is_character=function(e){return r.has_character_physics(e)},t.set_character_move_dir=function(e,t,n){r.obj_has_physics(e)?r.set_character_move_dir(e,t,n):_.error_once("No physics for object "+e.name)},t.set_character_move_type=function(e,t){r.obj_has_physics(e)?r.set_character_move_type(e,t):_.error_once("No physics for object "+e.name)},t.set_character_walk_velocity=function(e,t){r.obj_has_physics(e)?r.set_character_walk_velocity(e,t):_.error_once("No physics for object "+e.name)},t.set_character_run_velocity=function(e,t){r.obj_has_physics(e)?r.set_character_run_velocity(e,t):_.error_once("No physics for object "+e.name)},t.set_character_fly_velocity=function(e,t){r.obj_has_physics(e)?r.set_character_fly_velocity(e,t):_.error_once("No physics for object "+e.name)},t.character_jump=function(e){r.obj_has_physics(e)?r.character_jump(e):_.error_once("No physics for object "+e.name)},t.character_rotation_inc=function(e,t,n){r.obj_has_physics(e)?r.character_rotation_inc(e,t,n):_.error_once("No physics for object "+e.name)},t.set_character_rotation=function(e,t,n){r.obj_has_physics(e)?r.set_character_rotation(e,t,n):_.error_once("No physics for object "+e.name)},t.set_character_rotation_v=function(e,t){r.obj_has_physics(e)?r.set_character_rotation_v(e,t):_.error_once("No physics for object "+e.name)},t.set_character_rotation_h=function(e,t){r.obj_has_physics(e)?r.set_character_rotation_h(e,t):_.error_once("No physics for object "+e.name)},t.set_character_vert_move_dir_angle=function(e,t){r.obj_has_physics(e)?r.set_character_vert_move_dir_angle(e,t):_.error_once("No physics for object "+e.name)},t.append_collision_test=function(e,t,n,a){r.obj_has_physics(e)?r.append_collision_test(e,t=t||"ANY",n,a=a||!1):_.error_once("No physics for object "+e.name)},t.remove_collision_test=function(e,t,n){r.obj_has_physics(e)?r.remove_collision_test(e,t=t||"ANY",n):_.error_once("No physics for object "+e.name)},t.apply_collision_impulse_test=function(e,t){r.obj_has_physics(e)?r.apply_collision_impulse_test(e,t):_.error_once("No physics for object "+e.name)},t.clear_collision_impulse_test=function(e){r.obj_has_physics(e)?r.clear_collision_impulse_test(e):_.error_once("No physics for object "+e.name)},t.append_ray_test=function(e,t,n,a,o,i){return null==(e=e||null)||r.obj_has_physics(e)?r.append_ray_test(e,t,n,a=a||"ANY",o,i=i||!1,!1,!1,!1):(_.error_once("No physics for object "+e.name),0)},t.append_ray_test_ext=function(e,t,n,a,o,i,s,E,c){return null==(e=e||null)||r.obj_has_physics(e)?r.append_ray_test(e,t,n,a=a||"ANY",o,i=i||!1,s=s||!1,E=E||!1,c=c||!1):(_.error_once("No physics for object "+e.name),0)},t.remove_ray_test=function(e){r.is_ray_test(e)?r.remove_ray_test(e):_.error("Wrong ray test ID")},t.change_ray_test_from_to=function(e,t,n){r.is_ray_test(e)?r.change_ray_test_from_to(e,t,n):_.error("Wrong ray test ID")},t.apply_constraint=function(e,t,n,a,o,i,s,E,c,l){r.obj_has_physics(t)&&r.obj_has_physics(o)?r.apply_constraint(e,t,n,a,o,i,s,E,c,l):_.error("Wrong objects")},t.clear_constraint=function(e){r.obj_has_physics(e)&&r.has_constraint(e)?r.clear_constraint(e):_.error("Wrong object")},t.pull_to_constraint_pivot=function(e,t,n,a,o,i){r.obj_has_physics(e)&&r.obj_has_physics(a)?r.pull_to_constraint_pivot(e,t,n,a,o,i):_.error("Wrong objects")},t.navmesh_get_island=function(e,t,o){if(o||(o=a),r.obj_has_physics(e)){var i=e.physics.navmesh;return i?n.navmesh_get_island(i,t,o):(_.error(e.name+" is not a navigation mesh object"),null)}_.error_once("No physics for object "+e.name)},t.navmesh_find_path=function(e,t,i,s){if(r.obj_has_physics(e)){var E=e.physics.navmesh;if(!E)return _.error(e.name+" is not a navigation mesh object"),null;s=s||{};var c={};return c.do_not_pull_string=Boolean(s.do_not_pull_string),c.distance_to_closest=s.distance_to_closest||a,c.distance_to_farthest=s.distance_to_farthest||o,c.island=s.island||0,c.allowed_distance=s.allowed_distance||Number.MAX_VALUE,c.return_normals=s.return_normals||!1,n.navmesh_find_path(E,t,i,c)}_.error_once("No physics for object "+e.name)},t.sync_bounding=function(e,t){t||(t=e.scenes_data[0].scene),r.scene_has_physics(t)&&r.sync_bounding(e,t)},t.sync_mesh=function(e,t){t||(t=e.scenes_data[0].scene),r.scene_has_physics(t)&&r.sync_mesh(e,t)}}),mE=A("screen",function(e,t){var r=oE(e),_=aE(e),n=Wo(e),a=us(e),o=ds(e),i=AE(e),s=os(e),E=ga(e),c=ps(e),l=tr(),T=tr(),u=!1,d=function(){},f=function(){},P=n.debug_subs;function A(e,t,r){function n(){document.fullscreenElement===e||document.webkitFullscreenElement===e||document.mozFullScreenElement===e||document.webkitIsFullScreen||document.msFullscreenElement===e?t():(document.removeEventListener("fullscreenchange",n,!1),document.removeEventListener("webkitfullscreenchange",n,!1),document.removeEventListener("mozfullscreenchange",n,!1),document.removeEventListener("MSFullscreenChange",n,!1),r())}e=e||_.get_container(),t=t||function(){},r=r||function(){},document.addEventListener("fullscreenchange",n,!1),document.addEventListener("webkitfullscreenchange",n,!1),document.addEventListener("mozfullscreenchange",n,!1),document.addEventListener("MSFullscreenChange",n,!1),e.requestFullScreen=e.requestFullScreen||e.webkitRequestFullScreen||e.mozRequestFullScreen||e.msRequestFullscreen,e.requestFullScreen?e.requestFullScreen():E.error("B4W App: request fullscreen method is not supported")}function S(){var e=document.exitFullscreen||document.webkitExitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen;"function"!=typeof e&&E.error("B4W App: exit fullscreen method is not supported"),e.apply(document)}function p(e){var t=o.get_device_by_type_element(o.DEVICE_HMD);if(!t)return!1;if(u)return!0;var n=o.get_value_param(t,o.HMD_WEBVR_TYPE);if(n&o.HMD_WEBVR1_1){var a=t.webvr_display,i=a.getEyeParameters("left"),E=a.getEyeParameters("right");_.resize(2*Math.max(i.renderWidth,E.renderWidth),Math.max(i.renderHeight,E.renderHeight),!1)}else{var d=_.get_canvas(),f=Math.max(2*d.height,d.width);_.resize(f,f/2,!1)}var A=o.get_vector_param(t,o.HMD_FOV_LEFT,l),S=o.get_vector_param(t,o.HMD_FOV_RIGHT,T);r.set_hmd_fov(e,A,S,!Boolean(n&o.HMD_WEBVR1_1));var p={base_line_factor:.5,inter_lens_factor:.5,enable_hmd_stereo:!0};n&(o.HMD_NON_WEBVR|o.HMD_WEBVR_MOBILE|o.HMD_WEBVR_DESKTOP)&&(p.distortion_coefs=[t.distortion_coefs[0],t.distortion_coefs[1]],p.chromatic_aberration_coefs=[t.chromatic_aberration_coefs[0],t.chromatic_aberration_coefs[1],t.chromatic_aberration_coefs[2],t.chromatic_aberration_coefs[3]],t.webvr_hmd_device||(t.base_line_dist&&t.height_dist&&t.bevel_size?p.base_line_factor=(t.base_line_dist-t.bevel_size)/t.height_dist:t.bevel_size||(p.base_line_factor=t.base_line_dist/t.height_dist)),t.inter_lens_dist&&t.width_dist&&!t.webvr_hmd_device&&(p.inter_lens_factor=t.inter_lens_dist/t.width_dist)),P.enabled||c.multiply_size_mult(.5,1),c.set_hmd_params(p);var m=o.get_value_param(t,o.HMD_EYE_DISTANCE);if(m){var O=c.get_active(),v=s.get_scene_data(e,O);r.set_eye_distance(v.cameras,m)}return c.render_both_eyes(),u=!0,!0}t.draw_mixer_strip=a.draw_mixer_strip,t.plot_array=a.plot_array,t.request_fullscreen=A,t.exit_fullscreen=S,t.check_fullscreen=o.check_fullscreen,t.request_fullscreen_hmd=function(e,t,r){if("HMD"!=!n.get("stereo")||"NONE"==n.get("stereo")&&n.get("is_mobile_device")){var a=o.get_device_by_type_element(o.DEVICE_HMD);if(a&&o.get_value_param(a,o.HMD_WEBVR_TYPE)&o.HMD_WEBVR1){var i=a.webvr_display;if(i&&!i.isPresenting)if(t=t||function(){},r=r||function(){},f=function(){i.isPresenting?t():(window.removeEventListener("vrdisplaypresentchange",f),r())},window.addEventListener("vrdisplaypresentchange",f,!1),i.capabilities.canPresent){var s=_.get_canvas();i.requestPresent([{source:s}]).then(function(){},function(){E.error("HMD fullscreen request failed.")})}else E.error("HMD fullscreen request failed.")}else A(e,t,r)}},t.exit_fullscreen_hmd=function(){if("HMD"!=!n.get("stereo")||"NONE"==n.get("stereo")&&n.get("is_mobile_device")){var e=o.get_device_by_type_element(o.DEVICE_HMD);if(e&&o.get_value_param(e,o.HMD_WEBVR_TYPE)&o.HMD_WEBVR1){var t=e.webvr_display;t&&t.isPresenting&&(t.exitPresent(),_.resize_to_container(!0))}else S()}},t.check_fullscreen_hmd=function(){var e=o.get_device_by_type_element(o.DEVICE_HMD),t=o.get_value_param(e,o.HMD_WEBVR_TYPE)&o.HMD_WEBVR1;return!(!e||!(t&&e.webvr_display||!t&&o.check_fullscreen()))},t.request_split_screen=function(e,t){var r=o.get_device_by_type_element(o.DEVICE_HMD);if(!r)return!1;if(u)return!0;if(d=t,c.check_active()){var _=c.get_camera(c.get_active());_&&(r.registered?(p(_),e&&e()):(o.request_register_device(r),r.registered_cb=function(){p(_),e&&e()}))}},t.exit_split_screen=function(){var e=o.get_device_by_type_element(o.DEVICE_HMD);return!!(u&&e&&e.registered)&&(c.set_hmd_params({enable_hmd_stereo:!1}),u=!1,d&&d(),c.render_one_eye(),P.enabled||c.multiply_size_mult(2,1),_.resize_to_container(!0),!0)},t.shot=function(e,t){i.canvas_data_url(function(t){var r="screenshot."+e.split("/")[1];if(navigator.msSaveOrOpenBlob)navigator.msSaveOrOpenBlob(t,r);else{var _=window.document.createElement("a");document.body.appendChild(_),_.style.display="none",_.href=t,_.download="screenshot."+e.split("/")[1],_.click(),document.body.removeChild(_)}},e=e||"image/png",t=t||1,!0)}}),OE=A("scenes",function(e,t){var r=Ks(e),_=oE(e),n=aE(e),a=nE(e),o=$o(e),i=Ms(e),s=os(e),E=ga(e),c=Ns(e),l=ps(e),T=ai(e);function u(){var e=n.get_canvas();return i.pick_object(e.clientWidth/2,e.clientHeight/2)}function d(e,t,_){var n=l.get_active(),a=e.draw_data[0].bundles[0],o=a.batch,i=t.draw_data[0].bundles[0],s=i.batch;if("quality"in _){var c=_.quality;8===c||16===c||24===c||32===c?(e.ssao_samples=c,r.set_batch_directive(o,"SSAO_QUALITY","SSAO_QUALITY_"+c),r.update_shader(o),T.append_draw_data(e,a)):E.error('set_ssao_params(): Wrong "quality" value.')}if("use_hemisphere"in _&&(e.ssao_hemisphere=_.use_hemisphere,r.set_batch_directive(o,"SSAO_HEMISPHERE",0|_.use_hemisphere),r.update_shader(o),T.append_draw_data(e,a)),"use_blur_depth"in _&&(t.ssao_blur_depth=_.use_blur_depth,r.set_batch_directive(s,"SSAO_BLUR_DEPTH",0|_.use_blur_depth),r.update_shader(s),T.append_draw_data(t,i),l.connect_render_targets_batch(n._render.graph,t,s,!1)),"ssao_white"in _&&(e.ssao_white=_.ssao_white,r.set_batch_directive(o,"SSAO_WHITE",0|_.ssao_white),r.update_shader(o),T.append_draw_data(e,a)),"blur_discard_value"in _&&(t.ssao_blur_discard_value=_.blur_discard_value),"radius_increase"in _&&(e.ssao_radius_increase=_.radius_increase),"influence"in _&&(e.ssao_influence=_.influence),"dist_factor"in _&&(e.ssao_dist_factor=_.dist_factor),"boolean"==typeof _.ssao_only){var u=l.get_subs(n,T.MAIN_OPAQUE);u.ssao_only=_.ssao_only;for(var d=u.draw_data,f=[],P=0;P<d.length;P++)for(var A=d[P].bundles,S=0;S<A.length;S++){var p=A[S].batch;r.set_batch_directive(p,"SSAO_ONLY",0|_.ssao_only),r.update_shader(p),f.push(A[S])}for(P=0;P<f.length;P++)T.append_draw_data(u,f[P])}e.need_perm_uniforms_update=!0,t.need_perm_uniforms_update=!0}function f(e){return s.is_dynamic_mesh(e)||s.is_empty(e)||s.is_line(e)||s.is_lamp(e)}t.DATA_ID_ALL=i.DATA_ID_ALL,t.set_active=function(e){var t=l.get_all_scenes();l.set_active(J_("name",e,t))},t.get_active=function(){return l.check_active()?l.get_active().name:""},t.get_scenes=function(){for(var e=l.get_all_scenes(),t=[],r=0;r<e.length;r++)t.push(e[r].name);return t},t.get_active_camera=function(){return l.check_active()?l.get_camera(l.get_active()):(E.error("No active scene"),!1)},t.get_object_by_name=function(e,t){var r=i.get_object(i.GET_OBJECT_BY_NAME,e,0|t,!0);if(r)return r;E.error("get object "+e+": not found")},t.get_object_by_dupli_name=function(e,t,r){var _=i.get_object(i.GET_OBJECT_BY_DUPLI_NAME,e,t,0|r);if(_)return _;E.error("get object "+t+": not found")},t.get_object_by_dupli_name_list=function(e,t){var r=i.get_object(i.GET_OBJECT_BY_DUPLI_NAME_LIST,e,0|t);if(r)return r;E.error("get object "+e+": not found")},t.get_world_by_name=function(e,t){var r=i.get_world_by_name(e,0|t);if(r)return r;E.error("get object "+e+": not found")},t.get_object_data_id=function(e){return s.get_object_data_id(e)},t.pick_object=function(e,t){var r=l.get_main();if(!r)return E.error("No active scene"),null;var _=l.get_subs(r,T.STEREO);return _&&_.enable_hmd_stereo?(E.error_once("pick_object() is not available in the stereo rendering mode. Use scenes.pick_center instead."),u()):i.pick_object(e,t)},t.pick_center=u,t.outlining_is_enabled=function(e){return e&&e.render&&e.render.outlining},t.set_outline_intensity=function(e,t){e&&e.render&&e.render.outlining?i.set_outline_intensity(e,t):E.error("set_outline_intensity(): wrong object")},t.get_outline_intensity=function(e){return e&&e.render&&e.render.outlining?e.render.outline_intensity:(E.error("get_outline_intensity(): wrong object"),0)},t.apply_outline_anim=function(e,t,r,_){e&&e.render&&e.render.outlining?i.apply_outline_anim(e,t,r,_):E.error("apply_outline_anim(): wrong object")},t.apply_outline_anim_def=function(e){if(e&&e.render&&e.render.outlining){var t=e.render.outline_anim_settings_default;i.apply_outline_anim(e,t.outline_duration,t.outline_period,t.outline_relapses)}else E.error("apply_outline_anim_def(): wrong object")},t.clear_outline_anim=function(e){e&&e.render&&e.render.outlining?i.clear_outline_anim(e):E.error("clear_outline_anim(): wrong object")},t.set_outline_color=l.set_outline_color,t.get_outline_color=function(e){var t=l.get_active(),r=l.get_subs(t,T.OUTLINE);if(r)return(e=e||new Float32Array(3)).set(r.outline_color),e},t.set_hmd_params=function(e){l.check_active()?e&&(!e.distortion_coefs||e.distortion_coefs instanceof Array||(e.distortion_coefs=null),!e.chromatic_aberration_coefs||e.chromatic_aberration_coefs instanceof Array||(e.chromatic_aberration_coefs=null),"number"!=typeof e.base_line_factor&&(e.base_line_factor=null),"number"!=typeof e.inter_lens_factor&&(e.inter_lens_factor=null),"boolean"!=typeof e.enable_hmd_stereo&&(e.enable_hmd_stereo=null),l.set_hmd_params(e)):E.error("No active scene")},t.get_shadow_params=function(){if(!l.check_active())return E.error("No active scene"),!1;var e=l.get_active(),t=l.get_subs(e,T.SHADOW_CAST);if(!t)return null;var r=e._render.shadow_params,_=l.get_subs(e,T.MAIN_OPAQUE),n=l.get_subs(e,T.SHADOW_RECEIVE),a={};return a.csm_resolution=r.csm_resolution,a.self_shadow_polygon_offset=t.self_shadow_polygon_offset,n&&(a.self_shadow_normal_offset=n.self_shadow_normal_offset),a.enable_csm=r.enable_csm,a.csm_num=r.csm_num,a.csm_first_cascade_border=r.csm_first_cascade_border,a.first_cascade_blur_radius=r.first_cascade_blur_radius,a.csm_last_cascade_border=r.csm_last_cascade_border,a.last_cascade_blur_radius=r.last_cascade_blur_radius,a.fade_last_cascade=r.fade_last_cascade,a.blend_between_cascades=r.blend_between_cascades,r.enable_csm?(a.csm_borders=l.get_csm_borders(e,_.camera),a.blur_radii=new Float32Array(r.csm_num),a.blur_radii.set(_.camera.pcf_blur_radii.subarray(0,r.csm_num))):(a.csm_borders=null,a.blur_radii=null),a},t.set_shadow_params=function(e){if(l.check_active()){var t=l.get_active();"number"==typeof e.self_shadow_polygon_offset&&o.traverse(t._render.graph,function(t,r){r.type==T.SHADOW_CAST&&(r.self_shadow_polygon_offset=e.self_shadow_polygon_offset)});for(var n=l.subs_array(t,[T.SHADOW_RECEIVE]),a=0;a<n.length;a++){var i=n[a];"number"==typeof e.self_shadow_normal_offset&&(i.self_shadow_normal_offset=e.self_shadow_normal_offset),"number"==typeof e.pcf_blur_radius&&(i.pcf_blur_radius=e.pcf_blur_radius)}var c=l.subs_array(t,[T.MAIN_BLEND]);for(a=0;a<c.length;a++){var u=c[a];"number"==typeof e.self_shadow_normal_offset&&(u.self_shadow_normal_offset=e.self_shadow_normal_offset),"number"==typeof e.pcf_blur_radius&&(u.pcf_blur_radius=e.pcf_blur_radius),u.need_perm_uniforms_update=!0}var d=t._render.shadow_params;if("number"==typeof e.csm_first_cascade_border&&(d.csm_first_cascade_border=e.csm_first_cascade_border),"number"==typeof e.first_cascade_blur_radius&&(d.first_cascade_blur_radius=e.first_cascade_blur_radius),"number"==typeof e.csm_last_cascade_border&&(d.csm_last_cascade_border=e.csm_last_cascade_border),"number"==typeof e.last_cascade_blur_radius&&(d.last_cascade_blur_radius=e.last_cascade_blur_radius),i){var f=i.draw_data;for(a=0;a<f.length;a++)for(var P=f[a].bundles,A=0;A<P.length;A++){var S=P[A];if(S.obj_render.shadow_receive){var p=S.batch;r.assign_shadow_receive_dirs(p,d),r.update_shader(p),T.append_draw_data(i,S)}}i.need_perm_uniforms_update=!0}var m=s.get_scene_data(t._camera,t).cameras;for(a=0;a<m.length;a++)_.update_camera_shadows(m[a],d);l.schedule_shadow_update(t)}else E.error("No active scene")},t.get_environment_colors=function(){if(!l.check_active())return E.error("No active scene"),[];var e=l.get_active();return l.get_environment_colors(e)},t.set_environment_colors=function(e,t,r){if(l.check_active()){var _=l.get_active(),n=l.get_subs(_,T.MAIN_OPAQUE),a=e||0==e?parseFloat(e):n.environment_energy;l.set_environment_colors(_,a,t||0==t?t:n.horizon_color,r||0==r?r:n.zenith_color)}else E.error("No active scene")},t.get_fog_color_density=function(e){if(!l.check_active())return E.error("No active scene"),!1;var t=l.get_active();return l.get_fog_color_density(t,e)},t.set_fog_color_density=function(e){if(l.check_active()){var t=l.get_active();l.set_fog_color_density(t,e)}else E.error("No active scene")},t.get_fog_params=function(){if(!l.check_active())return E.error("No active scene"),!1;var e=l.get_active(),t={};return t.fog_intensity=l.get_fog_intensity(e),t.fog_depth=l.get_fog_depth(e),t.fog_start=l.get_fog_start(e),t.fog_height=l.get_fog_height(e),t},t.set_fog_params=function(e){if(l.check_active()){var t=l.get_active();"number"==typeof e.fog_intensity&&l.set_fog_intensity(t,e.fog_intensity),"number"==typeof e.fog_depth&&l.set_fog_depth(t,e.fog_depth),"number"==typeof e.fog_start&&l.set_fog_start(t,e.fog_start),"number"==typeof e.fog_height&&l.set_fog_height(t,e.fog_height)}else E.error("No active scene")},t.get_ssao_params=function(){if(!l.check_active())return E.error("No active scene"),!1;var e=l.get_active();return l.get_ssao_params(e)},t.set_ssao_params=function(e){if(l.check_active()){var t=l.get_active(),r=l.subs_array(t,[T.SSAO]),_=l.subs_array(t,[T.SSAO_BLUR]);if(!r.length)return E.error("SSAO is not enabled on the scene"),0;for(var n=0;n<r.length;n++)d(r[n],_[n],e)}else E.error("No active scene")},t.get_color_correction_params=function(){if(!l.check_active())return E.error("No active scene"),null;var e=l.get_active(),t=l.get_subs(e,T.COMPOSITING);if(!t)return null;var r={};return r.brightness=t.brightness,r.contrast=t.contrast,r.exposure=t.exposure,r.saturation=t.saturation,r},t.set_color_correction_params=function(e){if(l.check_active()){var t=l.get_active(),r=l.get_subs(t,T.COMPOSITING);r&&("brightness"in e&&(r.brightness=e.brightness),"contrast"in e&&(r.contrast=e.contrast),"exposure"in e&&(r.exposure=e.exposure),"saturation"in e&&(r.saturation=e.saturation),r.need_perm_uniforms_update=!0)}else E.error("No active scene")},t.get_sky_params=function(){if(!l.check_active())return E.error("No active scene"),!1;var e=l.get_active();return l.get_sky_params(e)},t.set_sky_params=function(e){if(l.check_active()){var t=l.get_active(),r=l.get_subs(t,T.SKY);r&&("color"in e&&r.sky_color.set(e.color),"rayleigh_brightness"in e&&(r.rayleigh_brightness=e.rayleigh_brightness),"mie_brightness"in e&&(r.mie_brightness=e.mie_brightness),"spot_brightness"in e&&(r.spot_brightness=e.spot_brightness),"scatter_strength"in e&&(r.scatter_strength=e.scatter_strength),"rayleigh_strength"in e&&(r.rayleigh_strength=e.rayleigh_strength),"mie_strength"in e&&(r.mie_strength=e.mie_strength),"rayleigh_collection_power"in e&&(r.rayleigh_collection_power=e.rayleigh_collection_power),"mie_collection_power"in e&&(r.mie_collection_power=e.mie_collection_power),"mie_distribution"in e&&(r.mie_distribution=e.mie_distribution),r.need_perm_uniforms_update=!0,r.need_fog_update=!0,l.update_sky(t,r))}else E.error("No active scene")},t.get_dof_params=function(){if(!l.check_active())return E.error("No active scene"),!1;var e=l.get_active();return l.get_subs(e,T.DOF)?l.get_dof_params(e):null},t.set_dof_params=function(e){if(l.check_active()){var t=l.get_active();l.set_dof_params(t,e)}else E.error("No active scene")},t.get_god_rays_params=function(){if(!l.check_active())return E.error("No active scene"),!1;var e=l.get_active();return l.get_subs(e,T.GOD_RAYS)?l.get_god_rays_params(e):null},t.set_god_rays_params=function(e){if(l.check_active()){var t=l.get_active();l.set_god_rays_params(t,e)}else E.error("No active scene")},t.get_bloom_params=function(){if(!l.check_active())return E.error("No active scene"),!1;var e=l.get_active();return l.get_subs(e,T.BLOOM)?l.get_bloom_params(e):null},t.set_bloom_params=function(e){if(l.check_active()){var t=l.get_active();l.set_bloom_params(t,e)}else E.error("No active scene")},t.get_glow_material_params=function(){if(!l.check_active())return E.error("No active scene"),!1;var e=l.get_active();return l.get_subs(e,T.GLOW_COMBINE)?l.get_glow_material_params(e):null},t.set_glow_material_params=function(e){if(l.check_active()){var t=l.get_active();l.set_glow_material_params(t,e)}else E.error("No active scene")},t.get_wind_params=function(){if(!l.check_active())return E.error("No active scene"),!1;var e=l.get_active();return l.get_wind_params(e)},t.set_wind_params=function(e){if(l.check_active()){var t=l.get_active();i.set_wind_params(t,e)}else E.error("No active scene")},t.get_water_surface_level=function(e,t){if(!l.check_active())return E.error("No active scene"),0;var r=l.get_active();return r._render.water_params?l.get_water_surface_level(r,e,t):(E.error("No water parameters on the active scene"),0)},t.set_water_params=function(e){if(l.check_active()){var t=l.get_active();l.set_water_params(t,e)}else E.error("No active scene")},t.get_water_mat_params=function(e){if(l.check_active()){var t=l.get_active();l.get_water_mat_params(t,e)}else E.error("No active scene")},t.update_scene_materials_params=function(){if(l.check_active()){var e=l.get_active();l.update_scene_permanent_uniforms(e)}else E.error("No active scene")},t.hide_object=function(e,t){t=t||!1,f(e)?t?l.change_visibility(e,!0):l.change_visibility_rec(e,!0):E.error("show/hide is only supported for dynamic objects.")},t.show_object=function(e,t){t=t||!1,f(e)?t?l.change_visibility(e,!1):l.change_visibility_rec(e,!1):E.error("show/hide is only supported for dynamic objects.")},t.is_hidden=function(e){return f(e)?l.is_hidden(e):(E.error("show/hide is only supported for dynamic meshes/empties and lamps"),!1)},t.is_visible=function(e){return e.render.is_visible},t.check_object_by_name=function(e,t){return!!i.get_object(i.GET_OBJECT_BY_NAME,e,0|t,!0)},t.check_object_by_dupli_name=function(e,t,r){return!!i.get_object(i.GET_OBJECT_BY_DUPLI_NAME,e,t,0|r)},t.check_object_by_dupli_name_list=function(e,t){return!!i.get_object(i.GET_OBJECT_BY_DUPLI_NAME_LIST,e,0|t)},t.get_all_objects=function(e,t){var r=l.get_active();return e||(e="ALL"),t||0===t||(t=i.DATA_ID_ALL),i.get_scene_objs_derived(r,e,t)},t.get_object_name=function(e){return e?e.origin_name:(E.error("Wrong object name"),"")},t.get_object_name_hierarchy=function(e){if(!e)return E.error("Wrong object name"),null;for(var t=[],r=e;r;)t.push(r.origin_name),r=s.get_dg_parent(r);return t.reverse()},t.get_object_type=function(e){return e&&e.type?e.type:(E.error("Wrong object"),"UNDEFINED")},t.get_object_children=function(e){return e.cons_descends.slice(0)},t.get_first_character=function(){return i.get_first_character(l.get_active())},t.get_shore_dist=function(e,t){if(t||0===t||(t=1),!l.check_active())return E.error("No active scene"),0;var r=l.get_active();return l.get_shore_dist(r,e,t)},t.get_cam_water_depth=function(){return l.get_cam_water_depth()},t.get_type_mesh_object=function(e){return s.is_mesh(e)?e.render.type:""},t.get_meta_tags=function(){if(!l.check_active())return E.error("No active scene"),!1;var e=l.get_active();return l.get_meta_tags(e)},t.get_custom_prop=function(){if(!l.check_active())return E.error("No active scene"),!1;var e=l.get_active();return l.get_custom_prop(e)},t.append_object=function(e,t){if(t)var r=J_("name",t,l.get_all_scenes());else r=l.get_active();l.append_object(r,e,!0),c.append_object(e,r)},t.remove_object=function(e){s.is_dynamic_mesh(e)||s.is_empty(e)||s.is_line(e)?(i.obj_switch_cleanup_flags(e,e.render.is_copied_deep,!1,!1),a.prepare_object_unloading(e),i.obj_switch_cleanup_flags(e,!0,!0,!0),i.remove_object(e)):E.error("Can't remove object \""+e.name+'". It must be dynamic and type of MESH or EMPTY.')},t.marker_frame=function(e){var t=l.get_active();return t.timeline_markers&&e in t.timeline_markers?l.marker_frame(t,e):(E.error('"'+e+'" marker not found.'),0)},t.get_mb_params=function(){var e=l.get_active(),t=l.get_subs(e,T.MOTION_BLUR);return t?{mb_factor:t.mb_factor,mb_decay_threshold:t.mb_decay_threshold}:null},t.set_mb_params=function(e){var t=l.get_active(),r=l.subs_array(t,[T.MOTION_BLUR]);if(r.length)for(var _=0;_<r.length;_++){var n=r[_];"number"==typeof e.mb_decay_threshold&&(n.mb_decay_threshold=e.mb_decay_threshold),"number"==typeof e.mb_factor&&(n.mb_factor=e.mb_factor)}else E.error("The motion blur subscene doesn't exist.")},t.can_select_objects=function(){var e=l.get_active();return Boolean(l.get_subs(e,T.COLOR_PICKING))}}),vE=A("transform",function(e,t){var r=os(e),_=Ns(e),n=ga(e),a=Os(e),o=ba(),i=new Float32Array(3),s=new Float32Array(4);t.set_translation=function(e,t,o,s){r.is_dynamic(e)?(i[0]=t,i[1]=o,i[2]=s,a.set_translation(e,i),a.update_transform(e),_.sync_transform(e)):n.error('Wrong object: "'+e.name+'" is not dynamic.')},t.set_translation_rel=function(e,t,o,s){r.is_dynamic(e)?(i[0]=t,i[1]=o,i[2]=s,a.set_translation_rel(e,i),a.update_transform(e),_.sync_transform(e)):n.error('Wrong object: "'+e.name+'" is not dynamic.')},t.set_translation_v=function(e,t){r.is_dynamic(e)?(a.set_translation(e,t),a.update_transform(e),_.sync_transform(e)):n.error('Wrong object: "'+e.name+'" is not dynamic.')},t.set_translation_rel_v=function(e,t){r.is_dynamic(e)?(a.set_translation_rel(e,t),a.update_transform(e),_.sync_transform(e)):n.error('Wrong object: "'+e.name+'" is not dynamic.')},t.set_translation_obj_rel=function(e,t,o,s,E){if(r.is_dynamic(e)){i[0]=t,i[1]=o,i[2]=s;var c=Fa(E.render.world_tsr),l=Ba(E.render.world_tsr);!function(e,t,r,_,n){n||(n=new Float32Array(3)),je(e,Ee(r,_,c_),n)}(i,0,l,c,i),a.set_translation(e,i),a.update_transform(e),_.sync_transform(e)}else n.error('Wrong object: "'+e.name+'" is not dynamic.')},t.get_translation=function(e,t){return t||(t=new Float32Array(3)),a.get_translation(e,t),t},t.get_translation_rel=function(e,t){return t||(t=new Float32Array(3)),a.get_translation_rel(e,t),t},t.set_rotation=function(e,t,o,i,E){r.is_dynamic(e)?(s[0]=t,s[1]=o,s[2]=i,s[3]=E,a.set_rotation(e,s),a.update_transform(e),_.sync_transform(e)):n.error('Wrong object: "'+e.name+'" is not dynamic.')},t.set_rotation_rel=function(e,t,o,i,E){r.is_dynamic(e)?(s[0]=t,s[1]=o,s[2]=i,s[3]=E,a.set_rotation_rel(e,s),a.update_transform(e),_.sync_transform(e)):n.error('Wrong object: "'+e.name+'" is not dynamic.')},t.set_rotation_v=function(e,t){r.is_dynamic(e)?(a.set_rotation(e,t),a.update_transform(e),_.sync_transform(e)):n.error('Wrong object: "'+e.name+'" is not dynamic.')},t.set_rotation_rel_v=function(e,t){r.is_dynamic(e)?(a.set_rotation_rel(e,t),a.update_transform(e),_.sync_transform(e)):n.error('Wrong object: "'+e.name+'" is not dynamic.')},t.get_rotation_rel_v=function(e,t){if(r.is_dynamic(e))return a.get_rotation_rel(e,t),t;n.error('Wrong object: "'+e.name+'" is not dynamic.')},t.get_rotation=function(e,t){return t||(t=new Float32Array(4)),a.get_rotation(e,t),t},t.get_rotation_rel=function(e,t){return t||(t=new Float32Array(4)),a.get_rotation_rel(e,t),t},t.set_rotation_euler=function(e,t,o,s){r.is_dynamic(e)?(i[0]=t,i[1]=o,i[2]=s,a.set_rotation_euler(e,i),a.update_transform(e),_.sync_transform(e)):n.error('Wrong object: "'+e.name+'" is not dynamic.')},t.get_rotation_euler=function(e,t){return t||(t=new Float32Array(3)),a.get_rotation_euler(e,t),t},t.get_rotation_euler_rel=function(e,t){return t||(t=new Float32Array(3)),a.get_rotation_euler_rel(e,t),t},t.set_rotation_euler_rel=function(e,t,o,s){r.is_dynamic(e)?(i[0]=t,i[1]=o,i[2]=s,a.set_rotation_euler_rel(e,i),a.update_transform(e),_.sync_transform(e)):n.error('Wrong object: "'+e.name+'" is not dynamic.')},t.set_rotation_euler_v=function(e,t){r.is_dynamic(e)?(a.set_rotation_euler(e,t),a.update_transform(e),_.sync_transform(e)):n.error('Wrong object: "'+e.name+'" is not dynamic.')},t.set_rotation_euler_rel_v=function(e,t){r.is_dynamic(e)?(a.set_rotation_euler_rel(e,t),a.update_transform(e),_.sync_transform(e)):n.error('Wrong object: "'+e.name+'" is not dynamic.')},t.set_scale=function(e,t){r.is_dynamic(e)?(a.set_scale(e,t),a.update_transform(e)):n.error('Wrong object: "'+e.name+'" is not dynamic.')},t.set_scale_rel=function(e,t){r.is_dynamic(e)?(a.set_scale_rel(e,t),a.update_transform(e)):n.error('Wrong object: "'+e.name+'" is not dynamic.')},t.get_scale=function(e){return a.get_scale(e)},t.get_scale_rel=function(e){return a.get_scale_rel(e)},t.empty_reset_transform=function(e){if("EMPTY"==e.type){for(var t=0;t<e.cons_descends.length;t++)if(!r.is_dynamic(e.cons_descends[t]))return void n.error('Wrong object: "'+e.cons_descends[t].name+'" is not dynamic.');a.set_translation(e,[0,0,0]),a.set_rotation(e,[0,0,0,1]),a.set_scale(e,1),a.update_transform(e),_.sync_transform(e)}else n.error("Wrong object: "+e.name)},t.get_object_size=function(e){return r.is_mesh(e)?a.get_object_size(e):(n.error("Wrong object: "+e.name),0)},t.get_object_center=function(e,t,_){return r.is_mesh(e)?(_||(_=new Float32Array(3)),a.get_object_center(e,t,_)):(n.error("Wrong object: "+e.name),null)},t.move_local=function(e,t,o,i){r.is_dynamic(e)?(a.move_local(e,t,o,i),a.update_transform(e),_.sync_transform(e)):n.error('Wrong object: "'+e.name+'" is not dynamic.')},t.rotate_x_local=function(e,t){if(r.is_dynamic(e)){var o=Dr(P_,t,s);a.rotate_local(e,o),a.update_transform(e),_.sync_transform(e)}else n.error('Wrong object: "'+e.name+'" is not dynamic.')},t.rotate_y_local=function(e,t){if(r.is_dynamic(e)){var o=Dr(m_,t,s);a.rotate_local(e,o),a.update_transform(e),_.sync_transform(e)}else n.error('Wrong object: "'+e.name+'" is not dynamic.')},t.rotate_z_local=function(e,t){if(r.is_dynamic(e)){var o=Dr(S_,t,s);a.rotate_local(e,o),a.update_transform(e),_.sync_transform(e)}else n.error('Wrong object: "'+e.name+'" is not dynamic.')},t.get_object_bounding_box=function(e){return mo(e.render.bb_world)},t.set_tsr=function(e,t){r.is_dynamic(e)?(a.set_tsr(e,t),a.update_transform(e),_.sync_transform(e)):n.error('Wrong object: "'+e.name+'" is not dynamic.')},t.set_tsr_rel=function(e,t){r.is_dynamic(e)?(a.set_tsr_rel(e,t),a.update_transform(e),_.sync_transform(e)):n.error('Wrong object: "'+e.name+'" is not dynamic.')},t.get_tsr=function(e,t){return t||(t=new Float32Array(8)),a.get_tsr(e,t),t},t.get_tsr_rel=function(e,t){return t||(t=new Float32Array(8)),a.get_tsr_rel(e,t),t},t.distance=function(e,t){return a.distance(e,t)},t.set_matrix=function(e,t){r.is_dynamic(e)?(za(t,o),a.set_tsr(e,o),a.update_transform(e),_.sync_transform(e)):n.error('Wrong object: "'+e.name+'" is not dynamic.')},t.set_matrix_rel=function(e,t){r.is_dynamic(e)?(za(t,o),a.set_tsr_rel(e,o),a.update_transform(e),_.sync_transform(e)):n.error('Wrong object: "'+e.name+'" is not dynamic.')},t.get_matrix=function(e,t){return t||(t=new Float32Array(16)),a.get_tsr(e,o),Qa(o,t),t},t.get_matrix_rel=function(e,t){return t||(t=new Float32Array(16)),a.get_tsr_rel(e,o),Qa(o,t),t}}),NE=A("util",function(e,t){var r=ha(e),_=Us(e),n=Jo(e),a=ga(e);t.AXIS_X=new Float32Array([1,0,0]),t.AXIS_Y=new Float32Array([0,1,0]),t.AXIS_Z=new Float32Array([0,0,1]),t.AXIS_MX=new Float32Array([-1,0,0]),t.AXIS_MY=new Float32Array([0,-1,0]),t.AXIS_MZ=new Float32Array([0,0,-1]),t.XYX=v_,t.YZY=N_,t.ZXZ=g_,t.XZX=h_,t.YXY=R_,t.ZYZ=I_,t.XYZ=b_,t.YZX=Y_,t.ZXY=L_,t.XZY=M_,t.YXZ=x_,t.ZYX=y_,t.f32=function(e){return j_(e=e||0)},t.assert=r.assert,t.keyfind=V_,t.keysearch=J_,t.matrix_to_quat=function(e){return un(e)},t.euler_to_quat=function(e,t){return t||(t=new Float32Array(4)),rn(e,t)},t.ordered_angles_to_quat=function(e,t,r){return r||(r=Yr()),_n(e,t,r)},t.quat_to_ordered_angles=function(e,t,r){return r||(r=ve()),nn(e,t,r)},t.quat_to_euler=function(e,t){return t||(t=new Float32Array(3)),on(e,t)},t.sign=W_,t.clamp=Un,t.quat_to_dir=sn,t.ground_project_cam_quat=function(e,t){return wn(e,O_,S_,A_,t)},t.cam_quat_to_mesh_quat=function(e,t){return function(e,t){var r;return t||(t=new Float32Array(4)),Fr(r=Dr([0,0,1],Math.PI,Yr()),Dr([1,0,0],Math.PI/2,Yr()),r),Fr(e,r,t),t}(e,t)},t.quat_project=function(e,t,r,_,n){return 0!=Be(r,_)?(a.error("Wrong in-plane direction"),null):wn(e,t,r,_,n)},t.hash_code=function(){return n.hash_code.apply(n,arguments)},t.smooth=Cn,t.smooth_v=Dn,t.is_vector=kn,t.correct_cam_quat_up=Kn,t.quat_to_angle_axis=Nn,t.random_from_array=jn,t.horizontal_direction=qn,t.angle_wrap_0_2pi=Jn,t.angle_wrap_periodic=Wn,t.smooth_step=aa,t.lerp=oa,t.deg_to_rad=In,t.rad_to_deg=bn,t.dir_to_quat=En,t.is_ie11=_.is_ie11,t.gen_tbn_quats=function(e,t){return a.error_once("util.gen_tbn_quats() deprecated. Do not use it anymore."),Ai(e,t)},t.trunc=Rn}),gE=A("app",function(e,t){var r=iE(e),_=EE(e),n=cE(e),a=lE(e),o=TE(e),i=uE(e),s=fE(e),E=PE(e),c=SE(e),l=pE(e),T=ga(e),u=mE(e),d=OE(e),f=vE(e),P=NE(e),A=1,S=.15,p=5,m=2,O=1,v=1,N=.08,g=.12,h=.001,R=null,I=!1,b=!1,Y=!1,L=null,M=!1,x=!1,y=new Float32Array(2),w=new Float32Array(2),U=new Float32Array(3),C=new Float32Array(3),D=new Float32Array(4),F={},G={};function k(e,t){var r=String(e);t&&(r+="/"+String(t)),R.innerHTML=r}function K(e){var t=document.getElementById(e),r=t.cloneNode(!0);return t.parentNode.replaceChild(r,t),r}function B(e,t,_){var n=Math.max(r.hover_get_distance(e),O),a=f.get_rotation(e,D),o=P.quat_to_dir(a,t,U);o[2]=0,Ke(o,o),ye(o,n*_,o);var i=f.get_translation(e,C);Ie(i,o,i),r.set_translation(e,i)}function X(e,t){var _=r.hover_get_vertical_limits(e,G);if(_.up!=_.down){var n=r.get_camera_angles(e,w)[1],a=(_.down-n)/(_.down-_.up),o=r.hover_get_distance_limits(e,G);a=Math.max(a,m/o.max),r.rotate_camera(e,0,a*t)}}function H(e,t,r,_){f.move_local(e,t*=p,r*=p,_*=p)}function Q(e){return e/(1-e)}function z(e,t,_){var n=r.target_get_distance(e),a=Math.abs(t),o=Math.pow(a*_,A-Math.pow(a*_,S));t=t<0?n>h?-n*o:0:n*Q(o),f.move_local(e,0,0,t)}function V(e,t,r,_,n){for(var a=_*r,o=t;o>0;--o)n+=a,a=(_+=a)*r;return n}function j(e,t,_,n,a,o){if(o){var i=Ue(r.target_get_pivot(e,U),r.get_translation(e))+n;n=t>0?V(0,t,-_,i,n):V(0,-t,Q(_),i,n)}else n-=t*a*_;return n}function q(){var e=d.get_active_camera();o.check_sensor_manifold(e,"TOGGLE_CHAR_MOVE_TYPE")&&d.get_first_character()&&n.remove(e);for(var t=["FORWARD","BACKWARD","ROT_UP","ROT_DOWN","ROT_LEFT","ROT_RIGHT","UP","DOWN","LEFT","RIGHT","MOUSE_WHEEL","TOUCH_ZOOM","ZOOM_INTERPOL","MOUSE_X","MOUSE_Y","TOUCH_X","TOUCH_Y","ROT_TRANS_INTERPOL","CHANGE_MOVE_STYLE","TOGGLE_CHAR_MOVE_TYPE"],r=0;r<t.length;r++)o.remove_sensor_manifold(e,t[r])}function W(e,t,r,_){var n=document.createElement("div"),a=document.createElement("div"),o=document.createElement("div");if(_)for(var i=0;i<_.length;i++){var s=document.getElementById(_[i]);s&&s.parentNode.removeChild(s)}n.style.cssText="z-index:10;width:100%;height:auto;position:absolute;top:50%;margin-top:150px;text-align:center;",a.style.cssText="color:#fff;font-size:24px;",o.style.cssText="color:#fff;font-size:20px;",a.innerHTML=e,o.innerHTML=t+'   <a style="color:#fff;font-size:20px;width:100%;" href="'+r+'">'+r.replace("https://www.","")+"</a>",n.appendChild(a),n.appendChild(o),document.body.appendChild(n)}function J(e,t,r,_,n){var a=performance.now();c.append_loop_cb(function o(){var i=performance.now()-a;n(t+i*(r-t)/_),(i>=_||!e.parentNode)&&c.remove_loop_cb(o)})}function Z(){return N*v}function $(){return g*v}t.init=function(e){e=e||{};var t=!1,r=null,n=function(){},E=null,l=null,u=0,d=null,f=!0,P=!1,A=!0,S=!0,p=!1,m=!1,O=!1,v=!1,N=_.get("quality");for(var g in e)switch(g){case"canvas_container_id":r=e.canvas_container_id;break;case"callback":n=e.callback;break;case"autoresize":t=e.autoresize;break;case"show_hud_debug_info":O=e.show_hud_debug_info;break;case"sfx_mix_mode":p=e.sfx_mix_mode;break;case"show_fps":m=e.show_fps;break;case"track_container_position":v=e.track_container_position,T.error_once("track_container_position deprecated. Not needed anymore. Use the container.get_coords_target_space method.");break;case"fps_wrapper_id":d=e.fps_wrapper_id;break;case"fps_elem_id":l=e.fps_elem_id;break;case"error_purge_elements":E=e.error_purge_elements;break;case"report_init_failure":S=e.report_init_failure;break;case"pause_invisible":A=e.pause_invisible;break;case"key_pause_enabled":f=e.key_pause_enabled;break;case"force_container_ratio":u=e.force_container_ratio;break;case"min_capabilities":P=e.min_capabilities;break;case"quality":N=e.quality;break;default:_.set(g,e[g])}N!=_.P_AUTO&&_.set("quality",N),f&&document.addEventListener("keydown",function(e){e.keyCode==o.KEY_P&&(c.is_paused()?c.resume():c.pause())},!1),_.set("show_hud_debug_info",O),_.set("sfx_mix_mode",p);var h=O||p||null,I=function(){var e=function(e,t,r,_){var n=document.createElement("canvas"),o=document.getElementById(e);if(o||(T.error('Warning: canvas container "'+e+'" not found, appending to body'),o=document.body),n.style.position="absolute",n.style.left=0,n.style.top=0,n.style.width=o.offsetWidth+"px",n.style.height=o.offsetHeight+"px",n.width=o.offsetWidth*window.devicePixelRatio,n.height=o.offsetHeight*window.devicePixelRatio,t)(i=document.createElement("canvas")).style.position="absolute",n.style.left=0,n.style.top=0,i.style.pointerEvents="none";else var i=null;return o.appendChild(n),c.init(n,i)?(i&&a.insert_to_container(i,"LAST"),!0):(r&&W("Browser could not initialize WebGL","For more info visit","https://www.blend4web.com/doc/en/problems_and_solutions.html#problems-upon-startup",_),!1)}(r,h,S,E),o=a.get_canvas();if(e){var i,f=a.get_container();a.resize_to_container(),m&&(function(e,t){e?(t&&(document.getElementById(t).style.display="block"),R=document.getElementById(e)):((R=document.createElement("div")).innerHTML=0,R.style.cssText="position:absolute;font-family: Arial, sans-serif;top: 20px;right: 20px;text-shadow: 0px 0px 6px #000;font-size: 40px;line-height: 50px;font-weight: bold;color: #fff;",a.insert_to_container(R,"JUST_AFTER_CANVAS"))}(l,d),c.set_fps_callback(k)),A&&(i=c.is_paused(),document.addEventListener("visibilitychange",function(){document.hidden?(i=c.is_paused(),c.pause()):i||c.resume()},!1),function(){var e=0,t=a.get_container(),r=c.is_paused(),_=!0;c.append_loop_cb(function(){if(e%10==0){var n=t.getBoundingClientRect();n.top>window.innerHeight||n.bottom<0?(_&&(r=c.is_paused()),c.pause(),_=!1):r||_||(c.resume(),_=!0)}e++})}()),u&&c.append_loop_cb(function(){f.style.height=f.clientWidth/u+"px"}),t&&c.append_loop_cb(function(){a.resize_to_container()}),v&&c.append_loop_cb(function(){a.force_offsets_updating()}),P&&_.reset_limits(),N==_.P_AUTO?s.test_performance(function(e,t){0==e?(T.log("QUALITY TEST RESULT: UNSUPPORTED, using HIGH"),_.apply_quality(_.P_HIGH)):t<1.5?(T.log("QUALITY TEST RESULT: LOW ("+t.toFixed(1)+" GB/s)"),_.apply_quality(_.P_LOW)):(T.log("QUALITY TEST RESULT: HIGH ("+t.toFixed(1)+" GB/s)"),_.apply_quality(_.P_HIGH)),n(o,!0)}):n(o,!0)}else n(o,!1)};"complete"==document.readyState?window.setTimeout(I,0):window.addEventListener("load",I,!1),window.addEventListener("unload",function(){i.cleanup()},!1)},t.set_onclick=function(e,t){var r=K(e);r.addEventListener("mouseup",function(e){t(r.value)},!1)},t.set_onchange=function(e,t){var r=K(e);r.addEventListener("change",function(e){var _=r.checked;t(void 0!=_?_:r.value)},!1)},t.set_onkeypress=function(e,t){var r=K(e);r.addEventListener("keypress",function(e){t(e.keyCode,r.value)},!1)},t.enable_camera_controls=function e(t,_,a,i,s,c){I=t,b=_,Y=a,L=i,M=s,x=c;var T,u,A,S=d.get_active_camera();u=r.get_move_style(T=S),A=o.create_callback_sensor(function(){var e=r.get_move_style(T),t=e!=u;return u=e,t}),o.create_sensor_manifold(T,"CHANGE_MOVE_STYLE",o.CT_POSITIVE,[A],null,function(t,r,_){q(),e(I,b,Y,L,M,x)});var p=!1,m=null,O=!1;switch(r.get_move_style(S)){case r.MS_TARGET_CONTROLS:p=!t;break;case r.MS_EYE_CONTROLS:m=d.get_first_character();break;case r.MS_STATIC:return;case r.MS_HOVER_CONTROLS:O=!0}var N=r.get_velocities(S,F),g=o.create_elapsed_sensor();if(l.has_simulated_physics(S)){var R=o.create_collision_sensor(S,null,!0);o.create_sensor_manifold(S,"CAMERA_COLLISION",o.CT_POSITIVE,[R],null,function(e,t,r){var _=o.get_sensor_payload(e,t,0).coll_dist;if(_<0){var n=o.get_sensor_payload(e,t,0).coll_norm,a=U;ye(n,-.25*_,a);var i=f.get_translation(e,C);Ie(i,a,i),f.set_translation_v(e,i)}})}if(m){var D=f.get_translation(S),G=f.get_rotation(S),k=P.cam_quat_to_mesh_quat(G);D[2]-=.5,l.set_transform(m,D,k),n.append_stiff_trans(S,m,[0,0,.5]);var K=new Float32Array(2),Q=!0;l.set_character_move_type(m,l.CM_FLY),o.create_kb_sensor_manifold(S,"TOGGLE_CHAR_MOVE_TYPE",o.CT_SHOT,o.KEY_C,function(){l.set_character_move_type(m,(Q=!Q)?l.CM_FLY:l.CM_WALK)})}var V,W,J,ee,te,re,_e,ne,ae,oe,ie,se,Ee=function(e,t,_){if(1==_){var n=o.get_sensor_value(e,t,0);switch(r.get_velocities(e,N),t){case"FORWARD":if(m)K[0]=1;else if(O){var a=r.get_camera_angles(e,w)[1];B(e,Math.abs(a)>=Math.PI/4?P.AXIS_Y:P.AXIS_MZ,.5*N.trans*n)}else p?z(e,-N.zoom,n):H(e,0,0,-N.trans*n);break;case"BACKWARD":m?K[0]=-1:O?(a=r.get_camera_angles(e,w)[1],B(e,Math.abs(a)>=Math.PI/4?P.AXIS_MY:P.AXIS_Z,.5*N.trans*n)):p?z(e,N.zoom,n):H(e,0,0,N.trans*n);break;case"UP":O?X(e,30*-N.zoom*n):m||H(e,0,N.trans*n,0);break;case"DOWN":O?X(e,30*N.zoom*n):m||H(e,0,-N.trans*n,0);break;case"LEFT":m?K[1]=1:O?B(e,P.AXIS_MX,.5*N.trans*n):H(e,-N.trans*n,0,0);break;case"RIGHT":m?K[1]=-1:O?B(e,P.AXIS_X,.5*N.trans*n):H(e,N.trans*n,0,0);break;case"ROT_LEFT":r.rotate_camera(e,p?.75*-N.rot*n:.75*N.rot*n,0);break;case"ROT_RIGHT":r.rotate_camera(e,p?.75*N.rot*n:.75*-N.rot*n,0);break;case"ROT_UP":r.rotate_camera(e,0,p?.75*-N.rot*n:.75*N.rot*n);break;case"ROT_DOWN":r.rotate_camera(e,0,p?.75*N.rot*n:.75*-N.rot*n)}}else switch(t){case"FORWARD":case"BACKWARD":m&&(K[0]=0);break;case"LEFT":case"RIGHT":m&&(K[1]=0)}if(m){l.set_character_move_dir(m,K[0],K[1]);var i=r.get_camera_angles_char(e,y);l.set_character_rotation_h(m,i[0]),l.set_character_vert_move_dir_angle(m,i[1])}};if(c)_e=ne=ae=oe=ie=se=o.create_custom_sensor(0);else{var ce=E.check_enable_gamepad_indices();if(ce.length)var le=ce[ce.length-1];else le=0;_e=o.create_gamepad_btn_sensor(E.GMPD_BUTTON_6,le),ne=o.create_gamepad_btn_sensor(E.GMPD_BUTTON_7,le),ae=o.create_gamepad_axis_sensor(E.GMPD_AXIS_0,ce),oe=o.create_gamepad_axis_sensor(E.GMPD_AXIS_1,ce),ie=o.create_gamepad_axis_sensor(E.GMPD_AXIS_2,ce),se=o.create_gamepad_axis_sensor(E.GMPD_AXIS_3,ce)}_?V=W=J=ee=te=re=o.create_custom_sensor(0):(V=o.create_keyboard_sensor(o.KEY_W),W=o.create_keyboard_sensor(o.KEY_S),J=o.create_keyboard_sensor(o.KEY_A),ee=o.create_keyboard_sensor(o.KEY_D),te=o.create_keyboard_sensor(o.KEY_R),re=o.create_keyboard_sensor(o.KEY_F));var Te=o.create_keyboard_sensor(o.KEY_UP),ue=o.create_keyboard_sensor(o.KEY_DOWN),de=o.create_keyboard_sensor(o.KEY_LEFT),fe=o.create_keyboard_sensor(o.KEY_RIGHT),Pe=function(e){return e[0]&&(e[1]||e[2]||e[3])},Ae=function(e){return e[0]&&(e[1]||e[2]>.1)},Se=function(e){return e[0]&&(e[1]||e[2]<-.1)},pe=function(e){return e[0]&&(e[1]||e[2]||e[3]>.1)},me=function(e){return e[0]&&(e[1]||e[2]||e[3]<-.1)};if(O||(o.create_sensor_manifold(S,"FORWARD",o.CT_CONTINUOUS,[g,V,oe],Se,Ee),o.create_sensor_manifold(S,"BACKWARD",o.CT_CONTINUOUS,[g,W,oe],Ae,Ee)),p?(o.create_sensor_manifold(S,"ROT_UP",o.CT_CONTINUOUS,[g,Te,te,se],me,Ee),o.create_sensor_manifold(S,"ROT_DOWN",o.CT_CONTINUOUS,[g,ue,re,se],pe,Ee),o.create_sensor_manifold(S,"ROT_LEFT",o.CT_CONTINUOUS,[g,de,J,ie],me,Ee),o.create_sensor_manifold(S,"ROT_RIGHT",o.CT_CONTINUOUS,[g,fe,ee,ie],pe,Ee)):O?(o.create_sensor_manifold(S,"LEFT",o.CT_CONTINUOUS,[g,de,J,ae],me,Ee),o.create_sensor_manifold(S,"RIGHT",o.CT_CONTINUOUS,[g,fe,ee,ae],pe,Ee),o.create_sensor_manifold(S,"FORWARD",o.CT_CONTINUOUS,[g,Te,V,oe],me,Ee),o.create_sensor_manifold(S,"BACKWARD",o.CT_CONTINUOUS,[g,ue,W,oe],pe,Ee),o.create_sensor_manifold(S,"UP",o.CT_CONTINUOUS,[g,re,se],Ae,Ee),o.create_sensor_manifold(S,"DOWN",o.CT_CONTINUOUS,[g,te,se],Se,Ee)):(o.create_sensor_manifold(S,"UP",o.CT_CONTINUOUS,[g,te,_e],Pe,Ee),o.create_sensor_manifold(S,"DOWN",o.CT_CONTINUOUS,[g,re,ne],Pe,Ee),o.create_sensor_manifold(S,"LEFT",o.CT_CONTINUOUS,[g,J,ae],Se,Ee),o.create_sensor_manifold(S,"RIGHT",o.CT_CONTINUOUS,[g,ee,ae],Ae,Ee),o.create_sensor_manifold(S,"ROT_UP",o.CT_CONTINUOUS,[g,Te,se],Se,Ee),o.create_sensor_manifold(S,"ROT_DOWN",o.CT_CONTINUOUS,[g,ue,se],Ae,Ee),o.create_sensor_manifold(S,"ROT_LEFT",o.CT_CONTINUOUS,[g,de,ie],Se,Ee),o.create_sensor_manifold(S,"ROT_RIGHT",o.CT_CONTINUOUS,[g,fe,ie],Ae,Ee)),!a){var Oe=0,ve=o.create_mouse_wheel_sensor(i),Ne=0,ge=o.create_touch_zoom_sensor(i);o.create_sensor_manifold(S,"MOUSE_WHEEL",o.CT_LEVEL,[ve],null,function(e,t,_){if(1==_){var n=o.get_sensor_value(e,t,0);r.get_velocities(e,N),p||O?Oe=j(e,n,N.zoom,Oe,2,p):(N.trans*=1+n*N.zoom,r.set_velocities(e,N))}}),o.create_sensor_manifold(S,"TOUCH_ZOOM",o.CT_LEVEL,[ge],null,function(e,t,_,n){if(1==_){var a=o.get_sensor_value(e,t,0);r.get_velocities(e,N),o.get_sensor_payload(e,t,0)===o.PL_MULTITOUCH_MOVE_ZOOM&&(Ne=j(e,a,.03*N.zoom,Ne,2,p))}}),o.create_sensor_manifold(S,"ZOOM_INTERPOL",o.CT_POSITIVE,[g],null,function(e,t,_){if(p||O)if(Math.abs(Oe)>1e-5||Math.abs(Ne)>1e-5){var n=o.get_sensor_value(e,t,0),a=P.smooth(Oe,0,n,.1*v);Oe-=a;var i=P.smooth(Ne,0,n,.15*v);if(Ne-=i,O)X(e,-(a+i));else{var s=r.target_get_distance(e)+a+i;s=Math.max(s,h),r.target_set_distance(e,s)}}else Oe=0,Ne=0})}var he=0,Re=0,be=0,Ye=0,Le=function(e,t,_,n){if(1==_){var a=o.get_sensor_value(e,t,1);if(r.get_velocities(e,N),O)i=.003*N.trans,s=75e-5*N.rot;else var i=.003*N.rot,s=75e-5*N.trans;1===o.get_sensor_payload(e,t,0).which?(he+="X"==n?-a*i:0,Re+="Y"==n?-a*i:0):2!==o.get_sensor_payload(e,t,0).which&&3!==o.get_sensor_payload(e,t,0).which||(be+="X"==n?-a*s:0,Ye+="Y"==n?-a*s:0)}},Me=0,xe=0;if(!c){var we=function(e,t,_){r.get_velocities(e,N),Me+=.002*N.trans},Ue=function(e,t,_){r.get_velocities(e,N),Me-=.002*N.trans};p?(o.create_sensor_manifold(S,"GMPD_PAN_Y_POS",o.CT_CONTINUOUS,[_e],null,function(e,t,_){r.get_velocities(e,N),xe+=.05*N.zoom}),o.create_sensor_manifold(S,"GMPD_PAN_Y_NEG",o.CT_CONTINUOUS,[ne],null,function(e,t,_){r.get_velocities(e,N),xe-=.05*N.zoom}),o.create_sensor_manifold(S,"GMPD_PAN_X_POS",o.CT_CONTINUOUS,[ae],function(e){return e[0]<-.1},Ue),o.create_sensor_manifold(S,"GMPD_PAN_X_NEG",o.CT_CONTINUOUS,[ae],function(e){return e[0]>.1},we)):O&&(o.create_sensor_manifold(S,"GMPD_PAN_X_POS",o.CT_CONTINUOUS,[ie],function(e){return e[0]<-.1},Ue),o.create_sensor_manifold(S,"GMPD_PAN_X_NEG",o.CT_CONTINUOUS,[ie],function(e){return e[0]>.1},we))}if(s){var Ce=o.create_mouse_move_sensor("X",window),De=o.create_mouse_move_sensor("Y",window),Fe=o.create_mouse_click_sensor(i),Ge=o.create_mouse_click_sensor(window),ke=!1,Ke=function(e){return e[2]?ke=!0:e[0]||(ke=!1),ke&&e[0]};o.create_sensor_manifold(S,"MOUSE_X",o.CT_POSITIVE,[Ge,Ce,Fe],Ke,Le,"X"),o.create_sensor_manifold(S,"MOUSE_Y",o.CT_POSITIVE,[Ge,De,Fe],Ke,Le,"Y");var Be=E.get_device_by_type_element(E.DEVICE_MOUSE,window);E.switch_prevent_default(Be,!1)}else{Ce=o.create_mouse_move_sensor("X",i),De=o.create_mouse_move_sensor("Y",i);var Xe=o.create_mouse_click_sensor(i);o.create_sensor_manifold(S,"MOUSE_X",o.CT_POSITIVE,[Xe,Ce],null,Le,"X"),o.create_sensor_manifold(S,"MOUSE_Y",o.CT_POSITIVE,[Xe,De],null,Le,"Y")}var He=0,Qe=0,ze=0,Ve=0,je=o.create_touch_move_sensor("X",i),qe=o.create_touch_move_sensor("Y",i),We=function(e,t,_,n){if(1==_){if(r.get_velocities(e,N),O)var a=.003*N.trans;else a=.003*N.rot;var i=o.get_sensor_value(e,t,0);if(o.get_sensor_payload(e,t,0).gesture===o.PL_SINGLE_TOUCH_MOVE)He+="X"==n?-i*a:0,Qe+="Y"==n?-i*a:0;else if(o.get_sensor_payload(e,t,0).gesture===o.PL_MULTITOUCH_MOVE_PAN){if(O)s=.003*N.rot;else var s=75e-5*N.trans;ze+="X"==n?-i*s:0,Ve+="Y"==n?-i*s:0}}};o.create_sensor_manifold(S,"TOUCH_X",o.CT_POSITIVE,[je],null,We,"X"),o.create_sensor_manifold(S,"TOUCH_Y",o.CT_POSITIVE,[qe],null,We,"Y"),o.create_sensor_manifold(S,"ROT_TRANS_INTERPOL",o.CT_POSITIVE,[g],null,function(e,t,_){if(Math.abs(he)>1e-5||Math.abs(Re)>1e-5||Math.abs(He)>1e-5||Math.abs(Qe)>1e-5||Math.abs(be)>1e-5||Math.abs(Ye)>1e-5||Math.abs(ze)>1e-5||Math.abs(Ve)>1e-5||Math.abs(Me)>1e-5||Math.abs(xe)>1e-5){var n=o.get_sensor_value(e,t,0),a=P.smooth(he,0,n,Z()),i=P.smooth(Re,0,n,Z());he-=a,Re-=i;var s=P.smooth(He,0,n,$()),E=P.smooth(Qe,0,n,$());He-=s,Qe-=E;var c=P.smooth(be,0,n,Z()),T=P.smooth(Ye,0,n,Z());be-=c,Ye-=T;var u=P.smooth(ze,0,n,$()),d=P.smooth(Ve,0,n,$());ze-=u,Ve-=d;var f=P.smooth(Me,0,n,Z()),A=P.smooth(xe,0,n,Z());if(Me-=f,xe-=A,p){r.rotate_camera(e,a+s,i+E);var S=r.target_get_distance(e);r.target_pan_pivot(e,S*(c+u+f),S*(T+d+A))}else if(O){if(a+s&&B(e,P.AXIS_X,.2*(a+s)),i+E){var v=r.get_camera_angles(e,w)[1];B(e,Math.abs(v)>Math.PI/4?P.AXIS_MY:P.AXIS_Z,.2*(i+E))}r.rotate_camera(e,c+u+f,0)}else if(r.rotate_camera(e,.5*(a+s),.5*(i+E)),m){var N=r.get_camera_angles_char(e,y);l.set_character_rotation_h(m,N[0]),l.set_character_vert_move_dir_angle(m,N[1])}}}),o.create_kb_sensor_manifold(S,"DEC_STEREO_DIST",o.CT_SHOT,o.KEY_LEFT_SQ_BRACKET,function(e,t,_){var n=r.get_stereo_distance(e);r.set_stereo_distance(e,.9*n)}),o.create_kb_sensor_manifold(S,"INC_STEREO_DIST",o.CT_SHOT,o.KEY_RIGHT_SQ_BRACKET,function(e,t,_){var n=r.get_stereo_distance(e);r.set_stereo_distance(e,1.1*n)})},t.disable_camera_controls=q,t.enable_object_controls=function(e,t){var r=l.is_vehicle_chassis(e)||l.is_vehicle_hull(e),_=function(e,t,_){if(1==_){var n=o.get_sensor_value(e,t,0);switch(t){case"FORWARD":r?l.vehicle_throttle(e,1):f.move_local(e,0,-1*n,0);break;case"BACKWARD":r?l.vehicle_throttle(e,-1):f.move_local(e,0,1*n,0);break;case"LEFT":r?l.vehicle_steer(e,-1):f.move_local(e,1*n,0,0);break;case"RIGHT":r?l.vehicle_steer(e,1):f.move_local(e,-1*n,0,0)}}else switch(t){case"FORWARD":case"BACKWARD":r&&l.vehicle_throttle(e,0);break;case"LEFT":case"RIGHT":r&&l.vehicle_steer(e,0)}},n=o.create_elapsed_sensor(),a=o.create_keyboard_sensor(o.KEY_W),i=o.create_keyboard_sensor(o.KEY_S),s=o.create_keyboard_sensor(o.KEY_A),E=o.create_keyboard_sensor(o.KEY_D),c=o.create_keyboard_sensor(o.KEY_UP),T=o.create_keyboard_sensor(o.KEY_DOWN),u=o.create_keyboard_sensor(o.KEY_LEFT),d=o.create_keyboard_sensor(o.KEY_RIGHT),P=function(e){return e[0]&&(e[1]||e[2])};o.create_sensor_manifold(e,"FORWARD",o.CT_CONTINUOUS,[n,a,c],P,_),o.create_sensor_manifold(e,"BACKWARD",o.CT_CONTINUOUS,[n,i,T],P,_),o.create_sensor_manifold(e,"LEFT",o.CT_CONTINUOUS,[n,s,u],P,_),o.create_sensor_manifold(e,"RIGHT",o.CT_CONTINUOUS,[n,E,d],P,_)},t.disable_object_controls=function(e){for(var t=["FORWARD","BACKWARD","LEFT","RIGHT"],r=0;r<t.length;r++)o.remove_sensor_manifold(e,t[r])},t.enable_debug_controls=function(){o.create_kb_sensor_manifold(null,"CAMERA_SHOT",o.CT_SHOT,o.KEY_K,function(){s.make_camera_frustum_shot()}),o.create_kb_sensor_manifold(null,"LIGHT_SHOT",o.CT_SHOT,o.KEY_L,function(){s.make_light_frustum_shot()}),o.create_kb_sensor_manifold(null,"TELEMETRY",o.CT_SHOT,o.KEY_T,function(){s.plot_telemetry()})},t.request_fullscreen=function(e,t,r){T.error_deprecated("request_fullscreen","screen.request_fullscreen"),u.request_fullscreen(e,t,r)},t.exit_fullscreen=function(){T.error_deprecated("exit_fullscreen","screen.exit_fullscreen"),u.exit_fullscreen()},t.check_fullscreen=function(){return T.error_deprecated("check_fullscreen","screen.check_fullscreen"),u.check_fullscreen()},t.report_app_error=W,t.get_url_params=function(e){e=!!e;var t=decodeURIComponent(location.href.toString());if(-1==t.indexOf("?"))return null;for(var r=t.split("?")[1].split("&"),_={},n=0;n<r.length;n++){var a=r[n].split("="),o=a[0];if(a.length>1){var i=a[1];e?o in _?_[o].push(i):_[o]=[i]:_[o]=i}else e?o in _||(_[o]=[]):_[o]=""}return _},t.css_animate=function(e,t,r,_,n,a,o,i){if(e&&t&&isFinite(r)&&isFinite(_)&&isFinite(n)){a=a||"",o=o||"",i=i||function(){};var s=e.style,E=t.charAt(0).toUpperCase()+t.slice(1);if(void 0!=s[t]);else if(void 0!=s["webkit"+E])t="webkit"+E;else if(void 0!=s["ms"+E])t="ms"+E;else{if(void 0==s["moz"+E])return;t="moz"+E}J(e,r,_,n,function(n){e&&(s[t]=a+n+o,(r>_&&n<=_||r<_&&n>=_)&&(s[t]=a+_+o,i()))})}},t.attr_animate=function(e,t,r,_,n,a){e&&t&&isFinite(r)&&isFinite(_)&&isFinite(n)&&(a=a||function(){},J(e,r,_,n,function(n){e&&(n>=0&&e.setAttribute(t,n),(r>_&&n<=_||r<_&&n>=_)&&(e.setAttribute(t,_),a()))}))},t.queue_animate=function(e){if(e.length){var r=e.shift(),_=r.elem,n=r.prop,a=r.from,o=r.to,i=r.duration,s=function(){r.cb&&r.cb(),t.queue_animate(e)};"css"==r.type?t.css_animate(_,n,a,o,i,r.opt_prefix,r.opt_suffix,s):"attr"==r.type&&t.attr_animate(_,n,a,o,i,s)}},t.set_camera_smooth_factor=function(e){v=e},t.get_camera_smooth_factor=function(){return v}}),hE=A("time",function(e,t){var r=ri(e);t.set_timeout=r.set_timeout,t.clear_timeout=r.clear_timeout,t.get_timeline=r.get_timeline,t.animate=r.animate,t.clear_animation=r.clear_animation}),RE=A("tsr",function(e,t){t.create=ba,t.from_values=Ya,t.copy=Ma,t.identity=xa,t.set_sep=ya,t.set_trans=wa,t.set_scale=Ua,t.set_transcale=Ca,t.set_quat=Da,t.get_trans_view=Fa,t.get_scale=ka,t.get_quat_view=Ba,t.invert=Ha,t.to_mat4=function(e,t){return t||(t=B()),Qa(e,t),t},t.from_mat4=za,t.multiply=Va,t.transform_vec3=ja,t.transform_vec3_inv=qa,t.transform_vectors=Wa,t.transform_dir_vectors=Ja,t.transform_dir_vec3=Za,t.transform_tangents=$a,t.translate=to,t.interpolate=function(e,t,r,_){return _||(_=ba()),ro(e,t,r,_),_}}),IE=A("camera_anim",function(e,t){var r=iE(e),_=TE(e),n=ga(e),a=OE(e),o=hE(e),i=vE(e),s=RE(e),E=NE(e),c=.2,l=1e-6,T=new Float32Array(2),u=new Float32Array(2),d=new Float32Array(3),f=new Float32Array(3),P=new Float32Array(3),A=s.create(),S=s.create(),p=s.create(),m={},O=!1,v=!1,N=!1,g=!1;function h(e,t,_,n,a){var o=E.angle_wrap_0_2pi(t-_),i=Math.min(o,2*Math.PI-o),s=E.angle_wrap_0_2pi(n-t),c=Math.min(s,2*Math.PI-s);return(Math.abs(i)<l||2*Math.PI-Math.abs(i)<l)&&(i=0),(Math.abs(c)<l||2*Math.PI-Math.abs(c)<l)&&(c=0),r.is_eye_camera(e)?(a[0]=c,a[1]=i):(a[0]=i,a[1]=c),a}t.track_to_target=function(e,t,a,s,c,l,A,S){if(r.is_eye_camera(e)){if(E.is_vector(t))var p=t;else i.get_object_center(t,!1,p=d);a=a||1,s=s||2,c=c||1,l=l||1;var m=i.get_translation(e,f),O=be(p,m,P),v=r.get_camera_angles(e,T),N=r.get_camera_angles_dir(O,u),g=N[0]-v[0],h=N[1]-v[1],R=Math.acos(Math.cos(g)*Math.cos(h)),I=Math.abs(R/a),b=De(O)*(1-1/s),Y=function(e){return 6*e*(1-e)},L=o.get_timeline(),M=0,x=function(){_.remove_sensor_manifold(e,"TRACK_TO_TARGET"),A&&A()},y=_.create_timeline_sensor(),w=_.create_elapsed_sensor();_.create_sensor_manifold(e,"TRACK_TO_TARGET",_.CT_CONTINUOUS,[y,w],null,function(t,n,a){if(r.is_eye_camera(t)){if(1==a){var o=_.get_sensor_value(t,n,0)-L,s=_.get_sensor_value(t,n,1);if(o<I){var E=Y(o/I);r.rotate_camera(e,E*g*s/I,E*h*s/I)}else o<I+c?(0==M&&(r.rotate_camera(e,N[0],N[1],!0),M++),E=Y(o-I/c),i.move_local(t,0,0,-E*b*s/c)):o<I+c+l?M<=1&&(r.rotate_camera(e,N[0],N[1],!0),r.eye_set_look_at(e,m),i.move_local(t,0,0,-b),S&&S(),M++):o<I+c+l+c?(M<=2&&(r.rotate_camera(e,N[0],N[1],!0),r.eye_set_look_at(e,m),i.move_local(t,0,0,-b),M++),E=Y(o-I-c-l/c),i.move_local(t,0,0,E*b*s/c)):(r.rotate_camera(e,N[0],N[1],!0),r.eye_set_look_at(e,m),x())}}else x()})}else n.error("track_to_target(): Wrong camera object or camera move style")},t.auto_rotate=function(e,t,o){t=t||function(){};var i=a.get_active_camera();if(r.is_static_camera(i))n.error("auto_rotate(): Wrong camera move style");else{var s={},l=0,d=0;if(_.check_sensor_manifold(i,"AUTO_ROTATE"))g();else{var f=_.create_mouse_move_sensor("X"),P=_.create_mouse_move_sensor("Y"),A=_.create_mouse_click_sensor(),S=_.create_touch_move_sensor(),p=_.create_touch_zoom_sensor(),O=_.create_elapsed_sensor();if(o)var v=_.create_mouse_wheel_sensor();else v=_.create_custom_sensor(0);_.create_sensor_manifold(i,"DISABLE_AUTO_ROTATE",_.CT_LEVEL,[f,P,A,S,p,v],function(e){return e[0]&&e[2]||e[1]&&e[2]||e[3]||e[4]||e[5]},g),_.create_sensor_manifold(i,"AUTO_ROTATE",_.CT_CONTINUOUS,[O],function(e){return e[0]},function(t,n,a){if(1==a){var o=r.get_move_style(t);if(o==r.MS_STATIC)g();else if(o!=r.MS_TARGET_CONTROLS&&o!=r.MS_EYE_CONTROLS||!r.has_horizontal_rot_limits(t))s=null,function(t,n){var a=_.get_sensor_value(t,n,0);r.rotate_camera(t,a*e,0)}(t,n);else{var i=o==r.MS_EYE_CONTROLS?r.eye_get_horizontal_limits(t,m):r.target_get_horizontal_limits(t,m);null!==s&&i.left==s.left&&i.right==s.right||N(i),function(t,n){var a=_.get_sensor_value(t,n,0),o=h(t,r.get_camera_angles(t,T)[0],s.left,s.right,u);o[1]>l&&o[0]>l?d=E.sign(d)*e:o[1]<l?d-=Math.pow(e,2)/(2*c)*a:o[0]<l&&(d+=Math.pow(e,2)/(2*c)*a),r.rotate_camera(t,a*d,0)}(t,n)}}})}}function N(t){(s=s||{}).left=t.left,s.right=t.right,l=Math.min(c,E.angle_wrap_0_2pi(s.right-s.left)/2),d=function(e,t,_){var n=h(e,r.get_camera_angles(e,T)[0],t.left,t.right,u);return _*Math.min(1,n[0]/c,n[1]/c)}(i,s,e)}function g(){_.remove_sensor_manifold(i,"AUTO_ROTATE"),_.remove_sensor_manifold(i,"DISABLE_AUTO_ROTATE"),t()}},t.is_auto_rotate=function(){var e=a.get_active_camera();return _.check_sensor_manifold(e,"AUTO_ROTATE")},t.check_auto_rotate=function(){var e=a.get_active_camera();return r.get_move_style(e)!=r.MS_STATIC},t.move_camera_to_point=function(e,t,_,a,c){if(r.get_move_style(e)==r.MS_STATIC){if(!O)if(e)if(t){if(_=_||1,a=a||.01,E.is_vector(e))var l=e;else l=i.get_tsr(e,A);if(E.is_vector(t))var T=t;else T=i.get_tsr(t,S);var u=Ue(s.get_trans_view(l),s.get_trans_view(T))/_,P=E.quat_to_dir(s.get_quat_view(l),E.AXIS_MZ,d),m=E.quat_to_dir(s.get_quat_view(T),E.AXIS_MZ,f),v=Math.min(Math.abs(Be(P,m)),1),g=Math.acos(v),h=1e3*Math.max(u,g/a);O=!0;var R=o.animate(0,1,h,function(t){var r=s.interpolate(l,T,E.smooth_step(t),p);if(N)return o.clear_animation(R),N=!1,void(O=!1);i.set_tsr(e,r),1==t&&(O=!1,c&&c())})}else n.error("move_camera_to_point(): you must specify the point object");else n.error("move_camera_to_point(): you must specify the camera object")}else n.error("move_camera_to_point(): wrong camera type")},t.rotate_camera=function(e,t,_,a,i){if(r.get_move_style(e)!=r.MS_STATIC){if(!v)if(e)if(t||_){v=!0;var s=0,E=o.animate(0,t,a=a||1e3,function(_){if(g||_>=t)return g=!1,o.clear_animation(E),void T();r.rotate_camera(e,s-_,0),s=_}),c=0,l=o.animate(0,_,a,function(t){if(g||t>=_)return g=!1,o.clear_animation(l),void T();r.rotate_camera(e,0,c-t),c=t})}else n.error("rotate_camera(): you must specify the rotation angle");else n.error("rotate_camera(): you must specify the camera object")}else n.error("rotate_camera(): not supported for STATIC cameras");function T(){v&&(v=!1,i&&i())}},t.stop_cam_moving=function(){N=!0},t.stop_cam_rotating=function(){g=!0},t.is_moving=function(){return O},t.is_rotating=function(){return v}}),bE=A("hmd",function(e,t){var r=iE(e),_=TE(e),n=PE(e),a=OE(e),o=mE(e),i=vE(e),s=NE(e),E=Yr(),c=0,l=!1,T=!1,u=!1,d=ve(),f=ve(),P=ve(),A=Yr(),S=Yr(),p=Yr(),m=Yr(),O=Yr(),v=ve(),N={pivot:ve()};t.HMD_NONE_MOUSE_ALL_AXES=0;var g=1;t.HMD_ALL_AXES_MOUSE_NONE=g;var h=2;t.HMD_ROLL_PITCH_MOUSE_YAW=h;var R=3;function I(){_.remove_sensor_manifold(null,"VR_CONTROLLERS")}t.HMD_ALL_AXES_MOUSE_YAW=R,t.enable_hmd=function(e){var t=n.get_device_by_type_element(n.DEVICE_HMD);t&&function(e,t){if(t){var n=a.get_active_camera();n&&o.request_split_screen(function(){r.is_eye_camera(n)||(l=r.is_target_camera(n),T=r.is_hover_camera(n),u=r.is_static_camera(n),r.eye_setup(n));var e=_.create_elapsed_sensor(),a=_.create_hmd_position_sensor();E=i.get_rotation(n,E),_.create_sensor_manifold(null,"HMD_ROTATE_CAMERA",_.CT_CONTINUOUS,[e,t,a],null,N)})}function N(t,n,o){if(o>0){var l=a.get_active_camera();if(!l)return;if(r.is_eye_camera(l)){var T=_.get_sensor_payload(t,n,1),u=Ie(_.get_sensor_payload(t,n,2),v,d);if(i.set_translation_v(l,u),T)if(e==g){T=Fr(O,T,m);var N=We(s.AXIS_MY,T,d);r.set_vertical_axis(l,N),i.set_rotation_v(l,T)}else if(e==h||e==R){var I=Vr(i.get_rotation(l,S),S),b=Fr(E,I,S),Y=r.get_vertical_axis(l,d);if(Math.abs(Y[2])<Math.PI/4)var L=Xe(Y,s.AXIS_MY,f);else Math.abs(Y[1])<Math.PI/4&&(L=Xe(Y,s.AXIS_Z,f));Ke(L,L);var M=We(L,b,P),x=we(M,Y,-Be(Y,M),P);Ke(x,x);var y=Xe(Y,L,d),w=Math.acos(s.clamp(Be(L,x),0,1)),U=s.sign(Be(x,y)),C=Dr(s.AXIS_Z,-(c+=w*U),S);if(e==R)var D=Fr(C,T,A);else D=Fr(C,Fr(Vr(s.quat_project(T,s.AXIS_MZ,s.AXIS_Z,s.AXIS_Y,p),p),T,p),A);N=We(s.AXIS_MY,D,d),r.set_vertical_axis(l,N),i.set_rotation_v(l,D),nr(D,E)}}}}}(e,n.get_value_param(t,n.HMD_WEBVR_TYPE)&(n.HMD_WEBVR_MOBILE|n.HMD_WEBVR_DESKTOP|n.HMD_WEBVR1)?_.create_hmd_quat_sensor():_.create_gyro_quat_sensor())},t.check_browser_support=function(){return Boolean(n.can_use_device(n.DEVICE_HMD))},t.enable_controllers=function(e,t){if(I(),e||t){var r=n.get_vr_controller_id(0),a=_.create_gamepad_position_sensor(r),o=_.create_gamepad_orientation_sensor(r),s=n.get_vr_controller_id(1),E=_.create_gamepad_position_sensor(s),c=_.create_gamepad_orientation_sensor(s);_.create_sensor_manifold(null,"VR_CONTROLLERS",_.CT_CONTINUOUS,[a,E,o,c],null,function(r,n,a){if(e){var o=_.get_sensor_payload(r,n,0),s=_.get_sensor_payload(r,n,2);Ie(v,o,o),i.set_translation_v(e,o),i.set_rotation_v(e,s)}if(t){var E=_.get_sensor_payload(r,n,1),c=_.get_sensor_payload(r,n,3);Ie(v,E,E),i.set_translation_v(t,E),i.set_rotation_v(t,c)}})}},t.disable_controllers=I,t.disable_hmd=function(){if(_.check_sensor_manifold(null,"HMD_ROTATE_CAMERA")){_.remove_sensor_manifold(null,"HMD_ROTATE_CAMERA"),o.exit_split_screen();var e=a.get_active_camera();l?r.target_setup(e,N):T?r.hover_setup(e,N):u&&r.static_setup(e,N),r.set_vertical_axis(e,s.AXIS_Z);var t=i.get_rotation(e,A);i.set_rotation_v(e,t)}},t.set_rotate_quat=function(e){nr(e,O)},t.get_rotate_quat=function(e){return nr(O,e),e},t.set_position=function(e){nr(e,v)},t.get_position=function(e){return nr(v,e),e}}),YE=A("fps",function(e,t){var r=iE(e),_=TE(e),n=pE(e),a=OE(e),o=NE(e),i=SE(e),s=lE(e),E=PE(e),c=mE(e),l=vE(e),T=cE(e),u=bE(e),d=ga(e),f=1,P=2,A=3,S="url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyBpZD0ic3ZnMzQwMCIgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMTQuMTExbW0iIHdpZHRoPSIxNC4xMTFtbSIgdmVyc2lvbj0iMS4xIiB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIiB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iIHZpZXdCb3g9IjAgMCA0OS45OTk5OTggNDkuOTk5OTk5Ij4gPG1ldGFkYXRhIGlkPSJtZXRhZGF0YTM0MDUiPjxyZGY6UkRGPjxjYzpXb3JrIHJkZjphYm91dD0iIj48ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD48ZGM6dHlwZSByZGY6cmVzb3VyY2U9Imh0dHA6Ly9wdXJsLm9yZy9kYy9kY21pdHlwZS9TdGlsbEltYWdlIi8+PGRjOnRpdGxlLz48L2NjOldvcms+PC9yZGY6UkRGPiA8L21ldGFkYXRhPiA8ZyBpZD0ibGF5ZXIxIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwIC0xMDAyLjQpIj48cmVjdCBpZD0icmVjdDI0MTI2IiBvcGFjaXR5PSIwLjU0MyIgZmlsbC1vcGFjaXR5PSIuODM2MTEiIGhlaWdodD0iNTAiIHdpZHRoPSI1MCIgeT0iMTAwMi40IiB4PSIwIiBmaWxsPSIjZmZmIi8+PHBhdGggaWQ9InBhdGgyNDEyOCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0ibTM5LjE0MiAxMDMzLjUtMTQuMTQyLTE0LjE0Mi0xNC4xNDIgMTQuMTQyIiBzdHJva2U9IiM2ZTZlNmUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLXdpZHRoPSIyIiBmaWxsPSJub25lIi8+IDwvZz48L3N2Zz4=);",p=4,m=2,O=.2,v=.05,N=2.5,g=(.1-Math.PI)/2,h=(Math.PI-.1)/2,R=300,I=326,b=new Float32Array(2),Y=1,L=4e-4,M=0,x=null,y=null,w={enable_cb:null,disable_cb:null},U=function(){},C=0,D=4,F=!1,G=new Float32Array(2),k=new Float32Array(3),K=new Float32Array(3);function B(e,t,_){var o=a.get_active_camera();r.rotate_camera(o,t,_);var i=r.get_camera_angles_char(o,G);n.set_character_rotation_h(e,i[0]),n.set_character_vert_move_dir_angle(e,i[1])}function X(e,t,r,n){if(Math.abs(b[0])>.01||Math.abs(b[1])>.01){var a=_.get_sensor_value(e,t,0),i=o.smooth(b[0],0,a,H()),s=o.smooth(b[1],0,a,H());b[0]-=i,b[1]-=s,n(e,-i*L,-s*L)}}function H(){return O*Y}function Q(e){return"function"==typeof(e.requestPointerLock||e.webkitRequestPointerLock||e.mozRequestPointerLock)}function z(e,t){if(Q(e)&&!i.detect_mobile()){var s=_.create_plock_mouse_sensor(e),c=y||_.create_plock_sensor(e);y=c,_.create_sensor_manifold(t,"FPS_PLOCK",_.CT_CONTINUOUS,[s,c],function(e){return e[0]&&e[1]},function(e,t,r){if(r>0){var n=_.get_sensor_payload(e,t,0);U(e,-n.coords[0]*L,-n.coords[1]*L)}}),_.create_sensor_manifold(null,"FPS_ACTIVATE_PLOCK",_.CT_TRIGGER,[c],function(e){return e[0]},function(t,r,_){_>0?w.enable_cb&&w.enable_cb(e):w.disable_cb&&w.disable_cb(e)})}else{if(i.detect_mobile())var l=_.create_touch_move_sensor("XY",e),T=_.create_touch_click_sensor(e),u=p;else{l=_.create_mouse_move_sensor("XY",e),T=_.create_mouse_click_sensor(e),u=m;var d=a.get_active_camera(),f=_.create_elapsed_sensor(),P=_.create_gamepad_axis_sensor(E.GMPD_AXIS_2),A=_.create_gamepad_axis_sensor(E.GMPD_AXIS_3);_.create_sensor_manifold(t,"FPS_CAM_ROT",_.CT_CONTINUOUS,[f,P,A],function(e){return Math.abs(e[1])>v||Math.abs(e[2])>v},function(e,t,a){if(a>0){var i=_.get_sensor_value(e,t,0);!function(e,t,a,i){var s=_.get_sensor_value(e,a,1),E=_.get_sensor_value(e,a,2),c=i*N,l=-(Math.abs(E)<v?0:E)*c,T=-(Math.abs(s)<v?0:s)*c;l=o.clamp(l,g,h),r.rotate_camera(t,T,l);var u=r.get_camera_angles(t,G);n.set_character_rotation_h(e,u[0]+Math.PI)}(e,d,t,i)}})}var S=0,O=0;_.create_sensor_manifold(null,"FPS_DRAG_PRESS",_.CT_SHOT,[T],function(e){return e[0]},function(e,t,r){if(1==r){var n=_.get_sensor_payload(e,t,0).coords;S=n[0],O=n[1]}}),_.create_sensor_manifold(null,"FPS_DRAG_MOVE",_.CT_CONTINUOUS,[l,T],function(e){return e[0]&&e[1]},function(e,t,r){if(1==r){var n=_.get_sensor_payload(e,t,0).coords;b[0]+=(n[0]-S)*u,b[1]+=(n[1]-O)*u,S=n[0],O=n[1]}});var R=_.create_elapsed_sensor();_.create_sensor_manifold(t,"FPS_SMOOTH_DRAG",_.CT_CONTINUOUS,[R],null,X,U)}}var V=null,j=null;function q(){var e=u.check_browser_support()&&!i.detect_mobile(),t=E.get_device_by_type_element(E.DEVICE_HMD);return t&&(e=e&&E.get_value_param(t,E.HMD_WEBVR_TYPE)&E.HMD_WEBVR1),e}function W(){return x||(x={nodes:[],current_node:null,lock:!1,last_state:null}),x}function J(e,t,r,_,n,a){e.nodes.push({id:t,allowed_ids:r,call_switch:_,call_before_switch:n,call_after_switch:a})}function Z(e){for(var t=[],r=0;r<e.nodes;r++){var _=e.nodes[r].id;if(t.indexOf(_)>=0)return!1;t.push(_)}for(r=0;r<e.nodes;r++)for(var n=e.nodes[r],a=0;a<n.allowed_ids.length;a++)if(t.indexOf(n.allowed_ids[a])<0)return!1;return!0}function $(e,t){for(var r=null,_=0;_<e.nodes.length;_++)if(e.nodes[_].id==t){r=e.nodes[_];break}return r}function ee(e,t){var r=$(e,t);return e.current_node=r,r}function te(e){return e.current_node}function re(e,t){if(e.last_state=t,e.lock)return!1;var r=te(e),_=r.id;if(r.allowed_ids.indexOf(t)>=0){var n=!0;if(r.call_before_switch&&(n=r.call_before_switch(_,t)),n)return ee(e,t),r.call_switch&&r.call_switch(_,t),r.call_after_switch&&r.call_after_switch(_,t),!0}return!1}function _e(e,t,r){if(t.length){for(var n=[],a=0;a<t.length;a++)if("number"==typeof t[a])n.push(t[a]<R?_.create_keyboard_sensor(t[a]):t[a]<I?_.create_gamepad_btn_sensor(t[a],C):_.create_gamepad_axis_sensor(t[a]));else if("string"==typeof t[a]){var o=document.getElementById(t[a]);o?n.push(_.create_touch_click_sensor(o)):d.error("Couldn't find element with "+t[a]+" ID.")}var i=function(e){return!1},s=_.CT_SHOT,E=function(e,t,r,_){};switch(e){case f:s=_.CT_TRIGGER,i=function(e){for(var t=0;t<e.length;t++)if(e[t])return!0;return!1},E=function(e,t,_,n){r(_>0?1:0)};break;case P:s=_.CT_TRIGGER,i=function(e){for(var t=0;t<e.length;t++)if(e[t])return!0;return!1},E=function(e,t,_,n){r(_<0?1:0)};break;case A:s=_.CT_CONTINUOUS,i=function(e){for(var t=0;t<e.length;t++)if(Math.abs(e[t])>v)return!0;return!1},E=function(e,t,n,a){if(n>0)for(var o=0;o<a;o++){var i=_.get_sensor_value(e,t,o);if(Math.abs(i)>v)return void r(i)}else r(0)}}var c="FPS_USER_CONTROL_ACTION_"+M.toString();_.create_sensor_manifold(null,c,s,n,i,E,n.length),M++}}t.append_switch_vr_cbs=function(e,t){V=e,j=j},t.CS_STAY=0,t.CS_WALK=1,t.CS_RUN=2,t.CS_FLY=3,t.CS_CLIMB=4,t.AT_PRESSED=f,t.AT_RELEASED=P,t.AT_CONTINUOUS=A,t.bind_action=_e,t.enable_fps_controls=function(e){var t=(e=e||{lock_camera:!0}).character||a.get_first_character();if(t){var o=e.element||s.get_canvas(),d=e.motion_cb||null;C=e.gamepad_id||0;var P=e.forward_sens||[_.KEY_W,E.GMPD_BUTTON_12],p=e.backward_sens||[_.KEY_S,E.GMPD_BUTTON_13],m=e.right_sens||[_.KEY_D,E.GMPD_BUTTON_15],O=e.left_sens||[_.KEY_A,E.GMPD_BUTTON_14],v=e.jump_sens||[_.KEY_SPACE,E.GMPD_BUTTON_1],N=e.run_sens||[_.KEY_SHIFT,E.GMPD_BUTTON_7],g=e.fly_sens||[];i.detect_mobile()&&(P.push("B4W_DEFAULT_BTN_1"),p.push("B4W_DEFAULT_BTN_2"));var h={forward_sens_arr:P,backward_sens_arr:p,right_sens_arr:m,left_sens_arr:O,jump_sens_arr:v,run_sens_arr:N,fly_sens_arr:g,move_dir_cd:e.move_dir_cd||null};U=e.rotation_cb||B,function(e,t){var _=a.get_active_camera();if(t){var o=l.get_translation(_,k);be(o,l.get_translation(e,K),o),T.append_stiff_trans(_,e,o)}var i=r.get_camera_angles_char(_,G);n.set_character_rotation_h(e,i[0]),n.set_character_vert_move_dir_angle(e,i[1])}(t,"undefined"==typeof e.lock_camera||e.lock_camera),function(e,t){q()&&function(e,t){E.add_click_listener(e,function(){c.request_fullscreen_hmd(e,function(){!function(e,t){_.check_sensor_manifolds(t,"FPS_PLOCK")&&_.remove_sensor_manifold(t,"FPS_PLOCK"),_.check_sensor_manifolds(null,"FPS_ACTIVATE_PLOCK")&&_.remove_sensor_manifold(null,"FPS_ACTIVATE_PLOCK"),_.check_sensor_manifolds(t,"FPS_CAM_ROT")&&_.remove_sensor_manifold(t,"FPS_CAM_ROT"),_.check_sensor_manifolds(null,"FPS_DRAG_PRESS")&&_.remove_sensor_manifold(null,"FPS_DRAG_PRESS"),_.check_sensor_manifolds(null,"FPS_DRAG_MOVE")&&_.remove_sensor_manifold(null,"FPS_DRAG_MOVE"),_.check_sensor_manifolds(t,"FPS_SMOOTH_DRAG")&&_.remove_sensor_manifold(t,"FPS_SMOOTH_DRAG")}(0,t),u.enable_hmd(u.HMD_ALL_AXES_MOUSE_NONE),function(e){var t=_.create_elapsed_sensor(),o=a.get_active_camera();_.create_sensor_manifold(e,"FPS_CHARECTER_VR_ROT",_.CT_CONTINUOUS,[t],null,function(e,t,_){var a=r.get_camera_angles_char(o,G)[0];n.set_character_rotation_h(e,a)})}(t),V&&V()},function(){!function(e){_.remove_sensor_manifold(e,"FPS_CHARECTER_VR_ROT")}(t),u.disable_hmd(),z(e,t),j&&j()})})}(e,t),z(e,t)}(o,t),function(e,t,r,_){i.detect_mobile()&&function(e,t){var r=document.createElement("div");r.style.cssText="position: absolute;left: 10px;bottom: 70px;width: 53px;height: 53px;background-image: "+S,r.setAttribute("id","B4W_DEFAULT_BTN_1");var _=document.createElement("div");_.style.cssText="position: absolute;left: 10px;bottom: 10px;width: 53px;height: 53px;background-image: "+S+"transform: rotate(180deg);transform-origin: center;",_.setAttribute("id","B4W_DEFAULT_BTN_2"),t.appendChild(r),t.appendChild(_)}(0,e.parentElement?e.parentElement:e);var a=function(e){var t=W(),r=function(t,r){switch(r){case 0:case 1:n.set_character_move_type(e,n.CM_WALK);break;case 2:n.set_character_move_type(e,n.CM_RUN);break;case 3:n.set_character_move_type(e,n.CM_FLY);break;case 4:n.set_character_move_type(e,n.CM_CLIMB)}};return J(t,0,[1,3,2,4],r,null,null),J(t,1,[2,3,4,0],r,null,null),J(t,2,[1,3,4,0],r,null,null),J(t,3,[1],r,null,null),J(t,4,[1,2,0],r,null,null),Z(t),ee(t,0),x}(t),o={left:0,right:0,forw:0,back:0},s=-1,c=_.move_dir_cd,l=function(){return!F||(o.left=0,o.right=0,o.forw=0,o.back=0,!1)},T=function(e,t){var r=te(a).id;e||t||4==r?0==r&&re(a,s>0?2:1):re(a,0)},u=function(e){if(l()){var _=o.forw+o.back;o.back=-(e=(e=e>0?1:e)<0?-1:e);var a=o.forw+o.back,i=o.left+o.right;n.set_character_move_dir(t,a,i),r&&r(a,i),T(a,i),c&&_!=a&&c(a,i,0)}},d=function(e){if(l()){4==te(a).id&&(e=0);var _=o.left+o.right;o.right=-(e=(e=e>0?1:e)<0?-1:e);var i=o.forw+o.back,s=o.left+o.right;n.set_character_move_dir(t,i,s),r&&r(i,s),T(i,s),c&&_!=s&&c(i,s,0)}},P=_.backward_sens_arr,p=_.right_sens_arr,m=_.left_sens_arr,O=_.jump_sens_arr,v=_.run_sens_arr,N=_.fly_sens_arr;_e(f,_.forward_sens_arr,function(e){if(l()){var _=o.forw+o.back;o.forw=e;var a=o.forw+o.back,i=o.left+o.right;n.set_character_move_dir(t,a,i),r&&r(a,i),T(a,i),c&&_!=a&&c(a,i,0)}}),_e(f,P,u),_e(f,p,d),_e(f,m,function(e){if(l()){4==te(a).id&&(e=0);var _=o.left+o.right;o.left=e;var i=o.forw+o.back,s=o.left+o.right;n.set_character_move_dir(t,i,s),r&&r(i,s),T(i,s),c&&_!=s&&c(i,s,0)}}),_e(f,O,function(e){l()&&e>0&&(n.character_jump(t),c&&c(o.forw+o.back,o.left+o.right,1))}),_e(A,[E.GMPD_AXIS_0],d),_e(A,[E.GMPD_AXIS_1],u),_e(f,v,function(e){s=e,Math.abs(o.forw+o.back)+Math.abs(o.left+o.right)?(re(a,e>0?2:1),c&&c(o.forw+o.back,o.left+o.right,0)):re(a,0)}),_e(f,N,function(e){if(e>0){var t=te(x).id;re(a,1==t||0==t?3:1)}})}(o,t,d,h)}},t.disable_fps_controls=function(e,t){e=e||a.get_first_character(),t=t||s.get_container(),e&&(function(){for(var e=0;e<M;e++)_.remove_sensor_manifold(null,"FPS_USER_CONTROL_ACTION_"+e.toString())}(),function(e,t){Q(t)&&!i.detect_mobile()&&(w.disable_cb&&w.disable_cb(t),_.remove_sensor_manifold(e,"FPS_PLOCK"),_.remove_sensor_manifold(null,"FPS_ACTIVATE_PLOCK"))}(e,t),function(e,t){Q(t)&&!i.detect_mobile()||(_.remove_sensor_manifold(e,"FPS_CAM_ROT"),_.remove_sensor_manifold(e,"FPS_DRAG_PRESS"),_.remove_sensor_manifold(e,"FPS_DRAG_MOVE"),_.remove_sensor_manifold(e,"FPS_SMOOTH_DRAG"))}(e,t),function(e){q()&&_.remove_sensor_manifold(e,"FPS_CHARECTER_VR_ROT")}(e),function(e,t){if(i.detect_mobile()){var r=document.getElementById("B4W_DEFAULT_BTN_1"),_=document.getElementById("B4W_DEFAULT_BTN_2");r&&t.removeChild(r),_&&t.removeChild(_)}}(0,t))},t.set_state_change_cb=function(e,t){!function(e,t,r){$(x,t).call_after_switch=r}(0,e,t)},t.set_cam_smooth_factor=function(e){_.set_plock_smooth_factor(e),function(e){Y=e}(e)},t.get_cam_smooth_factor=function(){return Y},t.set_cam_sensitivity=function(e){L=e/2e5},t.get_cam_sensitivity=function(){return 2e5*L},t.set_plock_enable_cb=function(e){w.enable_cb=e},t.set_plock_disable_cb=function(e){w.disable_cb=e},t.get_character_state=function(){return te(x).id},t.add_new_state=function(){return D++},t.add_state=function(e,t,r){var _=W();J(_,e,t,r,null,null),Z(_)||d.error("Incorrect state machine.")},t.switch_state=function(e){re(W(),e)},t.lock_character=function(){W().lock=!0},t.unlock_character=function(){W().lock=!1},t.is_character_locked=function(){return W().lock},t.set_rotation_cb=function(e){U=e||B},t.freeze_movements=function(){F=!0},t.unfreeze_movements=function(){F=!1}}),LE=A("storage",function(e,t){var r=ga(e),_="b4w",n=null;function a(e){return n[e||_]?JSON.parse(n[e||_]):{}}t.init=function(e){e?"b4w"!==e?_=e:r.error("b4w prefix denied"):r.warn("Prefix should be a string. Last declared storage prefix will be used.")},t.set=function(e,t,r){var o=a(r);o[e]=String(t),function(e,t){n[t||_]=JSON.stringify(o)}(0,r)},t.cleanup=function(e){delete n[e||_]},t.get=function(e,t){var r=a(t);return r[e]?r[e]:""},t.debug=function(e){r.log(a(e||_))},function(){try{n=window.localStorage;try{n.tmp=null,delete n.tmp}catch(e){r.warn("localStorage quota is limited. Disabling localStorage"),n=null}}catch(e){r.warn("Applying chrome localStorage bug workaround"),n=null}n||(r.warn("localStorage is not available, initializing temporary storage"),n={})}()}),ME=A("gp_conf",function(e,t){var r=lE(e),_=TE(e),n=PE(e),a=LE(e),o="url('data:image/svg+xml;base64,",i=new RegExp("#5276cf","g"),s="#ff0000",E="#00ff00",c="#e6e6e6",l="Click on the buttons & arrows to setup your controller",T="Now press the button on the device",u="Now move the axis on the device",d=20,f={};f[n.GMPD_BUTTON_12]=n.GMPD_BUTTON_12,f[n.GMPD_BUTTON_13]=n.GMPD_BUTTON_13,f[n.GMPD_BUTTON_15]=n.GMPD_BUTTON_15,f[n.GMPD_BUTTON_14]=n.GMPD_BUTTON_14,f[n.GMPD_BUTTON_3]=n.GMPD_BUTTON_3,f[n.GMPD_BUTTON_0]=n.GMPD_BUTTON_0,f[n.GMPD_BUTTON_1]=n.GMPD_BUTTON_1,f[n.GMPD_BUTTON_2]=n.GMPD_BUTTON_2,f[n.GMPD_BUTTON_5]=n.GMPD_BUTTON_5,f[n.GMPD_BUTTON_7]=n.GMPD_BUTTON_7,f[n.GMPD_BUTTON_4]=n.GMPD_BUTTON_4,f[n.GMPD_BUTTON_6]=n.GMPD_BUTTON_6,f[n.GMPD_BUTTON_8]=n.GMPD_BUTTON_8,f[n.GMPD_BUTTON_9]=n.GMPD_BUTTON_9,f[n.GMPD_BUTTON_10]=n.GMPD_BUTTON_10,f[n.GMPD_BUTTON_11]=n.GMPD_BUTTON_11,f[n.GMPD_BUTTON_16]=n.GMPD_BUTTON_16;var P=0,A=1,S=2,p='<svg id="svg26627" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="128.51mm" viewBox="0 0 636.63517 455.33329" width="179.67mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:dc="http://purl.org/dc/elements/1.1/"><defs id="defs26629"><linearGradient id="linearGradient4691"><stop id="stop4693" offset="0"/><stop id="stop4695" stop-opacity="0" offset="1"/></linearGradient><linearGradient id="linearGradient4358"><stop id="stop4360" stop-color="#2e2e2e" offset="0"/><stop id="stop4362" stop-color="#2e2e2e" stop-opacity="0" offset="1"/></linearGradient><linearGradient id="linearGradient4364" x1="1141.5" xlink:href="#linearGradient4358" gradientUnits="userSpaceOnUse" y1="255.95" gradientTransform="matrix(-1 0 0 1 1531.4 560.1)" x2="1165.2" y2="309.88"/><linearGradient id="linearGradient4368" x1="1141.5" xlink:href="#linearGradient4358" gradientUnits="userSpaceOnUse" y1="255.95" gradientTransform="translate(-896.37 560.1)" x2="1165.2" y2="309.88"/><linearGradient id="linearGradient4430" x1="959.32" gradientUnits="userSpaceOnUse" y1="653.07" gradientTransform="matrix(-1 0 0 1 1531.4 70.097)" x2="1467.6" y2="653.07"><stop id="stop4426" stop-color="#4f4f4f" offset="0"/><stop id="stop4428" stop-color="#4f4f4f" stop-opacity="0" offset="1"/></linearGradient><linearGradient id="linearGradient4701" x1="529.91" xlink:href="#linearGradient4691" gradientUnits="userSpaceOnUse" y1="111.1" gradientTransform="translate(-52.276 546.89)" x2="481.49" y2="85.746"/><linearGradient id="linearGradient4713" x1="529.91" xlink:href="#linearGradient4691" gradientUnits="userSpaceOnUse" y1="111.1" gradientTransform="matrix(-1 0 0 1 689.01 546.89)" x2="481.49" y2="85.746"/><linearGradient id="linearGradient4725" x1="367.39" xlink:href="#linearGradient4691" gradientUnits="userSpaceOnUse" y1="125.6" gradientTransform="matrix(-1.3272 0 0 .68317 806.95 579.14)" x2="367.39" y2="116.11"/></defs><metadata id="metadata26632"><rdf:RDF><cc:Work rdf:about="">    <dc:format>image/svg+xml</dc:format>    <dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/>    <dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -597.03)"><g id="g20" fill-rule="evenodd"><path id="path4209" fill="#434343" d="m576.71 1052.4c42.015-1.9097 64.296-46.468 59.204-122.86-5.0928-76.387-27.374-175.69-44.562-224.7-17.188-49.015-25.501-62.531-26.737-65.565-3.7697-9.2504-11.278-19.949-62.379-27.691-28.97-4.3891-16.697-7.9577-27.084-9.4696-17.96-2.6141-43.609-1.229-52.203 1.6354-8.594 2.8645-12.709 29.16-24.486 35.207-11.777 6.0473-19.416 10.185-80.149 10.185s-68.372-4.1376-80.149-10.185c-11.777-6.0473-18.113-32.099-25.736-36.993-11.183-7.1796-26.985-5.6722-54.891-0.57481-5.64 1.0302-1.1304 7.6212-18.165 12.509-32.913 9.4438-52.094 3.7056-65.087 20.831-1.9807 2.6106-11.822 21.096-29.01 70.111-17.179 48.95-39.46 148.25-44.553 224.64-5.0929 76.39 17.188 120.99 59.204 122.89 73.339-1.7 55.219-116.53 258.4-116.53s185.05 114.82 258.4 116.49z"/><path id="path4366" fill="url(#linearGradient4368)" d="m249.77 838.51c-107.76 0-171.55 96.288-176.84 121.23-5.2294 24.634-17.658 55.705 3.8195 53.789 9.6996-0.8655 18.053-15.713 37.559-38.193 18.78-21.643 41.379-54.425 96.763-54.425s73.209-44.877 75.119-53.152c1.9098-8.2752 2.4146-27.976-36.418-29.25z"/><path id="path4217" fill="url(#linearGradient4364)" d="m385.23 838.51c107.76 0 171.55 96.288 176.84 121.23 5.2293 24.634 17.658 55.705-3.8195 53.789-9.6996-0.8655-18.053-15.713-37.559-38.193-18.78-21.643-41.379-54.425-96.763-54.425s-73.209-44.877-75.119-53.152c-1.9098-8.2752-2.4146-27.976 36.418-29.25z"/><path id="path4370" fill="url(#linearGradient4430)" d="m572.06 654.81c-60.48-19.09-76.79-18.6-89.84-17.96-13.05 0.63657-22.638 16.617-45.237 49.4s-67.48 125.27-116.23 125.27c-48.746 0-93.626-92.491-116.23-125.27-22.599-32.783-32.008-48.942-45.059-49.579-13.05-0.63648-35.251 1.8354-95.728 20.932l1.1161-2.3404c60.494-19.1 81.754-20.83 94.804-20.19 13.05 0.63657 22.281 13.049 44.88 45.832s67.48 123.49 116.23 123.49c48.746 0 93.626-90.709 116.23-123.49 22.599-32.783 31.83-45.195 44.88-45.832 13.05-0.63648 28.783-1.6248 89.26 17.472"/><path id="path4315" fill="#343434" d="m570.99 652.48c-60.477-19.097-76.074-18.269-89.124-17.633-13.05 0.63658-22.281 14.832-44.88 47.614-22.599 32.783-67.48 125.27-116.23 125.27-48.746 0-93.626-92.491-116.23-125.27-22.599-32.783-31.83-46.978-44.88-47.614-13.05-0.63648-34.715 1.2996-95.192 20.396l1.1161-2.3404c60.474-19.1 81.024-22.26 94.074-21.62 13.05 0.63658 22.281 13.049 44.88 45.832s67.48 123.49 116.23 123.49c48.746 0 93.626-90.709 116.23-123.49 22.599-32.783 31.83-45.195 44.88-45.832 13.05-0.63647 27.71-0.17274 88.186 18.924"/></g><g id="g15645" transform="matrix(.75439 0 0 1 1558.5 -6638.3)" fill-rule="evenodd"><rect id="rect15584" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="2" ry="1.8461" height="44.307" width="570" y="6558.3" x="100.71" fill="#4164bb"/><rect id="rect15331" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="2" ry="1.8461" height="44.307" width="570" y="6554.6" x="100.71" fill="#5276cf"/></g><text id="text15623-9" style="word-spacing:0px;letter-spacing:0px" font-weight="300" xml:space="preserve" font-size="22px" line-height="430.99999428%" y="-53.755863" x="1792.7805" font-family="&apos;Noto Sans CJK TC&apos;" fill="#ffffff"><tspan id="tspan15625-5" y="-53.755863" x="1792.7805"/></text><text id="text15657" style="word-spacing:0px;letter-spacing:0px" font-weight="300" xml:space="preserve" font-size="13px" line-height="430.99999428%" y="-3.7607465" x="1670.2437" font-family="&apos;Noto Sans CJK TC&apos;" fill="#828282"><tspan id="tspan15659" y="-3.7607465" x="1670.2437"/></text><g id="g34" fill-rule="evenodd"><path id="path4675" fill="#303030" d="m551.75 628.4c9.3003 4.1796 8.2375 11.558 2.1302 9.9581-6.1073-1.6003-33.792-9.1405-46.239-11.577-12.446-2.4363-34.904-3.0623-36.951-4.0165-2.0474-0.95416 0.93313-7.7247 5.491-7.3449 23.258 0.91012 59.905 6.0339 75.569 12.98z"/><path id="path4677" fill="#303030" d="m474.88 602.61c3.6488 0.63684 4.1169 1.3708 2.4115 5.2499-0.80967 1.8416-1.261 3.904-3.4715 3.7336-4.456-0.34344-16.578-1.2846-25.692-1.3764-9.1139-0.0918-23.83 1.217-25.307 0.79399-1.4771-0.42301-1.8834-4.9141 1.7769-6.7458 4.6221-1.3593 38.698-3.2021 50.281-1.6553z"/><path id="path4699" opacity=".384" fill="url(#linearGradient4701)" d="m475.53 611.7c-11.693-0.63604-8.4597-0.73151-44.068 54.448-6.5182 8.6489-22.874 37.231-36.865 35.326-6.7491-1.4177 15.436-67.299 22.724-75.767 11.112-12.911 19.255-16.122 58.209-14.007z"/><path id="path4703" fill="#303030" d="m84.068 628.4c-9.3003 4.1796-8.2375 11.558-2.1302 9.9581 6.1073-1.6003 33.792-9.1405 46.239-11.577 12.446-2.4363 34.904-3.0623 36.951-4.0165 2.0474-0.95416-0.93313-7.7247-5.491-7.3449-23.258 0.91012-59.905 6.0339-75.569 12.98z"/><path id="path4705" fill="#303030" d="m161.86 602.61c-3.6488 0.63684-4.1169 1.3708-2.4115 5.2499 0.80967 1.8416 1.261 3.904 3.4715 3.7336 4.456-0.34344 16.578-1.2846 25.692-1.3764 9.1139-0.0918 23.83 1.217 25.307 0.79399 1.4771-0.42301 1.8834-4.9141-1.7769-6.7458-4.6221-1.3593-38.698-3.2021-50.281-1.6553z"/><path id="path4711" opacity=".384" fill="url(#linearGradient4713)" d="m161.2 611.7c11.693-0.63604 8.4597-0.73151 44.068 54.448 6.5182 8.6489 22.874 37.231 36.865 35.326 6.7491-1.4177-15.436-67.299-22.724-75.767-11.112-12.911-19.255-16.122-58.209-14.007z"/><path id="path4717" opacity=".115" fill="url(#linearGradient4725)" d="m413.37 645.84c-9.0496 10.007-29.401 19.937-36.775 19.937h-52.205c-31.171 0-37.359 0.34506-47.75 0.51758-10.39 0.17253-18.682 0.65628-23.653-3.278-5.0513-3.9977-24-15.425-24-15.425 53.346 4.1464 144.49 4.3368 184.38-1.7523z"/></g></g><g id="layer1-0" fill-rule="evenodd" transform="translate(159.08 -720.76)"><g id="g4527-3" transform="translate(-961.22,330.69)"><ellipse id="circle4233-8" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="66.284" ry="66.279" cy="655.39" cx="1027.5" fill="#303030"/><ellipse id="circle4235-8" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="62.007" ry="62.003" cy="655.39" cx="1027.5" fill="#4c4c4c"/><ellipse id="circle4237-7" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="43.41" ry="43.408" cy="655.39" cx="1027.5" fill="#303030"/></g><g id="g4523-1" transform="translate(-961.22,330.69)"><ellipse id="circle4239-4" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="40.057" ry="40.054" cy="655.39" cx="1027.5" fill="#3b63c9"/><ellipse id="circle4243-3" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="36.23" ry="36.228" cy="655.39" cx="1027.5" fill="#5276cf"/></g><g id="g3506" transform="translate(-961.22,330.69)"><ellipse id="ellipse3508" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="66.284" ry="66.279" cy="655.39" cx="1027.5" fill="#303030"/><ellipse id="ellipse3510" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="62.007" ry="62.003" cy="655.39" cx="1027.5" fill="#4c4c4c"/><ellipse id="ellipse3512" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="43.41" ry="43.408" cy="655.39" cx="1027.5" fill="#303030"/></g></g><g id="layer1-7" fill-rule="evenodd" transform="translate(352.57 -719.72)"><g id="g4527-3-4" transform="translate(-961.22,330.69)"><ellipse id="circle4233-8-8" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="66.284" ry="66.279" cy="655.39" cx="1027.5" fill="#303030"/><ellipse id="circle4235-8-9" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="62.007" ry="62.003" cy="655.39" cx="1027.5" fill="#4c4c4c"/><ellipse id="circle4237-7-3" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="43.41" ry="43.408" cy="655.39" cx="1027.5" fill="#303030"/></g><g id="g4523-1-1" transform="translate(-961.22,330.69)"><ellipse id="circle4239-4-4" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="40.057" ry="40.054" cy="655.39" cx="1027.5" fill="#3b63c9"/><ellipse id="circle4243-3-5" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="36.23" ry="36.228" cy="655.39" cx="1027.5" fill="#5276cf"/></g><g id="g3506-2" transform="translate(-961.22,330.69)"><ellipse id="ellipse3508-1" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="66.284" ry="66.279" cy="655.39" cx="1027.5" fill="#303030"/><ellipse id="ellipse3510-1" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="62.007" ry="62.003" cy="655.39" cx="1027.5" fill="#4c4c4c"/><ellipse id="ellipse3512-4" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="43.41" ry="43.408" cy="655.39" cx="1027.5" fill="#303030"/></g></g></svg>',m='<svg id="svg3904" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="35.924mm" width="35.926mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 127.29808 127.28933"><metadata id="metadata3909"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" fill-rule="evenodd" transform="translate(0 -925.07)"><ellipse id="circle4330" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="63.649" ry="63.645" cy="988.72" cx="63.649" fill="#303030"/><ellipse id="circle4223" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="59.705" ry="59.701" cy="988.72" cx="63.649" fill="#4c4c4c"/></g></svg>',O='<svg id="svg3754" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="10.711mm" width="9.9653mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 35.3101 37.950677"><metadata id="metadata3759"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -1014.4)"><path id="path4326" stroke-linejoin="round" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m34.81 1017.1c-15.254-3.8172-24.634-1.7612-34.31 0v16.247h0.015c-0.013 0.097-0.013 0.1951-0.015 0.2928 0.0006 9.4753 7.6813 18.256 17.156 18.256 9.4739-0.0005 17.154-8.7813 17.154-18.256 0-0.097-0.014-0.1952-0.014-0.2928h0.014z" fill-rule="evenodd" stroke="#4364b2" stroke-linecap="round" fill="#5276cf"/></g></svg>',v='<svg id="svg3790" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="9.9646mm" width="10.711mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 37.953175 35.3077"><metadata id="metadata3795"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -1017.1)"><path id="path4324" stroke-linejoin="round" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m35.298 1017.6c3.8175 15.253 1.7611 24.633 0 34.308h-16.248v-0.015c-0.098 0.01-0.1952 0.01-0.2928 0.015-9.476-0.0006-18.258-7.6807-18.257-17.154 0.0005-9.4733 8.7818-17.153 18.257-17.153 0.098 0 0.1952 0.01 0.2928 0.011v-0.011z" fill-rule="evenodd" stroke="#4364b2" stroke-linecap="round" fill="#5276cf"/></g></svg>',N='<svg id="svg3754" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="10.711mm" width="9.9653mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 35.3101 37.950677"><metadata id="metadata3759"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -1014.4)"><path id="path4328" stroke-linejoin="round" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m34.81 1049.7c-15.254 3.8172-24.634 1.7612-34.31 0v-16.247h0.015c-0.013-0.097-0.013-0.1951-0.015-0.2928 0.0006-9.4753 7.6813-18.256 17.156-18.256 9.4739 0.0005 17.154 8.7813 17.154 18.256 0 0.097-0.014 0.1952-0.014 0.2928h0.014z" fill-rule="evenodd" stroke="#4364b2" stroke-linecap="round" fill="#5276cf"/></g></svg>',g='<svg id="svg3790" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="9.9646mm" width="10.711mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 37.953175 35.3077"><metadata id="metadata3795"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -1017.1)"><path id="path4324" stroke-linejoin="round" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m2.6552 1051.9c-3.8175-15.253-1.7611-24.633 0-34.308h16.248v0.015c0.098-0.01 0.1952-0.01 0.2928-0.015 9.476 0.0006 18.258 7.6807 18.257 17.154-0.0005 9.4733-8.7818 17.153-18.257 17.153-0.098 0-0.1952-0.01-0.2928-0.011v0.011z" fill-rule="evenodd" stroke="#4364b2" stroke-linecap="round" fill="#5276cf"/></g></svg>',h='<svg id="svg3548" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="13.417mm" width="13.418mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 47.543997 47.542"><metadata id="metadata3553"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -1004.8)"><ellipse id="circle4271" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="23.772" ry="23.771" cy="1028.6" cx="23.772" fill="#303030"/><ellipse id="circle4273" stroke-linejoin="round" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" stroke-linecap="round" rx="18.668" ry="18.667" stroke="#3b63c9" cy="1028.6" cx="23.772" fill="#5276cf"/></g></svg>',R='<svg id="svg3461" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="22.608mm" width="22.61mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 80.114398 80.108405"><metadata id="metadata3466"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(.0000019915 -972.25)"><g id="g3514-7" fill-rule="evenodd" transform="translate(-987.45 356.91)"><ellipse id="ellipse3516-7" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="40.057" ry="40.054" cy="655.39" cx="1027.5" fill="#3b63c9"/><ellipse id="ellipse3518-7" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="36.23" ry="36.228" cy="655.39" cx="1027.5" fill="#5276cf"/></g></g></svg>',I='<svg id="svg3699" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="9.2811mm" width="9.2817mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 32.8879 32.88565"><metadata id="metadata3704"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" fill-rule="evenodd" transform="translate(0 -1019.5)"><ellipse id="ellipse4575" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="16.444" ry="16.443" cy="1035.9" cx="16.444" fill="#2e2e2e"/><ellipse id="ellipse4577" stroke-linejoin="round" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" stroke-linecap="round" rx="15.112" ry="15.11" stroke="#4364b2" cy="1035.9" cx="16.444" fill="#5276cf"/><ellipse id="ellipse4579" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="11.867" ry="11.866" cy="1035.9" cx="16.444" fill="#434343"/></g></svg>',b='<svg id="svg3560" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="4.7796mm" width="13.57mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 48.082162 16.935645"><metadata id="metadata3565"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -1035.4)"><path id="path4727" d="m42.857 1052.2c4.7071 0.4081 4.7981 0.6563 5.1414-4.9139 0.16344-2.6517 0.16699-6.1108-0.72615-8.0342-0.59471-1.2808-1.7793-2.049-3.7642-2.4662-2.5264-0.531-16.253-1.4345-26.685-1.3241-15.118 0.16-15.362 1.4769-15.855 4.1522-0.35071 1.9018-0.5016 3.5056-0.74837 5.5967-0.55261 7.0693-0.44908 7.0921 5.0452 6.5411 11.661-1.1062 25.929-0.7359 37.592 0.4484z" fill-rule="evenodd" fill="#5276cf"/></g></svg>',Y='<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="21.241671mm" height="8.8544388mm" viewBox="0 0 75.265762 31.373996" id="svg3447" version="1.1" inkscape:version="0.91 r13725" sodipodi:docname="l1.svg"><defs id="defs3449" /><sodipodi:namedview id="base" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1.0" inkscape:pageopacity="0.0" inkscape:pageshadow="2" inkscape:zoom="1.4" inkscape:cx="-254.57869" inkscape:cy="228.81952" inkscape:document-units="px" inkscape:current-layer="layer1" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:window-width="1920" inkscape:window-height="1134" inkscape:window-x="0" inkscape:window-y="27" inkscape:window-maximized="1" /><metadata id="metadata3452"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(1.5000945e-8,-1020.9882)"><path style="fill:#5276cf;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:0.99999994px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" d="m 11.026383,1051.1651 c -7.4440599,1.9144 -7.5133499,2.2466 -9.7963799,-4.4934 -1.81058997,-5.3452 -2.44278,-8.8152 4.01547,-12.116 2.74038,-1.4007 13.7365799,-5.877 38.4768299,-10.72 24.26031,-4.749 25.16653,-2.7967 26.79132,0.3418 1.15503,2.2311 1.8961,4.1561 2.94279,6.651 3.08552,8.5188 2.92609,8.5778 -6.08214,9.5501 -19.09891,2.1414 -37.95723,5.8307 -56.34789,10.7865 z" id="path4289" inkscape:connector-curvature="0" sodipodi:nodetypes="cssssccc" /></g></svg>',L='<svg id="svg3447" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="8.8544mm" width="21.242mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 75.265762 31.373996"><metadata id="metadata3452"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(1.5001e-8 -1021)"><path id="path4715" d="m64.239 1051.2c7.4441 1.9144 7.5134 2.2466 9.7964-4.4934 1.8106-5.3452 2.4428-8.8152-4.0155-12.116-2.7404-1.4007-13.737-5.877-38.477-10.72-24.26-4.749-25.167-2.7967-26.791 0.3418-1.155 2.2311-1.8961 4.1561-2.9428 6.651-3.0855 8.5188-2.9261 8.5778 6.0822 9.5501 19.099 2.1414 37.957 5.8307 56.348 10.786z" fill-rule="evenodd" fill="#5276cf"/></g></svg>',M='<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="24.603382mm" height="24.601696mm" viewBox="0 0 87.177338 87.171363" id="svg3640" version="1.1" inkscape:version="0.91 r13725" sodipodi:docname="main.svg"><defs id="defs3642" /><sodipodi:namedview id="base" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1.0" inkscape:pageopacity="0.0" inkscape:pageshadow="2" inkscape:zoom="1.979899" inkscape:cx="61.113463" inkscape:cy="69.71796" inkscape:document-units="px" inkscape:current-layer="layer1" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:window-width="1920" inkscape:window-height="1134" inkscape:window-x="0" inkscape:window-y="27" inkscape:window-maximized="1" /><metadata id="metadata3645"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(0,-965.19093)"><ellipse ry="43.585682" rx="43.588669" style="color:#000000;clip-rule:nonzero;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:#000000;solid-opacity:1;fill:#2e2e2e;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:0.99999994;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto;enable-background:accumulate" id="ellipse4372" cx="43.588669" cy="1008.7766" /><ellipse cy="1008.7766" cx="43.588669" id="circle4239-1" style="color:#000000;clip-rule:nonzero;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:#000000;solid-opacity:1;fill:#5276cf;fill-opacity:1;fill-rule:evenodd;stroke:#4364b2;stroke-width:0.99999994;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto;enable-background:accumulate" rx="40.056705" ry="40.053959" /><ellipse style="color:#000000;clip-rule:nonzero;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:#000000;solid-opacity:1;fill:#434343;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:0.99999994;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto;enable-background:accumulate" id="circle4243-0" cx="43.588669" cy="1008.7766" rx="31.455994" ry="31.453836" /></g></svg>',x='<svg id="svg3407" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="41.787mm" width="41.786mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 148.0624 148.06251"><metadata id="metadata3412"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -904.3)" fill="#e6e6e6"><path id="rect4545" d="m74.031 904.3-14.469 22.156h8.0313v8.2187h12.875v-8.2187h8.0625l-14.5-22.156z"/><path id="rect4603" d="m125.94 963.86v8.0313h-8.25v12.906h8.25v8.0313l22.125-14.5-22.125-14.469z"/><path id="rect4609" d="m67.594 1022v8.25h-8.0313l14.469 22.125 14.5-22.125h-8.0625v-8.25h-12.875z"/><path id="rect4615" d="m22.156 963.86-22.156 14.47l22.156 14.5v-8.2188h8.2188v-12.906h-8.2188v-7.8438z"/><path id="path4619" style="color:#000000;text-indent:0;block-progression:tb;text-decoration-line:none;text-transform:none" d="m54.393 924.58c-15.821 5.7885-28.404 18.385-34.188 34.219h11.156c4.6667-10.175 12.865-18.361 23.031-23.031v-11.188zm39.219 0.031v11.156c10.167 4.6713 18.361 12.86 23.031 23.031h11.156c-5.7846-15.821-18.379-28.393-34.188-34.188zm-73.375 73.438c5.7899 15.816 18.348 28.403 34.156 34.188v-11.156c-10.163-4.6691-18.364-12.861-23.031-23.031h-11.125zm96.406 0c-4.6712 10.167-12.868 18.361-23.031 23.031v11.125c15.796-5.7901 28.366-18.352 34.156-34.156h-11.125z"/></g></svg>',y='<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="112.08413mm" height="128.46834mm" viewBox="0 0 397.14849 455.20277" id="svg3440" version="1.1" inkscape:version="0.91 r13725" sodipodi:docname="wheel.svg"><defs id="defs3442" /><sodipodi:namedview id="base" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1.0" inkscape:pageopacity="0.0" inkscape:pageshadow="2" inkscape:zoom="0.98994949" inkscape:cx="421.01508" inkscape:cy="52.510802" inkscape:document-units="px" inkscape:current-layer="g87" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:window-width="1920" inkscape:window-height="1134" inkscape:window-x="0" inkscape:window-y="27" inkscape:window-maximized="1" /><metadata id="metadata3445"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title /></cc:Work></rdf:RDF></metadata><g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(-2.3645008e-8,-597.15942)"><path inkscape:connector-curvature="0" style="fill:#4d4d4d;stroke:#6e6e6e;stroke-width:2.99125171;stroke-miterlimit:4;stroke-dasharray:none" id="path4140" d="m 307.84153,715.52552 c -4.35995,43.11849 -2.78952,86.66385 -15.90234,128.54337 -10.85452,25.86023 -13.33477,47.2976 6.91492,61.09536 7.23778,50.7442 78.38013,47.39232 82.20535,0 23.06079,-14.19054 13.49405,-42.79138 6.91492,-61.09536 -17.40045,-40.83001 -4.82581,-86.43019 -15.90235,-128.54337 -8.3177,-20.33228 -56.75348,-20.7661 -64.22927,0 z" stroke-miterlimit="4" /><path inkscape:connector-curvature="0" style="fill:#cccccc;stroke:#1a1a1a;stroke-width:2.09465766;stroke-miterlimit:4;stroke-dasharray:none" id="path4266" d="m 313.11812,724.1957 -3.84514,68.80568 c 4.64168,13.40814 62.19981,10.8172 61.83082,0 l -3.84515,-68.80568 c -4.46942,-24.00369 -52.58756,-18.95946 -54.13979,0 z" stroke-miterlimit="4" /><path inkscape:connector-curvature="0" style="fill:#353535;stroke:#2c2c2c;stroke-width:2.11880326;stroke-miterlimit:4;stroke-dasharray:none" id="path4156" d="m 304.91419,870.673 c -12.36924,67.40381 80.42804,69.69607 70.55134,0 -6.57605,-36.5947 -65.0964,-34.8253 -70.55134,0 z m 60.53812,3.9862 c 8.65841,48.24354 -57.58987,49.86644 -50.52489,0 4.7009,-26.27069 46.6394,-24.84292 50.52489,0 z" stroke-miterlimit="4" /><path inkscape:connector-curvature="0" style="fill:#e6e6e6;stroke:#969696;stroke-width:2.99125171;stroke-miterlimit:4;stroke-dasharray:none" id="path4011" d="m 106.04576,696.97906 c -11.197076,4.25792 -17.123706,8.24834 -17.123706,8.24834 l -66.18493,16.33946 1.40291,30.64619 46.54715,-7.67623 c 17.00932,-1.6438 32.551896,8.94676 38.302026,23.34506 l 2.78663,65.4778 27.6363,0 2.78663,-65.4778 c 8.0428,-15.3291 20.46247,-27.10803 38.30202,-23.34506 l 46.54716,7.67623 1.40291,-30.64619 -66.18493,-16.33946 c 0,0 -5.92627,-3.99074 -17.12371,-8.24834 -13.45408,-4.31874 -26.62772,-4.20804 -39.08982,0 z" stroke-miterlimit="4" /><path inkscape:connector-curvature="0" style="fill:#252525;stroke:#6e6e6e;stroke-width:2.99125171;stroke-miterlimit:4;stroke-dasharray:none" id="path2996" d="m 38.311064,931.09899 c -8.01574,5.05649 -22.76006,21.74743 -26.34852,58.0567 -4.1290804,35.18581 -4.8394604,60.59901 28.55878,61.68771 l 162.934726,0 c 39.19437,1.1693 30.46155,-41.5992 28.55878,-61.68771 -3.58839,-36.30927 -18.33277,-52.99983 -26.34851,-58.0567 z" stroke-miterlimit="4" /><path inkscape:connector-curvature="0" style="fill:#373737;stroke:#6e6e6e;stroke-width:2.83429575;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none" id="path3019" d="m 26.230254,979.1291 c -11.50334,14.44882 -11.98241,47.3999 -0.33519,57.1202 l 191.802226,0 c 12.10111,-12.3068 9.93082,-46.99573 -0.33518,-57.1202 z" stroke-miterlimit="4" /><path inkscape:connector-curvature="0" style="fill:#808080;stroke:#1a1a1a;stroke-width:2.14882827;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0" id="path4133" d="m 360.82498,854.6914 a 20.634815,21.265151 0 1 1 -41.269,0 20.634815,21.265151 0 1 1 41.269,0 z" stroke-miterlimit="4" /><path inkscape:connector-curvature="0" style="fill:#333333;stroke:#000000;stroke-width:2.11880326;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0" id="path4280" d="m 351.64051,761.132 a 11.444622,11.75148 0 1 1 -22.88896,0 11.444622,11.75148 0 1 1 22.88896,0 z" stroke-miterlimit="4" /><path inkscape:connector-curvature="0" style="fill:#313131;stroke:#565656;stroke-width:2.93434715;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0" id="path3993" d="m 125.52855,598.62659 c -68.528026,0 -124.0613764,57.81925 -124.0613764,129.13695 0,71.31265 55.5370404,129.13696 124.0613764,129.13696 68.52804,0 124.07984,-57.81926 124.07984,-129.13696 0,-71.31264 -55.55611,-129.13695 -124.07984,-129.13695 z m -1.00095,23.63932 c 10.01261,0.0734 20.238,1.32074 28.95237,3.51006 11.62203,3.80301 21.53624,8.52304 31.01135,16.15381 26.21752,19.0207 43.36275,50.36277 43.36275,85.83029 0,58.01564 -45.80548,105.05244 -102.30928,105.05244 -56.500726,0 -102.309276,-47.03364 -102.309276,-105.05244 0,-32.14848 14.06783,-60.91918 36.22336,-80.19121 11.45168,-11.11714 23.14136,-17.13322 37.3943,-21.79731 7.855846,-2.48302 17.655666,-3.5835 27.668276,-3.51006 z" stroke-miterlimit="4" /><g style="stroke-miterlimit:4;stroke-dasharray:none" id="g4127" stroke-miterlimit="4" transform="matrix(0.61498728,0,0,0.63147657,-18.171616,453.28593)"><g id="g4111"><path style="fill:#808080;stroke:#373737;stroke-width:3.56837296" inkscape:connector-curvature="0" id="rect3040" d="m 110.97,771.16 31.694,4.8776 1.3007,44.257 -32.995,0 z" /><path style="fill:#b3b3b3;stroke:#565656;stroke-width:3.4000001;stroke-linecap:butt;stroke-linejoin:miter" inkscape:connector-curvature="0" id="path3024" d="m 96.83,686.82 58.353,-5.0761 c 15.608,27.569 6.8304,64.333 -5.0761,90.545 l -53.841,-2.538 z" /></g><g id="g4115" transform="translate(97.984785,0)"><path style="fill:#808080;stroke:#373737;stroke-width:3.56837296" inkscape:connector-curvature="0" id="path4117" d="m 110.97,771.16 31.694,4.8776 1.3007,44.257 -32.995,0 z" /><path style="fill:#b3b3b3;stroke:#565656;stroke-width:3.4000001;stroke-linecap:butt;stroke-linejoin:miter" inkscape:connector-curvature="0" id="path4119" d="m 96.83,686.82 58.353,-5.0761 c 15.608,27.569 6.8304,64.333 -5.0761,90.545 l -53.841,-2.538 z" /></g><g id="g4121" transform="translate(195.96959,0)"><path style="fill:#808080;stroke:#373737;stroke-width:3.56837296" inkscape:connector-curvature="0" id="path4123" d="m 110.97,771.16 31.694,4.8776 1.3007,44.257 -32.995,0 z" /><path style="fill:#b3b3b3;stroke:#565656;stroke-width:3.4000001;stroke-linecap:butt;stroke-linejoin:miter" inkscape:connector-curvature="0" id="path4125" d="m 96.83,686.82 58.353,-5.0761 c 15.608,27.569 6.8304,64.333 -5.0761,90.545 l -53.841,-2.538 z" /></g></g><g style="fill:#666666;stroke:#969696;stroke-width:3.99777174;stroke-miterlimit:4;stroke-dasharray:none" id="g4051" transform="translate(-42.878584,98.083591)" stroke-miterlimit="4"><g id="g4437" transform="matrix(0.74686368,0,0,0.74686368,-73.374214,285.30447)"><path inkscape:connector-curvature="0" id="rect4348" style="color:#000000;text-indent:0;text-transform:none;block-progression:tb;fill:#ffffff" d="m 567.31,584.22 0,42.25 0,3.4062 0,42.25 3.375,0 0,-42.25 27.062,0 0,42.25 3.375,0 0,-42.25 27.062,0 0,42.25 3.375,0 0,-42.25 27.062,0 0,42.25 3.4062,0 0,-43.969 0,-1.6875 -1.7188,0 -28.75,0 0,-42.25 -3.375,0 0,42.25 -27.062,0 0,-42.25 -3.375,0 0,42.25 -27.062,0 0,-42.25 -3.375,0 z" /><g style="fill:#a02c2c;stroke:#ffffff;stroke-width:3.4000001;stroke-linecap:square" id="g87" /></g></g></g></svg>',w='<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="5.4777083mm" height="5.5003009mm" viewBox="0 0 19.409203 19.489255" id="svg3402" version="1.1" inkscape:version="0.91 r13725" sodipodi:docname="wheel_btn.svg"><defs id="defs3404" /><sodipodi:namedview id="base" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1.0" inkscape:pageopacity="0.0" inkscape:pageshadow="2" inkscape:zoom="22.4" inkscape:cx="4.7324003" inkscape:cy="15.245372" inkscape:document-units="px" inkscape:current-layer="layer1" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:window-width="1920" inkscape:window-height="1134" inkscape:window-x="0" inkscape:window-y="27" inkscape:window-maximized="1" /><metadata id="metadata3407"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(8.5754969e-8,-1032.873)"><path inkscape:connector-curvature="0" style="fill:#5276cf;stroke:#000000;stroke-width:3.4000001;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;fill-opacity:1" id="path4272" d="m 17.709101,1042.6176 a 8.0046,8.0046 0 1 1 -16.0089998,0 8.0046,8.0046 0 1 1 16.0089998,0 z" stroke-miterlimit="4" /></g></svg>',U='<svg id="svg3400" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="10.507mm" width="15.1mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 53.504016 37.228838"><metadata id="metadata3405"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(-2.847e-7 -1015.1)"><path id="path4049" d="m26.584 1016.1c-12.631 0-23.15 9.858-25.478 22.922l50.705 12.18c0.47921-2.1565 0.73023-4.4099 0.73023-6.7204 0-15.677-11.621-28.382-25.957-28.382z" stroke="#5276cf" stroke-linecap="square" stroke-width="1.9247" fill="#666"/></g></svg>',C='<svg id="svg3400" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="10.507mm" width="15.1mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 53.504016 37.228838"><metadata id="metadata3405"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(-2.847e-7 -1015.1)"><path id="path4033" d="m26.92 1016.1c-14.337 0-25.957 12.707-25.957 28.382 0 2.3225 0.26742 4.5784 0.74876 6.7386l50.681-12.18c-2.321-13.072-12.841-22.944-25.476-22.944z" stroke="#5276cf" stroke-linecap="square" stroke-width="1.9247" fill="#666"/></g></svg>',D='<svg id="svg3386" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="12.859mm" width="5.2917mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 18.749999 45.562501"><metadata id="metadata3391"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -1006.8)"><path id="rect4575" d="m9.3125 1006.8-9.3125 14.25h5.3125v17.094h-5.1875l9.3125 14.219 9.3125-14.219h-5.1562v-17.094h5.0312l-9.3125-14.25z" fill="#e6e6e6"/></g></svg>',F='<svg id="svg3458" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="50.447mm" width="83.899mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 297.28131 178.75"><metadata id="metadata3463"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -873.61)" fill="#e6e6e6"><path id="path4535" style="color:#000000;text-indent:0;block-progression:tb;text-decoration-line:none;text-transform:none" d="m33.875 873.61-18.5 8.8125 5.0626 3.0625c-12.899 22.78-20.438 49.17-20.438 77.44 0 28.284 7.5315 54.691 20.438 77.469l-5.0626 3.0625 18.5 8.8125 0.6563-20.469-5.531 3.3c-12.002-21.2-18.937-45.8-18.937-72.18 0-26.362 6.9415-50.99 18.937-72.188l5.5313 3.3438-0.6563-20.469z"/><path id="path4551" style="color:#000000;text-indent:0;block-progression:tb;text-decoration-line:none;text-transform:none" d="m263.38 873.71-0.6562 20.469 5.5312-3.3438c11.996 21.198 18.969 45.825 18.969 72.188 0 26.371-6.9672 51.011-18.969 72.219l-5.5312-3.3437 0.6562 20.469 18.5-8.8125-5.0312-3.0625c12.906-22.778 20.438-49.184 20.438-77.469 0-28.275-7.5391-54.665-20.438-77.438l5.0312-3.0625-18.5-8.8125z"/></g></svg>',G='<svg id="svg3378" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="2.9016mm" width="9.2516mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 32.781198 10.281199"><metadata id="metadata3383"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -1042.1)"><path id="rect4585" d="m32.781 1047.2-7.875-5.125v2.8437h-17.031v-2.8437l-7.875 5.1 7.875 5.1562v-2.8437h17.031v2.8437z" fill="#e6e6e6"/></g></svg>',k='<svg id="svg3378" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="9.2516mm" width="2.9016mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 10.281248 32.7812"><metadata id="metadata3383"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -1019.6)"><path id="rect4585" d="m5.125 1019.6-5.125 7.9h2.8437v17.031h-2.8437l5.125 7.875 5.1562-7.875h-2.8438v-17.031h2.8438z" fill="#e6e6e6"/></g></svg>',K=[],B=-1,X=null,H=P,Q=null,z=null,V=null,j=null,q=null,W=null,J=[],Z=[],$=[],ee=[],te=!0,re={};function _e(e,t,r,n){var a=_.get_sensor_value(t,r,n)*d,o=_.get_sensor_value(t,r,n+1)*d;e.style.transform="translate3d("+a+"px, "+o+"px, 0px) rotate(0rad)"}function ne(e,t,r){if(!(r+1>2*ee.length)){var a=_.get_sensor_value(e,t,r),i=_.get_sensor_value(e,t,r+1);if(re[r]>-2){var s=a-re[r],T=i-re[r+1],u=ee[Math.floor(r/2)],d=u.getAttribute("data-svgid");if(H==P)u.style.backgroundImage=s||T?o+btoa(K[d].replace(c,E))+"')":o+btoa(K[d])+"')";else if(H==S){var f=n.get_moved_gmpd_axis(B);if(f>=0){f%2!=0&&f--,H=P,u.style.backgroundImage=o+btoa(K[d])+"')";var A=parseFloat(X.getAttribute("data-key"));n.set_gamepad_key(B,A,f),n.set_gamepad_key(B,A+1,f+1),X=null,document.getElementById("action_label").textContent=l}}}re[r]=a,re[r+1]=i}}function ae(e,t,r){if(!(r>=ee.length)){var a=_.get_sensor_value(e,t,r);if(re[r]>-2){var i=a-re[r],s=ee[r],T=s.getAttribute("data-svgid");if(H==P)s.style.backgroundImage=i?o+btoa(K[T].replace(c,E))+"')":o+btoa(K[T])+"')";else if(H==S){var u=n.get_moved_gmpd_axis(B);if(u>=0){H=P,s.style.backgroundImage=o+btoa(K[T])+"')";var d=parseFloat(X.getAttribute("data-key"));n.set_gamepad_key(B,d,u),X=null,document.getElementById("action_label").textContent=l}}}re[r]=a}}function oe(e,t,r){if(H==P){if(t&&"B"==e.getAttribute("data-colorstate")){var _=K[r];e.style.backgroundImage=o+btoa(_.replace(i,E))+"')",e.setAttribute("data-colorstate","G")}t||"B"==e.getAttribute("data-colorstate")||(_=K[r],e.style.backgroundImage=o+btoa(_)+"')",e.setAttribute("data-colorstate","B"))}else{var s=n.get_pressed_gmpd_btn(B);if(s>=0&&X&&H==A){var c=X.getAttribute("data-key");n.set_gamepad_key(B,c,s),function(e,t){var r=a.get(B+"_gmpd_stngs","b4w")||"{}",_=JSON.parse(r);_[e]=t,a.set(B+"_gmpd_stngs",JSON.stringify(_),"b4w")}(c,s),X=null,document.getElementById("action_label").textContent=l,H=P}}}function ie(){J.length=0;for(var e=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads:[],t=0;t<e.length;t++)e[t]&&J.push(e[t]);return J}function se(e){var t=a.get(e+"_gmpd_stngs","b4w");t?function(e,t){for(var r in e)n.set_gamepad_key(t,r,e[r])}(JSON.parse(t),e):function(e){var t=JSON.stringify(f);a.set(e+"_gmpd_stngs",t,"b4w")}(e)}function Ee(e){te=!0;var t=document.createElement("div"),r=document.createElement("div"),_=document.createElement("div"),a=document.createElement("div"),s=document.createElement("div"),E=document.createElement("div"),l=document.createElement("div"),T=document.createElement("div"),u=document.createElement("div"),d=document.createElement("div"),f=document.createElement("div"),P=document.createElement("div"),A=document.createElement("div"),S=document.createElement("div"),y=document.createElement("div"),w=document.createElement("div"),U=document.createElement("div"),C=document.createElement("div"),D=document.createElement("div"),F=document.createElement("div"),G=document.createElement("div"),k=document.createElement("div");z=t,t.style.cssText="position: absolute;height: auto;background-image: "+o+btoa(p)+"');width: 637px;height: 455px;background-size: 100% 100%;left: 50%;margin-bottom: 40px;-moz-transform: translateX(-50%);-ms-transform: translateX(-50%);-webkit-transform: translateX(-50%);bottom: 0px;",r.style.cssText="background-image: "+o+btoa(m)+"');position: absolute;top: 47px;left: 65px;width: 135px;height: 135px;",_.style.cssText="background-image: "+o+btoa(O)+"');width: 36px;height: 38px;left: 49px;top: 8px;position: absolute;",a.style.cssText="background-image: "+o+btoa(v)+"');width: 38px;height: 36px;top: 47px;left: 84px;position: absolute;",s.style.cssText="background-image: "+o+btoa(N)+"');width: 36px;height: 38px;bottom: 11px;left: 51px;position: absolute;",E.style.cssText="background-image: "+o+btoa(g)+"');width: 38px;height: 36px;top: 47px;left: 13px;position: absolute;",l.style.cssText="position: absolute;top: 55px;left: 434px;width: 150px;height: 150px;",T.style.cssText="background-image: "+o+btoa(h)+"');width: 50px;height: 50px;left: 53px;top: 0px;position: absolute;",u.style.cssText="background-image: "+o+btoa(h)+"');width: 50px;height: 50px;left: 107px;top: 51px;position: absolute;",d.style.cssText="background-image: "+o+btoa(h)+"');width: 50px;height: 50px;left: 53px;bottom: 0px;position: absolute;",f.style.cssText="background-image: "+o+btoa(h)+"');width: 50px;height: 50px;top: 51px;position: absolute;",P.style.cssText="background-image: "+o+btoa(R)+"');position: absolute;top: 222px;left: 183px;width: 85px;height: 85px;",A.style.cssText="background-image: "+o+btoa(R)+"');position: absolute;top: 223px;left: 376px;width: 85px;height: 85px;",S.style.cssText="background-image: "+o+btoa(I)+"');position: absolute;top: 76px;left: 227px;width: 34px;height: 34px;",y.style.cssText="background-image: "+o+btoa(I)+"');position: absolute;top: 76px;left: 376px;width: 34px;height: 34px;",w.style.cssText="background-image: "+o+btoa(Y)+"');position: absolute;top: 4px;left: 78px;width: 79px;height: 33px;",U.style.cssText="background-image: "+o+btoa(L)+"');position: absolute;top: 4px;left: 477px;width: 79px;height: 33px;",C.style.cssText="background-image: "+o+btoa(b)+"');position: absolute;top: -7px;left: 425px;width: 50px;height: 17px;",D.style.cssText="background-image: "+o+btoa(b)+"');position: absolute;top: -7px;left: 164px;width: 50px;height: 17px;",F.style.cssText="background-image: "+o+btoa(M)+"');position: absolute;top: 68px;left: 274px;width: 92px;height: 92px;",G.style.cssText="background-image: "+o+btoa(x)+"');position: absolute;top: 186px;left: 148px;width: 157px;height: 157px;",k.style.cssText="background-image: "+o+btoa(x)+"');position: absolute;top: 187px;left: 339px;width: 157px;height: 157px;",t.appendChild(G),t.appendChild(k),r.appendChild(_),r.appendChild(a),r.appendChild(s),r.appendChild(E),t.appendChild(r),l.appendChild(T),l.appendChild(u),l.appendChild(d),l.appendChild(f),t.appendChild(l),t.appendChild(P),t.appendChild(A),t.appendChild(S),t.appendChild(y),t.appendChild(w),t.appendChild(U),t.appendChild(C),e.appendChild(t),t.appendChild(D),t.appendChild(F),Z.length=0,K.length=0,$.length=0,ee.length=0,Z.push(d,u,f,T,w,U,D,C,S,y,P,A,_,s,E,a,F),K.push(h,h,h,h,Y,L,b,b,I,I,R,R,O,N,g,v,M),$.push(P,P,A,A),ee.push(G,k);for(var B=0;B<Z.length;B++)Z[B].setAttribute("id","pad_btn_"+B),Z[B].setAttribute("data-colorstate","B"),Z[B].setAttribute("data-key",B),Z[B].setAttribute("data-svgid",B);G.setAttribute("id","pad_left_axis"),G.setAttribute("data-colorstate","GR"),G.setAttribute("data-key",n.GMPD_AXIS_0),G.setAttribute("data-svgid",K.length),k.setAttribute("id","pad_right_axis"),k.setAttribute("data-colorstate","GR"),k.setAttribute("data-key",n.GMPD_AXIS_2),k.setAttribute("data-svgid",K.length+1),K.push(x,x),ue(Z,i),ue(ee,c)}function ce(e){return[_.create_gamepad_axis_sensor(n.GMPD_AXIS_0,e),_.create_gamepad_axis_sensor(n.GMPD_AXIS_1,e),_.create_gamepad_axis_sensor(n.GMPD_AXIS_2,e),_.create_gamepad_axis_sensor(n.GMPD_AXIS_3,e),_.create_gamepad_axis_sensor(n.GMPD_AXIS_4,e),_.create_gamepad_axis_sensor(n.GMPD_AXIS_5,e),_.create_gamepad_axis_sensor(n.GMPD_AXIS_6,e),_.create_gamepad_axis_sensor(n.GMPD_AXIS_7,e),_.create_gamepad_axis_sensor(n.GMPD_AXIS_8,e),_.create_gamepad_axis_sensor(n.GMPD_AXIS_9,e),_.create_gamepad_axis_sensor(n.GMPD_AXIS_10,e),_.create_gamepad_axis_sensor(n.GMPD_AXIS_11,e)]}function le(e,t){var r=document.createElement("input");r.style.cssText="display: inline-block;position = relative;",r.setAttribute("type","radio"),r.setAttribute("name","choice");var _=document.createElement("label");return _.textContent=t,_.style.cssText="position = relative;display: inline-block;color: white;",e.appendChild(r),e.appendChild(_),r}function Te(e){switch(Q.removeChild(z),z=null,e){case"PAD":q.checked=!0,Ee(Q);break;case"WHEEL":j.checked=!0,function(e){te=!1;var t=document.createElement("div"),r=document.createElement("div"),_=document.createElement("div"),a=document.createElement("div"),s=document.createElement("div"),E=document.createElement("div"),l=document.createElement("div"),T=document.createElement("div"),u=document.createElement("div"),d=document.createElement("div"),f=document.createElement("div"),P=document.createElement("div"),A=document.createElement("div"),S=document.createElement("div"),p=document.createElement("div"),m=document.createElement("div"),O=document.createElement("div"),v=document.createElement("div"),N=document.createElement("div"),g=document.createElement("div"),h=document.createElement("div"),R=document.createElement("div"),I=document.createElement("div"),b=document.createElement("div"),Y=document.createElement("div"),L=document.createElement("div"),M=document.createElement("div"),x=document.createElement("div"),B=document.createElement("div"),X=document.createElement("div");z=t;var H="position: absolute;height: auto;background-image: "+o+btoa(w)+"');width: 19px;height: 19px;background-size: 100% 100%;";t.style.cssText="position: absolute;background-image: "+o+btoa(y)+"');width: 397px;height: 455px;-moz-transform: translateX(-50%);-ms-transform: translateX(-50%);-webkit-transform: translateX(-50%);transform: translateX(-50%);background-size: 100% 100%;left: 50%;margin-left: 25px;margin-bottom: 40px;bottom: 0px;",r.style.cssText=H+"top: 132px;left: 331px;",_.style.cssText=H+"top: 122px;left: 315px;",a.style.cssText=H+"top: 122px;left: 347px;",s.style.cssText=H+"top: 113px;left: 331px;",E.style.cssText="position: absolute;height: auto;background-image: "+o+btoa(U)+"');width: 54px;height: 37px;background-size: 100% 100%;top: 84px;left: 166px;",l.style.cssText="position: absolute;height: auto;background-image: "+o+btoa(C)+"');width: 54px;height: 37px;background-size: 100% 100%;top: 84px;left: 36px;",T.style.cssText=H+"top: 107px;left: 141px;",u.style.cssText=H+"top: 107px;left: 90px;",d.style.cssText=H+"top: 185px;left: 321px;",f.style.cssText=H+"top: 185px;left: 340px;",P.style.cssText=H+"top: 179px;left: 358px;",A.style.cssText=H+"top: 178px;left: 303px;",S.style.cssText=H+"top: 210px;left: 299px;",p.style.cssText=H+"top: 279px;left: 299px;",m.style.cssText=H+"top: 210px;left: 321px;",O.style.cssText=H+"top: 279px;left: 321px;",v.style.cssText=H+"top: 210px;left: 344px;",N.style.cssText=H+"top: 278px;left: 344px;",g.style.cssText=H+"top: 124px;left: 147px;",h.style.cssText=H+"top: 138px;left: 133px;",R.style.cssText=H+"top: 124px;left: 82px;",I.style.cssText=H+"top: 138px;left: 96px;",b.style.cssText=H+"top: 278px;left: 367px;";var Q="position: absolute;background-image: "+o+btoa(D)+"');width: 19px;height: 46px;background-size: 100% 100%;";Y.style.cssText=Q+"top: 291px;left: 50px;",L.style.cssText=Q+"top: 291px;left: 111px;",M.style.cssText=Q+"top: 291px;left: 171px;",x.style.cssText="position: absolute;background-image: "+o+btoa(F)+"');width: 297px;height: 179px;background-size: 100% 100%;top: 43px;left: -25px;",B.style.cssText="position: absolute;background-image: "+o+btoa(G)+"');width: 33px;height: 10px;background-size: 100% 100%;top: 159px;left: 324px;",X.style.cssText="position: absolute;background-image: "+o+btoa(k)+"');width: 10px;height: 33px;background-size: 100% 100%;top: 148px;left: 335px;",e.appendChild(t),t.appendChild(Y),t.appendChild(L),t.appendChild(M),t.appendChild(x),t.appendChild(B),t.appendChild(X),t.appendChild(r),t.appendChild(_),t.appendChild(a),t.appendChild(s),t.appendChild(E),t.appendChild(l),t.appendChild(T),t.appendChild(u),t.appendChild(d),t.appendChild(f),t.appendChild(P),t.appendChild(A),t.appendChild(S),t.appendChild(p),t.appendChild(m),t.appendChild(O),t.appendChild(v),t.appendChild(N),t.appendChild(g),t.appendChild(h),t.appendChild(R),t.appendChild(I),t.appendChild(b),Z.length=0,K.length=0,$.length=0,ee.length=0,Z.push(r,_,a,s,E,l,T,u,d,f,P,A,S,p,m,O,v,N,g,h,R,I,b),K.push(w,w,w,w,U,C,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w),ee.push(x,Y,M,L,B,X);for(var V=0;V<Z.length;V++)Z[V].setAttribute("id","wheel_btn_"+V),Z[V].setAttribute("data-colorstate","B"),Z[V].setAttribute("data-key",V),Z[V].setAttribute("data-svgid",V);for(V=0;V<ee.length;V++)Z[V].setAttribute("id","wheel_axis_"+V),Z[V].setAttribute("data-colorstate","GR");x.setAttribute("data-key",n.GMPD_AXIS_0),x.setAttribute("data-svgid",K.length),Y.setAttribute("data-key",n.GMPD_AXIS_1),Y.setAttribute("data-svgid",K.length+1),M.setAttribute("data-key",n.GMPD_AXIS_2),M.setAttribute("data-svgid",K.length+2),L.setAttribute("data-key",n.GMPD_AXIS_3),L.setAttribute("data-svgid",K.length+3),B.setAttribute("data-key",n.GMPD_AXIS_4),B.setAttribute("data-svgid",K.length+4),X.setAttribute("data-key",n.GMPD_AXIS_5),X.setAttribute("data-svgid",K.length+5),K.push(F,D,D,D,G,k),ue(Z,i),ue(ee,c)}(Q)}}function ue(e,t){for(var r=function(e){var r=e.target;if(!(B<0||"G"==r.getAttribute("data-colorstate")))if(H!=P){if("R"==r.getAttribute("data-colorstate")&&(X=null,document.getElementById("action_label").textContent=l,H=P),"B"==r.getAttribute("data-colorstate")||"GR"==r.getAttribute("data-colorstate")){var _=parseFloat(X.getAttribute("data-svgid"));X.style.backgroundImage=o+btoa(K[_])+"')",X.setAttribute("data-colorstate",r.getAttribute("data-colorstate")),X=r,_=parseFloat(r.getAttribute("data-svgid")),r.style.backgroundImage=o+btoa(K[_].replace(t,s))+"')",r.setAttribute("data-colorstate","R")}}else{_=parseFloat(r.getAttribute("data-svgid"));var n="B"==r.getAttribute("data-colorstate")?A:S;H=n,r.style.backgroundImage=o+btoa(K[_].replace(t,s))+"')",r.setAttribute("data-colorstate","R"),document.getElementById("action_label").textContent=n==A?T:u,X=r}},_=0;_<e.length;_++)n.add_click_listener(e[_],r)}function de(){var e=window.innerWidth,t=window.innerHeight;Q.style.zoom=t<=750&&t>400||e<=750&&e>400?"0.5":e<=400||t<=400?"0.3":"1"}re[n.GMPD_AXIS_0]=-2,re[n.GMPD_AXIS_1]=-2,re[n.GMPD_AXIS_2]=-2,re[n.GMPD_AXIS_3]=-2,re[n.GMPD_AXIS_4]=-2,re[n.GMPD_AXIS_5]=-2,re[n.GMPD_AXIS_6]=-2,re[n.GMPD_AXIS_7]=-2,re[n.GMPD_AXIS_8]=-2,re[n.GMPD_AXIS_9]=-2,re[n.GMPD_AXIS_10]=-2,re[n.GMPD_AXIS_11]=-2,t.show=function(){var e=document.createElement("div");Q=e,e.style.cssText="position: absolute;width: 720px;height: 750px;top: 50%;left: 50%;-moz-transform: translateY(-50%) translateX(-50%);-ms-transform: translateY(-50%) translateX(-50%);-webkit-transform: translateY(-50%) translateX(-50%);transform: translateY(-50%) translateX(-50%);background-color: black;border: 4px solid white;border-radius: 35px;box-shadow: 0px 0px 20px 0px rgba(50, 50, 50, 1);",r.insert_to_container(e,"LAST"),Ee(e);var t=document.createElement("div");t.style.cssText="position: absolute;width: 637px;top: 0px;font-family: sans-serif;text-align: center;margin-top: 40px;-moz-transform: translateX(-50%);-ms-transform: translateX(-50%);-webkit-transform: translateX(-50%);transform: translateX(-50%);left: 50%;";var a,o=document.createElement("div");o.innerHTML="Select a device",o.style.cssText="color: #fff;display: inline-block;",t.appendChild(o);for(var i=0;i<4;i++){var s=[_.create_gamepad_btn_sensor(n.GMPD_BUTTON_0,a=i),_.create_gamepad_btn_sensor(n.GMPD_BUTTON_1,a),_.create_gamepad_btn_sensor(n.GMPD_BUTTON_2,a),_.create_gamepad_btn_sensor(n.GMPD_BUTTON_3,a),_.create_gamepad_btn_sensor(n.GMPD_BUTTON_4,a),_.create_gamepad_btn_sensor(n.GMPD_BUTTON_5,a),_.create_gamepad_btn_sensor(n.GMPD_BUTTON_6,a),_.create_gamepad_btn_sensor(n.GMPD_BUTTON_7,a),_.create_gamepad_btn_sensor(n.GMPD_BUTTON_8,a),_.create_gamepad_btn_sensor(n.GMPD_BUTTON_9,a),_.create_gamepad_btn_sensor(n.GMPD_BUTTON_10,a),_.create_gamepad_btn_sensor(n.GMPD_BUTTON_11,a),_.create_gamepad_btn_sensor(n.GMPD_BUTTON_12,a),_.create_gamepad_btn_sensor(n.GMPD_BUTTON_13,a),_.create_gamepad_btn_sensor(n.GMPD_BUTTON_14,a),_.create_gamepad_btn_sensor(n.GMPD_BUTTON_15,a),_.create_gamepad_btn_sensor(n.GMPD_BUTTON_16,a),_.create_gamepad_btn_sensor(n.GMPD_BUTTON_17,a),_.create_gamepad_btn_sensor(n.GMPD_BUTTON_18,a),_.create_gamepad_btn_sensor(n.GMPD_BUTTON_19,a),_.create_gamepad_btn_sensor(n.GMPD_BUTTON_20,a),_.create_gamepad_btn_sensor(n.GMPD_BUTTON_21,a),_.create_gamepad_btn_sensor(n.GMPD_BUTTON_22,a),_.create_gamepad_btn_sensor(n.GMPD_BUTTON_23,a),_.create_gamepad_btn_sensor(n.GMPD_BUTTON_24,a),_.create_gamepad_btn_sensor(n.GMPD_BUTTON_25,a)],E=function(){return!0};_.create_sensor_manifold(null,i,_.CT_CONTINUOUS,s,E,function(e,t,r){if(t==B)for(var n=0;n<Z.length;n++)oe(Z[n],_.get_sensor_value(e,t,n),n)})}ie().length>0&&(B=0);var c,T,u=[],d=document.createElement("div");d.style.cssText="margin-top: 20px;";for(var f=0;f<4;f++){var P=(c=f,T=void 0,(T=document.createElement("label")).style.cssText="position: relative;display: inline-block;width: 50px;color: white;margin: 0 10px;font-size: 36px;line-height: 50px;background-color: black;border: 3px solid white;border-radius: 5px;height: 50px;",T.textContent=c,T);f==B&&(P.style.backgroundColor="green",V=P),se(f),d.appendChild(P),P.setAttribute("data-device_type","PAD"),u.push(P),n.add_click_listener(P,function(e){for(var t=ie(),r=e.target,_=0;_<t.length;_++)u[_]==r&&(V=r,se(B=_),Te(r.getAttribute("data-device_type")))})}t.appendChild(d),(W=document.createElement("label")).style.cssText="position: relative;display: block;color: white;",t.appendChild(W);var A=document.createElement("div");A.style.cssText="margin-top: 20px;";var S=le(A,"Pad"),p=le(A,"Wheel");S.setAttribute("checked","true"),S.onchange=function(){Te("PAD"),V&&V.setAttribute("data-device_type","PAD")},p.onchange=function(){Te("WHEEL"),V&&V.setAttribute("data-device_type","WHEEL")},S.setAttribute("id","test"),q=S,j=p;var m=document.createElement("label");m.style.cssText+="color: #fff;display: block;",A.appendChild(m),m.textContent=l,m.setAttribute("id","action_label"),t.appendChild(A),e.appendChild(t);var O=_.create_elapsed_sensor();for(_.create_sensor_manifold(null,"UPDATE_GAMEPAD_DATA",_.CT_CONTINUOUS,[O],E,function(e,t,r){var _=ie(),n=_.length;-1==B&&_.length&&(V=u[B=_[0].index]);for(var a=0;a<u.length;a++)a<n?(u[a].textContent=_[a].index,u[a]==V?(u[a].style.backgroundColor="green",W.textContent="Selected device: "+_[a].index+". Data: "+_[a].id):u[a].style.backgroundColor="blue"):u[a].style.backgroundColor="black";n||(B=-1,W.textContent="")}),i=0;i<4;i++)s=ce(i),_.create_sensor_manifold(null,"AXES"+i,_.CT_CONTINUOUS,s,function(){return!0},function(e,t,r){if(t=="AXES"+B){for(var _=0;_<$.length;_+=2)_e($[_],e,t,_);if(te)for(_=0;_<12;_+=2)ne(e,t,_);else for(_=0;_<12;_++)ae(e,t,_)}});de(),window.addEventListener("resize",de)},t.hide=function(){H=P,B=-1,V=null,X=null,j=null,q=null,$.length=0,Z.length=0,ee.length=0,r.get_container().removeChild(Q),Q=null,_.remove_sensor_manifold(null,"UPDATE_GAMEPAD_DATA");for(var e=0;e<4;e++)_.remove_sensor_manifold(null,e),_.remove_sensor_manifold(null,"AXES"+e);window.removeEventListener("resize",de)},t.update=function(){for(var e=0;e<4;e++)se(e)}}),xE=A("gyroscope",function(e,t){var r=iE(e),_=TE(e),n=OE(e),a=vE(e),o=NE(e),i=new Float32Array(3),s=new Float32Array(3),E=ve(),c=o.deg_to_rad(110),l=o.deg_to_rad(70),T=o.deg_to_rad(70),u=-o.deg_to_rad(70);t.enable_camera_rotation=function(){var e,t,d,f;e=n.get_active_camera(),t=_.create_gyro_angles_sensor(),d=_.create_gyro_quat_sensor(),f=!0,_.create_sensor_manifold(e,"CAMERA_ROTATE_GYRO",_.CT_CONTINUOUS,[t,d],null,function(e,t,n){if(n>0)if(r.is_eye_camera(e)){var d=_.get_sensor_payload(e,t,1),P=We(o.AXIS_MY,d,E);r.set_vertical_axis(e,P),a.set_rotation_v(e,d)}else{s=_.get_sensor_payload(e,t,0),f&&(i[0]=s[0],i[1]=s[1],i[2]=s[2],f=!1);var A=0,S=0;0==window.orientation&&(A=s[1]-i[1],S=s[0]-i[0],s[1]>l&&s[1]<c&&(S=0)),180==window.orientation&&(A=s[1]-i[1],s[1]<0&&(A=-A),S=i[0]-s[0],(A>Math.PI/2||A<-Math.PI/2)&&(A=0),s[1]>-c&&s[1]<-l&&(S=0)),-90==window.orientation&&(((A=s[0]-i[0])>Math.PI/2||A<-Math.PI/2)&&(A=0),S=i[1]-s[1],(s[0]>T||s[0]<u)&&(S=0)),90==window.orientation&&(((A=i[0]-s[0])>Math.PI/2||A<-Math.PI/2)&&(A=0),S=s[1]-i[1],(s[0]>T||s[0]<u)&&(S=0)),r.rotate_camera(e,S,A),i[0]=s[0],i[1]=s[1],i[2]=s[2]}})},t.disable_camera_rotation=function(){var e=n.get_active_camera();_.remove_sensor_manifold(e,"CAMERA_ROTATE_GYRO")}}),yE=A("hmd_conf",function(e,t){var r=lE(e),_=TE(e),n=PE(e),a=ga(e),o=LE(e),i=NE(e),s=!1,E=null,c=null,l=null,T=!0,u={profile:"custom",first_distortion:0,second_distortion:0,bevel_size:0,screen_width:0,screen_height:0,screen_lense:0,ipd:0,baseline:0},d=.34,f=.55,P=4,A=110,S=65,p=50,m=64,O=32,v=25.4,N=/iPad|iPhone|iPod/.test(navigator.platform),g=.001,h={oculus_dk2:{name:"Oculus Rift DK2",type:2,first_distortion:.22,second_distortion:.28},cardboard_1:{name:"Cardboard (2014)",type:1,ipd:60,baseline:35,screen_lense:42,first_distortion:.441,second_distortion:.156},cardboard_2:{name:"Cardboard (2015)",type:1,ipd:64,baseline:35,screen_lense:39,first_distortion:.34,second_distortion:.55},custom:{name:"Custom",type:0,ipd:64,baseline:35,screen_lense:39,first_distortion:0,second_distortion:0}},R=[{label:"Tray to lens-center distance.",is_mobile:!0,inputs:[{id:"baseline",max:"50",step:"0.5"}]},{label:"Interpupillary distance.",is_mobile:!0,inputs:[{id:"ipd",max:"100",step:"1"}]},{label:"Screen to lense distance.",is_mobile:!0,inputs:[{id:"screen_lense",max:"100",step:"1"}]},{label:"Screen height.",is_mobile:!0,inputs:[{id:"screen_height",max:"150",step:"1"}]},{label:"Screen width.",is_mobile:!0,inputs:[{id:"screen_width",max:"200",step:"1"}]},{label:"Bevel width.",is_mobile:!0,inputs:[{id:"bevel_size",max:"20",step:"1"}]},{label:"Distortion coefficients.",inputs:[{id:"first_distortion",max:"1.0",step:"0.01"},{id:"second_distortion",max:"1.0",step:"0.01"}]}];function I(){if(!n.can_use_device(n.DEVICE_HMD))return!1;var e=n.get_device_by_type_element(n.DEVICE_HMD),t=n.get_value_param(e,n.HMD_WEBVR_TYPE);return t&(n.HMD_NON_WEBVR|n.HMD_WEBVR_MOBILE|n.HMD_WEBVR_DESKTOP)&&!(t&n.HMD_WEBVR1)}function b(e){var t=e.target.value,r=h[t];for(var _ in u)if(_ in r){var n=document.getElementById(_+"_slider");n&&(n.disabled="custom"!==t,n.value=r[_]);var a=document.getElementById(_+"_number");a&&(a.disabled="custom"!==t,a.value=r[_]),u[_]=r[_]}}function Y(){_.remove_sensor_manifold(null,"UPDATE_HMD_RENDERING"),x(),w(),s&&(s=!1,r.get_container().removeChild(E),document.head.removeChild(c),E=null,l=null,c=null)}function L(){x(!0),w(),function(){for(var e in u){var t=document.getElementById(e+"_slider");t&&(t.value=u[e]);var r=document.getElementById(e+"_number");r&&(r.value=u[e])}}()}function M(e,t,r,_){return e.ua&&t.indexOf(e.ua)>=0||!e.ua&&e.res&&e.res[0]&&e.res[1]&&Math.min(r,_)==Math.min(e.res[0],e.res[1])&&Math.max(r,_)==Math.max(e.res[0],e.res[1])}function x(e){var t=navigator.userAgent||navigator.vendor||window.opera,r=Math.max(window.screen.width,window.screen.height)*window.devicePixelRatio,_=Math.min(window.screen.width,window.screen.height)*window.devicePixelRatio,n=0,i=0,s=0,E=function(e,t,r,_){if(1!=e.format||!e.devices||!e.devices.length)return a.error("DPDB isn't correct."),-1;for(var n=0;n<e.devices.length;n++){var o=e.devices[n];if(o.rules&&("ios"==o.type&&N||"android"==o.type)){for(var i=!1,s=0;s<o.rules.length;s++)if(M(o.rules[s],t,r,_)){i=!0;break}if(i)return n}}return-1}(G,t,r,_);if(-1!=E){var c=G.devices[E],l=c.dpi[1]||c.dpi;n=Math.round(r*v/(c.dpi[0]||c.dpi)),i=Math.round(_*v/l),s=Math.round(c.bw)}var g=o.get("hmd_conf","b4w"),h=JSON.parse(g||"{}");e?(u.first_distortion=d,u.second_distortion=f,u.bevel_size=s||P,u.screen_width=n||A,u.screen_height=i||S,u.screen_lense=p,u.ipd=m,u.baseline=O):(u.first_distortion="first_distortion"in h?parseFloat(h.first_distortion):d,u.second_distortion="second_distortion"in h?parseFloat(h.second_distortion):f,u.bevel_size="bevel_size"in h?parseFloat(h.bevel_size):s||P,u.screen_width="screen_width"in h?parseFloat(h.screen_width):n||A,u.screen_height="screen_height"in h?parseFloat(h.screen_height):i||S,u.screen_lense="screen_lense"in h?parseFloat(h.screen_lense):p,u.ipd="ipd"in h?parseFloat(h.ipd):m,u.baseline="baseline"in h?parseFloat(h.baseline):O),T=!0}function y(){o.set("hmd_conf",JSON.stringify(u),"b4w"),Y()}function w(){if(T){var e=n.get_device_by_type_element(n.DEVICE_HMD);e&&(n.set_config(e,n.HMD_DISTORTION,[u.first_distortion,u.second_distortion]),n.get_value_param(e,n.HMD_WEBVR_TYPE)&(n.HMD_NON_WEBVR|n.HMD_WEBVR_MOBILE)&&(n.set_config(e,n.HMD_BEVEL_SIZE,u.bevel_size*g),n.set_config(e,n.HMD_SCREEN_WIDTH,u.screen_width*g),n.set_config(e,n.HMD_SCREEN_HEIGHT,u.screen_height*g),n.set_config(e,n.HMD_SCREEN_LENS_DIST,u.screen_lense*g),n.set_config(e,n.HMD_EYE_DISTANCE,u.ipd*g),n.set_config(e,n.HMD_BASELINE_DIST,u.baseline*g))),T=!1}}function U(e){var t=e.target.id.split("_"),r=t.splice(0,t.length-1).join("_");r in u&&u[r]!=e.target.value&&(T=!0,u[r]=e.target.value,document.getElementById(r+"_slider").value=e.target.value,document.getElementById(r+"_number").value=e.target.value)}function C(e,t){var r=document.createElement("div"),_=document.createElement("label");_.className="text_label";var n="8px";t%2&&(n="0"),_.style.cssText="background-color: #323232;border: 2px solid rgba(98, 98, 98, .2);border-radius: 2px;width: 100%;height: 30px;display: block;font-size: 16px;font-weight: normal;color: #fff;cursor: pointer;text-decoration: none;text-align: left;padding-left: 8px;line-height: 28px;margin-bottom: 4px;box-shadow: 0px 0px 4px 0px rgba(98, 98, 98, .8);",_.textContent=e.label,r.appendChild(_),r.style.cssText="margin-top: 16px;float: left;width: 240px;margin-right: "+n+";border-top: 2px solid rgba(98, 98, 98, .4);box-sizing: border-box;-webkit-box-sizing: border-box;padding-top: 8px;";for(var a=0;a<e.inputs.length;a++){var o=D(e.inputs[a]);r.appendChild(o)}return r}function D(e){var t=document.createElement("div");t.className="row";var r=document.createElement("input");r.className="input_slider",r.style.cssText="-webkit-appearance: none;width: 192px;display: block;float: left;height: 8px;margin-bottom: 16px;margin-top: 16px;box-sizing: border-box;margin-right: 8px;margin-left: 0;",r.setAttribute("id",e.id+"_slider"),r.setAttribute("type","range"),r.setAttribute("min","0.00"),r.setAttribute("step",e.step),r.setAttribute("value",u[e.id]),r.setAttribute("max",e.max),t.appendChild(r);var _=document.createElement("input");return _.className="input_text",_.setAttribute("id",e.id+"_number"),_.setAttribute("type","number"),_.setAttribute("min","0.00"),_.setAttribute("step",e.step),_.setAttribute("value",u[e.id]),_.setAttribute("max",e.max),t.appendChild(_),_.style.cssText="background-color: #323232;border: 2px solid rgba(98, 98, 98, .2);border-radius: 2px;width: 40px;height: 30px;display: block;float: left;font-size: 16px;font-weight: normal;color: #fff;cursor: pointer;text-decoration: none;text-align: center;box-sizing: border-box;line-height: 28px;margin-top: 4px;margin-right: 0;margin-left: 0;box-shadow: 0px 0px 4px 0px rgba(98, 98, 98, .8);",i.is_ie11()?(r.onchange=U,_.onchange=U):(r.oninput=U,_.oninput=U),t}function F(e,t,r){var _=document.createElement("button");return _.onclick=e,_.style.cssText="background-color: #323232;border: 2px solid rgba(98, 98, 98, .2);border-radius: 2px;width: 160px;height: 30px;display: block;float: left;font-size: 16px;font-weight: normal;color: #fff;cursor: pointer;text-decoration: none;text-align: center;padding-left: 8px;line-height: 28px;margin-right:"+r+";box-shadow: 0px 0px 4px 0px rgba(98, 98, 98, .8);",_.innerHTML=t,_}t.check=I,t.show=function(e){if(I()){var t=r.get_container();if((c=document.createElement("style")).innerHTML="."+e+" input[type=range]::-webkit-slider-runnable-track {width: 100%; height: 8px;cursor: pointer;background-color: #fff;border: 2px solid rgba(98, 98, 98, .2);box-shadow: 0px 0px 4px 0px rgba(98, 98, 98, .8);}."+e+" input[type=range]::-webkit-slider-thumb {box-shadow: 0px 0px 4px 0px rgba(98, 98, 98, .8);height: 30px;width: 16px;border-radius: 2px;background-color: #323232;cursor: pointer;margin-top: -13px;-webkit-appearance: none;}",document.head.appendChild(c),!s){s=!0,x();var a=n.get_device_by_type_element(n.DEVICE_MOUSE,t);n.switch_prevent_default(a,!1);var T=n.get_device_by_type_element(n.DEVICE_TOUCH,t);n.switch_prevent_default(T,!1),(E=document.createElement("div")).className=e,t.appendChild(E),l=document.createElement("div"),E.appendChild(l),l.style.cssText="background-color: #484848;border: 2px solid rgba(150, 150, 150, 0.7);box-shadow: 0px 0px 10px 0px rgba(150, 150, 150, 0.7);position: relative;width: 524px;padding: 16px;overflow: hidden;";var u=function(){var e=o.get("hmd_conf","b4w"),t=JSON.parse(e||"{}").profile||"custom",r=document.createElement("div"),_=document.createElement("label");_.innerHTML="Profile: ",_.className="text_label",_.style.cssText="background-color: #323232;border: 2px solid rgba(98, 98, 98, .2);border-radius: 2px;width: 120px;height: 30px;display: block;float: left;font-size: 16px;font-weight: normal;color: #fff;cursor: pointer;text-decoration: none;text-align: left;padding-left: 8px;line-height: 28px;margin-bottom: 4px;box-shadow: 0px 0px 4px 0px rgba(98, 98, 98, .8);",r.appendChild(_);var a=document.createElement("select");r.appendChild(a),a.style.cssText="background-color: #323232;border: 2px solid rgba(98, 98, 98, .2);border-radius: 2px;height: 30px;display: block;font-size: 16px;font-weight: normal;color: #fff;cursor: pointer;text-decoration: none;text-align: left;padding-left: 8px;line-height: 28px;margin-bottom: 4px;box-shadow: 0px 0px 4px 0px rgba(98, 98, 98, .8);";var s=n.get_device_by_type_element(n.DEVICE_HMD);if(s)for(var E in h)if(0==h[E].type||n.get_value_param(s,n.HMD_WEBVR_TYPE)&(n.HMD_NON_WEBVR|n.HMD_WEBVR_MOBILE)&&1==h[E].type){var c=document.createElement("option");c.value=E,c.text=h[E].name,a.appendChild(c)}return a.value=t,i.is_ie11()?a.onchange=b:a.oninput=b,r}();l.appendChild(u);for(var d=n.get_device_by_type_element(n.DEVICE_HMD),f=0;f<R.length;f++)if(n.get_value_param(d,n.HMD_WEBVR_TYPE)&(n.HMD_NON_WEBVR|n.HMD_WEBVR_MOBILE)||!R[f].is_mobile){var P=C(R[f],f);l.appendChild(P)}var A,S,p,m,O=(A=document.createElement("div"),S=F(y,"SAVE","4px"),p=F(Y,"CANCEL","4px"),m=F(L,"RESET","0px"),A.className="row",A.style.cssText="padding-top: 32px;clear: both;box-sizing: border-box;-webkit-box-sizing: border-box;",A.appendChild(S),A.appendChild(p),A.appendChild(m),A);l.appendChild(O);var v=_.create_timeline_sensor();_.create_sensor_manifold(null,"UPDATE_HMD_RENDERING",_.CT_CONTINUOUS,[v],null,w)}}},t.hide=Y,t.reset=L,t.update=function(){x(),w()};var G={_comment:"AUTOMATICALLY GENERATED BY generate_dpdb.py. DO NOT EDIT.",format:1,last_updated:"2016-01-26T23:11:18Z",devices:[{type:"android",rules:[{mdmh:"asus/*/Nexus 7/*"},{ua:"Nexus 7"}],dpi:[320.8,323],bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_Z00AD/*"},{ua:"ASUS_Z00AD"}],dpi:[403,404.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC6435LVW/*"},{ua:"HTC6435LVW"}],dpi:[449.7,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC One XL/*"},{ua:"HTC One XL"}],dpi:[315.3,314.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"htc/*/Nexus 9/*"},{ua:"Nexus 9"}],dpi:289,bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One M9/*"},{ua:"HTC One M9"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One_M8/*"},{ua:"HTC One_M8"}],dpi:[449.7,447.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One/*"},{ua:"HTC One"}],dpi:472.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/Nexus 6P/*"},{ua:"Nexus 6P"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5X/*"},{ua:"Nexus 5X"}],dpi:[422,419.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS345/*"},{ua:"LGMS345"}],dpi:[221.7,219.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D800/*"},{ua:"LG-D800"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D850/*"},{ua:"LG-D850"}],dpi:[537.9,541.9],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/VS985 4G/*"},{ua:"VS985 4G"}],dpi:[537.9,535.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5/*"},{ua:"Nexus 5 B"}],dpi:[442.4,444.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 4/*"},{ua:"Nexus 4"}],dpi:[319.8,318.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LG-P769/*"},{ua:"LG-P769"}],dpi:[240.6,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS323/*"},{ua:"LGMS323"}],dpi:[206.6,204.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGLS996/*"},{ua:"LGLS996"}],dpi:[403.4,401.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/4560MMX/*"},{ua:"4560MMX"}],dpi:[240,219.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/A250/*"},{ua:"Micromax A250"}],dpi:[480,446.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/Micromax AQ4501/*"},{ua:"Micromax AQ4501"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/DROID RAZR/*"},{ua:"DROID RAZR"}],dpi:[368.1,256.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT830C/*"},{ua:"XT830C"}],dpi:[254,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1021/*"},{ua:"XT1021"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1023/*"},{ua:"XT1023"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1028/*"},{ua:"XT1028"}],dpi:[326.6,327.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1034/*"},{ua:"XT1034"}],dpi:[326.6,328.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1053/*"},{ua:"XT1053"}],dpi:[315.3,316.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1562/*"},{ua:"XT1562"}],dpi:[403.4,402.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/Nexus 6/*"},{ua:"Nexus 6 B"}],dpi:[494.3,489.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1063/*"},{ua:"XT1063"}],dpi:[295,296.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1064/*"},{ua:"XT1064"}],dpi:[295,295.6],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1092/*"},{ua:"XT1092"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1095/*"},{ua:"XT1095"}],dpi:[422,423.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/A0001/*"},{ua:"A0001"}],dpi:[403.4,401],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1005/*"},{ua:"ONE E1005"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2005/*"},{ua:"ONE A2005"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OPPO/*/X909/*"},{ua:"X909"}],dpi:[442.4,444.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9082/*"},{ua:"GT-I9082"}],dpi:[184.7,185.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G360P/*"},{ua:"SM-G360P"}],dpi:[196.7,205.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Nexus S/*"},{ua:"Nexus S"}],dpi:[234.5,229.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[304.8,303.9],bw:5,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-T230NU/*"},{ua:"SM-T230NU"}],dpi:216,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SGH-T399/*"},{ua:"SGH-T399"}],dpi:[217.7,231.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N9005/*"},{ua:"SM-N9005"}],dpi:[386.4,387],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SM-N900A/*"},{ua:"SAMSUNG-SM-N900A"}],dpi:[386.4,387.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9500/*"},{ua:"GT-I9500"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/GT-I9505/*"},{ua:"GT-I9505"}],dpi:439.4,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900F/*"},{ua:"SM-G900F"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900M/*"},{ua:"SM-G900M"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G800F/*"},{ua:"SM-G800F"}],dpi:326.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G906S/*"},{ua:"SM-G906S"}],dpi:[562.7,572.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[306.7,304.8],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-T535/*"},{ua:"SM-T535"}],dpi:[142.6,136.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-N920C/*"},{ua:"SM-N920C"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300I/*"},{ua:"GT-I9300I"}],dpi:[304.8,305.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9195/*"},{ua:"GT-I9195"}],dpi:[249.4,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SPH-L520/*"},{ua:"SPH-L520"}],dpi:[249.4,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SGH-I717/*"},{ua:"SAMSUNG-SGH-I717"}],dpi:285.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SPH-D710/*"},{ua:"SPH-D710"}],dpi:[217.7,204.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-N7100/*"},{ua:"GT-N7100"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SCH-I605/*"},{ua:"SCH-I605"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Galaxy Nexus/*"},{ua:"Galaxy Nexus"}],dpi:[315.3,314.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910H/*"},{ua:"SM-N910H"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910C/*"},{ua:"SM-N910C"}],dpi:[515.2,520.2],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G130M/*"},{ua:"SM-G130M"}],dpi:[165.9,164.8],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G928I/*"},{ua:"SM-G928I"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G920F/*"},{ua:"SM-G920F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G920P/*"},{ua:"SM-G920P"}],dpi:[522.5,577],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G925F/*"},{ua:"SM-G925F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G925V/*"},{ua:"SM-G925V"}],dpi:[522.5,576.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/C6903/*"},{ua:"C6903"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"Sony/*/D6653/*"},{ua:"D6653"}],dpi:[428.6,427.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6653/*"},{ua:"E6653"}],dpi:[428.6,425.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6853/*"},{ua:"E6853"}],dpi:[403.4,401.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/SGP321/*"},{ua:"SGP321"}],dpi:[224.7,224.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"TCT/*/ALCATEL ONE TOUCH Fierce/*"},{ua:"ALCATEL ONE TOUCH Fierce"}],dpi:[240,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"THL/*/thl 5000/*"},{ua:"thl 5000"}],dpi:[480,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"ZTE/*/ZTE Blade L2/*"},{ua:"ZTE Blade L2"}],dpi:240,bw:3,ac:500},{type:"ios",rules:[{res:[640,960]}],dpi:[325.1,328.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[640,1136]}],dpi:[317.1,320.2],bw:3,ac:1e3},{type:"ios",rules:[{res:[750,1334]}],dpi:326.4,bw:4,ac:1e3},{type:"ios",rules:[{res:[1242,2208]}],dpi:[453.6,458.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2001]}],dpi:[410.9,415.4],bw:4,ac:1e3}]}}),wE=A("sfx",function(e,t){var r=os(e),_=ps(e),n=Ss(e),a=ga(e);t.play=function(e,t,r){n.play(e,t=t||0,r=r||0)},t.play_def=function(e){n.play_def(e)},t.is_playing=function(e){return n.is_playing(e)},t.stop=function(e){n.stop(e)},t.pause=function(e){n.speaker_pause(e)},t.resume=function(e){n.speaker_resume(e)},t.loop_stop=function(e,t,r){n.loop_stop(e,t=t||0,r=r||!1)},t.playrate=function(e,t){n.playrate(e,t)},t.get_playrate=function(e){return n.get_playrate(e)},t.cyclic=function(e,t){n.cyclic(e,t)},t.is_cyclic=function(e){return n.is_cyclic(e)},t.listener_reset_speed=function(e,t){n.listener_stride()},t.listener_stride=function(){n.listener_stride()},t.speaker_reset_speed=function(e,t,r){n.speaker_stride(e)},t.speaker_stride=function(e){n.speaker_stride(e)},t.get_volume=function(e){return e&&"object"==typeof e?n.get_volume(e):n.get_master_volume()},t.set_volume=function(e,t){e&&"object"==typeof e?n.set_volume(e,t):n.set_master_volume(t)},t.mute=function(e,t){e&&"object"==typeof e?n.mute(e,t):n.mute_master(t)},t.is_muted=function(e){return e&&"object"==typeof e?n.is_muted(e):n.is_master_muted()},t.get_speaker_objects=function(){return n.get_speaker_objects().slice(0)},t.check_active_speakers=n.check_active_speakers,t.set_compressor_params=function(e){n.set_compressor_params(_.get_active(),e)},t.get_compressor_params=function(){return n.get_compressor_params(_.get_active())},t.duck=function(e,t,r){e&&"object"==typeof e?n.duck(e,t,r):n.duck_master(t,r)},t.unduck=function(e){e&&"object"==typeof e?n.unduck(e):n.unduck_master()},t.apply_playlist=n.apply_playlist,t.clear_playlist=n.clear_playlist,t.detect_audio_container=n.detect_audio_container,t.detect_video_container=n.detect_video_container,t.set_positional_params=n.set_positional_params,t.get_positional_params=n.get_positional_params,t.set_filter_params=n.set_filter_params,t.get_filter_params=n.get_filter_params,t.get_filter_freq_response=n.get_filter_freq_response,t.get_duration=function(e){return e&&r.is_speaker(e)?n.get_duration(e):(a.error('Object "'+(e?e.name:void 0)+'" is not a valid speaker'),0)}}),UE=A("mixer",function(e,t){var r=TE(e),_=ga(e),n=OE(e),a=mE(e),o=wE(e),i=NE(e),s=["SWITCH_STRIP","SWITCH_STRIP_HOLD","SWITCH_PARAM","INC_DEC","INC_DEC_HOLD","MUTE_SOLO"],E=[],c=0,l=null,T=null,u=null;function d(e){return{id:e,params:[],active_param:0,mute:-1,solo:-1,speaker:null}}function f(e){var t=d(n.get_object_name(e));return t.mute=o.is_muted(e)?1:0,t.solo=0,t.speaker=e,t}function P(e){if(e.speaker){e.params.length=0;var t=o.get_positional_params(e.speaker);t&&(e.params.push(["DIST_REF",t.dist_ref,0,1e3,1e4,!1]),e.params.push(["ATTENUATION",t.attenuation,0,50,1e3,!1]),e.params.push(["DIST_MAX",t.dist_max,0,1e4,1e4,!1]));var r=o.get_filter_params(e.speaker);r&&(e.params.push(["EQ_FREQ",r.freq,20,2e4,100,!0]),e.params.push(["EQ_Q",r.Q,0,10,100,!1]),e.params.push(["EQ_GAIN",r.gain,-70,30,100,!1])),e.params.push(["VOLUME",o.get_volume(e.speaker),0,1,50,!1]),i.clamp(e.active_param,0,e.params.length-1)}}function A(e){for(var t=0;t<E.length;t++){var r=E[t];if(r!=e&&1==r.solo)return!0}return!1}function S(e){for(var t=0;t<E.length;t++){var r=E[t];r!=e&&0==r.mute&&0==r.solo&&o.mute(r.speaker,!1)}}function p(){if(0==E.length)return[0,-1];var e=8*Math.floor(c/8),t=e+7;return[e=i.clamp(e,0,E.length-1),t=i.clamp(t,0,E.length-1)]}t.enable_mixer_controls=function(){!function(){E.length=0,c=0,l=function(e){for(var t=new Float32Array(100),r=0,_=0;_<100;_++)t[_]=20*Math.pow(1e3,r),r+=1/99;return t}(),T=new Float32Array(l.length),u=new Float32Array(l.length);var e=o.get_speaker_objects();if(e.length){var t,r;E.push((t=d("MASTER"),(r=o.get_compressor_params())&&(t.params.push(["THRESHOLD",r.threshold,-100,0,100,!1]),t.params.push(["KNEE",r.knee,0,40,40,!1]),t.params.push(["RATIO",r.ratio,1,20,20,!1]),t.params.push(["ATTACK",r.attack,0,1,1e3,!1]),t.params.push(["RELEASE",r.release,0,1,1e3,!1])),t.params.push(["VOLUME",o.get_volume(null),0,1,50,!1]),t.mute=o.is_muted(null)?1:0,t.solo=-1,t));for(var _=0;_<e.length;_++)E.push(f(e[_]));E.sort(function(e,t){return"MASTER"==e.id?-1:"MASTER"==t.id?1:"COMPRESSOR"==e.id?-1:"COMPRESSOR"==t.id?1:e.id.toUpperCase()<t.id.toUpperCase()?-1:e.id.toUpperCase()>t.id.toUpperCase()?1:0})}}();var e=r.create_keyboard_sensor(r.KEY_NUM4),t=r.create_keyboard_sensor(r.KEY_NUM6),n=r.create_keyboard_sensor(r.KEY_NUM8),s=r.create_keyboard_sensor(r.KEY_NUM2),m=r.create_keyboard_sensor(r.KEY_ADD),O=r.create_keyboard_sensor(r.KEY_SUB),v=r.create_keyboard_sensor(r.KEY_NUM7),N=r.create_keyboard_sensor(r.KEY_NUM9),g=r.create_timer_sensor(.15,!0),h=r.create_timer_sensor(.05,!0),R=[e,t,g],I=function(e,t,_){1==_?(function(e){if(E.length){1==e&&c<E.length-1?c++:-1==e&&c>0&&c--;for(var t=p(),r=t[0];r<=t[1];r++)P(E[r])}}(Boolean(r.get_sensor_value(e,t,0))?-1:1),r.reset_timer_sensor(e,t,2,"SWITCH_STRIP"==t?.15+.3:.15)):r.reset_timer_sensor(e,t,2,10)};r.create_sensor_manifold(null,"SWITCH_STRIP",r.CT_TRIGGER,R,function(e){return e[0]||e[1]},I),r.create_sensor_manifold(null,"SWITCH_STRIP_HOLD",r.CT_SHOT,R,function(e){return(e[0]||e[1])&&e[2]},I),r.create_sensor_manifold(null,"SWITCH_PARAM",r.CT_SHOT,[n,s],function(e){return e[0]||e[1]},function(e,t,_){!function(e){var t=E[c];t&&(1==e&&t.active_param<t.params.length-1?t.active_param++:-1==e&&t.active_param>0&&t.active_param--)}(Boolean(r.get_sensor_value(e,t,0))?-1:1)});var b=[O,m,h],Y=function(e,t,n){1==n?(function(e){var t=E[c];if(t){var r=t.params[t.active_param];switch(r[5]?r[1]*=Math.pow(r[3]/r[2],e/r[4]):r[1]+=e*((r[3]-r[2])/r[4]),r[1]=i.clamp(r[1],r[2],r[3]),r[0]){case"VOLUME":o.set_volume("MASTER"!=t.id?t.speaker:null,r[1]);break;case"DIST_REF":(n=o.get_positional_params(t.speaker)).dist_ref=r[1],o.set_positional_params(t.speaker,n);break;case"ATTENUATION":(n=o.get_positional_params(t.speaker)).attenuation=r[1],o.set_positional_params(t.speaker,n);break;case"DIST_MAX":var n;(n=o.get_positional_params(t.speaker)).dist_max=r[1],o.set_positional_params(t.speaker,n);break;case"EQ_FREQ":(a=o.get_filter_params(t.speaker)).freq=r[1],o.set_filter_params(t.speaker,a);break;case"EQ_Q":(a=o.get_filter_params(t.speaker)).Q=r[1],o.set_filter_params(t.speaker,a);break;case"EQ_GAIN":var a;(a=o.get_filter_params(t.speaker)).gain=r[1],o.set_filter_params(t.speaker,a);break;case"THRESHOLD":(s=o.get_compressor_params()).threshold=r[1],o.set_compressor_params(s);break;case"KNEE":(s=o.get_compressor_params()).knee=r[1],o.set_compressor_params(s);break;case"RATIO":(s=o.get_compressor_params()).ratio=r[1],o.set_compressor_params(s);break;case"ATTACK":(s=o.get_compressor_params()).attack=r[1],o.set_compressor_params(s);break;case"RELEASE":var s;(s=o.get_compressor_params()).release=r[1],o.set_compressor_params(s);break;default:_.error("Unknown strip param")}}}(Boolean(r.get_sensor_value(e,t,0))?-1:1),r.reset_timer_sensor(e,t,2,"INC_DEC"==t?.35:.05)):r.reset_timer_sensor(e,t,2,10)};r.create_sensor_manifold(null,"INC_DEC",r.CT_TRIGGER,b,function(e){return e[0]||e[1]},Y),r.create_sensor_manifold(null,"INC_DEC_HOLD",r.CT_SHOT,b,function(e){return(e[0]||e[1])&&e[2]},Y),r.create_sensor_manifold(null,"MUTE_SOLO",r.CT_SHOT,[v,N],function(e){return e[0]||e[1]},function(e,t,_){var n;Boolean(r.get_sensor_value(e,t,0))?(n=E[c])&&n.mute>=0&&function(e){"MASTER"!=e.id?0==e.mute?(e.mute=1,o.mute(e.speaker,!0),1==e.solo&&(e.solo=0,A(e)||S(e))):(e.mute=0,A(e)||o.mute(e.speaker,!1)):0==e.mute?(e.mute=1,o.mute(null,!0)):(e.mute=0,o.mute(null,!1))}(n):function(){var e=E[c];e&&e.solo>=0&&function(e){0==e.solo?(e.solo=1,o.mute(e.speaker,!1),1==e.mute&&(e.mute=0),function(e){for(var t=0;t<E.length;t++){var r=E[t];r!=e&&0==r.mute&&0==r.solo&&o.mute(r.speaker,!0)}}(e)):(e.solo=0,A(e)?o.mute(e.speaker,!0):S(e))}(e)}()});var L=r.create_elapsed_sensor();r.create_sensor_manifold(null,"MIXER_DRAW",r.CT_CONTINUOUS,[L],null,function(){!function(){if(E[c])for(var e=p(),t=e[0];t<=e[1];t++){var r=E[t];if(a.draw_mixer_strip(r.id,t==c,t%8,r.params,r.active_param,r.mute,r.solo),r.speaker&&o.get_filter_params(r.speaker)){o.get_filter_freq_response(r.speaker,l,T,u);for(var _=0;_<T.length;_++)T[_]=20*Math.log(T[_])/Math.LN10;a.plot_array("EQ",t%8,T,20,2e4,-10,10)}}}()});var M=r.create_timer_sensor(1,!0);r.create_sensor_manifold(null,"MIXER_UPDATE",r.CT_TRIGGER,[M],null,function(){for(var e=p(),t=e[0];t<=e[1];t++)P(E[t])})},t.disable_mixer_controls=function(){for(var e=0;s.length;e++)r.remove_sensor_manifold(null,s[e])}}),CE=A("mouse",function(e,t){var r=iE(e),_=lE(e),n=TE(e),a=pE(e),o=ga(e),i=OE(e),s=NE(e),E=SE(e),c=4e-4,l=2,T=1,u=.1,d=0,f=1,P=2,A=0,S=0,p=new Float32Array(2),m=new Float32Array(2),O=null,v=null,N=d,g=!1,h=!1;function R(){N==f&&(N=d);var e=document.exitPointerLock||document.webkitExitPointerLock||document.mozExitPointerLock;"function"==typeof e&&e.apply(document),n.remove_sensor_manifold(i.get_active_camera(),"SMOOTH_PL")}function I(e){N==P&&(N=d),e.removeEventListener("mousedown",Y,!1),e.removeEventListener("mouseup",L,!1),e.removeEventListener("mousemove",b,!1),n.remove_sensor_manifold(i.get_active_camera(),"SMOOTH_DRAG")}function b(e){if(O()){if(h)var t=_.get_coords_target_space(e,m);else(t=m)[0]=e.clientX,t[1]=e.clientY;p[0]+=(t[0]-A)*l,p[1]+=(t[1]-S)*l,A=t[0],S=t[1]}e.preventDefault()}function Y(e){if(h)var t=_.get_coords_target_space(e,m);else(t=m)[0]=e.clientX,t[1]=e.clientY;A=t[0],S=t[1],e.currentTarget.addEventListener("mousemove",b,!1),e.preventDefault()}function L(e){e.currentTarget.removeEventListener("mousemove",b,!1),e.preventDefault()}function M(e,t,r,_){if(Math.abs(p[0])>.01||Math.abs(p[1])>.01){var a=n.get_sensor_value(e,t,0),o=s.smooth(p[0],0,a,w()),i=s.smooth(p[1],0,a,w());p[0]-=o,p[1]-=i,_(-o*c,-i*c)}}function x(e,t){var _=i.get_first_character(),n=i.get_active_camera();if(r.rotate_camera(n,e,t),_){var o=r.get_camera_angles_char(n,m);a.set_character_rotation_h(_,o[0]),a.set_character_vert_move_dir_angle(_,o[1])}}function y(e){if(g)var t=_.get_coords_target_space(e,!1,m),r=i.pick_object(t[0],t[1]);else r=i.pick_object(e.clientX,e.clientY);r?(i.outlining_is_enabled(r)&&i.set_outline_intensity(r,1),i.outlining_is_enabled(v)&&r!=v&&i.set_outline_intensity(v,0)):i.outlining_is_enabled(v)&&i.set_outline_intensity(v,0),v=r}function w(){return u*T}t.request_pointerlock=function(e,t,r,_,a,s){if(N!=f){N=f,t=t||function(){},r=r||function(){},s=s||x,a=a||function(){return!0},_=_||function(e){if(a()){if("number"==typeof e.movementX)var t=e.movementX,r=e.movementY;else"number"==typeof e.webkitMovementX?(t=e.webkitMovementX,r=e.webkitMovementY):"number"==typeof e.mozMovementX?(t=e.mozMovementX,r=e.mozMovementY):(t=0,r=0);p[0]+=t,p[1]+=r}},document.addEventListener("pointerlockchange",c,!1),document.addEventListener("webkitpointerlockchange",c,!1),document.addEventListener("mozpointerlockchange",c,!1);var E=e.requestPointerLock||e.webkitRequestPointerLock||e.mozRequestPointerLock;"function"==typeof E?E.apply(e):o.error("Pointer lock is not available")}function c(){if(document.pointerLockElement===e||document.webkitPointerLockElement===e||document.mozPointerLockElement===e){I(e),e.addEventListener("mousemove",_,!1);var a=i.get_active_camera();if(!n.check_sensor_manifold(a,"SMOOTH_PL")){var o=n.create_elapsed_sensor();n.create_sensor_manifold(a,"SMOOTH_PL",n.CT_CONTINUOUS,[o],null,M,s)}t()}else e.removeEventListener("mousemove",_,!1),N=d,document.removeEventListener("pointerlockchange",c,!1),document.removeEventListener("webkitpointerlockchange",c,!1),document.removeEventListener("mozpointerlockchange",c,!1),r()}},t.exit_pointerlock=R,t.check_pointerlock=function(e){return"function"==typeof(e.requestPointerLock||e.webkitRequestPointerLock||e.mozRequestPointerLock)},t.request_mouse_drag=function(e,t,r,_){if(N!=P){N=P,R(),O=t||function(){return!0},r=r||x,h=Boolean(_),e.addEventListener("mousedown",Y,!1),e.addEventListener("mouseup",L,!1);var a=i.get_active_camera();if(!n.check_sensor_manifold(a,"SMOOTH_DRAG")){var o=n.create_elapsed_sensor();n.create_sensor_manifold(a,"SMOOTH_DRAG",n.CT_CONTINUOUS,[o],null,M,r)}}},t.exit_mouse_drag=I,t.enable_mouse_hover_outline=function(e){g=Boolean(e),E.detect_mobile()||_.get_canvas().addEventListener("mousemove",y)},t.disable_mouse_hover_outline=function(){E.detect_mobile()||(_.get_canvas().removeEventListener("mousemove",y),v&&i.set_outline_intensity(v,0))},t.get_coords_x=function(e,t,r){if(r)return _.get_coords_target_space(e,t,m)[0];if("clientX"in e)return e.clientX;if("touchend"==e.type)var n=e.changedTouches;else n=t?e.targetTouches:e.touches;return n&&n[0]&&"clientX"in n[0]?n[0].clientX:-1},t.get_coords_y=function(e,t,r){if(r)return _.get_coords_target_space(e,t,m)[1];if("clientY"in e)return e.clientY;if("touchend"==e.type)var n=e.changedTouches;else n=t?e.targetTouches:e.touches;return n&&n[0]&&"clientY"in n[0]?n[0].clientY:-1},t.set_plock_smooth_factor=function(e){T=e},t.get_plock_smooth_factor=function(){return T}}),DE=A("animation",function(e,t){var r=gs(e),_=os(e),n=ga(e);t.SLOT_0=r.SLOT_0,t.SLOT_1=r.SLOT_1,t.SLOT_2=r.SLOT_2,t.SLOT_3=r.SLOT_3,t.SLOT_4=r.SLOT_4,t.SLOT_5=r.SLOT_5,t.SLOT_6=r.SLOT_6,t.SLOT_7=r.SLOT_7,t.SLOT_ALL=r.SLOT_ALL,t.OBJ_ANIM_TYPE_NONE=r.OBJ_ANIM_TYPE_NONE,t.OBJ_ANIM_TYPE_ARMATURE=r.OBJ_ANIM_TYPE_ARMATURE,t.OBJ_ANIM_TYPE_OBJECT=r.OBJ_ANIM_TYPE_OBJECT,t.OBJ_ANIM_TYPE_VERTEX=r.OBJ_ANIM_TYPE_VERTEX,t.OBJ_ANIM_TYPE_SOUND=r.OBJ_ANIM_TYPE_SOUND,t.OBJ_ANIM_TYPE_PARTICLES=r.OBJ_ANIM_TYPE_PARTICLES,t.OBJ_ANIM_TYPE_MATERIAL=r.OBJ_ANIM_TYPE_MATERIAL,t.OBJ_ANIM_TYPE_STATIC=r.OBJ_ANIM_TYPE_STATIC,t.AB_CYCLIC=r.AB_CYCLIC,t.AB_FINISH_RESET=r.AB_FINISH_RESET,t.AB_FINISH_STOP=r.AB_FINISH_STOP,t.is_animated=function(e){return r.is_animated(e)},t.get_anim_names=function(e){return r.obj_is_animatable(e)?r.get_anim_names(e):[]},t.get_current_anim_name=function(e,t){return r.is_animated(e)?r.get_anim_by_slot_num(e,t=t||r.SLOT_0):null},t.apply=function(e,t,_){if(_>r.SLOT_7)n.error("Can't apply animation to slot "+_+' for object "'+e.name+'". Object can have maximum of 8 animation slots');else{if(_=_||r.SLOT_0,r.is_animated(e)){var a=r.get_slot_num_by_anim(e,t);if(-1!=a&&a!=_)return void n.error('Animation "'+t+'" is already applied to object "'+e.name+'" (slot "'+a+'").')}r.validate_action_by_name(e,t)?r.apply(e,null,t,_):n.error('No fcurves in action "'+t+'"')}},t.apply_ext=function(e,t,_){if(_>r.SLOT_7)n.error("Can't apply animation to slot "+_+' for object "'+e.name+'". Object can have maximum of 8 animation slots');else{_=_||r.SLOT_0;var a=t[0];if(r.validate_action_by_name(e,a)){var o=t.slice(1);r.apply(e,o,a,_)}else n.error('No fcurves in action "'+a+'"')}},t.remove=function(e){r.remove(e)},t.remove_slot_animation=function(e,t){r.is_animated(e)&&r.remove_slot_animation(e,t=t||r.SLOT_0)},t.apply_def=function(e){r.apply_def(e)},t.play=function(e,t,_){r.is_animated(e)?(r.play(e,t,_=_||r.SLOT_0),r.update_object_animation(e,0,_,!0)):n.error('Object "'+e.name+'" has no applied animation')},t.stop=function(e,t){r.is_animated(e)&&r.stop(e,t=t||r.SLOT_0)},t.is_play=function(e,t){return!!r.is_animated(e)&&r.is_play(e,t=t||r.SLOT_0)},t.set_frame=function(e,t,_){r.is_animated(e)&&r.set_frame(e,t,_=_||r.SLOT_0)},t.set_first_frame=function(e,t){r.is_animated(e)&&r.set_first_frame(e,t)},t.set_last_frame=function(e,t){if(r.is_animated(e)){var _=r.get_anim_start_frame(e,t=t||r.SLOT_0),n=r.get_anim_length(e,t);r.set_frame(e,_+n-r.LAST_FRAME_EPSILON,t)}},t.get_frame=function(e,t){return r.is_animated(e)?r.get_current_frame_float(e,t=t||r.SLOT_0):0},t.set_speed=function(e,t,_){r.is_animated(e)&&(_=_||r.SLOT_0,r.set_speed(e,t=t||1,_))},t.get_speed=function(e,t){return r.is_animated(e)&&e.anim_slots[t=t||r.SLOT_0]?r.get_speed(e,t):0},t.get_anim_start_frame=function(e,t){return r.is_animated(e)&&e.anim_slots[t=t||r.SLOT_0]?r.get_anim_start_frame(e,t):-1},t.get_anim_length=function(e,t){return r.is_animated(e)&&e.anim_slots[t=t||r.SLOT_0]?r.get_anim_length(e,t):-1},t.set_behavior=function(e,t,_){r.is_animated(e)&&r.set_behavior(e,t,_=_||r.SLOT_0)},t.get_behavior=function(e,t){return r.is_animated(e)?r.get_behavior(e,t=t||r.SLOT_0):null},t.apply_smoothing=function(e,t,_,n){n=n||r.SLOT_0,r.is_animated(e)&&r.apply_smoothing(e,t,_,n)},t.frame_to_sec=function(e){return r.frame_to_sec(e)},t.get_slot_num_by_anim=function(e,t){return r.is_animated(e)&&t?r.get_slot_num_by_anim(e,t):-1},t.get_anim_type=function(e,t){return r.is_animated(e)?r.get_anim_type(e,t):null},t.apply_to_first_empty_slot=function(e,t){return r.apply_to_first_empty_slot(e,t)},t.get_skel_mix_factor=function(e){return e.render.anim_mix_factor},t.set_skel_mix_factor=function(e,t,a,o){_.is_armature(e)?(t=Math.min(Math.max(t,0),1),e.render.anim_mix_factor!=t&&r.set_skel_mix_factor(e,t,a=a||0,o=o||null)):n.error("Can't blend animation. Object \""+e.name+'" is not armature')},t.set_skeletal_slots=function(e,t,r,_){r=void 0==(t=void 0==t?-1:t)?-1:r,_=_||0;var n=e.render.blend_skel_slots;t>=0&&(n[0]=t),r>=0&&(n[1]=r),e.render.anim_mix_factor=_},t.get_first_skeletal_slot=function(e){return e.render.blend_skel_slots[0]},t.get_second_skeletal_slot=function(e){return e.render.blend_skel_slots[1]},t.mix_from_cur_pos=function(e,t,_,n){n=n||null,r.mix_from_cur_pos(e,t,_=_||0,n)}}),FE=A("npc_ai",function(e,t){var r=DE(e),_=TE(e),n=OE(e),a=hE(e),o=vE(e),i=pE(e),s=ga(e),E=NE(e),c=[],l=new Float32Array(3),T=new Float32Array(3),u=new Float32Array(3),d=new Float32Array(3),f=new Float32Array(4),P=new Float32Array(4),A=new Float32Array(4),S=t.NT_WALKING=10,p=t.NT_FLYING=20,m=t.NT_SWIMMING=30,O=10,v=20;function N(e,t){var _=t.destination,n=t.base_pos,a=T;o.get_translation(t.collider,a);var i=0,s=a[2];switch(_[2]=s,t.type){case S:if(t.random&&t.reached&&(_[0]=(12*Math.random()-6)*t.speed+n[0],_[1]=-(12*Math.random()-6)*t.speed+n[1],function(e,t,r){var _=P,n=u,a=e.speed,i=e.rot_speed;o.get_rotation(e.collider,_),We(E.AXIS_MY,_,n),n[2]=0,Ke(n,n);var s=.5*a/Math.sin(i/2),c=Ue(t,r);c<2*s&&we(t,n,2*s-c,t)}(t,_,a),t.reached=!1),t.ground_level){var c=t.speed*e;(i=t.ground_level-s)>c?i=c:i<-c&&(i=-c)}t.vert_correction=i;break;case p:case m:if(t.vert_cor_water?i=t.vert_cor_water:t.vert_correction&&(i=t.vert_correction,t.type==m&&(i*=e)),t.random&&t.reached){if(t.type==m){t.speed=Math.random()+.1;var N=t.max_depth-t.min_depth}else N=t.max_height-t.min_height;_[0]=10*Math.random()-5+n[0],_[1]=10*Math.random()-5+n[1],_[2]=s-(Math.random()*N-.5*N),t.reached=!1}}i&&(_[2]=s+i),function(e,t){var _=l,n=T,a=u,i=A,s=t.rig,c=t.collider,N=t.destination,g=t.speed,h=t.actions,R=r.get_current_anim_name(s);if(!r.is_play(s)||!h.idle||-1==h.idle.indexOf(R)){o.get_translation(c,_);var I=N[0]-_[0],b=N[1]-_[1],Y=Math.sqrt(I*I+b*b);Y>2*g*e?(t.state=v,E.horizontal_direction(N,_,a),function(e,t,_,n){var a=e.rig;if(r.is_animated(a)){var o=e.speed,i=_,s=r.get_frame(a),E=r.get_anim_length(a),c=E/24*o*(1-s/E);i/c<.9&&we(t,n,c-i,t)}}(t,N,Y,a),function(e,t,r,_,n){var a=P,i=d;o.get_rotation(e.collider,a),We(E.AXIS_MY,a,t),i[0]=t[0],i[1]=t[1],i[2]=0,Ke(i,i);var s=Be(i,n),c=Math.acos(s),l=r/(Math.abs(c)/Math.PI)*e.rot_speed*e.rotation_mult;wr(i,n,_),wr(E.AXIS_MY,i,a),Math.abs(s)>=1?nr(a,_):(Fr(_,a,_),Xr(a,_,Math.min(l,1),_))}(t,n,e,i,a),function(e,t,r,_){if(e.type!=p){r=Math.max(r,1/60);var n=f,a=P,o=Math.asin(-t[2]);Dr(E.AXIS_X,-o,a);var i=Math.atan(e.vert_correction/(e.speed*r));Dr(E.AXIS_X,-i,n),Xr(a,n,r,n),Fr(_,n,_)}}(t,n,e,i),o.set_rotation_v(c,i),function(e,t,r,_,n){var a=u,i=d;E.quat_to_dir(t,E.AXIS_MY,a),ye(a,r.speed*e,i),Ie(i,_,i),i[2]=r.type!=S?(n[2]-_[2])*e*.1+_[2]:n[2],o.set_translation_v(r.collider,i)}(e,i,t,_,N)):t.type==S?h.move&&R&&-1!=h.move.indexOf(R)&&r.is_play(s)?t.state=v:(t.state=O,t.reached=!0):t.type!=m&&t.type!=p||(t.reached=!0),function(e){var t=e.rig;if(!r.is_play(t))return!0;var _=r.get_current_anim_name(t);if(!_)return!0;var n=e.actions;switch(e.state){case O:if(!n.idle)return!1;if(-1==n.idle.indexOf(_))return!0;break;case v:if(!n.move)return!1;if(-1!=n.move.indexOf(_))return!1;if(n.move_start&&-1!=n.move_start.indexOf(_))return!1;if(n.move_blends&&-1!=n.move_blends.indexOf(_))return!1;break;default:return!1}return!0}(t)&&function(e){var t=e.rig;if(!r.is_play(t)){var _=null;switch(e.state){case O:_=function(e){var t=e.actions;return t.idle?E.random_from_array(t.idle):null}(e);break;case v:_=function(e){var t=r.get_current_anim_name(e.rig),_=e.actions;return function(e,t){var r=e.actions;return!!r.move_blends&&-1==r.move_blends.indexOf(t)&&!(!r.move||-1==r.move.indexOf(t))&&Math.random()>.33}(e,t)?function(e,t){var r=e.actions,_=r.move.indexOf(t);return r.move_blends[_]}(e,t):function(e,t){var r=e.actions;return!(!r.move||-1==r.move.indexOf(t)&&(r.move_blends||r.move_start)&&(r.move_start||t)&&(!r.move_blends||-1==r.move_blends.indexOf(t))&&(!r.move_start||-1==r.move_start.indexOf(t)))}(e,t)?function(e,t){var r=e.actions;if(!r.move_blends)return E.random_from_array(r.move);var _=r.move_blends.indexOf(t);if(-1!=_){var n=_+1;return r.move[n=n<r.move.length?n:0]}return-1!=r.move.indexOf(t)?t:E.random_from_array(r.move)}(e,t):function(e,t){var r=e.actions;return!!r.move_start&&-1==r.move_start.indexOf(t)&&!(!r.move||-1!=r.move.indexOf(t))}(e,t)?E.random_from_array(_.move_start):null}(e)}_&&(r.apply(t,_),r.set_behavior(t,r.AB_FINISH_RESET),r.set_frame(t,0),r.play(t))}}(t)}}(e,t)}function g(e,t){if(n.is_visible(e.obj))if(e.random)N(t,e);else{for(var r=a.get_timeline(),_=0;_<e.path.length;_++)if(!e.ended[_]){if(e.fired[_]||(e.fired[_]=!0,e.destination[0]=e.path[_][0],e.destination[1]=e.path[_][1],e.destination[2]=e.path[_][2],e.start[_]=r+e.delay[_]),r<e.start[_])break;N(t,e),e.ended[_]=e.reached;break}(function(e){for(var t=0;t<e.path.length;t++)if(0==e.ended[t])return!1;return!0})(e)&&function(e){for(var t=0;t<e.path.length;t++)e.fired[t]=!1,e.ended[t]=!1}(e)}}function h(e,t,r,n){if(n)if(1==r)switch(n.type){case p:var a=100*function(e,t){for(var r=0;r<3;r++){var n=_.get_sensor_payload(e,t,r).hit_fract;if(n)return n}}(e,t);n.vert_correction=a<n.min_height?10:a>n.max_height?-10:0;break;case S:var o=_.get_sensor_payload(e,t,0);n.ground_level=o.hit_pos[2];break;case m:o=_.get_sensor_payload(e,t,0),"CLOSE_GROUND"==t?(n.vert_correction=100*o.hit_fract-1,n.vert_correction=n.vert_correction<.1?.05:0):"CLOSE_WATER"==t&&(n.vert_cor_water=100*o.hit_fract,n.vert_cor_water=n.vert_cor_water<n.min_depth?-.02:n.vert_cor_water>n.max_depth?.02:0)}else n.vert_correction=0}function R(e){var t=ve(),r=e.collider;switch(e.type){case p:var n=_.create_ray_sensor(r,t,[0,0,-100],"TERRAIN",!0,!0),a=_.create_ray_sensor(r,t,[0,0,-100],"STONE",!0,!0),o=_.create_ray_sensor(r,t,[0,0,-100],"WATER",!0,!0);_.create_sensor_manifold(r,"CLOSE_GROUND",_.CT_CONTINUOUS,i=[n,a,o],function(e){return e[0]||e[1]||e[2]},h,e);break;case S:n=_.create_ray_sensor(r,[0,0,1],[0,0,-99],"TERRAIN",!0,!0),_.create_sensor_manifold(r,"CLOSE_GROUND",_.CT_CONTINUOUS,i=[n],null,h,e);break;case m:n=_.create_ray_sensor(r,[0,0,1],[0,0,-99],"TERRAIN",!0,!0),o=_.create_ray_sensor(r,t,[0,0,100],"WATER",!0,!0);var i=[n];_.create_sensor_manifold(r,"CLOSE_WATER",_.CT_CONTINUOUS,[o],null,h,e),_.create_sensor_manifold(r,"CLOSE_GROUND",_.CT_CONTINUOUS,i,null,h,e)}}function I(e){var t=e.collider;if(e.type==S){var r=_.create_collision_sensor(t,"CONSTRUCTION",!1);_.create_sensor_manifold(t,"CONSTRUCTION_COLL",_.CT_CONTINUOUS,[r],null,function(t,r,_){1==_?(he(e.base_pos,e.destination),e.rotation_mult=4):e.rotation_mult=1})}}t.new_event_track=function(e){var t={obj:null,rig:null,collider:null,empty:null,type:S,state:O,actions:{},base_pos:new Float32Array(3),destination:new Float32Array(3),path:[],start:[],ended:[],fired:[],delay:[],random:!0,reached:!0,ground_level:0,vert_correction:0,vert_cor_water:0,rotation_mult:1,speed:1,rot_speed:.1,max_height:0,min_height:0,max_depth:0,min_depth:0};if("object"==typeof e.obj)if("object"==typeof e.rig)if("object"==typeof e.collider&&i.has_physics(e.collider)){if(t.obj=e.obj,t.collider=e.collider,t.rig=e.rig,o.get_translation(e.collider,t.base_pos),"object"==typeof e.actions&&(t.actions=e.actions),"boolean"==typeof e.random&&(t.random=e.random),"number"==typeof e.type&&(t.type=e.type),"number"==typeof e.speed&&(t.speed=e.speed),"number"==typeof e.rot_speed&&(t.rot_speed=e.rot_speed),"number"==typeof e.max_height&&(t.max_height=e.max_height),"number"==typeof e.min_height&&(t.min_height=e.min_height),!t.random){for(var _=0;_<e.path.length;_++)t.start[_]=-1,t.ended[_]=!1,t.fired[_]=!1;t.path=e.path,t.delay=e.delay}var n=e.actions,a=r.get_current_anim_name(t.rig);for(var E in n)for(var l=n[E],T=0;T<l.length;T++)r.apply(t.rig,l[T]);a&&r.apply(t.rig,a),c.push(t)}else s.error("Can't create event track. Wrong collider object.");else s.error("Can't create event track. Wrong rig object.");else s.error("Can't create event track. Wrong object.")},t.enable_animation=function(){if(c.length){!function(){for(var e=0;e<c.length;e++){var t=c[e];R(t),I(t),r.get_current_anim_name(t.rig)&&r.play(t.rig)}}();var e=_.create_elapsed_sensor();_.create_sensor_manifold(c[0].collider,"ELAPSED",_.CT_CONTINUOUS,[e],function(e){return e[0]},function(e,t,r){if(1==r)for(var n=_.get_sensor_value(e,t,0),a=0;a<c.length;a++)g(c[a],n)})}},t.disable_animation=function(){if(!(c.length<=0))for(var e=0;e<c.length;e++){var t=c[e];_.check_sensor_manifolds(t.collider)&&_.remove_sensor_manifold(t.collider),r.is_play(t.rig)&&r.stop(t.rig)}}}),GE=A("preloader",function(e,t){var r=lE(e),_={},n=null;t.create_preloader=function(e){var t="#484848",n="#5276cf",a="rgba(150, 150, 150, 0.7)",o="#fff";for(var i in e)switch(i){case"container_color":t=e.container_color;break;case"bar_color":n=e.bar_color;break;case"frame_color":a=e.frame_color;break;case"font_color":o=e.font_color}var s=document.createElement("div"),E=s.cloneNode(!1),c=s.cloneNode(!1),l=s.cloneNode(!1),T=r.get_container();c.appendChild(E),c.appendChild(l),s.appendChild(c),T.appendChild(s),s.style.cssText="background-color: "+t+";width: 100%;height: 100%;position: absolute;top: 0;left: 0;",c.style.cssText="position: absolute;left: 50%;top: 50%;margin-left: -150px;margin-top: -30px;width: 300px;height: 28px;box-shadow: 0px 0px 10px 0px "+a+";border: 2px solid "+a+";",E.style.cssText="position: absolute;width: 0%;top: 0;left: 0;background-color: "+n+";height: 100%;",l.style.cssText="font-family: Arial, sans-serif;line-height: 28px;height: 100%;width: 100%;top: 0;left: 0;text-align: center;position: absolute;font-size: 16px;font-weight: bold;text-shadow: 0px 0px 6px "+a+";color: "+o+";",_.bar=E,_.caption=l,_.container=s,_.type="DEFAULT"},t.create_simple_preloader=function(e){var t=null,r=null,a="#bf9221",o="#000";for(var i in e)switch(i){case"canvas_container_id":t=e.canvas_container_id;break;case"background_container_id":r=e.background_container_id;break;case"bg_color":o=e.bg_color;break;case"bar_color":a=e.bar_color;break;case"preloader_fadeout":_.fadeout=e.preloader_fadeout}var s=document.createElement("div"),E=document.createElement("div");s.id="simple_preloader_container";var c=document.createElement("div"),l=document.createElement("div"),T=document.getElementById(r);n=document.getElementById(t),s.style.cssText="z-index: 4;background-color: "+o+";width: 100%;height: 100%;position: absolute;margin: 0;padding: 0;top: 0;left: 0;",E.style.cssText="position: absolute;left: 50%;top: 82%;width: 300px;height: 20px;margin-left: -150px;margin-top: -10px;border-style:solid;border-width:4px;border-color: #000;border-radius: 0px;",c.style.cssText="position: absolute;left: 0px;top: 1px;width: 0px;height: 18px;background-color: "+a+";border-radius: 0px;",l.style.cssText="position: absolute;left: 50%;top: 50%;width: 100%;height: 100%;margin-left: -150px;margin-top: -10px;text-align: center;font-size: 17px;font-weight: bold;color: #000;font-family: Verdana;"+E.appendChild(c),E.appendChild(l),s.appendChild(E),document.body.appendChild(s),_.type="SIMPLE",_.container=s,_.bar=c,_.caption=l,_.background=T},t.create_rotation_preloader=function(e){var t=null,r=null,a="rgba(0,0,0,0)",o="",i="",s="rgba(0,0,0,0)";for(var E in e)switch(E){case"canvas_container_id":t=e.canvas_container_id;break;case"background_container_id":r=e.background_container_id;break;case"frame_bg_color":a=e.frame_bg_color;break;case"bg_color":s=e.bg_color;break;case"frame_class":o=e.frame_class;break;case"anim_elem_class":i=e.anim_elem_class}var c=document.createElement("div"),l=document.createElement("div"),T=document.createElement("div"),u=document.createElement("div"),d=document.getElementById(r);n=document.getElementById(t),c.style.cssText="z-index: 4;background-color: "+s+";width: 100%;height: 100%;position: absolute;margin: 0;padding: 0;top: 0;left: 0;",l.style.cssText="position: absolute;left: 50%;top: 50%;width: 117px;height: 117px;margin-left: -58px;margin-top: -58px;background-color: "+a+";",T.style.cssText="position: absolute;left: 0px;top: 0px;width: 100%;height: 100%;background-position: center;background-repeat: no-repeat;",u.style.cssText="position: absolute;width: 100%;height: 100%;text-align: center;margin-top: 38px;font-size: 36px;color: #ffffff;font-family: Arial;font-weight: bold;",T.className=i,l.appendChild(T),l.className=o,l.appendChild(u),c.appendChild(l),n.appendChild(c),_.type="ROTATION",_.container=c,_.anim_elem=T,_.caption=u,_.background=d},t.create_advanced_preloader=function(e){var t=e.preloader_width,r=e.canvas_container_id,a=t/(t-e.img_width),o=document.getElementById(e.preloader_bar_id),i=document.getElementById(e.fill_band_id),s=document.getElementById(e.preloader_caption_id),E=document.getElementById(e.preloader_container_id),c=document.getElementById(e.background_container_id);n=document.getElementById(r),_.type="ADVANCED",_.bar=o,_.fill=i,_.ratio=a,_.caption=s,_.container=E,_.background=c},t.update_preloader=function(e){_.caption.innerHTML=e+"%","SIMPLE"==_.type?_.bar.style.width=e+"%":"ADVANCED"==_.type?(_.bar.style.width=e/_.ratio+"%",_.fill.style.width=100-e+"%"):"ROTATION"==_.type?_.anim_elem.style.transform="rotate("+e+"deg)":"DEFAULT"==_.type&&(_.bar.style.width=e+"%"),100==e&&(_.container.parentNode.removeChild(_.container),_.background&&_.background.parentNode.removeChild(_.background))}}),kE=A("screenshooter",function(e,t){var r=mE(e),_=ga(e);t.shot=function(e,t){_.error_deprecated("shot","screen.shot"),r.shot(e,t)}}),KE=A("anchors",function(e,t){var r=Bs(e);t.attach_move_cb=r.attach_move_cb,t.detach_move_cb=r.detach_move_cb,t.is_anchor=r.is_anchor,t.get_element_id=r.get_element_id,t.update=function(){r.update(!0)}}),BE=A("armature",function(e,t){var r=os(e),_=Os(e),n=ga(e);t.get_bone_tsr=function(e,t,_){return r.is_armature(e)?ts(e,t)?(_||(_=new Float32Array(8)),Ji(e,t,!1,!1,_),_):(n.error('There is no bone: "',t,'" in "',e.name,'".'),null):null},t.get_bone_tsr_rel=function(e,t,_){return r.is_armature(e)?ts(e,t)?(_||(_=new Float32Array(8)),Ji(e,t,!1,!0,_),_):(n.error('There is no bone: "',t,'" in "',e.name,'".'),null):null},t.set_bone_tsr=function(e,t,a){r.is_armature(e)&&(ts(e,t)?(Zi(e,t,a,!1),_.update_transform(e)):n.error('There is no bone: "',t,'" in "',e.name,'".'))},t.set_bone_tsr_rel=function(e,t,a){r.is_armature(e)&&(ts(e,t)?(Zi(e,t,a,!0),_.update_transform(e)):n.error('There is no bone: "',t,'" in "',e.name,'".'))}}),XE=A("assets",function(e,t){var r=Ds(e);t.AT_ARRAYBUFFER=r.AT_ARRAYBUFFER,t.AT_ARRAYBUFFER_ZIP=r.AT_ARRAYBUFFER_ZIP,t.AT_JSON=r.AT_JSON,t.AT_JSON_ZIP=r.AT_JSON_ZIP,t.AT_TEXT=r.AT_TEXT,t.AT_AUDIOBUFFER=r.AT_AUDIOBUFFER,t.AT_IMAGE_ELEMENT=r.AT_IMAGE_ELEMENT,t.AT_AUDIO_ELEMENT=r.AT_AUDIO_ELEMENT,t.AT_VIDEO_ELEMENT=r.AT_VIDEO_ELEMENT,t.AT_SEQ_VIDEO_ELEMENT=r.AT_SEQ_VIDEO_ELEMENT,t.enqueue=function(e,t,_,n){e.length&&r.enqueue(e,t,_,n)}}),HE=A("geometry",function(e,t){var r=Ks(e),_=wi(e),n=ga(e),a=Qi(e);t.extract_vertex_array=function(e,t,a){if(!_.has_dyn_geom(e))return n.error("Wrong object:",e.name),null;var o=r.find_batch_material(e,t,"MAIN");if(o){var i=o.bufs_data;return i&&i.pointers&&("a_normal"==a&&i.pointers.a_tbn||i.pointers[a])?_.extract_array_float(i,a):(n.error("Attribute not found:"+a),null)}return n.error("Wrong material:",t),null},t.extract_index_array=function(e,t){if(!_.has_dyn_geom(e))return n.error("Wrong object:",e.name),null;var a=r.find_batch_material(e,t,"MAIN");if(a){var o=a.bufs_data;return o&&o.pointers?o.ibo_array:(n.error("Buffer data not found"),null)}return n.error("Wrong material:",t),null},t.update_vertex_array=function(e,t,a,o){if(_.has_dyn_geom(e))for(var i=["MAIN","SHADOW","COLOR_ID"],s=0;s<i.length;s++){var E=r.find_batch_material(e,t,i[s]);if(E){var c=E.bufs_data;c&&c.pointers&&("a_normal"==a&&c.pointers.a_tbn||c.pointers[a])&&_.update_bufs_data_array(c,a,0,o)}}else n.error("Wrong object:",e.name)},t.override_geometry=function(e,t,o,i,s){if(_.has_dyn_geom(e))if(o instanceof Uint16Array||o instanceof Uint32Array)if(i instanceof Float32Array)for(var E=["MAIN","SHADOW","COLOR_ID"],c=0;c<E.length;c++){var l=r.find_batch_material(e,t,E[c]);if(l){var T=l.bufs_data;if(T){_.update_bufs_data_index_array(T,l.draw_mode,o);var u={};for(var d in T.pointers){var f=i.length/3*(p=T.pointers[d]).num_comp;u[S=_.get_vbo_type_by_attr_name(d)]||(u[S]=0),u[S]+=f}var P=_.init_vbo_source_data(u);T.vbo_source_data=P;var A={};for(var d in T.pointers){var S,p=T.pointers[d];switch(A[S=_.get_vbo_type_by_attr_name(d)]||(A[S]=0),d){case"a_position":_.vbo_source_data_set_attr(T.vbo_source_data,"a_position",i,A[S]),p.offset=A[S],p.length=i.length,A[S]+=p.length;break;case"a_tbn":var m;s&&(m=_.calc_shared_indices(o,i,i));var O=_.calc_normals(o,i,m);p.length=i.length/3*p.num_comp;for(var v=new Float32Array(p.length),N=0;N<v.length;N+=4)v[N]=1,v[N+3]=1;var g=Ai(O,v);_.vbo_source_data_set_attr(T.vbo_source_data,"a_tbn",g,A[S]),p.offset=A[S],A[S]+=p.length;break;default:p.offset=A[S],p.length=i.length/3*p.num_comp;var h=new(_.get_constructor_by_type(S))(p.length);_.vbo_source_data_set_attr(T.vbo_source_data,d,h,A[S]),A[S]+=p.length}}_.update_gl_buffers(T),a.assign_attribute_setters(l);var R=r.find_batch_material_forked(e,l);R&&R.bufs_data&&(R.bufs_data=T)}}}else n.error("Wrong positions_array type");else n.error("Wrong ibo_array type");else n.error("Wrong object:",e.name)},t.set_shape_key_value=function(e,t,r){if(_.check_shape_keys(e))if(_.has_shape_key(e,t)){var a=parseFloat(r);_.apply_shape_key(e,t,a)}else n.error("Wrong key name:",t);else n.error("Wrong object:",e.name)},t.check_shape_keys=function(e){return _.check_shape_keys(e)},t.get_shape_keys_names=function(e){return _.check_shape_keys(e)?_.get_shape_keys_names(e):(n.error("Wrong object:",e.name),[])},t.get_shape_key_value=function(e,t){return _.check_shape_keys(e)?_.has_shape_key(e,t)?_.get_shape_key_value(e,t):(n.error("Wrong key name:",t),0):(n.error("Wrong object:",e.name),0)},t.draw_line=function(e,t,o){if(o=o||!1,t instanceof Float32Array){var i=r.get_first_batch(e);i&&(_.draw_line(i,t,o),a.assign_attribute_setters(i))}else n.error("Wrong positions type")}}),QE=A("hud",function(e,t){var r=us(e),_=ga(e);t.draw_mixer_strip=function(e,t,n,a,o,i,s){_.error_deprecated("draw_mixer_strip","screen.draw_mixer_strip"),r.draw_mixer_strip(e,t,n,a,o,i,s)},t.plot_array=function(e,t,n,a,o,i,s){_.error_deprecated("plot_array","screen.plot_array"),r.plot_array(e,t,n,a,o,i,s)}}),zE=A("lights",function(e,t){var r=Ms(e),_=os(e),n=ga(e),a=ps(e),o=Os(e),i=new Float32Array(3),s={},E=60;function c(e){for(var t=a.get_active(),_=r.get_scene_objs(t,"LAMP",r.DATA_ID_ALL),s=0;s<_.length;s++){var E=_[s];if("SUN"==E.light.type){var c=E;break}}if(c){if("number"==typeof e.hor_position&&"number"==typeof e.vert_position){var l=In(180-e.hor_position),T=In(90-e.vert_position),u=c.render;o.set_rotation_euler(c,[T,0,l]);var d=new Float32Array(3);sn(Ba(u.world_tsr),S_,d);var f=De(Fa(u.world_tsr));he(d,i),ye(i,f,i),o.set_translation(c,i),o.update_transform(c);var P=c.light;if(P.dynamic_intensity){var A=t.world.light_settings.environment_energy,S=t.world.horizon_color,p=t.world.zenith_color,m=Math.cos(Math.abs(T)),O=Math.max(Math.min(3*m,1),0)*P.default_energy,v=Math.max(m,.1)*A;ns(P,O),a.set_environment_colors(t,v,S,p)}a.update_lamp_scene(c,t)}}else n.error("There is no sun on the scene")}function l(e){return _.is_lamp(e)?e.light.type:(n.error("get_light_type(): Wrong object"),"")}t.get_lamps=function(e){var t=a.get_active(),_=r.get_scene_objs(t,"LAMP",r.DATA_ID_ALL);if(!e)return _;for(var n=[],o=0;o<_.length;o++){var i=_[o];i.light.type===e&&n.push(i)}return n},t.get_sun_params=function(){for(var e=a.get_active(),t=r.get_scene_objs(e,"LAMP",r.DATA_ID_ALL),_=null,n=0;n<t.length;n++){var o=t[n];if("SUN"==o.light.type){_=o;break}}if(_){var i=_.light.direction,s=bn(Math.atan2(-i[1],i[0]))+90;s>180&&(s-=360);var E=bn(Math.atan2(i[2],Math.sqrt(i[0]*i[0]+i[1]*i[1]))),c={};return c.hor_position=s,c.vert_position=E,c}return null},t.set_sun_params=c,t.set_day_time=function(e){for(var t=a.get_active(),_=r.get_scene_objs(t,"LAMP",r.DATA_ID_ALL),o=0;o<_.length;o++){var i=_[o];if("SUN"==i.light.type){var s=i;break}}s?function(e){var t=e<12?15*e:15*(e-24),r=-Math.cos(e/12*Math.PI)*E,_={};_.hor_position=t,_.vert_position=r,c(_)}(e):n.error("There is no sun on the scene")},t.set_date=function(e){s.y=e.getFullYear(),s.m=e.getMonth(),s.d=e.getDate(),s.y?1582==s.y&&9==s.m&&s.d>4&&s.d<15&&n.error("The dates 5 through 14 October, 1582, do not exist in the Gregorian system!"):n.error("There is no year 0 in the Julian system!")},t.set_max_sun_angle=function(e){E=Math.min(Math.max(e,0),90)},t.get_light_params=function(e){if(!_.is_lamp(e))return n.error("get_light_params(): Wrong object"),null;var t=e.light,r=l(e);if(r)switch(r){case"SPOT":(a={light_type:r,light_color:new Float32Array(3),light_energy:t.energy,light_spot_blend:t.spot_blend,light_spot_size:t.spot_size,light_distance:t.distance}).light_color.set(t.color);break;case"POINT":(a={light_type:r,light_color:new Float32Array(3),light_energy:t.energy,light_distance:t.distance}).light_color.set(t.color);break;default:var a;(a={light_type:r,light_color:new Float32Array(3),light_energy:t.energy}).light_color.set(t.color)}return a||null},t.get_light_type=l,t.set_light_params=function(e,t){if(_.is_lamp(e)){var r=e.light,o=a.get_active(),i=!1;"number"==typeof t.light_energy&&ns(r,t.light_energy),"object"==typeof t.light_color&&_s(r,t.light_color),"number"==typeof t.light_spot_blend&&(function(e,r){e.spot_blend=t.light_spot_blend}(r),i=!0),"number"==typeof t.light_spot_size&&(function(e,r){e.spot_size=t.light_spot_size}(r),i=!0),"number"==typeof t.light_distance&&(function(e,r){e.distance=t.light_distance}(r),i=!0),a.update_lamp_scene(e,o),i&&a.update_all_mesh_shaders(o)}else n.error("set_light_params(): Wrong object")},t.get_light_energy=function(e){return _.is_lamp(e)?e.light.energy:(n.error("get_light_energy(): Wrong object"),0)},t.set_light_energy=function(e,t){if(_.is_lamp(e)){var r=a.get_active();ns(e.light,t),a.update_lamp_scene(e,r)}else n.error("set_light_energy(): Wrong object")},t.get_light_color=function(e,t){return _.is_lamp(e)?((t=t||new Float32Array(3)).set(e.light.color),t):(n.error("get_light_color(): Wrong object"),null)},t.set_light_color=function(e,t){if(_.is_lamp(e)){var r=a.get_active();_s(e.light,t),a.update_lamp_scene(e,r)}else n.error("set_light_color(): Wrong object")}}),VE=A("logic_nodes",function(e,t){var r=rE(e);t.append_custom_callback=function(e,t){r.append_custom_cb(e,t)},t.remove_custom_callback=function(e){r.remove_custom_cb(e)},t.run_entrypoint=function(e,t){r.run_ep(e,t)}}),jE=A("material",function(e,t){var r=Ks(e),_=Wo(e),n=wi(e),a=Ms(e),o=os(e),i=ga(e),s=Gs(e),E=ps(e),c=_.defaults;t.inherit_material=function(e,t,r,_){if(n.has_dyn_geom(r)&&n.has_dyn_geom(e)){var o=e.mat_inheritance_data.original_mat_names.indexOf(t);if(-1!=o){var s=r.mat_inheritance_data.original_mat_names.indexOf(_);-1!=s?(0==r._bpy_obj.data.submeshes[s].shade_tangs.length&&e.materials[o].use_tangent_shading&&i.warn('The target material "'+_+'" was exported without tangent shading data. However, the "'+t+'" material requires it. It\'s needed to enable the "Tangent Shading" option on the target material for correct rendering.'),a.inherit_material(e,t,r,_)):i.error('inherit_material(): material "'+_+'" not found on the object "'+r.origin_name+'".')}else i.error('inherit_material(): material "'+t+'" not found on the object "'+e.origin_name+'".')}else i.error('inherit_material(): both objects "'+e.origin_name+'" and "'+r.origin_name+'" must have the "Dynamic Geometry & Materials" flag enabled.')},t.get_materials_names=function(e){var t=[];if(!o.is_dynamic_mesh(e))return i.error('get_materials_names(): Object "'+e.name+'" is not a dynamic MESH.'),t;for(var r=e.scenes_data,_=0;_<r.length;_++)for(var n=r[_].batches,a=0;a<n.length;a++){var s=n[a];if("MAIN"==s.type)for(var E=0;E<s.material_names.length;E++)-1==t.indexOf(s.material_names[E])&&t.push(s.material_names[E])}return t},t.set_diffuse_color=function(e,t,_){if(o.is_dynamic_mesh(e)){var n=r.find_batch_material(e,t,"MAIN");if(n)if(n.has_nodes)i.error("set_diffuse_color(): Not allowed for node materials! Use set_nodemat_value/set_nodemat_rgb methods instead.");else{n.diffuse_color.set(_);var a=r.find_batch_material_forked(e,t,"MAIN");a&&a.diffuse_color.set(_)}else i.error('set_diffuse_color(): Material "'+t+'" wasn\'t found on the object "'+e.name+'".')}else i.error('set_diffuse_color(): Object "'+e.name+'" is not a dynamic MESH.')},t.get_diffuse_color=function(e,t){var _=new Float32Array(4);if(!o.is_dynamic_mesh(e))return i.error('get_diffuse_color(): Object "'+e.name+'" is not a dynamic MESH.'),_;var n=r.find_batch_material(e,t,"MAIN");return n?n.has_nodes?(i.error("get_diffuse_color(): Not allowed for node materials! Use get_nodemat_value/get_nodemat_rgb methods instead."),_):(_.set(n.diffuse_color),_):(i.error('get_diffuse_color(): Material "'+t+'" wasn\'t found on the object "'+e.name+'".'),_)},t.set_diffuse_intensity=function(e,t,_){if(o.is_dynamic_mesh(e)){var n=r.find_batch_material(e,t,"MAIN");if(n)if(n.has_nodes)i.error("set_diffuse_intensity(): Not allowed for node materials! Use set_nodemat_value/set_nodemat_rgb methods instead.");else{n.diffuse_intensity=_;var a=r.find_batch_material_forked(e,t,"MAIN");a&&(a.diffuse_intensity=_)}else i.error('set_diffuse_intensity(): Material "'+t+'" wasn\'t found on the object "'+e.name+'".')}else i.error('set_diffuse_intensity(): Object "'+e.name+'" is not a dynamic MESH.')},t.get_diffuse_intensity=function(e,t){if(!o.is_dynamic_mesh(e))return i.error('get_diffuse_intensity(): Object "'+e.name+'" is not a dynamic MESH.'),0;var _=r.find_batch_material(e,t,"MAIN");return _?_.has_nodes?(i.error("get_diffuse_intensity(): Not allowed for node materials! Use get_nodemat_value/get_nodemat_rgb methods instead."),0):_.diffuse_intensity:(i.error('get_diffuse_intensity(): Material "'+t+'" wasn\'t found on the object "'+e.name+'".'),0)},t.set_specular_color=function(e,t,_){if(o.is_dynamic_mesh(e)){var n=r.find_batch_material(e,t,"MAIN");if(n)if(n.has_nodes)i.error("set_specular_color(): Not allowed for node materials! Use set_nodemat_value/set_nodemat_rgb methods instead.");else{n.specular_color.set(_);var a=r.find_batch_material_forked(e,t,"MAIN");a&&a.specular_color.set(_)}else i.error('set_specular_color(): Material "'+t+'" wasn\'t found on the object "'+e.name+'".')}else i.error('set_specular_color(): Object "'+e.name+'" is not a dynamic MESH.')},t.get_specular_color=function(e,t){var _=new Float32Array(3);if(!o.is_dynamic_mesh(e))return i.error('get_specular_color(): Object "'+e.name+'" is not a dynamic MESH.'),_;var n=r.find_batch_material(e,t,"MAIN");return n?n.has_nodes?(i.error("get_specular_color(): Not allowed for node materials! Use get_nodemat_value/get_nodemat_rgb methods instead."),_):(_.set(n.specular_color),_):(i.error('get_specular_color(): Material "'+t+'" wasn\'t found on the object "'+e.name+'".'),_)},t.set_specular_color_factor=function(e,t,_){if(o.is_dynamic_mesh(e)){var n=r.find_batch_material(e,t,"MAIN");if(n)if(n.has_nodes)i.error("set_specular_color_factor(): Not allowed for node materials! Use set_nodemat_value/set_nodemat_rgb methods instead.");else{n.specular_color_factor=_;var a=r.find_batch_material_forked(e,t,"MAIN");a&&(a.specular_color_factor=_)}else i.error('set_specular_color_factor(): Material "'+t+'" wasn\'t found on the object "'+e.name+'".')}else i.error('set_specular_color_factor(): Object "'+e.name+'" is not a dynamic MESH.')},t.get_specular_color_factor=function(e,t){if(!o.is_dynamic_mesh(e))return i.error('get_specular_color_factor(): Object "'+e.name+'" is not a dynamic MESH.'),0;var _=r.find_batch_material(e,t,"MAIN");return _?_.has_nodes?(i.error("get_specular_color_factor(): Not allowed for node materials! Use get_nodemat_value/get_nodemat_rgb methods instead."),0):_.specular_color_factor:(i.error('get_specular_color_factor(): Material "'+t+'" wasn\'t found on the object "'+e.name+'".'),0)},t.set_specular_intensity=function(e,t,_){if(o.is_dynamic_mesh(e)){var n=r.find_batch_material(e,t,"MAIN");if(n)if(n.has_nodes)i.error("set_specular_intensity(): Not allowed for node materials! Use set_nodemat_value/set_nodemat_rgb methods instead.");else{n.specular_params[0]=_;var a=r.find_batch_material_forked(e,t,"MAIN");a&&(a.specular_params[0]=_)}else i.error('set_specular_intensity(): Material "'+t+'" wasn\'t found on the object "'+e.name+'".')}else i.error('set_specular_intensity(): Object "'+e.name+'" is not a dynamic MESH.')},t.get_specular_intensity=function(e,t){if(!o.is_dynamic_mesh(e))return i.error('get_specular_intensity(): Object "'+e.name+'" is not a dynamic MESH.'),0;var _=r.find_batch_material(e,t,"MAIN");return _?_.has_nodes?(i.error("get_specular_intensity(): Not allowed for node materials! Use get_nodemat_value/get_nodemat_rgb methods instead."),0):_.specular_params[0]:(i.error('get_specular_intensity(): Material "'+t+'" wasn\'t found on the object "'+e.name+'".'),0)},t.check_specular_intensity=function(e,t){i.error_once("check_specular_intensity() is deprecated, not needed anymore");var _=r.find_batch_material(e,t,"MAIN");return Boolean(_&&_.specular_params[0])},t.set_specular_hardness=function(e,t,_){if(o.is_dynamic_mesh(e)){var n=r.find_batch_material(e,t,"MAIN");if(n)if(n.has_nodes)i.error("set_specular_hardness(): Not allowed for node materials! Use set_nodemat_value/set_nodemat_rgb methods instead.");else{n.specular_params[1]=_;var a=r.find_batch_material_forked(e,t,"MAIN");a&&(a.specular_params[1]=_)}else i.error('set_specular_hardness(): Material "'+t+'" wasn\'t found on the object "'+e.name+'".')}else i.error('set_specular_hardness(): Object "'+e.name+'" is not a dynamic MESH.')},t.get_specular_hardness=function(e,t){if(!o.is_dynamic_mesh(e))return i.error('get_specular_hardness(): Object "'+e.name+'" is not a dynamic MESH.'),0;var _=r.find_batch_material(e,t,"MAIN");return _?_.has_nodes?(i.error("get_specular_hardness(): Not allowed for node materials! Use get_nodemat_value/get_nodemat_rgb methods instead."),0):_.specular_params[1]:(i.error('get_specular_hardness(): Material "'+t+'" wasn\'t found on the object "'+e.name+'".'),0)},t.check_specular_hardness=function(e,t){i.error_once("check_specular_hardness() is deprecated, not needed anymore");var _=r.find_batch_material(e,t,"MAIN");return Boolean(_&&_.specular_params[1])},t.set_emit_factor=function(e,t,_){if(o.is_dynamic_mesh(e)){var n=r.find_batch_material(e,t,"MAIN");if(n)if(n.has_nodes)i.error("set_emit_factor(): Not allowed for node materials! Use set_nodemat_value/set_nodemat_rgb methods instead.");else{n.emit=_;var a=r.find_batch_material_forked(e,t,"MAIN");a&&(a.emit=_)}else i.error('set_emit_factor(): Material "'+t+'" wasn\'t found on the object "'+e.name+'".')}else i.error('set_emit_factor(): Object "'+e.name+'" is not a dynamic MESH.')},t.get_emit_factor=function(e,t){if(!o.is_dynamic_mesh(e))return i.error('get_emit_factor(): Object "'+e.name+'" is not a dynamic MESH.'),0;var _=r.find_batch_material(e,t,"MAIN");return _?_.has_nodes?(i.error("get_emit_factor(): Not allowed for node materials! Use get_nodemat_value/get_nodemat_rgb methods instead."),0):_.emit:(i.error('get_emit_factor(): Material "'+t+'" wasn\'t found on the object "'+e.name+'".'),0)},t.set_ambient_factor=function(e,t,_){if(o.is_dynamic_mesh(e)){var n=r.find_batch_material(e,t,"MAIN");if(n)if(n.has_nodes)i.error("set_ambient_factor(): Not allowed for node materials! Use set_nodemat_value/set_nodemat_rgb methods instead.");else{n.ambient=_;var a=r.find_batch_material_forked(e,t,"MAIN");a&&(a.ambient=_)}else i.error('set_ambient_factor(): Material "'+t+'" wasn\'t found on the object "'+e.name+'".')}else i.error('set_ambient_factor(): Object "'+e.name+'" is not a dynamic MESH.')},t.get_ambient_factor=function(e,t){if(!o.is_dynamic_mesh(e))return i.error('get_ambient_factor(): Object "'+e.name+'" is not a dynamic MESH.'),0;var _=r.find_batch_material(e,t,"MAIN");return _?_.has_nodes?(i.error("get_ambient_factor(): Not allowed for node materials! Use get_nodemat_value/get_nodemat_rgb methods instead."),0):_.ambient:(i.error('get_ambient_factor(): Material "'+t+'" wasn\'t found on the object "'+e.name+'".'),0)},t.set_diffuse_color_factor=function(e,t,_){if(o.is_dynamic_mesh(e)){var n=r.find_batch_material(e,t,"MAIN");if(n)if(n.has_nodes)i.error("set_diffuse_color_factor(): Not allowed for node materials! Use set_nodemat_value/set_nodemat_rgb methods instead.");else{n.diffuse_color_factor=_;var a=r.find_batch_material_forked(e,t,"MAIN");a&&(a.diffuse_color_factor=_)}else i.error('set_diffuse_color_factor(): Material "'+t+'" wasn\'t found on the object "'+e.name+'".')}else i.error('set_diffuse_color_factor(): Object "'+e.name+'" is not a dynamic MESH.')},t.get_diffuse_color_factor=function(e,t){if(!o.is_dynamic_mesh(e))return i.error('get_diffuse_color_factor(): Object "'+e.name+'" is not a dynamic MESH.'),0;var _=r.find_batch_material(e,t,"MAIN");return _?_.has_nodes?(i.error("get_diffuse_color_factor(): Not allowed for node materials! Use get_nodemat_value/get_nodemat_rgb methods instead."),0):_.diffuse_color_factor:(i.error('get_diffuse_color_factor(): Material "'+t+'" wasn\'t found on the object "'+e.name+'".'),0)},t.set_alpha_factor=function(e,t,_){if(o.is_dynamic_mesh(e)){var n=r.find_batch_material(e,t,"MAIN");if(n)if(n.has_nodes)i.error("set_alpha_factor(): Not allowed for node materials! Use set_nodemat_value/set_nodemat_rgb methods instead.");else{n.alpha_factor=_;var a=r.find_batch_material_forked(e,t,"MAIN");a&&(a.alpha_factor=_)}else i.error('set_alpha_factor(): Material "'+t+'" wasn\'t found on the object "'+e.name+'".')}else i.error('set_alpha_factor(): Object "'+e.name+'" is not a dynamic MESH.')},t.get_alpha_factor=function(e,t){if(!o.is_dynamic_mesh(e))return i.error('get_alpha_factor(): Object "'+e.name+'" is not a dynamic MESH.'),0;var _=r.find_batch_material(e,t,"MAIN");return _?_.has_nodes?(i.error("get_alpha_factor(): Not allowed for node materials! Use get_nodemat_value/get_nodemat_rgb methods instead."),0):_.alpha_factor:(i.error('get_alpha_factor(): Material "'+t+'" wasn\'t found on the object "'+e.name+'".'),0)},t.get_material_extended_params=function(e,t){if(!o.is_dynamic_mesh(e))return i.error('get_material_extended_params(): Object "'+e.name+'" is not a dynamic MESH.'),null;var _=r.find_batch_material(e,t,"MAIN");if(!_)return i.error('get_material_extended_params(): Material "'+t+'" wasn\'t found on the object "'+e.name+'".'),null;if(_.has_nodes)return i.error("get_material_extended_params(): Not allowed for node materials! Use get_nodemat_value/get_nodemat_rgb methods instead."),null;var n={};return n.reflect_factor=_.reflect_factor,n.fresnel=_.fresnel_params[0],n.fresnel_factor=5*(1-_.fresnel_params[1]),n.parallax_scale=_.parallax_scale,n.parallax_steps=parseFloat(r.get_batch_directive(_,"PARALLAX_STEPS")[1]),n},t.set_material_extended_params=function(e,t,_){if(o.is_dynamic_mesh(e)){var n=r.find_batch_material(e,t,"MAIN");if(n)if(n.has_nodes)i.error("set_material_extended_params(): Not allowed for node materials! Use set_nodemat_value/set_nodemat_rgb methods instead.");else{var a=[n],c=r.find_batch_material_forked(e,t,"MAIN");c&&a.push(c);for(var l=0;l<a.length;l++)n=a[l],"number"==typeof _.reflect_factor&&(n.reflect_factor=_.reflect_factor),"number"==typeof _.fresnel&&(n.fresnel_params[0]=_.fresnel),"number"==typeof _.fresnel_factor&&(n.fresnel_params[1]=1-_.fresnel_factor/5),"number"==typeof _.parallax_scale&&(n.parallax_scale=_.parallax_scale),"number"==typeof _.parallax_steps&&(r.set_batch_directive(n,"PARALLAX_STEPS",s.glsl_value(_.parallax_steps)),r.update_shader(n),E.recalculate_draw_data(n))}else i.error('set_material_extended_params(): Material "'+t+'" wasn\'t found on the object "'+e.name+'".')}else i.error('set_material_extended_params(): Object "'+e.name+'" is not a dynamic MESH.')},t.get_water_material_params=function(e,t){if(!o.is_dynamic_mesh(e))return i.error('get_water_material_params(): Object "'+e.name+'" is not a dynamic MESH.'),null;var _=r.find_batch_material(e,t,"MAIN");if(!_||!_.water)return i.error('get_water_material_params(): Material "'+t+'" wasn\'t found on the object "'+e.name+"\" or it's not a water material."),null;if(_.has_nodes)return i.error("get_water_material_params(): Not allowed for node materials! Use get_nodemat_value/get_nodemat_rgb methods instead."),null;var n={};return n.shore_smoothing=c.shore_smoothing&&_.water_shore_smoothing&&Boolean(parseFloat(r.get_batch_directive(_,"SHORE_SMOOTHING")[1])),n.absorb_factor=parseFloat(r.get_batch_directive(_,"ABSORB")[1]),n.foam_factor=_.foam_factor,n.shallow_water_col=new Float32Array(3),n.shore_water_col=new Float32Array(3),n.shallow_water_col_fac=0,n.shore_water_col_fac=0,c.shore_distance&&(n.shallow_water_col.set(_.shallow_water_col),n.shore_water_col.set(_.shore_water_col),n.shallow_water_col_fac=_.shallow_water_col_fac,n.shore_water_col_fac=_.shore_water_col_fac),n.norm_uv_velocity=_.water_norm_uv_velocity,n.water_dynamic=c.water_dynamic&&_.water_dynamic&&Boolean(parseFloat(r.get_batch_directive(_,"DYNAMIC")[1])),n.sss_strength=parseFloat(r.get_batch_directive(_,"SSS_STRENGTH")[1]),n.sss_width=parseFloat(r.get_batch_directive(_,"SSS_WIDTH")[1]),n.waves_height=parseFloat(r.get_batch_directive(_,"WAVES_HEIGHT")[1]),n.waves_length=parseFloat(r.get_batch_directive(_,"WAVES_LENGTH")[1]),n.dst_noise_scale0=parseFloat(r.get_batch_directive(_,"DST_NOISE_SCALE_0")[1]),n.dst_noise_scale1=parseFloat(r.get_batch_directive(_,"DST_NOISE_SCALE_1")[1]),n.dst_noise_freq0=parseFloat(r.get_batch_directive(_,"DST_NOISE_FREQ_0")[1]),n.dst_noise_freq1=parseFloat(r.get_batch_directive(_,"DST_NOISE_FREQ_1")[1]),n.dir_min_shore_fac=parseFloat(r.get_batch_directive(_,"DIR_MIN_SHR_FAC")[1]),n.dir_freq=parseFloat(r.get_batch_directive(_,"DIR_FREQ")[1]),n.dir_noise_scale=parseFloat(r.get_batch_directive(_,"DIR_NOISE_SCALE")[1]),n.dir_noise_freq=parseFloat(r.get_batch_directive(_,"DIR_NOISE_FREQ")[1]),n.dir_min_noise_fac=parseFloat(r.get_batch_directive(_,"DIR_MIN_NOISE_FAC")[1]),n.dst_min_fac=parseFloat(r.get_batch_directive(_,"DST_MIN_FAC")[1]),n.waves_hor_fac=parseFloat(r.get_batch_directive(_,"WAVES_HOR_FAC")[1]),n},t.set_water_material_params=function(e,t,_){if(o.is_dynamic_mesh(e)){var n=r.find_batch_material(e,t,"MAIN");if(n&&n.water)if(n.has_nodes)i.error("set_water_material_params(): Not allowed for node materials! Use set_nodemat_value/set_nodemat_rgb methods instead.");else{var a=[n],l=r.find_batch_material_forked(e,t,"MAIN");l&&a.push(l);for(var T=0;T<a.length;T++){if(n=a[T],"boolean"==typeof _.shore_smoothing&&r.set_batch_directive(n,"SHORE_SMOOTHING",c.shore_smoothing&&n.water_shore_smoothing&&_.shore_smoothing?1:0),"number"==typeof _.absorb_factor){var u=s.glsl_value(parseFloat(_.absorb_factor));r.set_batch_directive(n,"ABSORB",u)}if("number"==typeof _.foam_factor&&c.foam&&(n.foam_factor=_.foam_factor),c.shore_distance&&("object"==typeof _.shallow_water_col&&n.shallow_water_col.set(_.shallow_water_col),"number"==typeof _.shallow_water_col_fac&&(n.shallow_water_col_fac=_.shallow_water_col_fac),"object"==typeof _.shore_water_col&&n.shore_water_col.set(_.shore_water_col),"number"==typeof _.shore_water_col_fac&&(n.shore_water_col_fac=_.shore_water_col_fac)),"number"==typeof _.norm_uv_velocity&&(n.water_norm_uv_velocity=_.norm_uv_velocity),c.water_dynamic&&n.water_dynamic){if("boolean"==typeof _.water_dynamic&&r.set_batch_directive(n,"DYNAMIC",_.water_dynamic?1:0),"number"==typeof _.sss_strength){var d=s.glsl_value(parseFloat(_.sss_strength));r.set_batch_directive(n,"SSS_STRENGTH",d)}if("number"==typeof _.sss_width&&(d=s.glsl_value(parseFloat(_.sss_width)),r.set_batch_directive(n,"SSS_WIDTH",d)),"number"==typeof _.waves_height){var f=s.glsl_value(parseFloat(_.waves_height));r.set_batch_directive(n,"WAVES_HEIGHT",f)}if("number"==typeof _.waves_length&&(d=s.glsl_value(parseFloat(_.waves_length)),r.set_batch_directive(n,"WAVES_LENGTH",d)),"number"==typeof _.dst_noise_scale0){var P=s.glsl_value(parseFloat(_.dst_noise_scale0));r.set_batch_directive(n,"DST_NOISE_SCALE_0",P)}if("number"==typeof _.dst_noise_scale1){var A=s.glsl_value(parseFloat(_.dst_noise_scale1));r.set_batch_directive(n,"DST_NOISE_SCALE_1",A)}if("number"==typeof _.dst_noise_freq0){var S=s.glsl_value(parseFloat(_.dst_noise_freq0));r.set_batch_directive(n,"DST_NOISE_FREQ_0",S)}if("number"==typeof _.dst_noise_freq1){var p=s.glsl_value(parseFloat(_.dst_noise_freq1));r.set_batch_directive(n,"DST_NOISE_FREQ_1",p)}if("number"==typeof _.dir_min_shore_fac){var m=s.glsl_value(parseFloat(_.dir_min_shore_fac));r.set_batch_directive(n,"DIR_MIN_SHR_FAC",m)}if("number"==typeof _.dir_freq){var O=s.glsl_value(parseFloat(_.dir_freq));r.set_batch_directive(n,"DIR_FREQ",O)}if("number"==typeof _.dir_noise_scale){var v=s.glsl_value(parseFloat(_.dir_noise_scale));r.set_batch_directive(n,"DIR_NOISE_SCALE",v)}if("number"==typeof _.dir_noise_freq){var N=s.glsl_value(parseFloat(_.dir_noise_freq));r.set_batch_directive(n,"DIR_NOISE_FREQ",N)}if("number"==typeof _.dir_min_noise_fac){var g=s.glsl_value(parseFloat(_.dir_min_noise_fac));r.set_batch_directive(n,"DIR_MIN_NOISE_FAC",g)}if("number"==typeof _.dst_min_fac){var h=s.glsl_value(parseFloat(_.dst_min_fac));r.set_batch_directive(n,"DST_MIN_FAC",h)}if("number"==typeof _.waves_hor_fac){var R=s.glsl_value(parseFloat(_.waves_hor_fac));r.set_batch_directive(n,"WAVES_HOR_FAC",R)}}r.update_shader(n),E.recalculate_draw_data(n)}}else i.error('set_water_material_params(): Material "'+t+'" wasn\'t found on the object "'+e.name+"\" or it's not a water material.")}else i.error('set_water_material_params(): Object "'+e.name+'" is not a dynamic MESH.')},t.set_line_params=function(e,t){if(o.is_line(e)){var _=r.get_first_batch(e);_?(z_(t.color)&&_.diffuse_color.set(t.color),z_(t.width)&&(_.line_width=t.width)):i.error("set_line_params(): Couldn't set line parameters!")}else i.error('set_line_params(): Object "'+e.name+'" is not a LINE object.')},t.get_line_params=function(e){if(!o.is_line(e))return i.error('get_line_params(): Object "'+e.name+'" is not a LINE object.'),null;var t=r.get_first_batch(e);return t?{color:new Float32Array(t.diffuse_color),width:t.line_width}:(i.error("get_line_params(): Couldn't get line parameters!"),null)},t.set_nodemat_value=function(e,t,_){var n=o.is_dynamic_mesh(e),s=o.is_world(e),c=s?a.get_world_name(e):e.name;if(n||s){if(n){var l=1;if(!r.find_batch_material_any(e,u=t[0],"MAIN")&&!r.find_batch_material_any(e,u,"PARTICLES"))return void i.error('set_nodemat_value(): Material "'+u+'" wasn\'t found on the object "'+c+'".')}else if(s){var T=E.get_active(),u="";if(l=0,!r.get_batch_by_type(e,"SKY",T))return void i.error("set_nodemat_value(): Sky node material wasn't found on the world object \""+c+'".')}var d=r.name_list_to_node_name(t,l);a.set_nodemat_value(e,u,d,_)||i.error('set_nodemat_value(): Value node "'+t[t.length-1]+'" was not found in the object "'+c+'".')}else i.error('set_nodemat_value(): Object "'+c+'" is not a dynamic MESH or WORLD.')},t.get_nodemat_value=function(e,t){var _=o.is_dynamic_mesh(e),n=o.is_world(e),s=n?a.get_world_name(e):e.name;if(!_&&!n)return i.error('get_nodemat_value(): Object "'+s+'" is not a dynamic MESH or WORLD.'),0;if(_){var c=1;if(!r.find_batch_material_any(e,T=t[0],"MAIN")&&!r.find_batch_material_any(e,T,"PARTICLES"))return i.error('get_nodemat_value(): Material "'+T+'" wasn\'t found on the object "'+s+'".'),0}else if(n){var l=E.get_active(),T="";if(c=0,!r.get_batch_by_type(e,"SKY",l))return i.error("get_nodemat_value(): Sky node material wasn't found on the world object \""+s+'".'),0}var u=r.name_list_to_node_name(t,c),d=a.get_nodemat_value(e,T,u);return null===d&&i.error('get_nodemat_value(): Value node "'+t[t.length-1]+'" was not found in the object "'+s+'".'),d},t.set_nodemat_rgb=function(e,t,_,n,s){var c=o.is_dynamic_mesh(e),l=o.is_world(e),T=l?a.get_world_name(e):e.name;if(c||l){if(c){var u=1;if(!r.find_batch_material_any(e,f=t[0],"MAIN")&&!r.find_batch_material_any(e,f,"PARTICLES"))return void i.error('set_nodemat_rgb(): Material "'+f+'" wasn\'t found on the object "'+T+'".')}else if(l){var d=E.get_active(),f="";if(u=0,!r.get_batch_by_type(e,"SKY",d))return void i.error("set_nodemat_rgb(): Sky node material wasn't found on the world object \""+T+'".')}var P=r.name_list_to_node_name(t,u);a.set_nodemat_rgb(e,f,P,_,n,s)||i.error('set_nodemat_rgb(): RGB node "'+t[t.length-1]+'" was not found in the object "'+T+'".')}else i.error('set_nodemat_rgb(): Object "'+T+'" is not a dynamic MESH or WORLD.')},t.get_nodemat_rgb=function(e,t,_){var n=o.is_dynamic_mesh(e),s=o.is_world(e),c=s?a.get_world_name(e):e.name;if(!n&&!s)return i.error('get_nodemat_rgb(): Object "'+c+'" is not a dynamic MESH or WORLD.'),null;if(n){var l=1;if(!r.find_batch_material_any(e,u=t[0],"MAIN")&&!r.find_batch_material_any(e,u,"PARTICLES"))return i.error('get_nodemat_rgb(): Material "'+u+'" wasn\'t found on the object "'+c+'".'),null}else if(s){var T=E.get_active(),u="";if(l=0,!r.get_batch_by_type(e,"SKY",T))return i.error("get_nodemat_rgb(): Sky node material wasn't found on the world object \""+c+'".'),null}_||(_=new Float32Array(3));var d=r.name_list_to_node_name(t,l);return(_=a.get_nodemat_rgb(e,u,d,_))||i.error('get_nodemat_rgb(): RGB node "'+t[t.length-1]+'" was not found in the object "'+c+'".'),_},t.is_node_material=function(e,t){if(!o.is_dynamic_mesh(e))return i.error('is_node_material(): Object "'+e.name+'" is not a dynamic MESH.'),!1;var _=r.find_batch_material(e,t,"MAIN");return _?_.has_nodes:(i.error('is_node_material(): Material "'+t+'" wasn\'t found on the object "'+e.name+'".'),!1)},t.is_water_material=function(e,t){if(!o.is_dynamic_mesh(e))return i.error('is_water_material(): Object "'+e.name+'" is not a dynamic MESH.'),!1;var _=r.find_batch_material(e,t,"MAIN");return _?_.water&&!_.has_nodes:(i.error('is_water_material(): Material "'+t+'" wasn\'t found on the object "'+e.name+'".'),!1)}}),qE=A("math",function(e,t){var r=new Float32Array(3);t.create_pline_from_points=function(e,t){var _=new Float32Array(6);return Tt(_,e),be(t,e,r),ut(_,r),_},t.create_pline_from_point_vec=function(e,t){var r=new Float32Array(6);return Tt(r,e),ut(r,t),r},t.create_pline=function(){return new Float32Array(6)},t.get_pline_directional_vec=ct,t.get_pline_initial_point=lt,t.set_pline_initial_point=Tt,t.set_pline_directional_vec=ut,t.line_plane_intersect=ra,t.calc_pline_point=dt,t.point_plane_dist=At,t.linear_tween=vt,t.ease_in_quad=Nt,t.ease_out_quad=gt,t.ease_in_out_quad=ht,t.ease_in_cubic=Rt,t.ease_out_cubic=It,t.ease_in_out_cubic=bt,t.ease_in_quart=Yt,t.ease_out_quart=Lt,t.ease_in_out_quart=Mt,t.ease_in_quint=xt,t.ease_out_quint=yt,t.ease_in_out_quint=wt,t.ease_in_sine=Ut,t.ease_out_sine=Ct,t.ease_in_out_sine=Dt,t.ease_in_expo=Ft,t.ease_out_expo=Gt,t.ease_in_out_expo=kt,t.ease_in_circ=Kt,t.ease_out_circ=Bt,t.ease_in_out_circ=Xt,t.ease_in_elastic=Ht,t.ease_out_elastic=Qt,t.ease_in_out_elastic=zt,t.ease_in_back=Vt,t.ease_out_back=jt,t.ease_in_out_back=qt,t.ease_in_bounce=Wt,t.ease_out_bounce=Jt,t.ease_in_out_bounce=Zt}),WE=A("nla",function(e,t){var r=Ls(e),_=ri(e),n=ga(e);t.set_frame=function(e){e=Un(e,r.get_frame_start(),r.get_frame_end()),r.check_logic_nodes()?n.error("The active scene is using the Logic Editor."):r.set_frame(e,_.get_timeline())},t.get_frame=function(){return r.get_frame(_.get_timeline())},t.stop=function(){r.check_logic_nodes()&&n.warn("The active scene is using the Logic Editor. It may conflicts with your JS-code."),r.stop_nla()},t.play=function(e){r.check_logic_nodes()&&n.warn("The active scene is using the Logic Editor. It may conflicts with your JS-code."),r.play_nla(e)},t.is_play=function(){return r.is_play()},t.get_frame_start=function(){return r.get_frame_start()},t.get_frame_end=function(){return r.get_frame_end()},t.check_nla=function(){return r.check_nla()},t.check_logic_nodes=function(){return r.check_logic_nodes()},t.set_range=function(e,t){r.check_logic_nodes()?n.error("The active scene is using the Logic Editor."):(t=parseFloat(t)||r.get_frame_end(),e=parseFloat(e)||r.get_frame_end(),t=Un(t,r.get_frame_start(),r.get_frame_end()),e=Un(e,r.get_frame_start(),t),r.set_range(e,t))},t.reset_range=function(){r.check_logic_nodes()?n.error("The active scene is using the Logic Editor."):r.reset_range()},t.set_cyclic=function(e){r.check_logic_nodes()?n.error("The active scene is using the Logic Editor."):r.set_cyclic(e)},t.clear_callback=function(){r.check_logic_nodes()?n.error("The active scene is using the Logic Editor."):r.clear_callback()}}),JE=A("objects",function(e,t){var r=wi(e),_=Ms(e),n=Ks(e),a=os(e),o=ga(e),i=ps(e);t.get_meta_tags=function(e){if(e)return _.get_meta_tags(e)},t.get_custom_prop=function(e){if(e)return _.get_custom_prop(e)},t.copy=function(e,t,n){return a.is_mesh(e)?a.is_dynamic(e)?r.has_dyn_geom(e)||r.check_shape_keys(e)||!n?-1==_.get_scene_objs(i.get_active(),"MESH",_.DATA_ID_ALL).indexOf(e)?(o.error('object "'+e.name+'" does not belong to the active scene.'),!1):_.copy(e,t=t||"",n):(o.error('object "'+e.name+'" has not dynamic geometry for deep copying.'),!1):(o.error('object "'+e.name+'" is not dynamic.'),!1):(o.error('object "'+e.name+'" is not of type "MESH".'),!1)},t.update_boundings=function(e){a.is_mesh(e)?r.has_dyn_geom(e)||r.check_shape_keys(e)?_.update_boundings(e):o.error('object "'+e.name+'" has not dynamic geometry.'):o.error('The type of the object "'+e.name+'" is not "MESH".')},t.get_parent=a.get_parent,t.get_dg_parent=a.get_dg_parent,t.is_mesh=a.is_mesh,t.is_armature=a.is_armature,t.is_speaker=a.is_speaker,t.is_camera=a.is_camera,t.is_lamp=a.is_lamp,t.is_empty=a.is_empty,t.is_line=a.is_line,t.is_world=a.is_world,t.get_selectable_objects=function(){return _.get_selectable_objects()},t.get_outlining_objects=function(){return _.get_outlining_objects()},t.is_dynamic=a.is_dynamic,t.set_wind_bending_params=function(e,t){if(a.is_dynamic_mesh(e)){var r=e.render;if(r.wind_bending){if("number"==typeof t.angle){var i=n.wb_angle_to_amp(In(t.angle),r.bb_original,r.world_tsr[3]);r.wind_bending_amp=i}"number"==typeof t.main_frequency&&(r.wind_bending_freq=t.main_frequency),"number"==typeof t.detail_frequency&&(r.detail_bending_freq=t.detail_frequency),"number"==typeof t.detail_amplitude&&(r.detail_bending_amp=t.detail_amplitude),"number"==typeof t.branch_amplitude&&(r.branch_bending_amp=t.branch_amplitude),_.set_hair_particles_wind_bend_params(e)}else o.error('The "'+e.name+"\" object doesn't have wind bending parameters.")}else o.error('The type of the object "'+e.name+'" is not "MESH" or it is not dynamic.')},t.get_wind_bending_params=function(e){var t=e.render;if(!t.wind_bending)return null;var r={},_=bn(n.wb_amp_to_angle(t.wind_bending_amp,t.bb_original,t.world_tsr[3]));return r.angle=_,r.main_frequency=t.wind_bending_freq,r.detail_frequency=t.detail_bending_freq,r.detail_amplitude=t.detail_bending_amp,r.branch_amplitude=t.branch_bending_amp,r},t.create_line=function(e){return _.create_line(e)},t.hide_all_by_data_id=function(e){for(var t=_.get_all_objects("ALL",e),r=0;r<t.length;r++)i.change_visibility(t[r],!0)},t.show_all_by_data_id=function(e){for(var t=_.get_all_objects("ALL",e),r=0;r<t.length;r++)i.change_visibility(t[r],!1)}}),ZE=A("particles",function(e,t){var r=is(e),_=ga(e);t.set_size=function(e,t,n){r.obj_has_psys(e,t)?r.set_size(e,t,n):_.error('set_size(): Object "'+e.name+'" has not a particle system named "'+t+'"')},t.set_normal_factor=function(e,t,n){r.obj_has_psys(e,t)?r.set_normal_factor(e,t,n):_.error('set_normal_factor(): Object "'+e.name+'" has not a particle system named "'+t+'"')},t.set_factor=function(e,t,n){r.obj_has_psys(e,t)?(n=Math.min(n,1),n=Math.max(n,0),r.set_factor(e,t,n)):_.error('set_factor(): Object "'+e.name+'" has not a particle system named "'+t+'"')}}),$E=A("rgb",function(e,t){var r=new Float32Array(3);t.create=function(){return new Float32Array(3)},t.from_values=function(e,t,r){var _=new Float32Array(3);return _[0]=e,_[1]=t,_[2]=r,_},t.set=function(e,t,r,_){return _[0]=e,_[1]=t,_[2]=r,_},t.css_to_rgb=function(e,t,r,_){return(_=_||new Float32Array(3))[0]=e/255,_[1]=t/255,_[2]=r/255,function(e,t){t[0]=Math.pow(e[0],K_),t[1]=Math.pow(e[1],K_),t[2]=Math.pow(e[2],K_)}(_,_),_},t.rgb_to_css=function(e){var t=la(e,r);return[Math.round(255*t[0]),Math.round(255*t[1]),Math.round(255*t[2])]},t.rgb_to_css_hex=function(e){var t=function(e){var t=Math.round(255*e).toString(16);return 1==t.length?"0"+t:t},_=la(e,r);return"#"+t(_[0])+t(_[1])+t(_[2])}}),ec=A("textures",function(e,t){var r=ga(e),_=ps(e),n=ys(e),a=os(e),o=Ds(e);t.play_video=function(e,t){t||(t=0);var a=n.get_video_texture(e,t);a?_.get_active().b4w_use_nla&&n.video_allow_nla(a)?r.error("NLA texture can't be controlled directly through API."):n.play_video(a):r.error('Texture with name "'+e+'" not found!')},t.pause_video=function(e,t){t||(t=0);var a=n.get_video_texture(e,t);a?_.get_active().b4w_use_nla&&n.video_allow_nla(a)?r.error("NLA texture can't be controlled directly through API."):n.pause_video(a):r.error('Texture with name "'+e+'" not found!')},t.reset_video=function(e,t){t||(t=0);var a=n.get_video_texture(e,t);a?_.get_active().b4w_use_nla&&n.video_allow_nla(a)?r.error("NLA texture can't be controlled directly through API."):n.reset_video(a):r.error('Texture with name "'+e+'" not found!')},t.get_canvas_ctx=function(e,t){if(a.is_mesh(e)){var _=n.get_canvas_context_by_object(e,t);if(_)return _;r.error("Couldn't find canvas texture with this name: "+t)}else r.error("Object must be type of mesh.");return null},t.update_canvas_ctx=function(e,t){if(!a.is_mesh(e))return r.error("Object must be type of mesh."),!1;var _=n.get_texture_by_name(e,t);return _&&"CANVAS"==_.source?(n.update_texture_canvas(_),!0):(r.error("Couldn't find canvas texture \""+t+'" in object "'+e.name+'".'),!1)},t.change_image=function(e,t,_,a){r.error_deprecated("change_image","replace_image"),a=a||function(){};var i=n.get_texture_by_name(e,t);if(!i)return r.error("Couldn't find texture \""+t+'" in object "'+e.name+'".'),void a(!1);if(i.is_movie)return r.error("Changing video textures is forbidden."),void a(!1);var s=cs(_);i.img_full_filepath!=s?o.enqueue([{id:_,type:o.AT_IMAGE_ELEMENT,url:_,request_method:"GET"}],function(r,o,s,E){r?(n.change_image(e,i,t,r,_),a(!0)):a(!1)},null,null):a(!0)},t.replace_image=function(e,t,_,a){a=a||function(){};var o=n.get_texture_by_name(e,t);return o?o.is_movie?(r.error("Changing video textures is forbidden."),void a(!1)):"src"in _?void n.change_image(e,o,t,_,_.src):(r.error("Incorrect image."),void a(!1)):(r.error("Couldn't find texture \""+t+'" in object "'+e.name+'".'),void a(!1))},t.get_texture_names=function(e){return a.is_mesh(e)?n.get_texture_names(e):(r.error("Object must be type of mesh."),[])}}),tc=A("version",function(e,t){t.version=Gi,t.version_str=ki,t.type=Ki,t.date=Bi,t.date_str=Xi,t.get_build_version=Hi});f.app=gE,f.camera_anim=IE,f.fps=YE,f.gp_conf=ME,f.gyroscope=xE,f.hmd=bE,f.hmd_conf=yE,f.mixer=UE,f.mouse=CE,f.npc_ai=FE,f.preloader=GE,f.screenshooter=kE,f.storage=LE,f.anchors=KE,f.animation=DE,f.armature=BE,f.assets=XE,f.camera=iE,f.config=EE,f.constraints=cE,f.container=lE,f.controls=TE,f.data=uE,f.debug=fE,f.geometry=HE,f.hud=QE,f.input=PE,f.lights=zE,f.logic_nodes=VE,f.main=SE,f.material=jE,f.math=qE,f.nla=WE,f.objects=JE,f.particles=ZE,f.physics=pE,f.rgb=$E,f.scenes=OE,f.screen=mE,f.sfx=wE,f.textures=ec,f.time=hE,f.transform=vE,f.tsr=RE,f.util=NE,f.version=tc,f.print=ga,f.vec3=a,f.vec4=o,f.mat3=_,f.mat4=n,f.quat=i,f.register("vec3",function(e,t){for(var r in a)e[r]=a[r]}),f.register("vec4",function(e,t){for(var r in o)e[r]=o[r]}),f.register("mat3",function(e,t){for(var r in _)e[r]=_[r]}),f.register("mat4",function(e,t){for(var r in n)e[r]=n[r]}),f.register("quat",function(e,t){for(var r in i)e[r]=i[r]});var rc=f,_c=function(){function e(e){this.zone=e,this.render()}return e.prototype.render=function(){var e=this;r("mP56")().then(function(t){e.zone.runOutsideAngular(function(){var r=e.zone;rc.register("final_chapter_main",function(e,_){var n,a=_("app"),o=_("config"),i=_("data"),s=_("preloader"),E=(_("version"),_("lights")),c=_("mouse"),l=_("camera"),T=_("scenes"),u="assets/";function d(e,t){r.runOutsideAngular(function(){t?(s.create_preloader(),e.oncontextmenu=function(e){return e.preventDefault(),e.stopPropagation(),!1},n=e,r.runOutsideAngular(function(){i.load(u+"final_chapter.json",P,f)})):console.log("b4w init failure")})}function f(e){r.runOutsideAngular(function(){s.update_preloader(e)})}function P(e,_){r.runOutsideAngular(function(){if(_){a.enable_camera_controls(),E.set_day_time(18.2);var e=new Float64Array([7.725669860839844,-1.0204399824142456,1.8238799571990967]);n.oncontextmenu=function(t){r.runOutsideAngular(function(){return t.preventDefault(),t.stopPropagation(),l.translate_view(o,0,0,0),l.set_translation(o,e),!1})};var o=T.get_active_camera();n.addEventListener("mousemove",i),n.addEventListener("mousedown",function(e){r.runOutsideAngular(function(){n.removeEventListener("mousemove",i)})}),n.addEventListener("mouseup",function(e){r.runOutsideAngular(function(){n.addEventListener("mousemove",i)})})}else console.log("b4w load failure");function i(e){r.runOutsideAngular(function(){l.translate_view(o,t._translate_x(c.get_coords_x(e),n.width),t._translate_y(c.get_coords_y(e),n.height),0)})}})}o.set("physics_uranium_path","node_modules/blend4web/dist/uranium/"),e.init=function(){r.runOutsideAngular(function(){a.init({canvas_container_id:"main_canvas_container",callback:d,show_fps:!1,console_verbose:!1,autoresize:!0,quality:o.P_AUTO})})}}),rc.require("final_chapter_main").init()})})},e}(),nc=s.N({encapsulation:0,styles:[[""]],data:{}});function ac(e){return s._1(0,[(e()(),s.P(0,0,null,null,0,"div",[["id","main_canvas_container"],["style","height: 100%; left: 0px; position: absolute; top: 0px; width: 100%;"]],null,null,null,null,null))],null,null)}var oc=s.L("app-root",_c,function(e){return s._1(0,[(e()(),s.P(0,0,null,null,1,"app-root",[],null,null,null,ac,nc)),s.O(1,49152,null,0,_c,[s.r],null,null)],null,null)},{},{},[]),ic=r("TToO"),sc=function(){},Ec=["en",[["a","p"],["AM","PM"]],[["AM","PM"],,],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",,"{1} 'at' {0}"],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"$","US Dollar",function(e){var t=Math.floor(Math.abs(e)),r=e.toString().replace(/^[^.]*\.?/,"").length;return 1===t&&0===r?1:5}],cc={},lc=function(){var e={Zero:0,One:1,Two:2,Few:3,Many:4,Other:5};return e[e.Zero]="Zero",e[e.One]="One",e[e.Two]="Two",e[e.Few]="Few",e[e.Many]="Many",e[e.Other]="Other",e}(),Tc=new s.k("UseV4Plurals"),uc=function(){},dc=function(e){function t(t,r){var _=e.call(this)||this;return _.locale=t,_.deprecatedPluralFn=r,_}return Object(ic.b)(t,e),t.prototype.getPluralCategory=function(e,t){switch(this.deprecatedPluralFn?this.deprecatedPluralFn(t||this.locale,e):function(e){return function(e){var t=e.toLowerCase().replace(/_/g,"-"),r=cc[t];if(r)return r;var _=t.split("-")[0];if(r=cc[_])return r;if("en"===_)return Ec;throw new Error('Missing locale data for the locale "'+e+'".')}(e)[17]}(t||this.locale)(e)){case lc.Zero:return"zero";case lc.One:return"one";case lc.Two:return"two";case lc.Few:return"few";case lc.Many:return"many";default:return"other"}},t}(uc),fc=function(){},Pc=new s.k("DocumentToken"),Ac="browser";function Sc(e){return e===Ac}var pc=null;function mc(){return pc}var Oc,vc={class:"className",innerHtml:"innerHTML",readonly:"readOnly",tabindex:"tabIndex"},Nc={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},gc={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"};s.Q.Node&&(Oc=s.Q.Node.prototype.contains||function(e){return!!(16&this.compareDocumentPosition(e))});var hc,Rc=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(ic.b)(t,e),t.prototype.parse=function(e){throw new Error("parse not implemented")},t.makeCurrent=function(){var e;e=new t,pc||(pc=e)},t.prototype.hasProperty=function(e,t){return t in e},t.prototype.setProperty=function(e,t,r){e[t]=r},t.prototype.getProperty=function(e,t){return e[t]},t.prototype.invoke=function(e,t,r){var _;(_=e)[t].apply(_,r)},t.prototype.logError=function(e){window.console&&(console.error?console.error(e):console.log(e))},t.prototype.log=function(e){window.console&&window.console.log&&window.console.log(e)},t.prototype.logGroup=function(e){window.console&&window.console.group&&window.console.group(e)},t.prototype.logGroupEnd=function(){window.console&&window.console.groupEnd&&window.console.groupEnd()},Object.defineProperty(t.prototype,"attrToPropMap",{get:function(){return vc},enumerable:!0,configurable:!0}),t.prototype.contains=function(e,t){return Oc.call(e,t)},t.prototype.querySelector=function(e,t){return e.querySelector(t)},t.prototype.querySelectorAll=function(e,t){return e.querySelectorAll(t)},t.prototype.on=function(e,t,r){e.addEventListener(t,r,!1)},t.prototype.onAndCancel=function(e,t,r){return e.addEventListener(t,r,!1),function(){e.removeEventListener(t,r,!1)}},t.prototype.dispatchEvent=function(e,t){e.dispatchEvent(t)},t.prototype.createMouseEvent=function(e){var t=this.getDefaultDocument().createEvent("MouseEvent");return t.initEvent(e,!0,!0),t},t.prototype.createEvent=function(e){var t=this.getDefaultDocument().createEvent("Event");return t.initEvent(e,!0,!0),t},t.prototype.preventDefault=function(e){e.preventDefault(),e.returnValue=!1},t.prototype.isPrevented=function(e){return e.defaultPrevented||null!=e.returnValue&&!e.returnValue},t.prototype.getInnerHTML=function(e){return e.innerHTML},t.prototype.getTemplateContent=function(e){return"content"in e&&this.isTemplateElement(e)?e.content:null},t.prototype.getOuterHTML=function(e){return e.outerHTML},t.prototype.nodeName=function(e){return e.nodeName},t.prototype.nodeValue=function(e){return e.nodeValue},t.prototype.type=function(e){return e.type},t.prototype.content=function(e){return this.hasProperty(e,"content")?e.content:e},t.prototype.firstChild=function(e){return e.firstChild},t.prototype.nextSibling=function(e){return e.nextSibling},t.prototype.parentElement=function(e){return e.parentNode},t.prototype.childNodes=function(e){return e.childNodes},t.prototype.childNodesAsList=function(e){for(var t=e.childNodes,r=new Array(t.length),_=0;_<t.length;_++)r[_]=t[_];return r},t.prototype.clearNodes=function(e){for(;e.firstChild;)e.removeChild(e.firstChild)},t.prototype.appendChild=function(e,t){e.appendChild(t)},t.prototype.removeChild=function(e,t){e.removeChild(t)},t.prototype.replaceChild=function(e,t,r){e.replaceChild(t,r)},t.prototype.remove=function(e){return e.parentNode&&e.parentNode.removeChild(e),e},t.prototype.insertBefore=function(e,t,r){e.insertBefore(r,t)},t.prototype.insertAllBefore=function(e,t,r){r.forEach(function(r){return e.insertBefore(r,t)})},t.prototype.insertAfter=function(e,t,r){e.insertBefore(r,t.nextSibling)},t.prototype.setInnerHTML=function(e,t){e.innerHTML=t},t.prototype.getText=function(e){return e.textContent},t.prototype.setText=function(e,t){e.textContent=t},t.prototype.getValue=function(e){return e.value},t.prototype.setValue=function(e,t){e.value=t},t.prototype.getChecked=function(e){return e.checked},t.prototype.setChecked=function(e,t){e.checked=t},t.prototype.createComment=function(e){return this.getDefaultDocument().createComment(e)},t.prototype.createTemplate=function(e){var t=this.getDefaultDocument().createElement("template");return t.innerHTML=e,t},t.prototype.createElement=function(e,t){return(t=t||this.getDefaultDocument()).createElement(e)},t.prototype.createElementNS=function(e,t,r){return(r=r||this.getDefaultDocument()).createElementNS(e,t)},t.prototype.createTextNode=function(e,t){return(t=t||this.getDefaultDocument()).createTextNode(e)},t.prototype.createScriptTag=function(e,t,r){var _=(r=r||this.getDefaultDocument()).createElement("SCRIPT");return _.setAttribute(e,t),_},t.prototype.createStyleElement=function(e,t){var r=(t=t||this.getDefaultDocument()).createElement("style");return this.appendChild(r,this.createTextNode(e,t)),r},t.prototype.createShadowRoot=function(e){return e.createShadowRoot()},t.prototype.getShadowRoot=function(e){return e.shadowRoot},t.prototype.getHost=function(e){return e.host},t.prototype.clone=function(e){return e.cloneNode(!0)},t.prototype.getElementsByClassName=function(e,t){return e.getElementsByClassName(t)},t.prototype.getElementsByTagName=function(e,t){return e.getElementsByTagName(t)},t.prototype.classList=function(e){return Array.prototype.slice.call(e.classList,0)},t.prototype.addClass=function(e,t){e.classList.add(t)},t.prototype.removeClass=function(e,t){e.classList.remove(t)},t.prototype.hasClass=function(e,t){return e.classList.contains(t)},t.prototype.setStyle=function(e,t,r){e.style[t]=r},t.prototype.removeStyle=function(e,t){e.style[t]=""},t.prototype.getStyle=function(e,t){return e.style[t]},t.prototype.hasStyle=function(e,t,r){var _=this.getStyle(e,t)||"";return r?_==r:_.length>0},t.prototype.tagName=function(e){return e.tagName},t.prototype.attributeMap=function(e){for(var t=new Map,r=e.attributes,_=0;_<r.length;_++){var n=r.item(_);t.set(n.name,n.value)}return t},t.prototype.hasAttribute=function(e,t){return e.hasAttribute(t)},t.prototype.hasAttributeNS=function(e,t,r){return e.hasAttributeNS(t,r)},t.prototype.getAttribute=function(e,t){return e.getAttribute(t)},t.prototype.getAttributeNS=function(e,t,r){return e.getAttributeNS(t,r)},t.prototype.setAttribute=function(e,t,r){e.setAttribute(t,r)},t.prototype.setAttributeNS=function(e,t,r,_){e.setAttributeNS(t,r,_)},t.prototype.removeAttribute=function(e,t){e.removeAttribute(t)},t.prototype.removeAttributeNS=function(e,t,r){e.removeAttributeNS(t,r)},t.prototype.templateAwareRoot=function(e){return this.isTemplateElement(e)?this.content(e):e},t.prototype.createHtmlDocument=function(){return document.implementation.createHTMLDocument("fakeTitle")},t.prototype.getDefaultDocument=function(){return document},t.prototype.getBoundingClientRect=function(e){try{return e.getBoundingClientRect()}catch(e){return{top:0,bottom:0,left:0,right:0,width:0,height:0}}},t.prototype.getTitle=function(e){return e.title},t.prototype.setTitle=function(e,t){e.title=t||""},t.prototype.elementMatches=function(e,t){return!!this.isElementNode(e)&&(e.matches&&e.matches(t)||e.msMatchesSelector&&e.msMatchesSelector(t)||e.webkitMatchesSelector&&e.webkitMatchesSelector(t))},t.prototype.isTemplateElement=function(e){return this.isElementNode(e)&&"TEMPLATE"===e.nodeName},t.prototype.isTextNode=function(e){return e.nodeType===Node.TEXT_NODE},t.prototype.isCommentNode=function(e){return e.nodeType===Node.COMMENT_NODE},t.prototype.isElementNode=function(e){return e.nodeType===Node.ELEMENT_NODE},t.prototype.hasShadowRoot=function(e){return null!=e.shadowRoot&&e instanceof HTMLElement},t.prototype.isShadowRoot=function(e){return e instanceof DocumentFragment},t.prototype.importIntoDoc=function(e){return document.importNode(this.templateAwareRoot(e),!0)},t.prototype.adoptNode=function(e){return document.adoptNode(e)},t.prototype.getHref=function(e){return e.getAttribute("href")},t.prototype.getEventKey=function(e){var t=e.key;if(null==t){if(null==(t=e.keyIdentifier))return"Unidentified";t.startsWith("U+")&&(t=String.fromCharCode(parseInt(t.substring(2),16)),3===e.location&&gc.hasOwnProperty(t)&&(t=gc[t]))}return Nc[t]||t},t.prototype.getGlobalEventTarget=function(e,t){return"window"===t?window:"document"===t?e:"body"===t?e.body:null},t.prototype.getHistory=function(){return window.history},t.prototype.getLocation=function(){return window.location},t.prototype.getBaseHref=function(e){var t,r=Ic||(Ic=document.querySelector("base"))?Ic.getAttribute("href"):null;return null==r?null:(t=r,hc||(hc=document.createElement("a")),hc.setAttribute("href",t),"/"===hc.pathname.charAt(0)?hc.pathname:"/"+hc.pathname)},t.prototype.resetBaseElement=function(){Ic=null},t.prototype.getUserAgent=function(){return window.navigator.userAgent},t.prototype.setData=function(e,t,r){this.setAttribute(e,"data-"+t,r)},t.prototype.getData=function(e,t){return this.getAttribute(e,"data-"+t)},t.prototype.getComputedStyle=function(e){return getComputedStyle(e)},t.prototype.supportsWebAnimation=function(){return"function"==typeof Element.prototype.animate},t.prototype.performanceNow=function(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()},t.prototype.supportsCookies=function(){return!0},t.prototype.getCookie=function(e){return function(e,t){t=encodeURIComponent(t);for(var r=0,_=e.split(";");r<_.length;r++){var n=_[r],a=n.indexOf("="),o=-1==a?[n,""]:[n.slice(0,a),n.slice(a+1)],i=o[1];if(o[0].trim()===t)return decodeURIComponent(i)}return null}(document.cookie,e)},t.prototype.setCookie=function(e,t){document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t)},t}(function(e){function t(){var t=e.call(this)||this;t._animationPrefix=null,t._transitionEnd=null;try{var r=t.createElement("div",document);if(null!=t.getStyle(r,"animationName"))t._animationPrefix="";else for(var _=["Webkit","Moz","O","ms"],n=0;n<_.length;n++)if(null!=t.getStyle(r,_[n]+"AnimationName")){t._animationPrefix="-"+_[n].toLowerCase()+"-";break}var a={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};Object.keys(a).forEach(function(e){null!=t.getStyle(r,e)&&(t._transitionEnd=a[e])})}catch(e){t._animationPrefix=null,t._transitionEnd=null}return t}return Object(ic.b)(t,e),t.prototype.getDistributedNodes=function(e){return e.getDistributedNodes()},t.prototype.resolveAndSetHref=function(e,t,r){e.href=null==r?t:t+"/../"+r},t.prototype.supportsDOMEvents=function(){return!0},t.prototype.supportsNativeShadowDOM=function(){return"function"==typeof document.body.createShadowRoot},t.prototype.getAnimationPrefix=function(){return this._animationPrefix?this._animationPrefix:""},t.prototype.getTransitionEnd=function(){return this._transitionEnd?this._transitionEnd:""},t.prototype.supportsAnimation=function(){return null!=this._animationPrefix&&null!=this._transitionEnd},t}(function(){function e(){this.resourceLoaderType=null}return Object.defineProperty(e.prototype,"attrToPropMap",{get:function(){return this._attrToPropMap},set:function(e){this._attrToPropMap=e},enumerable:!0,configurable:!0}),e}())),Ic=null,bc=Pc;function Yc(){return!!window.history.pushState}var Lc=function(e){function t(t){var r=e.call(this)||this;return r._doc=t,r._init(),r}return Object(ic.b)(t,e),t.prototype._init=function(){this.location=mc().getLocation(),this._history=mc().getHistory()},t.prototype.getBaseHrefFromDOM=function(){return mc().getBaseHref(this._doc)},t.prototype.onPopState=function(e){mc().getGlobalEventTarget(this._doc,"window").addEventListener("popstate",e,!1)},t.prototype.onHashChange=function(e){mc().getGlobalEventTarget(this._doc,"window").addEventListener("hashchange",e,!1)},Object.defineProperty(t.prototype,"pathname",{get:function(){return this.location.pathname},set:function(e){this.location.pathname=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"search",{get:function(){return this.location.search},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hash",{get:function(){return this.location.hash},enumerable:!0,configurable:!0}),t.prototype.pushState=function(e,t,r){Yc()?this._history.pushState(e,t,r):this.location.hash=r},t.prototype.replaceState=function(e,t,r){Yc()?this._history.replaceState(e,t,r):this.location.hash=r},t.prototype.forward=function(){this._history.forward()},t.prototype.back=function(){this._history.back()},t.ctorParameters=function(){return[{type:void 0,decorators:[{type:s.j,args:[bc]}]}]},t}(sc),Mc=function(){function e(e){this._doc=e,this._dom=mc()}return e.prototype.addTag=function(e,t){return void 0===t&&(t=!1),e?this._getOrCreateElement(e,t):null},e.prototype.addTags=function(e,t){var r=this;return void 0===t&&(t=!1),e?e.reduce(function(e,_){return _&&e.push(r._getOrCreateElement(_,t)),e},[]):[]},e.prototype.getTag=function(e){return e&&this._dom.querySelector(this._doc,"meta["+e+"]")||null},e.prototype.getTags=function(e){if(!e)return[];var t=this._dom.querySelectorAll(this._doc,"meta["+e+"]");return t?[].slice.call(t):[]},e.prototype.updateTag=function(e,t){if(!e)return null;t=t||this._parseSelector(e);var r=this.getTag(t);return r?this._setMetaElementAttributes(e,r):this._getOrCreateElement(e,!0)},e.prototype.removeTag=function(e){this.removeTagElement(this.getTag(e))},e.prototype.removeTagElement=function(e){e&&this._dom.remove(e)},e.prototype._getOrCreateElement=function(e,t){if(void 0===t&&(t=!1),!t){var r=this._parseSelector(e),_=this.getTag(r);if(_&&this._containsAttributes(e,_))return _}var n=this._dom.createElement("meta");this._setMetaElementAttributes(e,n);var a=this._dom.getElementsByTagName(this._doc,"head")[0];return this._dom.appendChild(a,n),n},e.prototype._setMetaElementAttributes=function(e,t){var r=this;return Object.keys(e).forEach(function(_){return r._dom.setAttribute(t,_,e[_])}),t},e.prototype._parseSelector=function(e){var t=e.name?"name":"property";return t+'="'+e[t]+'"'},e.prototype._containsAttributes=function(e,t){var r=this;return Object.keys(e).every(function(_){return r._dom.getAttribute(t,_)===e[_]})},e}(),xc=new s.k("TRANSITION_ID"),yc=[{provide:s.b,useFactory:function(e,t,r){return function(){r.get(s.c).donePromise.then(function(){var r=mc();Array.prototype.slice.apply(r.querySelectorAll(t,"style[ng-transition]")).filter(function(t){return r.getAttribute(t,"ng-transition")===e}).forEach(function(e){return r.remove(e)})})}},deps:[xc,bc,s.l],multi:!0}],wc=function(){function e(){}return e.init=function(){Object(s.I)(new e)},e.prototype.addToWindow=function(e){s.Q.getAngularTestability=function(t,r){void 0===r&&(r=!0);var _=e.findTestabilityInTree(t,r);if(null==_)throw new Error("Could not find testability for element.");return _},s.Q.getAllAngularTestabilities=function(){return e.getAllTestabilities()},s.Q.getAllAngularRootElements=function(){return e.getAllRootElements()},s.Q.frameworkStabilizers||(s.Q.frameworkStabilizers=[]),s.Q.frameworkStabilizers.push(function(e){var t=s.Q.getAllAngularTestabilities(),r=t.length,_=!1,n=function(t){_=_||t,0==--r&&e(_)};t.forEach(function(e){e.whenStable(n)})})},e.prototype.findTestabilityInTree=function(e,t,r){if(null==t)return null;var _=e.getTestability(t);return null!=_?_:r?mc().isShadowRoot(t)?this.findTestabilityInTree(e,mc().getHost(t),!0):this.findTestabilityInTree(e,mc().parentElement(t),!0):null},e}(),Uc=function(){function e(e){this._doc=e}return e.prototype.getTitle=function(){return mc().getTitle(this._doc)},e.prototype.setTitle=function(e){mc().setTitle(this._doc,e)},e}();function Cc(e,t){"undefined"!=typeof COMPILED&&COMPILED||((s.Q.ng=s.Q.ng||{})[e]=t)}var Dc={ApplicationRef:s.e,NgZone:s.r};function Fc(e){return Object(s.F)(e)}var Gc=new s.k("EventManagerPlugins"),kc=function(){function e(e,t){var r=this;this._zone=t,this._eventNameToPlugin=new Map,e.forEach(function(e){return e.manager=r}),this._plugins=e.slice().reverse()}return e.prototype.addEventListener=function(e,t,r){return this._findPluginFor(t).addEventListener(e,t,r)},e.prototype.addGlobalEventListener=function(e,t,r){return this._findPluginFor(t).addGlobalEventListener(e,t,r)},e.prototype.getZone=function(){return this._zone},e.prototype._findPluginFor=function(e){var t=this._eventNameToPlugin.get(e);if(t)return t;for(var r=this._plugins,_=0;_<r.length;_++){var n=r[_];if(n.supports(e))return this._eventNameToPlugin.set(e,n),n}throw new Error("No event manager plugin found for event "+e)},e}(),Kc=function(){function e(e){this._doc=e}return e.prototype.addGlobalEventListener=function(e,t,r){var _=mc().getGlobalEventTarget(this._doc,e);if(!_)throw new Error("Unsupported event target "+_+" for event "+t);return this.addEventListener(_,t,r)},e}(),Bc=function(){function e(){this._stylesSet=new Set}return e.prototype.addStyles=function(e){var t=this,r=new Set;e.forEach(function(e){t._stylesSet.has(e)||(t._stylesSet.add(e),r.add(e))}),this.onStylesAdded(r)},e.prototype.onStylesAdded=function(e){},e.prototype.getAllStyles=function(){return Array.from(this._stylesSet)},e}(),Xc=function(e){function t(t){var r=e.call(this)||this;return r._doc=t,r._hostNodes=new Set,r._styleNodes=new Set,r._hostNodes.add(t.head),r}return Object(ic.b)(t,e),t.prototype._addStylesToHost=function(e,t){var r=this;e.forEach(function(e){var _=r._doc.createElement("style");_.textContent=e,r._styleNodes.add(t.appendChild(_))})},t.prototype.addHost=function(e){this._addStylesToHost(this._stylesSet,e),this._hostNodes.add(e)},t.prototype.removeHost=function(e){this._hostNodes.delete(e)},t.prototype.onStylesAdded=function(e){var t=this;this._hostNodes.forEach(function(r){return t._addStylesToHost(e,r)})},t.prototype.ngOnDestroy=function(){this._styleNodes.forEach(function(e){return mc().remove(e)})},t}(Bc),Hc={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},Qc=/%COMP%/g,zc="_nghost-%COMP%",Vc="_ngcontent-%COMP%";function jc(e,t,r){for(var _=0;_<t.length;_++){var n=t[_];Array.isArray(n)?jc(e,n,r):(n=n.replace(Qc,e),r.push(n))}return r}function qc(e){return function(t){!1===e(t)&&(t.preventDefault(),t.returnValue=!1)}}var Wc=function(){function e(e,t){this.eventManager=e,this.sharedStylesHost=t,this.rendererByCompId=new Map,this.defaultRenderer=new Jc(e)}return e.prototype.createRenderer=function(e,t){if(!e||!t)return this.defaultRenderer;switch(t.encapsulation){case s.B.Emulated:var r=this.rendererByCompId.get(t.id);return r||(r=new tl(this.eventManager,this.sharedStylesHost,t),this.rendererByCompId.set(t.id,r)),r.applyToHost(e),r;case s.B.Native:return new rl(this.eventManager,this.sharedStylesHost,e,t);default:if(!this.rendererByCompId.has(t.id)){var _=jc(t.id,t.styles,[]);this.sharedStylesHost.addStyles(_),this.rendererByCompId.set(t.id,this.defaultRenderer)}return this.defaultRenderer}},e.prototype.begin=function(){},e.prototype.end=function(){},e}(),Jc=function(){function e(e){this.eventManager=e,this.data=Object.create(null)}return e.prototype.destroy=function(){},e.prototype.createElement=function(e,t){return t?document.createElementNS(Hc[t],e):document.createElement(e)},e.prototype.createComment=function(e){return document.createComment(e)},e.prototype.createText=function(e){return document.createTextNode(e)},e.prototype.appendChild=function(e,t){e.appendChild(t)},e.prototype.insertBefore=function(e,t,r){e&&e.insertBefore(t,r)},e.prototype.removeChild=function(e,t){e&&e.removeChild(t)},e.prototype.selectRootElement=function(e){var t="string"==typeof e?document.querySelector(e):e;if(!t)throw new Error('The selector "'+e+'" did not match any elements');return t.textContent="",t},e.prototype.parentNode=function(e){return e.parentNode},e.prototype.nextSibling=function(e){return e.nextSibling},e.prototype.setAttribute=function(e,t,r,_){if(_){t=_+":"+t;var n=Hc[_];n?e.setAttributeNS(n,t,r):e.setAttribute(t,r)}else e.setAttribute(t,r)},e.prototype.removeAttribute=function(e,t,r){if(r){var _=Hc[r];_?e.removeAttributeNS(_,t):e.removeAttribute(r+":"+t)}else e.removeAttribute(t)},e.prototype.addClass=function(e,t){e.classList.add(t)},e.prototype.removeClass=function(e,t){e.classList.remove(t)},e.prototype.setStyle=function(e,t,r,_){_&s.w.DashCase?e.style.setProperty(t,r,_&s.w.Important?"important":""):e.style[t]=r},e.prototype.removeStyle=function(e,t,r){r&s.w.DashCase?e.style.removeProperty(t):e.style[t]=""},e.prototype.setProperty=function(e,t,r){$c(t,"property"),e[t]=r},e.prototype.setValue=function(e,t){e.nodeValue=t},e.prototype.listen=function(e,t,r){return $c(t,"listener"),"string"==typeof e?this.eventManager.addGlobalEventListener(e,t,qc(r)):this.eventManager.addEventListener(e,t,qc(r))},e}(),Zc="@".charCodeAt(0);function $c(e,t){if(e.charCodeAt(0)===Zc)throw new Error("Found the synthetic "+t+" "+e+'. Please include either "BrowserAnimationsModule" or "NoopAnimationsModule" in your application.')}var el,tl=function(e){function t(t,r,_){var n=e.call(this,t)||this;n.component=_;var a=jc(_.id,_.styles,[]);return r.addStyles(a),n.contentAttr=Vc.replace(Qc,_.id),n.hostAttr=zc.replace(Qc,_.id),n}return Object(ic.b)(t,e),t.prototype.applyToHost=function(t){e.prototype.setAttribute.call(this,t,this.hostAttr,"")},t.prototype.createElement=function(t,r){var _=e.prototype.createElement.call(this,t,r);return e.prototype.setAttribute.call(this,_,this.contentAttr,""),_},t}(Jc),rl=function(e){function t(t,r,_,n){var a=e.call(this,t)||this;a.sharedStylesHost=r,a.hostEl=_,a.component=n,a.shadowRoot=_.createShadowRoot(),a.sharedStylesHost.addHost(a.shadowRoot);for(var o=jc(n.id,n.styles,[]),i=0;i<o.length;i++){var s=document.createElement("style");s.textContent=o[i],a.shadowRoot.appendChild(s)}return a}return Object(ic.b)(t,e),t.prototype.nodeOrShadowRoot=function(e){return e===this.hostEl?this.shadowRoot:e},t.prototype.destroy=function(){this.sharedStylesHost.removeHost(this.shadowRoot)},t.prototype.appendChild=function(t,r){return e.prototype.appendChild.call(this,this.nodeOrShadowRoot(t),r)},t.prototype.insertBefore=function(t,r,_){return e.prototype.insertBefore.call(this,this.nodeOrShadowRoot(t),r,_)},t.prototype.removeChild=function(t,r){return e.prototype.removeChild.call(this,this.nodeOrShadowRoot(t),r)},t.prototype.parentNode=function(t){return this.nodeOrShadowRoot(e.prototype.parentNode.call(this,this.nodeOrShadowRoot(t)))},t}(Jc),_l="undefined"!=typeof Zone&&Zone.__symbol__||function(e){return"__zone_symbol__"+e},nl=_l("addEventListener"),al=_l("removeEventListener"),ol={},il="__zone_symbol__propagationStopped";"undefined"!=typeof Zone&&Zone[_l("BLACK_LISTED_EVENTS")]&&(el={});var sl=function(e){return!!el&&el.hasOwnProperty(e)},El=function(e){var t=ol[e.type];if(t){var r=this[t];if(r){var _=[e];if(1===r.length)return(o=r[0]).zone!==Zone.current?o.zone.run(o.handler,this,_):o.handler.apply(this,_);for(var n=r.slice(),a=0;a<n.length&&!0!==e[il];a++){var o;(o=n[a]).zone!==Zone.current?o.zone.run(o.handler,this,_):o.handler.apply(this,_)}}}},cl=function(e){function t(t,r){var _=e.call(this,t)||this;return _.ngZone=r,_.patchEvent(),_}return Object(ic.b)(t,e),t.prototype.patchEvent=function(){if(Event&&Event.prototype&&!Event.prototype.__zone_symbol__stopImmediatePropagation){var e=Event.prototype.__zone_symbol__stopImmediatePropagation=Event.prototype.stopImmediatePropagation;Event.prototype.stopImmediatePropagation=function(){this&&(this[il]=!0),e&&e.apply(this,arguments)}}},t.prototype.supports=function(e){return!0},t.prototype.addEventListener=function(e,t,r){var _=this,n=r;if(!e[nl]||s.r.isInAngularZone()&&!sl(t))e.addEventListener(t,n,!1);else{var a=ol[t];a||(a=ol[t]=_l("ANGULAR"+t+"FALSE"));var o=e[a],i=o&&o.length>0;o||(o=e[a]=[]);var E=sl(t)?Zone.root:Zone.current;if(0===o.length)o.push({zone:E,handler:n});else{for(var c=!1,l=0;l<o.length;l++)if(o[l].handler===n){c=!0;break}c||o.push({zone:E,handler:n})}i||e[nl](t,El,!1)}return function(){return _.removeEventListener(e,t,n)}},t.prototype.removeEventListener=function(e,t,r){var _=e[al];if(!_)return e.removeEventListener.apply(e,[t,r,!1]);var n=ol[t],a=n&&e[n];if(!a)return e.removeEventListener.apply(e,[t,r,!1]);for(var o=!1,i=0;i<a.length;i++)if(a[i].handler===r){o=!0,a.splice(i,1);break}o?0===a.length&&_.apply(e,[t,El,!1]):e.removeEventListener.apply(e,[t,r,!1])},t}(Kc),ll={pan:!0,panstart:!0,panmove:!0,panend:!0,pancancel:!0,panleft:!0,panright:!0,panup:!0,pandown:!0,pinch:!0,pinchstart:!0,pinchmove:!0,pinchend:!0,pinchcancel:!0,pinchin:!0,pinchout:!0,press:!0,pressup:!0,rotate:!0,rotatestart:!0,rotatemove:!0,rotateend:!0,rotatecancel:!0,swipe:!0,swipeleft:!0,swiperight:!0,swipeup:!0,swipedown:!0,tap:!0},Tl=new s.k("HammerGestureConfig"),ul=function(){function e(){this.events=[],this.overrides={}}return e.prototype.buildHammer=function(e){var t=new Hammer(e);for(var r in t.get("pinch").set({enable:!0}),t.get("rotate").set({enable:!0}),this.overrides)t.get(r).set(this.overrides[r]);return t},e}(),dl=function(e){function t(t,r){var _=e.call(this,t)||this;return _._config=r,_}return Object(ic.b)(t,e),t.prototype.supports=function(e){if(!ll.hasOwnProperty(e.toLowerCase())&&!this.isCustomEvent(e))return!1;if(!window.Hammer)throw new Error("Hammer.js is not loaded, can not bind "+e+" event");return!0},t.prototype.addEventListener=function(e,t,r){var _=this,n=this.manager.getZone();return t=t.toLowerCase(),n.runOutsideAngular(function(){var a=_._config.buildHammer(e),o=function(e){n.runGuarded(function(){r(e)})};return a.on(t,o),function(){return a.off(t,o)}})},t.prototype.isCustomEvent=function(e){return this._config.events.indexOf(e)>-1},t}(Kc),fl=["alt","control","meta","shift"],Pl={alt:function(e){return e.altKey},control:function(e){return e.ctrlKey},meta:function(e){return e.metaKey},shift:function(e){return e.shiftKey}},Al=function(e){function t(t){return e.call(this,t)||this}return Object(ic.b)(t,e),t.prototype.supports=function(e){return null!=t.parseEventName(e)},t.prototype.addEventListener=function(e,r,_){var n=t.parseEventName(r),a=t.eventCallback(n.fullKey,_,this.manager.getZone());return this.manager.getZone().runOutsideAngular(function(){return mc().onAndCancel(e,n.domEventName,a)})},t.parseEventName=function(e){var r=e.toLowerCase().split("."),_=r.shift();if(0===r.length||"keydown"!==_&&"keyup"!==_)return null;var n=t._normalizeKey(r.pop()),a="";if(fl.forEach(function(e){var t=r.indexOf(e);t>-1&&(r.splice(t,1),a+=e+".")}),a+=n,0!=r.length||0===n.length)return null;var o={};return o.domEventName=_,o.fullKey=a,o},t.getEventFullKey=function(e){var t="",r=mc().getEventKey(e);return" "===(r=r.toLowerCase())?r="space":"."===r&&(r="dot"),fl.forEach(function(_){_!=r&&(0,Pl[_])(e)&&(t+=_+".")}),t+=r},t.eventCallback=function(e,r,_){return function(n){t.getEventFullKey(n)===e&&_.runGuarded(function(){return r(n)})}},t._normalizeKey=function(e){switch(e){case"esc":return"escape";default:return e}},t}(Kc),Sl=function(){function e(e,t){this.defaultDoc=e,this.DOM=t;var r=this.DOM.createHtmlDocument();if(this.inertBodyElement=r.body,null==this.inertBodyElement){var _=this.DOM.createElement("html",r);this.inertBodyElement=this.DOM.createElement("body",r),this.DOM.appendChild(_,this.inertBodyElement),this.DOM.appendChild(r,_)}this.DOM.setInnerHTML(this.inertBodyElement,'<svg><g onload="this.parentNode.remove()"></g></svg>'),!this.inertBodyElement.querySelector||this.inertBodyElement.querySelector("svg")?(this.DOM.setInnerHTML(this.inertBodyElement,'<svg><p><style><img src="</style><img src=x onerror=alert(1)//">'),this.getInertBodyElement=this.inertBodyElement.querySelector&&this.inertBodyElement.querySelector("svg img")&&function(){try{return!!window.DOMParser}catch(e){return!1}}()?this.getInertBodyElement_DOMParser:this.getInertBodyElement_InertDocument):this.getInertBodyElement=this.getInertBodyElement_XHR}return e.prototype.getInertBodyElement_XHR=function(e){e="<body><remove></remove>"+e+"</body>";try{e=encodeURI(e)}catch(e){return null}var t=new XMLHttpRequest;t.responseType="document",t.open("GET","data:text/html;charset=utf-8,"+e,!1),t.send(null);var r=t.response.body;return r.removeChild(r.firstChild),r},e.prototype.getInertBodyElement_DOMParser=function(e){e="<body><remove></remove>"+e+"</body>";try{var t=(new window.DOMParser).parseFromString(e,"text/html").body;return t.removeChild(t.firstChild),t}catch(e){return null}},e.prototype.getInertBodyElement_InertDocument=function(e){var t=this.DOM.createElement("template");return"content"in t?(this.DOM.setInnerHTML(t,e),t):(this.DOM.setInnerHTML(this.inertBodyElement,e),this.defaultDoc.documentMode&&this.stripCustomNsAttrs(this.inertBodyElement),this.inertBodyElement)},e.prototype.stripCustomNsAttrs=function(e){var t=this;this.DOM.attributeMap(e).forEach(function(r,_){"xmlns:ns1"!==_&&0!==_.indexOf("ns1:")||t.DOM.removeAttribute(e,_)});for(var r=0,_=this.DOM.childNodesAsList(e);r<_.length;r++){var n=_[r];this.DOM.isElementNode(n)&&this.stripCustomNsAttrs(n)}},e}(),pl=/^(?:(?:https?|mailto|ftp|tel|file):|[^&:/?#]*(?:[/?#]|$))/gi,ml=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;function Ol(e){return(e=String(e)).match(pl)||e.match(ml)?e:(Object(s.G)()&&mc().log("WARNING: sanitizing unsafe URL value "+e+" (see http://g.co/ng/security#xss)"),"unsafe:"+e)}function vl(e){for(var t={},r=0,_=e.split(",");r<_.length;r++)t[_[r]]=!0;return t}function Nl(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r={},_=0,n=e;_<n.length;_++){var a=n[_];for(var o in a)a.hasOwnProperty(o)&&(r[o]=!0)}return r}var gl,hl=vl("area,br,col,hr,img,wbr"),Rl=vl("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),Il=vl("rp,rt"),bl=Nl(Il,Rl),Yl=Nl(hl,Nl(Rl,vl("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),Nl(Il,vl("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),bl),Ll=vl("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),Ml=vl("srcset"),xl=Nl(Ll,Ml,vl("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width")),yl=function(){function e(){this.sanitizedSomething=!1,this.buf=[],this.DOM=mc()}return e.prototype.sanitizeChildren=function(e){for(var t=this.DOM.firstChild(e);t;)if(this.DOM.isElementNode(t)?this.startElement(t):this.DOM.isTextNode(t)?this.chars(this.DOM.nodeValue(t)):this.sanitizedSomething=!0,this.DOM.firstChild(t))t=this.DOM.firstChild(t);else for(;t;){this.DOM.isElementNode(t)&&this.endElement(t);var r=this.checkClobberedElement(t,this.DOM.nextSibling(t));if(r){t=r;break}t=this.checkClobberedElement(t,this.DOM.parentElement(t))}return this.buf.join("")},e.prototype.startElement=function(e){var t=this,r=this.DOM.nodeName(e).toLowerCase();Yl.hasOwnProperty(r)?(this.buf.push("<"),this.buf.push(r),this.DOM.attributeMap(e).forEach(function(e,r){var _,n=r.toLowerCase();xl.hasOwnProperty(n)?(Ll[n]&&(e=Ol(e)),Ml[n]&&(_=e,e=(_=String(_)).split(",").map(function(e){return Ol(e.trim())}).join(", ")),t.buf.push(" "),t.buf.push(r),t.buf.push('="'),t.buf.push(Cl(e)),t.buf.push('"')):t.sanitizedSomething=!0}),this.buf.push(">")):this.sanitizedSomething=!0},e.prototype.endElement=function(e){var t=this.DOM.nodeName(e).toLowerCase();Yl.hasOwnProperty(t)&&!hl.hasOwnProperty(t)&&(this.buf.push("</"),this.buf.push(t),this.buf.push(">"))},e.prototype.chars=function(e){this.buf.push(Cl(e))},e.prototype.checkClobberedElement=function(e,t){if(t&&this.DOM.contains(e,t))throw new Error("Failed to sanitize html because the element is clobbered: "+this.DOM.getOuterHTML(e));return t},e}(),wl=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,Ul=/([^\#-~ |!])/g;function Cl(e){return e.replace(/&/g,"&amp;").replace(wl,function(e){return"&#"+(1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320)+65536)+";"}).replace(Ul,function(e){return"&#"+e.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}var Dl=new RegExp("^([-,.\"'%_!# a-zA-Z0-9]+|(?:(?:matrix|translate|scale|rotate|skew|perspective)(?:X|Y|3d)?|(?:rgb|hsl)a?|(?:repeating-)?(?:linear|radial)-gradient|(?:calc|attr))\\([-0-9.%, #a-zA-Z]+\\))$","g"),Fl=/^url\(([^)]+)\)$/,Gl=function(){},kl=function(e){function t(t){var r=e.call(this)||this;return r._doc=t,r}return Object(ic.b)(t,e),t.prototype.sanitize=function(e,t){if(null==t)return null;switch(e){case s.y.NONE:return t;case s.y.HTML:return t instanceof Bl?t.changingThisBreaksApplicationSecurity:(this.checkNotSafeValue(t,"HTML"),function(e,t){var r=mc(),_=null;try{gl=gl||new Sl(e,r);var n=t?String(t):"";_=gl.getInertBodyElement(n);var a=5,o=n;do{if(0===a)throw new Error("Failed to sanitize html because the input is unstable");a--,n=o,o=r.getInnerHTML(_),_=gl.getInertBodyElement(n)}while(n!==o);var i=new yl,E=i.sanitizeChildren(r.getTemplateContent(_)||_);return Object(s.G)()&&i.sanitizedSomething&&r.log("WARNING: sanitizing HTML stripped some content (see http://g.co/ng/security#xss)."),E}finally{if(_)for(var c=r.getTemplateContent(_)||_,l=0,T=r.childNodesAsList(c);l<T.length;l++)r.removeChild(c,T[l])}}(this._doc,String(t)));case s.y.STYLE:return t instanceof Xl?t.changingThisBreaksApplicationSecurity:(this.checkNotSafeValue(t,"Style"),function(e){if(!(e=String(e).trim()))return"";var t=e.match(Fl);return t&&Ol(t[1])===t[1]||e.match(Dl)&&function(e){for(var t=!0,r=!0,_=0;_<e.length;_++){var n=e.charAt(_);"'"===n&&r?t=!t:'"'===n&&t&&(r=!r)}return t&&r}(e)?e:(Object(s.G)()&&mc().log("WARNING: sanitizing unsafe style value "+e+" (see http://g.co/ng/security#xss)."),"unsafe")}(t));case s.y.SCRIPT:if(t instanceof Hl)return t.changingThisBreaksApplicationSecurity;throw this.checkNotSafeValue(t,"Script"),new Error("unsafe value used in a script context");case s.y.URL:return t instanceof zl||t instanceof Ql?t.changingThisBreaksApplicationSecurity:(this.checkNotSafeValue(t,"URL"),Ol(String(t)));case s.y.RESOURCE_URL:if(t instanceof zl)return t.changingThisBreaksApplicationSecurity;throw this.checkNotSafeValue(t,"ResourceURL"),new Error("unsafe value used in a resource URL context (see http://g.co/ng/security#xss)");default:throw new Error("Unexpected SecurityContext "+e+" (see http://g.co/ng/security#xss)")}},t.prototype.checkNotSafeValue=function(e,t){if(e instanceof Kl)throw new Error("Required a safe "+t+", got a "+e.getTypeName()+" (see http://g.co/ng/security#xss)")},t.prototype.bypassSecurityTrustHtml=function(e){return new Bl(e)},t.prototype.bypassSecurityTrustStyle=function(e){return new Xl(e)},t.prototype.bypassSecurityTrustScript=function(e){return new Hl(e)},t.prototype.bypassSecurityTrustUrl=function(e){return new Ql(e)},t.prototype.bypassSecurityTrustResourceUrl=function(e){return new zl(e)},t}(Gl),Kl=function(){function e(e){this.changingThisBreaksApplicationSecurity=e}return e.prototype.toString=function(){return"SafeValue must use [property]=binding: "+this.changingThisBreaksApplicationSecurity+" (see http://g.co/ng/security#xss)"},e}(),Bl=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(ic.b)(t,e),t.prototype.getTypeName=function(){return"HTML"},t}(Kl),Xl=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(ic.b)(t,e),t.prototype.getTypeName=function(){return"Style"},t}(Kl),Hl=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(ic.b)(t,e),t.prototype.getTypeName=function(){return"Script"},t}(Kl),Ql=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(ic.b)(t,e),t.prototype.getTypeName=function(){return"URL"},t}(Kl),zl=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(ic.b)(t,e),t.prototype.getTypeName=function(){return"ResourceURL"},t}(Kl),Vl=[{provide:s.t,useValue:Ac},{provide:s.u,useValue:function(){Rc.makeCurrent(),wc.init()},multi:!0},{provide:sc,useClass:Lc,deps:[bc]},{provide:bc,useFactory:function(){return document},deps:[]}],jl=Object(s.D)(s.H,"browser",Vl);function ql(){return new s.h}var Wl=function(){function e(e){if(e)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}return e.withServerTransition=function(t){return{ngModule:e,providers:[{provide:s.a,useValue:t.appId},{provide:xc,useExisting:s.a},yc]}},e}();"undefined"!=typeof window&&window;var Jl=r("OVmG"),Zl=function(){function e(e,t){this.predicate=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new $l(e,this.predicate,this.thisArg))},e}(),$l=function(e){function t(t,r,_){e.call(this,t),this.predicate=r,this.thisArg=_,this.count=0}return Object(ic.b)(t,e),t.prototype._next=function(e){var t;try{t=this.predicate.call(this.thisArg,e,this.count++)}catch(e){return void this.destination.error(e)}t&&this.destination.next(e)},t}(Jl.a);function eT(e,t){return function(e,t){return function(r){return r.lift(new Zl(e,t))}}(e,t)(this)}var tT=function(e){function t(){var t=e.call(this,"argument out of range");this.name=t.name="ArgumentOutOfRangeError",this.stack=t.stack,this.message=t.message}return Object(ic.b)(t,e),t}(Error),rT=r("+3/4"),_T=function(){function e(e){if(this.total=e,this.total<0)throw new tT}return e.prototype.call=function(e,t){return t.subscribe(new nT(e,this.total))},e}(),nT=function(e){function t(t,r){e.call(this,t),this.total=r,this.count=0}return Object(ic.b)(t,e),t.prototype._next=function(e){var t=this.total,r=++this.count;r<=t&&(this.destination.next(e),r===t&&(this.destination.complete(),this.unsubscribe()))},t}(Jl.a);function aT(e){return function(e){return function(t){return 0===e?new rT.a:t.lift(new _T(e))}}(e)(this)}var oT=r("YaPU"),iT=oT.a.prototype.toPromise,sT=r("1Q68"),ET=r("Veqx"),cT=ET.a.of,lT=r("BX3T"),TT=r("N4j0"),uT=r("cQXm"),dT=r("AMGY"),fT=function(e){function t(t,r){e.call(this),this.promise=t,this.scheduler=r}return Object(ic.b)(t,e),t.create=function(e,r){return new t(e,r)},t.prototype._subscribe=function(e){var t=this,r=this.promise,_=this.scheduler;if(null==_)this._isScalar?e.closed||(e.next(this.value),e.complete()):r.then(function(r){t.value=r,t._isScalar=!0,e.closed||(e.next(r),e.complete())},function(t){e.closed||e.error(t)}).then(null,function(e){dT.a.setTimeout(function(){throw e})});else if(this._isScalar){if(!e.closed)return _.schedule(PT,0,{value:this.value,subscriber:e})}else r.then(function(r){t.value=r,t._isScalar=!0,e.closed||e.add(_.schedule(PT,0,{value:r,subscriber:e}))},function(t){e.closed||e.add(_.schedule(AT,0,{err:t,subscriber:e}))}).then(null,function(e){dT.a.setTimeout(function(){throw e})})},t}(oT.a);function PT(e){var t=e.subscriber;t.closed||(t.next(e.value),t.complete())}function AT(e){var t=e.subscriber;t.closed||t.error(e.err)}var ST=r("etqZ"),pT=function(e){function t(t,r){if(e.call(this),this.scheduler=r,null==t)throw new Error("iterator cannot be null.");this.iterator=vT(t)}return Object(ic.b)(t,e),t.create=function(e,r){return new t(e,r)},t.dispatch=function(e){var t=e.index,r=e.iterator,_=e.subscriber;if(e.hasError)_.error(e.error);else{var n=r.next();n.done?_.complete():(_.next(n.value),e.index=t+1,_.closed?"function"==typeof r.return&&r.return():this.schedule(e))}},t.prototype._subscribe=function(e){var r=this.iterator,_=this.scheduler;if(_)return _.schedule(t.dispatch,0,{index:0,iterator:r,subscriber:e});for(;;){var n=r.next();if(n.done){e.complete();break}if(e.next(n.value),e.closed){"function"==typeof r.return&&r.return();break}}},t}(oT.a),mT=function(){function e(e,t,r){void 0===t&&(t=0),void 0===r&&(r=e.length),this.str=e,this.idx=t,this.len=r}return e.prototype[ST.a]=function(){return this},e.prototype.next=function(){return this.idx<this.len?{done:!1,value:this.str.charAt(this.idx++)}:{done:!0,value:void 0}},e}(),OT=function(){function e(e,t,r){void 0===t&&(t=0),void 0===r&&(r=function(t){var r,_,n=+e.length;return isNaN(n)?0:0!==n&&"number"==typeof(r=n)&&dT.a.isFinite(r)?(n=(0==(_=+n)?_:isNaN(_)?_:_<0?-1:1)*Math.floor(Math.abs(n)))<=0?0:n>NT?NT:n:n}()),this.arr=e,this.idx=t,this.len=r}return e.prototype[ST.a]=function(){return this},e.prototype.next=function(){return this.idx<this.len?{done:!1,value:this.arr[this.idx++]}:{done:!0,value:void 0}},e}();function vT(e){var t=e[ST.a];if(!t&&"string"==typeof e)return new mT(e);if(!t&&void 0!==e.length)return new OT(e);if(!t)throw new TypeError("object is not iterable");return e[ST.a]()}var NT=Math.pow(2,53)-1,gT=r("TILf"),hT=function(e){function t(t,r){e.call(this),this.arrayLike=t,this.scheduler=r,r||1!==t.length||(this._isScalar=!0,this.value=t[0])}return Object(ic.b)(t,e),t.create=function(e,r){var _=e.length;return 0===_?new rT.a:1===_?new gT.a(e[0],r):new t(e,r)},t.dispatch=function(e){var t=e.arrayLike,r=e.index,_=e.subscriber;_.closed||(r>=e.length?_.complete():(_.next(t[r]),e.index=r+1,this.schedule(e)))},t.prototype._subscribe=function(e){var r=this.arrayLike,_=this.scheduler,n=r.length;if(_)return _.schedule(t.dispatch,0,{arrayLike:r,index:0,length:n,subscriber:e});for(var a=0;a<n&&!e.closed;a++)e.next(r[a]);e.complete()},t}(oT.a),RT=function(){function e(e,t,r){this.kind=e,this.value=t,this.error=r,this.hasValue="N"===e}return e.prototype.observe=function(e){switch(this.kind){case"N":return e.next&&e.next(this.value);case"E":return e.error&&e.error(this.error);case"C":return e.complete&&e.complete()}},e.prototype.do=function(e,t,r){switch(this.kind){case"N":return e&&e(this.value);case"E":return t&&t(this.error);case"C":return r&&r()}},e.prototype.accept=function(e,t,r){return e&&"function"==typeof e.next?this.observe(e):this.do(e,t,r)},e.prototype.toObservable=function(){switch(this.kind){case"N":return oT.a.of(this.value);case"E":return oT.a.throw(this.error);case"C":return oT.a.empty()}throw new Error("unexpected notification kind value")},e.createNext=function(t){return"undefined"!=typeof t?new e("N",t):e.undefinedValueNotification},e.createError=function(t){return new e("E",void 0,t)},e.createComplete=function(){return e.completeNotification},e.completeNotification=new e("C"),e.undefinedValueNotification=new e("N",void 0),e}(),IT=function(e){function t(t,r,_){void 0===_&&(_=0),e.call(this,t),this.scheduler=r,this.delay=_}return Object(ic.b)(t,e),t.dispatch=function(e){e.notification.observe(e.destination),this.unsubscribe()},t.prototype.scheduleMessage=function(e){this.add(this.scheduler.schedule(t.dispatch,this.delay,new bT(e,this.destination)))},t.prototype._next=function(e){this.scheduleMessage(RT.createNext(e))},t.prototype._error=function(e){this.scheduleMessage(RT.createError(e))},t.prototype._complete=function(){this.scheduleMessage(RT.createComplete())},t}(Jl.a),bT=function(e,t){this.notification=e,this.destination=t},YT=r("+CnV"),LT=function(e){function t(t,r){e.call(this,null),this.ish=t,this.scheduler=r}return Object(ic.b)(t,e),t.create=function(e,r){if(null!=e){if("function"==typeof e[YT.a])return e instanceof oT.a&&!r?e:new t(e,r);if(Object(lT.a)(e))return new ET.a(e,r);if(Object(uT.a)(e))return new fT(e,r);if("function"==typeof e[ST.a]||"string"==typeof e)return new pT(e,r);if(Object(TT.a)(e))return new hT(e,r)}throw new TypeError((null!==e&&typeof e||e)+" is not observable")},t.prototype._subscribe=function(e){var t=this.ish,r=this.scheduler;return null==r?t[YT.a]().subscribe(e):t[YT.a]().subscribe(new IT(e,r,0))},t}(oT.a).create,MT=r("8D5t"),xT=r("PIsA"),yT=r("tZ2B"),wT=function(e){function t(t){e.call(this),this.observableFactory=t}return Object(ic.b)(t,e),t.create=function(e){return new t(e)},t.prototype._subscribe=function(e){return new UT(e,this.observableFactory)},t}(oT.a),UT=function(e){function t(t,r){e.call(this,t),this.factory=r,this.tryDefer()}return Object(ic.b)(t,e),t.prototype.tryDefer=function(){try{this._callFactory()}catch(e){this._error(e)}},t.prototype._callFactory=function(){var e=this.factory();e&&this.add(Object(xT.a)(this,e))},t}(yT.a),CT=wT.create,DT=r("GK6M"),FT=r("/iUD"),GT=r("fKB6"),kT=r("VwZZ"),KT=Object.prototype.toString,BT=function(e){function t(t,r,_,n){e.call(this),this.sourceObj=t,this.eventName=r,this.selector=_,this.options=n}return Object(ic.b)(t,e),t.create=function(e,r,_,n){return Object(FT.a)(_)&&(n=_,_=void 0),new t(e,r,n,_)},t.setupSubscription=function(e,r,_,n,a){var o;if(function(e){return!!e&&"[object NodeList]"===KT.call(e)}(e)||function(e){return!!e&&"[object HTMLCollection]"===KT.call(e)}(e))for(var i=0,s=e.length;i<s;i++)t.setupSubscription(e[i],r,_,n,a);else if(function(e){return!!e&&"function"==typeof e.addEventListener&&"function"==typeof e.removeEventListener}(e)){var E=e;e.addEventListener(r,_,a),o=function(){return E.removeEventListener(r,_)}}else if(function(e){return!!e&&"function"==typeof e.on&&"function"==typeof e.off}(e)){var c=e;e.on(r,_),o=function(){return c.off(r,_)}}else{if(!function(e){return!!e&&"function"==typeof e.addListener&&"function"==typeof e.removeListener}(e))throw new TypeError("Invalid event target");var l=e;e.addListener(r,_),o=function(){return l.removeListener(r,_)}}n.add(new kT.a(o))},t.prototype._subscribe=function(e){var r=this.selector;t.setupSubscription(this.sourceObj,this.eventName,r?function(){for(var t=[],_=0;_<arguments.length;_++)t[_-0]=arguments[_];var n=Object(DT.a)(r).apply(void 0,t);n===GT.a?e.error(GT.a.e):e.next(n)}:function(t){return e.next(t)},e,this.options)},t}(oT.a).create,XT=function(e){function t(t,r){e.call(this),this.error=t,this.scheduler=r}return Object(ic.b)(t,e),t.create=function(e,r){return new t(e,r)},t.dispatch=function(e){e.subscriber.error(e.error)},t.prototype._subscribe=function(e){var r=this.error,_=this.scheduler;if(e.syncErrorThrowable=!0,_)return _.schedule(t.dispatch,0,{error:r,subscriber:e});e.error(r)},t}(oT.a).create,HT=function(){function e(e,t,r){this.nextOrObserver=e,this.error=t,this.complete=r}return e.prototype.call=function(e,t){return t.subscribe(new QT(e,this.nextOrObserver,this.error,this.complete))},e}(),QT=function(e){function t(t,r,_,n){e.call(this,t);var a=new Jl.a(r,_,n);a.syncErrorThrowable=!0,this.add(a),this.safeSubscriber=a}return Object(ic.b)(t,e),t.prototype._next=function(e){var t=this.safeSubscriber;t.next(e),t.syncErrorThrown?this.destination.error(t.syncErrorValue):this.destination.next(e)},t.prototype._error=function(e){var t=this.safeSubscriber;t.error(e),this.destination.error(t.syncErrorThrown?t.syncErrorValue:e)},t.prototype._complete=function(){var e=this.safeSubscriber;e.complete(),e.syncErrorThrown?this.destination.error(e.syncErrorValue):this.destination.complete()},t}(Jl.a),zT=function(){function e(e,t){this.project=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new VT(e,this.project,this.thisArg))},e}(),VT=function(e){function t(t,r,_){e.call(this,t),this.project=r,this.count=0,this.thisArg=_||this}return Object(ic.b)(t,e),t.prototype._next=function(e){var t;try{t=this.project.call(this.thisArg,e,this.count++)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(Jl.a);function jT(e,t){return function(e,t){return function(r){if("function"!=typeof e)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return r.lift(new zT(e,t))}}(e,t)(this)}var qT=r("g5jc"),WT=r("Jwyl"),JT=function(){function e(e,t){this.project=e,this.resultSelector=t}return e.prototype.call=function(e,t){return t.subscribe(new ZT(e,this.project,this.resultSelector))},e}(),ZT=function(e){function t(t,r,_){e.call(this,t),this.project=r,this.resultSelector=_,this.index=0}return Object(ic.b)(t,e),t.prototype._next=function(e){var t,r=this.index++;try{t=this.project(e,r)}catch(e){return void this.destination.error(e)}this._innerSub(t,e,r)},t.prototype._innerSub=function(e,t,r){var _=this.innerSubscription;_&&_.unsubscribe(),this.add(this.innerSubscription=Object(xT.a)(this,e,t,r))},t.prototype._complete=function(){var t=this.innerSubscription;t&&!t.closed||e.prototype._complete.call(this)},t.prototype._unsubscribe=function(){this.innerSubscription=null},t.prototype.notifyComplete=function(t){this.remove(t),this.innerSubscription=null,this.isStopped&&e.prototype._complete.call(this)},t.prototype.notifyNext=function(e,t,r,_,n){this.resultSelector?this._tryNotifyNext(e,t,r,_):this.destination.next(t)},t.prototype._tryNotifyNext=function(e,t,r,_){var n;try{n=this.resultSelector(e,t,r,_)}catch(e){return void this.destination.error(e)}this.destination.next(n)},t}(yT.a);function $T(e,t){return function(e,t){return function(r){return r.lift(new JT(e,t))}}(e,t)(this)}var eu=r("/nXB"),tu=r("gIN1"),ru=function(e){function t(){e.call(this)}return Object(ic.b)(t,e),t.create=function(){return new t},t.prototype._subscribe=function(e){Object(tu.a)()},t}(oT.a).create,_u="Service workers are disabled or not supported by this browser",nu=function(){function e(e,t){if(this.serviceWorker=e,e&&Sc(t)){var r=BT(e,"controllerchange"),_=jT.call(r,function(){return e.controller}),n=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];return 1===e.length||2===e.length&&Object(sT.a)(e[1])?LT(e[0]):Object(MT.a)(1)(cT.apply(void 0,e))}(CT(function(){return cT(e.controller)}),_);this.worker=eT.call(n,function(e){return!!e}),this.registration=$T.call(this.worker,function(){return e.getRegistration()});var a=BT(e,"message"),o=jT.call(a,function(e){return e.data}),i=eT.call(o,function(e){return!!e&&!!e.type}),s=(function(e){return function(e){return e?Object(WT.a)(function(){return new qT.a},e):Object(WT.a)(new qT.a)}(e)(this)}).call(i);this.events=s,s.connect()}else this.serviceWorker=void 0,this.worker=this.events=this.registration=(E=_u,CT(function(){return XT(new Error(E))}));var E}return e.prototype.postMessage=function(e,t){var r=aT.call(this.worker,1),_=(function(e,t,r){return function(e,t,r){return function(_){return _.lift(new HT(e,t,r))}}(e,t,r)(this)}).call(r,function(r){r.postMessage(Object(ic.a)({action:e},t))});return iT.call(_).then(function(){})},e.prototype.postMessageWithStatus=function(e,t,r){var _=this.waitForStatus(r),n=this.postMessage(e,t);return Promise.all([_,n]).then(function(){})},e.prototype.generateNonce=function(){return Math.round(1e7*Math.random())},e.prototype.eventsOfType=function(e){return eT.call(this.events,function(t){return t.type===e})},e.prototype.nextEventOfType=function(e){return aT.call(this.eventsOfType(e),1)},e.prototype.waitForStatus=function(e){var t=eT.call(this.eventsOfType("STATUS"),function(t){return t.nonce===e}),r=aT.call(t,1),_=jT.call(r,function(e){if(!e.status)throw new Error(e.error)});return iT.call(_)},Object.defineProperty(e.prototype,"isEnabled",{get:function(){return!!this.serviceWorker},enumerable:!0,configurable:!0}),e}(),au=function(){function e(e){if(this.sw=e,this.subscriptionChanges=new qT.a,!e.isEnabled)return this.messages=ru(),void(this.subscription=ru());this.messages=jT.call(this.sw.eventsOfType("PUSH"),function(e){return e.data}),this.pushManager=jT.call(this.sw.registration,function(e){return e.pushManager});var t=$T.call(this.pushManager,function(e){return e.getSubscription().then(function(e){return e})});this.subscription=Object(eu.a)(t,this.subscriptionChanges)}return Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this.sw.isEnabled},enumerable:!0,configurable:!0}),e.prototype.requestSubscription=function(e){var t=this;if(!this.sw.isEnabled)return Promise.reject(new Error(_u));for(var r={userVisibleOnly:!0},_=atob(e.serverPublicKey.replace(/_/g,"/").replace(/-/g,"+")),n=new Uint8Array(new ArrayBuffer(_.length)),a=0;a<_.length;a++)n[a]=_.charCodeAt(a);r.applicationServerKey=n;var o=$T.call(this.pushManager,function(e){return e.subscribe(r)}),i=aT.call(o,1);return iT.call(i).then(function(e){return t.subscriptionChanges.next(e),e})},e.prototype.unsubscribe=function(){var e=this;if(!this.sw.isEnabled)return Promise.reject(new Error(_u));var t=$T.call(this.subscription,function(t){if(null!==t)return t.unsubscribe().then(function(t){if(!t)throw new Error("Unsubscribe failed!");e.subscriptionChanges.next(null)});throw new Error("Not subscribed to push notifications.")}),r=aT.call(t,1);return iT.call(r)},e}(),ou=function(){function e(e){if(this.sw=e,!e.isEnabled)return this.available=ru(),void(this.activated=ru());this.available=this.sw.eventsOfType("UPDATE_AVAILABLE"),this.activated=this.sw.eventsOfType("UPDATE_ACTIVATED")}return Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this.sw.isEnabled},enumerable:!0,configurable:!0}),e.prototype.checkForUpdate=function(){if(!this.sw.isEnabled)return Promise.reject(new Error(_u));var e=this.sw.generateNonce();return this.sw.postMessageWithStatus("CHECK_FOR_UPDATES",{statusNonce:e},e)},e.prototype.activateUpdate=function(){if(!this.sw.isEnabled)return Promise.reject(new Error(_u));var e=this.sw.generateNonce();return this.sw.postMessageWithStatus("ACTIVATE_UPDATE",{statusNonce:e},e)},e}(),iu=function(){},su=new s.k("NGSW_REGISTER_SCRIPT");function Eu(e,t,r,_){return function(){var n=e.get(s.e);if(Sc(_)&&"serviceWorker"in navigator&&!1!==r.enabled){var a=eT.call(n.isStable,function(e){return!!e}),o=aT.call(a,1),i=iT.call(o);navigator.serviceWorker.addEventListener("controllerchange",function(){null!==navigator.serviceWorker.controller&&navigator.serviceWorker.controller.postMessage({action:"INITIALIZE"})}),i.then(function(){return navigator.serviceWorker.register(t,{scope:r.scope})})}}}function cu(e,t){return new nu(!1!==e.enabled?navigator.serviceWorker:void 0,t)}var lu=function(){function e(){}return e.register=function(t,r){return void 0===r&&(r={}),{ngModule:e,providers:[{provide:su,useValue:t},{provide:iu,useValue:r},{provide:nu,useFactory:cu,deps:[iu,s.t]},{provide:s.b,useFactory:Eu,deps:[s.l,su,iu,s.t],multi:!0}]}},e}(),Tu=s.M(E,[_c],function(e){return s.V([s.W(512,s.g,s.J,[[8,[oc]],[3,s.g],s.p]),s.W(5120,s.o,s.Z,[[3,s.o]]),s.W(4608,uc,dc,[s.o,[2,Tc]]),s.W(4608,s.f,s.f,[]),s.W(5120,s.a,s.R,[]),s.W(5120,s.m,s.X,[]),s.W(5120,s.n,s.Y,[]),s.W(4608,Gl,kl,[Pc]),s.W(6144,s.x,null,[Gl]),s.W(4608,Tl,ul,[]),s.W(5120,Gc,function(e,t,r,_,n){return[new cl(e,t),new Al(r),new dl(_,n)]},[Pc,s.r,Pc,Pc,Tl]),s.W(4608,kc,kc,[Gc,s.r]),s.W(135680,Xc,Xc,[Pc]),s.W(4608,Wc,Wc,[kc,Xc]),s.W(6144,s.v,null,[Wc]),s.W(6144,Bc,null,[Xc]),s.W(4608,s.z,s.z,[s.r]),s.W(4608,Mc,Mc,[Pc]),s.W(4608,Uc,Uc,[Pc]),s.W(5120,nu,cu,[iu,s.t]),s.W(4608,au,au,[nu]),s.W(4608,ou,ou,[nu]),s.W(512,fc,fc,[]),s.W(1024,s.h,ql,[]),s.W(256,su,"/ngsw-worker.js",[]),s.W(256,iu,{enabled:!0},[]),s.W(1024,s.b,function(e,t,r,_,n){return[(a=e,Cc("probe",Fc),Cc("coreTokens",Object(ic.a)({},Dc,(a||[]).reduce(function(e,t){return e[t.name]=t.token,e},{}))),function(){return Fc}),Eu(t,r,_,n)];var a},[[2,s.q],s.l,su,iu,s.t]),s.W(512,s.c,s.c,[[2,s.b]]),s.W(131584,s.e,s.e,[s.r,s.K,s.l,s.h,s.g,s.c]),s.W(512,s.d,s.d,[s.e]),s.W(512,Wl,Wl,[[3,Wl]]),s.W(512,lu,lu,[]),s.W(512,E,E,[])])});Object(s.E)(),jl().bootstrapModuleFactory(Tu).catch(function(e){return console.log(e)})}},[0]);