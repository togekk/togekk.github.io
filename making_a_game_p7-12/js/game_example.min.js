if(b4w.module_check("game_config"))throw"Failed to register module: game_config";
b4w.register("game_config",function(a){a.h=5;a.g=new Float32Array([0,0,-1]);a.lb=new Float32Array([0,0,.25]);a.nb=new Float32Array([0,0,0,1]);a.ob=.6;a.wa=2;a.Ua=.2;a.Ta=new Float32Array([0,4,1.5]);a.$a=new Float32Array([0,0,.5]);a.v=100;a.Wa=.5;a.Ya=35;a.Va=12;a.m=0;a.G=1;a.l=2;a.Hb=2;a.Eb=20;a.Fb=.75;a.S=10;a.va=.5;a.N=.01;a.Ra=.5;a.Oa=30;a.Qa=10;a.aa=.33;a.Pa=15;a.Z=10;a.Na=3;a.ya=.9;a.qa=1;a.Ab=.2;a.zb=1;a.J=.5;a.vb=20;a.tb=30;a.I=3;a.yb=100;a.C=0;a.K=1;a.la=2;a.o=3;a.L=0;a.ma=1;a.na=2;a.oa=["potion_hp",
"potion_hp.001","potion_hp.002"];a.xa=["potion_def"];a.pa=["potion_lava"];a.ia=["golem","golem.001","golem.002"];a.H=["golem_death"];a.sb=["golem_death_armature"];a.rb=["golem_death_blow"];a.D=["lava_rock","lava_rock.001"];a.F=["rock_01","rock_02","rock_03"];a.Sa=["burst_emitter_01","burst_emitter_02","burst_emitter_03"];a.ra=["mark_01","mark_02","mark_03"];a.ka="golem_spawn golem_spawn.011 golem_spawn.010 golem_spawn.009 golem_spawn.001 golem_spawn.008 golem_spawn.002 golem_spawn.006 golem_spawn.007 golem_spawn.003 golem_spawn.005 golem_spawn.014 golem_spawn.013 golem_spawn.004 golem_spawn.012".split(" ");
a.ja="golem_spawn golem_patrol golem_patrol.001 golem_patrol.002 golem_patrol.003 golem_spawn.001 golem_patrol.004 golem_patrol.005 golem_patrol.006 golem_patrol.007 golem_spawn.002 golem_patrol.008 golem_patrol.009 golem_patrol.010 golem_patrol.011 golem_spawn.003 golem_patrol.012 golem_patrol.013 golem_patrol.014 golem_patrol.015 golem_spawn.004 golem_patrol.016 golem_patrol.017 golem_patrol.018 golem_patrol.019".split(" ");a.R=a.ja.length/a.h;a.ha="gem_0 gem_1 gem_2 gem_3 gem_4 gem_multi".split(" ");
a.ib="gem_0 gem_1 gem_2 gem_3 gem_4 gem_multi".split(" ");a.B=0;a.pb=1;a.qb=2;a.ua=4;a.O=["BG","PG","RG","GG","YG"];a.P=3;a.M=["enviroment","islands","island_shield_0"];a.za="shutter_glass";a.Ib="glass_shutter_emitter";a.fb="character_run";a.Xa="sword_miss";a.ea=["character_voice_atack_01","character_voice_atack_02","character_voice_atack_03"];a.fa=["character_voice_hurt_01","character_voice_hurt_02"];a.ga=["character_voice_jump_01","character_voice_jump_02"];a.hb="sword_hit";a.Za="character_voice_death_01";
a.bb="character_jump_ends";a.mb="gem_pickup";a.kb="gem_mount";a.ab="bonus_heal";a.eb="bonus_lava";a.gb="bonus_shield";a.Cb="island_shield_grow";a.Bb="golem_walk";a.ub="golem_atack_miss";a.xb="golem_atack_hit";a.wb="golem_getout";a.Gb=["rock_hit_01","rock_hit_02","rock_hit_03"];a.jb="gem_destroy";a.Jb="final_win";a.ta="level_01_bm_intro";a.sa="level_01_bm_end";a.Db=["level_01_bm_loop_A","level_01_bm_loop_B","level_01_bm_loop_C","level_01_bm_loop_D","level_01_bm_percussive"];a.ba=0;a.ca=1;a.da=2});if(b4w.module_check("obelisks"))throw"Failed to register module: obelisks";
b4w.register("obelisks",function(a,b){function B(){for(var c=0;c<e.h;c++){var a=e.M;a[2]="island_shield_"+c;a=g.get_object_by_dupli_name_list(a);m.stop(a);m.set_behavior(a,m.AB_FINISH_STOP)}}function y(c,a){var C="obelisk_"+c;if(0<a){var b=e.O[c]+"_0"+(v[c]+1),C=g.get_object_by_dupli_name(C,b);g.show_object(C);w.play_def(t);r[c]=e.P}else if(0>a){b=e.O[c]+"_0"+v[c];C=g.get_object_by_dupli_name(C,b);g.hide_object(C);var b=E,m=h;d.get_translation(C,b);d.get_rotation(C,m);u(b,m)}v[c]+=a;k(c)}function k(a){if(p(a)&&
!A.Vb(a)){var d=e.M;d[2]="island_shield_"+a;d=g.get_object_by_dupli_name_list(d);m.play(d);a=g.get_object_by_dupli_name("obelisk_"+a,e.Cb);w.play_def(a);a:{for(a=0;a<e.h;a++)if(!p(a)){a=!1;break a}a=!0}a&&(x.Rb(),c.Ca(),w.clear_playlist(),a=g.get_object_by_name(e.Jb),w.play_def(a),a=x.i(),m.apply(a.rig,"character_idle_01"),m.set_behavior(a.rig,m.AB_CYCLIC),m.play(a.rig),l())}}function u(c,a){var h=g.get_object_by_dupli_name(e.za,e.Ib);d.set_translation_v(h,c);d.set_rotation_v(h,a);g.show_object(h);
m.play(h,function(){g.hide_object(h)});var b=g.get_object_by_dupli_name(e.za,e.jb);w.play_def(b)}function l(){n.ec();q.check_sensor_manifold(null,"UPDATE_VIC_INTERFACE")&&q.remove_sensor_manifold(null,"UPDATE_VIC_INTERFACE");q.create_sensor_manifold(null,"UPDATE_VIC_INTERFACE",q.CT_SHOT,[q.create_timer_sensor(3)],null,function(){n.Sb();n.La()})}function p(c){return v[c]==e.ua}function D(){for(var c=0;c<e.h;c++){v[c]=0;for(var a=1;a<=e.ua;a++){var d=g.get_object_by_dupli_name("obelisk_"+c,e.O[c]+"_0"+
a);g.hide_object(d)}a=e.M;a[2]="island_shield_"+c;a=g.get_object_by_dupli_name_list(a);m.set_frame(a,0)}}var q=b("controls"),g=b("scenes"),m=b("animation"),w=b("sfx"),d=b("transform"),e=b("game_config"),x=b("character"),A=b("golems"),c=b("environment"),n=b("interface"),v=new Uint16Array([0,0,0,0,0]),r=new Uint16Array(5),t=null,E=new Float32Array(3),h=new Float32Array(4);a.init=function(){D();var c=x.i();B();var a=q.create_collision_sensor(c.a,"OBELISK");q.create_sensor_manifold(c.a,"FILL_OBELISK",
q.CT_TRIGGER,[a],null,function(a,d,h){1!=h||!c.c||p(c.island)||c.c.id!=c.island&&5!=c.c.id||(x.Yb(),y(c.island,1))});for(a=0;a<r.length;a++)r[a]=e.P;t=g.get_object_by_dupli_name("character",e.kb)};a.Ob=y;a.fc=k;a.Ea=p;a.Ga=function(c){return v[c]};a.Qb=function(c){--r[c]||(r[c]=e.P,y(c,-1))}});if(b4w.module_check("gems"))throw"Failed to register module: gems";
b4w.register("gems",function(a,b){function B(a){return g[a].state==p.B&&(!D.Ea(a)||5==a)}var y=b("controls"),k=b("scenes"),u=b("transform"),l=b("constraints"),p=b("game_config"),D=b("obelisks"),q=b("character"),g=[];a.init=function(){function a(a,c,d,b){1==d&&q.Kb(b)}for(var b=0;b<p.ha.length;b++){var d=p.ha[b],e=p.ib[b],l=k.get_object_by_name(d),d=k.get_object_by_dupli_name(d,e),l={empty:l,gc:d,id:b,state:p.B};g.push(l);e=y.create_collision_sensor(d,"CHARACTER");y.create_sensor_manifold(d,"PICK_GEM",
y.CT_TRIGGER,[e],null,a,l)}};a.Y=function(a){for(var b=0,d=0;d<g.length;d++)B(d)&&b++;if(b)for(b=Math.floor(b*Math.random()),d=0;d<g.length;d++)if(B(d)&&!b--){d=g[d];u.set_translation_v(d.empty,a);d.state=p.qb;break}};a.reset=function(){for(var a=0;a<g.length;a++){var b=g[a],d=b.empty;l.remove(d);u.set_translation_v(d,p.g);b.state=p.B}}});if(b4w.module_check("interface"))throw"Failed to register module: interface";
b4w.register("interface",function(a,b){function B(a){var b=1;function g(){var d=k-p.get_timeline();0>d?l.remove_sensor_manifold(null,"SHOW_"+a.id):a.style.opacity=1-d/b}b=b||0;a.style.opacity=0;a.style.visibility="visible";var k=p.get_timeline()+b;if(!l.check_sensor_manifold(null,"SHOW_"+a.id)){var D=l.create_elapsed_sensor();l.create_sensor_manifold(null,"SHOW_"+a.id,l.CT_CONTINUOUS,[D],null,g)}}function y(a,b){function g(){var d=q-p.get_timeline();0>d?(a.style.visibility="hidden",l.remove_sensor_manifold(null,
"HIDE_"+a.id)):a.style.opacity=d/b*k}b=b||0;var k=a.style.opacity,q=p.get_timeline()+b;if(!l.check_sensor_manifold(null,"HIDE_"+a.id)){var d=l.create_elapsed_sensor();l.create_sensor_manifold(null,"HIDE_"+a.id,l.CT_CONTINUOUS,[d],null,g)}}var k=b("character"),u=b("game_config"),l=b("controls"),p=b("time");a.ic=function(){l.create_timer_sensor(1)};a.Ma=function(){var a;a=k.i().b;var b=document.getElementById("life_bar_red"),g=document.getElementById("life_bar_mid"),l=192/u.v,p=Math.max(a*l,0);a=Math.min((u.v-
a)*l,192);document.getElementById("life_bar_green").style.width=p+"px";b.style.width=a+"px";g.style.left=p+19+"px"};a.dc=function(a,b,g,k,p,d){function e(h){h.preventDefault();h=h.changedTouches;for(var e=0;e<h.length;e++)h[e].identifier==q?(l.set_custom_sensor(b,0),l.set_custom_sensor(k,0),l.set_custom_sensor(g,0),l.set_custom_sensor(a,0),v.style.visibility="hidden",r.style.visibility="hidden",q=null):h[e].identifier==c?(l.set_custom_sensor(p,0),c=null):h[e].identifier==n&&(l.set_custom_sensor(d,
0),n=null)}var m=new Float32Array(2),q,c,n,v=document.getElementById("control_tap"),r=document.getElementById("control_circle"),t=v.clientWidth/2,E=r.clientWidth/2;document.getElementById("canvas3d").addEventListener("touchstart",function(a){a.preventDefault();var c=window.innerWidth;a=a.changedTouches;for(var d=0;d<a.length;d++){var b=a[d],h=b.clientX,g=b.clientY;if(h>c/2)break;m[0]=h;m[1]=g;q=b.identifier;v.style.visibility="visible";v.style.left=h-t+"px";v.style.top=g-t+"px";r.style.visibility=
"visible";r.style.left=h-E+"px";r.style.top=g-E+"px"}},!1);document.getElementById("control_jump").addEventListener("touchstart",function(a){a.preventDefault();a=a.changedTouches;for(var d=0;d<a.length;d++){var b=a[d];l.set_custom_sensor(p,1);c=b.identifier}},!1);document.getElementById("control_attack").addEventListener("touchstart",function(a){a.preventDefault();a=a.changedTouches;for(var c=0;c<a.length;c++){var b=a[c];l.set_custom_sensor(d,1);n=b.identifier}},!1);document.getElementById("canvas3d").addEventListener("touchmove",
function(c){c.preventDefault();l.set_custom_sensor(b,0);l.set_custom_sensor(k,0);l.set_custom_sensor(g,0);l.set_custom_sensor(a,0);var d=window.innerWidth;c=c.changedTouches;for(var h=0;h<c.length;h++){var e=c[h],n=e.clientX,e=e.clientY;if(n>d/2)break;v.style.left=n-t+"px";v.style.top=e-t+"px";var n=n-m[0],e=e-m[1],r=Math.sqrt(n*n+e*e);if(16>r)break;n/=r;e=-e/r;n>Math.cos(3*Math.PI/8)?l.set_custom_sensor(a,1):n<-Math.cos(3*Math.PI/8)&&l.set_custom_sensor(g,1);e>Math.sin(Math.PI/8)?l.set_custom_sensor(b,
1):e<-Math.sin(Math.PI/8)&&l.set_custom_sensor(k,1)}},!1);document.getElementById("canvas3d").addEventListener("touchend",e,!1);document.getElementById("controls").addEventListener("touchend",e,!1);document.getElementById("control_jump").style.visibility="visible";document.getElementById("control_attack").style.visibility="visible"};a.Xb=function(a){document.getElementById("replay").addEventListener("touchstart",a,!1);document.getElementById("replay").addEventListener("click",a,!1)};a.La=function(){B(document.getElementById("replay"))};
a.hc=function(a){y(document.getElementById("replay"),a)};a.ec=function(){B(document.getElementById("victory"))};a.Sb=function(){y(document.getElementById("victory"),1)}});if(b4w.module_check("bonuses"))throw"Failed to register module: bonuses";
b4w.register("bonuses",function(a,b){function B(a){function c(a,c,b,h){if(1==b)switch(u.set_translation_v(h.empty,k.g),h.type){case k.ba:q.Lb();D.play_def(m);break;case k.ca:x<=k.qa&&q.Mb();x=k.Pa;D.play_def(w);break;case k.da:e<=k.ya&&q.Nb(),e=k.Qa,D.play_def(d)}}function b(a,c,d,b){a=l.get_sensor_value(a,c,0);b.A-=a;0<b.A?(a=b.A,4<a||(b=b.body,a*=k.Na,.5<(1>a?a:a%Math.floor(a))?p.hide_object(b):p.show_object(b))):u.set_translation_v(b.empty,k.g)}for(var r=0;r<g.length;r++){var t=g[r],E=t.body,h=
l.create_collision_sensor(E,"CHARACTER");l.create_sensor_manifold(E,"BONUS",l.CT_TRIGGER,[h],null,c,t);l.create_sensor_manifold(E,"BONUS_LIFETIME",l.CT_CONTINUOUS,[a],null,b,t)}}function y(a,b,d){for(var c=0;c<a.length;c++){var e=a[c],l=b,h=d,n=p.get_object_by_name(e),e=p.get_object_by_dupli_name(e,h);g.push({empty:n,body:e,A:k.Z,type:l})}}var k=b("game_config"),u=b("transform"),l=b("controls"),p=b("scenes"),D=b("sfx"),q=b("character"),g=[],m=null,w=null,d=null,e=0,x=0,A=new Float32Array(3);a.init=
function(a){m=p.get_object_by_dupli_name("character",k.ab);w=p.get_object_by_dupli_name("character",k.eb);d=p.get_object_by_dupli_name("character",k.gb);y(k.oa,k.ba,"potion_HP");y(k.pa,k.ca,"potion_LAVA");y(k.xa,k.da,"potion_SHIELD");B(a);l.create_sensor_manifold(null,"BONUS_TIMER",l.CT_CONTINUOUS,[a],null,function(a,c){var b=l.get_sensor_value(a,c,0);0<e&&(e-b<k.ya&&q.$b(),e-=b);0<x&&(x-b<k.qa&&q.Zb(),x-=b)})};a.Y=function(a){for(var c=Math.floor(3*Math.random()),b=0;b<g.length;b++){var d=g[b],e=
d.empty,l=A;u.get_translation(e,l);if(-1==l[2]&&d.type==c){a[2]+=.05;u.set_translation_v(e,a);d.A=k.Z;p.show_object(d.body);break}}};a.reset=function(){function a(a){for(var c=0;c<a.length;c++){var b=p.get_object_by_name(a[c]);u.set_translation_v(b,k.g)}}a(k.oa);a(k.xa);a(k.pa)};a.cc=function(){e=0};a.bc=function(){x=0};a.Fa=function(){return x};a.X=function(){return e}});if(b4w.module_check("golems"))throw"Failed to register module: golems";
b4w.register("golems",function(a,b){function B(a,b){if(0>=a.b){var e=a.empty,h=g.get_object_by_name(c.H),z=g.get_object_by_dupli_name(c.H,c.sb),H=g.get_object_by_dupli_name(c.H,c.rb),f=C,p=K;d.get_translation(e,f);d.get_rotation(e,p);d.set_translation_v(h,f);d.set_rotation_v(h,p);m.apply(z,"golem_death");m.set_behavior(z,m.AB_FINISH_STOP);m.play(z);m.play(H);w.stop(a.u);d.set_translation_v(e,c.g);E.Y(f);a.f=-1;a.b=100;l(a,c.o);r.Ob(a.f,0)}else switch(a.state){case c.K:!a.T&&m.get_frame(a.rig)>=c.tb&&
(a.s==c.ma?v.Pb(a.Aa,n.i().a,c.J)&&(e=c.vb,0<t.X()&&(e*=c.aa),n.U(-e),w.play_def(a.W)):a.s==c.na&&(e=a.f,r.Ga(e)&&r.Qb(e),w.play_def(a.W)),a.T=!0);break;case c.C:if(e=q.get_sensor_value(a,b,0),h=n.i(),z=a.f,h.island==z&&0<h.b)y(a,h.a,e),a.s=c.ma;else if(r.Ga(z))h=g.get_object_by_dupli_name("obelisk_"+z,"obelisk"),y(a,h,e),a.s=c.na;else{z=a.w;h=C;d.get_translation(a.empty,h);if(!(.05<x.distance(h,z)&&a.s==c.L)){a.s=c.L;a:{for(var z=a.w,f=a.V,p=a.f,I=Math.floor(c.R*Math.random()),A=0,H=0;H<c.R;H++)if(H!=
f&&A++==I){f=g.get_object_by_name(c.ja[c.R*p+H]);d.get_translation(f,z);z[2]=h[2];a.V=H;break a}a.V=-1}}k(a,e);u(a,e)}}}function y(a,b,e){var h=C,g=G;d.get_translation(a.empty,h);d.get_translation(b,g);g[2]=h[2];a.w.set(g);b=x.distance(h,g);h=k(a,e);b>=c.J?u(a,e):h<.05*Math.PI&&(e=a.empty,b=a.Aa,h=C,g=G,a.T=!1,l(a,c.K),d.get_translation(e,h),x.scaleAndAdd(h,g,c.J,b),b[2]+=.3,w.is_playing(a.u)&&w.stop(a.u),w.play_def(a.Ba))}function k(a,b){var h=a.empty,g=a.w,l=C,k=G,f=J,z=K,m=F;d.get_translation(h,
l);d.get_rotation(h,z);x.transformQuat(e.AXIS_MY,z,k);x.subtract(g,l,f);x.normalize(f,f);A.rotationTo(k,f,m);A.multiply(m,z,m);g=x.dot(k,f);g=Math.acos(1<g?1:-1>g?-1:g);A.slerp(z,m,Math.min(b/(Math.abs(g)/Math.PI)*c.zb,1),m);d.set_rotation_v(h,m);return g}function u(a,b){var h=C,g=G,l=K,k=a.empty,f=a.u;d.get_rotation(k,l);d.get_translation(k,h);x.transformQuat(e.AXIS_MY,l,g);x.scaleAndAdd(h,g,c.Ab*b,h);d.set_translation_v(k,h);w.is_playing(f)||(w.play_def(f),w.cyclic(f,!0))}function l(a,b){var d=
a.rig;switch(b){case c.C:m.apply(d,"golem_walk");m.set_behavior(d,m.AB_CYCLIC);m.play(d);break;case c.K:m.apply(d,"golem_atack_0"+(Math.floor(3*Math.random())+1));m.play(d,function(){a.state!=c.o&&l(a,c.C)});break;case c.la:m.apply(d,"golem_getout"),m.play(d,function(){a.state!=c.o&&l(a,c.C)})}a.state=b}function p(){for(var a=c.h,b=0;b<h.length;b++)D(b)||a--;if(0==a)return null;for(var a=Math.floor(Math.random()*a),d=0,b=0;b<c.h;b++)if(D(b)&&d++==a)return b;return null}function D(a){for(var c=0;c<
h.length;c++)if(h[c].f==a)return!1;return r.Ea(a)?!1:!0}var q=b("controls"),g=b("scenes"),m=b("animation"),w=b("sfx"),d=b("transform"),e=b("util"),x=b("vec3"),A=b("quat"),c=b("game_config"),n=b("character"),v=b("combat"),r=b("obelisks"),t=b("bonuses"),E=b("gems"),h=[],C=new Float32Array(3),G=new Float32Array(3),J=new Float32Array(3),K=new Float32Array(4),F=new Float32Array(4),I=0;a.init=function(a){I=c.I;for(var b=0;b<c.ia.length;b++){var d=c.ia[b],e=g.get_object_by_name(d),l=g.get_object_by_dupli_name(d,
"golem_collider"),k=g.get_object_by_dupli_name(d,"golem_armature"),e={body:l,rig:k,empty:e,b:c.yb,f:-1,V:0,w:new Float32Array(3),s:c.L,state:c.o,Aa:new Float32Array(3),T:!1,u:null,Ba:null,W:null,Da:null};e.u=g.get_object_by_dupli_name(d,c.Bb);e.Ba=g.get_object_by_dupli_name(d,c.ub);e.W=g.get_object_by_dupli_name(d,c.xb);e.Da=g.get_object_by_dupli_name(d,c.wb);q.create_sensor_manifold(e,"GOLEM",q.CT_CONTINUOUS,[a],null,B);h.push(e)}v.ac(h)};a.Tb=function(a){for(var b=[],e=[],k=0;k<c.ka.length;k++){var m=
g.get_object_by_name(c.ka[k]),n=d.get_translation(m),m=d.get_rotation(m);b.push(n);e.push(m)}q.create_sensor_manifold(null,"GOLEMS_SPAWN",q.CT_CONTINUOUS,[a],null,function(a,g){var f;a:{for(var k=0;k<h.length;k++)if(f=h[k],f.state==c.o)break a;f=null}if(f&&(k=q.get_sensor_value(a,g,0),I-=k,0>=I&&(I=c.I,k=p(),null!=k))){var m=f.empty,n=b.length/c.h,z=n*k+Math.floor(Math.random()*n),n=b[z],z=e[z];d.set_translation_v(m,n);d.set_rotation_v(m,z);l(f,c.la);w.play_def(f.Da);f.f=k;f.w.set(n)}})};a.reset=
function(){I=c.I;for(var a=0;a<h.length;a++){var b=h[a];b.f=-1;l(b,c.o);d.set_translation_v(b.empty,c.g);w.stop(b.u)}};a.Vb=function(a){for(var c=0;c<h.length;c++)if(h[c].f==a)return!0;return!1}});if(b4w.module_check("combat"))throw"Failed to register module: combat";b4w.register("combat",function(a,b){function B(a,b,g){var m=l;y.get_translation(b,m);return k.distance(m,a)<g?!0:!1}var y=b("transform"),k=b("vec3"),u=b("game_config"),l=new Float32Array(3),p=null;a.ac=function(a){p=a};a.Wb=function(a,b){for(var g=0;g<p.length;g++){var k=p[g];if(!(0>=k.b)&&B(a,k.empty,b))return k.b-=u.Ya,!0}return!1};a.Pb=B});if(b4w.module_check("character"))throw"Failed to register module: character";
b4w.register("character",function(a,b){function B(){function a(a,c,b){f.island=1==b?parseInt(c[c.length-1]):-1}for(var c=0;c<h.h;c++){var b=d.create_collision_sensor(f.Ha,"ISLAND"+c);d.create_sensor_manifold(f.Ha,"ISLE_COLL"+c,d.CT_TRIGGER,[b],null,a)}}function y(a){var c=d.create_ray_sensor(f.a,[0,0,0],[0,0,-.3],"ISLAND",!0),b=d.create_ray_sensor(f.a,[0,0,0],[0,0,-.3],"LAVA",!0);d.create_sensor_manifold(f.a,"GROUND SENS",d.CT_TRIGGER,[c,b],function(a){return a[0]||a[1]},function(c,b,e){d.set_custom_sensor(a,
1==e?1:0)})}function k(a,b,e){function g(a,b,e){if(f.state==h.l)A.set_character_move_dir(a,0,0);else{var g=d.get_sensor_value(a,b,6);if(1==e){switch(b){case "FORWARD":var k=1;break;case "BACKWARD":k=-1}f.state==h.m&&g&&(c.apply(f.rig,"character_run"),c.play(f.rig),c.set_behavior(f.rig,c.AB_CYCLIC));f.state=h.G}else k=0,f.state==h.G&&g&&(c.apply(f.rig,"character_idle_01"),c.set_behavior(f.rig,c.AB_CYCLIC),c.play(f.rig)),f.state=h.m;k&&g?n.is_playing(F)||n.play_def(F):n.is_playing(F)&&n.stop(F);A.set_character_move_dir(a,
k,0)}}var k=d.create_keyboard_sensor(d.KEY_W),l=d.create_keyboard_sensor(d.KEY_S),m=d.create_keyboard_sensor(d.KEY_UP),p=d.create_keyboard_sensor(d.KEY_DOWN);a=[k,m,a,l,p,b,e];d.create_sensor_manifold(f.a,"FORWARD",d.CT_CONTINUOUS,a,function(a){return a[0]||a[1]||a[2]},g);d.create_sensor_manifold(f.a,"BACKWARD",d.CT_CONTINUOUS,a,function(a){return a[3]||a[4]||a[5]},g);c.apply(f.rig,"character_idle_01");c.play(f.rig);c.set_behavior(f.rig,c.AB_CYCLIC);c.apply(f.body,"HEAL_run");c.apply(f.body,"LAVA_grow",
c.SLOT_1);c.apply(f.body,"SHIELD_grow",c.SLOT_2);c.apply(f.j,"SHIELD_GLOW_grow");n.stop(F)}function u(a,c,b){function e(a,c,b){if(f.state!=h.l){var e=d.get_sensor_value(a,"LEFT",6);if(1==b)switch(c){case "LEFT":A.character_rotation_inc(a,e*h.wa,0);break;case "RIGHT":A.character_rotation_inc(a,-e*h.wa,0)}}}var g=d.create_keyboard_sensor(d.KEY_A),k=d.create_keyboard_sensor(d.KEY_D),l=d.create_keyboard_sensor(d.KEY_LEFT),m=d.create_keyboard_sensor(d.KEY_RIGHT);a=[g,l,c,k,m,a,b];d.create_sensor_manifold(f.a,
"LEFT",d.CT_CONTINUOUS,a,function(a){return a[0]||a[1]||a[2]},e);d.create_sensor_manifold(f.a,"RIGHT",d.CT_CONTINUOUS,a,function(a){return a[3]||a[4]||a[5]},e)}function l(a,b){var e=d.create_keyboard_sensor(d.KEY_SPACE);d.create_sensor_manifold(f.a,"JUMP",d.CT_SHOT,[e,a,b],function(a){return a[0]||a[1]},function(a,b){f.state!=h.l&&(A.character_jump(a),d.get_sensor_value(a,b,2)&&(b=Math.floor(2*Math.random()),n.play_def(N[b]),c.apply(f.rig,"character_jump"),c.set_behavior(f.rig,c.AB_FINISH_STOP),c.play(f.rig)))});
d.create_sensor_manifold(f.a,"LANDING",d.CT_SHOT,[b],null,function(){n.play_def(z);f.state==h.m?(c.apply(f.rig,"character_idle_01"),c.set_behavior(f.rig,c.AB_CYCLIC),c.play(f.rig)):f.state==h.G&&(c.apply(f.rig,"character_run"),c.set_behavior(f.rig,c.AB_CYCLIC),c.play(f.rig))})}function p(a,b){function e(){c.apply(f.rig,"character_idle_01");c.set_behavior(f.rig,c.AB_CYCLIC);c.play(f.rig);f.state=h.m}var g=d.create_keyboard_sensor(d.KEY_ENTER),k=!1;d.create_sensor_manifold(f.a,"ATTACK",d.CT_TRIGGER,
[g,a],function(a){return a[0]||a[1]},function(a,b,d){1==d&&f.state!=h.l&&(f.state=h.l,c.apply(f.rig,"character_atack_0"+(Math.floor(3*Math.random())+1)),c.set_behavior(f.rig,c.AB_FINISH_STOP),c.play(f.rig,e),A.set_character_move_dir(f.a,0,0),k=!1,n.is_playing(F)&&n.stop(F),n.play_def(I),n.play_def(O[Math.floor(3*Math.random())]))});d.create_sensor_manifold(f.a,"DAMAGE_GOLEMS",d.CT_CONTINUOUS,[b],null,function(){if(f.state==h.l&&!k&&c.get_frame(f.rig)>=h.Va){var a=R,b=S,d=T,e=L,g=h.Wa;v.get_translation(f.a,
a);v.get_rotation(f.a,e);t.transformQuat(r.AXIS_MY,e,b);t.scaleAndAdd(a,b,g,d);C.Wb(d,g)&&n.play_def(H);k=!0}})}function D(){d.check_sensor_manifolds(f.a)&&d.remove_sensor_manifold(f.a);A.set_character_move_dir(f.a,0,0);n.stop(F)}function q(){c.apply(f.body,"LAVA_fall",c.SLOT_1);c.set_behavior(f.body,c.AB_FINISH_STOP,c.SLOT_1);c.play(f.body,null,c.SLOT_1);J.bc()}function g(){c.apply(f.body,"SHIELD_flash",c.SLOT_2);c.set_behavior(f.body,c.AB_FINISH_STOP,c.SLOT_2);c.play(f.body,null,c.SLOT_2);c.apply(f.j,
"SHIELD_GLOW_fall");c.set_behavior(f.j,c.AB_FINISH_STOP);c.play(f.j);J.cc()}function m(a){if(!(0>=f.b)){var b=x.get_timeline();0>a&&Q<b-.5&&(n.play_def(P[Math.floor(2*Math.random())]),Q=b);f.b+=a;f.b=Math.min(f.b,h.v);0>=f.b&&(D(),K.Ca(),n.clear_playlist(),a=e.get_object_by_dupli_name("enviroment",h.ta),n.stop(a),a=e.get_object_by_dupli_name("enviroment",h.sa),b=e.get_object_by_dupli_name("character",h.Za),n.play_def(a),n.play_def(b),c.apply(f.rig,"character_death"),c.set_behavior(f.rig,c.AB_FINISH_STOP),
c.play(f.rig),G.La(),f.c&&w(),0<J.X&&g(),0<J.Fa&&q());G.Ma()}}function w(){var a=f.c.empty;E.remove(a);v.set_translation_v(a,h.g);v.set_scale(a,1);f.c.state=h.B;f.c=null}var d=b("controls"),e=b("scenes"),x=b("time"),A=b("physics"),c=b("animation"),n=b("sfx"),v=b("transform"),r=b("util"),t=b("vec3"),E=b("constraints"),h=b("game_config"),C=b("combat"),G=b("interface"),J=b("bonuses"),K=b("environment"),F=null,I=null,H=null,z=null,M=null,N=[],O=[],P=[],f=null,Q=-100,R=new Float32Array(3),S=new Float32Array(3),
T=new Float32Array(3),L=new Float32Array(4);a.Ub=function(){f={a:e.get_first_character(),rig:e.get_object_by_dupli_name("character","character_rig"),body:e.get_object_by_dupli_name("character","character_body"),Ha:e.get_object_by_dupli_name("character","character_picker"),j:e.get_object_by_dupli_name("character","shield_sphere"),b:h.v,state:h.m,c:null,island:-1}};a.Ia=function(a){F=e.get_object_by_dupli_name("character",h.fb);I=e.get_object_by_dupli_name("character",h.Xa);H=e.get_object_by_dupli_name("character",
h.hb);z=e.get_object_by_dupli_name("character",h.bb);M=e.get_object_by_dupli_name("character",h.mb);for(var c=0;c<h.ga.length;c++){var b=e.get_object_by_dupli_name("character",h.ga[c]);N.push(b)}for(c=0;c<h.ea.length;c++)b=e.get_object_by_dupli_name("character",h.ea[c]),O.push(b);for(c=0;c<h.fa.length;c++)b=e.get_object_by_dupli_name("character",h.fa[c]),P.push(b);B();var c=d.create_custom_sensor(0),b=d.create_custom_sensor(0),f=d.create_custom_sensor(0),g=d.create_custom_sensor(0),m=d.create_custom_sensor(0),
n=d.create_custom_sensor(0),q=d.create_custom_sensor(0);y(q);(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i))&&G.dc(c,f,b,g,m,n);k(f,g,q);u(c,b,a);l(m,q);p(n,a)};a.Rb=D;a.reset=function(){f.state=h.m;f.b=h.v;f.island=-1;v.get_rotation(f.a,L);A.set_transform(f.a,h.$a,L);A.set_character_move_dir(f.a,
0,0)};a.Lb=function(){m(h.Oa);c.play(f.body)};a.Mb=function(){c.apply(f.body,"LAVA_grow",c.SLOT_1);c.set_behavior(f.body,c.AB_FINISH_STOP,c.SLOT_1);c.play(f.body,null,c.SLOT_1)};a.Zb=q;a.Nb=function(){c.apply(f.body,"SHIELD_grow",c.SLOT_2);c.set_behavior(f.body,c.AB_FINISH_STOP,c.SLOT_2);c.play(f.body,null,c.SLOT_2);c.apply(f.j,"SHIELD_GLOW_grow");c.set_behavior(f.j,c.AB_FINISH_STOP);c.play(f.j)};a.$b=g;a.U=m;a.Kb=function(a){if(f.c){if(f.c==a)return;w()}E.append_stiff(a.empty,f.a,h.lb,h.nb,h.ob);
a.state=h.pb;f.c=a;n.play_def(M)};a.Yb=w;a.i=function(){return f}});if(b4w.module_check("environment"))throw"Failed to register module: environment";
b4w.register("environment",function(a,b){function B(a){var b=w;b[0]=8*Math.random()-4;b[1]=8*Math.random()-4;b[2]=4*Math.random()+2;l.set_translation_v(a,b)}var y=b("animation"),k=b("controls"),u=b("scenes"),l=b("transform"),p=b("vec3"),D=b("sfx"),q=b("character"),g=b("game_config"),m=b("bonuses"),w=new Float32Array(3);a.Ja=function(a){function b(a,b){var d=k.get_sensor_value(a,b,0),e=u.get_object_name(a);c[e]+=d;c[e]<=g.va||(e=w,l.get_translation(a,e),e[2]-=g.Hb*d,l.set_translation_v(a,e))}function d(a,
b,d,e){var h=w,n=e[0];e=e[1];l.get_translation(q.i().a,h);d=k.get_sensor_value(a,b,0)?0:1;b=k.get_sensor_payload(a,b,d).coll_pos;h=p.distance(h,b);l.set_translation_v(n,b);y.set_frame(n,0,y.SLOT_ALL);y.play(n,null,y.SLOT_ALL);B(a);h<g.Fb&&(n=-g.Eb,0<m.X()&&(n*=g.aa),q.U(n));a=u.get_object_name(a);c[a]=0;Math.random()<g.Ra&&!d&&m.Y(b);D.play_def(e)}function A(a,b,d,e){d=k.get_sensor_value(a,b,0)?0:1;b=k.get_sensor_payload(a,b,d).hit_fract;d=w;var h=u.get_object_name(a);c[h]<=g.va&&(l.get_translation(a,
d),d[2]-=b*g.S-.01,l.set_translation_v(e,d));l.set_scale(e,1-b)}for(var c={},n=0;n<g.D.length;n++)for(var v=g.D[n],r=0;r<g.F.length;r++){var t=g.F[r],E=g.Sa[r],h=g.ra[r],t=u.get_object_by_dupli_name(v,t),E=u.get_object_by_dupli_name(v,E),h=u.get_object_by_dupli_name(v,h),C=u.get_object_by_dupli_name(v,g.Gb[r]),G=k.create_collision_sensor(t,"LAVA",!0),J=k.create_collision_sensor(t,"ISLAND",!0),K=k.create_ray_sensor(t,[0,0,0],[0,0,-g.S],"ISLAND",!0),F=k.create_ray_sensor(t,[0,0,0],[0,0,-g.S],"LAVA",
!0);k.create_sensor_manifold(t,"ROCK_FALL",k.CT_CONTINUOUS,[a],null,b);k.create_sensor_manifold(t,"ROCK_CRASH",k.CT_SHOT,[J,G],function(a){return a[0]||a[1]},d,[E,C]);k.create_sensor_manifold(t,"MARK_POS",k.CT_CONTINUOUS,[K,F],function(a){return a[0]||a[1]},A,h);B(t);t=u.get_object_name(t);c[t]=0}};a.Ka=function(a){var b=0,d=q.i(),l=k.create_ray_sensor(d.a,[0,0,0],[0,0,-.3],"LAVA",!0);k.create_sensor_manifold(d.a,"LAVA_COLLISION",k.CT_CONTINUOUS,[l,a],function(a){return a[0]},function(a,d,e){1==e?
(a=k.get_sensor_value(a,d,1),b+=a,b>=g.N&&(a=a<g.N?1:Math.floor(a/g.N),0>=m.Fa()&&q.U(-a),b=0)):b=0})};a.Ca=function(){for(var a=0;a<g.D.length;a++)for(var b=g.D[a],m=0;m<g.F.length;m++){var p=g.ra[m],c=u.get_object_by_dupli_name(b,g.F[m]),p=u.get_object_by_dupli_name(b,p);k.remove_sensor_manifold(c);B(c);l.set_translation_v(p,g.g)}}});if(b4w.module_check("game_example_main"))throw"Failed to register module: game_example_main";
b4w.register("game_example_main",function(a,b){function B(a,b){if(b){var c=p.get_std_assets_path()+"tutorials/making_a_game_p7-12/level_01.json";D.load(c,y,null,!0)}else w.log("b4w init failure")}function y(){x.Ub();var a=q.create_elapsed_sensor();A.init(a);n.init(a);n.Tb(a);v.init();r.init();x.Ia(a);t.Ja(a);t.Ka(a);k();u();c.Xb(function(){document.getElementById("replay").style.visibility="hidden";q.remove_sensor_manifold(null,"PLAYLIST");x.reset();r.reset();A.reset();n.reset();x.Ia(a);v.init();
t.Ka(a);t.Ja(a);c.Ma();u()})}function k(){var a=m.get_active_camera(),b=m.get_object_by_dupli_name("character","camera_target");g.append_semi_soft(a,b,e.Ta,e.Ua)}function u(){var a=m.get_object_by_dupli_name("enviroment",e.ta),b=m.get_object_by_dupli_name("enviroment",e.sa);d.play_def(a);d.stop(b);a=d.get_duration(a)*d.get_playrate(a);q.create_sensor_manifold(null,"PLAYLIST",q.CT_SHOT,[q.create_timer_sensor(a)],null,function(){q.remove_sensor_manifold(null,"PLAYLIST");if(!(0>=x.i().b)){for(var a=
[],b=e.Db,c=0;c<b.length;c++){var g=m.get_object_by_dupli_name("enviroment",b[c]);a.push(g)}d.apply_playlist(a,0,!0)}})}var l=b("app"),p=b("config"),D=b("data"),q=b("controls"),g=b("constraints"),m=b("scenes"),w=b("print"),d=b("sfx"),e=b("game_config"),x=b("character"),A=b("bonuses"),c=b("interface"),n=b("golems"),v=b("obelisks"),r=b("gems"),t=b("environment");a.init=function(){var a=navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||
navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i)?!0:!1;l.init({canvas_container_id:"canvas3d",callback:B,physics_enabled:!0,quality:a?p.P_LOW:p.P_HIGH,console_verbose:!0,show_fps:!0,autoresize:!0,physics_use_workers:!a,alpha:!1})}});b4w.require("game_example_main").init();
